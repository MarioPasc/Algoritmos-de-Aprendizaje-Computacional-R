<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="es" xml:lang="es"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.552">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Mario Pascual González">

<title>Algoritmos de Aprendizaje Computacional</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="AlgoritmosApendizajeCancerMama_files/libs/clipboard/clipboard.min.js"></script>
<script src="AlgoritmosApendizajeCancerMama_files/libs/quarto-html/quarto.js"></script>
<script src="AlgoritmosApendizajeCancerMama_files/libs/quarto-html/popper.min.js"></script>
<script src="AlgoritmosApendizajeCancerMama_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="AlgoritmosApendizajeCancerMama_files/libs/quarto-html/anchor.min.js"></script>
<link href="AlgoritmosApendizajeCancerMama_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="AlgoritmosApendizajeCancerMama_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="AlgoritmosApendizajeCancerMama_files/libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="AlgoritmosApendizajeCancerMama_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="AlgoritmosApendizajeCancerMama_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="AlgoritmosApendizajeCancerMama_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="AlgoritmosApendizajeCancerMama_files/libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script src="AlgoritmosApendizajeCancerMama_files/libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>

<script src="AlgoritmosApendizajeCancerMama_files/libs/plotly-binding-4.10.4/plotly.js"></script>

<script src="AlgoritmosApendizajeCancerMama_files/libs/typedarray-0.1/typedarray.min.js"></script>

<script src="AlgoritmosApendizajeCancerMama_files/libs/jquery-3.5.1/jquery.min.js"></script>

<link href="AlgoritmosApendizajeCancerMama_files/libs/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet">

<script src="AlgoritmosApendizajeCancerMama_files/libs/crosstalk-1.2.1/js/crosstalk.min.js"></script>

<link href="AlgoritmosApendizajeCancerMama_files/libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css" rel="stylesheet">

<script src="AlgoritmosApendizajeCancerMama_files/libs/plotly-main-2.11.1/plotly-latest.min.js"></script>


  <script>window.backupDefine = window.define; window.define = undefined;</script><script src="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js"></script>
  <script>document.addEventListener("DOMContentLoaded", function () {
 var mathElements = document.getElementsByClassName("math");
 var macros = [];
 for (var i = 0; i < mathElements.length; i++) {
  var texText = mathElements[i].firstChild;
  if (mathElements[i].tagName == "SPAN") {
   katex.render(texText.data, mathElements[i], {
    displayMode: mathElements[i].classList.contains('display'),
    throwOnError: false,
    macros: macros,
    fleqn: false
   });
}}});
  </script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css">

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Contenidos</h2>
   
  <ul>
  <li><a href="#introducción" id="toc-introducción" class="nav-link active" data-scroll-target="#introducción"><span class="header-section-number">1</span> Introducción</a>
  <ul class="collapse">
  <li><a href="#objetivos" id="toc-objetivos" class="nav-link" data-scroll-target="#objetivos"><span class="header-section-number">1.1</span> Objetivos</a></li>
  </ul></li>
  <li><a href="#metodología" id="toc-metodología" class="nav-link" data-scroll-target="#metodología"><span class="header-section-number">2</span> Metodología</a>
  <ul class="collapse">
  <li><a href="#material" id="toc-material" class="nav-link" data-scroll-target="#material"><span class="header-section-number">2.1</span> Material</a>
  <ul class="collapse">
  <li><a href="#conjunto-de-datos-inicial" id="toc-conjunto-de-datos-inicial" class="nav-link" data-scroll-target="#conjunto-de-datos-inicial"><span class="header-section-number">2.1.1</span> Conjunto de Datos Inicial</a></li>
  <li><a href="#pre-procesamiento" id="toc-pre-procesamiento" class="nav-link" data-scroll-target="#pre-procesamiento"><span class="header-section-number">2.1.2</span> Pre-Procesamiento</a></li>
  </ul></li>
  <li><a href="#métodos" id="toc-métodos" class="nav-link" data-scroll-target="#métodos"><span class="header-section-number">2.2</span> Métodos</a>
  <ul class="collapse">
  <li><a href="#auc-y-rendimiento-aparente" id="toc-auc-y-rendimiento-aparente" class="nav-link" data-scroll-target="#auc-y-rendimiento-aparente"><span class="header-section-number">2.2.1</span> AUC y Rendimiento Aparente</a></li>
  <li><a href="#ajuste-fino-doble-validación-cruzada-5x2" id="toc-ajuste-fino-doble-validación-cruzada-5x2" class="nav-link" data-scroll-target="#ajuste-fino-doble-validación-cruzada-5x2"><span class="header-section-number">2.2.2</span> Ajuste Fino: Doble Validación Cruzada 5x2</a></li>
  <li><a href="#selección-de-características" id="toc-selección-de-características" class="nav-link" data-scroll-target="#selección-de-características"><span class="header-section-number">2.2.3</span> Selección de Características</a></li>
  <li><a href="#modelos-aplicados" id="toc-modelos-aplicados" class="nav-link" data-scroll-target="#modelos-aplicados"><span class="header-section-number">2.2.4</span> Modelos Aplicados</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#resultados" id="toc-resultados" class="nav-link" data-scroll-target="#resultados"><span class="header-section-number">3</span> Resultados</a>
  <ul class="collapse">
  <li><a href="#naive-bayes-1" id="toc-naive-bayes-1" class="nav-link" data-scroll-target="#naive-bayes-1"><span class="header-section-number">3.1</span> Naive Bayes</a>
  <ul class="collapse">
  <li><a href="#aparente" id="toc-aparente" class="nav-link" data-scroll-target="#aparente"><span class="header-section-number">3.1.1</span> Aparente</a></li>
  <li><a href="#todas-las-variables" id="toc-todas-las-variables" class="nav-link" data-scroll-target="#todas-las-variables"><span class="header-section-number">3.1.2</span> Todas las Variables</a></li>
  <li><a href="#filtrado-asociación" id="toc-filtrado-asociación" class="nav-link" data-scroll-target="#filtrado-asociación"><span class="header-section-number">3.1.3</span> Filtrado (Asociación)</a></li>
  <li><a href="#wrapped-stepauc" id="toc-wrapped-stepauc" class="nav-link" data-scroll-target="#wrapped-stepauc"><span class="header-section-number">3.1.4</span> Wrapped (StepAUC)</a></li>
  <li><a href="#embedded-lasso" id="toc-embedded-lasso" class="nav-link" data-scroll-target="#embedded-lasso"><span class="header-section-number">3.1.5</span> Embedded (Lasso)</a></li>
  </ul></li>
  <li><a href="#adaboost-1" id="toc-adaboost-1" class="nav-link" data-scroll-target="#adaboost-1"><span class="header-section-number">3.2</span> Adaboost</a>
  <ul class="collapse">
  <li><a href="#aparente-1" id="toc-aparente-1" class="nav-link" data-scroll-target="#aparente-1"><span class="header-section-number">3.2.1</span> Aparente</a></li>
  <li><a href="#todas-las-variables-1" id="toc-todas-las-variables-1" class="nav-link" data-scroll-target="#todas-las-variables-1"><span class="header-section-number">3.2.2</span> Todas las Variables</a></li>
  <li><a href="#filtrado-asociación-1" id="toc-filtrado-asociación-1" class="nav-link" data-scroll-target="#filtrado-asociación-1"><span class="header-section-number">3.2.3</span> Filtrado (Asociación)</a></li>
  <li><a href="#wrapped-stepauc-1" id="toc-wrapped-stepauc-1" class="nav-link" data-scroll-target="#wrapped-stepauc-1"><span class="header-section-number">3.2.4</span> Wrapped (StepAUC)</a></li>
  <li><a href="#embedded-lasso-1" id="toc-embedded-lasso-1" class="nav-link" data-scroll-target="#embedded-lasso-1"><span class="header-section-number">3.2.5</span> Embedded (Lasso)</a></li>
  </ul></li>
  <li><a href="#random-forest-1" id="toc-random-forest-1" class="nav-link" data-scroll-target="#random-forest-1"><span class="header-section-number">3.3</span> Random Forest</a>
  <ul class="collapse">
  <li><a href="#aparente-2" id="toc-aparente-2" class="nav-link" data-scroll-target="#aparente-2"><span class="header-section-number">3.3.1</span> Aparente</a></li>
  <li><a href="#todas-las-variables-2" id="toc-todas-las-variables-2" class="nav-link" data-scroll-target="#todas-las-variables-2"><span class="header-section-number">3.3.2</span> Todas las Variables</a></li>
  <li><a href="#filtrado-asociación-2" id="toc-filtrado-asociación-2" class="nav-link" data-scroll-target="#filtrado-asociación-2"><span class="header-section-number">3.3.3</span> Filtrado (Asociación)</a></li>
  <li><a href="#wrapped-stepauc-2" id="toc-wrapped-stepauc-2" class="nav-link" data-scroll-target="#wrapped-stepauc-2"><span class="header-section-number">3.3.4</span> Wrapped (StepAUC)</a></li>
  <li><a href="#embedded-lasso-2" id="toc-embedded-lasso-2" class="nav-link" data-scroll-target="#embedded-lasso-2"><span class="header-section-number">3.3.5</span> Embedded (Lasso)</a></li>
  </ul></li>
  <li><a href="#decision-tree" id="toc-decision-tree" class="nav-link" data-scroll-target="#decision-tree"><span class="header-section-number">3.4</span> Decision Tree</a>
  <ul class="collapse">
  <li><a href="#aparente-3" id="toc-aparente-3" class="nav-link" data-scroll-target="#aparente-3"><span class="header-section-number">3.4.1</span> Aparente</a></li>
  <li><a href="#todas-las-variables-3" id="toc-todas-las-variables-3" class="nav-link" data-scroll-target="#todas-las-variables-3"><span class="header-section-number">3.4.2</span> Todas las Variables</a></li>
  <li><a href="#filtrado-asociación-3" id="toc-filtrado-asociación-3" class="nav-link" data-scroll-target="#filtrado-asociación-3"><span class="header-section-number">3.4.3</span> Filtrado (Asociación)</a></li>
  <li><a href="#wrapped-stepauc-3" id="toc-wrapped-stepauc-3" class="nav-link" data-scroll-target="#wrapped-stepauc-3"><span class="header-section-number">3.4.4</span> Wrapped (StepAUC)</a></li>
  <li><a href="#embedded-lasso-3" id="toc-embedded-lasso-3" class="nav-link" data-scroll-target="#embedded-lasso-3"><span class="header-section-number">3.4.5</span> Embedded (Lasso)</a></li>
  </ul></li>
  <li><a href="#k-nearest-neighbours-1" id="toc-k-nearest-neighbours-1" class="nav-link" data-scroll-target="#k-nearest-neighbours-1"><span class="header-section-number">3.5</span> K-Nearest Neighbours</a>
  <ul class="collapse">
  <li><a href="#aparente-4" id="toc-aparente-4" class="nav-link" data-scroll-target="#aparente-4"><span class="header-section-number">3.5.1</span> Aparente</a></li>
  <li><a href="#todas-las-variables-4" id="toc-todas-las-variables-4" class="nav-link" data-scroll-target="#todas-las-variables-4"><span class="header-section-number">3.5.2</span> Todas las Variables</a></li>
  <li><a href="#filtrado-asociación-4" id="toc-filtrado-asociación-4" class="nav-link" data-scroll-target="#filtrado-asociación-4"><span class="header-section-number">3.5.3</span> Filtrado (Asociación)</a></li>
  <li><a href="#wrapped-stepauc-4" id="toc-wrapped-stepauc-4" class="nav-link" data-scroll-target="#wrapped-stepauc-4"><span class="header-section-number">3.5.4</span> Wrapped (StepAUC)</a></li>
  <li><a href="#embedded-lasso-4" id="toc-embedded-lasso-4" class="nav-link" data-scroll-target="#embedded-lasso-4"><span class="header-section-number">3.5.5</span> Embedded (Lasso)</a></li>
  </ul></li>
  <li><a href="#support-vector-machines" id="toc-support-vector-machines" class="nav-link" data-scroll-target="#support-vector-machines"><span class="header-section-number">3.6</span> Support Vector Machines</a>
  <ul class="collapse">
  <li><a href="#aparente-5" id="toc-aparente-5" class="nav-link" data-scroll-target="#aparente-5"><span class="header-section-number">3.6.1</span> Aparente</a></li>
  <li><a href="#todas-las-variables-5" id="toc-todas-las-variables-5" class="nav-link" data-scroll-target="#todas-las-variables-5"><span class="header-section-number">3.6.2</span> Todas las Variables</a></li>
  <li><a href="#filtrado-asociación-5" id="toc-filtrado-asociación-5" class="nav-link" data-scroll-target="#filtrado-asociación-5"><span class="header-section-number">3.6.3</span> Filtrado (Asociación)</a></li>
  <li><a href="#wrapped-stepauc-5" id="toc-wrapped-stepauc-5" class="nav-link" data-scroll-target="#wrapped-stepauc-5"><span class="header-section-number">3.6.4</span> Wrapped (StepAUC)</a></li>
  <li><a href="#embedded-lasso-5" id="toc-embedded-lasso-5" class="nav-link" data-scroll-target="#embedded-lasso-5"><span class="header-section-number">3.6.5</span> Embedded (Lasso)</a></li>
  </ul></li>
  <li><a href="#artificial-neural-networks-1" id="toc-artificial-neural-networks-1" class="nav-link" data-scroll-target="#artificial-neural-networks-1"><span class="header-section-number">3.7</span> Artificial Neural Networks</a>
  <ul class="collapse">
  <li><a href="#aparente-6" id="toc-aparente-6" class="nav-link" data-scroll-target="#aparente-6"><span class="header-section-number">3.7.1</span> Aparente</a></li>
  <li><a href="#todas-las-variables-6" id="toc-todas-las-variables-6" class="nav-link" data-scroll-target="#todas-las-variables-6"><span class="header-section-number">3.7.2</span> Todas las Variables</a></li>
  <li><a href="#filtrado-asociación-6" id="toc-filtrado-asociación-6" class="nav-link" data-scroll-target="#filtrado-asociación-6"><span class="header-section-number">3.7.3</span> Filtrado (Asociación)</a></li>
  <li><a href="#wrapped-stepauc-6" id="toc-wrapped-stepauc-6" class="nav-link" data-scroll-target="#wrapped-stepauc-6"><span class="header-section-number">3.7.4</span> Wrapped (StepAUC)</a></li>
  <li><a href="#embedded-lasso-6" id="toc-embedded-lasso-6" class="nav-link" data-scroll-target="#embedded-lasso-6"><span class="header-section-number">3.7.5</span> Embedded (Lasso)</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#discusión" id="toc-discusión" class="nav-link" data-scroll-target="#discusión"><span class="header-section-number">4</span> Discusión</a>
  <ul class="collapse">
  <li><a href="#rendimiento-aparente" id="toc-rendimiento-aparente" class="nav-link" data-scroll-target="#rendimiento-aparente"><span class="header-section-number">4.1</span> Rendimiento Aparente</a></li>
  <li><a href="#estabilidad-de-auc-entre-folds" id="toc-estabilidad-de-auc-entre-folds" class="nav-link" data-scroll-target="#estabilidad-de-auc-entre-folds"><span class="header-section-number">4.2</span> Estabilidad de AUC entre Folds</a>
  <ul class="collapse">
  <li><a href="#naive-bayes-2" id="toc-naive-bayes-2" class="nav-link" data-scroll-target="#naive-bayes-2"><span class="header-section-number">4.2.1</span> Naive Bayes</a></li>
  <li><a href="#adaboost-2" id="toc-adaboost-2" class="nav-link" data-scroll-target="#adaboost-2"><span class="header-section-number">4.2.2</span> AdaBoost</a></li>
  <li><a href="#knn" id="toc-knn" class="nav-link" data-scroll-target="#knn"><span class="header-section-number">4.2.3</span> KNN</a></li>
  <li><a href="#decision-tree-1" id="toc-decision-tree-1" class="nav-link" data-scroll-target="#decision-tree-1"><span class="header-section-number">4.2.4</span> Decision Tree</a></li>
  <li><a href="#randomforest" id="toc-randomforest" class="nav-link" data-scroll-target="#randomforest"><span class="header-section-number">4.2.5</span> RandomForest</a></li>
  <li><a href="#svm" id="toc-svm" class="nav-link" data-scroll-target="#svm"><span class="header-section-number">4.2.6</span> SVM</a></li>
  <li><a href="#ann" id="toc-ann" class="nav-link" data-scroll-target="#ann"><span class="header-section-number">4.2.7</span> ANN</a></li>
  <li><a href="#auc---conclusión" id="toc-auc---conclusión" class="nav-link" data-scroll-target="#auc---conclusión"><span class="header-section-number">4.2.8</span> AUC - Conclusión</a></li>
  </ul></li>
  <li><a href="#estabilidad-para-hiperparámetros" id="toc-estabilidad-para-hiperparámetros" class="nav-link" data-scroll-target="#estabilidad-para-hiperparámetros"><span class="header-section-number">4.3</span> Estabilidad para Hiperparámetros</a></li>
  <li><a href="#estabilidad-de-variables" id="toc-estabilidad-de-variables" class="nav-link" data-scroll-target="#estabilidad-de-variables"><span class="header-section-number">4.4</span> Estabilidad de Variables</a></li>
  <li><a href="#modelo-más-adecuado" id="toc-modelo-más-adecuado" class="nav-link" data-scroll-target="#modelo-más-adecuado"><span class="header-section-number">4.5</span> Modelo más Adecuado</a></li>
  </ul></li>
  <li><a href="#conclusión" id="toc-conclusión" class="nav-link" data-scroll-target="#conclusión"><span class="header-section-number">5</span> Conclusión</a></li>
  <li><a href="#anexo-a-aplicación-rshiny-y-despliegue-del-modelo" id="toc-anexo-a-aplicación-rshiny-y-despliegue-del-modelo" class="nav-link" data-scroll-target="#anexo-a-aplicación-rshiny-y-despliegue-del-modelo"><span class="header-section-number">6</span> Anexo A: Aplicación RShiny y Despliegue del Modelo</a></li>
  </ul>
<div class="quarto-other-links"><h2>Otros Enlaces</h2><ul><li><a href="https://www.linkedin.com/in/mario-pascual-gonzalez/"><i class="bi bi-linkedin"></i>LinkedIn</a></li><li><a href="mailto:mario.pg02@gmail.com?subject=Contacto desde el informe de Modelado Predictivo"><i class="bi bi-envelope"></i>Correo Electrónico</a></li><li><a href="https://github.com/MarioPasc"><i class="bi bi-github"></i>Perfil de Github</a></li></ul></div><div class="quarto-code-links"><h2>Enlaces de código</h2><ul><li><a href="https://github.com/MarioPasc/Algoritmos-de-Aprendizaje-Computacional-R"><i class="bi bi-file-code"></i>Repositorio del Informe</a></li></ul></div></nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Algoritmos de Aprendizaje Computacional</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Expand Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Mostrar todo el código</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Ocultar todo el código</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">Ver el código fuente</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Autor/a</div>
    <div class="quarto-title-meta-contents">
             <p>Mario Pascual González </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="introducción" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Introducción</h1>
<p>El cáncer de mama es el cáncer no cutáneo más común en las mujeres en los Estados Unidos, con una incidencia estimada de 310,720 casos de enfermedad invasiva y 42,250 defunciones durante 2024 <span class="citation" data-cites="nci2024deteccion">(<a href="#ref-nci2024deteccion" role="doc-biblioref"><span>«Exámenes de detección del cáncer de seno (mama) (PDQ®)»</span>, s.&nbsp;f.</a>)</span>. Este problema de salud tiene una relevancia crítica debido a su impacto en la vida de las mujeres y en la sociedad en general (<a href="#fig-cancermama" class="quarto-xref">Figura&nbsp;1</a>).</p>
<p>La capacidad de anticipar la metástasis de un paciente de cáncer de mama es esencial, ya que permite una intervención temprana y potencialmente curativa. La acción rápida contra el cáncer, especialmente en sus etapas iniciales, es crucial para salvar vidas. De aquí surge la necesidad de desarrollar modelos predictivos basados en datos, los cuales pueden ofrecer una herramienta valiosa para identificar a los pacientes en riesgo de metástasis, permitiendo un diagnóstico y tratamiento tempranos.</p>
<p>Para los clínicos, la implementación de un modelo predictivo para predecir el estado PCR de los pacientes con cáncer de mama puede mejorar la precisión del diagnóstico, reduciendo el sobrediagnóstico y el sobretratamiento, lo cual es particularmente relevante dado que la detección temprana del cáncer de mama puede conducir a un sobrediagnóstico, donde se detectan cánceres que no representan una amenaza para la vida del paciente <span class="citation" data-cites="nci2024deteccion">(<a href="#ref-nci2024deteccion" role="doc-biblioref"><span>«Exámenes de detección del cáncer de seno (mama) (PDQ®)»</span>, s.&nbsp;f.</a>)</span>. Por otra parte, estos modelos pueden ayudar a optimizar el uso de recursos, al permitir una asignación más eficiente de los tratamientos y exámenes, basada en la probabilidad de que un paciente progrese a metástasis. Tercero, pueden mejorar la calidad de vida de los pacientes al permitir un enfoque más personalizado del tratamiento, basado en su riesgo individual de metástasis.</p>
<div id="fig-cancermama" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-cancermama-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="cancermet.jpg" class="img-fluid quarto-figure quarto-figure-center figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-cancermama-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;1: Incidencias generales del cáncer de mama invasivo y cáncer de mama metastásico en mujeres de 40 o más años en 9 sitios del programa Surveillance, Epidemiology, and End Results (SEER) durante el período de 1975 a 2012.
</figcaption>
</figure>
</div>
<section id="objetivos" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="objetivos"><span class="header-section-number">1.1</span> Objetivos</h2>
<p>El principal objetivo de este estudio es obtener un modelo ajustado al conjunto de datos de Metástasis de Cáncer de Mama para poder realizar predicciones efectivas sobre el estado PCR de un paciente dada una serie de variables o características sobre este. Consecuentemente, nace de manera natural un segundo objetivo principal, y es el de la determinación de las características más importantes para la determinación del estado del paciente, es decir, la realización de una <em>selección de características</em>. Todo esto se realizará con la finalidad de poner un modelo en producción, el cual pueda ser usado a través de la interfaz <code>RShiny</code> para la predicción efectiva del estado PCR de un paciente de Cáncer de Mama.</p>
<p>Objetivos secundarios de este proyecto incluyen el estudio de la estabilidad en la selección de características a lo largo de los diferentes métodos y modelos aplicados. Se realizará también una exploración de la estabilidad de los hiperparámetros de un mismo modelo a lo largo de diferentes semillas aleatorias establecidas.</p>
<table class="table">
<colgroup>
<col style="width: 80%">
<col style="width: 19%">
</colgroup>
<thead>
<tr class="header">
<th>Objetivo</th>
<th>Tipo</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Obtener un modelo ajustado al conjunto de datos de Metástasis de Cáncer de Mama</td>
<td>Principal</td>
</tr>
<tr class="even">
<td>Determinación de características más importantes en la predicción del estado PCR del paciente</td>
<td>Principal</td>
</tr>
<tr class="odd">
<td>Poner un modelo en producción, accesible a través de la interfaz <code>RShiny</code></td>
<td>Principal</td>
</tr>
<tr class="even">
<td>Estudiar la estabilidad en las características seleccionadas</td>
<td>Secundario</td>
</tr>
<tr class="odd">
<td>Explorar la estabilidad de los hiperparámetros de un mismo modelo a lo largo de diferentes semillas aleatorias establecidas.</td>
<td>Secundario</td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="metodología" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Metodología</h1>
<p>A lo largo del desarrollo de este proyecto se han utilizado una serie de datos y se han seguido unas directrices ordenadas. Todo esto queda redactado en este apartado.</p>
<section id="material" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="material"><span class="header-section-number">2.1</span> Material</h2>
<section id="conjunto-de-datos-inicial" class="level3" data-number="2.1.1">
<h3 data-number="2.1.1" class="anchored" data-anchor-id="conjunto-de-datos-inicial"><span class="header-section-number">2.1.1</span> Conjunto de Datos Inicial</h3>
<p>Se nos ha proporcionado un fichero en formato <em>Comma-Separated Values</em> (<code>.csv</code>) gracias al trabajo del Dr.&nbsp;José Manuel Jérez Aragonés. Las características de este dataset quedan descritas en la <a href="#fig-desccol" class="quarto-xref">Figura&nbsp;2</a>.</p>
<div id="fig-desccol" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-desccol-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Variables.png" class="img-fluid quarto-figure quarto-figure-center figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-desccol-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;2: Variables Originales del Conjunto
</figcaption>
</figure>
</div>
<p>Se puede identificar la variable <strong>PCR</strong> como la variable <em>target</em> u objetivo de este estudio. Consecuentemente, se ha decidido eliminar la variable <code>Muestra</code>, ya que no parece guardar una relevancia clínica, al ser un identificador único para cada paciente, compuesto por un código identificativo del estudio en el que fue obtenido el dato, y una serie de números únicos para cada persona.</p>
</section>
<section id="pre-procesamiento" class="level3" data-number="2.1.2">
<h3 data-number="2.1.2" class="anchored" data-anchor-id="pre-procesamiento"><span class="header-section-number">2.1.2</span> Pre-Procesamiento</h3>
<p>El conjunto de datos del que se hará uso fue curado en un estudio anterior a este, habiéndose imputado los valores faltantes (<code>NA</code>) por la mediana o la moda, si estos provenían de una característica numérica, o de tipo factor, respectivamente <span class="citation" data-cites="gonzalez2024predictive">(<a href="#ref-gonzalez2024predictive" role="doc-biblioref">González 2024</a>)</span>.</p>
<p>Por otra parte, para asegurar que se tiene total control sobre los datos con los que se introducen al modelo, se han creado dos versiones del conjunto de datos. La primera se trata de una versión en la que todas las variables son de tipo factor, y la variable edad ha sido estratificada en diferentes intervalos. Por otra parte, se ha generado un conjunto de datos numérico, el cual es el conjunto de datos de tipo factor codificado mediante técnicas como <em>One-Hot Encoder</em>, o manteniendo las variables con su mismo tipo, si estas eran numéricas originalmente. Se comentan a continuación las modificaciones específicas.</p>
<section id="conjunto-de-datos-factor" class="level4" data-number="2.1.2.1">
<h4 data-number="2.1.2.1" class="anchored" data-anchor-id="conjunto-de-datos-factor"><span class="header-section-number">2.1.2.1</span> Conjunto de Datos Factor</h4>
<p>Este conjunto de datos existe para asegurar la interpretabilidad de los resultados de los modelos. La única variable que puede suponer un problema es la variable <code>Edad</code>, ya que es una variable continua, sin embargo, este problema, como se ha comentado anteriormente, se resolverá estratificándola. La anchura de los bins se calculará siguiendo la regla de Sturges, en la que se toma el logaritmo en base 2 de la cantidad de muestras y el rango de la variable para poder computar la anchura más adecuada.</p>
<p><span class="math display">
k = \frac{max(Edad) - min(Edad)}{\log_2(n) + 1}
</span></p>
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convertir la variable 'Edad' a numérica</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>data_original<span class="sc">$</span>Edad <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(data_original<span class="sc">$</span>Edad)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>data_factor <span class="ot">&lt;-</span> data_original</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculando el número de bins con la regla de Sturges</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">nrow</span>(data_factor)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>k <span class="ot">&lt;-</span> <span class="fu">ceiling</span>(<span class="fu">log2</span>(n) <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculando el rango y el tamaño de cada bin</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>minimo <span class="ot">&lt;-</span> <span class="fu">min</span>(data_factor<span class="sc">$</span>Edad)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>maximo <span class="ot">&lt;-</span> <span class="fu">max</span>(data_factor<span class="sc">$</span>Edad)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>ancho_bin <span class="ot">&lt;-</span> (maximo <span class="sc">-</span> minimo) <span class="sc">/</span> k</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Estratificar la variable 'Edad' en grupos</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>data_factor<span class="sc">$</span>Edad_estratificada <span class="ot">&lt;-</span> <span class="fu">cut</span>(data_factor<span class="sc">$</span>Edad, </span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="fu">min</span>(data_factor<span class="sc">$</span>Edad), <span class="fu">max</span>(data_factor<span class="sc">$</span>Edad), <span class="at">by =</span> ancho_bin), </span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">include.lowest =</span> <span class="cn">TRUE</span>, <span class="at">right =</span> <span class="cn">FALSE</span>)</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Asignar nombres de grupo a los niveles de Edad_estratificada</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(data_factor<span class="sc">$</span>Edad_estratificada) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"Grupo"</span>, <span class="fu">seq_along</span>(<span class="fu">levels</span>(data_factor<span class="sc">$</span>Edad_estratificada)))</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Convertir todas las variables del dataframe a factor, excepto 'Edad'</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>data_factor <span class="ot">&lt;-</span> data_factor <span class="sc">%&gt;%</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_at</span>(<span class="fu">vars</span>(<span class="sc">-</span>Edad), as.factor)</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Actualizar la variable Edad con los grupos</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>data_factor<span class="sc">$</span>Edad <span class="ot">&lt;-</span> data_factor<span class="sc">$</span>Edad_estratificada</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>data_factor<span class="sc">$</span>Edad_estratificada <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="fu">head</span>(data_factor, <span class="dv">10</span>))</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">Edad</th>
<th style="text-align: left;">REst</th>
<th style="text-align: left;">RPro</th>
<th style="text-align: left;">Her2</th>
<th style="text-align: left;">Estadio</th>
<th style="text-align: left;">NodAfec</th>
<th style="text-align: left;">Grado</th>
<th style="text-align: left;">Fenotipo</th>
<th style="text-align: left;">PCR</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Grupo3</td>
<td style="text-align: left;">P</td>
<td style="text-align: left;">P</td>
<td style="text-align: left;">N</td>
<td style="text-align: left;">T2</td>
<td style="text-align: left;">N1</td>
<td style="text-align: left;">II</td>
<td style="text-align: left;">LumA</td>
<td style="text-align: left;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">Grupo5</td>
<td style="text-align: left;">P</td>
<td style="text-align: left;">P</td>
<td style="text-align: left;">N</td>
<td style="text-align: left;">T3</td>
<td style="text-align: left;">N1</td>
<td style="text-align: left;">II</td>
<td style="text-align: left;">Normal</td>
<td style="text-align: left;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Grupo4</td>
<td style="text-align: left;">N</td>
<td style="text-align: left;">N</td>
<td style="text-align: left;">N</td>
<td style="text-align: left;">T3</td>
<td style="text-align: left;">N0</td>
<td style="text-align: left;">III</td>
<td style="text-align: left;">Basal</td>
<td style="text-align: left;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">Grupo4</td>
<td style="text-align: left;">N</td>
<td style="text-align: left;">N</td>
<td style="text-align: left;">N</td>
<td style="text-align: left;">T2</td>
<td style="text-align: left;">N1</td>
<td style="text-align: left;">III</td>
<td style="text-align: left;">Basal</td>
<td style="text-align: left;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Grupo3</td>
<td style="text-align: left;">P</td>
<td style="text-align: left;">P</td>
<td style="text-align: left;">N</td>
<td style="text-align: left;">T3</td>
<td style="text-align: left;">N1</td>
<td style="text-align: left;">II</td>
<td style="text-align: left;">LumA</td>
<td style="text-align: left;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">Grupo6</td>
<td style="text-align: left;">N</td>
<td style="text-align: left;">N</td>
<td style="text-align: left;">N</td>
<td style="text-align: left;">T4</td>
<td style="text-align: left;">N0</td>
<td style="text-align: left;">III</td>
<td style="text-align: left;">Basal</td>
<td style="text-align: left;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Grupo3</td>
<td style="text-align: left;">N</td>
<td style="text-align: left;">N</td>
<td style="text-align: left;">N</td>
<td style="text-align: left;">T2</td>
<td style="text-align: left;">N0</td>
<td style="text-align: left;">III</td>
<td style="text-align: left;">Basal</td>
<td style="text-align: left;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">Grupo6</td>
<td style="text-align: left;">P</td>
<td style="text-align: left;">N</td>
<td style="text-align: left;">N</td>
<td style="text-align: left;">T3</td>
<td style="text-align: left;">N1</td>
<td style="text-align: left;">III</td>
<td style="text-align: left;">LumA</td>
<td style="text-align: left;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Grupo5</td>
<td style="text-align: left;">N</td>
<td style="text-align: left;">N</td>
<td style="text-align: left;">N</td>
<td style="text-align: left;">T3</td>
<td style="text-align: left;">N3</td>
<td style="text-align: left;">III</td>
<td style="text-align: left;">Basal</td>
<td style="text-align: left;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">Grupo4</td>
<td style="text-align: left;">P</td>
<td style="text-align: left;">P</td>
<td style="text-align: left;">P</td>
<td style="text-align: left;">T4</td>
<td style="text-align: left;">N3</td>
<td style="text-align: left;">II</td>
<td style="text-align: left;">LumA</td>
<td style="text-align: left;">0</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Esta estratificación se puede justificar con el hecho de que la interpretación de las predicciones del modelo puede ser más adecuada, ya que no estaríamos hablando de un valor concreto de edad que se repite a la hora de analizar los pacientes PCR-positivos, sino que tal vez se podría identificar una tendencia en los pacientes de un determinado rango de edad a sufrir una metástasis.</p>
<table class="table">
<thead>
<tr class="header">
<th>Grupo</th>
<th>Rango de Edad</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Grupo 1</td>
<td>[24,29.1)</td>
</tr>
<tr class="even">
<td>Grupo 2</td>
<td>[29.1,34.2)</td>
</tr>
<tr class="odd">
<td>Grupo 3</td>
<td>[34.2,39.3)</td>
</tr>
<tr class="even">
<td>Grupo 4</td>
<td>[39.3,44.4)</td>
</tr>
<tr class="odd">
<td>Grupo 5</td>
<td>[44.4,49.5)</td>
</tr>
<tr class="even">
<td>Grupo 6</td>
<td>[49.5,54.6)</td>
</tr>
<tr class="odd">
<td>Grupo 7</td>
<td>[54.6,59.7)</td>
</tr>
<tr class="even">
<td>Grupo 8</td>
<td>[59.7,64.8)</td>
</tr>
<tr class="odd">
<td>Grupo 9</td>
<td>[64.8,69.9)</td>
</tr>
<tr class="even">
<td>Grupo 10</td>
<td>[69.9,75)</td>
</tr>
</tbody>
</table>
</section>
<section id="conjunto-de-datos-numérico" class="level4" data-number="2.1.2.2">
<h4 data-number="2.1.2.2" class="anchored" data-anchor-id="conjunto-de-datos-numérico"><span class="header-section-number">2.1.2.2</span> Conjunto de Datos Numérico</h4>
<p>El paradigma de este estudio engloba la búsqueda del algoritmo de aprendizaje computacional que mejor prediga el estado PCR de un paciente no visto, todo desde un punto de vista de la Ingeniería. Debido a esta falta de conocimiento clínico, se ha decidido no asumir un orden de las variables factor a la hora de encontrar su codificación numérica (por ejemplo, se ha decidido no asumir que un valor de <code>Grado: II</code> es más importante o severo que un <code>Grado: I</code>). Es port esto que se ha decidido usar la función <code>dummyVars</code> para realizar una codificación <em>One-Hot</em> a las variables. Este conjunto de datos existe para poder tener siempre presente los datos numéricos que se pasan a los modelos de ML, así como para que se use en algunas implementaciones concretas, sin embargo, la regla será usar el conjunto <code>data_factor</code> como entrada.</p>
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generación del conjunto de datos numérico</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>encode_data <span class="ot">&lt;-</span> <span class="cf">function</span>(data, target_name) {</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Convertir variables categóricas sin orden en dummies</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  data <span class="ot">&lt;-</span> <span class="fu">dummyVars</span>(<span class="sc">~</span> ., <span class="at">data =</span> data, <span class="at">fullRank =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> <span class="fu">predict</span>(data) <span class="sc">%&gt;%</span> <span class="fu">as.data.frame</span>()</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Asegurar que la variable objetivo esté al final</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  target <span class="ot">&lt;-</span> data[[target_name]]</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  data[[target_name]] <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  data[[target_name]] <span class="ot">&lt;-</span> target</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(data)</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>data_numeric <span class="ot">&lt;-</span> <span class="fu">encode_data</span>(data_original, <span class="st">"PCR"</span>)</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="fu">head</span>(data_numeric, <span class="dv">10</span>))</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 5%">
<col style="width: 5%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 9%">
<col style="width: 2%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">Edad</th>
<th style="text-align: right;">REstP</th>
<th style="text-align: right;">RProP</th>
<th style="text-align: right;">Her2P</th>
<th style="text-align: right;">EstadioT2</th>
<th style="text-align: right;">EstadioT3</th>
<th style="text-align: right;">EstadioT4</th>
<th style="text-align: right;">NodAfecN1</th>
<th style="text-align: right;">NodAfecN2</th>
<th style="text-align: right;">NodAfecN3</th>
<th style="text-align: right;">GradoII</th>
<th style="text-align: right;">GradoIII</th>
<th style="text-align: right;">FenotipoHer2</th>
<th style="text-align: right;">FenotipoLumA</th>
<th style="text-align: right;">FenotipoLumB</th>
<th style="text-align: right;">FenotipoNormal</th>
<th style="text-align: right;">PCR</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">37.8</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">45.8</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">40.7</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">40.8</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">35.5</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">52.2</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">38.2</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">54.2</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">46.6</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">40.8</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="análisis-exploratorio" class="level4" data-number="2.1.2.3">
<h4 data-number="2.1.2.3" class="anchored" data-anchor-id="análisis-exploratorio"><span class="header-section-number">2.1.2.3</span> Análisis Exploratorio</h4>
<p>Se va a proceder a realizar un análisis de la distribución de los datos del conjunto <code>data_factor</code>. Este análisis pretende dar conclusiones sobre el sesgo y la varianza de los datos con la finalidad de tomar decisiones sobre la inclusión o deleción de variables del conjunto de datos.</p>
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>blue <span class="ot">=</span> <span class="st">'#377eb8'</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>red <span class="ot">=</span> <span class="st">'#e41a1c'</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>plot_variable_distribution <span class="ot">&lt;-</span> <span class="cf">function</span>(data, variable_name, target_name) {</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Comprobar si las variables existen en el data.frame</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span>(variable_name <span class="sc">%in%</span> <span class="fu">names</span>(data) <span class="sc">&amp;&amp;</span> target_name <span class="sc">%in%</span> <span class="fu">names</span>(data))) {</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"Una o ambas variables especificadas no existen en el data.frame proporcionado."</span>)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Extraer la variable y la variable target del data.frame</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>  variable <span class="ot">&lt;-</span> data[[variable_name]]</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>  target <span class="ot">&lt;-</span> data[[target_name]]</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Asegurar que la variable target es factor</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>  data[[target_name]] <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(data[[target_name]])</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Determinar si la variable principal es numérica o factor</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.numeric</span>(variable)) {</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Crear un histograma para variables numéricas</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>    p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(data, <span class="fu">aes_string</span>(<span class="at">x =</span> variable_name, <span class="at">fill =</span> target_name)) <span class="sc">+</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_histogram</span>(<span class="at">position =</span> <span class="st">"identity"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">bins =</span> <span class="dv">30</span>) <span class="sc">+</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"0"</span> <span class="ot">=</span> blue, <span class="st">"1"</span> <span class="ot">=</span> red)) <span class="sc">+</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ggtitle</span>(<span class="fu">paste</span>(<span class="st">"Distribución de"</span>, variable_name, <span class="st">"por"</span>, target_name)) <span class="sc">+</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>      <span class="fu">xlab</span>(variable_name) <span class="sc">+</span></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ylab</span>(<span class="st">"Frecuencia"</span>)</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (<span class="fu">is.factor</span>(variable)) {</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Crear un gráfico de barras para factores</span></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>    p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(data, <span class="fu">aes_string</span>(<span class="at">x =</span> variable_name, <span class="at">fill =</span> target_name)) <span class="sc">+</span></span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_bar</span>(<span class="at">position =</span> <span class="st">"stack"</span>) <span class="sc">+</span></span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"0"</span> <span class="ot">=</span> blue, <span class="st">"1"</span> <span class="ot">=</span> red)) <span class="sc">+</span></span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ggtitle</span>(<span class="fu">paste</span>(<span class="st">"Distribución de"</span>, variable_name, <span class="st">"por"</span>, target_name)) <span class="sc">+</span></span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>      <span class="fu">xlab</span>(variable_name) <span class="sc">+</span></span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ylab</span>(<span class="st">"Frecuencia"</span>) <span class="sc">+</span></span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"right"</span>)</span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"El tipo de la variable debe ser numérico o factor."</span>)</span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Imprimir el gráfico</span></span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(p)</span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true" href="">Edad</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false" href="">REst</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-3" role="tab" aria-controls="tabset-1-3" aria-selected="false" href="">RPro</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-4" role="tab" aria-controls="tabset-1-4" aria-selected="false" href="">Her2</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-5" role="tab" aria-controls="tabset-1-5" aria-selected="false" href="">Estadio</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-6-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-6" role="tab" aria-controls="tabset-1-6" aria-selected="false" href="">NodAfec</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-7-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-7" role="tab" aria-controls="tabset-1-7" aria-selected="false" href="">Grado</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-8-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-8" role="tab" aria-controls="tabset-1-8" aria-selected="false" href="">Fenotipo</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-9-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-9" role="tab" aria-controls="tabset-1-9" aria-selected="false" href="">PCR</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_variable_distribution</span>(data_factor, <span class="st">"Edad"</span>, <span class="st">"PCR"</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AlgoritmosApendizajeCancerMama_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Como se puede observar, la variable <code>Edad</code> parece seguir una distribución normal o gaussiana, en la que la mayor cantidad de los datos se encuentran en los grupos centrales. La mayoría de los datos están clasificados por PCR-Positivos (<code>PCR=1</code>), indicando un claro sesgo, sin embargo, se considera que hay suficientes datos en la variable como para mantenerla.</p>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_variable_distribution</span>(data_factor, <span class="st">"REst"</span>, <span class="st">"PCR"</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AlgoritmosApendizajeCancerMama_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>La variable <code>REst</code> muestra dos clases, para las cuales hay una diferencia de datos de, aproximadamente, 100 muestras. La clase <code>N</code> muestra un mayor equilibrio en cuanto a la relación de pacientes PCR-Positivos y PCR-Negativos que el valor <code>P</code>, para el cual, solo paroximadamente un sexto de los datos son PCR-Positivos.</p>
</div>
<div id="tabset-1-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-3-tab">
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_variable_distribution</span>(data_factor, <span class="st">"RPro"</span>, <span class="st">"PCR"</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AlgoritmosApendizajeCancerMama_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>La variable <code>RPro</code> muestra dos clases (<code>N</code> y <code>P</code>). Ambas clases tienen una distribución similar en términos de número de muestras totales. La clase <code>N</code> presenta una mayor proporción de pacientes PCR-Positivos (<code>PCR=1</code>) en comparación con la clase <code>P</code>.</p>
</div>
<div id="tabset-1-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-4-tab">
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_variable_distribution</span>(data_factor, <span class="st">"Her2"</span>, <span class="st">"PCR"</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AlgoritmosApendizajeCancerMama_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>La variable <code>Her2</code> muestra dos clases (<code>N</code> y <code>P</code>). La clase <code>N</code> tiene una distribución mucho mayor de muestras en comparación con la clase <code>P</code>. En la clase <code>N</code>, hay una cantidad significativa de pacientes PCR-Positivos (<code>PCR=1</code>), mientras que en la clase <code>P</code>, los datos son escasos, lo que puede dificultar análisis concluyentes, es por esto que se ha decidido <strong>eliminar la variable <code>Her2</code> de los conjuntos de datos</strong>.</p>
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>data_numeric<span class="sc">$</span>Her2P <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>data_factor<span class="sc">$</span>Her2 <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>data_original<span class="sc">$</span>Her2 <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(data_factor, <span class="at">file=</span><span class="st">"./data_factor.csv"</span>, <span class="at">row.names=</span><span class="cn">FALSE</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<div id="tabset-1-5" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-5-tab">
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_variable_distribution</span>(data_factor, <span class="st">"Estadio"</span>, <span class="st">"PCR"</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AlgoritmosApendizajeCancerMama_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>La variable <code>Estadio</code> presenta varias categorías (<code>T0-T1</code>, <code>T2</code>, <code>T3</code>, <code>T4</code>). La mayoría de las muestras se encuentran en la categoría <code>T2</code>, seguida de <code>T3</code>. Las categorías <code>T0-T1</code> y <code>T4</code> tienen menos muestras. En todas las categorías, los pacientes PCR-Negativos (<code>PCR=0</code>) son mayoría, pero la proporción de PCR-Positivos (<code>PCR=1</code>) varía entre las categorías, siendo notablemente menor en <code>T4</code>.</p>
</div>
<div id="tabset-1-6" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-6-tab">
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_variable_distribution</span>(data_factor, <span class="st">"NodAfec"</span>, <span class="st">"PCR"</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AlgoritmosApendizajeCancerMama_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>La variable <code>NodAfec</code> muestra varias categorías (<code>N0</code>, <code>N1</code>, <code>N2</code>, <code>N3</code>). La categoría <code>N1</code> tiene la mayor cantidad de muestras, seguida de <code>N0</code>, con <code>N2</code> y <code>N3</code> teniendo menos muestras. En todas las categorías, los pacientes PCR-Negativos (<code>PCR=0</code>) son mayoría. La proporción de PCR-Positivos (<code>PCR=1</code>) es relativamente constante en todas las categorías, aunque menor en comparación con los PCR-Negativos.</p>
</div>
<div id="tabset-1-7" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-7-tab">
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_variable_distribution</span>(data_factor, <span class="st">"Grado"</span>, <span class="st">"PCR"</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AlgoritmosApendizajeCancerMama_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>La variable <code>Grado</code> tiene tres niveles (<code>I</code>, <code>II</code>, <code>III</code>). El nivel <code>III</code> tiene la mayor cantidad de muestras, seguido por <code>II</code>. El nivel <code>I</code> tiene significativamente menos muestras. En los niveles <code>II</code> y <code>III</code>, hay una proporción considerable de pacientes PCR-Positivos (<code>PCR=1</code>), especialmente en <code>III</code>.</p>
</div>
<div id="tabset-1-8" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-8-tab">
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_variable_distribution</span>(data_factor, <span class="st">"Fenotipo"</span>, <span class="st">"PCR"</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AlgoritmosApendizajeCancerMama_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>La variable <code>Fenotipo</code> tiene varias categorías (<code>Basal</code>, <code>Her2</code>, <code>LumA</code>, <code>LumB</code>, <code>Normal</code>). La categoría <code>Basal</code> tiene la mayor cantidad de muestras, seguida de <code>LumA</code>. Las categorías <code>Her2</code>, <code>LumB</code> y <code>Normal</code> tienen menos muestras. En <code>Basal</code>, hay una proporción significativa de pacientes PCR-Positivos (<code>PCR=1</code>), mientras que en las otras categorías, la proporción es menor.</p>
</div>
<div id="tabset-1-9" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-9-tab">
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_variable_distribution</span>(data_factor, <span class="st">"PCR"</span>, <span class="st">"PCR"</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AlgoritmosApendizajeCancerMama_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>La variable <code>PCR</code> muestra la distribución de los pacientes en las dos clases (<code>0</code> y <code>1</code>). La mayoría de las muestras son PCR-Negativos (<code>PCR=0</code>), con una menor proporción de PCR-Positivos (<code>PCR=1</code>). Esta distribución sugiere un sesgo hacia los resultados negativos, lo cual se tendrá en cuenta en los análisis posteriores.</p>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="métodos" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="métodos"><span class="header-section-number">2.2</span> Métodos</h2>
<p>Todos los objetivos de este proyecto quedarían anulados si no se sigue una metodología estricta, basada en la <em>estimación honesta de parámetros</em> y la rigurosidad para la evaluación del rendimiento de los modelos mediante la selección de una métrica que sea capaz de cuantificar la capacidad predictiva del modelo <em>independientemente del umbral</em> seleccionado para clasificar las muestras -ya que este depende de las necesidades específicas del equipo sanitario. Esta sección sirve como guía para mostrar cuál ha sido esta metodología adoptada, y así demostrar su eficacia y seguridad.</p>
<section id="auc-y-rendimiento-aparente" class="level3" data-number="2.2.1">
<h3 data-number="2.2.1" class="anchored" data-anchor-id="auc-y-rendimiento-aparente"><span class="header-section-number">2.2.1</span> AUC y Rendimiento Aparente</h3>
<p>Para poder estimar el rendimiento cualitativo de un modelo, se necesita tanto una métrica cuantificable que refleje efectivamente su capacidad predictiva, como un valor base (<em>ground truth</em>) con el que comparar. En este estudio se ha decidido utilizar el <strong>AUC (Area Under the Curve)</strong> como métrica representativa del rendimiento de un modelo, porque es una medida independiente del umbral utilizado para clasificar probabilidades calculadas por el modelo, esto es una característica decisiva, ya que, como se comentó anteriormente, el umbral podrá ser decidido por el clínico cuando el modelo sea puesto en producción, para que se ajuste a sus necesidades. Al utilizar el AUC como medida, podremos dar una estimación independiente del umbral a los clínicos, indicando que, elijan el umbral que elijan, el modelo rendirá de una manera preestablecida.</p>
<p>Por otra parte, se ha apostado por tomar el rendimiento aparente del modelo como la métrica base de comparación para un mismo modelo. El rendimiento aparente se calcula mediante el entrenamiento y evaluación del modelo con todo el conjunto de datos, obteniendo una estimación optimista de la capacidad predictiva del modelo, al ser evaluado con los datos que fue entrenado. Una característica que debe quedar clara es la de que esta métrica solo servirá para comparar diferentes métodos de selección de variables, búsqueda de hiperparámetros, o ajuste fino, de un <strong>mismo modelo</strong>, no entre modelos. Para realizar una comparación entre modelos se hará uso de la estimación honesta de parámetros, es decir, la <em>doble validación cruzada 5x2</em>.</p>
</section>
<section id="ajuste-fino-doble-validación-cruzada-5x2" class="level3" data-number="2.2.2">
<h3 data-number="2.2.2" class="anchored" data-anchor-id="ajuste-fino-doble-validación-cruzada-5x2"><span class="header-section-number">2.2.2</span> Ajuste Fino: Doble Validación Cruzada 5x2</h3>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="2CV.png" class="img-fluid figure-img"></p>
<figcaption>Doble Validación Cruzada</figcaption>
</figure>
</div>
<p>El método de doble validación cruzada 5x2 es una técnica robusta para la evaluación de modelos que busca obtener una estimación honesta del rendimiento predictivo de un modelo. Este método se basa en una estructura jerárquica de validación cruzada, compuesta por dos niveles conocidos como <em>inner loop</em> y <em>outer loop</em>.</p>
<section id="outer-loop" class="level4" data-number="2.2.2.1">
<h4 data-number="2.2.2.1" class="anchored" data-anchor-id="outer-loop"><span class="header-section-number">2.2.2.1</span> Outer Loop</h4>
<p>El <em>outer loop</em> se encarga de la evaluación externa del modelo y se basa en la división del conjunto de datos original en 5 pliegues. En cada iteración, uno de estos pliegues se reserva como conjunto de test, mientras que los cuatro pliegues restantes se utilizan para el entrenamiento del modelo. Este proceso se repite cinco veces, de manera que cada pliegue se utiliza una vez como conjunto de test. Es crucial destacar que en el <em>outer loop</em> no se permite ajustar parámetros ni realizar selección de variables utilizando el conjunto de test, garantizando así una evaluación imparcial y honesta del modelo.</p>
</section>
<section id="inner-loop" class="level4" data-number="2.2.2.2">
<h4 data-number="2.2.2.2" class="anchored" data-anchor-id="inner-loop"><span class="header-section-number">2.2.2.2</span> Inner Loop</h4>
<p>Dentro de cada iteración del <em>outer loop</em>, se implementa el <em>inner loop</em>, cuyo objetivo es el ajuste fino de los hiperparámetros del modelo y la selección de las variables más relevantes. El <em>inner loop</em> utiliza una nueva división del conjunto de entrenamiento en pliegues adicionales. Generalmente, se opta por una validación cruzada más sencilla dentro de este bucle interno. Aquí, uno de los pliegues del conjunto de entrenamiento actúa como validación, mientras que los restantes se utilizan para el ajuste del modelo. Este proceso se repite varias veces para identificar la <strong>combinación óptima de hiperparámetros y características que maximicen el rendimiento predictivo en el conjunto de validación</strong>.</p>
<p>Para cada modelo, <strong>se han acotado los valores de los hiperparámetros qu e formarán parte de la malla mediante pruebas con la doble validación cruzada y todas las variables</strong>. Este enfoque ha decidido adoptarse para reducir la cantidad de hiperparámetros a probar durante el bucle interno con la finalidad de reducir el tiempo de cómputo del estudio.</p>
</section>
<section id="evaluación-final" class="level4" data-number="2.2.2.3">
<h4 data-number="2.2.2.3" class="anchored" data-anchor-id="evaluación-final"><span class="header-section-number">2.2.2.3</span> Evaluación Final</h4>
<p>Una vez completado el ajuste en el <em>inner loop</em>, se evalúa el modelo ajustado en el conjunto de test reservado en el <em>outer loop</em>. Este enfoque jerárquico asegura que el ajuste de los hiperparámetros y la selección de variables no influyan en la evaluación final del rendimiento del modelo. El rendimiento se cuantifica mediante métricas como el AUC (Área Bajo la Curva), proporcionando una estimación promedio del rendimiento del modelo a lo largo de las iteraciones del <em>outer loop</em>. Este método de doble validación cruzada 5x2 ofrece una estimación más confiable y menos optimista del rendimiento del modelo, adecuada para su implementación en escenarios clínicos donde la precisión es crucial.</p>
</section>
</section>
<section id="selección-de-características" class="level3" data-number="2.2.3">
<h3 data-number="2.2.3" class="anchored" data-anchor-id="selección-de-características"><span class="header-section-number">2.2.3</span> Selección de Características</h3>
<p>La selección de características es un paso fundamental en la construcción de modelos predictivos, ya que permite identificar las variables más relevantes para el problema en cuestión. Este proceso no solo mejora la <em>interpretabilidad del modelo</em>, cosa que permite a los investigadores y clínicos entender mejor qué variables están influyendo en las predicciones del modelo, sino que también reduce significativamente el tiempo computacional y el riesgo de sobreajuste, proporcionando un modelo más eficiente y robusto.</p>
<section id="metodología-de-selección-de-características" class="level4" data-number="2.2.3.1">
<h4 data-number="2.2.3.1" class="anchored" data-anchor-id="metodología-de-selección-de-características"><span class="header-section-number">2.2.3.1</span> Metodología de Selección de Características</h4>
<p>En este estudio, se han realizado cuatro esquemas de selección de características por cada ciclo de doble validación cruzada 5x2 (2CV 5X2). Estos esquemas incluyen tanto métodos de filtrado, como métodos <em>wrapped</em>, y métodos <em>embedded</em>, proporcionando una perspectiva completa sobre las variables más relevantes.</p>
<ol type="1">
<li><p><strong>Todas las Variables del Conjunto</strong>: En este enfoque, se entrena el modelo utilizando todas las variables disponibles en el conjunto de datos, sin realizar ningún tipo de selección previa. Esto sirve como una línea base para comparar la efectividad de los métodos de selección de características.</p></li>
<li><p><strong>Métodos de Filtrado: Análisis de Asociación</strong>: Este método de filtrado se basa en el análisis de asociación, donde se evalúa la relación individual de cada variable con la variable objetivo. Se seleccionan aquellas variables que muestran una fuerte asociación, lo que permite reducir el conjunto de características antes del entrenamiento del modelo. Para poder realizar este análisis de asociación se inspeccionará el mapa de calor proporcionado por la función <code>plot_p_valores</code>. Como se puede observar, las variables seleccionadas son <code>Estadio</code>, <code>Fenotipo</code>, <code>Grado</code>, <code>REst</code> y <code>RPro</code>. Por lo que estas variables constituirán el vector de características <code>asociacion</code>, usado para la ejecución de los métodos de filtrado en los modelos.</p></li>
</ol>
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"./aux_scripts/calculaPValor.R"</span>)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>plot <span class="ot">&lt;-</span> <span class="fu">plot_p_valores</span>(data_factor)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(plot)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AlgoritmosApendizajeCancerMama_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Se construye el vector de variables factor y numéricas asociación a partir de los resultados del análisis</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>todas_variables_factor <span class="ot">&lt;-</span> <span class="fu">colnames</span>(data_factor)[<span class="sc">!</span><span class="fu">colnames</span>(data_factor) <span class="sc">%in%</span> <span class="st">"PCR"</span>]</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>todas_variables_numeric <span class="ot">&lt;-</span> <span class="fu">colnames</span>(data_numeric)[<span class="sc">!</span><span class="fu">colnames</span>(data_numeric) <span class="sc">%in%</span> <span class="st">"PCR"</span>]</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>select_associated_variables <span class="ot">&lt;-</span> <span class="cf">function</span>(asociacion, total_variables_numeric) {</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>  selected_variables <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (assoc <span class="cf">in</span> asociacion) {</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Buscar variables que contengan el nombre en asociacion</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    matching_vars <span class="ot">&lt;-</span> total_variables_numeric[<span class="fu">grepl</span>(assoc, total_variables_numeric)]</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>    selected_variables <span class="ot">&lt;-</span> <span class="fu">c</span>(selected_variables, matching_vars)</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(selected_variables)</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>asociacion <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Estadio"</span>, <span class="st">"Fenotipo"</span>, <span class="st">"Grado"</span>, <span class="st">"REst"</span>, <span class="st">"RPro"</span>)</span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>asociacion_numeric <span class="ot">&lt;-</span> <span class="fu">select_associated_variables</span>(asociacion, todas_variables_numeric)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ol start="3" type="1">
<li><p><strong>Métodos Wrapped: StepAUC Backwards</strong>: En este método, se comienza con todas las variables incluidas en el modelo. Durante el proceso de entrenamiento en el <em>inner loop</em>, se prueban eliminando variables una por una. <strong>En profundidad</strong>, para cada iteración del proceso, se construyen múltiples modelos predictivos con diferentes combinaciones de variables. El objetivo es identificar el subconjunto de variables que maximiza el rendimiento del modelo según el AUC. En el método wrapper <em>backwards</em>, se comienza con el conjunto completo de variables y se eliminan iterativamente variables que no aportan significativamente al rendimiento del modelo. En cada iteración, se construyen múltiples modelos predictivos con diferentes combinaciones de variables, evaluando el impacto de eliminar cada variable en el rendimiento del modelo. El proceso de eliminación de variables funciona de la siguiente manera:</p>
<ol type="1">
<li>Inicialización: Se comienza con todas las variables disponibles en el conjunto de datos.</li>
<li>Iteración: Para cada variable en el conjunto actual de variables, se elimina una variable a la vez y se entrena un modelo con las variables restantes.</li>
<li>Evaluación: Se evalúa el rendimiento del modelo utilizando una métrica predefinida, como el AUC (Área Bajo la Curva ROC), a través de validación cruzada interna.</li>
<li>Comparación: Si la eliminación de una variable mejora el rendimiento del modelo (es decir, el AUC aumenta), esta variable se elimina permanentemente del conjunto de variables.</li>
<li>Repetición: Este proceso se repite iterativamente, eliminando una variable a la vez y evaluando el impacto en el rendimiento del modelo, hasta que ya no se observen mejoras significativas en la métrica de rendimiento.</li>
</ol></li>
<li><p><strong>Métodos de Embedded: Modelo Lasso</strong>: El modelo Lasso es un método de regularización que no solo ajusta el modelo, sino que también selecciona automáticamente las variables más importantes. <strong>En profundidad</strong>, el algoritmo programado implementa un proceso de doble validación cruzada para la selección de hiperparámetros y variables en modelos predictivos. Durante la validación cruzada interna, se aplica la selección de variables mediante Lasso (<em>Least Absolute Shrinkage and Selection Operator</em>), que ayuda a identificar y eliminar variables menos relevantes, reduciendo así la dimensionalidad del modelo y mejorando potencialmente su rendimiento. Para cada combinación de hiperparámetros, Lasso selecciona un subconjunto óptimo de variables, y el modelo se entrena y evalúa con este subconjunto. Si una combinación particular de hiperparámetros y variables seleccionadas mejora la métrica de rendimiento (AUC), se guarda como la mejor configuración encontrada. Este proceso iterativo continúa hasta que no se encuentran mejoras adicionales. Finalmente, el mejor modelo y sus hiperparámetros seleccionados se evalúan en el conjunto de prueba reservado por el bucle externo, proporcionando una estimación robusta y honesta del rendimiento del modelo en datos no vistos.</p></li>
</ol>
</section>
</section>
<section id="modelos-aplicados" class="level3" data-number="2.2.4">
<h3 data-number="2.2.4" class="anchored" data-anchor-id="modelos-aplicados"><span class="header-section-number">2.2.4</span> Modelos Aplicados</h3>
<p>Con el objetivo de conseguir un modelo ajustado para la predicción efectiva del estado PCR de un paciente en mente, se han seleccionado una serie de algoritmos de Aprendizaje Máquina (<em>Machine Learning</em>, ML) con varios parámetros de customización. Estos modelos se eligen por su capacidad de manejar diferentes tipos de datos y su rendimiento en tareas de clasificación, proporcionando así una evaluación completa y robusta para el problema en cuestión.</p>
<section id="naive-bayes" class="level4" data-number="2.2.4.1">
<h4 data-number="2.2.4.1" class="anchored" data-anchor-id="naive-bayes"><span class="header-section-number">2.2.4.1</span> Naive Bayes</h4>
<p>Naive Bayes es un clasificador probabilístico basado en el teorema de Bayes, asumiendo una independencia condicional entre las características dadas la clase. En este estudio, se ha utilizado la implementación proporcionada en el paquete <code>e1071</code>. Formalmente, el clasificador Naive Bayes asigna una clase <span class="math inline">C_k</span> a una instancia <span class="math inline">x = (x_1, x_2, \ldots, x_n)</span> maximizando la probabilidad posterior <span class="math inline">P(C_k|x)</span>, que se calcula como:</p>
<p><span class="math display"> P(C_k|x) = \frac{P(C_k) \cdot P(x|C_k)}{P(x)}</span></p>
<p>Dado que <span class="math inline">P(x)</span> es constante para todas las clases, se simplifica a:</p>
<p><span class="math display"> P(C_k|x) \propto P(C_k) \prod_{i=1}^{n} P(x_i|C_k) </span></p>
<p>En resumen, el clasificador Naive Bayes es una opción eficiente y efectiva para problemas de clasificación, sin embargo, al <strong>asumir la independencia de las probabilidades condicionales</strong>, puede no dar resultados muy buenos, sin embargo, proporcionará una base sólida para predicciones iniciales, así como una base para la comparación entre modelos.</p>
</section>
<section id="adaboost" class="level4" data-number="2.2.4.2">
<h4 data-number="2.2.4.2" class="anchored" data-anchor-id="adaboost"><span class="header-section-number">2.2.4.2</span> Adaboost</h4>
<p>Adaboost, o Adaptive Boosting, es un algoritmo de aprendizaje automático que combina múltiples clasificadores débiles para crear un clasificador fuerte. En este estudio, se ha utilizado el paquete <code>mboost</code> de R con la configuración <code>family=Binomial()</code>, adaptado para tareas de clasificación binaria. Adaboost trabaja iterativamente, ajustando los pesos de las muestras de entrenamiento para concentrarse en aquellas que fueron clasificadas incorrectamente en iteraciones anteriores.</p>
<p>De esta forma, Adaboost asigna pesos a cada muestra y ajusta un clasificador débil <span class="math inline">h_t(x)</span> en cada iteración <span class="math inline">t</span>. La salida final del clasificador se obtiene mediante una combinación ponderada de estos clasificadores débiles:</p>
<p><span class="math display"> H(x) = \text{sign}\left( \sum_{t=1}^{T} \alpha_t h_t(x) \right) </span></p>
<p>donde <span class="math inline">\alpha_t</span> es el peso asignado al clasificador <span class="math inline">h_t(x)</span> basado en su precisión. En cada iteración, el peso de las muestras mal clasificadas se incrementa, enfocando así el entrenamiento subsecuente en estas muestras.</p>
<p>El principal hiperparámetro ajustado en este estudio ha sido el número de iteraciones <span class="math inline">T</span>. Este parámetro determina cuántos clasificadores débiles se combinarán para formar el clasificador final. Aumentar el número de iteraciones puede mejorar la capacidad del modelo para corregir errores y, por ende, afinar la frontera de decisión, pero también aumenta el riesgo de sobreajuste si el modelo se vuelve demasiado complejo.</p>
</section>
<section id="árboles-de-decisión" class="level4" data-number="2.2.4.3">
<h4 data-number="2.2.4.3" class="anchored" data-anchor-id="árboles-de-decisión"><span class="header-section-number">2.2.4.3</span> Árboles de Decisión</h4>
<p>Un árbol de decisión divide iterativamente el conjunto de datos en subconjuntos más pequeños utilizando una serie de reglas de decisión basadas en las características del conjunto de datos. Cada división se realiza en un nodo del árbol y produce ramas que representan los posibles valores de las características, conduciendo a hojas que representan las predicciones finales. El objetivo es crear un modelo que prediga el valor de la variable objetivo aprendiendo reglas de decisión simples inferidas de los datos. En este estudio, se ha implementado este algoritmo utilizando el paquete <code>rpart</code> de R.</p>
<p>Los principales hiperparámetros ajustados en este estudio han sido:</p>
<ul>
<li><p><strong><code>cp_values</code> (complexity parameter)</strong>: Este parámetro controla la poda del árbol de decisión. La poda es un proceso que elimina ramas del árbol que tienen poca importancia, con el fin de reducir su complejidad y prevenir el sobreajuste. Un valor más alto de <code>cp</code> resulta en una mayor poda, lo que produce un árbol más simple. Ajustar este parámetro afecta directamente la profundidad del árbol y su capacidad para capturar patrones en los datos. Seleccionar un <code>cp</code> óptimo es esencial para equilibrar el sesgo (si <code>cp</code> es muy alto) y la varianza (si <code>cp</code> es muy bajo).</p></li>
<li><p><strong><code>minsplit_values</code></strong>: Este parámetro define el número mínimo de observaciones que un nodo debe tener para ser considerado para una división. Valores más altos de <code>minsplit</code> resultan en árboles más pequeños y menos detallados, ya que se requieren más observaciones para realizar una división. Por otro lado, valores más bajos permiten una mayor cantidad de divisiones, resultando en árboles más complejos. Ajustar <code>minsplit</code> permite controlar la granularidad de las divisiones en el árbol, asegurando que el modelo capture los patrones relevantes sin sobreajustarse a los datos de entrenamiento.</p></li>
</ul>
</section>
<section id="random-forest" class="level4" data-number="2.2.4.4">
<h4 data-number="2.2.4.4" class="anchored" data-anchor-id="random-forest"><span class="header-section-number">2.2.4.4</span> Random Forest</h4>
<p>Random Forest opera creando una colección de árboles de decisión, cada uno entrenado con un subconjunto aleatorio del conjunto de datos y un subconjunto aleatorio de características. Este enfoque introduce dos tipos de aleatoriedad: aleatoriedad en las muestras y aleatoriedad en las características, lo que ayuda a reducir la varianza del modelo y mitigar el sobreajuste.En este estudio, se ha utilizado el paquete <code>randomForest</code> de R.</p>
<p>Los principales hiperparámetros ajustados en este estudio han sido:</p>
<ul>
<li><p><strong>ntree_values</strong>: Este parámetro define el número de árboles en el bosque. Un mayor número de árboles generalmente mejora la precisión del modelo, ya que la predicción final se basa en la agregación de un mayor número de árboles, reduciendo así la varianza. Sin embargo, un número muy alto de árboles puede aumentar el tiempo de entrenamiento sin proporcionar mejoras significativas en el rendimiento. Ajustar el valor de <code>ntree</code> permite encontrar un equilibrio entre la precisión y la eficiencia computacional del modelo.</p></li>
<li><p><strong>mtry_values</strong>: Este parámetro controla el número de características que se consideran para cada división en los árboles de decisión. Un valor más bajo de <code>mtry</code> puede reducir el riesgo de sobreajuste, ya que introduce más variabilidad entre los árboles individuales. Un valor más alto permite que cada árbol considere más características en cada división, lo que puede mejorar la precisión del modelo si las características adicionales son informativas. Ajustar <code>mtry</code> permite optimizar la capacidad del modelo para capturar las relaciones relevantes en los datos sin sobreajustarse.</p></li>
</ul>
<p>En resumen, Random Forest es un potente algoritmo de clasificación que combina las predicciones de múltiples árboles de decisión para mejorar la precisión y la robustez del modelo. La cuidadosa selección de los parámetros <code>ntree_values</code> y <code>mtry_values</code> asegura un modelo equilibrado que generaliza bien en nuevos datos, proporcionando predicciones fiables del estado PCR de los pacientes.</p>
</section>
<section id="k-nearest-neighbours" class="level4" data-number="2.2.4.5">
<h4 data-number="2.2.4.5" class="anchored" data-anchor-id="k-nearest-neighbours"><span class="header-section-number">2.2.4.5</span> K-Nearest Neighbours</h4>
<p>K-Nearest Neighbours (KNN) clasifica una muestra basada en las clases de sus <span class="math inline">k</span> vecinos más cercanos en el espacio de características. En este estudio, se ha utilizado el paquete <code>class</code> de R para implementar KNN.</p>
<p>KNN clasifica una muestra <span class="math inline">x</span> basándose en la mayoría de las clases de sus <span class="math inline">k</span> vecinos más cercanos, identificados utilizando una métrica de distancia. La distancia entre las muestras se calcula comúnmente usando la distancia euclidiana, pero se puede generalizar utilizando la distancia de Minkowski, definida como:</p>
<p><span class="math display"> d(x_i, x_j) = \left( \sum_{m=1}^{M} |x_{im} - x_{jm}|^l \right)^{1/l} </span></p>
<p>donde <span class="math inline">l</span> es el parámetro de distancia de Minkowski. Cuando <span class="math inline">l = 2</span>, se corresponde con la distancia euclidiana, y cuando <span class="math inline">l = 1</span>, se convierte en la distancia de Manhattan.</p>
<p>Los principales hiperparámetros ajustados en este estudio son:</p>
<ul>
<li><p><strong><span class="math inline">k</span> (número de vecinos más cercanos)</strong>: Este parámetro define el número de vecinos que se considerarán para determinar la clase de una nueva muestra. Valores pequeños de <span class="math inline">k</span> hacen que el modelo sea más sensible al ruido en los datos, mientras que valores grandes pueden hacer que el modelo sea demasiado general y pierda precisión en detalles locales.</p></li>
<li><p><strong><span class="math inline">l</span> (parámetro de distancia de Minkowski)</strong>: Este parámetro ajusta la métrica de distancia utilizada para identificar los vecinos más cercanos. Aunque el valor predeterminado es <span class="math inline">l = 2</span> (distancia euclidiana), ajustar <span class="math inline">l</span> permite al modelo adaptarse mejor a la geometría del espacio de características. Por ejemplo, un <span class="math inline">l</span> menor puede capturar mejor las relaciones lineales, mientras que un <span class="math inline">l</span> mayor puede ser más adecuado para relaciones más complejas y no lineales.</p></li>
</ul>
<p>Además, el parámetro <code>probes = TRUE</code> se utiliza para devolver las probabilidades de las clases predichas, proporcionando una medida de confianza en las predicciones del modelo.</p>
<p>En resumen, KNN es un algoritmo intuitivo y efectivo para la clasificación, especialmente adecuado para conjuntos de datos donde la estructura local de las muestras es crucial para la precisión de las predicciones. Ajustar los parámetros <span class="math inline">k</span> y <span class="math inline">l</span> permite optimizar el modelo para capturar las relaciones subyacentes en los datos, asegurando predicciones precisas y confiables del estado PCR de los pacientes.</p>
</section>
<section id="support-vector-machine" class="level4" data-number="2.2.4.6">
<h4 data-number="2.2.4.6" class="anchored" data-anchor-id="support-vector-machine"><span class="header-section-number">2.2.4.6</span> Support Vector Machine</h4>
<p>La Máquina de Vectores de Soporte, o, Support Vector Machine (SVM) es una técnica de clasificación que busca encontrar el hiperplano que mejor separa las clases en el espacio de características. En este estudio, se ha utilizado el paquete <code>e1071</code> de R para implementar SVM.</p>
<p>SVM funciona proyectando los datos a un espacio de mayor dimensión donde se puede encontrar un hiperplano que maximiza el margen de separación entre las clases. El hiperplano se define por:</p>
<p><span class="math display"> \mathbf{w} \cdot \mathbf{x} + b = 0 </span></p>
<p>donde <span class="math inline">\mathbf{w}</span> es el vector de pesos y <span class="math inline">b</span> es el sesgo. El objetivo es encontrar <span class="math inline">\mathbf{w}</span> y <span class="math inline">b</span> que maximicen el margen, sujetando a las restricciones de clasificación correcta de las muestras. Formalmente, los principales hiperparámetros ajustados en este estudio han sido:</p>
<ul>
<li><p><strong>Kernel</strong>: Este parámetro define la función de transformación que se utiliza para proyectar los datos en un espacio de mayor dimensión. Los kernels disponibles incluyen:</p>
<ul>
<li><strong>Lineal</strong>: <span class="math inline">K(\mathbf{x_i}, \mathbf{x_j}) = \mathbf{x_i} \cdot \mathbf{x_j}</span></li>
<li><strong>Sigmoid</strong>: <span class="math inline">K(\mathbf{x_i}, \mathbf{x_j}) = \tanh(\alpha \mathbf{x_i} \cdot \mathbf{x_j} + r)</span></li>
<li><strong>Polinomial</strong>: <span class="math inline">K(\mathbf{x_i}, \mathbf{x_j}) = (\alpha \mathbf{x_i} \cdot \mathbf{x_j} + r)^d</span></li>
<li><strong>RBF (Radial Basis Function)</strong>: <span class="math inline">K(\mathbf{x_i}, \mathbf{x_j}) = \exp(-\gamma ||\mathbf{x_i} - \mathbf{x_j}||^2)</span></li>
</ul>
<p>La elección del kernel afecta directamente la capacidad del SVM para capturar relaciones no lineales en los datos. Por ejemplo, un kernel lineal es adecuado para datos linealmente separables, mientras que un kernel RBF es más flexible y puede modelar relaciones complejas.</p></li>
<li><p><strong>Coste (C)</strong>: Este parámetro controla el margen de tolerancia a errores en la clasificación. Un valor alto de <span class="math inline">C</span> da como resultado un margen más estrecho y menos tolerancia a errores de clasificación, lo que puede llevar a un modelo que sobreajuste los datos de entrenamiento. Por otro lado, un valor bajo de <span class="math inline">C</span> permite un margen más amplio y más errores de clasificación, lo que puede resultar en un modelo más general.</p></li>
</ul>
</section>
<section id="artificial-neural-networks" class="level4" data-number="2.2.4.7">
<h4 data-number="2.2.4.7" class="anchored" data-anchor-id="artificial-neural-networks"><span class="header-section-number">2.2.4.7</span> Artificial Neural Networks</h4>
<p>Las Redes Neuronales Artificiales (ANN) son modelos de aprendizaje automático inspirados en la estructura y funcionamiento del cerebro humano. En este estudio, se ha utilizado la función <code>nnet</code> del paquete <code>nnet</code> de R para implementar un modelo de red neuronal artificial.</p>
<p>Las redes neuronales consisten en una capa de entrada, una o más capas ocultas, y una capa de salida. Cada neurona en estas capas realiza una operación lineal seguida de una función de activación no lineal. En este estudio, la arquitectura del modelo se definirá principalmente por el número de neuronas en la capa oculta (<code>size</code>) y el método de regularización (<code>weight-decay</code>).</p>
<ul>
<li><p><strong>Tamaño de la Capa Oculta (<code>size</code>)</strong>: Este parámetro especifica el número de neuronas en la capa oculta de la red neuronal. Un mayor número de neuronas (<code>size</code>) puede capturar patrones más complejos en los datos, pero también aumenta el riesgo de sobreajuste si el modelo se vuelve demasiado complejo.</p></li>
<li><p><strong>Parámetro de Regularización (<code>decay</code>)</strong>: El parámetro <code>weight-decay</code> controla la magnitud de la penalización aplicada a los pesos del modelo durante el entrenamiento para prevenir el sobreajuste. Este método de regularización agrega un término a la función de pérdida que penaliza grandes valores de los pesos, manteniendo los pesos más pequeños y el modelo más sencillo. Ajustar el <code>decay</code> afecta la capacidad del modelo para generalizar, ya que valores muy altos pueden resultar en un modelo subajustado, mientras que valores muy bajos pueden no ser suficientes para evitar el sobreajuste.</p></li>
</ul>
</section>
</section>
</section>
</section>
<section id="resultados" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Resultados</h1>
<section id="naive-bayes-1" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="naive-bayes-1"><span class="header-section-number">3.1</span> Naive Bayes</h2>
<section id="aparente" class="level3" data-number="3.1.1">
<h3 data-number="3.1.1" class="anchored" data-anchor-id="aparente"><span class="header-section-number">3.1.1</span> Aparente</h3>
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>evaluate_aparent_performance_model_naiveBayes <span class="ot">&lt;-</span> <span class="cf">function</span>(data, target_var, model_func, <span class="at">vars =</span> <span class="cn">NULL</span>, threshold, seed) {</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.null</span>(vars)) {</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>    vars <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(<span class="fu">names</span>(data), target_var)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(<span class="at">seed =</span> seed)</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>  data[[target_var]] <span class="ot">&lt;-</span> <span class="fu">factor</span>(data[[target_var]], <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>  formula <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(<span class="fu">paste</span>(target_var, <span class="st">"~"</span>, <span class="fu">paste</span>(vars, <span class="at">collapse =</span> <span class="st">"+"</span>)))</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>  model <span class="ot">&lt;-</span> <span class="fu">model_func</span>(formula, data)</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>  predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(model, <span class="at">newdata =</span> data, <span class="at">type =</span> <span class="st">"raw"</span>)[, <span class="dv">2</span>]</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>  actual_classes <span class="ot">&lt;-</span> data[[target_var]]</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>  predicted_classes <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(predictions <span class="sc">&gt;</span> threshold, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>  confusion_matrix <span class="ot">&lt;-</span> <span class="fu">table</span>(predicted_classes, actual_classes)</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>  tp <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="st">"1"</span> <span class="sc">%in%</span> <span class="fu">rownames</span>(confusion_matrix) <span class="sc">&amp;&amp;</span> <span class="st">"1"</span> <span class="sc">%in%</span> <span class="fu">colnames</span>(confusion_matrix), confusion_matrix[<span class="st">"1"</span>, <span class="st">"1"</span>], <span class="dv">0</span>)</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>  tn <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="st">"0"</span> <span class="sc">%in%</span> <span class="fu">rownames</span>(confusion_matrix) <span class="sc">&amp;&amp;</span> <span class="st">"0"</span> <span class="sc">%in%</span> <span class="fu">colnames</span>(confusion_matrix), confusion_matrix[<span class="st">"0"</span>, <span class="st">"0"</span>], <span class="dv">0</span>)</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>  fp <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="st">"1"</span> <span class="sc">%in%</span> <span class="fu">rownames</span>(confusion_matrix) <span class="sc">&amp;&amp;</span> <span class="st">"0"</span> <span class="sc">%in%</span> <span class="fu">colnames</span>(confusion_matrix), confusion_matrix[<span class="st">"1"</span>, <span class="st">"0"</span>], <span class="dv">0</span>)</span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>  fn <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="st">"0"</span> <span class="sc">%in%</span> <span class="fu">rownames</span>(confusion_matrix) <span class="sc">&amp;&amp;</span> <span class="st">"1"</span> <span class="sc">%in%</span> <span class="fu">colnames</span>(confusion_matrix), confusion_matrix[<span class="st">"0"</span>, <span class="st">"1"</span>], <span class="dv">0</span>)</span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>  accuracy <span class="ot">&lt;-</span> (tp <span class="sc">+</span> tn) <span class="sc">/</span> (tp <span class="sc">+</span> tn <span class="sc">+</span> fp <span class="sc">+</span> fn)</span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>  precision <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(tp <span class="sc">+</span> fp <span class="sc">&gt;</span> <span class="dv">0</span>, tp <span class="sc">/</span> (tp <span class="sc">+</span> fp), <span class="dv">0</span>)</span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>  recall <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(tp <span class="sc">+</span> fn <span class="sc">&gt;</span> <span class="dv">0</span>, tp <span class="sc">/</span> (tp <span class="sc">+</span> fn), <span class="dv">0</span>)</span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>  f1_score <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(precision <span class="sc">+</span> recall <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="dv">2</span> <span class="sc">*</span> (precision <span class="sc">*</span> recall) <span class="sc">/</span> (precision <span class="sc">+</span> recall), <span class="dv">0</span>)</span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>  roc_obj <span class="ot">&lt;-</span> pROC<span class="sc">::</span><span class="fu">roc</span>(actual_classes, predictions)</span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="at">confusion_matrix =</span> confusion_matrix, <span class="at">accuracy =</span> accuracy, <span class="at">precision =</span> precision, </span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a>       <span class="at">recall =</span> recall, <span class="at">f1_score =</span> f1_score, <span class="at">roc_curve =</span> roc_obj)</span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a>naiveBayes_model <span class="ot">&lt;-</span> <span class="cf">function</span>(formula, data) {</span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">naiveBayes</span>(<span class="at">formula =</span> formula, <span class="at">data =</span> data)</span>
<span id="cb16-32"><a href="#cb16-32" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-33"><a href="#cb16-33" aria-hidden="true" tabindex="-1"></a>resultadosAparentesNaiveBayes <span class="ot">&lt;-</span> <span class="fu">evaluate_aparent_performance_model_naiveBayes</span>(<span class="at">data =</span> data_factor, </span>
<span id="cb16-34"><a href="#cb16-34" aria-hidden="true" tabindex="-1"></a>                                                                               <span class="at">target_var =</span> <span class="st">"PCR"</span>,</span>
<span id="cb16-35"><a href="#cb16-35" aria-hidden="true" tabindex="-1"></a>                                                                              <span class="at">model_func =</span> naiveBayes_model,</span>
<span id="cb16-36"><a href="#cb16-36" aria-hidden="true" tabindex="-1"></a>                                                                              <span class="at">vars =</span> <span class="st">"."</span>,</span>
<span id="cb16-37"><a href="#cb16-37" aria-hidden="true" tabindex="-1"></a>                                                                              <span class="at">threshold =</span> .<span class="dv">35</span>,</span>
<span id="cb16-38"><a href="#cb16-38" aria-hidden="true" tabindex="-1"></a>                                                                              <span class="at">seed =</span> <span class="dv">90</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"RData_Files_Algorithms/NaiveBayes_Aparente.RData"</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="todas-las-variables" class="level3" data-number="3.1.2">
<h3 data-number="3.1.2" class="anchored" data-anchor-id="todas-las-variables"><span class="header-section-number">3.1.2</span> Todas las Variables</h3>
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>double_cross_validation_naiveBayes <span class="ot">&lt;-</span> <span class="cf">function</span>(data, target_name, outer, inner, variables, threshold, seed) {</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(seed)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  performance_metrics <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Fold =</span> <span class="fu">integer</span>(), <span class="at">TP =</span> <span class="fu">integer</span>(), <span class="at">TN =</span> <span class="fu">integer</span>(),</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">FP =</span> <span class="fu">integer</span>(), <span class="at">FN =</span> <span class="fu">integer</span>(), <span class="at">AUC =</span> <span class="fu">numeric</span>(), <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>  data[[target_name]] <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(data[[target_name]])</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>  outer_folds <span class="ot">&lt;-</span> <span class="fu">createFolds</span>(data[[target_name]], <span class="at">k =</span> outer, <span class="at">list =</span> <span class="cn">TRUE</span>, <span class="at">returnTrain =</span> <span class="cn">FALSE</span>)</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (outer_index <span class="cf">in</span> <span class="fu">seq_along</span>(outer_folds)) {</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>    outer_train_data <span class="ot">&lt;-</span> data[<span class="sc">-</span>outer_folds[[outer_index]], ]</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>    outer_test_data <span class="ot">&lt;-</span> data[outer_folds[[outer_index]], ]</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Outer Fold %d</span><span class="sc">\n</span><span class="st">"</span>, outer_index))</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Training Data - Class 0: "</span>, <span class="fu">sum</span>(outer_train_data[[target_name]] <span class="sc">==</span> <span class="st">"0"</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Training Data - Class 1: "</span>, <span class="fu">sum</span>(outer_train_data[[target_name]] <span class="sc">==</span> <span class="st">"1"</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Testing Data - Class 0: "</span>, <span class="fu">sum</span>(outer_test_data[[target_name]] <span class="sc">==</span> <span class="st">"0"</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Testing Data - Class 1: "</span>, <span class="fu">sum</span>(outer_test_data[[target_name]] <span class="sc">==</span> <span class="st">"1"</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">sum</span>(outer_train_data[[target_name]] <span class="sc">==</span> <span class="st">"0"</span>) <span class="sc">==</span> <span class="dv">0</span> <span class="sc">||</span> <span class="fu">sum</span>(outer_train_data[[target_name]] <span class="sc">==</span> <span class="st">"1"</span>) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cat</span>(<span class="st">"Skipping outer fold due to lack of class diversity</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>      <span class="cf">next</span></span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a>    inner_folds <span class="ot">&lt;-</span> <span class="fu">createFolds</span>(outer_train_data[[target_name]], <span class="at">k =</span> inner, <span class="at">list =</span> <span class="cn">TRUE</span>, <span class="at">returnTrain =</span> <span class="cn">FALSE</span>)</span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a>    best_model <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a>    best_auc <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a>    formula <span class="ot">&lt;-</span> <span class="fu">reformulate</span>(variables, target_name)</span>
<span id="cb18-29"><a href="#cb18-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-30"><a href="#cb18-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (inner_index <span class="cf">in</span> <span class="fu">seq_along</span>(inner_folds)) {</span>
<span id="cb18-31"><a href="#cb18-31" aria-hidden="true" tabindex="-1"></a>      inner_train_data <span class="ot">&lt;-</span> outer_train_data[<span class="sc">-</span>inner_folds[[inner_index]], ]</span>
<span id="cb18-32"><a href="#cb18-32" aria-hidden="true" tabindex="-1"></a>      inner_test_data <span class="ot">&lt;-</span> outer_train_data[inner_folds[[inner_index]], ]</span>
<span id="cb18-33"><a href="#cb18-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-34"><a href="#cb18-34" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="fu">sum</span>(inner_train_data[[target_name]] <span class="sc">==</span> <span class="st">"0"</span>) <span class="sc">==</span> <span class="dv">0</span> <span class="sc">||</span> <span class="fu">sum</span>(inner_train_data[[target_name]] <span class="sc">==</span> <span class="st">"1"</span>) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb18-35"><a href="#cb18-35" aria-hidden="true" tabindex="-1"></a>        <span class="fu">cat</span>(<span class="st">"Skipping inner fold due to lack of class diversity</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb18-36"><a href="#cb18-36" aria-hidden="true" tabindex="-1"></a>        <span class="cf">next</span></span>
<span id="cb18-37"><a href="#cb18-37" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb18-38"><a href="#cb18-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-39"><a href="#cb18-39" aria-hidden="true" tabindex="-1"></a>      inner_auc <span class="ot">&lt;-</span> <span class="fu">numeric</span>()</span>
<span id="cb18-40"><a href="#cb18-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-41"><a href="#cb18-41" aria-hidden="true" tabindex="-1"></a>      result <span class="ot">&lt;-</span> <span class="fu">tryCatch</span>({</span>
<span id="cb18-42"><a href="#cb18-42" aria-hidden="true" tabindex="-1"></a>        model <span class="ot">&lt;-</span> <span class="fu">naiveBayes</span>(formula, <span class="at">data =</span> inner_train_data)</span>
<span id="cb18-43"><a href="#cb18-43" aria-hidden="true" tabindex="-1"></a>        predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(model, inner_test_data, <span class="at">type =</span> <span class="st">"raw"</span>)[, <span class="dv">2</span>]</span>
<span id="cb18-44"><a href="#cb18-44" aria-hidden="true" tabindex="-1"></a>        roc_curve <span class="ot">&lt;-</span> <span class="fu">roc</span>(inner_test_data[[target_name]], predictions)</span>
<span id="cb18-45"><a href="#cb18-45" aria-hidden="true" tabindex="-1"></a>        inner_auc[inner_index] <span class="ot">&lt;-</span> roc_curve<span class="sc">$</span>auc</span>
<span id="cb18-46"><a href="#cb18-46" aria-hidden="true" tabindex="-1"></a>      }, <span class="at">error =</span> <span class="cf">function</span>(e) {</span>
<span id="cb18-47"><a href="#cb18-47" aria-hidden="true" tabindex="-1"></a>        <span class="fu">cat</span>(<span class="st">"Error in inner fold "</span>, inner_index, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb18-48"><a href="#cb18-48" aria-hidden="true" tabindex="-1"></a>        <span class="fu">cat</span>(<span class="st">"Error message: "</span>, e<span class="sc">$</span>message, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb18-49"><a href="#cb18-49" aria-hidden="true" tabindex="-1"></a>        inner_auc[inner_index] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb18-50"><a href="#cb18-50" aria-hidden="true" tabindex="-1"></a>      })</span>
<span id="cb18-51"><a href="#cb18-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-52"><a href="#cb18-52" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="fu">mean</span>(inner_auc, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">&gt;</span> best_auc) {</span>
<span id="cb18-53"><a href="#cb18-53" aria-hidden="true" tabindex="-1"></a>        best_auc <span class="ot">&lt;-</span> <span class="fu">mean</span>(inner_auc, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb18-54"><a href="#cb18-54" aria-hidden="true" tabindex="-1"></a>        best_model <span class="ot">&lt;-</span> model</span>
<span id="cb18-55"><a href="#cb18-55" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb18-56"><a href="#cb18-56" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb18-57"><a href="#cb18-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-58"><a href="#cb18-58" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">is.null</span>(best_model)) {</span>
<span id="cb18-59"><a href="#cb18-59" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cat</span>(<span class="st">"No valid model found for outer fold "</span>, outer_index, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb18-60"><a href="#cb18-60" aria-hidden="true" tabindex="-1"></a>      <span class="cf">next</span></span>
<span id="cb18-61"><a href="#cb18-61" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb18-62"><a href="#cb18-62" aria-hidden="true" tabindex="-1"></a>    best_model <span class="ot">&lt;-</span> <span class="fu">naiveBayes</span>(formula, <span class="at">data =</span> outer_train_data)</span>
<span id="cb18-63"><a href="#cb18-63" aria-hidden="true" tabindex="-1"></a>    predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(best_model, outer_test_data, <span class="at">type =</span> <span class="st">"raw"</span>)[, <span class="dv">2</span>]</span>
<span id="cb18-64"><a href="#cb18-64" aria-hidden="true" tabindex="-1"></a>    pred_class <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(predictions <span class="sc">&gt;</span> threshold, <span class="st">"1"</span>, <span class="st">"0"</span>)</span>
<span id="cb18-65"><a href="#cb18-65" aria-hidden="true" tabindex="-1"></a>    confusion <span class="ot">&lt;-</span> <span class="fu">table</span>(<span class="at">Actual =</span> outer_test_data[[target_name]], <span class="at">Predicted =</span> pred_class)</span>
<span id="cb18-66"><a href="#cb18-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-67"><a href="#cb18-67" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">nrow</span>(confusion) <span class="sc">&lt;</span> <span class="dv">2</span> <span class="sc">||</span> <span class="fu">ncol</span>(confusion) <span class="sc">&lt;</span> <span class="dv">2</span>) {</span>
<span id="cb18-68"><a href="#cb18-68" aria-hidden="true" tabindex="-1"></a>      TP <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span>, confusion[<span class="dv">2</span>, <span class="dv">2</span>], <span class="dv">0</span>)</span>
<span id="cb18-69"><a href="#cb18-69" aria-hidden="true" tabindex="-1"></a>      TN <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span>, confusion[<span class="dv">1</span>, <span class="dv">1</span>], <span class="dv">0</span>)</span>
<span id="cb18-70"><a href="#cb18-70" aria-hidden="true" tabindex="-1"></a>      FP <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span>, confusion[<span class="dv">1</span>, <span class="dv">2</span>], <span class="dv">0</span>)</span>
<span id="cb18-71"><a href="#cb18-71" aria-hidden="true" tabindex="-1"></a>      FN <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span>, confusion[<span class="dv">2</span>, <span class="dv">1</span>], <span class="dv">0</span>)</span>
<span id="cb18-72"><a href="#cb18-72" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb18-73"><a href="#cb18-73" aria-hidden="true" tabindex="-1"></a>      TP <span class="ot">&lt;-</span> confusion[<span class="dv">2</span>, <span class="dv">2</span>]</span>
<span id="cb18-74"><a href="#cb18-74" aria-hidden="true" tabindex="-1"></a>      TN <span class="ot">&lt;-</span> confusion[<span class="dv">1</span>, <span class="dv">1</span>]</span>
<span id="cb18-75"><a href="#cb18-75" aria-hidden="true" tabindex="-1"></a>      FP <span class="ot">&lt;-</span> confusion[<span class="dv">1</span>, <span class="dv">2</span>]</span>
<span id="cb18-76"><a href="#cb18-76" aria-hidden="true" tabindex="-1"></a>      FN <span class="ot">&lt;-</span> confusion[<span class="dv">2</span>, <span class="dv">1</span>]</span>
<span id="cb18-77"><a href="#cb18-77" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb18-78"><a href="#cb18-78" aria-hidden="true" tabindex="-1"></a>    auc <span class="ot">&lt;-</span> <span class="fu">roc</span>(outer_test_data[[target_name]], predictions)<span class="sc">$</span>auc</span>
<span id="cb18-79"><a href="#cb18-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-80"><a href="#cb18-80" aria-hidden="true" tabindex="-1"></a>    metrics <span class="ot">&lt;-</span> <span class="fu">setNames</span>(<span class="fu">c</span>(outer_index, TP, TN, FP, FN, auc), <span class="fu">names</span>(performance_metrics))</span>
<span id="cb18-81"><a href="#cb18-81" aria-hidden="true" tabindex="-1"></a>    performance_metrics <span class="ot">&lt;-</span> <span class="fu">rbind</span>(performance_metrics, <span class="fu">as.data.frame</span>(<span class="fu">t</span>(metrics)))</span>
<span id="cb18-82"><a href="#cb18-82" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb18-83"><a href="#cb18-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-84"><a href="#cb18-84" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(performance_metrics)</span>
<span id="cb18-85"><a href="#cb18-85" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb18-86"><a href="#cb18-86" aria-hidden="true" tabindex="-1"></a>evaluate_with_seeds_NaiveBayes_Asociacion_Todas <span class="ot">&lt;-</span> </span>
<span id="cb18-87"><a href="#cb18-87" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(evaluation_function, data, target_var, vars, threshold, seeds, outer, inner) {</span>
<span id="cb18-88"><a href="#cb18-88" aria-hidden="true" tabindex="-1"></a>  results_list <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb18-89"><a href="#cb18-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-90"><a href="#cb18-90" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (seed <span class="cf">in</span> seeds) {</span>
<span id="cb18-91"><a href="#cb18-91" aria-hidden="true" tabindex="-1"></a>    <span class="fu">set.seed</span>(seed)</span>
<span id="cb18-92"><a href="#cb18-92" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Evaluating with seed:"</span>, seed, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb18-93"><a href="#cb18-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-94"><a href="#cb18-94" aria-hidden="true" tabindex="-1"></a>    results <span class="ot">&lt;-</span> <span class="fu">evaluation_function</span>(<span class="at">data =</span> data, </span>
<span id="cb18-95"><a href="#cb18-95" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">target_name =</span> target_var, </span>
<span id="cb18-96"><a href="#cb18-96" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">variables =</span> vars, </span>
<span id="cb18-97"><a href="#cb18-97" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">threshold =</span> threshold, </span>
<span id="cb18-98"><a href="#cb18-98" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">outer =</span> outer, </span>
<span id="cb18-99"><a href="#cb18-99" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">inner =</span> inner, </span>
<span id="cb18-100"><a href="#cb18-100" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">seed =</span> seed)</span>
<span id="cb18-101"><a href="#cb18-101" aria-hidden="true" tabindex="-1"></a>    results_list[[<span class="fu">paste0</span>(<span class="st">"seed_"</span>, seed)]] <span class="ot">&lt;-</span> results</span>
<span id="cb18-102"><a href="#cb18-102" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb18-103"><a href="#cb18-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-104"><a href="#cb18-104" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(results_list)</span>
<span id="cb18-105"><a href="#cb18-105" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb18-106"><a href="#cb18-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-107"><a href="#cb18-107" aria-hidden="true" tabindex="-1"></a>performance_naiveBayes_todasVariables <span class="ot">&lt;-</span> <span class="fu">evaluate_with_seeds_NaiveBayes_Asociacion_Todas</span>(</span>
<span id="cb18-108"><a href="#cb18-108" aria-hidden="true" tabindex="-1"></a>  <span class="at">evaluation_function =</span> double_cross_validation_naiveBayes,</span>
<span id="cb18-109"><a href="#cb18-109" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_factor,</span>
<span id="cb18-110"><a href="#cb18-110" aria-hidden="true" tabindex="-1"></a>  <span class="at">outer =</span> <span class="dv">5</span>,</span>
<span id="cb18-111"><a href="#cb18-111" aria-hidden="true" tabindex="-1"></a>  <span class="at">inner =</span> <span class="dv">2</span>,</span>
<span id="cb18-112"><a href="#cb18-112" aria-hidden="true" tabindex="-1"></a>  <span class="at">target_var =</span> <span class="st">"PCR"</span>,</span>
<span id="cb18-113"><a href="#cb18-113" aria-hidden="true" tabindex="-1"></a>  <span class="at">vars =</span> todas_variables_factor,</span>
<span id="cb18-114"><a href="#cb18-114" aria-hidden="true" tabindex="-1"></a>  <span class="at">threshold =</span> .<span class="dv">35</span>,</span>
<span id="cb18-115"><a href="#cb18-115" aria-hidden="true" tabindex="-1"></a>  <span class="at">seeds =</span> seeds)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"RData_Files_Algorithms/NaiveBayes_TodasVariables.RData"</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="filtrado-asociación" class="level3" data-number="3.1.3">
<h3 data-number="3.1.3" class="anchored" data-anchor-id="filtrado-asociación"><span class="header-section-number">3.1.3</span> Filtrado (Asociación)</h3>
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>performance_naiveBayes_Asociacion <span class="ot">&lt;-</span> <span class="fu">evaluate_with_seeds_NaiveBayes_Asociacion_Todas</span>(</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">evaluation_function =</span> double_cross_validation_naiveBayes,</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_factor,</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">outer =</span> <span class="dv">5</span>,</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">inner =</span> <span class="dv">2</span>,</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">target_var =</span> <span class="st">"PCR"</span>,</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">vars =</span> todas_variables_factor,</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">threshold =</span> .<span class="dv">35</span>,</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">seeds =</span> seeds)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"RData_Files_Algorithms/NaiveBayes_Asociacion.RData"</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="wrapped-stepauc" class="level3" data-number="3.1.4">
<h3 data-number="3.1.4" class="anchored" data-anchor-id="wrapped-stepauc"><span class="header-section-number">3.1.4</span> Wrapped (StepAUC)</h3>
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>double_cross_validation_naiveBayes_stepAUC <span class="ot">&lt;-</span> <span class="cf">function</span>(data, target_name, outer, inner, variables, threshold, seed) {</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(seed)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  performance_metrics <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Fold =</span> <span class="fu">integer</span>(), <span class="at">TP =</span> <span class="fu">integer</span>(), <span class="at">TN =</span> <span class="fu">integer</span>(),</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">FP =</span> <span class="fu">integer</span>(), <span class="at">FN =</span> <span class="fu">integer</span>(), <span class="at">AUC =</span> <span class="fu">numeric</span>(),</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">Best_Variables =</span> <span class="fu">character</span>(), <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>  inner_fold_metrics <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Fold =</span> <span class="fu">integer</span>(), <span class="at">Inner_Fold =</span> <span class="fu">integer</span>(), </span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">TP =</span> <span class="fu">integer</span>(), <span class="at">TN =</span> <span class="fu">integer</span>(), <span class="at">FP =</span> <span class="fu">integer</span>(), </span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">FN =</span> <span class="fu">integer</span>(), <span class="at">AUC =</span> <span class="fu">numeric</span>(), <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>  data[[target_name]] <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(data[[target_name]])</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>  outer_folds <span class="ot">&lt;-</span> <span class="fu">createFolds</span>(data[[target_name]], <span class="at">k =</span> outer, <span class="at">list =</span> <span class="cn">TRUE</span>, <span class="at">returnTrain =</span> <span class="cn">FALSE</span>)</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (outer_index <span class="cf">in</span> <span class="fu">seq_along</span>(outer_folds)) {</span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>    outer_train_data <span class="ot">&lt;-</span> data[<span class="sc">-</span>outer_folds[[outer_index]], ]</span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>    outer_test_data <span class="ot">&lt;-</span> data[outer_folds[[outer_index]], ]</span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Outer Fold %d</span><span class="sc">\n</span><span class="st">"</span>, outer_index))</span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Training Data - Class 0: "</span>, <span class="fu">sum</span>(outer_train_data[[target_name]] <span class="sc">==</span> <span class="st">"0"</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Training Data - Class 1: "</span>, <span class="fu">sum</span>(outer_train_data[[target_name]] <span class="sc">==</span> <span class="st">"1"</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Testing Data - Class 0: "</span>, <span class="fu">sum</span>(outer_test_data[[target_name]] <span class="sc">==</span> <span class="st">"0"</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Testing Data - Class 1: "</span>, <span class="fu">sum</span>(outer_test_data[[target_name]] <span class="sc">==</span> <span class="st">"1"</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a>    inner_folds <span class="ot">&lt;-</span> <span class="fu">createFolds</span>(outer_train_data[[target_name]], <span class="at">k =</span> inner, <span class="at">list =</span> <span class="cn">TRUE</span>, <span class="at">returnTrain =</span> <span class="cn">FALSE</span>)</span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a>    best_model <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a>    best_auc <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true" tabindex="-1"></a>    best_vars <span class="ot">&lt;-</span> variables</span>
<span id="cb22-28"><a href="#cb22-28" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb22-29"><a href="#cb22-29" aria-hidden="true" tabindex="-1"></a>    stepAUC <span class="ot">&lt;-</span> <span class="cf">function</span>(vars, outer_train_data, target_name, inner_folds) {</span>
<span id="cb22-30"><a href="#cb22-30" aria-hidden="true" tabindex="-1"></a>      current_vars <span class="ot">&lt;-</span> vars</span>
<span id="cb22-31"><a href="#cb22-31" aria-hidden="true" tabindex="-1"></a>      best_inner_auc <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb22-32"><a href="#cb22-32" aria-hidden="true" tabindex="-1"></a>      best_inner_model <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb22-33"><a href="#cb22-33" aria-hidden="true" tabindex="-1"></a>      best_inner_vars <span class="ot">&lt;-</span> current_vars</span>
<span id="cb22-34"><a href="#cb22-34" aria-hidden="true" tabindex="-1"></a>      improved <span class="ot">&lt;-</span> <span class="cn">TRUE</span></span>
<span id="cb22-35"><a href="#cb22-35" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb22-36"><a href="#cb22-36" aria-hidden="true" tabindex="-1"></a>      <span class="cf">while</span> (improved <span class="sc">&amp;&amp;</span> <span class="fu">length</span>(current_vars) <span class="sc">&gt;</span> <span class="dv">1</span>) {</span>
<span id="cb22-37"><a href="#cb22-37" aria-hidden="true" tabindex="-1"></a>        improved <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb22-38"><a href="#cb22-38" aria-hidden="true" tabindex="-1"></a>        best_auc_in_step <span class="ot">&lt;-</span> best_inner_auc</span>
<span id="cb22-39"><a href="#cb22-39" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb22-40"><a href="#cb22-40" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (var <span class="cf">in</span> current_vars) {</span>
<span id="cb22-41"><a href="#cb22-41" aria-hidden="true" tabindex="-1"></a>          temp_vars <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(current_vars, var)</span>
<span id="cb22-42"><a href="#cb22-42" aria-hidden="true" tabindex="-1"></a>          inner_auc <span class="ot">&lt;-</span> <span class="fu">numeric</span>()</span>
<span id="cb22-43"><a href="#cb22-43" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb22-44"><a href="#cb22-44" aria-hidden="true" tabindex="-1"></a>          <span class="cf">for</span> (inner_index <span class="cf">in</span> <span class="fu">seq_along</span>(inner_folds)) {</span>
<span id="cb22-45"><a href="#cb22-45" aria-hidden="true" tabindex="-1"></a>            inner_train_data <span class="ot">&lt;-</span> outer_train_data[<span class="sc">-</span>inner_folds[[inner_index]], ]</span>
<span id="cb22-46"><a href="#cb22-46" aria-hidden="true" tabindex="-1"></a>            inner_test_data <span class="ot">&lt;-</span> outer_train_data[inner_folds[[inner_index]], ]</span>
<span id="cb22-47"><a href="#cb22-47" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb22-48"><a href="#cb22-48" aria-hidden="true" tabindex="-1"></a>            result <span class="ot">&lt;-</span> <span class="fu">tryCatch</span>({</span>
<span id="cb22-49"><a href="#cb22-49" aria-hidden="true" tabindex="-1"></a>              model <span class="ot">&lt;-</span> <span class="fu">naiveBayes</span>(<span class="fu">as.formula</span>(<span class="fu">paste</span>(target_name, <span class="st">"~"</span>, <span class="fu">paste</span>(temp_vars, <span class="at">collapse =</span> <span class="st">"+"</span>))),</span>
<span id="cb22-50"><a href="#cb22-50" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">data =</span> inner_train_data)</span>
<span id="cb22-51"><a href="#cb22-51" aria-hidden="true" tabindex="-1"></a>              </span>
<span id="cb22-52"><a href="#cb22-52" aria-hidden="true" tabindex="-1"></a>              predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(model, <span class="at">newdata =</span> inner_test_data, <span class="at">type =</span> <span class="st">"raw"</span>)[, <span class="dv">2</span>]</span>
<span id="cb22-53"><a href="#cb22-53" aria-hidden="true" tabindex="-1"></a>              roc_curve <span class="ot">&lt;-</span> <span class="fu">roc</span>(inner_test_data[[target_name]], predictions)</span>
<span id="cb22-54"><a href="#cb22-54" aria-hidden="true" tabindex="-1"></a>              inner_auc[inner_index] <span class="ot">&lt;-</span> roc_curve<span class="sc">$</span>auc</span>
<span id="cb22-55"><a href="#cb22-55" aria-hidden="true" tabindex="-1"></a>              </span>
<span id="cb22-56"><a href="#cb22-56" aria-hidden="true" tabindex="-1"></a>            }, <span class="at">error =</span> <span class="cf">function</span>(e) {</span>
<span id="cb22-57"><a href="#cb22-57" aria-hidden="true" tabindex="-1"></a>              <span class="fu">cat</span>(<span class="st">"Error with variables:"</span>, <span class="fu">paste</span>(temp_vars, <span class="at">collapse =</span> <span class="st">", "</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb22-58"><a href="#cb22-58" aria-hidden="true" tabindex="-1"></a>              inner_auc[inner_index] <span class="ot">&lt;-</span> <span class="cn">NA</span>  <span class="co"># Set to NA or some other indicator of failure</span></span>
<span id="cb22-59"><a href="#cb22-59" aria-hidden="true" tabindex="-1"></a>            })</span>
<span id="cb22-60"><a href="#cb22-60" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb22-61"><a href="#cb22-61" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb22-62"><a href="#cb22-62" aria-hidden="true" tabindex="-1"></a>          mean_inner_auc <span class="ot">&lt;-</span> <span class="fu">mean</span>(inner_auc, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb22-63"><a href="#cb22-63" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.na</span>(mean_inner_auc) <span class="sc">&amp;&amp;</span> mean_inner_auc <span class="sc">&gt;</span> best_auc_in_step) {</span>
<span id="cb22-64"><a href="#cb22-64" aria-hidden="true" tabindex="-1"></a>            best_auc_in_step <span class="ot">&lt;-</span> mean_inner_auc</span>
<span id="cb22-65"><a href="#cb22-65" aria-hidden="true" tabindex="-1"></a>            best_inner_model <span class="ot">&lt;-</span> model</span>
<span id="cb22-66"><a href="#cb22-66" aria-hidden="true" tabindex="-1"></a>            best_inner_vars <span class="ot">&lt;-</span> temp_vars</span>
<span id="cb22-67"><a href="#cb22-67" aria-hidden="true" tabindex="-1"></a>            improved <span class="ot">&lt;-</span> <span class="cn">TRUE</span></span>
<span id="cb22-68"><a href="#cb22-68" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb22-69"><a href="#cb22-69" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb22-70"><a href="#cb22-70" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb22-71"><a href="#cb22-71" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (improved) {</span>
<span id="cb22-72"><a href="#cb22-72" aria-hidden="true" tabindex="-1"></a>          current_vars <span class="ot">&lt;-</span> best_inner_vars</span>
<span id="cb22-73"><a href="#cb22-73" aria-hidden="true" tabindex="-1"></a>          best_inner_auc <span class="ot">&lt;-</span> best_auc_in_step</span>
<span id="cb22-74"><a href="#cb22-74" aria-hidden="true" tabindex="-1"></a>          <span class="fu">cat</span>(<span class="st">"Vars improved: "</span>, <span class="fu">paste</span>(current_vars, <span class="at">collapse=</span><span class="st">", "</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb22-75"><a href="#cb22-75" aria-hidden="true" tabindex="-1"></a>          <span class="fu">cat</span>(<span class="st">"AUC: "</span>, <span class="fu">paste</span>(best_inner_auc), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb22-76"><a href="#cb22-76" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb22-77"><a href="#cb22-77" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb22-78"><a href="#cb22-78" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb22-79"><a href="#cb22-79" aria-hidden="true" tabindex="-1"></a>      <span class="fu">list</span>(<span class="at">model =</span> best_inner_model, <span class="at">auc =</span> best_inner_auc, <span class="at">vars =</span> best_inner_vars)</span>
<span id="cb22-80"><a href="#cb22-80" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb22-81"><a href="#cb22-81" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb22-82"><a href="#cb22-82" aria-hidden="true" tabindex="-1"></a>    best_result <span class="ot">&lt;-</span> <span class="fu">stepAUC</span>(variables, outer_train_data, target_name, inner_folds)</span>
<span id="cb22-83"><a href="#cb22-83" aria-hidden="true" tabindex="-1"></a>    best_model <span class="ot">&lt;-</span> best_result<span class="sc">$</span>model</span>
<span id="cb22-84"><a href="#cb22-84" aria-hidden="true" tabindex="-1"></a>    best_auc <span class="ot">&lt;-</span> best_result<span class="sc">$</span>auc</span>
<span id="cb22-85"><a href="#cb22-85" aria-hidden="true" tabindex="-1"></a>    best_vars <span class="ot">&lt;-</span> best_result<span class="sc">$</span>vars</span>
<span id="cb22-86"><a href="#cb22-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-87"><a href="#cb22-87" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">is.null</span>(best_model)) {</span>
<span id="cb22-88"><a href="#cb22-88" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cat</span>(<span class="st">"Error: No valid model found for outer fold "</span>, outer_index, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb22-89"><a href="#cb22-89" aria-hidden="true" tabindex="-1"></a>      <span class="cf">next</span></span>
<span id="cb22-90"><a href="#cb22-90" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb22-91"><a href="#cb22-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-92"><a href="#cb22-92" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Evaluar el mejor modelo en el validation split del inner loop</span></span>
<span id="cb22-93"><a href="#cb22-93" aria-hidden="true" tabindex="-1"></a>    inner_auc_vals <span class="ot">&lt;-</span> <span class="fu">numeric</span>()</span>
<span id="cb22-94"><a href="#cb22-94" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (inner_index <span class="cf">in</span> <span class="fu">seq_along</span>(inner_folds)) {</span>
<span id="cb22-95"><a href="#cb22-95" aria-hidden="true" tabindex="-1"></a>      inner_train_data <span class="ot">&lt;-</span> outer_train_data[<span class="sc">-</span>inner_folds[[inner_index]], ]</span>
<span id="cb22-96"><a href="#cb22-96" aria-hidden="true" tabindex="-1"></a>      inner_test_data <span class="ot">&lt;-</span> outer_train_data[inner_folds[[inner_index]], ]</span>
<span id="cb22-97"><a href="#cb22-97" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb22-98"><a href="#cb22-98" aria-hidden="true" tabindex="-1"></a>      predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(best_model, <span class="at">newdata =</span> inner_test_data, <span class="at">type =</span> <span class="st">"raw"</span>)[, <span class="dv">2</span>]</span>
<span id="cb22-99"><a href="#cb22-99" aria-hidden="true" tabindex="-1"></a>      roc_curve <span class="ot">&lt;-</span> <span class="fu">roc</span>(inner_test_data[[target_name]], predictions)</span>
<span id="cb22-100"><a href="#cb22-100" aria-hidden="true" tabindex="-1"></a>      inner_auc_vals[inner_index] <span class="ot">&lt;-</span> roc_curve<span class="sc">$</span>auc</span>
<span id="cb22-101"><a href="#cb22-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-102"><a href="#cb22-102" aria-hidden="true" tabindex="-1"></a>      pred_class <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(predictions <span class="sc">&gt;</span> threshold, <span class="st">"1"</span>, <span class="st">"0"</span>)</span>
<span id="cb22-103"><a href="#cb22-103" aria-hidden="true" tabindex="-1"></a>      confusion <span class="ot">&lt;-</span> <span class="fu">table</span>(<span class="at">Actual =</span> inner_test_data[[target_name]], <span class="at">Predicted =</span> pred_class)</span>
<span id="cb22-104"><a href="#cb22-104" aria-hidden="true" tabindex="-1"></a>      TP <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span>, confusion[<span class="dv">2</span>, <span class="dv">2</span>], <span class="dv">0</span>)</span>
<span id="cb22-105"><a href="#cb22-105" aria-hidden="true" tabindex="-1"></a>      TN <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span>, confusion[<span class="dv">1</span>, <span class="dv">1</span>], <span class="dv">0</span>)</span>
<span id="cb22-106"><a href="#cb22-106" aria-hidden="true" tabindex="-1"></a>      FP <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span>, confusion[<span class="dv">1</span>, <span class="dv">2</span>], <span class="dv">0</span>)</span>
<span id="cb22-107"><a href="#cb22-107" aria-hidden="true" tabindex="-1"></a>      FN <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span>, confusion[<span class="dv">2</span>, <span class="dv">1</span>], <span class="dv">0</span>)</span>
<span id="cb22-108"><a href="#cb22-108" aria-hidden="true" tabindex="-1"></a>      auc <span class="ot">&lt;-</span> roc_curve<span class="sc">$</span>auc</span>
<span id="cb22-109"><a href="#cb22-109" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb22-110"><a href="#cb22-110" aria-hidden="true" tabindex="-1"></a>      inner_metrics <span class="ot">&lt;-</span> <span class="fu">setNames</span>(<span class="fu">c</span>(outer_index, inner_index, TP, TN, FP, FN, auc), <span class="fu">names</span>(inner_fold_metrics))</span>
<span id="cb22-111"><a href="#cb22-111" aria-hidden="true" tabindex="-1"></a>      inner_fold_metrics <span class="ot">&lt;-</span> <span class="fu">rbind</span>(inner_fold_metrics, <span class="fu">as.data.frame</span>(<span class="fu">t</span>(inner_metrics)))</span>
<span id="cb22-112"><a href="#cb22-112" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb22-113"><a href="#cb22-113" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb22-114"><a href="#cb22-114" aria-hidden="true" tabindex="-1"></a>    best_inner_auc <span class="ot">&lt;-</span> <span class="fu">mean</span>(inner_auc_vals, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb22-115"><a href="#cb22-115" aria-hidden="true" tabindex="-1"></a>    best_model <span class="ot">&lt;-</span> <span class="fu">naiveBayes</span>(<span class="fu">as.formula</span>(<span class="fu">paste</span>(target_name, <span class="st">"~"</span>, <span class="fu">paste</span>(best_vars, <span class="at">collapse =</span> <span class="st">"+"</span>))),</span>
<span id="cb22-116"><a href="#cb22-116" aria-hidden="true" tabindex="-1"></a>                         <span class="at">data =</span> outer_train_data)</span>
<span id="cb22-117"><a href="#cb22-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-118"><a href="#cb22-118" aria-hidden="true" tabindex="-1"></a>    predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(best_model, outer_test_data, <span class="at">type =</span> <span class="st">"raw"</span>)[, <span class="dv">2</span>]</span>
<span id="cb22-119"><a href="#cb22-119" aria-hidden="true" tabindex="-1"></a>    pred_class <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(predictions <span class="sc">&gt;</span> threshold, <span class="st">"1"</span>, <span class="st">"0"</span>)</span>
<span id="cb22-120"><a href="#cb22-120" aria-hidden="true" tabindex="-1"></a>    confusion <span class="ot">&lt;-</span> <span class="fu">table</span>(<span class="at">Actual =</span> outer_test_data[[target_name]], <span class="at">Predicted =</span> pred_class)</span>
<span id="cb22-121"><a href="#cb22-121" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb22-122"><a href="#cb22-122" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">nrow</span>(confusion) <span class="sc">&lt;</span> <span class="dv">2</span> <span class="sc">||</span> <span class="fu">ncol</span>(confusion) <span class="sc">&lt;</span> <span class="dv">2</span>) {</span>
<span id="cb22-123"><a href="#cb22-123" aria-hidden="true" tabindex="-1"></a>      TP <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span>, confusion[<span class="dv">2</span>, <span class="dv">2</span>], <span class="dv">0</span>)</span>
<span id="cb22-124"><a href="#cb22-124" aria-hidden="true" tabindex="-1"></a>      TN <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span>, confusion[<span class="dv">1</span>, <span class="dv">1</span>], <span class="dv">0</span>)</span>
<span id="cb22-125"><a href="#cb22-125" aria-hidden="true" tabindex="-1"></a>      FP <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span>, confusion[<span class="dv">1</span>, <span class="dv">2</span>], <span class="dv">0</span>)</span>
<span id="cb22-126"><a href="#cb22-126" aria-hidden="true" tabindex="-1"></a>      FN <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span>, confusion[<span class="dv">2</span>, <span class="dv">1</span>], <span class="dv">0</span>)</span>
<span id="cb22-127"><a href="#cb22-127" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb22-128"><a href="#cb22-128" aria-hidden="true" tabindex="-1"></a>      TP <span class="ot">&lt;-</span> confusion[<span class="dv">2</span>, <span class="dv">2</span>]</span>
<span id="cb22-129"><a href="#cb22-129" aria-hidden="true" tabindex="-1"></a>      TN <span class="ot">&lt;-</span> confusion[<span class="dv">1</span>, <span class="dv">1</span>]</span>
<span id="cb22-130"><a href="#cb22-130" aria-hidden="true" tabindex="-1"></a>      FP <span class="ot">&lt;-</span> confusion[<span class="dv">1</span>, <span class="dv">2</span>]</span>
<span id="cb22-131"><a href="#cb22-131" aria-hidden="true" tabindex="-1"></a>      FN <span class="ot">&lt;-</span> confusion[<span class="dv">2</span>, <span class="dv">1</span>]</span>
<span id="cb22-132"><a href="#cb22-132" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb22-133"><a href="#cb22-133" aria-hidden="true" tabindex="-1"></a>    auc <span class="ot">&lt;-</span> <span class="fu">roc</span>(outer_test_data[[target_name]], predictions)<span class="sc">$</span>auc</span>
<span id="cb22-134"><a href="#cb22-134" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb22-135"><a href="#cb22-135" aria-hidden="true" tabindex="-1"></a>    metrics <span class="ot">&lt;-</span> <span class="fu">setNames</span>(<span class="fu">c</span>(outer_index, TP, TN, FP, FN, auc, </span>
<span id="cb22-136"><a href="#cb22-136" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">paste</span>(best_vars, <span class="at">collapse =</span> <span class="st">","</span>)), </span>
<span id="cb22-137"><a href="#cb22-137" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">names</span>(performance_metrics))</span>
<span id="cb22-138"><a href="#cb22-138" aria-hidden="true" tabindex="-1"></a>    performance_metrics <span class="ot">&lt;-</span> <span class="fu">rbind</span>(performance_metrics, <span class="fu">as.data.frame</span>(<span class="fu">t</span>(metrics)))</span>
<span id="cb22-139"><a href="#cb22-139" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb22-140"><a href="#cb22-140" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Performance:"</span>, <span class="fu">paste</span>(performance_metrics))</span>
<span id="cb22-141"><a href="#cb22-141" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Confusion Matrix for Fold %d:</span><span class="sc">\n</span><span class="st">"</span>, outer_index))</span>
<span id="cb22-142"><a href="#cb22-142" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(confusion)</span>
<span id="cb22-143"><a href="#cb22-143" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Metrics for Fold %d:</span><span class="sc">\n</span><span class="st">"</span>, outer_index))</span>
<span id="cb22-144"><a href="#cb22-144" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"TP: %d, TN: %d, FP: %d, FN: %d, AUC: %f, Best Variables: %s</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb22-145"><a href="#cb22-145" aria-hidden="true" tabindex="-1"></a>                TP, TN, FP, FN, auc, <span class="fu">paste</span>(best_vars, <span class="at">collapse =</span> <span class="st">","</span>)))</span>
<span id="cb22-146"><a href="#cb22-146" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb22-147"><a href="#cb22-147" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-148"><a href="#cb22-148" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="at">performance_metrics =</span> performance_metrics, <span class="at">inner_fold_metrics =</span> inner_fold_metrics)</span>
<span id="cb22-149"><a href="#cb22-149" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb22-150"><a href="#cb22-150" aria-hidden="true" tabindex="-1"></a>evaluate_with_seeds_NaiveBayes_stepAUC <span class="ot">&lt;-</span> </span>
<span id="cb22-151"><a href="#cb22-151" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(evaluation_function, data, target_var, vars, threshold, seeds, outer, inner) {</span>
<span id="cb22-152"><a href="#cb22-152" aria-hidden="true" tabindex="-1"></a>  results_list <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb22-153"><a href="#cb22-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-154"><a href="#cb22-154" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (seed <span class="cf">in</span> seeds) {</span>
<span id="cb22-155"><a href="#cb22-155" aria-hidden="true" tabindex="-1"></a>    <span class="fu">set.seed</span>(seed)</span>
<span id="cb22-156"><a href="#cb22-156" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Evaluating with seed:"</span>, seed, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb22-157"><a href="#cb22-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-158"><a href="#cb22-158" aria-hidden="true" tabindex="-1"></a>    results <span class="ot">&lt;-</span> <span class="fu">evaluation_function</span>(<span class="at">data =</span> data, </span>
<span id="cb22-159"><a href="#cb22-159" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">target_name =</span> target_var, </span>
<span id="cb22-160"><a href="#cb22-160" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">variables =</span> vars, </span>
<span id="cb22-161"><a href="#cb22-161" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">threshold =</span> threshold, </span>
<span id="cb22-162"><a href="#cb22-162" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">outer =</span> outer, </span>
<span id="cb22-163"><a href="#cb22-163" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">inner =</span> inner, </span>
<span id="cb22-164"><a href="#cb22-164" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">seed =</span> seed)</span>
<span id="cb22-165"><a href="#cb22-165" aria-hidden="true" tabindex="-1"></a>    results_list[[<span class="fu">paste0</span>(<span class="st">"seed_"</span>, seed)]] <span class="ot">&lt;-</span> results</span>
<span id="cb22-166"><a href="#cb22-166" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb22-167"><a href="#cb22-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-168"><a href="#cb22-168" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(results_list)</span>
<span id="cb22-169"><a href="#cb22-169" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb22-170"><a href="#cb22-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-171"><a href="#cb22-171" aria-hidden="true" tabindex="-1"></a>performance_naiveBayes_stepAUC <span class="ot">&lt;-</span> <span class="fu">evaluate_with_seeds_NaiveBayes_stepAUC</span>(</span>
<span id="cb22-172"><a href="#cb22-172" aria-hidden="true" tabindex="-1"></a>  <span class="at">evaluation_function =</span> double_cross_validation_naiveBayes_stepAUC,</span>
<span id="cb22-173"><a href="#cb22-173" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_factor,</span>
<span id="cb22-174"><a href="#cb22-174" aria-hidden="true" tabindex="-1"></a>  <span class="at">outer =</span> <span class="dv">5</span>,</span>
<span id="cb22-175"><a href="#cb22-175" aria-hidden="true" tabindex="-1"></a>  <span class="at">inner =</span> <span class="dv">2</span>,</span>
<span id="cb22-176"><a href="#cb22-176" aria-hidden="true" tabindex="-1"></a>  <span class="at">vars =</span> todas_variables_factor,</span>
<span id="cb22-177"><a href="#cb22-177" aria-hidden="true" tabindex="-1"></a>  <span class="at">target_var =</span> <span class="st">"PCR"</span>,</span>
<span id="cb22-178"><a href="#cb22-178" aria-hidden="true" tabindex="-1"></a>  <span class="at">threshold =</span> .<span class="dv">35</span>,</span>
<span id="cb22-179"><a href="#cb22-179" aria-hidden="true" tabindex="-1"></a>  <span class="at">seeds =</span> seeds</span>
<span id="cb22-180"><a href="#cb22-180" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"RData_Files_Algorithms/NaiveBayes_StepAUC.RData"</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="embedded-lasso" class="level3" data-number="3.1.5">
<h3 data-number="3.1.5" class="anchored" data-anchor-id="embedded-lasso"><span class="header-section-number">3.1.5</span> Embedded (Lasso)</h3>
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>double_cross_validation_naiveBayes_lasso <span class="ot">&lt;-</span> <span class="cf">function</span>(data, target_name, outer, inner, variables, threshold, seed) {</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(seed)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  performance_metrics <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Fold =</span> <span class="fu">integer</span>(), <span class="at">TP =</span> <span class="fu">integer</span>(), <span class="at">TN =</span> <span class="fu">integer</span>(),</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">FP =</span> <span class="fu">integer</span>(), <span class="at">FN =</span> <span class="fu">integer</span>(), <span class="at">AUC =</span> <span class="fu">numeric</span>(),</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">Best_Variables =</span> <span class="fu">character</span>(), <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>  inner_fold_metrics <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Fold =</span> <span class="fu">integer</span>(), <span class="at">Inner_Fold =</span> <span class="fu">integer</span>(), </span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">TP =</span> <span class="fu">integer</span>(), <span class="at">TN =</span> <span class="fu">integer</span>(), <span class="at">FP =</span> <span class="fu">integer</span>(), </span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">FN =</span> <span class="fu">integer</span>(), <span class="at">AUC =</span> <span class="fu">numeric</span>(), <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Convertir las variables del dataset con model.matrix</span></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>  target <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(data[[target_name]])  <span class="co"># Aseguramos que la variable de respuesta sea factor</span></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>  features <span class="ot">&lt;-</span> data[, <span class="fu">setdiff</span>(<span class="fu">names</span>(data), target_name)]</span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>  data_matrix <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">model.matrix</span>(<span class="sc">~</span> ., <span class="at">data=</span>features)[,<span class="sc">-</span><span class="dv">1</span>])  <span class="co"># Eliminar el intercepto</span></span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>  data_matrix[[target_name]] <span class="ot">&lt;-</span> target</span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>  outer_folds <span class="ot">&lt;-</span> <span class="fu">createFolds</span>(data_matrix[[target_name]], <span class="at">k =</span> outer)</span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (outer_index <span class="cf">in</span> <span class="fu">seq_along</span>(outer_folds)) {</span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a>    outer_train_data <span class="ot">&lt;-</span> data_matrix[<span class="sc">-</span>outer_folds[[outer_index]], ]</span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a>    outer_test_data <span class="ot">&lt;-</span> data_matrix[outer_folds[[outer_index]], ]</span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Outer Fold %d</span><span class="sc">\n</span><span class="st">"</span>, outer_index))</span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Training Data - Class 0: "</span>, <span class="fu">sum</span>(outer_train_data[[target_name]] <span class="sc">==</span> <span class="dv">0</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Training Data - Class 1: "</span>, <span class="fu">sum</span>(outer_train_data[[target_name]] <span class="sc">==</span> <span class="dv">1</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb24-26"><a href="#cb24-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Testing Data - Class 0: "</span>, <span class="fu">sum</span>(outer_test_data[[target_name]] <span class="sc">==</span> <span class="dv">0</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb24-27"><a href="#cb24-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Testing Data - Class 1: "</span>, <span class="fu">sum</span>(outer_test_data[[target_name]] <span class="sc">==</span> <span class="dv">1</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb24-28"><a href="#cb24-28" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb24-29"><a href="#cb24-29" aria-hidden="true" tabindex="-1"></a>    inner_folds <span class="ot">&lt;-</span> <span class="fu">createFolds</span>(outer_train_data[[target_name]], <span class="at">k =</span> inner)</span>
<span id="cb24-30"><a href="#cb24-30" aria-hidden="true" tabindex="-1"></a>    best_model <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb24-31"><a href="#cb24-31" aria-hidden="true" tabindex="-1"></a>    best_auc <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb24-32"><a href="#cb24-32" aria-hidden="true" tabindex="-1"></a>    best_vars <span class="ot">&lt;-</span> <span class="fu">colnames</span>(outer_train_data)[<span class="sc">!</span><span class="fu">colnames</span>(outer_train_data) <span class="sc">%in%</span> target_name]</span>
<span id="cb24-33"><a href="#cb24-33" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb24-34"><a href="#cb24-34" aria-hidden="true" tabindex="-1"></a>    select_vars_lasso <span class="ot">&lt;-</span> <span class="cf">function</span>(data, target_name) {</span>
<span id="cb24-35"><a href="#cb24-35" aria-hidden="true" tabindex="-1"></a>      target <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(data[[target_name]]) <span class="sc">-</span> <span class="dv">1</span>  <span class="co"># Convertimos a numérico para Lasso</span></span>
<span id="cb24-36"><a href="#cb24-36" aria-hidden="true" tabindex="-1"></a>      features <span class="ot">&lt;-</span> data[, <span class="fu">setdiff</span>(<span class="fu">names</span>(data), target_name)]</span>
<span id="cb24-37"><a href="#cb24-37" aria-hidden="true" tabindex="-1"></a>      X <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(<span class="sc">~</span> ., <span class="at">data=</span>features)[,<span class="sc">-</span><span class="dv">1</span>]  <span class="co"># Eliminamos el intercepto</span></span>
<span id="cb24-38"><a href="#cb24-38" aria-hidden="true" tabindex="-1"></a>      y <span class="ot">&lt;-</span> target</span>
<span id="cb24-39"><a href="#cb24-39" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb24-40"><a href="#cb24-40" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Ajustamos el modelo Lasso</span></span>
<span id="cb24-41"><a href="#cb24-41" aria-hidden="true" tabindex="-1"></a>      lasso_model <span class="ot">&lt;-</span> <span class="fu">cv.glmnet</span>(X, y, <span class="at">alpha=</span><span class="dv">1</span>)</span>
<span id="cb24-42"><a href="#cb24-42" aria-hidden="true" tabindex="-1"></a>      lasso_coef <span class="ot">&lt;-</span> <span class="fu">coef</span>(lasso_model, <span class="at">s =</span> <span class="st">"lambda.min"</span>)</span>
<span id="cb24-43"><a href="#cb24-43" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb24-44"><a href="#cb24-44" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Seleccionamos las variables no nulas</span></span>
<span id="cb24-45"><a href="#cb24-45" aria-hidden="true" tabindex="-1"></a>      selected_vars <span class="ot">&lt;-</span> <span class="fu">rownames</span>(lasso_coef)[lasso_coef[, <span class="dv">1</span>] <span class="sc">!=</span> <span class="dv">0</span>]</span>
<span id="cb24-46"><a href="#cb24-46" aria-hidden="true" tabindex="-1"></a>      selected_vars <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(selected_vars, <span class="st">"(Intercept)"</span>)</span>
<span id="cb24-47"><a href="#cb24-47" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cat</span>(<span class="st">"Selected variables by Lasso: "</span>, <span class="fu">paste</span>(selected_vars, <span class="at">collapse=</span><span class="st">", "</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb24-48"><a href="#cb24-48" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(selected_vars)</span>
<span id="cb24-49"><a href="#cb24-49" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb24-50"><a href="#cb24-50" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb24-51"><a href="#cb24-51" aria-hidden="true" tabindex="-1"></a>    stepAUC <span class="ot">&lt;-</span> <span class="cf">function</span>(vars, data, target_name, inner_folds) {</span>
<span id="cb24-52"><a href="#cb24-52" aria-hidden="true" tabindex="-1"></a>      best_inner_auc <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb24-53"><a href="#cb24-53" aria-hidden="true" tabindex="-1"></a>      best_inner_model <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb24-54"><a href="#cb24-54" aria-hidden="true" tabindex="-1"></a>      best_inner_vars <span class="ot">&lt;-</span> vars</span>
<span id="cb24-55"><a href="#cb24-55" aria-hidden="true" tabindex="-1"></a>      improved <span class="ot">&lt;-</span> <span class="cn">TRUE</span></span>
<span id="cb24-56"><a href="#cb24-56" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb24-57"><a href="#cb24-57" aria-hidden="true" tabindex="-1"></a>      <span class="cf">while</span> (improved <span class="sc">&amp;&amp;</span> <span class="fu">length</span>(vars) <span class="sc">&gt;</span> <span class="dv">1</span>) {</span>
<span id="cb24-58"><a href="#cb24-58" aria-hidden="true" tabindex="-1"></a>        improved <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb24-59"><a href="#cb24-59" aria-hidden="true" tabindex="-1"></a>        best_auc_in_step <span class="ot">&lt;-</span> best_inner_auc</span>
<span id="cb24-60"><a href="#cb24-60" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-61"><a href="#cb24-61" aria-hidden="true" tabindex="-1"></a>        auc_vals <span class="ot">&lt;-</span> <span class="fu">numeric</span>()</span>
<span id="cb24-62"><a href="#cb24-62" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-63"><a href="#cb24-63" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (inner_index <span class="cf">in</span> <span class="fu">seq_along</span>(inner_folds)) {</span>
<span id="cb24-64"><a href="#cb24-64" aria-hidden="true" tabindex="-1"></a>          inner_train_data <span class="ot">&lt;-</span> outer_train_data[<span class="sc">-</span>inner_folds[[inner_index]], ]</span>
<span id="cb24-65"><a href="#cb24-65" aria-hidden="true" tabindex="-1"></a>          inner_test_data <span class="ot">&lt;-</span> outer_train_data[inner_folds[[inner_index]], ]</span>
<span id="cb24-66"><a href="#cb24-66" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb24-67"><a href="#cb24-67" aria-hidden="true" tabindex="-1"></a>          selected_vars <span class="ot">&lt;-</span> <span class="fu">select_vars_lasso</span>(inner_train_data, target_name)</span>
<span id="cb24-68"><a href="#cb24-68" aria-hidden="true" tabindex="-1"></a>          formula <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(<span class="fu">paste</span>(target_name, <span class="st">"~"</span>, <span class="fu">paste</span>(selected_vars, <span class="at">collapse =</span> <span class="st">"+"</span>)))</span>
<span id="cb24-69"><a href="#cb24-69" aria-hidden="true" tabindex="-1"></a>          <span class="fu">cat</span>(<span class="st">"Testing with formula: "</span>, <span class="fu">deparse</span>(formula), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb24-70"><a href="#cb24-70" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb24-71"><a href="#cb24-71" aria-hidden="true" tabindex="-1"></a>          result <span class="ot">&lt;-</span> <span class="fu">tryCatch</span>({</span>
<span id="cb24-72"><a href="#cb24-72" aria-hidden="true" tabindex="-1"></a>            model <span class="ot">&lt;-</span> <span class="fu">naiveBayes</span>(formula, <span class="at">data =</span> inner_train_data)</span>
<span id="cb24-73"><a href="#cb24-73" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb24-74"><a href="#cb24-74" aria-hidden="true" tabindex="-1"></a>            predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(model, inner_test_data, <span class="at">type =</span> <span class="st">"raw"</span>)[,<span class="dv">2</span>]</span>
<span id="cb24-75"><a href="#cb24-75" aria-hidden="true" tabindex="-1"></a>            roc_curve <span class="ot">&lt;-</span> <span class="fu">roc</span>(inner_test_data[[target_name]], predictions)</span>
<span id="cb24-76"><a href="#cb24-76" aria-hidden="true" tabindex="-1"></a>            auc_vals[inner_index] <span class="ot">&lt;-</span> roc_curve<span class="sc">$</span>auc</span>
<span id="cb24-77"><a href="#cb24-77" aria-hidden="true" tabindex="-1"></a>            <span class="fu">cat</span>(<span class="st">"AUC for inner fold "</span>, inner_index, <span class="st">": "</span>, roc_curve<span class="sc">$</span>auc, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb24-78"><a href="#cb24-78" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb24-79"><a href="#cb24-79" aria-hidden="true" tabindex="-1"></a>          }, <span class="at">error =</span> <span class="cf">function</span>(e) {</span>
<span id="cb24-80"><a href="#cb24-80" aria-hidden="true" tabindex="-1"></a>            <span class="fu">cat</span>(<span class="st">"Error with variables: "</span>, <span class="fu">paste</span>(selected_vars, <span class="at">collapse =</span> <span class="st">", "</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb24-81"><a href="#cb24-81" aria-hidden="true" tabindex="-1"></a>            <span class="fu">cat</span>(<span class="st">"Error message: "</span>, e<span class="sc">$</span>message, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb24-82"><a href="#cb24-82" aria-hidden="true" tabindex="-1"></a>            auc_vals[inner_index] <span class="ot">&lt;-</span> <span class="cn">NA</span>  <span class="co"># Set to NA or some other indicator of failure</span></span>
<span id="cb24-83"><a href="#cb24-83" aria-hidden="true" tabindex="-1"></a>          })</span>
<span id="cb24-84"><a href="#cb24-84" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb24-85"><a href="#cb24-85" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-86"><a href="#cb24-86" aria-hidden="true" tabindex="-1"></a>        mean_auc <span class="ot">&lt;-</span> <span class="fu">mean</span>(auc_vals, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb24-87"><a href="#cb24-87" aria-hidden="true" tabindex="-1"></a>        <span class="fu">cat</span>(<span class="st">"Mean AUC: "</span>, mean_auc, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb24-88"><a href="#cb24-88" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.na</span>(mean_auc) <span class="sc">&amp;&amp;</span> mean_auc <span class="sc">&gt;</span> best_auc_in_step) {</span>
<span id="cb24-89"><a href="#cb24-89" aria-hidden="true" tabindex="-1"></a>          best_auc_in_step <span class="ot">&lt;-</span> mean_auc</span>
<span id="cb24-90"><a href="#cb24-90" aria-hidden="true" tabindex="-1"></a>          best_inner_model <span class="ot">&lt;-</span> model</span>
<span id="cb24-91"><a href="#cb24-91" aria-hidden="true" tabindex="-1"></a>          best_inner_vars <span class="ot">&lt;-</span> selected_vars</span>
<span id="cb24-92"><a href="#cb24-92" aria-hidden="true" tabindex="-1"></a>          improved <span class="ot">&lt;-</span> <span class="cn">TRUE</span></span>
<span id="cb24-93"><a href="#cb24-93" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb24-94"><a href="#cb24-94" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-95"><a href="#cb24-95" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (improved) {</span>
<span id="cb24-96"><a href="#cb24-96" aria-hidden="true" tabindex="-1"></a>          vars <span class="ot">&lt;-</span> best_inner_vars</span>
<span id="cb24-97"><a href="#cb24-97" aria-hidden="true" tabindex="-1"></a>          best_inner_auc <span class="ot">&lt;-</span> best_auc_in_step</span>
<span id="cb24-98"><a href="#cb24-98" aria-hidden="true" tabindex="-1"></a>          <span class="fu">cat</span>(<span class="st">"Vars improved: "</span>, <span class="fu">paste</span>(vars, <span class="at">collapse=</span><span class="st">", "</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb24-99"><a href="#cb24-99" aria-hidden="true" tabindex="-1"></a>          <span class="fu">cat</span>(<span class="st">"AUC: "</span>, best_inner_auc, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb24-100"><a href="#cb24-100" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb24-101"><a href="#cb24-101" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb24-102"><a href="#cb24-102" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb24-103"><a href="#cb24-103" aria-hidden="true" tabindex="-1"></a>      <span class="fu">list</span>(<span class="at">model =</span> best_inner_model, <span class="at">auc =</span> best_inner_auc, <span class="at">vars =</span> best_inner_vars)</span>
<span id="cb24-104"><a href="#cb24-104" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb24-105"><a href="#cb24-105" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb24-106"><a href="#cb24-106" aria-hidden="true" tabindex="-1"></a>    best_result <span class="ot">&lt;-</span> <span class="fu">stepAUC</span>(best_vars, outer_train_data, target_name, inner_folds)</span>
<span id="cb24-107"><a href="#cb24-107" aria-hidden="true" tabindex="-1"></a>    best_model <span class="ot">&lt;-</span> best_result<span class="sc">$</span>model</span>
<span id="cb24-108"><a href="#cb24-108" aria-hidden="true" tabindex="-1"></a>    best_auc <span class="ot">&lt;-</span> best_result<span class="sc">$</span>auc</span>
<span id="cb24-109"><a href="#cb24-109" aria-hidden="true" tabindex="-1"></a>    best_vars <span class="ot">&lt;-</span> best_result<span class="sc">$</span>vars</span>
<span id="cb24-110"><a href="#cb24-110" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb24-111"><a href="#cb24-111" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">is.null</span>(best_model)) {</span>
<span id="cb24-112"><a href="#cb24-112" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cat</span>(<span class="st">"Error: No valid model found for outer fold "</span>, outer_index, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb24-113"><a href="#cb24-113" aria-hidden="true" tabindex="-1"></a>      <span class="cf">next</span></span>
<span id="cb24-114"><a href="#cb24-114" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb24-115"><a href="#cb24-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-116"><a href="#cb24-116" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Evaluar el mejor modelo en el validation split del inner loop</span></span>
<span id="cb24-117"><a href="#cb24-117" aria-hidden="true" tabindex="-1"></a>    inner_auc_vals <span class="ot">&lt;-</span> <span class="fu">numeric</span>()</span>
<span id="cb24-118"><a href="#cb24-118" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (inner_index <span class="cf">in</span> <span class="fu">seq_along</span>(inner_folds)) {</span>
<span id="cb24-119"><a href="#cb24-119" aria-hidden="true" tabindex="-1"></a>      inner_train_data <span class="ot">&lt;-</span> outer_train_data[<span class="sc">-</span>inner_folds[[inner_index]], ]</span>
<span id="cb24-120"><a href="#cb24-120" aria-hidden="true" tabindex="-1"></a>      inner_test_data <span class="ot">&lt;-</span> outer_train_data[inner_folds[[inner_index]], ]</span>
<span id="cb24-121"><a href="#cb24-121" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb24-122"><a href="#cb24-122" aria-hidden="true" tabindex="-1"></a>      predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(best_model, inner_test_data, <span class="at">type =</span> <span class="st">"raw"</span>)[,<span class="dv">2</span>]</span>
<span id="cb24-123"><a href="#cb24-123" aria-hidden="true" tabindex="-1"></a>      roc_curve <span class="ot">&lt;-</span> <span class="fu">roc</span>(inner_test_data[[target_name]], predictions)</span>
<span id="cb24-124"><a href="#cb24-124" aria-hidden="true" tabindex="-1"></a>      inner_auc_vals[inner_index] <span class="ot">&lt;-</span> roc_curve<span class="sc">$</span>auc</span>
<span id="cb24-125"><a href="#cb24-125" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cat</span>(<span class="st">"Inner fold "</span>, inner_index, <span class="st">" AUC: "</span>, roc_curve<span class="sc">$</span>auc, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb24-126"><a href="#cb24-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-127"><a href="#cb24-127" aria-hidden="true" tabindex="-1"></a>      pred_class <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(predictions <span class="sc">&gt;</span> threshold, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb24-128"><a href="#cb24-128" aria-hidden="true" tabindex="-1"></a>      confusion <span class="ot">&lt;-</span> <span class="fu">table</span>(<span class="at">Actual =</span> inner_test_data[[target_name]], <span class="at">Predicted =</span> pred_class)</span>
<span id="cb24-129"><a href="#cb24-129" aria-hidden="true" tabindex="-1"></a>      TP <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span>, confusion[<span class="dv">2</span>, <span class="dv">2</span>], <span class="dv">0</span>)</span>
<span id="cb24-130"><a href="#cb24-130" aria-hidden="true" tabindex="-1"></a>      TN <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span>, confusion[<span class="dv">1</span>, <span class="dv">1</span>], <span class="dv">0</span>)</span>
<span id="cb24-131"><a href="#cb24-131" aria-hidden="true" tabindex="-1"></a>      FP <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span>, confusion[<span class="dv">1</span>, <span class="dv">2</span>], <span class="dv">0</span>)</span>
<span id="cb24-132"><a href="#cb24-132" aria-hidden="true" tabindex="-1"></a>      FN <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span>, confusion[<span class="dv">2</span>, <span class="dv">1</span>], <span class="dv">0</span>)</span>
<span id="cb24-133"><a href="#cb24-133" aria-hidden="true" tabindex="-1"></a>      auc <span class="ot">&lt;-</span> roc_curve<span class="sc">$</span>auc</span>
<span id="cb24-134"><a href="#cb24-134" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb24-135"><a href="#cb24-135" aria-hidden="true" tabindex="-1"></a>      inner_metrics <span class="ot">&lt;-</span> <span class="fu">setNames</span>(<span class="fu">c</span>(outer_index, inner_index, TP, TN, FP, FN, auc), <span class="fu">names</span>(inner_fold_metrics))</span>
<span id="cb24-136"><a href="#cb24-136" aria-hidden="true" tabindex="-1"></a>      inner_fold_metrics <span class="ot">&lt;-</span> <span class="fu">rbind</span>(inner_fold_metrics, <span class="fu">as.data.frame</span>(<span class="fu">t</span>(inner_metrics)))</span>
<span id="cb24-137"><a href="#cb24-137" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb24-138"><a href="#cb24-138" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb24-139"><a href="#cb24-139" aria-hidden="true" tabindex="-1"></a>    best_inner_auc <span class="ot">&lt;-</span> <span class="fu">mean</span>(inner_auc_vals, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb24-140"><a href="#cb24-140" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Best inner AUC: "</span>, best_inner_auc, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb24-141"><a href="#cb24-141" aria-hidden="true" tabindex="-1"></a>    best_model <span class="ot">&lt;-</span> <span class="fu">naiveBayes</span>(<span class="fu">as.formula</span>(<span class="fu">paste</span>(target_name, <span class="st">"~"</span>, <span class="fu">paste</span>(best_vars, <span class="at">collapse =</span> <span class="st">"+"</span>))), <span class="at">data =</span> outer_train_data)</span>
<span id="cb24-142"><a href="#cb24-142" aria-hidden="true" tabindex="-1"></a>    predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(best_model, outer_test_data, <span class="at">type =</span> <span class="st">"raw"</span>)[,<span class="dv">2</span>]</span>
<span id="cb24-143"><a href="#cb24-143" aria-hidden="true" tabindex="-1"></a>    pred_class <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(predictions <span class="sc">&gt;</span> threshold, <span class="dv">1</span>, <span class="dv">0</span>)  <span class="co"># Asignar clases basadas en umbral</span></span>
<span id="cb24-144"><a href="#cb24-144" aria-hidden="true" tabindex="-1"></a>    confusion <span class="ot">&lt;-</span> <span class="fu">table</span>(<span class="at">Actual =</span> outer_test_data[[target_name]], <span class="at">Predicted =</span> pred_class)</span>
<span id="cb24-145"><a href="#cb24-145" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb24-146"><a href="#cb24-146" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">nrow</span>(confusion) <span class="sc">&lt;</span> <span class="dv">2</span> <span class="sc">||</span> <span class="fu">ncol</span>(confusion) <span class="sc">&lt;</span> <span class="dv">2</span>) {</span>
<span id="cb24-147"><a href="#cb24-147" aria-hidden="true" tabindex="-1"></a>      TP <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span>, confusion[<span class="dv">2</span>, <span class="dv">2</span>], <span class="dv">0</span>)</span>
<span id="cb24-148"><a href="#cb24-148" aria-hidden="true" tabindex="-1"></a>      TN <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span>, confusion[<span class="dv">1</span>, <span class="dv">1</span>], <span class="dv">0</span>)</span>
<span id="cb24-149"><a href="#cb24-149" aria-hidden="true" tabindex="-1"></a>      FP <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span>, confusion[<span class="dv">1</span>, <span class="dv">2</span>], <span class="dv">0</span>)</span>
<span id="cb24-150"><a href="#cb24-150" aria-hidden="true" tabindex="-1"></a>      FN <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span>, confusion[<span class="dv">2</span>, <span class="dv">1</span>], <span class="dv">0</span>)</span>
<span id="cb24-151"><a href="#cb24-151" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb24-152"><a href="#cb24-152" aria-hidden="true" tabindex="-1"></a>      TP <span class="ot">&lt;-</span> confusion[<span class="dv">2</span>, <span class="dv">2</span>]</span>
<span id="cb24-153"><a href="#cb24-153" aria-hidden="true" tabindex="-1"></a>      TN <span class="ot">&lt;-</span> confusion[<span class="dv">1</span>, <span class="dv">1</span>]</span>
<span id="cb24-154"><a href="#cb24-154" aria-hidden="true" tabindex="-1"></a>      FP <span class="ot">&lt;-</span> confusion[<span class="dv">1</span>, <span class="dv">2</span>]</span>
<span id="cb24-155"><a href="#cb24-155" aria-hidden="true" tabindex="-1"></a>      FN <span class="ot">&lt;-</span> confusion[<span class="dv">2</span>, <span class="dv">1</span>]</span>
<span id="cb24-156"><a href="#cb24-156" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb24-157"><a href="#cb24-157" aria-hidden="true" tabindex="-1"></a>    auc <span class="ot">&lt;-</span> <span class="fu">roc</span>(outer_test_data[[target_name]], predictions)<span class="sc">$</span>auc</span>
<span id="cb24-158"><a href="#cb24-158" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb24-159"><a href="#cb24-159" aria-hidden="true" tabindex="-1"></a>    metrics <span class="ot">&lt;-</span> <span class="fu">setNames</span>(<span class="fu">c</span>(outer_index, TP, TN, FP, FN, auc, </span>
<span id="cb24-160"><a href="#cb24-160" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">paste</span>(best_vars, <span class="at">collapse =</span> <span class="st">","</span>)), </span>
<span id="cb24-161"><a href="#cb24-161" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">names</span>(performance_metrics))</span>
<span id="cb24-162"><a href="#cb24-162" aria-hidden="true" tabindex="-1"></a>    performance_metrics <span class="ot">&lt;-</span> <span class="fu">rbind</span>(performance_metrics, <span class="fu">as.data.frame</span>(<span class="fu">t</span>(metrics)))</span>
<span id="cb24-163"><a href="#cb24-163" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb24-164"><a href="#cb24-164" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Performance:</span><span class="sc">\n</span><span class="st">"</span>, <span class="fu">paste</span>(performance_metrics), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb24-165"><a href="#cb24-165" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Confusion Matrix for Fold %d:</span><span class="sc">\n</span><span class="st">"</span>, outer_index))</span>
<span id="cb24-166"><a href="#cb24-166" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(confusion)</span>
<span id="cb24-167"><a href="#cb24-167" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Metrics for Fold %d:</span><span class="sc">\n</span><span class="st">"</span>, outer_index))</span>
<span id="cb24-168"><a href="#cb24-168" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"TP: %d, TN: %d, FP: %d, FN: %d, AUC: %f, Best Variables: %s</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb24-169"><a href="#cb24-169" aria-hidden="true" tabindex="-1"></a>                TP, TN, FP, FN, auc, <span class="fu">paste</span>(best_vars, <span class="at">collapse =</span> <span class="st">","</span>)))</span>
<span id="cb24-170"><a href="#cb24-170" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb24-171"><a href="#cb24-171" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-172"><a href="#cb24-172" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="at">performance_metrics =</span> performance_metrics, <span class="at">inner_fold_metrics =</span> inner_fold_metrics)</span>
<span id="cb24-173"><a href="#cb24-173" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb24-174"><a href="#cb24-174" aria-hidden="true" tabindex="-1"></a>evaluate_with_seeds_NaiveBayes_Lasso <span class="ot">&lt;-</span> </span>
<span id="cb24-175"><a href="#cb24-175" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(evaluation_function, data, target_var, vars, threshold, seeds, outer, inner) {</span>
<span id="cb24-176"><a href="#cb24-176" aria-hidden="true" tabindex="-1"></a>  results_list <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb24-177"><a href="#cb24-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-178"><a href="#cb24-178" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (seed <span class="cf">in</span> seeds) {</span>
<span id="cb24-179"><a href="#cb24-179" aria-hidden="true" tabindex="-1"></a>    <span class="fu">set.seed</span>(seed)</span>
<span id="cb24-180"><a href="#cb24-180" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Evaluating with seed:"</span>, seed, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb24-181"><a href="#cb24-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-182"><a href="#cb24-182" aria-hidden="true" tabindex="-1"></a>    results <span class="ot">&lt;-</span> <span class="fu">evaluation_function</span>(<span class="at">data =</span> data, </span>
<span id="cb24-183"><a href="#cb24-183" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">target_name =</span> target_var, </span>
<span id="cb24-184"><a href="#cb24-184" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">variables =</span> vars, </span>
<span id="cb24-185"><a href="#cb24-185" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">threshold =</span> threshold, </span>
<span id="cb24-186"><a href="#cb24-186" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">outer =</span> outer, </span>
<span id="cb24-187"><a href="#cb24-187" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">inner =</span> inner, </span>
<span id="cb24-188"><a href="#cb24-188" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">seed =</span> seed)</span>
<span id="cb24-189"><a href="#cb24-189" aria-hidden="true" tabindex="-1"></a>    results_list[[<span class="fu">paste0</span>(<span class="st">"seed_"</span>, seed)]] <span class="ot">&lt;-</span> results</span>
<span id="cb24-190"><a href="#cb24-190" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb24-191"><a href="#cb24-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-192"><a href="#cb24-192" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(results_list)</span>
<span id="cb24-193"><a href="#cb24-193" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb24-194"><a href="#cb24-194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-195"><a href="#cb24-195" aria-hidden="true" tabindex="-1"></a>performance_naiveBayes_lasso <span class="ot">&lt;-</span> <span class="fu">evaluate_with_seeds_NaiveBayes_Lasso</span>(</span>
<span id="cb24-196"><a href="#cb24-196" aria-hidden="true" tabindex="-1"></a>  <span class="at">evaluation_function =</span> double_cross_validation_naiveBayes_lasso,</span>
<span id="cb24-197"><a href="#cb24-197" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_factor,</span>
<span id="cb24-198"><a href="#cb24-198" aria-hidden="true" tabindex="-1"></a>  <span class="at">outer =</span> <span class="dv">5</span>,</span>
<span id="cb24-199"><a href="#cb24-199" aria-hidden="true" tabindex="-1"></a>  <span class="at">inner =</span> <span class="dv">2</span>,</span>
<span id="cb24-200"><a href="#cb24-200" aria-hidden="true" tabindex="-1"></a>  <span class="at">vars =</span> todas_variables_factor,</span>
<span id="cb24-201"><a href="#cb24-201" aria-hidden="true" tabindex="-1"></a>  <span class="at">target_var =</span> <span class="st">"PCR"</span>,</span>
<span id="cb24-202"><a href="#cb24-202" aria-hidden="true" tabindex="-1"></a>  <span class="at">threshold =</span> .<span class="dv">35</span>,</span>
<span id="cb24-203"><a href="#cb24-203" aria-hidden="true" tabindex="-1"></a>  <span class="at">seeds =</span> seeds</span>
<span id="cb24-204"><a href="#cb24-204" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"RData_Files_Algorithms/NaiveBayes_Lasso.RData"</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="adaboost-1" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="adaboost-1"><span class="header-section-number">3.2</span> Adaboost</h2>
<section id="aparente-1" class="level3" data-number="3.2.1">
<h3 data-number="3.2.1" class="anchored" data-anchor-id="aparente-1"><span class="header-section-number">3.2.1</span> Aparente</h3>
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>evaluate_aparent_performance_model_adaboost <span class="ot">&lt;-</span> <span class="cf">function</span>(data, target_var, model_func, <span class="at">vars =</span> <span class="cn">NULL</span>, <span class="at">iterations =</span> <span class="dv">100</span>, threshold) {</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.null</span>(vars)) {</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>    vars <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(<span class="fu">names</span>(data), target_var)</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>  data[[target_var]] <span class="ot">&lt;-</span> <span class="fu">factor</span>(data[[target_var]], <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>  formula <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(<span class="fu">paste</span>(target_var, <span class="st">"~"</span>, <span class="fu">paste</span>(vars, <span class="at">collapse =</span> <span class="st">"+"</span>)))</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>  model <span class="ot">&lt;-</span> <span class="fu">model_func</span>(formula, data, iterations)</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>  predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(model, <span class="at">newdata =</span> data, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>  actual_classes <span class="ot">&lt;-</span> data[[target_var]]</span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>  predicted_classes <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(predictions <span class="sc">&gt;</span> threshold, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>  confusion_matrix <span class="ot">&lt;-</span> <span class="fu">table</span>(<span class="at">Predicted =</span> predicted_classes, <span class="at">Actual =</span> actual_classes)</span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>  tp <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="st">"1"</span> <span class="sc">%in%</span> <span class="fu">rownames</span>(confusion_matrix) <span class="sc">&amp;&amp;</span> <span class="st">"1"</span> <span class="sc">%in%</span> <span class="fu">colnames</span>(confusion_matrix), confusion_matrix[<span class="st">"1"</span>, <span class="st">"1"</span>], <span class="dv">0</span>)</span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a>  tn <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="st">"0"</span> <span class="sc">%in%</span> <span class="fu">rownames</span>(confusion_matrix) <span class="sc">&amp;&amp;</span> <span class="st">"0"</span> <span class="sc">%in%</span> <span class="fu">colnames</span>(confusion_matrix), confusion_matrix[<span class="st">"0"</span>, <span class="st">"0"</span>], <span class="dv">0</span>)</span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a>  fp <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="st">"1"</span> <span class="sc">%in%</span> <span class="fu">rownames</span>(confusion_matrix) <span class="sc">&amp;&amp;</span> <span class="st">"0"</span> <span class="sc">%in%</span> <span class="fu">colnames</span>(confusion_matrix), confusion_matrix[<span class="st">"1"</span>, <span class="st">"0"</span>], <span class="dv">0</span>)</span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a>  fn <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="st">"0"</span> <span class="sc">%in%</span> <span class="fu">rownames</span>(confusion_matrix) <span class="sc">&amp;&amp;</span> <span class="st">"1"</span> <span class="sc">%in%</span> <span class="fu">colnames</span>(confusion_matrix), confusion_matrix[<span class="st">"0"</span>, <span class="st">"1"</span>], <span class="dv">0</span>)</span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a>  accuracy <span class="ot">&lt;-</span> (tp <span class="sc">+</span> tn) <span class="sc">/</span> (tp <span class="sc">+</span> tn <span class="sc">+</span> fp <span class="sc">+</span> fn)</span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a>  precision <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(tp <span class="sc">+</span> fp <span class="sc">&gt;</span> <span class="dv">0</span>, tp <span class="sc">/</span> (tp <span class="sc">+</span> fp), <span class="dv">0</span>)</span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true" tabindex="-1"></a>  recall <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(tp <span class="sc">+</span> fn <span class="sc">&gt;</span> <span class="dv">0</span>, tp <span class="sc">/</span> (tp <span class="sc">+</span> fn), <span class="dv">0</span>)</span>
<span id="cb26-24"><a href="#cb26-24" aria-hidden="true" tabindex="-1"></a>  f1_score <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(precision <span class="sc">+</span> recall <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="dv">2</span> <span class="sc">*</span> (precision <span class="sc">*</span> recall) <span class="sc">/</span> (precision <span class="sc">+</span> recall), <span class="dv">0</span>)</span>
<span id="cb26-25"><a href="#cb26-25" aria-hidden="true" tabindex="-1"></a>  roc_obj <span class="ot">&lt;-</span> pROC<span class="sc">::</span><span class="fu">roc</span>(actual_classes, predictions)</span>
<span id="cb26-26"><a href="#cb26-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb26-27"><a href="#cb26-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="at">confusion_matrix =</span> confusion_matrix, <span class="at">accuracy =</span> accuracy, <span class="at">precision =</span> precision, </span>
<span id="cb26-28"><a href="#cb26-28" aria-hidden="true" tabindex="-1"></a>       <span class="at">recall =</span> recall, <span class="at">f1_score =</span> f1_score, <span class="at">roc_curve =</span> roc_obj)</span>
<span id="cb26-29"><a href="#cb26-29" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb26-30"><a href="#cb26-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-31"><a href="#cb26-31" aria-hidden="true" tabindex="-1"></a>adaboost_model <span class="ot">&lt;-</span> <span class="cf">function</span>(formula, data, iterations) {</span>
<span id="cb26-32"><a href="#cb26-32" aria-hidden="true" tabindex="-1"></a>  model <span class="ot">&lt;-</span> <span class="fu">glmboost</span>(formula, <span class="at">data =</span> data, <span class="at">family =</span> <span class="fu">Binomial</span>(), <span class="at">control =</span> <span class="fu">boost_control</span>(<span class="at">mstop =</span> iterations))</span>
<span id="cb26-33"><a href="#cb26-33" aria-hidden="true" tabindex="-1"></a>  model</span>
<span id="cb26-34"><a href="#cb26-34" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb26-35"><a href="#cb26-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-36"><a href="#cb26-36" aria-hidden="true" tabindex="-1"></a>resultadosAparentesAdaBoost <span class="ot">&lt;-</span> <span class="fu">evaluate_aparent_performance_model_adaboost</span>(<span class="at">data =</span> data_numeric, <span class="at">target_var =</span> <span class="st">"PCR"</span>,</span>
<span id="cb26-37"><a href="#cb26-37" aria-hidden="true" tabindex="-1"></a>                                                                           <span class="at">model_func =</span> adaboost_model,</span>
<span id="cb26-38"><a href="#cb26-38" aria-hidden="true" tabindex="-1"></a>                                                                           <span class="at">vars =</span> <span class="st">"."</span>,</span>
<span id="cb26-39"><a href="#cb26-39" aria-hidden="true" tabindex="-1"></a>                                                                           <span class="at">iterations =</span> <span class="dv">100</span>,</span>
<span id="cb26-40"><a href="#cb26-40" aria-hidden="true" tabindex="-1"></a>                                                                           <span class="at">threshold =</span> <span class="fl">0.35</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"RData_Files_Algorithms/AdaBoost_Aparente.RData"</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="todas-las-variables-1" class="level3" data-number="3.2.2">
<h3 data-number="3.2.2" class="anchored" data-anchor-id="todas-las-variables-1"><span class="header-section-number">3.2.2</span> Todas las Variables</h3>
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>double_cross_validation_adaboost <span class="ot">&lt;-</span> <span class="cf">function</span>(data, target_name, outer, inner, iterations, variables, threshold, seed) {</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(seed)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  performance_metrics <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Fold =</span> <span class="fu">integer</span>(), <span class="at">TP =</span> <span class="fu">integer</span>(), <span class="at">TN =</span> <span class="fu">integer</span>(),</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">FP =</span> <span class="fu">integer</span>(), <span class="at">FN =</span> <span class="fu">integer</span>(), <span class="at">AUC =</span> <span class="fu">numeric</span>(), </span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">Best_Iteration =</span> <span class="fu">integer</span>(), <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>  data[[target_name]] <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(data[[target_name]])</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>  outer_folds <span class="ot">&lt;-</span> <span class="fu">createFolds</span>(data[[target_name]], <span class="at">k =</span> outer, <span class="at">list =</span> <span class="cn">TRUE</span>, <span class="at">returnTrain =</span> <span class="cn">FALSE</span>)</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (outer_index <span class="cf">in</span> <span class="fu">seq_along</span>(outer_folds)) {</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>    outer_train_data <span class="ot">&lt;-</span> data[<span class="sc">-</span>outer_folds[[outer_index]], ]</span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>    outer_test_data <span class="ot">&lt;-</span> data[outer_folds[[outer_index]], ]</span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Outer Fold %d</span><span class="sc">\n</span><span class="st">"</span>, outer_index))</span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Training Data - Class 0: "</span>, <span class="fu">sum</span>(outer_train_data[[target_name]] <span class="sc">==</span> <span class="st">"0"</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Training Data - Class 1: "</span>, <span class="fu">sum</span>(outer_train_data[[target_name]] <span class="sc">==</span> <span class="st">"1"</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Testing Data - Class 0: "</span>, <span class="fu">sum</span>(outer_test_data[[target_name]] <span class="sc">==</span> <span class="st">"0"</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Testing Data - Class 1: "</span>, <span class="fu">sum</span>(outer_test_data[[target_name]] <span class="sc">==</span> <span class="st">"1"</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">sum</span>(outer_train_data[[target_name]] <span class="sc">==</span> <span class="st">"0"</span>) <span class="sc">==</span> <span class="dv">0</span> <span class="sc">||</span> <span class="fu">sum</span>(outer_train_data[[target_name]] <span class="sc">==</span> <span class="st">"1"</span>) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cat</span>(<span class="st">"Skipping outer fold due to lack of class diversity</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a>      <span class="cf">next</span></span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb28-24"><a href="#cb28-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb28-25"><a href="#cb28-25" aria-hidden="true" tabindex="-1"></a>    inner_folds <span class="ot">&lt;-</span> <span class="fu">createFolds</span>(outer_train_data[[target_name]], <span class="at">k =</span> inner, <span class="at">list =</span> <span class="cn">TRUE</span>, <span class="at">returnTrain =</span> <span class="cn">FALSE</span>)</span>
<span id="cb28-26"><a href="#cb28-26" aria-hidden="true" tabindex="-1"></a>    best_model <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb28-27"><a href="#cb28-27" aria-hidden="true" tabindex="-1"></a>    best_auc <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb28-28"><a href="#cb28-28" aria-hidden="true" tabindex="-1"></a>    best_iteration <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb28-29"><a href="#cb28-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-30"><a href="#cb28-30" aria-hidden="true" tabindex="-1"></a>    grid <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">iteration =</span> iterations)</span>
<span id="cb28-31"><a href="#cb28-31" aria-hidden="true" tabindex="-1"></a>    formula <span class="ot">&lt;-</span> <span class="fu">reformulate</span>(variables, target_name)</span>
<span id="cb28-32"><a href="#cb28-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-33"><a href="#cb28-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (params <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(grid)) {</span>
<span id="cb28-34"><a href="#cb28-34" aria-hidden="true" tabindex="-1"></a>      inner_auc <span class="ot">&lt;-</span> <span class="fu">numeric</span>()</span>
<span id="cb28-35"><a href="#cb28-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-36"><a href="#cb28-36" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (inner_index <span class="cf">in</span> <span class="fu">seq_along</span>(inner_folds)) {</span>
<span id="cb28-37"><a href="#cb28-37" aria-hidden="true" tabindex="-1"></a>        inner_train_data <span class="ot">&lt;-</span> outer_train_data[<span class="sc">-</span>inner_folds[[inner_index]], ]</span>
<span id="cb28-38"><a href="#cb28-38" aria-hidden="true" tabindex="-1"></a>        inner_test_data <span class="ot">&lt;-</span> outer_train_data[inner_folds[[inner_index]], ]</span>
<span id="cb28-39"><a href="#cb28-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-40"><a href="#cb28-40" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="fu">sum</span>(inner_train_data[[target_name]] <span class="sc">==</span> <span class="st">"0"</span>) <span class="sc">==</span> <span class="dv">0</span> <span class="sc">||</span> <span class="fu">sum</span>(inner_train_data[[target_name]] <span class="sc">==</span> <span class="st">"1"</span>) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb28-41"><a href="#cb28-41" aria-hidden="true" tabindex="-1"></a>          <span class="fu">cat</span>(<span class="st">"Skipping inner fold due to lack of class diversity</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb28-42"><a href="#cb28-42" aria-hidden="true" tabindex="-1"></a>          <span class="cf">next</span></span>
<span id="cb28-43"><a href="#cb28-43" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb28-44"><a href="#cb28-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-45"><a href="#cb28-45" aria-hidden="true" tabindex="-1"></a>        result <span class="ot">&lt;-</span> <span class="fu">tryCatch</span>({</span>
<span id="cb28-46"><a href="#cb28-46" aria-hidden="true" tabindex="-1"></a>          model <span class="ot">&lt;-</span> <span class="fu">blackboost</span>(formula, <span class="at">data =</span> inner_train_data, <span class="at">family =</span> <span class="fu">Binomial</span>(), <span class="at">control =</span> <span class="fu">boost_control</span>(<span class="at">mstop =</span> grid<span class="sc">$</span>iteration[params]))</span>
<span id="cb28-47"><a href="#cb28-47" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb28-48"><a href="#cb28-48" aria-hidden="true" tabindex="-1"></a>          predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(model, inner_test_data, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb28-49"><a href="#cb28-49" aria-hidden="true" tabindex="-1"></a>          roc_curve <span class="ot">&lt;-</span> <span class="fu">roc</span>(inner_test_data[[target_name]], predictions)</span>
<span id="cb28-50"><a href="#cb28-50" aria-hidden="true" tabindex="-1"></a>          inner_auc[inner_index] <span class="ot">&lt;-</span> roc_curve<span class="sc">$</span>auc</span>
<span id="cb28-51"><a href="#cb28-51" aria-hidden="true" tabindex="-1"></a>        }, <span class="at">error =</span> <span class="cf">function</span>(e) {</span>
<span id="cb28-52"><a href="#cb28-52" aria-hidden="true" tabindex="-1"></a>          <span class="fu">cat</span>(<span class="st">"Error with parameters: iteration ="</span>, grid<span class="sc">$</span>iteration[params], <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb28-53"><a href="#cb28-53" aria-hidden="true" tabindex="-1"></a>          <span class="fu">cat</span>(<span class="st">"Error message: "</span>, e<span class="sc">$</span>message, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb28-54"><a href="#cb28-54" aria-hidden="true" tabindex="-1"></a>          inner_auc[inner_index] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb28-55"><a href="#cb28-55" aria-hidden="true" tabindex="-1"></a>        })</span>
<span id="cb28-56"><a href="#cb28-56" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb28-57"><a href="#cb28-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-58"><a href="#cb28-58" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="fu">mean</span>(inner_auc, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">&gt;</span> best_auc) {</span>
<span id="cb28-59"><a href="#cb28-59" aria-hidden="true" tabindex="-1"></a>        best_auc <span class="ot">&lt;-</span> <span class="fu">mean</span>(inner_auc, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb28-60"><a href="#cb28-60" aria-hidden="true" tabindex="-1"></a>        best_model <span class="ot">&lt;-</span> model</span>
<span id="cb28-61"><a href="#cb28-61" aria-hidden="true" tabindex="-1"></a>        best_iteration <span class="ot">&lt;-</span> grid<span class="sc">$</span>iteration[params]</span>
<span id="cb28-62"><a href="#cb28-62" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb28-63"><a href="#cb28-63" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb28-64"><a href="#cb28-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-65"><a href="#cb28-65" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">is.null</span>(best_model)) {</span>
<span id="cb28-66"><a href="#cb28-66" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cat</span>(<span class="st">"No valid model found for outer fold "</span>, outer_index, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb28-67"><a href="#cb28-67" aria-hidden="true" tabindex="-1"></a>      <span class="cf">next</span></span>
<span id="cb28-68"><a href="#cb28-68" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb28-69"><a href="#cb28-69" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Reentrenar el mejor modelo con todos los datos de outer_train_data</span></span>
<span id="cb28-70"><a href="#cb28-70" aria-hidden="true" tabindex="-1"></a>    best_model <span class="ot">&lt;-</span> <span class="fu">blackboost</span>(formula, <span class="at">data =</span> outer_train_data, <span class="at">family =</span> <span class="fu">Binomial</span>(), <span class="at">control =</span> <span class="fu">boost_control</span>(<span class="at">mstop =</span> best_iteration))</span>
<span id="cb28-71"><a href="#cb28-71" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb28-72"><a href="#cb28-72" aria-hidden="true" tabindex="-1"></a>    predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(best_model, outer_test_data, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb28-73"><a href="#cb28-73" aria-hidden="true" tabindex="-1"></a>    pred_class <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(predictions <span class="sc">&gt;</span> threshold, <span class="st">"1"</span>, <span class="st">"0"</span>)</span>
<span id="cb28-74"><a href="#cb28-74" aria-hidden="true" tabindex="-1"></a>    confusion <span class="ot">&lt;-</span> <span class="fu">table</span>(<span class="at">Actual =</span> outer_test_data[[target_name]], <span class="at">Predicted =</span> pred_class)</span>
<span id="cb28-75"><a href="#cb28-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-76"><a href="#cb28-76" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">nrow</span>(confusion) <span class="sc">&lt;</span> <span class="dv">2</span> <span class="sc">||</span> <span class="fu">ncol</span>(confusion) <span class="sc">&lt;</span> <span class="dv">2</span>) {</span>
<span id="cb28-77"><a href="#cb28-77" aria-hidden="true" tabindex="-1"></a>      TP <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span>, confusion[<span class="dv">2</span>, <span class="dv">2</span>], <span class="dv">0</span>)</span>
<span id="cb28-78"><a href="#cb28-78" aria-hidden="true" tabindex="-1"></a>      TN <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span>, confusion[<span class="dv">1</span>, <span class="dv">1</span>], <span class="dv">0</span>)</span>
<span id="cb28-79"><a href="#cb28-79" aria-hidden="true" tabindex="-1"></a>      FP <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span>, confusion[<span class="dv">1</span>, <span class="dv">2</span>], <span class="dv">0</span>)</span>
<span id="cb28-80"><a href="#cb28-80" aria-hidden="true" tabindex="-1"></a>      FN <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span>, confusion[<span class="dv">2</span>, <span class="dv">1</span>], <span class="dv">0</span>)</span>
<span id="cb28-81"><a href="#cb28-81" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb28-82"><a href="#cb28-82" aria-hidden="true" tabindex="-1"></a>      TP <span class="ot">&lt;-</span> confusion[<span class="dv">2</span>, <span class="dv">2</span>]</span>
<span id="cb28-83"><a href="#cb28-83" aria-hidden="true" tabindex="-1"></a>      TN <span class="ot">&lt;-</span> confusion[<span class="dv">1</span>, <span class="dv">1</span>]</span>
<span id="cb28-84"><a href="#cb28-84" aria-hidden="true" tabindex="-1"></a>      FP <span class="ot">&lt;-</span> confusion[<span class="dv">1</span>, <span class="dv">2</span>]</span>
<span id="cb28-85"><a href="#cb28-85" aria-hidden="true" tabindex="-1"></a>      FN <span class="ot">&lt;-</span> confusion[<span class="dv">2</span>, <span class="dv">1</span>]</span>
<span id="cb28-86"><a href="#cb28-86" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb28-87"><a href="#cb28-87" aria-hidden="true" tabindex="-1"></a>    auc <span class="ot">&lt;-</span> <span class="fu">roc</span>(outer_test_data[[target_name]], predictions)<span class="sc">$</span>auc</span>
<span id="cb28-88"><a href="#cb28-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-89"><a href="#cb28-89" aria-hidden="true" tabindex="-1"></a>    metrics <span class="ot">&lt;-</span> <span class="fu">setNames</span>(<span class="fu">c</span>(outer_index, TP, TN, FP, FN, auc, best_iteration), <span class="fu">names</span>(performance_metrics))</span>
<span id="cb28-90"><a href="#cb28-90" aria-hidden="true" tabindex="-1"></a>    performance_metrics <span class="ot">&lt;-</span> <span class="fu">rbind</span>(performance_metrics, <span class="fu">as.data.frame</span>(<span class="fu">t</span>(metrics)))</span>
<span id="cb28-91"><a href="#cb28-91" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb28-92"><a href="#cb28-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-93"><a href="#cb28-93" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(performance_metrics)</span>
<span id="cb28-94"><a href="#cb28-94" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb28-95"><a href="#cb28-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-96"><a href="#cb28-96" aria-hidden="true" tabindex="-1"></a>evaluate_with_seeds_AdaBoost_Asociacion_Todas <span class="ot">&lt;-</span> </span>
<span id="cb28-97"><a href="#cb28-97" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(evaluation_function, data, target_var, vars, threshold, seeds, outer, inner, iterations) {</span>
<span id="cb28-98"><a href="#cb28-98" aria-hidden="true" tabindex="-1"></a>  results_list <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb28-99"><a href="#cb28-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-100"><a href="#cb28-100" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (seed <span class="cf">in</span> seeds) {</span>
<span id="cb28-101"><a href="#cb28-101" aria-hidden="true" tabindex="-1"></a>    <span class="fu">set.seed</span>(seed)</span>
<span id="cb28-102"><a href="#cb28-102" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Evaluating with seed:"</span>, seed, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb28-103"><a href="#cb28-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-104"><a href="#cb28-104" aria-hidden="true" tabindex="-1"></a>    results <span class="ot">&lt;-</span> <span class="fu">evaluation_function</span>(<span class="at">data =</span> data, </span>
<span id="cb28-105"><a href="#cb28-105" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">target_name =</span> target_var, </span>
<span id="cb28-106"><a href="#cb28-106" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">variables =</span> vars, </span>
<span id="cb28-107"><a href="#cb28-107" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">threshold =</span> threshold, </span>
<span id="cb28-108"><a href="#cb28-108" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">outer =</span> outer, </span>
<span id="cb28-109"><a href="#cb28-109" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">inner =</span> inner,</span>
<span id="cb28-110"><a href="#cb28-110" aria-hidden="true" tabindex="-1"></a>                                   iterations, </span>
<span id="cb28-111"><a href="#cb28-111" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">seed =</span> seed)</span>
<span id="cb28-112"><a href="#cb28-112" aria-hidden="true" tabindex="-1"></a>    results_list[[<span class="fu">paste0</span>(<span class="st">"seed_"</span>, seed)]] <span class="ot">&lt;-</span> results</span>
<span id="cb28-113"><a href="#cb28-113" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb28-114"><a href="#cb28-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-115"><a href="#cb28-115" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(results_list)</span>
<span id="cb28-116"><a href="#cb28-116" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb28-117"><a href="#cb28-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-118"><a href="#cb28-118" aria-hidden="true" tabindex="-1"></a>performance_adaboost_todasvariables <span class="ot">&lt;-</span> <span class="fu">evaluate_with_seeds_AdaBoost_Asociacion_Todas</span>(</span>
<span id="cb28-119"><a href="#cb28-119" aria-hidden="true" tabindex="-1"></a>  <span class="at">evaluation_function =</span> double_cross_validation_adaboost,</span>
<span id="cb28-120"><a href="#cb28-120" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_factor,</span>
<span id="cb28-121"><a href="#cb28-121" aria-hidden="true" tabindex="-1"></a>  <span class="at">outer =</span> <span class="dv">5</span>,</span>
<span id="cb28-122"><a href="#cb28-122" aria-hidden="true" tabindex="-1"></a>  <span class="at">inner =</span> <span class="dv">2</span>,</span>
<span id="cb28-123"><a href="#cb28-123" aria-hidden="true" tabindex="-1"></a>  <span class="at">target_var =</span> <span class="st">"PCR"</span>,</span>
<span id="cb28-124"><a href="#cb28-124" aria-hidden="true" tabindex="-1"></a>  <span class="at">vars =</span> todas_variables_factor,</span>
<span id="cb28-125"><a href="#cb28-125" aria-hidden="true" tabindex="-1"></a>  <span class="at">threshold =</span> .<span class="dv">35</span>,</span>
<span id="cb28-126"><a href="#cb28-126" aria-hidden="true" tabindex="-1"></a>  <span class="at">seeds =</span> seeds,</span>
<span id="cb28-127"><a href="#cb28-127" aria-hidden="true" tabindex="-1"></a>  <span class="at">iterations =</span> <span class="fu">c</span>(<span class="dv">50</span>, <span class="dv">100</span>, <span class="dv">150</span>, <span class="dv">200</span>)</span>
<span id="cb28-128"><a href="#cb28-128" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"RData_Files_Algorithms/AdaBoost_TodasVariables.RData"</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="filtrado-asociación-1" class="level3" data-number="3.2.3">
<h3 data-number="3.2.3" class="anchored" data-anchor-id="filtrado-asociación-1"><span class="header-section-number">3.2.3</span> Filtrado (Asociación)</h3>
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>performance_adaboost_Asociacion <span class="ot">&lt;-</span> <span class="fu">evaluate_with_seeds_AdaBoost_Asociacion_Todas</span>(</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">evaluation_function =</span> double_cross_validation_adaboost,</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_factor,</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">outer =</span> <span class="dv">5</span>,</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">inner =</span> <span class="dv">2</span>,</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">target_var =</span> <span class="st">"PCR"</span>,</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">vars =</span> asociacion,</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">threshold =</span> .<span class="dv">35</span>,</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">seeds =</span> seeds,</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">iterations =</span> <span class="fu">c</span>(<span class="dv">50</span>, <span class="dv">100</span>, <span class="dv">150</span>, <span class="dv">200</span>)</span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"RData_Files_Algorithms/AdaBoost_Asociacion.RData"</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="wrapped-stepauc-1" class="level3" data-number="3.2.4">
<h3 data-number="3.2.4" class="anchored" data-anchor-id="wrapped-stepauc-1"><span class="header-section-number">3.2.4</span> Wrapped (StepAUC)</h3>
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>double_cross_validation_adaboost_stepAUC <span class="ot">&lt;-</span> <span class="cf">function</span>(data, target_name, outer, inner, iterations, variables, threshold, seed) {</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(seed)</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  performance_metrics <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Fold =</span> <span class="fu">integer</span>(), <span class="at">TP =</span> <span class="fu">integer</span>(), <span class="at">TN =</span> <span class="fu">integer</span>(),</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">FP =</span> <span class="fu">integer</span>(), <span class="at">FN =</span> <span class="fu">integer</span>(), <span class="at">AUC =</span> <span class="fu">numeric</span>(),</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">Best_Iterations =</span> <span class="fu">integer</span>(), <span class="at">Best_Variables =</span> <span class="fu">character</span>(), <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>  inner_fold_metrics <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Fold =</span> <span class="fu">integer</span>(), <span class="at">Inner_Fold =</span> <span class="fu">integer</span>(), </span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">TP =</span> <span class="fu">integer</span>(), <span class="at">TN =</span> <span class="fu">integer</span>(), <span class="at">FP =</span> <span class="fu">integer</span>(), </span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">FN =</span> <span class="fu">integer</span>(), <span class="at">AUC =</span> <span class="fu">numeric</span>(), <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>  data[[target_name]] <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(data[[target_name]])</span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>  outer_folds <span class="ot">&lt;-</span> <span class="fu">createFolds</span>(data[[target_name]], <span class="at">k =</span> outer, <span class="at">list =</span> <span class="cn">TRUE</span>, <span class="at">returnTrain =</span> <span class="cn">FALSE</span>)</span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (outer_index <span class="cf">in</span> <span class="fu">seq_along</span>(outer_folds)) {</span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a>    outer_train_data <span class="ot">&lt;-</span> data[<span class="sc">-</span>outer_folds[[outer_index]], ]</span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a>    outer_test_data <span class="ot">&lt;-</span> data[outer_folds[[outer_index]], ]</span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Outer Fold %d</span><span class="sc">\n</span><span class="st">"</span>, outer_index))</span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Training Data - Class 0: "</span>, <span class="fu">sum</span>(outer_train_data[[target_name]] <span class="sc">==</span> <span class="st">"0"</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Training Data - Class 1: "</span>, <span class="fu">sum</span>(outer_train_data[[target_name]] <span class="sc">==</span> <span class="st">"1"</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Testing Data - Class 0: "</span>, <span class="fu">sum</span>(outer_test_data[[target_name]] <span class="sc">==</span> <span class="st">"0"</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb32-22"><a href="#cb32-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Testing Data - Class 1: "</span>, <span class="fu">sum</span>(outer_test_data[[target_name]] <span class="sc">==</span> <span class="st">"1"</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb32-23"><a href="#cb32-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb32-24"><a href="#cb32-24" aria-hidden="true" tabindex="-1"></a>    inner_folds <span class="ot">&lt;-</span> <span class="fu">createFolds</span>(outer_train_data[[target_name]], <span class="at">k =</span> inner, <span class="at">list =</span> <span class="cn">TRUE</span>, <span class="at">returnTrain =</span> <span class="cn">FALSE</span>)</span>
<span id="cb32-25"><a href="#cb32-25" aria-hidden="true" tabindex="-1"></a>    best_model <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb32-26"><a href="#cb32-26" aria-hidden="true" tabindex="-1"></a>    best_auc <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb32-27"><a href="#cb32-27" aria-hidden="true" tabindex="-1"></a>    best_iterations <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb32-28"><a href="#cb32-28" aria-hidden="true" tabindex="-1"></a>    best_vars <span class="ot">&lt;-</span> variables</span>
<span id="cb32-29"><a href="#cb32-29" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb32-30"><a href="#cb32-30" aria-hidden="true" tabindex="-1"></a>    stepAUC <span class="ot">&lt;-</span> <span class="cf">function</span>(vars, outer_train_data, target_name, iterations, inner_folds) {</span>
<span id="cb32-31"><a href="#cb32-31" aria-hidden="true" tabindex="-1"></a>      current_vars <span class="ot">&lt;-</span> vars</span>
<span id="cb32-32"><a href="#cb32-32" aria-hidden="true" tabindex="-1"></a>      best_inner_auc <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb32-33"><a href="#cb32-33" aria-hidden="true" tabindex="-1"></a>      best_inner_model <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb32-34"><a href="#cb32-34" aria-hidden="true" tabindex="-1"></a>      best_inner_iterations <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb32-35"><a href="#cb32-35" aria-hidden="true" tabindex="-1"></a>      best_inner_vars <span class="ot">&lt;-</span> current_vars</span>
<span id="cb32-36"><a href="#cb32-36" aria-hidden="true" tabindex="-1"></a>      improved <span class="ot">&lt;-</span> <span class="cn">TRUE</span></span>
<span id="cb32-37"><a href="#cb32-37" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb32-38"><a href="#cb32-38" aria-hidden="true" tabindex="-1"></a>      <span class="cf">while</span> (improved <span class="sc">&amp;&amp;</span> <span class="fu">length</span>(current_vars) <span class="sc">&gt;</span> <span class="dv">1</span>) {</span>
<span id="cb32-39"><a href="#cb32-39" aria-hidden="true" tabindex="-1"></a>        improved <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb32-40"><a href="#cb32-40" aria-hidden="true" tabindex="-1"></a>        best_auc_in_step <span class="ot">&lt;-</span> best_inner_auc</span>
<span id="cb32-41"><a href="#cb32-41" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb32-42"><a href="#cb32-42" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (var <span class="cf">in</span> current_vars) {</span>
<span id="cb32-43"><a href="#cb32-43" aria-hidden="true" tabindex="-1"></a>          temp_vars <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(current_vars, var)</span>
<span id="cb32-44"><a href="#cb32-44" aria-hidden="true" tabindex="-1"></a>          inner_auc <span class="ot">&lt;-</span> <span class="fu">numeric</span>()</span>
<span id="cb32-45"><a href="#cb32-45" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb32-46"><a href="#cb32-46" aria-hidden="true" tabindex="-1"></a>          <span class="cf">for</span> (iter <span class="cf">in</span> iterations) {</span>
<span id="cb32-47"><a href="#cb32-47" aria-hidden="true" tabindex="-1"></a>            auc_vals <span class="ot">&lt;-</span> <span class="fu">numeric</span>()</span>
<span id="cb32-48"><a href="#cb32-48" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb32-49"><a href="#cb32-49" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> (inner_index <span class="cf">in</span> <span class="fu">seq_along</span>(inner_folds)) {</span>
<span id="cb32-50"><a href="#cb32-50" aria-hidden="true" tabindex="-1"></a>              inner_train_data <span class="ot">&lt;-</span> outer_train_data[<span class="sc">-</span>inner_folds[[inner_index]], ]</span>
<span id="cb32-51"><a href="#cb32-51" aria-hidden="true" tabindex="-1"></a>              inner_test_data <span class="ot">&lt;-</span> outer_train_data[inner_folds[[inner_index]], ]</span>
<span id="cb32-52"><a href="#cb32-52" aria-hidden="true" tabindex="-1"></a>              </span>
<span id="cb32-53"><a href="#cb32-53" aria-hidden="true" tabindex="-1"></a>              result <span class="ot">&lt;-</span> <span class="fu">tryCatch</span>({</span>
<span id="cb32-54"><a href="#cb32-54" aria-hidden="true" tabindex="-1"></a>                model <span class="ot">&lt;-</span> <span class="fu">glmboost</span>(<span class="fu">as.formula</span>(<span class="fu">paste</span>(target_name, <span class="st">"~"</span>, <span class="fu">paste</span>(temp_vars, <span class="at">collapse =</span> <span class="st">"+"</span>))),</span>
<span id="cb32-55"><a href="#cb32-55" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">data =</span> inner_train_data, <span class="at">family =</span> <span class="fu">Binomial</span>(),</span>
<span id="cb32-56"><a href="#cb32-56" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">control =</span> <span class="fu">boost_control</span>(<span class="at">mstop =</span> iter))</span>
<span id="cb32-57"><a href="#cb32-57" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb32-58"><a href="#cb32-58" aria-hidden="true" tabindex="-1"></a>                predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(model, <span class="at">newdata =</span> inner_test_data, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb32-59"><a href="#cb32-59" aria-hidden="true" tabindex="-1"></a>                roc_curve <span class="ot">&lt;-</span> <span class="fu">roc</span>(inner_test_data[[target_name]], predictions)</span>
<span id="cb32-60"><a href="#cb32-60" aria-hidden="true" tabindex="-1"></a>                auc_vals[inner_index] <span class="ot">&lt;-</span> roc_curve<span class="sc">$</span>auc</span>
<span id="cb32-61"><a href="#cb32-61" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb32-62"><a href="#cb32-62" aria-hidden="true" tabindex="-1"></a>              }, <span class="at">error =</span> <span class="cf">function</span>(e) {</span>
<span id="cb32-63"><a href="#cb32-63" aria-hidden="true" tabindex="-1"></a>                <span class="fu">cat</span>(<span class="st">"Error with variables:"</span>, <span class="fu">paste</span>(temp_vars, <span class="at">collapse =</span> <span class="st">", "</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb32-64"><a href="#cb32-64" aria-hidden="true" tabindex="-1"></a>                auc_vals[inner_index] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb32-65"><a href="#cb32-65" aria-hidden="true" tabindex="-1"></a>              })</span>
<span id="cb32-66"><a href="#cb32-66" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb32-67"><a href="#cb32-67" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb32-68"><a href="#cb32-68" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> (<span class="fu">mean</span>(auc_vals, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">&gt;</span> best_auc_in_step) {</span>
<span id="cb32-69"><a href="#cb32-69" aria-hidden="true" tabindex="-1"></a>              best_auc_in_step <span class="ot">&lt;-</span> <span class="fu">mean</span>(auc_vals, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb32-70"><a href="#cb32-70" aria-hidden="true" tabindex="-1"></a>              best_inner_model <span class="ot">&lt;-</span> model</span>
<span id="cb32-71"><a href="#cb32-71" aria-hidden="true" tabindex="-1"></a>              best_inner_iterations <span class="ot">&lt;-</span> iter</span>
<span id="cb32-72"><a href="#cb32-72" aria-hidden="true" tabindex="-1"></a>              best_inner_vars <span class="ot">&lt;-</span> temp_vars</span>
<span id="cb32-73"><a href="#cb32-73" aria-hidden="true" tabindex="-1"></a>              improved <span class="ot">&lt;-</span> <span class="cn">TRUE</span></span>
<span id="cb32-74"><a href="#cb32-74" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb32-75"><a href="#cb32-75" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb32-76"><a href="#cb32-76" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb32-77"><a href="#cb32-77" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb32-78"><a href="#cb32-78" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (improved) {</span>
<span id="cb32-79"><a href="#cb32-79" aria-hidden="true" tabindex="-1"></a>          current_vars <span class="ot">&lt;-</span> best_inner_vars</span>
<span id="cb32-80"><a href="#cb32-80" aria-hidden="true" tabindex="-1"></a>          best_inner_auc <span class="ot">&lt;-</span> best_auc_in_step</span>
<span id="cb32-81"><a href="#cb32-81" aria-hidden="true" tabindex="-1"></a>          <span class="fu">cat</span>(<span class="st">"Vars improved: "</span>, <span class="fu">paste</span>(current_vars, <span class="at">collapse=</span><span class="st">", "</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb32-82"><a href="#cb32-82" aria-hidden="true" tabindex="-1"></a>          <span class="fu">cat</span>(<span class="st">"AUC: "</span>, <span class="fu">paste</span>(best_inner_auc), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb32-83"><a href="#cb32-83" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb32-84"><a href="#cb32-84" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb32-85"><a href="#cb32-85" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb32-86"><a href="#cb32-86" aria-hidden="true" tabindex="-1"></a>      <span class="fu">list</span>(<span class="at">model =</span> best_inner_model, <span class="at">auc =</span> best_inner_auc, </span>
<span id="cb32-87"><a href="#cb32-87" aria-hidden="true" tabindex="-1"></a>           <span class="at">iterations =</span> best_inner_iterations, </span>
<span id="cb32-88"><a href="#cb32-88" aria-hidden="true" tabindex="-1"></a>           <span class="at">vars =</span> best_inner_vars)</span>
<span id="cb32-89"><a href="#cb32-89" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb32-90"><a href="#cb32-90" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb32-91"><a href="#cb32-91" aria-hidden="true" tabindex="-1"></a>    best_result <span class="ot">&lt;-</span> <span class="fu">stepAUC</span>(variables, outer_train_data, target_name, iterations, inner_folds)</span>
<span id="cb32-92"><a href="#cb32-92" aria-hidden="true" tabindex="-1"></a>    best_model <span class="ot">&lt;-</span> best_result<span class="sc">$</span>model</span>
<span id="cb32-93"><a href="#cb32-93" aria-hidden="true" tabindex="-1"></a>    best_auc <span class="ot">&lt;-</span> best_result<span class="sc">$</span>auc</span>
<span id="cb32-94"><a href="#cb32-94" aria-hidden="true" tabindex="-1"></a>    best_iterations <span class="ot">&lt;-</span> best_result<span class="sc">$</span>iterations</span>
<span id="cb32-95"><a href="#cb32-95" aria-hidden="true" tabindex="-1"></a>    best_vars <span class="ot">&lt;-</span> best_result<span class="sc">$</span>vars</span>
<span id="cb32-96"><a href="#cb32-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-97"><a href="#cb32-97" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Evaluar el mejor modelo en el validation split del inner loop</span></span>
<span id="cb32-98"><a href="#cb32-98" aria-hidden="true" tabindex="-1"></a>    inner_auc_vals <span class="ot">&lt;-</span> <span class="fu">numeric</span>()</span>
<span id="cb32-99"><a href="#cb32-99" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (inner_index <span class="cf">in</span> <span class="fu">seq_along</span>(inner_folds)) {</span>
<span id="cb32-100"><a href="#cb32-100" aria-hidden="true" tabindex="-1"></a>      inner_train_data <span class="ot">&lt;-</span> outer_train_data[<span class="sc">-</span>inner_folds[[inner_index]], ]</span>
<span id="cb32-101"><a href="#cb32-101" aria-hidden="true" tabindex="-1"></a>      inner_test_data <span class="ot">&lt;-</span> outer_train_data[inner_folds[[inner_index]], ]</span>
<span id="cb32-102"><a href="#cb32-102" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb32-103"><a href="#cb32-103" aria-hidden="true" tabindex="-1"></a>      predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(best_model, <span class="at">newdata =</span> inner_test_data, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb32-104"><a href="#cb32-104" aria-hidden="true" tabindex="-1"></a>      roc_curve <span class="ot">&lt;-</span> <span class="fu">roc</span>(inner_test_data[[target_name]], predictions)</span>
<span id="cb32-105"><a href="#cb32-105" aria-hidden="true" tabindex="-1"></a>      inner_auc_vals[inner_index] <span class="ot">&lt;-</span> roc_curve<span class="sc">$</span>auc</span>
<span id="cb32-106"><a href="#cb32-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-107"><a href="#cb32-107" aria-hidden="true" tabindex="-1"></a>      pred_class <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(predictions <span class="sc">&gt;</span> threshold, <span class="st">"1"</span>, <span class="st">"0"</span>)</span>
<span id="cb32-108"><a href="#cb32-108" aria-hidden="true" tabindex="-1"></a>      confusion <span class="ot">&lt;-</span> <span class="fu">table</span>(<span class="at">Actual =</span> inner_test_data[[target_name]], <span class="at">Predicted =</span> pred_class)</span>
<span id="cb32-109"><a href="#cb32-109" aria-hidden="true" tabindex="-1"></a>      TP <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span>, confusion[<span class="dv">2</span>, <span class="dv">2</span>], <span class="dv">0</span>)</span>
<span id="cb32-110"><a href="#cb32-110" aria-hidden="true" tabindex="-1"></a>      TN <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span>, confusion[<span class="dv">1</span>, <span class="dv">1</span>], <span class="dv">0</span>)</span>
<span id="cb32-111"><a href="#cb32-111" aria-hidden="true" tabindex="-1"></a>      FP <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span>, confusion[<span class="dv">1</span>, <span class="dv">2</span>], <span class="dv">0</span>)</span>
<span id="cb32-112"><a href="#cb32-112" aria-hidden="true" tabindex="-1"></a>      FN <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span>, confusion[<span class="dv">2</span>, <span class="dv">1</span>], <span class="dv">0</span>)</span>
<span id="cb32-113"><a href="#cb32-113" aria-hidden="true" tabindex="-1"></a>      auc <span class="ot">&lt;-</span> roc_curve<span class="sc">$</span>auc</span>
<span id="cb32-114"><a href="#cb32-114" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb32-115"><a href="#cb32-115" aria-hidden="true" tabindex="-1"></a>      inner_metrics <span class="ot">&lt;-</span> <span class="fu">setNames</span>(<span class="fu">c</span>(outer_index, inner_index, TP, TN, FP, FN, auc), <span class="fu">names</span>(inner_fold_metrics))</span>
<span id="cb32-116"><a href="#cb32-116" aria-hidden="true" tabindex="-1"></a>      inner_fold_metrics <span class="ot">&lt;-</span> <span class="fu">rbind</span>(inner_fold_metrics, <span class="fu">as.data.frame</span>(<span class="fu">t</span>(inner_metrics)))</span>
<span id="cb32-117"><a href="#cb32-117" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb32-118"><a href="#cb32-118" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb32-119"><a href="#cb32-119" aria-hidden="true" tabindex="-1"></a>    best_inner_auc <span class="ot">&lt;-</span> <span class="fu">mean</span>(inner_auc_vals, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb32-120"><a href="#cb32-120" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Reentrenar el mejor modelo con todos los datos de outer_train_data</span></span>
<span id="cb32-121"><a href="#cb32-121" aria-hidden="true" tabindex="-1"></a>    best_model <span class="ot">&lt;-</span> <span class="fu">glmboost</span>(<span class="fu">as.formula</span>(<span class="fu">paste</span>(target_name, <span class="st">"~"</span>, <span class="fu">paste</span>(best_vars, <span class="at">collapse =</span> <span class="st">"+"</span>))),</span>
<span id="cb32-122"><a href="#cb32-122" aria-hidden="true" tabindex="-1"></a>                           <span class="at">data =</span> outer_train_data, <span class="at">family =</span> <span class="fu">Binomial</span>(),</span>
<span id="cb32-123"><a href="#cb32-123" aria-hidden="true" tabindex="-1"></a>                           <span class="at">control =</span> <span class="fu">boost_control</span>(<span class="at">mstop =</span> best_iterations))</span>
<span id="cb32-124"><a href="#cb32-124" aria-hidden="true" tabindex="-1"></a>    predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(best_model, outer_test_data, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb32-125"><a href="#cb32-125" aria-hidden="true" tabindex="-1"></a>    pred_class <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(predictions <span class="sc">&gt;</span> threshold, <span class="st">"1"</span>, <span class="st">"0"</span>)</span>
<span id="cb32-126"><a href="#cb32-126" aria-hidden="true" tabindex="-1"></a>    confusion <span class="ot">&lt;-</span> <span class="fu">table</span>(<span class="at">Actual =</span> outer_test_data[[target_name]], <span class="at">Predicted =</span> pred_class)</span>
<span id="cb32-127"><a href="#cb32-127" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb32-128"><a href="#cb32-128" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">nrow</span>(confusion) <span class="sc">&lt;</span> <span class="dv">2</span> <span class="sc">||</span> <span class="fu">ncol</span>(confusion) <span class="sc">&lt;</span> <span class="dv">2</span>) {</span>
<span id="cb32-129"><a href="#cb32-129" aria-hidden="true" tabindex="-1"></a>      TP <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span>, confusion[<span class="dv">2</span>, <span class="dv">2</span>], <span class="dv">0</span>)</span>
<span id="cb32-130"><a href="#cb32-130" aria-hidden="true" tabindex="-1"></a>      TN <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span>, confusion[<span class="dv">1</span>, <span class="dv">1</span>], <span class="dv">0</span>)</span>
<span id="cb32-131"><a href="#cb32-131" aria-hidden="true" tabindex="-1"></a>      FP <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span>, confusion[<span class="dv">1</span>, <span class="dv">2</span>], <span class="dv">0</span>)</span>
<span id="cb32-132"><a href="#cb32-132" aria-hidden="true" tabindex="-1"></a>      FN <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span>, confusion[<span class="dv">2</span>, <span class="dv">1</span>], <span class="dv">0</span>)</span>
<span id="cb32-133"><a href="#cb32-133" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb32-134"><a href="#cb32-134" aria-hidden="true" tabindex="-1"></a>      TP <span class="ot">&lt;-</span> confusion[<span class="dv">2</span>, <span class="dv">2</span>]</span>
<span id="cb32-135"><a href="#cb32-135" aria-hidden="true" tabindex="-1"></a>      TN <span class="ot">&lt;-</span> confusion[<span class="dv">1</span>, <span class="dv">1</span>]</span>
<span id="cb32-136"><a href="#cb32-136" aria-hidden="true" tabindex="-1"></a>      FP <span class="ot">&lt;-</span> confusion[<span class="dv">1</span>, <span class="dv">2</span>]</span>
<span id="cb32-137"><a href="#cb32-137" aria-hidden="true" tabindex="-1"></a>      FN <span class="ot">&lt;-</span> confusion[<span class="dv">2</span>, <span class="dv">1</span>]</span>
<span id="cb32-138"><a href="#cb32-138" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb32-139"><a href="#cb32-139" aria-hidden="true" tabindex="-1"></a>    auc <span class="ot">&lt;-</span> <span class="fu">roc</span>(outer_test_data[[target_name]], predictions)<span class="sc">$</span>auc</span>
<span id="cb32-140"><a href="#cb32-140" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb32-141"><a href="#cb32-141" aria-hidden="true" tabindex="-1"></a>    metrics <span class="ot">&lt;-</span> <span class="fu">setNames</span>(<span class="fu">c</span>(outer_index, TP, TN, FP, FN, auc, </span>
<span id="cb32-142"><a href="#cb32-142" aria-hidden="true" tabindex="-1"></a>                          best_iterations, <span class="fu">paste</span>(best_vars, <span class="at">collapse =</span> <span class="st">","</span>)), </span>
<span id="cb32-143"><a href="#cb32-143" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">names</span>(performance_metrics))</span>
<span id="cb32-144"><a href="#cb32-144" aria-hidden="true" tabindex="-1"></a>    performance_metrics <span class="ot">&lt;-</span> <span class="fu">rbind</span>(performance_metrics, <span class="fu">as.data.frame</span>(<span class="fu">t</span>(metrics)))</span>
<span id="cb32-145"><a href="#cb32-145" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb32-146"><a href="#cb32-146" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Performance:"</span>, <span class="fu">paste</span>(performance_metrics))</span>
<span id="cb32-147"><a href="#cb32-147" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Confusion Matrix for Fold %d:</span><span class="sc">\n</span><span class="st">"</span>, outer_index))</span>
<span id="cb32-148"><a href="#cb32-148" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(confusion)</span>
<span id="cb32-149"><a href="#cb32-149" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Metrics for Fold %d:</span><span class="sc">\n</span><span class="st">"</span>, outer_index))</span>
<span id="cb32-150"><a href="#cb32-150" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"TP: %d, TN: %d, FP: %d, FN: %d, AUC: %f, Best Iterations: %d, Best Variables: %s</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb32-151"><a href="#cb32-151" aria-hidden="true" tabindex="-1"></a>                TP, TN, FP, FN, auc, best_iterations, <span class="fu">paste</span>(best_vars, <span class="at">collapse =</span> <span class="st">","</span>)))</span>
<span id="cb32-152"><a href="#cb32-152" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb32-153"><a href="#cb32-153" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb32-154"><a href="#cb32-154" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="at">performance_metrics =</span> performance_metrics, <span class="at">inner_fold_metrics =</span> inner_fold_metrics)</span>
<span id="cb32-155"><a href="#cb32-155" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb32-156"><a href="#cb32-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-157"><a href="#cb32-157" aria-hidden="true" tabindex="-1"></a>evaluate_with_seeds_AdaBoost_stepAUC <span class="ot">&lt;-</span> </span>
<span id="cb32-158"><a href="#cb32-158" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(evaluation_function, data, target_var, vars, threshold, seeds, outer, inner, iterations) {</span>
<span id="cb32-159"><a href="#cb32-159" aria-hidden="true" tabindex="-1"></a>  results_list <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb32-160"><a href="#cb32-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-161"><a href="#cb32-161" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (seed <span class="cf">in</span> seeds) {</span>
<span id="cb32-162"><a href="#cb32-162" aria-hidden="true" tabindex="-1"></a>    <span class="fu">set.seed</span>(seed)</span>
<span id="cb32-163"><a href="#cb32-163" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Evaluating with seed:"</span>, seed, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb32-164"><a href="#cb32-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-165"><a href="#cb32-165" aria-hidden="true" tabindex="-1"></a>    results <span class="ot">&lt;-</span> <span class="fu">evaluation_function</span>(<span class="at">data =</span> data, </span>
<span id="cb32-166"><a href="#cb32-166" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">target_name =</span> target_var, </span>
<span id="cb32-167"><a href="#cb32-167" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">variables =</span> vars, </span>
<span id="cb32-168"><a href="#cb32-168" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">threshold =</span> threshold, </span>
<span id="cb32-169"><a href="#cb32-169" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">outer =</span> outer, </span>
<span id="cb32-170"><a href="#cb32-170" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">inner =</span> inner, </span>
<span id="cb32-171"><a href="#cb32-171" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">seed =</span> seed,</span>
<span id="cb32-172"><a href="#cb32-172" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">iterations =</span> iterations)</span>
<span id="cb32-173"><a href="#cb32-173" aria-hidden="true" tabindex="-1"></a>    results_list[[<span class="fu">paste0</span>(<span class="st">"seed_"</span>, seed)]] <span class="ot">&lt;-</span> results</span>
<span id="cb32-174"><a href="#cb32-174" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb32-175"><a href="#cb32-175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-176"><a href="#cb32-176" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(results_list)</span>
<span id="cb32-177"><a href="#cb32-177" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb32-178"><a href="#cb32-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-179"><a href="#cb32-179" aria-hidden="true" tabindex="-1"></a>performance_adaboost_stepAUC <span class="ot">&lt;-</span> <span class="fu">evaluate_with_seeds_AdaBoost_stepAUC</span>(</span>
<span id="cb32-180"><a href="#cb32-180" aria-hidden="true" tabindex="-1"></a>  <span class="at">evaluation_function =</span> double_cross_validation_adaboost_stepAUC,</span>
<span id="cb32-181"><a href="#cb32-181" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_factor,</span>
<span id="cb32-182"><a href="#cb32-182" aria-hidden="true" tabindex="-1"></a>  <span class="at">outer =</span> <span class="dv">5</span>,</span>
<span id="cb32-183"><a href="#cb32-183" aria-hidden="true" tabindex="-1"></a>  <span class="at">inner =</span> <span class="dv">2</span>,</span>
<span id="cb32-184"><a href="#cb32-184" aria-hidden="true" tabindex="-1"></a>  <span class="at">target_var =</span> <span class="st">"PCR"</span>,</span>
<span id="cb32-185"><a href="#cb32-185" aria-hidden="true" tabindex="-1"></a>  <span class="at">vars =</span> todas_variables_factor,</span>
<span id="cb32-186"><a href="#cb32-186" aria-hidden="true" tabindex="-1"></a>  <span class="at">threshold =</span> .<span class="dv">35</span>,</span>
<span id="cb32-187"><a href="#cb32-187" aria-hidden="true" tabindex="-1"></a>  <span class="at">iterations =</span> <span class="fu">c</span>(<span class="dv">50</span>, <span class="dv">100</span>, <span class="dv">150</span>, <span class="dv">200</span>),</span>
<span id="cb32-188"><a href="#cb32-188" aria-hidden="true" tabindex="-1"></a>  <span class="at">seeds =</span> seeds</span>
<span id="cb32-189"><a href="#cb32-189" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"RData_Files_Algorithms/AdaBoost_StepAUC.RData"</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="embedded-lasso-1" class="level3" data-number="3.2.5">
<h3 data-number="3.2.5" class="anchored" data-anchor-id="embedded-lasso-1"><span class="header-section-number">3.2.5</span> Embedded (Lasso)</h3>
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>double_cross_validation_adaboost_lasso <span class="ot">&lt;-</span> <span class="cf">function</span>(data, target_name, outer, inner, iterations, variables, threshold, seed) {</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(seed)</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  performance_metrics <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Fold =</span> <span class="fu">integer</span>(), <span class="at">TP =</span> <span class="fu">integer</span>(), <span class="at">TN =</span> <span class="fu">integer</span>(),</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">FP =</span> <span class="fu">integer</span>(), <span class="at">FN =</span> <span class="fu">integer</span>(), <span class="at">AUC =</span> <span class="fu">numeric</span>(),</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">Best_Iteration =</span> <span class="fu">integer</span>(), </span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">Best_Variables =</span> <span class="fu">character</span>(), <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>  inner_fold_metrics <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Fold =</span> <span class="fu">integer</span>(), <span class="at">Inner_Fold =</span> <span class="fu">integer</span>(), </span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">TP =</span> <span class="fu">integer</span>(), <span class="at">TN =</span> <span class="fu">integer</span>(), <span class="at">FP =</span> <span class="fu">integer</span>(), </span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">FN =</span> <span class="fu">integer</span>(), <span class="at">AUC =</span> <span class="fu">numeric</span>(), <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Convertir las variables del dataset con model.matrix</span></span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>  target <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(data[[target_name]])  <span class="co"># Aseguramos que la variable de respuesta sea factor</span></span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>  features <span class="ot">&lt;-</span> data[, <span class="fu">setdiff</span>(<span class="fu">names</span>(data), target_name)]</span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>  data_matrix <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">model.matrix</span>(<span class="sc">~</span> ., <span class="at">data=</span>features)[,<span class="sc">-</span><span class="dv">1</span>])  <span class="co"># Eliminar el intercepto</span></span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>  data_matrix[[target_name]] <span class="ot">&lt;-</span> target</span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a>  outer_folds <span class="ot">&lt;-</span> <span class="fu">createFolds</span>(data_matrix[[target_name]], <span class="at">k =</span> outer)</span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (outer_index <span class="cf">in</span> <span class="fu">seq_along</span>(outer_folds)) {</span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a>    outer_train_data <span class="ot">&lt;-</span> data_matrix[<span class="sc">-</span>outer_folds[[outer_index]], ]</span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a>    outer_test_data <span class="ot">&lt;-</span> data_matrix[outer_folds[[outer_index]], ]</span>
<span id="cb34-23"><a href="#cb34-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb34-24"><a href="#cb34-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Outer Fold %d</span><span class="sc">\n</span><span class="st">"</span>, outer_index))</span>
<span id="cb34-25"><a href="#cb34-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Training Data - Class 0: "</span>, <span class="fu">sum</span>(outer_train_data[[target_name]] <span class="sc">==</span> <span class="dv">0</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb34-26"><a href="#cb34-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Training Data - Class 1: "</span>, <span class="fu">sum</span>(outer_train_data[[target_name]] <span class="sc">==</span> <span class="dv">1</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb34-27"><a href="#cb34-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Testing Data - Class 0: "</span>, <span class="fu">sum</span>(outer_test_data[[target_name]] <span class="sc">==</span> <span class="dv">0</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb34-28"><a href="#cb34-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Testing Data - Class 1: "</span>, <span class="fu">sum</span>(outer_test_data[[target_name]] <span class="sc">==</span> <span class="dv">1</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb34-29"><a href="#cb34-29" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb34-30"><a href="#cb34-30" aria-hidden="true" tabindex="-1"></a>    inner_folds <span class="ot">&lt;-</span> <span class="fu">createFolds</span>(outer_train_data[[target_name]], <span class="at">k =</span> inner)</span>
<span id="cb34-31"><a href="#cb34-31" aria-hidden="true" tabindex="-1"></a>    best_model <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb34-32"><a href="#cb34-32" aria-hidden="true" tabindex="-1"></a>    best_auc <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb34-33"><a href="#cb34-33" aria-hidden="true" tabindex="-1"></a>    best_iteration <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb34-34"><a href="#cb34-34" aria-hidden="true" tabindex="-1"></a>    best_vars <span class="ot">&lt;-</span> <span class="fu">colnames</span>(outer_train_data)[<span class="sc">!</span><span class="fu">colnames</span>(outer_train_data) <span class="sc">%in%</span> target_name]</span>
<span id="cb34-35"><a href="#cb34-35" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb34-36"><a href="#cb34-36" aria-hidden="true" tabindex="-1"></a>    grid <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">iteration =</span> iterations)</span>
<span id="cb34-37"><a href="#cb34-37" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb34-38"><a href="#cb34-38" aria-hidden="true" tabindex="-1"></a>    select_vars_lasso <span class="ot">&lt;-</span> <span class="cf">function</span>(data, target_name) {</span>
<span id="cb34-39"><a href="#cb34-39" aria-hidden="true" tabindex="-1"></a>      target <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(data[[target_name]]) <span class="sc">-</span> <span class="dv">1</span>  <span class="co"># Convertimos a numérico para Lasso</span></span>
<span id="cb34-40"><a href="#cb34-40" aria-hidden="true" tabindex="-1"></a>      features <span class="ot">&lt;-</span> data[, <span class="fu">setdiff</span>(<span class="fu">names</span>(data), target_name)]</span>
<span id="cb34-41"><a href="#cb34-41" aria-hidden="true" tabindex="-1"></a>      X <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(<span class="sc">~</span> ., <span class="at">data=</span>features)[,<span class="sc">-</span><span class="dv">1</span>]  <span class="co"># Eliminamos el intercepto</span></span>
<span id="cb34-42"><a href="#cb34-42" aria-hidden="true" tabindex="-1"></a>      y <span class="ot">&lt;-</span> target</span>
<span id="cb34-43"><a href="#cb34-43" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb34-44"><a href="#cb34-44" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Ajustamos el modelo Lasso</span></span>
<span id="cb34-45"><a href="#cb34-45" aria-hidden="true" tabindex="-1"></a>      lasso_model <span class="ot">&lt;-</span> <span class="fu">cv.glmnet</span>(X, y, <span class="at">alpha=</span><span class="dv">1</span>)</span>
<span id="cb34-46"><a href="#cb34-46" aria-hidden="true" tabindex="-1"></a>      lasso_coef <span class="ot">&lt;-</span> <span class="fu">coef</span>(lasso_model, <span class="at">s =</span> <span class="st">"lambda.min"</span>)</span>
<span id="cb34-47"><a href="#cb34-47" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb34-48"><a href="#cb34-48" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Seleccionamos las variables no nulas</span></span>
<span id="cb34-49"><a href="#cb34-49" aria-hidden="true" tabindex="-1"></a>      selected_vars <span class="ot">&lt;-</span> <span class="fu">rownames</span>(lasso_coef)[lasso_coef[, <span class="dv">1</span>] <span class="sc">!=</span> <span class="dv">0</span>]</span>
<span id="cb34-50"><a href="#cb34-50" aria-hidden="true" tabindex="-1"></a>      selected_vars <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(selected_vars, <span class="st">"(Intercept)"</span>)</span>
<span id="cb34-51"><a href="#cb34-51" aria-hidden="true" tabindex="-1"></a>      <span class="co">#cat("Selected variables by Lasso: ", paste(selected_vars, collapse=", "), "\n")</span></span>
<span id="cb34-52"><a href="#cb34-52" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(selected_vars)</span>
<span id="cb34-53"><a href="#cb34-53" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb34-54"><a href="#cb34-54" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb34-55"><a href="#cb34-55" aria-hidden="true" tabindex="-1"></a>    stepAUC <span class="ot">&lt;-</span> <span class="cf">function</span>(vars, data, target_name, grid, inner_folds) {</span>
<span id="cb34-56"><a href="#cb34-56" aria-hidden="true" tabindex="-1"></a>      best_inner_auc <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb34-57"><a href="#cb34-57" aria-hidden="true" tabindex="-1"></a>      best_inner_model <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb34-58"><a href="#cb34-58" aria-hidden="true" tabindex="-1"></a>      best_inner_iteration <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb34-59"><a href="#cb34-59" aria-hidden="true" tabindex="-1"></a>      best_inner_vars <span class="ot">&lt;-</span> vars</span>
<span id="cb34-60"><a href="#cb34-60" aria-hidden="true" tabindex="-1"></a>      improved <span class="ot">&lt;-</span> <span class="cn">TRUE</span></span>
<span id="cb34-61"><a href="#cb34-61" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb34-62"><a href="#cb34-62" aria-hidden="true" tabindex="-1"></a>      <span class="cf">while</span> (improved <span class="sc">&amp;&amp;</span> <span class="fu">length</span>(vars) <span class="sc">&gt;</span> <span class="dv">1</span>) {</span>
<span id="cb34-63"><a href="#cb34-63" aria-hidden="true" tabindex="-1"></a>        improved <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb34-64"><a href="#cb34-64" aria-hidden="true" tabindex="-1"></a>        best_auc_in_step <span class="ot">&lt;-</span> best_inner_auc</span>
<span id="cb34-65"><a href="#cb34-65" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb34-66"><a href="#cb34-66" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (params <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(grid)) {</span>
<span id="cb34-67"><a href="#cb34-67" aria-hidden="true" tabindex="-1"></a>          auc_vals <span class="ot">&lt;-</span> <span class="fu">numeric</span>()</span>
<span id="cb34-68"><a href="#cb34-68" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb34-69"><a href="#cb34-69" aria-hidden="true" tabindex="-1"></a>          <span class="cf">for</span> (inner_index <span class="cf">in</span> <span class="fu">seq_along</span>(inner_folds)) {</span>
<span id="cb34-70"><a href="#cb34-70" aria-hidden="true" tabindex="-1"></a>            inner_train_data <span class="ot">&lt;-</span> outer_train_data[<span class="sc">-</span>inner_folds[[inner_index]], ]</span>
<span id="cb34-71"><a href="#cb34-71" aria-hidden="true" tabindex="-1"></a>            inner_test_data <span class="ot">&lt;-</span> outer_train_data[inner_folds[[inner_index]], ]</span>
<span id="cb34-72"><a href="#cb34-72" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb34-73"><a href="#cb34-73" aria-hidden="true" tabindex="-1"></a>            selected_vars <span class="ot">&lt;-</span> <span class="fu">select_vars_lasso</span>(inner_train_data, target_name)</span>
<span id="cb34-74"><a href="#cb34-74" aria-hidden="true" tabindex="-1"></a>            formula <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(<span class="fu">paste</span>(target_name, <span class="st">"~"</span>, <span class="fu">paste</span>(selected_vars, <span class="at">collapse =</span> <span class="st">"+"</span>)))</span>
<span id="cb34-75"><a href="#cb34-75" aria-hidden="true" tabindex="-1"></a>            <span class="co">#cat("Testing with formula: ", deparse(formula), "\n")</span></span>
<span id="cb34-76"><a href="#cb34-76" aria-hidden="true" tabindex="-1"></a>            <span class="co">#cat("Grid parameters - iteration: ", grid$iteration[params], "\n")</span></span>
<span id="cb34-77"><a href="#cb34-77" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb34-78"><a href="#cb34-78" aria-hidden="true" tabindex="-1"></a>            result <span class="ot">&lt;-</span> <span class="fu">tryCatch</span>({</span>
<span id="cb34-79"><a href="#cb34-79" aria-hidden="true" tabindex="-1"></a>              model <span class="ot">&lt;-</span> <span class="fu">blackboost</span>(formula, <span class="at">data =</span> inner_train_data, <span class="at">family =</span> <span class="fu">Binomial</span>(), </span>
<span id="cb34-80"><a href="#cb34-80" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">control =</span> <span class="fu">boost_control</span>(<span class="at">mstop =</span> grid<span class="sc">$</span>iteration[params]))</span>
<span id="cb34-81"><a href="#cb34-81" aria-hidden="true" tabindex="-1"></a>              </span>
<span id="cb34-82"><a href="#cb34-82" aria-hidden="true" tabindex="-1"></a>              predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(model, inner_test_data, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb34-83"><a href="#cb34-83" aria-hidden="true" tabindex="-1"></a>              roc_curve <span class="ot">&lt;-</span> <span class="fu">roc</span>(inner_test_data[[target_name]], predictions)</span>
<span id="cb34-84"><a href="#cb34-84" aria-hidden="true" tabindex="-1"></a>              auc_vals[inner_index] <span class="ot">&lt;-</span> roc_curve<span class="sc">$</span>auc</span>
<span id="cb34-85"><a href="#cb34-85" aria-hidden="true" tabindex="-1"></a>              <span class="co">#cat("AUC for inner fold ", inner_index, ": ", roc_curve$auc, "\n")</span></span>
<span id="cb34-86"><a href="#cb34-86" aria-hidden="true" tabindex="-1"></a>              </span>
<span id="cb34-87"><a href="#cb34-87" aria-hidden="true" tabindex="-1"></a>            }, <span class="at">error =</span> <span class="cf">function</span>(e) {</span>
<span id="cb34-88"><a href="#cb34-88" aria-hidden="true" tabindex="-1"></a>              <span class="fu">cat</span>(<span class="st">"Error with variables: "</span>, <span class="fu">paste</span>(selected_vars, <span class="at">collapse =</span> <span class="st">", "</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb34-89"><a href="#cb34-89" aria-hidden="true" tabindex="-1"></a>              <span class="fu">cat</span>(<span class="st">"Error message: "</span>, e<span class="sc">$</span>message, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb34-90"><a href="#cb34-90" aria-hidden="true" tabindex="-1"></a>              auc_vals[inner_index] <span class="ot">&lt;-</span> <span class="cn">NA</span>  <span class="co"># Set to NA or some other indicator of failure</span></span>
<span id="cb34-91"><a href="#cb34-91" aria-hidden="true" tabindex="-1"></a>            })</span>
<span id="cb34-92"><a href="#cb34-92" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb34-93"><a href="#cb34-93" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb34-94"><a href="#cb34-94" aria-hidden="true" tabindex="-1"></a>          mean_auc <span class="ot">&lt;-</span> <span class="fu">mean</span>(auc_vals, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb34-95"><a href="#cb34-95" aria-hidden="true" tabindex="-1"></a>          <span class="co">#cat("Mean AUC for params - iteration: ", grid$iteration[params], ": ", mean_auc, "\n")</span></span>
<span id="cb34-96"><a href="#cb34-96" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.na</span>(mean_auc) <span class="sc">&amp;&amp;</span> mean_auc <span class="sc">&gt;</span> best_auc_in_step) {</span>
<span id="cb34-97"><a href="#cb34-97" aria-hidden="true" tabindex="-1"></a>            best_auc_in_step <span class="ot">&lt;-</span> mean_auc</span>
<span id="cb34-98"><a href="#cb34-98" aria-hidden="true" tabindex="-1"></a>            best_inner_model <span class="ot">&lt;-</span> model</span>
<span id="cb34-99"><a href="#cb34-99" aria-hidden="true" tabindex="-1"></a>            best_inner_iteration <span class="ot">&lt;-</span> grid<span class="sc">$</span>iteration[params]</span>
<span id="cb34-100"><a href="#cb34-100" aria-hidden="true" tabindex="-1"></a>            best_inner_vars <span class="ot">&lt;-</span> selected_vars</span>
<span id="cb34-101"><a href="#cb34-101" aria-hidden="true" tabindex="-1"></a>            improved <span class="ot">&lt;-</span> <span class="cn">TRUE</span></span>
<span id="cb34-102"><a href="#cb34-102" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb34-103"><a href="#cb34-103" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb34-104"><a href="#cb34-104" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb34-105"><a href="#cb34-105" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (improved) {</span>
<span id="cb34-106"><a href="#cb34-106" aria-hidden="true" tabindex="-1"></a>          vars <span class="ot">&lt;-</span> best_inner_vars</span>
<span id="cb34-107"><a href="#cb34-107" aria-hidden="true" tabindex="-1"></a>          best_inner_auc <span class="ot">&lt;-</span> best_auc_in_step</span>
<span id="cb34-108"><a href="#cb34-108" aria-hidden="true" tabindex="-1"></a>          <span class="fu">cat</span>(<span class="st">"Vars improved: "</span>, <span class="fu">paste</span>(vars, <span class="at">collapse=</span><span class="st">", "</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb34-109"><a href="#cb34-109" aria-hidden="true" tabindex="-1"></a>          <span class="fu">cat</span>(<span class="st">"AUC: "</span>, best_inner_auc, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb34-110"><a href="#cb34-110" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb34-111"><a href="#cb34-111" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb34-112"><a href="#cb34-112" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb34-113"><a href="#cb34-113" aria-hidden="true" tabindex="-1"></a>      <span class="fu">list</span>(<span class="at">model =</span> best_inner_model, <span class="at">auc =</span> best_inner_auc, </span>
<span id="cb34-114"><a href="#cb34-114" aria-hidden="true" tabindex="-1"></a>           <span class="at">iteration =</span> best_inner_iteration, <span class="at">vars =</span> best_inner_vars)</span>
<span id="cb34-115"><a href="#cb34-115" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb34-116"><a href="#cb34-116" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb34-117"><a href="#cb34-117" aria-hidden="true" tabindex="-1"></a>    best_result <span class="ot">&lt;-</span> <span class="fu">stepAUC</span>(best_vars, outer_train_data, target_name, grid, inner_folds)</span>
<span id="cb34-118"><a href="#cb34-118" aria-hidden="true" tabindex="-1"></a>    best_model <span class="ot">&lt;-</span> best_result<span class="sc">$</span>model</span>
<span id="cb34-119"><a href="#cb34-119" aria-hidden="true" tabindex="-1"></a>    best_auc <span class="ot">&lt;-</span> best_result<span class="sc">$</span>auc</span>
<span id="cb34-120"><a href="#cb34-120" aria-hidden="true" tabindex="-1"></a>    best_iteration <span class="ot">&lt;-</span> best_result<span class="sc">$</span>iteration</span>
<span id="cb34-121"><a href="#cb34-121" aria-hidden="true" tabindex="-1"></a>    best_vars <span class="ot">&lt;-</span> best_result<span class="sc">$</span>vars</span>
<span id="cb34-122"><a href="#cb34-122" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb34-123"><a href="#cb34-123" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">is.null</span>(best_model)) {</span>
<span id="cb34-124"><a href="#cb34-124" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cat</span>(<span class="st">"Error: No valid model found for outer fold "</span>, outer_index, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb34-125"><a href="#cb34-125" aria-hidden="true" tabindex="-1"></a>      <span class="cf">next</span></span>
<span id="cb34-126"><a href="#cb34-126" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb34-127"><a href="#cb34-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-128"><a href="#cb34-128" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Evaluar el mejor modelo en el validation split del inner loop</span></span>
<span id="cb34-129"><a href="#cb34-129" aria-hidden="true" tabindex="-1"></a>    inner_auc_vals <span class="ot">&lt;-</span> <span class="fu">numeric</span>()</span>
<span id="cb34-130"><a href="#cb34-130" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (inner_index <span class="cf">in</span> <span class="fu">seq_along</span>(inner_folds)) {</span>
<span id="cb34-131"><a href="#cb34-131" aria-hidden="true" tabindex="-1"></a>      inner_train_data <span class="ot">&lt;-</span> outer_train_data[<span class="sc">-</span>inner_folds[[inner_index]], ]</span>
<span id="cb34-132"><a href="#cb34-132" aria-hidden="true" tabindex="-1"></a>      inner_test_data <span class="ot">&lt;-</span> outer_train_data[inner_folds[[inner_index]], ]</span>
<span id="cb34-133"><a href="#cb34-133" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb34-134"><a href="#cb34-134" aria-hidden="true" tabindex="-1"></a>      predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(best_model, inner_test_data, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb34-135"><a href="#cb34-135" aria-hidden="true" tabindex="-1"></a>      roc_curve <span class="ot">&lt;-</span> <span class="fu">roc</span>(inner_test_data[[target_name]], predictions)</span>
<span id="cb34-136"><a href="#cb34-136" aria-hidden="true" tabindex="-1"></a>      inner_auc_vals[inner_index] <span class="ot">&lt;-</span> roc_curve<span class="sc">$</span>auc</span>
<span id="cb34-137"><a href="#cb34-137" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cat</span>(<span class="st">"Inner fold "</span>, inner_index, <span class="st">" AUC: "</span>, roc_curve<span class="sc">$</span>auc, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb34-138"><a href="#cb34-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-139"><a href="#cb34-139" aria-hidden="true" tabindex="-1"></a>      pred_class <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(predictions <span class="sc">&gt;</span> threshold, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb34-140"><a href="#cb34-140" aria-hidden="true" tabindex="-1"></a>      confusion <span class="ot">&lt;-</span> <span class="fu">table</span>(<span class="at">Actual =</span> inner_test_data[[target_name]], <span class="at">Predicted =</span> pred_class)</span>
<span id="cb34-141"><a href="#cb34-141" aria-hidden="true" tabindex="-1"></a>      TP <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span>, confusion[<span class="dv">2</span>, <span class="dv">2</span>], <span class="dv">0</span>)</span>
<span id="cb34-142"><a href="#cb34-142" aria-hidden="true" tabindex="-1"></a>      TN <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span>, confusion[<span class="dv">1</span>, <span class="dv">1</span>], <span class="dv">0</span>)</span>
<span id="cb34-143"><a href="#cb34-143" aria-hidden="true" tabindex="-1"></a>      FP <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span>, confusion[<span class="dv">1</span>, <span class="dv">2</span>], <span class="dv">0</span>)</span>
<span id="cb34-144"><a href="#cb34-144" aria-hidden="true" tabindex="-1"></a>      FN <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span>, confusion[<span class="dv">2</span>, <span class="dv">1</span>], <span class="dv">0</span>)</span>
<span id="cb34-145"><a href="#cb34-145" aria-hidden="true" tabindex="-1"></a>      auc <span class="ot">&lt;-</span> roc_curve<span class="sc">$</span>auc</span>
<span id="cb34-146"><a href="#cb34-146" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb34-147"><a href="#cb34-147" aria-hidden="true" tabindex="-1"></a>      inner_metrics <span class="ot">&lt;-</span> <span class="fu">setNames</span>(<span class="fu">c</span>(outer_index, inner_index, TP, TN, FP, FN, auc), <span class="fu">names</span>(inner_fold_metrics))</span>
<span id="cb34-148"><a href="#cb34-148" aria-hidden="true" tabindex="-1"></a>      inner_fold_metrics <span class="ot">&lt;-</span> <span class="fu">rbind</span>(inner_fold_metrics, <span class="fu">as.data.frame</span>(<span class="fu">t</span>(inner_metrics)))</span>
<span id="cb34-149"><a href="#cb34-149" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb34-150"><a href="#cb34-150" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb34-151"><a href="#cb34-151" aria-hidden="true" tabindex="-1"></a>    best_inner_auc <span class="ot">&lt;-</span> <span class="fu">mean</span>(inner_auc_vals, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb34-152"><a href="#cb34-152" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Best inner AUC: "</span>, best_inner_auc, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb34-153"><a href="#cb34-153" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Reentrenar el mejor modelo con todos los datos de outer_train_data</span></span>
<span id="cb34-154"><a href="#cb34-154" aria-hidden="true" tabindex="-1"></a>    best_model <span class="ot">&lt;-</span> <span class="fu">glmboost</span>(<span class="fu">as.formula</span>(<span class="fu">paste</span>(target_name, <span class="st">"~"</span>, <span class="fu">paste</span>(best_vars, <span class="at">collapse =</span> <span class="st">"+"</span>))),</span>
<span id="cb34-155"><a href="#cb34-155" aria-hidden="true" tabindex="-1"></a>                           <span class="at">data =</span> outer_train_data, <span class="at">family =</span> <span class="fu">Binomial</span>(),</span>
<span id="cb34-156"><a href="#cb34-156" aria-hidden="true" tabindex="-1"></a>                           <span class="at">control =</span> <span class="fu">boost_control</span>(<span class="at">mstop =</span> best_iteration))</span>
<span id="cb34-157"><a href="#cb34-157" aria-hidden="true" tabindex="-1"></a>    predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(best_model, outer_test_data, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb34-158"><a href="#cb34-158" aria-hidden="true" tabindex="-1"></a>    pred_class <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(predictions <span class="sc">&gt;</span> threshold, <span class="dv">1</span>, <span class="dv">0</span>)  <span class="co"># Asignar clases basadas en umbral</span></span>
<span id="cb34-159"><a href="#cb34-159" aria-hidden="true" tabindex="-1"></a>    confusion <span class="ot">&lt;-</span> <span class="fu">table</span>(<span class="at">Actual =</span> outer_test_data[[target_name]], <span class="at">Predicted =</span> pred_class)</span>
<span id="cb34-160"><a href="#cb34-160" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb34-161"><a href="#cb34-161" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">nrow</span>(confusion) <span class="sc">&lt;</span> <span class="dv">2</span> <span class="sc">||</span> <span class="fu">ncol</span>(confusion) <span class="sc">&lt;</span> <span class="dv">2</span>) {</span>
<span id="cb34-162"><a href="#cb34-162" aria-hidden="true" tabindex="-1"></a>      TP <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span>, confusion[<span class="dv">2</span>, <span class="dv">2</span>], <span class="dv">0</span>)</span>
<span id="cb34-163"><a href="#cb34-163" aria-hidden="true" tabindex="-1"></a>      TN <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span>, confusion[<span class="dv">1</span>, <span class="dv">1</span>], <span class="dv">0</span>)</span>
<span id="cb34-164"><a href="#cb34-164" aria-hidden="true" tabindex="-1"></a>      FP <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span>, confusion[<span class="dv">1</span>, <span class="dv">2</span>], <span class="dv">0</span>)</span>
<span id="cb34-165"><a href="#cb34-165" aria-hidden="true" tabindex="-1"></a>      FN <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span>, confusion[<span class="dv">2</span>, <span class="dv">1</span>], <span class="dv">0</span>)</span>
<span id="cb34-166"><a href="#cb34-166" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb34-167"><a href="#cb34-167" aria-hidden="true" tabindex="-1"></a>      TP <span class="ot">&lt;-</span> confusion[<span class="dv">2</span>, <span class="dv">2</span>]</span>
<span id="cb34-168"><a href="#cb34-168" aria-hidden="true" tabindex="-1"></a>      TN <span class="ot">&lt;-</span> confusion[<span class="dv">1</span>, <span class="dv">1</span>]</span>
<span id="cb34-169"><a href="#cb34-169" aria-hidden="true" tabindex="-1"></a>      FP <span class="ot">&lt;-</span> confusion[<span class="dv">1</span>, <span class="dv">2</span>]</span>
<span id="cb34-170"><a href="#cb34-170" aria-hidden="true" tabindex="-1"></a>      FN <span class="ot">&lt;-</span> confusion[<span class="dv">2</span>, <span class="dv">1</span>]</span>
<span id="cb34-171"><a href="#cb34-171" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb34-172"><a href="#cb34-172" aria-hidden="true" tabindex="-1"></a>    auc <span class="ot">&lt;-</span> <span class="fu">roc</span>(outer_test_data[[target_name]], predictions)<span class="sc">$</span>auc</span>
<span id="cb34-173"><a href="#cb34-173" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb34-174"><a href="#cb34-174" aria-hidden="true" tabindex="-1"></a>    metrics <span class="ot">&lt;-</span> <span class="fu">setNames</span>(<span class="fu">c</span>(outer_index, TP, TN, FP, FN, auc, </span>
<span id="cb34-175"><a href="#cb34-175" aria-hidden="true" tabindex="-1"></a>                          best_iteration, <span class="fu">paste</span>(best_vars, <span class="at">collapse =</span> <span class="st">","</span>)), </span>
<span id="cb34-176"><a href="#cb34-176" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">names</span>(performance_metrics))</span>
<span id="cb34-177"><a href="#cb34-177" aria-hidden="true" tabindex="-1"></a>    performance_metrics <span class="ot">&lt;-</span> <span class="fu">rbind</span>(performance_metrics, <span class="fu">as.data.frame</span>(<span class="fu">t</span>(metrics)))</span>
<span id="cb34-178"><a href="#cb34-178" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb34-179"><a href="#cb34-179" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Performance:</span><span class="sc">\n</span><span class="st">"</span>, <span class="fu">paste</span>(performance_metrics), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb34-180"><a href="#cb34-180" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Confusion Matrix for Fold %d:</span><span class="sc">\n</span><span class="st">"</span>, outer_index))</span>
<span id="cb34-181"><a href="#cb34-181" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(confusion)</span>
<span id="cb34-182"><a href="#cb34-182" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Metrics for Fold %d:</span><span class="sc">\n</span><span class="st">"</span>, outer_index))</span>
<span id="cb34-183"><a href="#cb34-183" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"TP: %d, TN: %d, FP: %d, FN: %d, AUC: %f, Best Iteration: %d, Best Variables: %s</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb34-184"><a href="#cb34-184" aria-hidden="true" tabindex="-1"></a>                TP, TN, FP, FN, auc, best_iteration, <span class="fu">paste</span>(best_vars, <span class="at">collapse =</span> <span class="st">","</span>)))</span>
<span id="cb34-185"><a href="#cb34-185" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb34-186"><a href="#cb34-186" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb34-187"><a href="#cb34-187" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="at">performance_metrics =</span> performance_metrics, <span class="at">inner_fold_metrics =</span> inner_fold_metrics)</span>
<span id="cb34-188"><a href="#cb34-188" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb34-189"><a href="#cb34-189" aria-hidden="true" tabindex="-1"></a>evaluate_with_seeds_AdaBoost_Lasso <span class="ot">&lt;-</span> </span>
<span id="cb34-190"><a href="#cb34-190" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(evaluation_function, data, target_var, vars, threshold, seeds, outer, inner, iterations) {</span>
<span id="cb34-191"><a href="#cb34-191" aria-hidden="true" tabindex="-1"></a>  results_list <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb34-192"><a href="#cb34-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-193"><a href="#cb34-193" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (seed <span class="cf">in</span> seeds) {</span>
<span id="cb34-194"><a href="#cb34-194" aria-hidden="true" tabindex="-1"></a>    <span class="fu">set.seed</span>(seed)</span>
<span id="cb34-195"><a href="#cb34-195" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Evaluating with seed:"</span>, seed, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb34-196"><a href="#cb34-196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-197"><a href="#cb34-197" aria-hidden="true" tabindex="-1"></a>    results <span class="ot">&lt;-</span> <span class="fu">evaluation_function</span>(<span class="at">data =</span> data, </span>
<span id="cb34-198"><a href="#cb34-198" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">target_name =</span> target_var, </span>
<span id="cb34-199"><a href="#cb34-199" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">variables =</span> vars, </span>
<span id="cb34-200"><a href="#cb34-200" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">threshold =</span> threshold, </span>
<span id="cb34-201"><a href="#cb34-201" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">outer =</span> outer, </span>
<span id="cb34-202"><a href="#cb34-202" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">inner =</span> inner, </span>
<span id="cb34-203"><a href="#cb34-203" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">seed =</span> seed,</span>
<span id="cb34-204"><a href="#cb34-204" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">iterations =</span> iterations)</span>
<span id="cb34-205"><a href="#cb34-205" aria-hidden="true" tabindex="-1"></a>    results_list[[<span class="fu">paste0</span>(<span class="st">"seed_"</span>, seed)]] <span class="ot">&lt;-</span> results</span>
<span id="cb34-206"><a href="#cb34-206" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb34-207"><a href="#cb34-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-208"><a href="#cb34-208" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(results_list)</span>
<span id="cb34-209"><a href="#cb34-209" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb34-210"><a href="#cb34-210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-211"><a href="#cb34-211" aria-hidden="true" tabindex="-1"></a>performance_adaboost_lasso <span class="ot">&lt;-</span> <span class="fu">evaluate_with_seeds_AdaBoost_stepAUC</span>(</span>
<span id="cb34-212"><a href="#cb34-212" aria-hidden="true" tabindex="-1"></a>  <span class="at">evaluation_function =</span> double_cross_validation_adaboost_lasso,</span>
<span id="cb34-213"><a href="#cb34-213" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_factor,</span>
<span id="cb34-214"><a href="#cb34-214" aria-hidden="true" tabindex="-1"></a>  <span class="at">outer =</span> <span class="dv">5</span>,</span>
<span id="cb34-215"><a href="#cb34-215" aria-hidden="true" tabindex="-1"></a>  <span class="at">inner =</span> <span class="dv">2</span>,</span>
<span id="cb34-216"><a href="#cb34-216" aria-hidden="true" tabindex="-1"></a>  <span class="at">target_var =</span> <span class="st">"PCR"</span>,</span>
<span id="cb34-217"><a href="#cb34-217" aria-hidden="true" tabindex="-1"></a>  <span class="at">vars =</span> todas_variables_factor,</span>
<span id="cb34-218"><a href="#cb34-218" aria-hidden="true" tabindex="-1"></a>  <span class="at">threshold =</span> .<span class="dv">35</span>,</span>
<span id="cb34-219"><a href="#cb34-219" aria-hidden="true" tabindex="-1"></a>  <span class="at">iterations =</span> <span class="fu">c</span>(<span class="dv">50</span>, <span class="dv">100</span>, <span class="dv">150</span>, <span class="dv">200</span>),</span>
<span id="cb34-220"><a href="#cb34-220" aria-hidden="true" tabindex="-1"></a>  <span class="at">seeds =</span> seeds</span>
<span id="cb34-221"><a href="#cb34-221" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"RData_Files_Algorithms/AdaBoost_Lasso.RData"</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="random-forest-1" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="random-forest-1"><span class="header-section-number">3.3</span> Random Forest</h2>
<section id="aparente-2" class="level3" data-number="3.3.1">
<h3 data-number="3.3.1" class="anchored" data-anchor-id="aparente-2"><span class="header-section-number">3.3.1</span> Aparente</h3>
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>evaluate_apparent_performance_model_randomForest <span class="ot">&lt;-</span> <span class="cf">function</span>(data, target_var, model_func, <span class="at">vars =</span> <span class="cn">NULL</span>, <span class="at">threshold =</span> <span class="fl">0.5</span>) {</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.null</span>(vars)) {</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>    vars <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(<span class="fu">names</span>(data), target_var)</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>  data[[target_var]] <span class="ot">&lt;-</span> <span class="fu">factor</span>(data[[target_var]], <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>  formula <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(<span class="fu">paste</span>(target_var, <span class="st">"~"</span>, <span class="fu">paste</span>(vars, <span class="at">collapse =</span> <span class="st">"+"</span>)))</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>  model <span class="ot">&lt;-</span> <span class="fu">model_func</span>(formula, data)</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>  predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(model, <span class="at">newdata =</span> data, <span class="at">type =</span> <span class="st">"prob"</span>)[, <span class="dv">2</span>]</span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>  actual_classes <span class="ot">&lt;-</span> data[[target_var]]</span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>  predicted_classes <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(predictions <span class="sc">&gt;</span> threshold, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>  confusion_matrix <span class="ot">&lt;-</span> <span class="fu">table</span>(predicted_classes, actual_classes)</span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a>  tp <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="st">"1"</span> <span class="sc">%in%</span> <span class="fu">rownames</span>(confusion_matrix) <span class="sc">&amp;&amp;</span> <span class="st">"1"</span> <span class="sc">%in%</span> <span class="fu">colnames</span>(confusion_matrix), confusion_matrix[<span class="st">"1"</span>, <span class="st">"1"</span>], <span class="dv">0</span>)</span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a>  tn <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="st">"0"</span> <span class="sc">%in%</span> <span class="fu">rownames</span>(confusion_matrix) <span class="sc">&amp;&amp;</span> <span class="st">"0"</span> <span class="sc">%in%</span> <span class="fu">colnames</span>(confusion_matrix), confusion_matrix[<span class="st">"0"</span>, <span class="st">"0"</span>], <span class="dv">0</span>)</span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a>  fp <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="st">"1"</span> <span class="sc">%in%</span> <span class="fu">rownames</span>(confusion_matrix) <span class="sc">&amp;&amp;</span> <span class="st">"0"</span> <span class="sc">%in%</span> <span class="fu">colnames</span>(confusion_matrix), confusion_matrix[<span class="st">"1"</span>, <span class="st">"0"</span>], <span class="dv">0</span>)</span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a>  fn <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="st">"0"</span> <span class="sc">%in%</span> <span class="fu">rownames</span>(confusion_matrix) <span class="sc">&amp;&amp;</span> <span class="st">"1"</span> <span class="sc">%in%</span> <span class="fu">colnames</span>(confusion_matrix), confusion_matrix[<span class="st">"0"</span>, <span class="st">"1"</span>], <span class="dv">0</span>)</span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true" tabindex="-1"></a>  accuracy <span class="ot">&lt;-</span> (tp <span class="sc">+</span> tn) <span class="sc">/</span> (tp <span class="sc">+</span> tn <span class="sc">+</span> fp <span class="sc">+</span> fn)</span>
<span id="cb36-22"><a href="#cb36-22" aria-hidden="true" tabindex="-1"></a>  precision <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(tp <span class="sc">+</span> fp <span class="sc">&gt;</span> <span class="dv">0</span>, tp <span class="sc">/</span> (tp <span class="sc">+</span> fp), <span class="dv">0</span>)</span>
<span id="cb36-23"><a href="#cb36-23" aria-hidden="true" tabindex="-1"></a>  recall <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(tp <span class="sc">+</span> fn <span class="sc">&gt;</span> <span class="dv">0</span>, tp <span class="sc">/</span> (tp <span class="sc">+</span> fn), <span class="dv">0</span>)</span>
<span id="cb36-24"><a href="#cb36-24" aria-hidden="true" tabindex="-1"></a>  f1_score <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(precision <span class="sc">+</span> recall <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="dv">2</span> <span class="sc">*</span> (precision <span class="sc">*</span> recall) <span class="sc">/</span> (precision <span class="sc">+</span> recall), <span class="dv">0</span>)</span>
<span id="cb36-25"><a href="#cb36-25" aria-hidden="true" tabindex="-1"></a>  roc_obj <span class="ot">&lt;-</span> pROC<span class="sc">::</span><span class="fu">roc</span>(actual_classes, predictions)</span>
<span id="cb36-26"><a href="#cb36-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-27"><a href="#cb36-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="at">confusion_matrix =</span> confusion_matrix, <span class="at">accuracy =</span> accuracy, <span class="at">precision =</span> precision, </span>
<span id="cb36-28"><a href="#cb36-28" aria-hidden="true" tabindex="-1"></a>       <span class="at">recall =</span> recall, <span class="at">f1_score =</span> f1_score, <span class="at">roc_curve =</span> roc_obj)</span>
<span id="cb36-29"><a href="#cb36-29" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb36-30"><a href="#cb36-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-31"><a href="#cb36-31" aria-hidden="true" tabindex="-1"></a>rf_model <span class="ot">&lt;-</span> <span class="cf">function</span>(formula, data) {</span>
<span id="cb36-32"><a href="#cb36-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(<span class="dv">90</span>)</span>
<span id="cb36-33"><a href="#cb36-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">randomForest</span>(<span class="at">formula =</span> formula, <span class="at">data =</span> data, <span class="at">ntree =</span> <span class="dv">100</span>, <span class="at">mtry =</span> <span class="dv">2</span>)</span>
<span id="cb36-34"><a href="#cb36-34" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb36-35"><a href="#cb36-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-36"><a href="#cb36-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-37"><a href="#cb36-37" aria-hidden="true" tabindex="-1"></a>resultadosAparentesRF <span class="ot">&lt;-</span> <span class="fu">evaluate_apparent_performance_model_randomForest</span>(<span class="at">data =</span> data_factor, <span class="at">target_var =</span> <span class="st">"PCR"</span>,</span>
<span id="cb36-38"><a href="#cb36-38" aria-hidden="true" tabindex="-1"></a>                                                             <span class="at">model_func =</span> rf_model,</span>
<span id="cb36-39"><a href="#cb36-39" aria-hidden="true" tabindex="-1"></a>                                                             <span class="at">vars =</span> <span class="st">"."</span>,</span>
<span id="cb36-40"><a href="#cb36-40" aria-hidden="true" tabindex="-1"></a>                                                             <span class="at">threshold =</span> .<span class="dv">35</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"RData_Files_Algorithms/RandomForest_Aparente.RData"</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="todas-las-variables-2" class="level3" data-number="3.3.2">
<h3 data-number="3.3.2" class="anchored" data-anchor-id="todas-las-variables-2"><span class="header-section-number">3.3.2</span> Todas las Variables</h3>
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>double_cross_validation_randomforest <span class="ot">&lt;-</span> <span class="cf">function</span>(data, target_name, outer, inner, ntree_values, mtry_values, variables, threshold, seed) {</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(seed)</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>  performance_metrics <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Fold =</span> <span class="fu">integer</span>(), <span class="at">TP =</span> <span class="fu">integer</span>(), <span class="at">TN =</span> <span class="fu">integer</span>(),</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">FP =</span> <span class="fu">integer</span>(), <span class="at">FN =</span> <span class="fu">integer</span>(), <span class="at">AUC =</span> <span class="fu">numeric</span>(), </span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">Best_ntree =</span> <span class="fu">integer</span>(), <span class="at">Best_mtry =</span> <span class="fu">integer</span>(), <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>  inner_fold_metrics <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Fold =</span> <span class="fu">integer</span>(), <span class="at">Inner_Fold =</span> <span class="fu">integer</span>(), </span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">TP =</span> <span class="fu">integer</span>(), <span class="at">TN =</span> <span class="fu">integer</span>(), <span class="at">FP =</span> <span class="fu">integer</span>(), </span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">FN =</span> <span class="fu">integer</span>(), <span class="at">AUC =</span> <span class="fu">numeric</span>(), <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>  data[[target_name]] <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(data[[target_name]])</span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>  outer_folds <span class="ot">&lt;-</span> <span class="fu">createFolds</span>(data[[target_name]], <span class="at">k =</span> outer, <span class="at">list =</span> <span class="cn">TRUE</span>, <span class="at">returnTrain =</span> <span class="cn">FALSE</span>)</span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (outer_index <span class="cf">in</span> <span class="fu">seq_along</span>(outer_folds)) {</span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>    outer_train_data <span class="ot">&lt;-</span> data[<span class="sc">-</span>outer_folds[[outer_index]], ]</span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a>    outer_test_data <span class="ot">&lt;-</span> data[outer_folds[[outer_index]], ]</span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Outer Fold %d</span><span class="sc">\n</span><span class="st">"</span>, outer_index))</span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Training Data - Class 0: "</span>, <span class="fu">sum</span>(outer_train_data[[target_name]] <span class="sc">==</span> <span class="st">"0"</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Training Data - Class 1: "</span>, <span class="fu">sum</span>(outer_train_data[[target_name]] <span class="sc">==</span> <span class="st">"1"</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Testing Data - Class 0: "</span>, <span class="fu">sum</span>(outer_test_data[[target_name]] <span class="sc">==</span> <span class="st">"0"</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb38-22"><a href="#cb38-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Testing Data - Class 1: "</span>, <span class="fu">sum</span>(outer_test_data[[target_name]] <span class="sc">==</span> <span class="st">"1"</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb38-23"><a href="#cb38-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb38-24"><a href="#cb38-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">sum</span>(outer_train_data[[target_name]] <span class="sc">==</span> <span class="st">"0"</span>) <span class="sc">==</span> <span class="dv">0</span> <span class="sc">||</span> <span class="fu">sum</span>(outer_train_data[[target_name]] <span class="sc">==</span> <span class="st">"1"</span>) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb38-25"><a href="#cb38-25" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cat</span>(<span class="st">"Skipping outer fold due to lack of class diversity</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb38-26"><a href="#cb38-26" aria-hidden="true" tabindex="-1"></a>      <span class="cf">next</span></span>
<span id="cb38-27"><a href="#cb38-27" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb38-28"><a href="#cb38-28" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb38-29"><a href="#cb38-29" aria-hidden="true" tabindex="-1"></a>    inner_folds <span class="ot">&lt;-</span> <span class="fu">createFolds</span>(outer_train_data[[target_name]], <span class="at">k =</span> inner, <span class="at">list =</span> <span class="cn">TRUE</span>, <span class="at">returnTrain =</span> <span class="cn">FALSE</span>)</span>
<span id="cb38-30"><a href="#cb38-30" aria-hidden="true" tabindex="-1"></a>    best_model <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb38-31"><a href="#cb38-31" aria-hidden="true" tabindex="-1"></a>    best_auc <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb38-32"><a href="#cb38-32" aria-hidden="true" tabindex="-1"></a>    best_ntree <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb38-33"><a href="#cb38-33" aria-hidden="true" tabindex="-1"></a>    best_mtry <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb38-34"><a href="#cb38-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-35"><a href="#cb38-35" aria-hidden="true" tabindex="-1"></a>    grid <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">ntree =</span> ntree_values, <span class="at">mtry =</span> mtry_values)</span>
<span id="cb38-36"><a href="#cb38-36" aria-hidden="true" tabindex="-1"></a>    formula <span class="ot">&lt;-</span> <span class="fu">reformulate</span>(variables, target_name)</span>
<span id="cb38-37"><a href="#cb38-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-38"><a href="#cb38-38" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (params <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(grid)) {</span>
<span id="cb38-39"><a href="#cb38-39" aria-hidden="true" tabindex="-1"></a>      inner_auc <span class="ot">&lt;-</span> <span class="fu">numeric</span>()</span>
<span id="cb38-40"><a href="#cb38-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-41"><a href="#cb38-41" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (inner_index <span class="cf">in</span> <span class="fu">seq_along</span>(inner_folds)) {</span>
<span id="cb38-42"><a href="#cb38-42" aria-hidden="true" tabindex="-1"></a>        inner_train_data <span class="ot">&lt;-</span> outer_train_data[<span class="sc">-</span>inner_folds[[inner_index]], ]</span>
<span id="cb38-43"><a href="#cb38-43" aria-hidden="true" tabindex="-1"></a>        inner_test_data <span class="ot">&lt;-</span> outer_train_data[inner_folds[[inner_index]], ]</span>
<span id="cb38-44"><a href="#cb38-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-45"><a href="#cb38-45" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="fu">sum</span>(inner_train_data[[target_name]] <span class="sc">==</span> <span class="st">"0"</span>) <span class="sc">==</span> <span class="dv">0</span> <span class="sc">||</span> <span class="fu">sum</span>(inner_train_data[[target_name]] <span class="sc">==</span> <span class="st">"1"</span>) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb38-46"><a href="#cb38-46" aria-hidden="true" tabindex="-1"></a>          <span class="fu">cat</span>(<span class="st">"Skipping inner fold due to lack of class diversity</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb38-47"><a href="#cb38-47" aria-hidden="true" tabindex="-1"></a>          <span class="cf">next</span></span>
<span id="cb38-48"><a href="#cb38-48" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb38-49"><a href="#cb38-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-50"><a href="#cb38-50" aria-hidden="true" tabindex="-1"></a>        result <span class="ot">&lt;-</span> <span class="fu">tryCatch</span>({</span>
<span id="cb38-51"><a href="#cb38-51" aria-hidden="true" tabindex="-1"></a>          model <span class="ot">&lt;-</span> <span class="fu">randomForest</span>(formula, <span class="at">data =</span> inner_train_data, <span class="at">ntree =</span> grid<span class="sc">$</span>ntree[params], <span class="at">mtry =</span> grid<span class="sc">$</span>mtry[params])</span>
<span id="cb38-52"><a href="#cb38-52" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb38-53"><a href="#cb38-53" aria-hidden="true" tabindex="-1"></a>          predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(model, inner_test_data, <span class="at">type =</span> <span class="st">"prob"</span>)[, <span class="dv">2</span>]</span>
<span id="cb38-54"><a href="#cb38-54" aria-hidden="true" tabindex="-1"></a>          roc_curve <span class="ot">&lt;-</span> <span class="fu">roc</span>(inner_test_data[[target_name]], predictions)</span>
<span id="cb38-55"><a href="#cb38-55" aria-hidden="true" tabindex="-1"></a>          inner_auc[inner_index] <span class="ot">&lt;-</span> roc_curve<span class="sc">$</span>auc</span>
<span id="cb38-56"><a href="#cb38-56" aria-hidden="true" tabindex="-1"></a>        }, <span class="at">error =</span> <span class="cf">function</span>(e) {</span>
<span id="cb38-57"><a href="#cb38-57" aria-hidden="true" tabindex="-1"></a>          <span class="fu">cat</span>(<span class="st">"Error with parameters: ntree ="</span>, grid<span class="sc">$</span>ntree[params], <span class="st">", mtry ="</span>, grid<span class="sc">$</span>mtry[params], <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb38-58"><a href="#cb38-58" aria-hidden="true" tabindex="-1"></a>          <span class="fu">cat</span>(<span class="st">"Error message: "</span>, e<span class="sc">$</span>message, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb38-59"><a href="#cb38-59" aria-hidden="true" tabindex="-1"></a>          inner_auc[inner_index] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb38-60"><a href="#cb38-60" aria-hidden="true" tabindex="-1"></a>        })</span>
<span id="cb38-61"><a href="#cb38-61" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb38-62"><a href="#cb38-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-63"><a href="#cb38-63" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="fu">mean</span>(inner_auc, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">&gt;</span> best_auc) {</span>
<span id="cb38-64"><a href="#cb38-64" aria-hidden="true" tabindex="-1"></a>        best_auc <span class="ot">&lt;-</span> <span class="fu">mean</span>(inner_auc, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb38-65"><a href="#cb38-65" aria-hidden="true" tabindex="-1"></a>        best_model <span class="ot">&lt;-</span> model</span>
<span id="cb38-66"><a href="#cb38-66" aria-hidden="true" tabindex="-1"></a>        best_ntree <span class="ot">&lt;-</span> grid<span class="sc">$</span>ntree[params]</span>
<span id="cb38-67"><a href="#cb38-67" aria-hidden="true" tabindex="-1"></a>        best_mtry <span class="ot">&lt;-</span> grid<span class="sc">$</span>mtry[params]</span>
<span id="cb38-68"><a href="#cb38-68" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb38-69"><a href="#cb38-69" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb38-70"><a href="#cb38-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-71"><a href="#cb38-71" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">is.null</span>(best_model)) {</span>
<span id="cb38-72"><a href="#cb38-72" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cat</span>(<span class="st">"No valid model found for outer fold "</span>, outer_index, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb38-73"><a href="#cb38-73" aria-hidden="true" tabindex="-1"></a>      <span class="cf">next</span></span>
<span id="cb38-74"><a href="#cb38-74" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb38-75"><a href="#cb38-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-76"><a href="#cb38-76" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Evaluar el mejor modelo en el validation split del inner loop </span></span>
<span id="cb38-77"><a href="#cb38-77" aria-hidden="true" tabindex="-1"></a>    inner_auc_vals <span class="ot">&lt;-</span> <span class="fu">numeric</span>()</span>
<span id="cb38-78"><a href="#cb38-78" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (inner_index <span class="cf">in</span> <span class="fu">seq_along</span>(inner_folds)) {</span>
<span id="cb38-79"><a href="#cb38-79" aria-hidden="true" tabindex="-1"></a>      inner_train_data <span class="ot">&lt;-</span> outer_train_data[<span class="sc">-</span>inner_folds[[inner_index]], ]</span>
<span id="cb38-80"><a href="#cb38-80" aria-hidden="true" tabindex="-1"></a>      inner_test_data <span class="ot">&lt;-</span> outer_train_data[inner_folds[[inner_index]], ]</span>
<span id="cb38-81"><a href="#cb38-81" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb38-82"><a href="#cb38-82" aria-hidden="true" tabindex="-1"></a>      predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(best_model, inner_test_data, <span class="at">type =</span> <span class="st">"prob"</span>)[, <span class="dv">2</span>]</span>
<span id="cb38-83"><a href="#cb38-83" aria-hidden="true" tabindex="-1"></a>      roc_curve <span class="ot">&lt;-</span> <span class="fu">roc</span>(inner_test_data[[target_name]], predictions)</span>
<span id="cb38-84"><a href="#cb38-84" aria-hidden="true" tabindex="-1"></a>      inner_auc_vals[inner_index] <span class="ot">&lt;-</span> roc_curve<span class="sc">$</span>auc</span>
<span id="cb38-85"><a href="#cb38-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-86"><a href="#cb38-86" aria-hidden="true" tabindex="-1"></a>      pred_class <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(predictions <span class="sc">&gt;</span> threshold, <span class="st">"1"</span>, <span class="st">"0"</span>)</span>
<span id="cb38-87"><a href="#cb38-87" aria-hidden="true" tabindex="-1"></a>      confusion <span class="ot">&lt;-</span> <span class="fu">table</span>(<span class="at">Actual =</span> inner_test_data[[target_name]], <span class="at">Predicted =</span> pred_class)</span>
<span id="cb38-88"><a href="#cb38-88" aria-hidden="true" tabindex="-1"></a>      TP <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span>, confusion[<span class="dv">2</span>, <span class="dv">2</span>], <span class="dv">0</span>)</span>
<span id="cb38-89"><a href="#cb38-89" aria-hidden="true" tabindex="-1"></a>      TN <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span>, confusion[<span class="dv">1</span>, <span class="dv">1</span>], <span class="dv">0</span>)</span>
<span id="cb38-90"><a href="#cb38-90" aria-hidden="true" tabindex="-1"></a>      FP <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span>, confusion[<span class="dv">1</span>, <span class="dv">2</span>], <span class="dv">0</span>)</span>
<span id="cb38-91"><a href="#cb38-91" aria-hidden="true" tabindex="-1"></a>      FN <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span>, confusion[<span class="dv">2</span>, <span class="dv">1</span>], <span class="dv">0</span>)</span>
<span id="cb38-92"><a href="#cb38-92" aria-hidden="true" tabindex="-1"></a>      auc <span class="ot">&lt;-</span> roc_curve<span class="sc">$</span>auc</span>
<span id="cb38-93"><a href="#cb38-93" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb38-94"><a href="#cb38-94" aria-hidden="true" tabindex="-1"></a>      inner_metrics <span class="ot">&lt;-</span> <span class="fu">setNames</span>(<span class="fu">c</span>(outer_index, inner_index, TP, TN, FP, FN, auc), <span class="fu">names</span>(inner_fold_metrics))</span>
<span id="cb38-95"><a href="#cb38-95" aria-hidden="true" tabindex="-1"></a>      inner_fold_metrics <span class="ot">&lt;-</span> <span class="fu">rbind</span>(inner_fold_metrics, <span class="fu">as.data.frame</span>(<span class="fu">t</span>(inner_metrics)))</span>
<span id="cb38-96"><a href="#cb38-96" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb38-97"><a href="#cb38-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-98"><a href="#cb38-98" aria-hidden="true" tabindex="-1"></a>    best_model <span class="ot">&lt;-</span> <span class="fu">randomForest</span>(formula, <span class="at">data =</span> outer_train_data, <span class="at">ntree =</span> best_ntree, <span class="at">mtry =</span> best_mtry)</span>
<span id="cb38-99"><a href="#cb38-99" aria-hidden="true" tabindex="-1"></a>    predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(best_model, outer_test_data, <span class="at">type =</span> <span class="st">"prob"</span>)[, <span class="dv">2</span>]</span>
<span id="cb38-100"><a href="#cb38-100" aria-hidden="true" tabindex="-1"></a>    pred_class <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(predictions <span class="sc">&gt;</span> threshold, <span class="st">"1"</span>, <span class="st">"0"</span>)</span>
<span id="cb38-101"><a href="#cb38-101" aria-hidden="true" tabindex="-1"></a>    confusion <span class="ot">&lt;-</span> <span class="fu">table</span>(<span class="at">Actual =</span> outer_test_data[[target_name]], <span class="at">Predicted =</span> pred_class)</span>
<span id="cb38-102"><a href="#cb38-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-103"><a href="#cb38-103" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">nrow</span>(confusion) <span class="sc">&lt;</span> <span class="dv">2</span> <span class="sc">||</span> <span class="fu">ncol</span>(confusion) <span class="sc">&lt;</span> <span class="dv">2</span>) {</span>
<span id="cb38-104"><a href="#cb38-104" aria-hidden="true" tabindex="-1"></a>      TP <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span>, confusion[<span class="dv">2</span>, <span class="dv">2</span>], <span class="dv">0</span>)</span>
<span id="cb38-105"><a href="#cb38-105" aria-hidden="true" tabindex="-1"></a>      TN <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span>, confusion[<span class="dv">1</span>, <span class="dv">1</span>], <span class="dv">0</span>)</span>
<span id="cb38-106"><a href="#cb38-106" aria-hidden="true" tabindex="-1"></a>      FP <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span>, confusion[<span class="dv">1</span>, <span class="dv">2</span>], <span class="dv">0</span>)</span>
<span id="cb38-107"><a href="#cb38-107" aria-hidden="true" tabindex="-1"></a>      FN <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span>, confusion[<span class="dv">2</span>, <span class="dv">1</span>], <span class="dv">0</span>)</span>
<span id="cb38-108"><a href="#cb38-108" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb38-109"><a href="#cb38-109" aria-hidden="true" tabindex="-1"></a>      TP <span class="ot">&lt;-</span> confusion[<span class="dv">2</span>, <span class="dv">2</span>]</span>
<span id="cb38-110"><a href="#cb38-110" aria-hidden="true" tabindex="-1"></a>      TN <span class="ot">&lt;-</span> confusion[<span class="dv">1</span>, <span class="dv">1</span>]</span>
<span id="cb38-111"><a href="#cb38-111" aria-hidden="true" tabindex="-1"></a>      FP <span class="ot">&lt;-</span> confusion[<span class="dv">1</span>, <span class="dv">2</span>]</span>
<span id="cb38-112"><a href="#cb38-112" aria-hidden="true" tabindex="-1"></a>      FN <span class="ot">&lt;-</span> confusion[<span class="dv">2</span>, <span class="dv">1</span>]</span>
<span id="cb38-113"><a href="#cb38-113" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb38-114"><a href="#cb38-114" aria-hidden="true" tabindex="-1"></a>    auc <span class="ot">&lt;-</span> <span class="fu">roc</span>(outer_test_data[[target_name]], predictions)<span class="sc">$</span>auc</span>
<span id="cb38-115"><a href="#cb38-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-116"><a href="#cb38-116" aria-hidden="true" tabindex="-1"></a>    metrics <span class="ot">&lt;-</span> <span class="fu">setNames</span>(<span class="fu">c</span>(outer_index, TP, TN, FP, FN, auc, best_ntree, best_mtry), <span class="fu">names</span>(performance_metrics))</span>
<span id="cb38-117"><a href="#cb38-117" aria-hidden="true" tabindex="-1"></a>    performance_metrics <span class="ot">&lt;-</span> <span class="fu">rbind</span>(performance_metrics, <span class="fu">as.data.frame</span>(<span class="fu">t</span>(metrics)))</span>
<span id="cb38-118"><a href="#cb38-118" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb38-119"><a href="#cb38-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-120"><a href="#cb38-120" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">performance_metrics =</span> performance_metrics, <span class="at">inner_fold_metrics =</span> inner_fold_metrics))</span>
<span id="cb38-121"><a href="#cb38-121" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb38-122"><a href="#cb38-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-123"><a href="#cb38-123" aria-hidden="true" tabindex="-1"></a>evaluate_with_seeds_RandomForest_TodasVariables_Asociacion <span class="ot">&lt;-</span> </span>
<span id="cb38-124"><a href="#cb38-124" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(evaluation_function, data, target_var, vars, threshold, seeds, outer, inner, ntree_values , mtry_values) {</span>
<span id="cb38-125"><a href="#cb38-125" aria-hidden="true" tabindex="-1"></a>  results_list <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb38-126"><a href="#cb38-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-127"><a href="#cb38-127" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (seed <span class="cf">in</span> seeds) {</span>
<span id="cb38-128"><a href="#cb38-128" aria-hidden="true" tabindex="-1"></a>    <span class="fu">set.seed</span>(seed)</span>
<span id="cb38-129"><a href="#cb38-129" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Evaluating with seed:"</span>, seed, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb38-130"><a href="#cb38-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-131"><a href="#cb38-131" aria-hidden="true" tabindex="-1"></a>    results <span class="ot">&lt;-</span> <span class="fu">evaluation_function</span>(<span class="at">data =</span> data, </span>
<span id="cb38-132"><a href="#cb38-132" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">target_name =</span> target_var, </span>
<span id="cb38-133"><a href="#cb38-133" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">variables =</span> vars, </span>
<span id="cb38-134"><a href="#cb38-134" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">threshold =</span> threshold, </span>
<span id="cb38-135"><a href="#cb38-135" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">outer =</span> outer, </span>
<span id="cb38-136"><a href="#cb38-136" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">inner =</span> inner, </span>
<span id="cb38-137"><a href="#cb38-137" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">seed =</span> seed,</span>
<span id="cb38-138"><a href="#cb38-138" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">ntree_values =</span> ntree_values,</span>
<span id="cb38-139"><a href="#cb38-139" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">mtry_values =</span> mtry_values)</span>
<span id="cb38-140"><a href="#cb38-140" aria-hidden="true" tabindex="-1"></a>    results_list[[<span class="fu">paste0</span>(<span class="st">"seed_"</span>, seed)]] <span class="ot">&lt;-</span> results</span>
<span id="cb38-141"><a href="#cb38-141" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb38-142"><a href="#cb38-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-143"><a href="#cb38-143" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(results_list)</span>
<span id="cb38-144"><a href="#cb38-144" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb38-145"><a href="#cb38-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-146"><a href="#cb38-146" aria-hidden="true" tabindex="-1"></a>performance_RandomForest_todasvariables <span class="ot">&lt;-</span> <span class="fu">evaluate_with_seeds_RandomForest_TodasVariables_Asociacion</span>(</span>
<span id="cb38-147"><a href="#cb38-147" aria-hidden="true" tabindex="-1"></a>  <span class="at">evaluation_function =</span> double_cross_validation_randomforest,</span>
<span id="cb38-148"><a href="#cb38-148" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_factor,</span>
<span id="cb38-149"><a href="#cb38-149" aria-hidden="true" tabindex="-1"></a>  <span class="at">outer =</span> <span class="dv">5</span>,</span>
<span id="cb38-150"><a href="#cb38-150" aria-hidden="true" tabindex="-1"></a>  <span class="at">inner =</span> <span class="dv">2</span>,</span>
<span id="cb38-151"><a href="#cb38-151" aria-hidden="true" tabindex="-1"></a>  <span class="at">target_var =</span> <span class="st">"PCR"</span>,</span>
<span id="cb38-152"><a href="#cb38-152" aria-hidden="true" tabindex="-1"></a>  <span class="at">ntree_values =</span> <span class="fu">c</span>(<span class="dv">100</span>, <span class="dv">200</span>, <span class="dv">300</span>, <span class="dv">400</span>, <span class="dv">500</span>),<span class="do">###</span></span>
<span id="cb38-153"><a href="#cb38-153" aria-hidden="true" tabindex="-1"></a>  <span class="at">mtry_values  =</span> <span class="fu">c</span>(<span class="fu">floor</span>(<span class="fu">sqrt</span>(<span class="fu">length</span>(todas_variables_factor))), </span>
<span id="cb38-154"><a href="#cb38-154" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">floor</span>(<span class="fu">sqrt</span>(<span class="fu">length</span>(todas_variables_factor))) <span class="sc">-</span> <span class="dv">1</span>, </span>
<span id="cb38-155"><a href="#cb38-155" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">floor</span>(<span class="fu">sqrt</span>(<span class="fu">length</span>(todas_variables_factor))) <span class="sc">+</span> <span class="dv">1</span>),</span>
<span id="cb38-156"><a href="#cb38-156" aria-hidden="true" tabindex="-1"></a>  <span class="at">vars =</span> todas_variables_factor,</span>
<span id="cb38-157"><a href="#cb38-157" aria-hidden="true" tabindex="-1"></a>  <span class="at">threshold =</span> .<span class="dv">35</span>,</span>
<span id="cb38-158"><a href="#cb38-158" aria-hidden="true" tabindex="-1"></a>  <span class="at">seeds =</span> seeds</span>
<span id="cb38-159"><a href="#cb38-159" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"RData_Files_Algorithms/RandomForest_TodasVariables.RData"</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="filtrado-asociación-2" class="level3" data-number="3.3.3">
<h3 data-number="3.3.3" class="anchored" data-anchor-id="filtrado-asociación-2"><span class="header-section-number">3.3.3</span> Filtrado (Asociación)</h3>
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>performance_RandomForest_Aparente <span class="ot">&lt;-</span> <span class="fu">evaluate_with_seeds_RandomForest_TodasVariables_Asociacion</span>(</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">evaluation_function =</span> double_cross_validation_randomforest,</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_factor,</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">outer =</span> <span class="dv">5</span>,</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">inner =</span> <span class="dv">2</span>,</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">target_var =</span> <span class="st">"PCR"</span>,</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">ntree_values =</span> <span class="fu">c</span>(<span class="dv">100</span>, <span class="dv">200</span>, <span class="dv">300</span>, <span class="dv">400</span>, <span class="dv">500</span>),<span class="do">###</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">mtry_values  =</span> <span class="fu">c</span>(<span class="fu">floor</span>(<span class="fu">sqrt</span>(<span class="fu">length</span>(asociacion))), </span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">floor</span>(<span class="fu">sqrt</span>(<span class="fu">length</span>(asociacion))) <span class="sc">-</span> <span class="dv">1</span>, </span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">floor</span>(<span class="fu">sqrt</span>(<span class="fu">length</span>(asociacion))) <span class="sc">+</span> <span class="dv">1</span>),</span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">vars =</span> asociacion,</span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">threshold =</span> .<span class="dv">35</span>,</span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">seeds =</span> seeds</span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"RData_Files_Algorithms/RandomForest_Asociacion.RData"</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="wrapped-stepauc-2" class="level3" data-number="3.3.4">
<h3 data-number="3.3.4" class="anchored" data-anchor-id="wrapped-stepauc-2"><span class="header-section-number">3.3.4</span> Wrapped (StepAUC)</h3>
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>double_cross_validation_randomforest_stepAUC <span class="ot">&lt;-</span> <span class="cf">function</span>(data, target_name, outer, inner, ntree_values, mtry_values, variables, threshold, seed) {</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(seed)</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>  performance_metrics <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Fold =</span> <span class="fu">integer</span>(), <span class="at">TP =</span> <span class="fu">integer</span>(), <span class="at">TN =</span> <span class="fu">integer</span>(),</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">FP =</span> <span class="fu">integer</span>(), <span class="at">FN =</span> <span class="fu">integer</span>(), <span class="at">AUC =</span> <span class="fu">numeric</span>(),</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">Best_Ntree =</span> <span class="fu">integer</span>(), <span class="at">Best_Mtry =</span> <span class="fu">integer</span>(), </span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">Best_Variables =</span> <span class="fu">character</span>(), <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>  inner_fold_metrics <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Fold =</span> <span class="fu">integer</span>(), <span class="at">Inner_Fold =</span> <span class="fu">integer</span>(), </span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">TP =</span> <span class="fu">integer</span>(), <span class="at">TN =</span> <span class="fu">integer</span>(), <span class="at">FP =</span> <span class="fu">integer</span>(), </span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">FN =</span> <span class="fu">integer</span>(), <span class="at">AUC =</span> <span class="fu">numeric</span>(), <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a>  data[[target_name]] <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(data[[target_name]])</span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a>  outer_folds <span class="ot">&lt;-</span> <span class="fu">createFolds</span>(data[[target_name]], <span class="at">k =</span> outer)</span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (outer_index <span class="cf">in</span> <span class="fu">seq_along</span>(outer_folds)) {</span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a>    outer_train_data <span class="ot">&lt;-</span> data[<span class="sc">-</span>outer_folds[[outer_index]], ]</span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a>    outer_test_data <span class="ot">&lt;-</span> data[outer_folds[[outer_index]], ]</span>
<span id="cb42-18"><a href="#cb42-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb42-19"><a href="#cb42-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Outer Fold %d</span><span class="sc">\n</span><span class="st">"</span>, outer_index))</span>
<span id="cb42-20"><a href="#cb42-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Training Data - Class 0: "</span>, <span class="fu">sum</span>(outer_train_data[[target_name]] <span class="sc">==</span> <span class="st">"0"</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb42-21"><a href="#cb42-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Training Data - Class 1: "</span>, <span class="fu">sum</span>(outer_train_data[[target_name]] <span class="sc">==</span> <span class="st">"1"</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb42-22"><a href="#cb42-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Testing Data - Class 0: "</span>, <span class="fu">sum</span>(outer_test_data[[target_name]] <span class="sc">==</span> <span class="st">"0"</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb42-23"><a href="#cb42-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Testing Data - Class 1: "</span>, <span class="fu">sum</span>(outer_test_data[[target_name]] <span class="sc">==</span> <span class="st">"1"</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb42-24"><a href="#cb42-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb42-25"><a href="#cb42-25" aria-hidden="true" tabindex="-1"></a>    inner_folds <span class="ot">&lt;-</span> <span class="fu">createFolds</span>(outer_train_data[[target_name]], <span class="at">k =</span> inner)</span>
<span id="cb42-26"><a href="#cb42-26" aria-hidden="true" tabindex="-1"></a>    best_model <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb42-27"><a href="#cb42-27" aria-hidden="true" tabindex="-1"></a>    best_auc <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb42-28"><a href="#cb42-28" aria-hidden="true" tabindex="-1"></a>    best_ntree <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb42-29"><a href="#cb42-29" aria-hidden="true" tabindex="-1"></a>    best_mtry <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb42-30"><a href="#cb42-30" aria-hidden="true" tabindex="-1"></a>    best_vars <span class="ot">&lt;-</span> variables</span>
<span id="cb42-31"><a href="#cb42-31" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb42-32"><a href="#cb42-32" aria-hidden="true" tabindex="-1"></a>    grid <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">ntree =</span> ntree_values, <span class="at">mtry =</span> mtry_values)</span>
<span id="cb42-33"><a href="#cb42-33" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb42-34"><a href="#cb42-34" aria-hidden="true" tabindex="-1"></a>    stepAUC <span class="ot">&lt;-</span> <span class="cf">function</span>(vars, data, target_name, grid, inner_folds) {</span>
<span id="cb42-35"><a href="#cb42-35" aria-hidden="true" tabindex="-1"></a>      current_vars <span class="ot">&lt;-</span> vars</span>
<span id="cb42-36"><a href="#cb42-36" aria-hidden="true" tabindex="-1"></a>      best_inner_auc <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb42-37"><a href="#cb42-37" aria-hidden="true" tabindex="-1"></a>      best_inner_model <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb42-38"><a href="#cb42-38" aria-hidden="true" tabindex="-1"></a>      best_inner_ntree <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb42-39"><a href="#cb42-39" aria-hidden="true" tabindex="-1"></a>      best_inner_mtry <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb42-40"><a href="#cb42-40" aria-hidden="true" tabindex="-1"></a>      best_inner_vars <span class="ot">&lt;-</span> current_vars</span>
<span id="cb42-41"><a href="#cb42-41" aria-hidden="true" tabindex="-1"></a>      improved <span class="ot">&lt;-</span> <span class="cn">TRUE</span></span>
<span id="cb42-42"><a href="#cb42-42" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb42-43"><a href="#cb42-43" aria-hidden="true" tabindex="-1"></a>      <span class="cf">while</span> (improved <span class="sc">&amp;&amp;</span> <span class="fu">length</span>(current_vars) <span class="sc">&gt;</span> <span class="dv">1</span>) {</span>
<span id="cb42-44"><a href="#cb42-44" aria-hidden="true" tabindex="-1"></a>        improved <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb42-45"><a href="#cb42-45" aria-hidden="true" tabindex="-1"></a>        best_auc_in_step <span class="ot">&lt;-</span> best_inner_auc</span>
<span id="cb42-46"><a href="#cb42-46" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb42-47"><a href="#cb42-47" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (var <span class="cf">in</span> current_vars) {</span>
<span id="cb42-48"><a href="#cb42-48" aria-hidden="true" tabindex="-1"></a>          temp_vars <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(current_vars, var)</span>
<span id="cb42-49"><a href="#cb42-49" aria-hidden="true" tabindex="-1"></a>          inner_auc <span class="ot">&lt;-</span> <span class="fu">numeric</span>()</span>
<span id="cb42-50"><a href="#cb42-50" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb42-51"><a href="#cb42-51" aria-hidden="true" tabindex="-1"></a>          <span class="cf">for</span> (params <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(grid)) {</span>
<span id="cb42-52"><a href="#cb42-52" aria-hidden="true" tabindex="-1"></a>            auc_vals <span class="ot">&lt;-</span> <span class="fu">numeric</span>()</span>
<span id="cb42-53"><a href="#cb42-53" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb42-54"><a href="#cb42-54" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> (inner_index <span class="cf">in</span> <span class="fu">seq_along</span>(inner_folds)) {</span>
<span id="cb42-55"><a href="#cb42-55" aria-hidden="true" tabindex="-1"></a>              inner_train_data <span class="ot">&lt;-</span> data[<span class="sc">-</span>inner_folds[[inner_index]], ]</span>
<span id="cb42-56"><a href="#cb42-56" aria-hidden="true" tabindex="-1"></a>              inner_test_data <span class="ot">&lt;-</span> data[inner_folds[[inner_index]], ]</span>
<span id="cb42-57"><a href="#cb42-57" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb42-58"><a href="#cb42-58" aria-hidden="true" tabindex="-1"></a>              result <span class="ot">&lt;-</span> <span class="fu">tryCatch</span>({</span>
<span id="cb42-59"><a href="#cb42-59" aria-hidden="true" tabindex="-1"></a>                model <span class="ot">&lt;-</span> <span class="fu">randomForest</span>(<span class="fu">as.formula</span>(<span class="fu">paste</span>(target_name, <span class="st">"~"</span>, <span class="fu">paste</span>(temp_vars, <span class="at">collapse =</span> <span class="st">"+"</span>))),</span>
<span id="cb42-60"><a href="#cb42-60" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">data =</span> inner_train_data, <span class="at">ntree =</span> grid<span class="sc">$</span>ntree[params], <span class="at">mtry =</span> grid<span class="sc">$</span>mtry[params])</span>
<span id="cb42-61"><a href="#cb42-61" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb42-62"><a href="#cb42-62" aria-hidden="true" tabindex="-1"></a>                predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(model, inner_test_data, <span class="at">type =</span> <span class="st">"prob"</span>)[, <span class="dv">2</span>]</span>
<span id="cb42-63"><a href="#cb42-63" aria-hidden="true" tabindex="-1"></a>                roc_curve <span class="ot">&lt;-</span> <span class="fu">roc</span>(inner_test_data[[target_name]], predictions)</span>
<span id="cb42-64"><a href="#cb42-64" aria-hidden="true" tabindex="-1"></a>                auc_vals[inner_index] <span class="ot">&lt;-</span> roc_curve<span class="sc">$</span>auc</span>
<span id="cb42-65"><a href="#cb42-65" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb42-66"><a href="#cb42-66" aria-hidden="true" tabindex="-1"></a>              }, <span class="at">error =</span> <span class="cf">function</span>(e) {</span>
<span id="cb42-67"><a href="#cb42-67" aria-hidden="true" tabindex="-1"></a>                <span class="fu">cat</span>(<span class="st">"Error with variables:"</span>, <span class="fu">paste</span>(temp_vars, <span class="at">collapse =</span> <span class="st">", "</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb42-68"><a href="#cb42-68" aria-hidden="true" tabindex="-1"></a>                auc_vals[inner_index] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb42-69"><a href="#cb42-69" aria-hidden="true" tabindex="-1"></a>              })</span>
<span id="cb42-70"><a href="#cb42-70" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb42-71"><a href="#cb42-71" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb42-72"><a href="#cb42-72" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> (<span class="fu">mean</span>(auc_vals, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">&gt;</span> best_auc_in_step) {</span>
<span id="cb42-73"><a href="#cb42-73" aria-hidden="true" tabindex="-1"></a>              best_auc_in_step <span class="ot">&lt;-</span> <span class="fu">mean</span>(auc_vals, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb42-74"><a href="#cb42-74" aria-hidden="true" tabindex="-1"></a>              best_inner_model <span class="ot">&lt;-</span> model</span>
<span id="cb42-75"><a href="#cb42-75" aria-hidden="true" tabindex="-1"></a>              best_inner_ntree <span class="ot">&lt;-</span> grid<span class="sc">$</span>ntree[params]</span>
<span id="cb42-76"><a href="#cb42-76" aria-hidden="true" tabindex="-1"></a>              best_inner_mtry <span class="ot">&lt;-</span> grid<span class="sc">$</span>mtry[params]</span>
<span id="cb42-77"><a href="#cb42-77" aria-hidden="true" tabindex="-1"></a>              best_inner_vars <span class="ot">&lt;-</span> temp_vars</span>
<span id="cb42-78"><a href="#cb42-78" aria-hidden="true" tabindex="-1"></a>              improved <span class="ot">&lt;-</span> <span class="cn">TRUE</span></span>
<span id="cb42-79"><a href="#cb42-79" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb42-80"><a href="#cb42-80" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb42-81"><a href="#cb42-81" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb42-82"><a href="#cb42-82" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb42-83"><a href="#cb42-83" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (improved) {</span>
<span id="cb42-84"><a href="#cb42-84" aria-hidden="true" tabindex="-1"></a>          current_vars <span class="ot">&lt;-</span> best_inner_vars</span>
<span id="cb42-85"><a href="#cb42-85" aria-hidden="true" tabindex="-1"></a>          best_inner_auc <span class="ot">&lt;-</span> best_auc_in_step</span>
<span id="cb42-86"><a href="#cb42-86" aria-hidden="true" tabindex="-1"></a>          <span class="fu">cat</span>(<span class="st">"Vars improved: "</span>, <span class="fu">paste</span>(current_vars, <span class="at">collapse=</span><span class="st">", "</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb42-87"><a href="#cb42-87" aria-hidden="true" tabindex="-1"></a>          <span class="fu">cat</span>(<span class="st">"AUC: "</span>, <span class="fu">paste</span>(best_inner_auc), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb42-88"><a href="#cb42-88" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb42-89"><a href="#cb42-89" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb42-90"><a href="#cb42-90" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb42-91"><a href="#cb42-91" aria-hidden="true" tabindex="-1"></a>      <span class="fu">list</span>(<span class="at">model =</span> best_inner_model, <span class="at">auc =</span> best_inner_auc, </span>
<span id="cb42-92"><a href="#cb42-92" aria-hidden="true" tabindex="-1"></a>           <span class="at">ntree =</span> best_inner_ntree, <span class="at">mtry =</span> best_inner_mtry, </span>
<span id="cb42-93"><a href="#cb42-93" aria-hidden="true" tabindex="-1"></a>           <span class="at">vars =</span> best_inner_vars)</span>
<span id="cb42-94"><a href="#cb42-94" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb42-95"><a href="#cb42-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-96"><a href="#cb42-96" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb42-97"><a href="#cb42-97" aria-hidden="true" tabindex="-1"></a>    best_result <span class="ot">&lt;-</span> <span class="fu">stepAUC</span>(variables, outer_train_data, target_name, grid, inner_folds)</span>
<span id="cb42-98"><a href="#cb42-98" aria-hidden="true" tabindex="-1"></a>    best_model <span class="ot">&lt;-</span> best_result<span class="sc">$</span>model</span>
<span id="cb42-99"><a href="#cb42-99" aria-hidden="true" tabindex="-1"></a>    best_auc <span class="ot">&lt;-</span> best_result<span class="sc">$</span>auc</span>
<span id="cb42-100"><a href="#cb42-100" aria-hidden="true" tabindex="-1"></a>    best_ntree <span class="ot">&lt;-</span> best_result<span class="sc">$</span>ntree</span>
<span id="cb42-101"><a href="#cb42-101" aria-hidden="true" tabindex="-1"></a>    best_mtry <span class="ot">&lt;-</span> best_result<span class="sc">$</span>mtry</span>
<span id="cb42-102"><a href="#cb42-102" aria-hidden="true" tabindex="-1"></a>    best_vars <span class="ot">&lt;-</span> best_result<span class="sc">$</span>vars</span>
<span id="cb42-103"><a href="#cb42-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-104"><a href="#cb42-104" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Evaluar el mejor modelo en el validation split del inner loop</span></span>
<span id="cb42-105"><a href="#cb42-105" aria-hidden="true" tabindex="-1"></a>    inner_auc_vals <span class="ot">&lt;-</span> <span class="fu">numeric</span>()</span>
<span id="cb42-106"><a href="#cb42-106" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (inner_index <span class="cf">in</span> <span class="fu">seq_along</span>(inner_folds)) {</span>
<span id="cb42-107"><a href="#cb42-107" aria-hidden="true" tabindex="-1"></a>      inner_train_data <span class="ot">&lt;-</span> outer_train_data[<span class="sc">-</span>inner_folds[[inner_index]], ]</span>
<span id="cb42-108"><a href="#cb42-108" aria-hidden="true" tabindex="-1"></a>      inner_test_data <span class="ot">&lt;-</span> outer_train_data[inner_folds[[inner_index]], ]</span>
<span id="cb42-109"><a href="#cb42-109" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb42-110"><a href="#cb42-110" aria-hidden="true" tabindex="-1"></a>      predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(best_model, inner_test_data, <span class="at">type =</span> <span class="st">"prob"</span>)[, <span class="dv">2</span>]</span>
<span id="cb42-111"><a href="#cb42-111" aria-hidden="true" tabindex="-1"></a>      roc_curve <span class="ot">&lt;-</span> <span class="fu">roc</span>(inner_test_data[[target_name]], predictions)</span>
<span id="cb42-112"><a href="#cb42-112" aria-hidden="true" tabindex="-1"></a>      inner_auc_vals[inner_index] <span class="ot">&lt;-</span> roc_curve<span class="sc">$</span>auc</span>
<span id="cb42-113"><a href="#cb42-113" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb42-114"><a href="#cb42-114" aria-hidden="true" tabindex="-1"></a>      pred_class <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(predictions <span class="sc">&gt;</span> threshold, <span class="st">"1"</span>, <span class="st">"0"</span>)</span>
<span id="cb42-115"><a href="#cb42-115" aria-hidden="true" tabindex="-1"></a>      confusion <span class="ot">&lt;-</span> <span class="fu">table</span>(<span class="at">Actual =</span> inner_test_data[[target_name]], <span class="at">Predicted =</span> pred_class)</span>
<span id="cb42-116"><a href="#cb42-116" aria-hidden="true" tabindex="-1"></a>      TP <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span>, confusion[<span class="dv">2</span>, <span class="dv">2</span>], <span class="dv">0</span>)</span>
<span id="cb42-117"><a href="#cb42-117" aria-hidden="true" tabindex="-1"></a>      TN <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span>, confusion[<span class="dv">1</span>, <span class="dv">1</span>], <span class="dv">0</span>)</span>
<span id="cb42-118"><a href="#cb42-118" aria-hidden="true" tabindex="-1"></a>      FP <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span>, confusion[<span class="dv">1</span>, <span class="dv">2</span>], <span class="dv">0</span>)</span>
<span id="cb42-119"><a href="#cb42-119" aria-hidden="true" tabindex="-1"></a>      FN <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span>, confusion[<span class="dv">2</span>, <span class="dv">1</span>], <span class="dv">0</span>)</span>
<span id="cb42-120"><a href="#cb42-120" aria-hidden="true" tabindex="-1"></a>      auc <span class="ot">&lt;-</span> roc_curve<span class="sc">$</span>auc</span>
<span id="cb42-121"><a href="#cb42-121" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb42-122"><a href="#cb42-122" aria-hidden="true" tabindex="-1"></a>      inner_metrics <span class="ot">&lt;-</span> <span class="fu">setNames</span>(<span class="fu">c</span>(outer_index, inner_index, TP, TN, FP, FN, auc), <span class="fu">names</span>(inner_fold_metrics))</span>
<span id="cb42-123"><a href="#cb42-123" aria-hidden="true" tabindex="-1"></a>      inner_fold_metrics <span class="ot">&lt;-</span> <span class="fu">rbind</span>(inner_fold_metrics, <span class="fu">as.data.frame</span>(<span class="fu">t</span>(inner_metrics)))</span>
<span id="cb42-124"><a href="#cb42-124" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb42-125"><a href="#cb42-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-126"><a href="#cb42-126" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb42-127"><a href="#cb42-127" aria-hidden="true" tabindex="-1"></a>    best_inner_auc <span class="ot">&lt;-</span> <span class="fu">mean</span>(inner_auc_vals, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb42-128"><a href="#cb42-128" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Reentrenar el mejor modelo con todos los datos de outer_train_data</span></span>
<span id="cb42-129"><a href="#cb42-129" aria-hidden="true" tabindex="-1"></a>    best_model <span class="ot">&lt;-</span> <span class="fu">randomForest</span>(<span class="fu">as.formula</span>(<span class="fu">paste</span>(target_name, <span class="st">"~"</span>, <span class="fu">paste</span>(best_vars, <span class="at">collapse =</span> <span class="st">"+"</span>))),</span>
<span id="cb42-130"><a href="#cb42-130" aria-hidden="true" tabindex="-1"></a>                    <span class="at">data =</span> outer_train_data, <span class="at">ntree =</span> best_ntree, <span class="at">mtry =</span> best_mtry)</span>
<span id="cb42-131"><a href="#cb42-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-132"><a href="#cb42-132" aria-hidden="true" tabindex="-1"></a>    predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(best_model, outer_test_data, <span class="at">type =</span> <span class="st">"prob"</span>)[, <span class="dv">2</span>]</span>
<span id="cb42-133"><a href="#cb42-133" aria-hidden="true" tabindex="-1"></a>    pred_class <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(predictions <span class="sc">&gt;</span> threshold, <span class="st">"1"</span>, <span class="st">"0"</span>)</span>
<span id="cb42-134"><a href="#cb42-134" aria-hidden="true" tabindex="-1"></a>    confusion <span class="ot">&lt;-</span> <span class="fu">table</span>(<span class="at">Actual =</span> outer_test_data[[target_name]], <span class="at">Predicted =</span> pred_class)</span>
<span id="cb42-135"><a href="#cb42-135" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb42-136"><a href="#cb42-136" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">nrow</span>(confusion) <span class="sc">&lt;</span> <span class="dv">2</span> <span class="sc">||</span> <span class="fu">ncol</span>(confusion) <span class="sc">&lt;</span> <span class="dv">2</span>) {</span>
<span id="cb42-137"><a href="#cb42-137" aria-hidden="true" tabindex="-1"></a>      TP <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span>, confusion[<span class="dv">2</span>, <span class="dv">2</span>], <span class="dv">0</span>)</span>
<span id="cb42-138"><a href="#cb42-138" aria-hidden="true" tabindex="-1"></a>      TN <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span>, confusion[<span class="dv">1</span>, <span class="dv">1</span>], <span class="dv">0</span>)</span>
<span id="cb42-139"><a href="#cb42-139" aria-hidden="true" tabindex="-1"></a>      FP <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span>, confusion[<span class="dv">1</span>, <span class="dv">2</span>], <span class="dv">0</span>)</span>
<span id="cb42-140"><a href="#cb42-140" aria-hidden="true" tabindex="-1"></a>      FN <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span>, confusion[<span class="dv">2</span>, <span class="dv">1</span>], <span class="dv">0</span>)</span>
<span id="cb42-141"><a href="#cb42-141" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb42-142"><a href="#cb42-142" aria-hidden="true" tabindex="-1"></a>      TP <span class="ot">&lt;-</span> confusion[<span class="dv">2</span>, <span class="dv">2</span>]</span>
<span id="cb42-143"><a href="#cb42-143" aria-hidden="true" tabindex="-1"></a>      TN <span class="ot">&lt;-</span> confusion[<span class="dv">1</span>, <span class="dv">1</span>]</span>
<span id="cb42-144"><a href="#cb42-144" aria-hidden="true" tabindex="-1"></a>      FP <span class="ot">&lt;-</span> confusion[<span class="dv">1</span>, <span class="dv">2</span>]</span>
<span id="cb42-145"><a href="#cb42-145" aria-hidden="true" tabindex="-1"></a>      FN <span class="ot">&lt;-</span> confusion[<span class="dv">2</span>, <span class="dv">1</span>]</span>
<span id="cb42-146"><a href="#cb42-146" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb42-147"><a href="#cb42-147" aria-hidden="true" tabindex="-1"></a>    auc <span class="ot">&lt;-</span> <span class="fu">roc</span>(outer_test_data[[target_name]], predictions)<span class="sc">$</span>auc</span>
<span id="cb42-148"><a href="#cb42-148" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb42-149"><a href="#cb42-149" aria-hidden="true" tabindex="-1"></a>    metrics <span class="ot">&lt;-</span> <span class="fu">setNames</span>(<span class="fu">c</span>(outer_index, TP, TN, FP, FN, auc, </span>
<span id="cb42-150"><a href="#cb42-150" aria-hidden="true" tabindex="-1"></a>                          best_ntree, best_mtry, <span class="fu">paste</span>(best_vars, <span class="at">collapse =</span> <span class="st">","</span>)), </span>
<span id="cb42-151"><a href="#cb42-151" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">names</span>(performance_metrics))</span>
<span id="cb42-152"><a href="#cb42-152" aria-hidden="true" tabindex="-1"></a>    performance_metrics <span class="ot">&lt;-</span> <span class="fu">rbind</span>(performance_metrics, <span class="fu">as.data.frame</span>(<span class="fu">t</span>(metrics)))</span>
<span id="cb42-153"><a href="#cb42-153" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb42-154"><a href="#cb42-154" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Performance:"</span>, <span class="fu">paste</span>(performance_metrics))</span>
<span id="cb42-155"><a href="#cb42-155" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Confusion Matrix for Fold %d:</span><span class="sc">\n</span><span class="st">"</span>, outer_index))</span>
<span id="cb42-156"><a href="#cb42-156" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(confusion)</span>
<span id="cb42-157"><a href="#cb42-157" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Metrics for Fold %d:</span><span class="sc">\n</span><span class="st">"</span>, outer_index))</span>
<span id="cb42-158"><a href="#cb42-158" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"TP: %d, TN: %d, FP: %d, FN: %d, AUC: %f, Best Ntree: %d, Best Mtry: %d, Best Variables: %s</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb42-159"><a href="#cb42-159" aria-hidden="true" tabindex="-1"></a>                TP, TN, FP, FN, auc, best_ntree, best_mtry, <span class="fu">paste</span>(best_vars, <span class="at">collapse =</span> <span class="st">","</span>)))</span>
<span id="cb42-160"><a href="#cb42-160" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb42-161"><a href="#cb42-161" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb42-162"><a href="#cb42-162" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">performance_metrics =</span> performance_metrics, <span class="at">inner_fold_metrics =</span> inner_fold_metrics))</span>
<span id="cb42-163"><a href="#cb42-163" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb42-164"><a href="#cb42-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-165"><a href="#cb42-165" aria-hidden="true" tabindex="-1"></a>evaluate_with_seeds_RandomForest_StepAUC <span class="ot">&lt;-</span> </span>
<span id="cb42-166"><a href="#cb42-166" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(evaluation_function, data, target_var, vars, threshold, seeds, outer, inner, ntree_values, mtry_values) {</span>
<span id="cb42-167"><a href="#cb42-167" aria-hidden="true" tabindex="-1"></a>  results_list <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb42-168"><a href="#cb42-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-169"><a href="#cb42-169" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (seed <span class="cf">in</span> seeds) {</span>
<span id="cb42-170"><a href="#cb42-170" aria-hidden="true" tabindex="-1"></a>    <span class="fu">set.seed</span>(seed)</span>
<span id="cb42-171"><a href="#cb42-171" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Evaluating with seed:"</span>, seed, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb42-172"><a href="#cb42-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-173"><a href="#cb42-173" aria-hidden="true" tabindex="-1"></a>    results <span class="ot">&lt;-</span> <span class="fu">evaluation_function</span>(<span class="at">data =</span> data, </span>
<span id="cb42-174"><a href="#cb42-174" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">target_name =</span> target_var, </span>
<span id="cb42-175"><a href="#cb42-175" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">variables =</span> vars, </span>
<span id="cb42-176"><a href="#cb42-176" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">threshold =</span> threshold, </span>
<span id="cb42-177"><a href="#cb42-177" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">outer =</span> outer, </span>
<span id="cb42-178"><a href="#cb42-178" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">inner =</span> inner, </span>
<span id="cb42-179"><a href="#cb42-179" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">seed =</span> seed,</span>
<span id="cb42-180"><a href="#cb42-180" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">ntree_values =</span> ntree_values,</span>
<span id="cb42-181"><a href="#cb42-181" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">mtry_values =</span> mtry_values)</span>
<span id="cb42-182"><a href="#cb42-182" aria-hidden="true" tabindex="-1"></a>    results_list[[<span class="fu">paste0</span>(<span class="st">"seed_"</span>, seed)]] <span class="ot">&lt;-</span> results</span>
<span id="cb42-183"><a href="#cb42-183" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb42-184"><a href="#cb42-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-185"><a href="#cb42-185" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(results_list)</span>
<span id="cb42-186"><a href="#cb42-186" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb42-187"><a href="#cb42-187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-188"><a href="#cb42-188" aria-hidden="true" tabindex="-1"></a>performance_RandomForest_StepAUC <span class="ot">&lt;-</span> <span class="fu">evaluate_with_seeds_RandomForest_StepAUC</span>(</span>
<span id="cb42-189"><a href="#cb42-189" aria-hidden="true" tabindex="-1"></a>  <span class="at">evaluation_function =</span> double_cross_validation_randomforest_stepAUC,</span>
<span id="cb42-190"><a href="#cb42-190" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_factor,</span>
<span id="cb42-191"><a href="#cb42-191" aria-hidden="true" tabindex="-1"></a>  <span class="at">outer =</span> <span class="dv">5</span>,</span>
<span id="cb42-192"><a href="#cb42-192" aria-hidden="true" tabindex="-1"></a>  <span class="at">inner =</span> <span class="dv">2</span>,</span>
<span id="cb42-193"><a href="#cb42-193" aria-hidden="true" tabindex="-1"></a>  <span class="at">target_var =</span> <span class="st">"PCR"</span>,</span>
<span id="cb42-194"><a href="#cb42-194" aria-hidden="true" tabindex="-1"></a>  <span class="at">ntree_values =</span> <span class="fu">c</span>(<span class="dv">100</span>, <span class="dv">200</span>, <span class="dv">300</span>, <span class="dv">400</span>, <span class="dv">500</span>),</span>
<span id="cb42-195"><a href="#cb42-195" aria-hidden="true" tabindex="-1"></a>  <span class="at">mtry_values  =</span> <span class="fu">c</span>(<span class="fu">floor</span>(<span class="fu">sqrt</span>(<span class="fu">length</span>(todas_variables_factor))), </span>
<span id="cb42-196"><a href="#cb42-196" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">floor</span>(<span class="fu">sqrt</span>(<span class="fu">length</span>(todas_variables_factor))) <span class="sc">-</span> <span class="dv">1</span>, </span>
<span id="cb42-197"><a href="#cb42-197" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">floor</span>(<span class="fu">sqrt</span>(<span class="fu">length</span>(todas_variables_factor))) <span class="sc">+</span> <span class="dv">1</span>),</span>
<span id="cb42-198"><a href="#cb42-198" aria-hidden="true" tabindex="-1"></a>  <span class="at">vars =</span> todas_variables_factor,</span>
<span id="cb42-199"><a href="#cb42-199" aria-hidden="true" tabindex="-1"></a>  <span class="at">threshold =</span> .<span class="dv">35</span>,</span>
<span id="cb42-200"><a href="#cb42-200" aria-hidden="true" tabindex="-1"></a>  <span class="at">seeds =</span> seeds</span>
<span id="cb42-201"><a href="#cb42-201" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"RData_Files_Algorithms/RandomForest_StepAUC.RData"</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="embedded-lasso-2" class="level3" data-number="3.3.5">
<h3 data-number="3.3.5" class="anchored" data-anchor-id="embedded-lasso-2"><span class="header-section-number">3.3.5</span> Embedded (Lasso)</h3>
<p>Debido a dificultades del código, no se han podido obtener resultados del método de selección de variables <strong>embedded</strong> con el algoritmo <em>Lasso</em> para al modelo de Árbol de Decisión (DT).</p>
</section>
</section>
<section id="decision-tree" class="level2" data-number="3.4">
<h2 data-number="3.4" class="anchored" data-anchor-id="decision-tree"><span class="header-section-number">3.4</span> Decision Tree</h2>
<section id="aparente-3" class="level3" data-number="3.4.1">
<h3 data-number="3.4.1" class="anchored" data-anchor-id="aparente-3"><span class="header-section-number">3.4.1</span> Aparente</h3>
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>evaluate_aparent_performance_model_rpart <span class="ot">&lt;-</span> <span class="cf">function</span>(data, target_var, model_func, <span class="at">vars =</span> <span class="cn">NULL</span>, <span class="at">threshold =</span> <span class="fl">0.5</span>) {</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.null</span>(vars)) {</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>    vars <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(<span class="fu">names</span>(data), target_var)</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>  data[[target_var]] <span class="ot">&lt;-</span> <span class="fu">factor</span>(data[[target_var]], <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>  formula <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(<span class="fu">paste</span>(target_var, <span class="st">"~"</span>, <span class="fu">paste</span>(vars, <span class="at">collapse =</span> <span class="st">"+"</span>)))</span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>  model <span class="ot">&lt;-</span> <span class="fu">model_func</span>(formula, data)</span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>  predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(model, <span class="at">newdata =</span> data, <span class="at">type =</span> <span class="st">"prob"</span>)[, <span class="dv">2</span>]</span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a>  actual_classes <span class="ot">&lt;-</span> data[[target_var]]</span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a>  predicted_classes <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(predictions <span class="sc">&gt;</span> threshold, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a>  confusion_matrix <span class="ot">&lt;-</span> <span class="fu">table</span>(predicted_classes, actual_classes)</span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a>  tp <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="st">"1"</span> <span class="sc">%in%</span> <span class="fu">rownames</span>(confusion_matrix) <span class="sc">&amp;&amp;</span> <span class="st">"1"</span> <span class="sc">%in%</span> <span class="fu">colnames</span>(confusion_matrix), confusion_matrix[<span class="st">"1"</span>, <span class="st">"1"</span>], <span class="dv">0</span>)</span>
<span id="cb44-17"><a href="#cb44-17" aria-hidden="true" tabindex="-1"></a>  tn <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="st">"0"</span> <span class="sc">%in%</span> <span class="fu">rownames</span>(confusion_matrix) <span class="sc">&amp;&amp;</span> <span class="st">"0"</span> <span class="sc">%in%</span> <span class="fu">colnames</span>(confusion_matrix), confusion_matrix[<span class="st">"0"</span>, <span class="st">"0"</span>], <span class="dv">0</span>)</span>
<span id="cb44-18"><a href="#cb44-18" aria-hidden="true" tabindex="-1"></a>  fp <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="st">"1"</span> <span class="sc">%in%</span> <span class="fu">rownames</span>(confusion_matrix) <span class="sc">&amp;&amp;</span> <span class="st">"0"</span> <span class="sc">%in%</span> <span class="fu">colnames</span>(confusion_matrix), confusion_matrix[<span class="st">"1"</span>, <span class="st">"0"</span>], <span class="dv">0</span>)</span>
<span id="cb44-19"><a href="#cb44-19" aria-hidden="true" tabindex="-1"></a>  fn <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="st">"0"</span> <span class="sc">%in%</span> <span class="fu">rownames</span>(confusion_matrix) <span class="sc">&amp;&amp;</span> <span class="st">"1"</span> <span class="sc">%in%</span> <span class="fu">colnames</span>(confusion_matrix), confusion_matrix[<span class="st">"0"</span>, <span class="st">"1"</span>], <span class="dv">0</span>)</span>
<span id="cb44-20"><a href="#cb44-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb44-21"><a href="#cb44-21" aria-hidden="true" tabindex="-1"></a>  accuracy <span class="ot">&lt;-</span> (tp <span class="sc">+</span> tn) <span class="sc">/</span> (tp <span class="sc">+</span> tn <span class="sc">+</span> fp <span class="sc">+</span> fn)</span>
<span id="cb44-22"><a href="#cb44-22" aria-hidden="true" tabindex="-1"></a>  precision <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(tp <span class="sc">+</span> fp <span class="sc">&gt;</span> <span class="dv">0</span>, tp <span class="sc">/</span> (tp <span class="sc">+</span> fp), <span class="dv">0</span>)</span>
<span id="cb44-23"><a href="#cb44-23" aria-hidden="true" tabindex="-1"></a>  recall <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(tp <span class="sc">+</span> fn <span class="sc">&gt;</span> <span class="dv">0</span>, tp <span class="sc">/</span> (tp <span class="sc">+</span> fn), <span class="dv">0</span>)</span>
<span id="cb44-24"><a href="#cb44-24" aria-hidden="true" tabindex="-1"></a>  f1_score <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(precision <span class="sc">+</span> recall <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="dv">2</span> <span class="sc">*</span> (precision <span class="sc">*</span> recall) <span class="sc">/</span> (precision <span class="sc">+</span> recall), <span class="dv">0</span>)</span>
<span id="cb44-25"><a href="#cb44-25" aria-hidden="true" tabindex="-1"></a>  roc_obj <span class="ot">&lt;-</span> pROC<span class="sc">::</span><span class="fu">roc</span>(actual_classes, predictions)</span>
<span id="cb44-26"><a href="#cb44-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb44-27"><a href="#cb44-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="at">confusion_matrix =</span> confusion_matrix, <span class="at">accuracy =</span> accuracy, <span class="at">precision =</span> precision, </span>
<span id="cb44-28"><a href="#cb44-28" aria-hidden="true" tabindex="-1"></a>       <span class="at">recall =</span> recall, <span class="at">f1_score =</span> f1_score, <span class="at">roc_curve =</span> roc_obj)</span>
<span id="cb44-29"><a href="#cb44-29" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb44-30"><a href="#cb44-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-31"><a href="#cb44-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-32"><a href="#cb44-32" aria-hidden="true" tabindex="-1"></a>dt_model <span class="ot">&lt;-</span> <span class="cf">function</span>(formula, data) {</span>
<span id="cb44-33"><a href="#cb44-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(<span class="dv">90</span>)</span>
<span id="cb44-34"><a href="#cb44-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rpart</span>(<span class="at">formula =</span> formula, <span class="at">data =</span> data, <span class="at">method =</span> <span class="st">"class"</span>, <span class="at">control =</span> <span class="fu">rpart.control</span>(<span class="at">minsplit =</span> <span class="dv">2</span>, <span class="at">cp =</span> <span class="dv">0</span>))</span>
<span id="cb44-35"><a href="#cb44-35" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb44-36"><a href="#cb44-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-37"><a href="#cb44-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-38"><a href="#cb44-38" aria-hidden="true" tabindex="-1"></a>resultadosAparentesDT <span class="ot">&lt;-</span> <span class="fu">evaluate_aparent_performance_model_rpart</span>(<span class="at">data =</span> data_factor, <span class="at">target_var =</span> <span class="st">"PCR"</span>,</span>
<span id="cb44-39"><a href="#cb44-39" aria-hidden="true" tabindex="-1"></a>                                                             <span class="at">model_func =</span> dt_model,</span>
<span id="cb44-40"><a href="#cb44-40" aria-hidden="true" tabindex="-1"></a>                                                             <span class="at">vars =</span> <span class="st">"."</span>,</span>
<span id="cb44-41"><a href="#cb44-41" aria-hidden="true" tabindex="-1"></a>                                                             <span class="at">threshold =</span> .<span class="dv">35</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"RData_Files_Algorithms/DecisionTree_Aparente.RData"</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="todas-las-variables-3" class="level3" data-number="3.4.2">
<h3 data-number="3.4.2" class="anchored" data-anchor-id="todas-las-variables-3"><span class="header-section-number">3.4.2</span> Todas las Variables</h3>
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>double_cross_validation_rpart <span class="ot">&lt;-</span> <span class="cf">function</span>(data, target_name, outer, inner, cp_values, minsplit_values, variables, threshold, seed) {</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(seed)</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>  performance_metrics <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Fold =</span> <span class="fu">integer</span>(), <span class="at">TP =</span> <span class="fu">integer</span>(), <span class="at">TN =</span> <span class="fu">integer</span>(),</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">FP =</span> <span class="fu">integer</span>(), <span class="at">FN =</span> <span class="fu">integer</span>(), <span class="at">AUC =</span> <span class="fu">numeric</span>(),</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">Best_cp =</span> <span class="fu">numeric</span>(), <span class="at">Best_minsplit =</span> <span class="fu">integer</span>(), <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>  inner_fold_metrics <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Fold =</span> <span class="fu">integer</span>(), <span class="at">Inner_Fold =</span> <span class="fu">integer</span>(), </span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">TP =</span> <span class="fu">integer</span>(), <span class="at">TN =</span> <span class="fu">integer</span>(), <span class="at">FP =</span> <span class="fu">integer</span>(), </span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">FN =</span> <span class="fu">integer</span>(), <span class="at">AUC =</span> <span class="fu">numeric</span>(), <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a>  data[[target_name]] <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(data[[target_name]])</span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a>  outer_folds <span class="ot">&lt;-</span> <span class="fu">createFolds</span>(data[[target_name]], <span class="at">k =</span> outer)</span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (outer_index <span class="cf">in</span> <span class="fu">seq_along</span>(outer_folds)) {</span>
<span id="cb46-15"><a href="#cb46-15" aria-hidden="true" tabindex="-1"></a>    outer_train_data <span class="ot">&lt;-</span> data[<span class="sc">-</span>outer_folds[[outer_index]], ]</span>
<span id="cb46-16"><a href="#cb46-16" aria-hidden="true" tabindex="-1"></a>    outer_test_data <span class="ot">&lt;-</span> data[outer_folds[[outer_index]], ]</span>
<span id="cb46-17"><a href="#cb46-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb46-18"><a href="#cb46-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Imprime la cantidad de instancias de cada clase en el outer train y test set</span></span>
<span id="cb46-19"><a href="#cb46-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Outer Fold %d</span><span class="sc">\n</span><span class="st">"</span>, outer_index))</span>
<span id="cb46-20"><a href="#cb46-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Training Data - Class 0: "</span>, <span class="fu">sum</span>(outer_train_data[[target_name]] <span class="sc">==</span> <span class="dv">0</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb46-21"><a href="#cb46-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Training Data - Class 1: "</span>, <span class="fu">sum</span>(outer_train_data[[target_name]] <span class="sc">==</span> <span class="dv">1</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb46-22"><a href="#cb46-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Testing Data - Class 0: "</span>, <span class="fu">sum</span>(outer_test_data[[target_name]] <span class="sc">==</span> <span class="dv">0</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb46-23"><a href="#cb46-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Testing Data - Class 1: "</span>, <span class="fu">sum</span>(outer_test_data[[target_name]] <span class="sc">==</span> <span class="dv">1</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb46-24"><a href="#cb46-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb46-25"><a href="#cb46-25" aria-hidden="true" tabindex="-1"></a>    inner_folds <span class="ot">&lt;-</span> <span class="fu">createFolds</span>(outer_train_data[[target_name]], <span class="at">k =</span> inner)</span>
<span id="cb46-26"><a href="#cb46-26" aria-hidden="true" tabindex="-1"></a>    best_model <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb46-27"><a href="#cb46-27" aria-hidden="true" tabindex="-1"></a>    best_auc <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb46-28"><a href="#cb46-28" aria-hidden="true" tabindex="-1"></a>    best_cp <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb46-29"><a href="#cb46-29" aria-hidden="true" tabindex="-1"></a>    best_minsplit <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb46-30"><a href="#cb46-30" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb46-31"><a href="#cb46-31" aria-hidden="true" tabindex="-1"></a>    grid <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">cp =</span> cp_values, <span class="at">minsplit =</span> minsplit_values)</span>
<span id="cb46-32"><a href="#cb46-32" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb46-33"><a href="#cb46-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (params <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(grid)) {</span>
<span id="cb46-34"><a href="#cb46-34" aria-hidden="true" tabindex="-1"></a>      inner_auc <span class="ot">&lt;-</span> <span class="fu">numeric</span>()</span>
<span id="cb46-35"><a href="#cb46-35" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb46-36"><a href="#cb46-36" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (inner_index <span class="cf">in</span> <span class="fu">seq_along</span>(inner_folds)) {</span>
<span id="cb46-37"><a href="#cb46-37" aria-hidden="true" tabindex="-1"></a>        inner_train_data <span class="ot">&lt;-</span> outer_train_data[<span class="sc">-</span>inner_folds[[inner_index]], ]</span>
<span id="cb46-38"><a href="#cb46-38" aria-hidden="true" tabindex="-1"></a>        inner_test_data <span class="ot">&lt;-</span> outer_train_data[inner_folds[[inner_index]], ]</span>
<span id="cb46-39"><a href="#cb46-39" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb46-40"><a href="#cb46-40" aria-hidden="true" tabindex="-1"></a>        model <span class="ot">&lt;-</span> <span class="fu">rpart</span>(<span class="at">formula =</span> <span class="fu">as.formula</span>(<span class="fu">paste</span>(target_name, <span class="st">"~"</span>, <span class="fu">paste</span>(variables, <span class="at">collapse =</span> <span class="st">"+"</span>))),</span>
<span id="cb46-41"><a href="#cb46-41" aria-hidden="true" tabindex="-1"></a>                       <span class="at">data =</span> inner_train_data, <span class="at">control =</span> <span class="fu">rpart.control</span>(<span class="at">cp =</span> grid<span class="sc">$</span>cp[params], <span class="at">minsplit =</span> grid<span class="sc">$</span>minsplit[params]))</span>
<span id="cb46-42"><a href="#cb46-42" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb46-43"><a href="#cb46-43" aria-hidden="true" tabindex="-1"></a>        predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(model, inner_test_data, <span class="at">type =</span> <span class="st">"prob"</span>)[, <span class="dv">2</span>]</span>
<span id="cb46-44"><a href="#cb46-44" aria-hidden="true" tabindex="-1"></a>        roc_curve <span class="ot">&lt;-</span> <span class="fu">roc</span>(inner_test_data[[target_name]], predictions)</span>
<span id="cb46-45"><a href="#cb46-45" aria-hidden="true" tabindex="-1"></a>        inner_auc[inner_index] <span class="ot">&lt;-</span> roc_curve<span class="sc">$</span>auc</span>
<span id="cb46-46"><a href="#cb46-46" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb46-47"><a href="#cb46-47" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb46-48"><a href="#cb46-48" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="fu">mean</span>(inner_auc) <span class="sc">&gt;</span> best_auc) {</span>
<span id="cb46-49"><a href="#cb46-49" aria-hidden="true" tabindex="-1"></a>        best_auc <span class="ot">=</span> <span class="fu">mean</span>(inner_auc)</span>
<span id="cb46-50"><a href="#cb46-50" aria-hidden="true" tabindex="-1"></a>        best_model <span class="ot">=</span> model</span>
<span id="cb46-51"><a href="#cb46-51" aria-hidden="true" tabindex="-1"></a>        best_cp <span class="ot">=</span> grid<span class="sc">$</span>cp[params]</span>
<span id="cb46-52"><a href="#cb46-52" aria-hidden="true" tabindex="-1"></a>        best_minsplit <span class="ot">=</span> grid<span class="sc">$</span>minsplit[params]</span>
<span id="cb46-53"><a href="#cb46-53" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb46-54"><a href="#cb46-54" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb46-55"><a href="#cb46-55" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb46-56"><a href="#cb46-56" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Evaluar el mejor modelo en el validation split del inner loop </span></span>
<span id="cb46-57"><a href="#cb46-57" aria-hidden="true" tabindex="-1"></a>    inner_auc_vals <span class="ot">&lt;-</span> <span class="fu">numeric</span>()</span>
<span id="cb46-58"><a href="#cb46-58" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (inner_index <span class="cf">in</span> <span class="fu">seq_along</span>(inner_folds)) {</span>
<span id="cb46-59"><a href="#cb46-59" aria-hidden="true" tabindex="-1"></a>      inner_train_data <span class="ot">&lt;-</span> outer_train_data[<span class="sc">-</span>inner_folds[[inner_index]], ]</span>
<span id="cb46-60"><a href="#cb46-60" aria-hidden="true" tabindex="-1"></a>      inner_test_data <span class="ot">&lt;-</span> outer_train_data[inner_folds[[inner_index]], ]</span>
<span id="cb46-61"><a href="#cb46-61" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb46-62"><a href="#cb46-62" aria-hidden="true" tabindex="-1"></a>      predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(best_model, inner_test_data, <span class="at">type =</span> <span class="st">"prob"</span>)[, <span class="dv">2</span>]</span>
<span id="cb46-63"><a href="#cb46-63" aria-hidden="true" tabindex="-1"></a>      roc_curve <span class="ot">&lt;-</span> <span class="fu">roc</span>(inner_test_data[[target_name]], predictions)</span>
<span id="cb46-64"><a href="#cb46-64" aria-hidden="true" tabindex="-1"></a>      inner_auc_vals[inner_index] <span class="ot">&lt;-</span> roc_curve<span class="sc">$</span>auc</span>
<span id="cb46-65"><a href="#cb46-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-66"><a href="#cb46-66" aria-hidden="true" tabindex="-1"></a>      pred_class <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(predictions <span class="sc">&gt;</span> threshold, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb46-67"><a href="#cb46-67" aria-hidden="true" tabindex="-1"></a>      confusion <span class="ot">&lt;-</span> <span class="fu">table</span>(<span class="at">Actual =</span> inner_test_data[[target_name]], <span class="at">Predicted =</span> pred_class)</span>
<span id="cb46-68"><a href="#cb46-68" aria-hidden="true" tabindex="-1"></a>      TP <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span>, confusion[<span class="dv">2</span>, <span class="dv">2</span>], <span class="dv">0</span>)</span>
<span id="cb46-69"><a href="#cb46-69" aria-hidden="true" tabindex="-1"></a>      TN <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span>, confusion[<span class="dv">1</span>, <span class="dv">1</span>], <span class="dv">0</span>)</span>
<span id="cb46-70"><a href="#cb46-70" aria-hidden="true" tabindex="-1"></a>      FP <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span>, confusion[<span class="dv">1</span>, <span class="dv">2</span>], <span class="dv">0</span>)</span>
<span id="cb46-71"><a href="#cb46-71" aria-hidden="true" tabindex="-1"></a>      FN <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span>, confusion[<span class="dv">2</span>, <span class="dv">1</span>], <span class="dv">0</span>)</span>
<span id="cb46-72"><a href="#cb46-72" aria-hidden="true" tabindex="-1"></a>      auc <span class="ot">&lt;-</span> roc_curve<span class="sc">$</span>auc</span>
<span id="cb46-73"><a href="#cb46-73" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb46-74"><a href="#cb46-74" aria-hidden="true" tabindex="-1"></a>      inner_metrics <span class="ot">&lt;-</span> <span class="fu">setNames</span>(<span class="fu">c</span>(outer_index, inner_index, TP, TN, FP, FN, auc), <span class="fu">names</span>(inner_fold_metrics))</span>
<span id="cb46-75"><a href="#cb46-75" aria-hidden="true" tabindex="-1"></a>      inner_fold_metrics <span class="ot">&lt;-</span> <span class="fu">rbind</span>(inner_fold_metrics, <span class="fu">as.data.frame</span>(<span class="fu">t</span>(inner_metrics)))</span>
<span id="cb46-76"><a href="#cb46-76" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb46-77"><a href="#cb46-77" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb46-78"><a href="#cb46-78" aria-hidden="true" tabindex="-1"></a>    best_model <span class="ot">&lt;-</span> <span class="fu">rpart</span>(<span class="at">formula =</span> <span class="fu">as.formula</span>(<span class="fu">paste</span>(target_name, <span class="st">"~"</span>, <span class="fu">paste</span>(variables, <span class="at">collapse =</span> <span class="st">"+"</span>))),</span>
<span id="cb46-79"><a href="#cb46-79" aria-hidden="true" tabindex="-1"></a>                       <span class="at">data =</span> outer_train_data, <span class="at">control =</span> <span class="fu">rpart.control</span>(<span class="at">cp =</span> best_cp, <span class="at">minsplit =</span> best_minsplit))</span>
<span id="cb46-80"><a href="#cb46-80" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb46-81"><a href="#cb46-81" aria-hidden="true" tabindex="-1"></a>    predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(best_model, outer_test_data, <span class="at">type =</span> <span class="st">"prob"</span>)[, <span class="dv">2</span>]</span>
<span id="cb46-82"><a href="#cb46-82" aria-hidden="true" tabindex="-1"></a>    pred_class <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(predictions <span class="sc">&gt;</span> threshold, <span class="dv">1</span>, <span class="dv">0</span>)  <span class="co"># Asignar clases basadas en umbral</span></span>
<span id="cb46-83"><a href="#cb46-83" aria-hidden="true" tabindex="-1"></a>    confusion <span class="ot">&lt;-</span> <span class="fu">table</span>(<span class="at">Actual =</span> outer_test_data[[target_name]], <span class="at">Predicted =</span> pred_class)</span>
<span id="cb46-84"><a href="#cb46-84" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb46-85"><a href="#cb46-85" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">nrow</span>(confusion) <span class="sc">&lt;</span> <span class="dv">2</span> <span class="sc">||</span> <span class="fu">ncol</span>(confusion) <span class="sc">&lt;</span> <span class="dv">2</span>) {</span>
<span id="cb46-86"><a href="#cb46-86" aria-hidden="true" tabindex="-1"></a>      TP <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span>, confusion[<span class="dv">2</span>, <span class="dv">2</span>], <span class="dv">0</span>)</span>
<span id="cb46-87"><a href="#cb46-87" aria-hidden="true" tabindex="-1"></a>      TN <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span>, confusion[<span class="dv">1</span>, <span class="dv">1</span>], <span class="dv">0</span>)</span>
<span id="cb46-88"><a href="#cb46-88" aria-hidden="true" tabindex="-1"></a>      FP <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span>, confusion[<span class="dv">1</span>, <span class="dv">2</span>], <span class="dv">0</span>)</span>
<span id="cb46-89"><a href="#cb46-89" aria-hidden="true" tabindex="-1"></a>      FN <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span>, confusion[<span class="dv">2</span>, <span class="dv">1</span>], <span class="dv">0</span>)</span>
<span id="cb46-90"><a href="#cb46-90" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb46-91"><a href="#cb46-91" aria-hidden="true" tabindex="-1"></a>      TP <span class="ot">&lt;-</span> confusion[<span class="dv">2</span>, <span class="dv">2</span>]</span>
<span id="cb46-92"><a href="#cb46-92" aria-hidden="true" tabindex="-1"></a>      TN <span class="ot">&lt;-</span> confusion[<span class="dv">1</span>, <span class="dv">1</span>]</span>
<span id="cb46-93"><a href="#cb46-93" aria-hidden="true" tabindex="-1"></a>      FP <span class="ot">&lt;-</span> confusion[<span class="dv">1</span>, <span class="dv">2</span>]</span>
<span id="cb46-94"><a href="#cb46-94" aria-hidden="true" tabindex="-1"></a>      FN <span class="ot">&lt;-</span> confusion[<span class="dv">2</span>, <span class="dv">1</span>]</span>
<span id="cb46-95"><a href="#cb46-95" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb46-96"><a href="#cb46-96" aria-hidden="true" tabindex="-1"></a>    auc <span class="ot">=</span> <span class="fu">roc</span>(outer_test_data[[target_name]], predictions)<span class="sc">$</span>auc</span>
<span id="cb46-97"><a href="#cb46-97" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb46-98"><a href="#cb46-98" aria-hidden="true" tabindex="-1"></a>    metrics <span class="ot">&lt;-</span> <span class="fu">setNames</span>(<span class="fu">c</span>(outer_index, TP, TN, FP, FN, auc, best_cp, best_minsplit), <span class="fu">names</span>(performance_metrics))</span>
<span id="cb46-99"><a href="#cb46-99" aria-hidden="true" tabindex="-1"></a>    performance_metrics <span class="ot">&lt;-</span> <span class="fu">rbind</span>(performance_metrics, <span class="fu">as.data.frame</span>(<span class="fu">t</span>(metrics)))</span>
<span id="cb46-100"><a href="#cb46-100" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb46-101"><a href="#cb46-101" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb46-102"><a href="#cb46-102" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">performance_metrics =</span> performance_metrics, <span class="at">inner_fold_metrics =</span> inner_fold_metrics))</span>
<span id="cb46-103"><a href="#cb46-103" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb46-104"><a href="#cb46-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-105"><a href="#cb46-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-106"><a href="#cb46-106" aria-hidden="true" tabindex="-1"></a>evaluate_with_seeds_DecisionTree_TodasVariables_Asociacion <span class="ot">&lt;-</span> </span>
<span id="cb46-107"><a href="#cb46-107" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(evaluation_function, data, target_var, vars, threshold, seeds, outer, inner, cp_values, minsplit_values) {</span>
<span id="cb46-108"><a href="#cb46-108" aria-hidden="true" tabindex="-1"></a>  results_list <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb46-109"><a href="#cb46-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-110"><a href="#cb46-110" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (seed <span class="cf">in</span> seeds) {</span>
<span id="cb46-111"><a href="#cb46-111" aria-hidden="true" tabindex="-1"></a>    <span class="fu">set.seed</span>(seed)</span>
<span id="cb46-112"><a href="#cb46-112" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Evaluating with seed:"</span>, seed, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb46-113"><a href="#cb46-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-114"><a href="#cb46-114" aria-hidden="true" tabindex="-1"></a>    results <span class="ot">&lt;-</span> <span class="fu">evaluation_function</span>(<span class="at">data =</span> data, </span>
<span id="cb46-115"><a href="#cb46-115" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">target_name =</span> target_var, </span>
<span id="cb46-116"><a href="#cb46-116" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">variables =</span> vars, </span>
<span id="cb46-117"><a href="#cb46-117" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">threshold =</span> threshold, </span>
<span id="cb46-118"><a href="#cb46-118" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">outer =</span> outer, </span>
<span id="cb46-119"><a href="#cb46-119" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">inner =</span> inner, </span>
<span id="cb46-120"><a href="#cb46-120" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">seed =</span> seed,</span>
<span id="cb46-121"><a href="#cb46-121" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">cp_values =</span> cp_values,</span>
<span id="cb46-122"><a href="#cb46-122" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">minsplit_values =</span> minsplit_values)</span>
<span id="cb46-123"><a href="#cb46-123" aria-hidden="true" tabindex="-1"></a>    results_list[[<span class="fu">paste0</span>(<span class="st">"seed_"</span>, seed)]] <span class="ot">&lt;-</span> results</span>
<span id="cb46-124"><a href="#cb46-124" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb46-125"><a href="#cb46-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-126"><a href="#cb46-126" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(results_list)</span>
<span id="cb46-127"><a href="#cb46-127" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb46-128"><a href="#cb46-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-129"><a href="#cb46-129" aria-hidden="true" tabindex="-1"></a>performance_rpart_todasvariables <span class="ot">&lt;-</span> <span class="fu">evaluate_with_seeds_DecisionTree_TodasVariables_Asociacion</span>(</span>
<span id="cb46-130"><a href="#cb46-130" aria-hidden="true" tabindex="-1"></a>  <span class="at">evaluation_function =</span> double_cross_validation_rpart,</span>
<span id="cb46-131"><a href="#cb46-131" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_factor,</span>
<span id="cb46-132"><a href="#cb46-132" aria-hidden="true" tabindex="-1"></a>  <span class="at">outer =</span> <span class="dv">5</span>,</span>
<span id="cb46-133"><a href="#cb46-133" aria-hidden="true" tabindex="-1"></a>  <span class="at">inner =</span> <span class="dv">2</span>,</span>
<span id="cb46-134"><a href="#cb46-134" aria-hidden="true" tabindex="-1"></a>  <span class="at">target_var =</span> <span class="st">"PCR"</span>,</span>
<span id="cb46-135"><a href="#cb46-135" aria-hidden="true" tabindex="-1"></a>  <span class="at">cp_values =</span> <span class="fu">c</span>(<span class="fl">0.001</span>, <span class="fl">0.01</span>, <span class="fl">0.1</span>),</span>
<span id="cb46-136"><a href="#cb46-136" aria-hidden="true" tabindex="-1"></a>  <span class="at">minsplit_values =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">15</span>, <span class="dv">20</span>),</span>
<span id="cb46-137"><a href="#cb46-137" aria-hidden="true" tabindex="-1"></a>  <span class="at">vars =</span> todas_variables_factor,</span>
<span id="cb46-138"><a href="#cb46-138" aria-hidden="true" tabindex="-1"></a>  <span class="at">threshold =</span> .<span class="dv">35</span>,</span>
<span id="cb46-139"><a href="#cb46-139" aria-hidden="true" tabindex="-1"></a>  <span class="at">seeds =</span> seeds</span>
<span id="cb46-140"><a href="#cb46-140" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"RData_Files_Algorithms/DecisionTree_TodasVariables.RData"</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="filtrado-asociación-3" class="level3" data-number="3.4.3">
<h3 data-number="3.4.3" class="anchored" data-anchor-id="filtrado-asociación-3"><span class="header-section-number">3.4.3</span> Filtrado (Asociación)</h3>
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>performance_rpart_Asociacion <span class="ot">&lt;-</span> <span class="fu">evaluate_with_seeds_DecisionTree_TodasVariables_Asociacion</span>(</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">evaluation_function =</span> double_cross_validation_rpart,</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_factor,</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">outer =</span> <span class="dv">5</span>,</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">inner =</span> <span class="dv">2</span>,</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">target_var =</span> <span class="st">"PCR"</span>,</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">cp_values =</span> <span class="fu">c</span>(<span class="fl">0.001</span>, <span class="fl">0.01</span>, <span class="fl">0.1</span>),</span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">minsplit_values =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">15</span>, <span class="dv">20</span>),</span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">vars =</span> asociacion,</span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">threshold =</span> .<span class="dv">35</span>,</span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">seeds =</span> seeds</span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"RData_Files_Algorithms/DecisionTree_Asociacion.RData"</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="wrapped-stepauc-3" class="level3" data-number="3.4.4">
<h3 data-number="3.4.4" class="anchored" data-anchor-id="wrapped-stepauc-3"><span class="header-section-number">3.4.4</span> Wrapped (StepAUC)</h3>
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>double_cross_validation_rpart_stepAUC <span class="ot">&lt;-</span> <span class="cf">function</span>(data, target_name, outer, inner, cps, minsplits, variables, threshold, seed) {</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(seed)</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>  performance_metrics <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Fold =</span> <span class="fu">integer</span>(), <span class="at">TP =</span> <span class="fu">integer</span>(), <span class="at">TN =</span> <span class="fu">integer</span>(),</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">FP =</span> <span class="fu">integer</span>(), <span class="at">FN =</span> <span class="fu">integer</span>(), <span class="at">AUC =</span> <span class="fu">numeric</span>(),</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">Best_CP =</span> <span class="fu">numeric</span>(), <span class="at">Best_Minsplit =</span> <span class="fu">integer</span>(), </span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">Best_Variables =</span> <span class="fu">character</span>(), <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>  inner_fold_metrics <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Fold =</span> <span class="fu">integer</span>(), <span class="at">Inner_Fold =</span> <span class="fu">integer</span>(), </span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">TP =</span> <span class="fu">integer</span>(), <span class="at">TN =</span> <span class="fu">integer</span>(), <span class="at">FP =</span> <span class="fu">integer</span>(), </span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">FN =</span> <span class="fu">integer</span>(), <span class="at">AUC =</span> <span class="fu">numeric</span>(), <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a>  data[[target_name]] <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(data[[target_name]])</span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a>  outer_folds <span class="ot">&lt;-</span> <span class="fu">createFolds</span>(data[[target_name]], <span class="at">k =</span> outer)</span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb50-15"><a href="#cb50-15" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (outer_index <span class="cf">in</span> <span class="fu">seq_along</span>(outer_folds)) {</span>
<span id="cb50-16"><a href="#cb50-16" aria-hidden="true" tabindex="-1"></a>    outer_train_data <span class="ot">&lt;-</span> data[<span class="sc">-</span>outer_folds[[outer_index]], ]</span>
<span id="cb50-17"><a href="#cb50-17" aria-hidden="true" tabindex="-1"></a>    outer_test_data <span class="ot">&lt;-</span> data[outer_folds[[outer_index]], ]</span>
<span id="cb50-18"><a href="#cb50-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb50-19"><a href="#cb50-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Outer Fold %d</span><span class="sc">\n</span><span class="st">"</span>, outer_index))</span>
<span id="cb50-20"><a href="#cb50-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Training Data - Class 0: "</span>, <span class="fu">sum</span>(outer_train_data[[target_name]] <span class="sc">==</span> <span class="st">"0"</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb50-21"><a href="#cb50-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Training Data - Class 1: "</span>, <span class="fu">sum</span>(outer_train_data[[target_name]] <span class="sc">==</span> <span class="st">"1"</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb50-22"><a href="#cb50-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Testing Data - Class 0: "</span>, <span class="fu">sum</span>(outer_test_data[[target_name]] <span class="sc">==</span> <span class="st">"0"</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb50-23"><a href="#cb50-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Testing Data - Class 1: "</span>, <span class="fu">sum</span>(outer_test_data[[target_name]] <span class="sc">==</span> <span class="st">"1"</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb50-24"><a href="#cb50-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb50-25"><a href="#cb50-25" aria-hidden="true" tabindex="-1"></a>    inner_folds <span class="ot">&lt;-</span> <span class="fu">createFolds</span>(outer_train_data[[target_name]], <span class="at">k =</span> inner)</span>
<span id="cb50-26"><a href="#cb50-26" aria-hidden="true" tabindex="-1"></a>    best_model <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb50-27"><a href="#cb50-27" aria-hidden="true" tabindex="-1"></a>    best_auc <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb50-28"><a href="#cb50-28" aria-hidden="true" tabindex="-1"></a>    best_cp <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb50-29"><a href="#cb50-29" aria-hidden="true" tabindex="-1"></a>    best_minsplit <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb50-30"><a href="#cb50-30" aria-hidden="true" tabindex="-1"></a>    best_vars <span class="ot">&lt;-</span> variables</span>
<span id="cb50-31"><a href="#cb50-31" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb50-32"><a href="#cb50-32" aria-hidden="true" tabindex="-1"></a>    grid <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">cp =</span> cps, <span class="at">minsplit =</span> minsplits)</span>
<span id="cb50-33"><a href="#cb50-33" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb50-34"><a href="#cb50-34" aria-hidden="true" tabindex="-1"></a>    stepAUC <span class="ot">&lt;-</span> <span class="cf">function</span>(vars, data, target_name, grid, inner_folds) {</span>
<span id="cb50-35"><a href="#cb50-35" aria-hidden="true" tabindex="-1"></a>      current_vars <span class="ot">&lt;-</span> vars</span>
<span id="cb50-36"><a href="#cb50-36" aria-hidden="true" tabindex="-1"></a>      best_inner_auc <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb50-37"><a href="#cb50-37" aria-hidden="true" tabindex="-1"></a>      best_inner_model <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb50-38"><a href="#cb50-38" aria-hidden="true" tabindex="-1"></a>      best_inner_cp <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb50-39"><a href="#cb50-39" aria-hidden="true" tabindex="-1"></a>      best_inner_minsplit <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb50-40"><a href="#cb50-40" aria-hidden="true" tabindex="-1"></a>      best_inner_vars <span class="ot">&lt;-</span> current_vars</span>
<span id="cb50-41"><a href="#cb50-41" aria-hidden="true" tabindex="-1"></a>      improved <span class="ot">&lt;-</span> <span class="cn">TRUE</span></span>
<span id="cb50-42"><a href="#cb50-42" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb50-43"><a href="#cb50-43" aria-hidden="true" tabindex="-1"></a>      <span class="cf">while</span> (improved <span class="sc">&amp;&amp;</span> <span class="fu">length</span>(current_vars) <span class="sc">&gt;</span> <span class="dv">1</span>) {</span>
<span id="cb50-44"><a href="#cb50-44" aria-hidden="true" tabindex="-1"></a>        improved <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb50-45"><a href="#cb50-45" aria-hidden="true" tabindex="-1"></a>        best_auc_in_step <span class="ot">&lt;-</span> best_inner_auc</span>
<span id="cb50-46"><a href="#cb50-46" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb50-47"><a href="#cb50-47" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (var <span class="cf">in</span> current_vars) {</span>
<span id="cb50-48"><a href="#cb50-48" aria-hidden="true" tabindex="-1"></a>          temp_vars <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(current_vars, var)</span>
<span id="cb50-49"><a href="#cb50-49" aria-hidden="true" tabindex="-1"></a>          inner_auc <span class="ot">&lt;-</span> <span class="fu">numeric</span>()</span>
<span id="cb50-50"><a href="#cb50-50" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb50-51"><a href="#cb50-51" aria-hidden="true" tabindex="-1"></a>          <span class="cf">for</span> (params <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(grid)) {</span>
<span id="cb50-52"><a href="#cb50-52" aria-hidden="true" tabindex="-1"></a>            auc_vals <span class="ot">&lt;-</span> <span class="fu">numeric</span>()</span>
<span id="cb50-53"><a href="#cb50-53" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb50-54"><a href="#cb50-54" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> (inner_index <span class="cf">in</span> <span class="fu">seq_along</span>(inner_folds)) {</span>
<span id="cb50-55"><a href="#cb50-55" aria-hidden="true" tabindex="-1"></a>              inner_train_data <span class="ot">&lt;-</span> data[<span class="sc">-</span>inner_folds[[inner_index]], ]</span>
<span id="cb50-56"><a href="#cb50-56" aria-hidden="true" tabindex="-1"></a>              inner_test_data <span class="ot">&lt;-</span> data[inner_folds[[inner_index]], ]</span>
<span id="cb50-57"><a href="#cb50-57" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb50-58"><a href="#cb50-58" aria-hidden="true" tabindex="-1"></a>              result <span class="ot">&lt;-</span> <span class="fu">tryCatch</span>({</span>
<span id="cb50-59"><a href="#cb50-59" aria-hidden="true" tabindex="-1"></a>                model <span class="ot">&lt;-</span> <span class="fu">rpart</span>(<span class="fu">as.formula</span>(<span class="fu">paste</span>(target_name, <span class="st">"~"</span>, <span class="fu">paste</span>(temp_vars, <span class="at">collapse =</span> <span class="st">"+"</span>))),</span>
<span id="cb50-60"><a href="#cb50-60" aria-hidden="true" tabindex="-1"></a>                               <span class="at">data =</span> inner_train_data, <span class="at">control =</span> <span class="fu">rpart.control</span>(<span class="at">cp =</span> grid<span class="sc">$</span>cp[params], <span class="at">minsplit =</span> grid<span class="sc">$</span>minsplit[params]))</span>
<span id="cb50-61"><a href="#cb50-61" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb50-62"><a href="#cb50-62" aria-hidden="true" tabindex="-1"></a>                predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(model, inner_test_data, <span class="at">type =</span> <span class="st">"prob"</span>)[, <span class="dv">2</span>]</span>
<span id="cb50-63"><a href="#cb50-63" aria-hidden="true" tabindex="-1"></a>                roc_curve <span class="ot">&lt;-</span> <span class="fu">roc</span>(inner_test_data[[target_name]], predictions)</span>
<span id="cb50-64"><a href="#cb50-64" aria-hidden="true" tabindex="-1"></a>                auc_vals[inner_index] <span class="ot">&lt;-</span> roc_curve<span class="sc">$</span>auc</span>
<span id="cb50-65"><a href="#cb50-65" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb50-66"><a href="#cb50-66" aria-hidden="true" tabindex="-1"></a>              }, <span class="at">error =</span> <span class="cf">function</span>(e) {</span>
<span id="cb50-67"><a href="#cb50-67" aria-hidden="true" tabindex="-1"></a>                <span class="fu">cat</span>(<span class="st">"Error with variables:"</span>, <span class="fu">paste</span>(temp_vars, <span class="at">collapse =</span> <span class="st">", "</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb50-68"><a href="#cb50-68" aria-hidden="true" tabindex="-1"></a>                auc_vals[inner_index] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb50-69"><a href="#cb50-69" aria-hidden="true" tabindex="-1"></a>              })</span>
<span id="cb50-70"><a href="#cb50-70" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb50-71"><a href="#cb50-71" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb50-72"><a href="#cb50-72" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> (<span class="fu">mean</span>(auc_vals, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">&gt;</span> best_auc_in_step) {</span>
<span id="cb50-73"><a href="#cb50-73" aria-hidden="true" tabindex="-1"></a>              best_auc_in_step <span class="ot">&lt;-</span> <span class="fu">mean</span>(auc_vals, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb50-74"><a href="#cb50-74" aria-hidden="true" tabindex="-1"></a>              best_inner_model <span class="ot">&lt;-</span> model</span>
<span id="cb50-75"><a href="#cb50-75" aria-hidden="true" tabindex="-1"></a>              best_inner_cp <span class="ot">&lt;-</span> grid<span class="sc">$</span>cp[params]</span>
<span id="cb50-76"><a href="#cb50-76" aria-hidden="true" tabindex="-1"></a>              best_inner_minsplit <span class="ot">&lt;-</span> grid<span class="sc">$</span>minsplit[params]</span>
<span id="cb50-77"><a href="#cb50-77" aria-hidden="true" tabindex="-1"></a>              best_inner_vars <span class="ot">&lt;-</span> temp_vars</span>
<span id="cb50-78"><a href="#cb50-78" aria-hidden="true" tabindex="-1"></a>              improved <span class="ot">&lt;-</span> <span class="cn">TRUE</span></span>
<span id="cb50-79"><a href="#cb50-79" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb50-80"><a href="#cb50-80" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb50-81"><a href="#cb50-81" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb50-82"><a href="#cb50-82" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb50-83"><a href="#cb50-83" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (improved) {</span>
<span id="cb50-84"><a href="#cb50-84" aria-hidden="true" tabindex="-1"></a>          current_vars <span class="ot">&lt;-</span> best_inner_vars</span>
<span id="cb50-85"><a href="#cb50-85" aria-hidden="true" tabindex="-1"></a>          best_inner_auc <span class="ot">&lt;-</span> best_auc_in_step</span>
<span id="cb50-86"><a href="#cb50-86" aria-hidden="true" tabindex="-1"></a>          <span class="fu">cat</span>(<span class="st">"Vars improved: "</span>, <span class="fu">paste</span>(current_vars, <span class="at">collapse=</span><span class="st">", "</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb50-87"><a href="#cb50-87" aria-hidden="true" tabindex="-1"></a>          <span class="fu">cat</span>(<span class="st">"AUC: "</span>, <span class="fu">paste</span>(best_inner_auc), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb50-88"><a href="#cb50-88" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb50-89"><a href="#cb50-89" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb50-90"><a href="#cb50-90" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb50-91"><a href="#cb50-91" aria-hidden="true" tabindex="-1"></a>      <span class="fu">list</span>(<span class="at">model =</span> best_inner_model, <span class="at">auc =</span> best_inner_auc, </span>
<span id="cb50-92"><a href="#cb50-92" aria-hidden="true" tabindex="-1"></a>           <span class="at">cp =</span> best_inner_cp, <span class="at">minsplit =</span> best_inner_minsplit, </span>
<span id="cb50-93"><a href="#cb50-93" aria-hidden="true" tabindex="-1"></a>           <span class="at">vars =</span> best_inner_vars)</span>
<span id="cb50-94"><a href="#cb50-94" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb50-95"><a href="#cb50-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-96"><a href="#cb50-96" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb50-97"><a href="#cb50-97" aria-hidden="true" tabindex="-1"></a>    best_result <span class="ot">&lt;-</span> <span class="fu">stepAUC</span>(variables, outer_train_data, target_name, grid, inner_folds)</span>
<span id="cb50-98"><a href="#cb50-98" aria-hidden="true" tabindex="-1"></a>    best_model <span class="ot">&lt;-</span> best_result<span class="sc">$</span>model</span>
<span id="cb50-99"><a href="#cb50-99" aria-hidden="true" tabindex="-1"></a>    best_auc <span class="ot">&lt;-</span> best_result<span class="sc">$</span>auc</span>
<span id="cb50-100"><a href="#cb50-100" aria-hidden="true" tabindex="-1"></a>    best_cp <span class="ot">&lt;-</span> best_result<span class="sc">$</span>cp</span>
<span id="cb50-101"><a href="#cb50-101" aria-hidden="true" tabindex="-1"></a>    best_minsplit <span class="ot">&lt;-</span> best_result<span class="sc">$</span>minsplit</span>
<span id="cb50-102"><a href="#cb50-102" aria-hidden="true" tabindex="-1"></a>    best_vars <span class="ot">&lt;-</span> best_result<span class="sc">$</span>vars</span>
<span id="cb50-103"><a href="#cb50-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-104"><a href="#cb50-104" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Evaluar el mejor modelo en el validation split del inner loop</span></span>
<span id="cb50-105"><a href="#cb50-105" aria-hidden="true" tabindex="-1"></a>    inner_auc_vals <span class="ot">&lt;-</span> <span class="fu">numeric</span>()</span>
<span id="cb50-106"><a href="#cb50-106" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (inner_index <span class="cf">in</span> <span class="fu">seq_along</span>(inner_folds)) {</span>
<span id="cb50-107"><a href="#cb50-107" aria-hidden="true" tabindex="-1"></a>      inner_train_data <span class="ot">&lt;-</span> outer_train_data[<span class="sc">-</span>inner_folds[[inner_index]], ]</span>
<span id="cb50-108"><a href="#cb50-108" aria-hidden="true" tabindex="-1"></a>      inner_test_data <span class="ot">&lt;-</span> outer_train_data[inner_folds[[inner_index]], ]</span>
<span id="cb50-109"><a href="#cb50-109" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb50-110"><a href="#cb50-110" aria-hidden="true" tabindex="-1"></a>      predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(best_model, inner_test_data, <span class="at">type =</span> <span class="st">"prob"</span>)[, <span class="dv">2</span>]</span>
<span id="cb50-111"><a href="#cb50-111" aria-hidden="true" tabindex="-1"></a>      roc_curve <span class="ot">&lt;-</span> <span class="fu">roc</span>(inner_test_data[[target_name]], predictions)</span>
<span id="cb50-112"><a href="#cb50-112" aria-hidden="true" tabindex="-1"></a>      inner_auc_vals[inner_index] <span class="ot">&lt;-</span> roc_curve<span class="sc">$</span>auc</span>
<span id="cb50-113"><a href="#cb50-113" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb50-114"><a href="#cb50-114" aria-hidden="true" tabindex="-1"></a>      pred_class <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(predictions <span class="sc">&gt;</span> threshold, <span class="st">"1"</span>, <span class="st">"0"</span>)</span>
<span id="cb50-115"><a href="#cb50-115" aria-hidden="true" tabindex="-1"></a>      confusion <span class="ot">&lt;-</span> <span class="fu">table</span>(<span class="at">Actual =</span> inner_test_data[[target_name]], <span class="at">Predicted =</span> pred_class)</span>
<span id="cb50-116"><a href="#cb50-116" aria-hidden="true" tabindex="-1"></a>      TP <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span>, confusion[<span class="dv">2</span>, <span class="dv">2</span>], <span class="dv">0</span>)</span>
<span id="cb50-117"><a href="#cb50-117" aria-hidden="true" tabindex="-1"></a>      TN <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span>, confusion[<span class="dv">1</span>, <span class="dv">1</span>], <span class="dv">0</span>)</span>
<span id="cb50-118"><a href="#cb50-118" aria-hidden="true" tabindex="-1"></a>      FP <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span>, confusion[<span class="dv">1</span>, <span class="dv">2</span>], <span class="dv">0</span>)</span>
<span id="cb50-119"><a href="#cb50-119" aria-hidden="true" tabindex="-1"></a>      FN <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span>, confusion[<span class="dv">2</span>, <span class="dv">1</span>], <span class="dv">0</span>)</span>
<span id="cb50-120"><a href="#cb50-120" aria-hidden="true" tabindex="-1"></a>      auc <span class="ot">&lt;-</span> roc_curve<span class="sc">$</span>auc</span>
<span id="cb50-121"><a href="#cb50-121" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb50-122"><a href="#cb50-122" aria-hidden="true" tabindex="-1"></a>      inner_metrics <span class="ot">&lt;-</span> <span class="fu">setNames</span>(<span class="fu">c</span>(outer_index, inner_index, TP, TN, FP, FN, auc), <span class="fu">names</span>(inner_fold_metrics))</span>
<span id="cb50-123"><a href="#cb50-123" aria-hidden="true" tabindex="-1"></a>      inner_fold_metrics <span class="ot">&lt;-</span> <span class="fu">rbind</span>(inner_fold_metrics, <span class="fu">as.data.frame</span>(<span class="fu">t</span>(inner_metrics)))</span>
<span id="cb50-124"><a href="#cb50-124" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb50-125"><a href="#cb50-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-126"><a href="#cb50-126" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb50-127"><a href="#cb50-127" aria-hidden="true" tabindex="-1"></a>    best_inner_auc <span class="ot">&lt;-</span> <span class="fu">mean</span>(inner_auc_vals, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb50-128"><a href="#cb50-128" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Reentrenar el mejor modelo con todos los datos de outer_train_data</span></span>
<span id="cb50-129"><a href="#cb50-129" aria-hidden="true" tabindex="-1"></a>    best_model <span class="ot">&lt;-</span> <span class="fu">rpart</span>(<span class="fu">as.formula</span>(<span class="fu">paste</span>(target_name, <span class="st">"~"</span>, <span class="fu">paste</span>(best_vars, <span class="at">collapse =</span> <span class="st">"+"</span>))),</span>
<span id="cb50-130"><a href="#cb50-130" aria-hidden="true" tabindex="-1"></a>                    <span class="at">data =</span> outer_train_data, <span class="at">control =</span> <span class="fu">rpart.control</span>(<span class="at">cp =</span> best_cp, <span class="at">minsplit =</span> best_minsplit))</span>
<span id="cb50-131"><a href="#cb50-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-132"><a href="#cb50-132" aria-hidden="true" tabindex="-1"></a>    predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(best_model, outer_test_data, <span class="at">type =</span> <span class="st">"prob"</span>)[, <span class="dv">2</span>]</span>
<span id="cb50-133"><a href="#cb50-133" aria-hidden="true" tabindex="-1"></a>    pred_class <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(predictions <span class="sc">&gt;</span> threshold, <span class="st">"1"</span>, <span class="st">"0"</span>)</span>
<span id="cb50-134"><a href="#cb50-134" aria-hidden="true" tabindex="-1"></a>    confusion <span class="ot">&lt;-</span> <span class="fu">table</span>(<span class="at">Actual =</span> outer_test_data[[target_name]], <span class="at">Predicted =</span> pred_class)</span>
<span id="cb50-135"><a href="#cb50-135" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb50-136"><a href="#cb50-136" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">nrow</span>(confusion) <span class="sc">&lt;</span> <span class="dv">2</span> <span class="sc">||</span> <span class="fu">ncol</span>(confusion) <span class="sc">&lt;</span> <span class="dv">2</span>) {</span>
<span id="cb50-137"><a href="#cb50-137" aria-hidden="true" tabindex="-1"></a>      TP <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span>, confusion[<span class="dv">2</span>, <span class="dv">2</span>], <span class="dv">0</span>)</span>
<span id="cb50-138"><a href="#cb50-138" aria-hidden="true" tabindex="-1"></a>      TN <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span>, confusion[<span class="dv">1</span>, <span class="dv">1</span>], <span class="dv">0</span>)</span>
<span id="cb50-139"><a href="#cb50-139" aria-hidden="true" tabindex="-1"></a>      FP <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span>, confusion[<span class="dv">1</span>, <span class="dv">2</span>], <span class="dv">0</span>)</span>
<span id="cb50-140"><a href="#cb50-140" aria-hidden="true" tabindex="-1"></a>      FN <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span>, confusion[<span class="dv">2</span>, <span class="dv">1</span>], <span class="dv">0</span>)</span>
<span id="cb50-141"><a href="#cb50-141" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb50-142"><a href="#cb50-142" aria-hidden="true" tabindex="-1"></a>      TP <span class="ot">&lt;-</span> confusion[<span class="dv">2</span>, <span class="dv">2</span>]</span>
<span id="cb50-143"><a href="#cb50-143" aria-hidden="true" tabindex="-1"></a>      TN <span class="ot">&lt;-</span> confusion[<span class="dv">1</span>, <span class="dv">1</span>]</span>
<span id="cb50-144"><a href="#cb50-144" aria-hidden="true" tabindex="-1"></a>      FP <span class="ot">&lt;-</span> confusion[<span class="dv">1</span>, <span class="dv">2</span>]</span>
<span id="cb50-145"><a href="#cb50-145" aria-hidden="true" tabindex="-1"></a>      FN <span class="ot">&lt;-</span> confusion[<span class="dv">2</span>, <span class="dv">1</span>]</span>
<span id="cb50-146"><a href="#cb50-146" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb50-147"><a href="#cb50-147" aria-hidden="true" tabindex="-1"></a>    auc <span class="ot">&lt;-</span> <span class="fu">roc</span>(outer_test_data[[target_name]], predictions)<span class="sc">$</span>auc</span>
<span id="cb50-148"><a href="#cb50-148" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb50-149"><a href="#cb50-149" aria-hidden="true" tabindex="-1"></a>    metrics <span class="ot">&lt;-</span> <span class="fu">setNames</span>(<span class="fu">c</span>(outer_index, TP, TN, FP, FN, auc, </span>
<span id="cb50-150"><a href="#cb50-150" aria-hidden="true" tabindex="-1"></a>                          best_cp, best_minsplit, <span class="fu">paste</span>(best_vars, <span class="at">collapse =</span> <span class="st">","</span>)), </span>
<span id="cb50-151"><a href="#cb50-151" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">names</span>(performance_metrics))</span>
<span id="cb50-152"><a href="#cb50-152" aria-hidden="true" tabindex="-1"></a>    performance_metrics <span class="ot">&lt;-</span> <span class="fu">rbind</span>(performance_metrics, <span class="fu">as.data.frame</span>(<span class="fu">t</span>(metrics)))</span>
<span id="cb50-153"><a href="#cb50-153" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb50-154"><a href="#cb50-154" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Performance:"</span>, <span class="fu">paste</span>(performance_metrics))</span>
<span id="cb50-155"><a href="#cb50-155" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Confusion Matrix for Fold %d:</span><span class="sc">\n</span><span class="st">"</span>, outer_index))</span>
<span id="cb50-156"><a href="#cb50-156" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(confusion)</span>
<span id="cb50-157"><a href="#cb50-157" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Metrics for Fold %d:</span><span class="sc">\n</span><span class="st">"</span>, outer_index))</span>
<span id="cb50-158"><a href="#cb50-158" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"TP: %d, TN: %d, FP: %d, FN: %d, AUC: %f, Best CP: %f, Best Minsplit: %d, Best Variables: %s</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb50-159"><a href="#cb50-159" aria-hidden="true" tabindex="-1"></a>                TP, TN, FP, FN, auc, best_cp, best_minsplit, <span class="fu">paste</span>(best_vars, <span class="at">collapse =</span> <span class="st">","</span>)))</span>
<span id="cb50-160"><a href="#cb50-160" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb50-161"><a href="#cb50-161" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb50-162"><a href="#cb50-162" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">performance_metrics =</span> performance_metrics, <span class="at">inner_fold_metrics =</span> inner_fold_metrics))</span>
<span id="cb50-163"><a href="#cb50-163" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb50-164"><a href="#cb50-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-165"><a href="#cb50-165" aria-hidden="true" tabindex="-1"></a>evaluate_with_seeds_DecisionTree_StepAUC <span class="ot">&lt;-</span> </span>
<span id="cb50-166"><a href="#cb50-166" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(evaluation_function, data, target_var, vars, threshold, seeds, outer, inner, cp_values, minsplit_values) {</span>
<span id="cb50-167"><a href="#cb50-167" aria-hidden="true" tabindex="-1"></a>  results_list <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb50-168"><a href="#cb50-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-169"><a href="#cb50-169" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (seed <span class="cf">in</span> seeds) {</span>
<span id="cb50-170"><a href="#cb50-170" aria-hidden="true" tabindex="-1"></a>    <span class="fu">set.seed</span>(seed)</span>
<span id="cb50-171"><a href="#cb50-171" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Evaluating with seed:"</span>, seed, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb50-172"><a href="#cb50-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-173"><a href="#cb50-173" aria-hidden="true" tabindex="-1"></a>    results <span class="ot">&lt;-</span> <span class="fu">evaluation_function</span>(<span class="at">data =</span> data, </span>
<span id="cb50-174"><a href="#cb50-174" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">target_name =</span> target_var, </span>
<span id="cb50-175"><a href="#cb50-175" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">variables =</span> vars, </span>
<span id="cb50-176"><a href="#cb50-176" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">threshold =</span> threshold, </span>
<span id="cb50-177"><a href="#cb50-177" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">outer =</span> outer, </span>
<span id="cb50-178"><a href="#cb50-178" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">inner =</span> inner, </span>
<span id="cb50-179"><a href="#cb50-179" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">seed =</span> seed,</span>
<span id="cb50-180"><a href="#cb50-180" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">cps =</span> cp_values,</span>
<span id="cb50-181"><a href="#cb50-181" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">minsplits =</span> minsplit_values)</span>
<span id="cb50-182"><a href="#cb50-182" aria-hidden="true" tabindex="-1"></a>    results_list[[<span class="fu">paste0</span>(<span class="st">"seed_"</span>, seed)]] <span class="ot">&lt;-</span> results</span>
<span id="cb50-183"><a href="#cb50-183" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb50-184"><a href="#cb50-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-185"><a href="#cb50-185" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(results_list)</span>
<span id="cb50-186"><a href="#cb50-186" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb50-187"><a href="#cb50-187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-188"><a href="#cb50-188" aria-hidden="true" tabindex="-1"></a>performance_rpart_StepAUC <span class="ot">&lt;-</span> <span class="fu">evaluate_with_seeds_DecisionTree_StepAUC</span>(</span>
<span id="cb50-189"><a href="#cb50-189" aria-hidden="true" tabindex="-1"></a>  <span class="at">evaluation_function =</span> double_cross_validation_rpart_stepAUC,</span>
<span id="cb50-190"><a href="#cb50-190" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_factor,</span>
<span id="cb50-191"><a href="#cb50-191" aria-hidden="true" tabindex="-1"></a>  <span class="at">outer =</span> <span class="dv">5</span>,</span>
<span id="cb50-192"><a href="#cb50-192" aria-hidden="true" tabindex="-1"></a>  <span class="at">inner =</span> <span class="dv">2</span>,</span>
<span id="cb50-193"><a href="#cb50-193" aria-hidden="true" tabindex="-1"></a>  <span class="at">target_var =</span> <span class="st">"PCR"</span>,</span>
<span id="cb50-194"><a href="#cb50-194" aria-hidden="true" tabindex="-1"></a>  <span class="at">cp_values =</span> <span class="fu">c</span>(<span class="fl">0.001</span>, <span class="fl">0.01</span>, <span class="fl">0.1</span>),</span>
<span id="cb50-195"><a href="#cb50-195" aria-hidden="true" tabindex="-1"></a>  <span class="at">minsplit_values =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">15</span>, <span class="dv">20</span>),</span>
<span id="cb50-196"><a href="#cb50-196" aria-hidden="true" tabindex="-1"></a>  <span class="at">vars =</span> todas_variables_factor,</span>
<span id="cb50-197"><a href="#cb50-197" aria-hidden="true" tabindex="-1"></a>  <span class="at">threshold =</span> .<span class="dv">35</span>,</span>
<span id="cb50-198"><a href="#cb50-198" aria-hidden="true" tabindex="-1"></a>  <span class="at">seeds =</span> seeds</span>
<span id="cb50-199"><a href="#cb50-199" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb50-200"><a href="#cb50-200" aria-hidden="true" tabindex="-1"></a>performance_rpart_StepAUC</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"RData_Files_Algorithms/DecisionTree_StepAUC.RData"</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="embedded-lasso-3" class="level3" data-number="3.4.5">
<h3 data-number="3.4.5" class="anchored" data-anchor-id="embedded-lasso-3"><span class="header-section-number">3.4.5</span> Embedded (Lasso)</h3>
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>double_cross_validation_rpart_Lasso <span class="ot">&lt;-</span> <span class="cf">function</span>(data, target_name, outer, inner, cps, minsplits, variables, threshold, seed) {</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(seed)</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>  performance_metrics <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Fold =</span> <span class="fu">integer</span>(), <span class="at">TP =</span> <span class="fu">integer</span>(), <span class="at">TN =</span> <span class="fu">integer</span>(),</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">FP =</span> <span class="fu">integer</span>(), <span class="at">FN =</span> <span class="fu">integer</span>(), <span class="at">AUC =</span> <span class="fu">numeric</span>(),</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">Best_cp =</span> <span class="fu">numeric</span>(), <span class="at">Best_minsplit =</span> <span class="fu">numeric</span>(), </span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">Best_Variables =</span> <span class="fu">character</span>(), <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>  inner_fold_metrics <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Fold =</span> <span class="fu">integer</span>(), <span class="at">Inner_Fold =</span> <span class="fu">integer</span>(), </span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">TP =</span> <span class="fu">integer</span>(), <span class="at">TN =</span> <span class="fu">integer</span>(), <span class="at">FP =</span> <span class="fu">integer</span>(), </span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">FN =</span> <span class="fu">integer</span>(), <span class="at">AUC =</span> <span class="fu">numeric</span>(), <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Convertir las variables del dataset con model.matrix</span></span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a>  target <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(data[[target_name]]) <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb52-14"><a href="#cb52-14" aria-hidden="true" tabindex="-1"></a>  features <span class="ot">&lt;-</span> data[, <span class="fu">setdiff</span>(<span class="fu">names</span>(data), target_name)]</span>
<span id="cb52-15"><a href="#cb52-15" aria-hidden="true" tabindex="-1"></a>  data_matrix <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">model.matrix</span>(<span class="sc">~</span> ., <span class="at">data=</span>features)[,<span class="sc">-</span><span class="dv">1</span>])  <span class="co"># Eliminar el intercepto</span></span>
<span id="cb52-16"><a href="#cb52-16" aria-hidden="true" tabindex="-1"></a>  data_matrix[[target_name]] <span class="ot">&lt;-</span> target</span>
<span id="cb52-17"><a href="#cb52-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb52-18"><a href="#cb52-18" aria-hidden="true" tabindex="-1"></a>  outer_folds <span class="ot">&lt;-</span> <span class="fu">createFolds</span>(data_matrix[[target_name]], <span class="at">k =</span> outer)</span>
<span id="cb52-19"><a href="#cb52-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb52-20"><a href="#cb52-20" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (outer_index <span class="cf">in</span> <span class="fu">seq_along</span>(outer_folds)) {</span>
<span id="cb52-21"><a href="#cb52-21" aria-hidden="true" tabindex="-1"></a>    outer_train_data <span class="ot">&lt;-</span> data_matrix[<span class="sc">-</span>outer_folds[[outer_index]], ]</span>
<span id="cb52-22"><a href="#cb52-22" aria-hidden="true" tabindex="-1"></a>    outer_test_data <span class="ot">&lt;-</span> data_matrix[outer_folds[[outer_index]], ]</span>
<span id="cb52-23"><a href="#cb52-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb52-24"><a href="#cb52-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Outer Fold %d</span><span class="sc">\n</span><span class="st">"</span>, outer_index))</span>
<span id="cb52-25"><a href="#cb52-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Training Data - Class 0: "</span>, <span class="fu">sum</span>(outer_train_data[[target_name]] <span class="sc">==</span> <span class="dv">0</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb52-26"><a href="#cb52-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Training Data - Class 1: "</span>, <span class="fu">sum</span>(outer_train_data[[target_name]] <span class="sc">==</span> <span class="dv">1</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb52-27"><a href="#cb52-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Testing Data - Class 0: "</span>, <span class="fu">sum</span>(outer_test_data[[target_name]] <span class="sc">==</span> <span class="dv">0</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb52-28"><a href="#cb52-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Testing Data - Class 1: "</span>, <span class="fu">sum</span>(outer_test_data[[target_name]] <span class="sc">==</span> <span class="dv">1</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb52-29"><a href="#cb52-29" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb52-30"><a href="#cb52-30" aria-hidden="true" tabindex="-1"></a>    inner_folds <span class="ot">&lt;-</span> <span class="fu">createFolds</span>(outer_train_data[[target_name]], <span class="at">k =</span> inner)</span>
<span id="cb52-31"><a href="#cb52-31" aria-hidden="true" tabindex="-1"></a>    best_model <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb52-32"><a href="#cb52-32" aria-hidden="true" tabindex="-1"></a>    best_auc <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb52-33"><a href="#cb52-33" aria-hidden="true" tabindex="-1"></a>    best_cp <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb52-34"><a href="#cb52-34" aria-hidden="true" tabindex="-1"></a>    best_minsplit <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb52-35"><a href="#cb52-35" aria-hidden="true" tabindex="-1"></a>    best_vars <span class="ot">&lt;-</span> <span class="fu">colnames</span>(outer_train_data)[<span class="sc">!</span><span class="fu">colnames</span>(outer_train_data) <span class="sc">%in%</span> target_name]</span>
<span id="cb52-36"><a href="#cb52-36" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb52-37"><a href="#cb52-37" aria-hidden="true" tabindex="-1"></a>    grid <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">cp =</span> cps, <span class="at">minsplit =</span> minsplits)</span>
<span id="cb52-38"><a href="#cb52-38" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb52-39"><a href="#cb52-39" aria-hidden="true" tabindex="-1"></a>    select_vars_lasso <span class="ot">&lt;-</span> <span class="cf">function</span>(data, target_name) {</span>
<span id="cb52-40"><a href="#cb52-40" aria-hidden="true" tabindex="-1"></a>      target <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(data[[target_name]])</span>
<span id="cb52-41"><a href="#cb52-41" aria-hidden="true" tabindex="-1"></a>      features <span class="ot">&lt;-</span> data[, <span class="fu">setdiff</span>(<span class="fu">names</span>(data), target_name)]</span>
<span id="cb52-42"><a href="#cb52-42" aria-hidden="true" tabindex="-1"></a>      X <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(<span class="sc">~</span> ., <span class="at">data=</span>features)[,<span class="sc">-</span><span class="dv">1</span>]  <span class="co"># Eliminamos el intercepto</span></span>
<span id="cb52-43"><a href="#cb52-43" aria-hidden="true" tabindex="-1"></a>      y <span class="ot">&lt;-</span> target</span>
<span id="cb52-44"><a href="#cb52-44" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb52-45"><a href="#cb52-45" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Ajustamos el modelo Lasso</span></span>
<span id="cb52-46"><a href="#cb52-46" aria-hidden="true" tabindex="-1"></a>      lasso_model <span class="ot">&lt;-</span> <span class="fu">cv.glmnet</span>(X, y, <span class="at">alpha=</span><span class="dv">1</span>)</span>
<span id="cb52-47"><a href="#cb52-47" aria-hidden="true" tabindex="-1"></a>      lasso_coef <span class="ot">&lt;-</span> <span class="fu">coef</span>(lasso_model, <span class="at">s =</span> <span class="st">"lambda.min"</span>)</span>
<span id="cb52-48"><a href="#cb52-48" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb52-49"><a href="#cb52-49" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Seleccionamos las variables no nulas</span></span>
<span id="cb52-50"><a href="#cb52-50" aria-hidden="true" tabindex="-1"></a>      selected_vars <span class="ot">&lt;-</span> <span class="fu">rownames</span>(lasso_coef)[lasso_coef[, <span class="dv">1</span>] <span class="sc">!=</span> <span class="dv">0</span>]</span>
<span id="cb52-51"><a href="#cb52-51" aria-hidden="true" tabindex="-1"></a>      selected_vars <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(selected_vars, <span class="st">"(Intercept)"</span>)</span>
<span id="cb52-52"><a href="#cb52-52" aria-hidden="true" tabindex="-1"></a>      <span class="co">#cat("Selected variables by Lasso: ", paste(selected_vars, collapse=", "), "\n")</span></span>
<span id="cb52-53"><a href="#cb52-53" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(selected_vars)</span>
<span id="cb52-54"><a href="#cb52-54" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb52-55"><a href="#cb52-55" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb52-56"><a href="#cb52-56" aria-hidden="true" tabindex="-1"></a>    stepAUC <span class="ot">&lt;-</span> <span class="cf">function</span>(vars, data, target_name, grid, inner_folds) {</span>
<span id="cb52-57"><a href="#cb52-57" aria-hidden="true" tabindex="-1"></a>      best_inner_auc <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb52-58"><a href="#cb52-58" aria-hidden="true" tabindex="-1"></a>      best_inner_model <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb52-59"><a href="#cb52-59" aria-hidden="true" tabindex="-1"></a>      best_inner_cp <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb52-60"><a href="#cb52-60" aria-hidden="true" tabindex="-1"></a>      best_inner_minsplit <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb52-61"><a href="#cb52-61" aria-hidden="true" tabindex="-1"></a>      best_inner_vars <span class="ot">&lt;-</span> vars</span>
<span id="cb52-62"><a href="#cb52-62" aria-hidden="true" tabindex="-1"></a>      improved <span class="ot">&lt;-</span> <span class="cn">TRUE</span></span>
<span id="cb52-63"><a href="#cb52-63" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb52-64"><a href="#cb52-64" aria-hidden="true" tabindex="-1"></a>      <span class="cf">while</span> (improved <span class="sc">&amp;&amp;</span> <span class="fu">length</span>(vars) <span class="sc">&gt;</span> <span class="dv">1</span>) {</span>
<span id="cb52-65"><a href="#cb52-65" aria-hidden="true" tabindex="-1"></a>        improved <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb52-66"><a href="#cb52-66" aria-hidden="true" tabindex="-1"></a>        best_auc_in_step <span class="ot">&lt;-</span> best_inner_auc</span>
<span id="cb52-67"><a href="#cb52-67" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb52-68"><a href="#cb52-68" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (params <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(grid)) {</span>
<span id="cb52-69"><a href="#cb52-69" aria-hidden="true" tabindex="-1"></a>          auc_vals <span class="ot">&lt;-</span> <span class="fu">numeric</span>()</span>
<span id="cb52-70"><a href="#cb52-70" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb52-71"><a href="#cb52-71" aria-hidden="true" tabindex="-1"></a>          <span class="cf">for</span> (inner_index <span class="cf">in</span> <span class="fu">seq_along</span>(inner_folds)) {</span>
<span id="cb52-72"><a href="#cb52-72" aria-hidden="true" tabindex="-1"></a>            inner_train_data <span class="ot">&lt;-</span> outer_train_data[<span class="sc">-</span>inner_folds[[inner_index]], ]</span>
<span id="cb52-73"><a href="#cb52-73" aria-hidden="true" tabindex="-1"></a>            inner_test_data <span class="ot">&lt;-</span> outer_train_data[inner_folds[[inner_index]], ]</span>
<span id="cb52-74"><a href="#cb52-74" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb52-75"><a href="#cb52-75" aria-hidden="true" tabindex="-1"></a>            selected_vars <span class="ot">&lt;-</span> <span class="fu">select_vars_lasso</span>(inner_train_data, target_name)</span>
<span id="cb52-76"><a href="#cb52-76" aria-hidden="true" tabindex="-1"></a>            formula <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(<span class="fu">paste</span>(target_name, <span class="st">"~"</span>, <span class="fu">paste</span>(selected_vars, <span class="at">collapse =</span> <span class="st">"+"</span>)))</span>
<span id="cb52-77"><a href="#cb52-77" aria-hidden="true" tabindex="-1"></a>            <span class="co">#cat("Testing with formula: ", deparse(formula), "\n")</span></span>
<span id="cb52-78"><a href="#cb52-78" aria-hidden="true" tabindex="-1"></a>            <span class="co">#cat("Grid parameters - cp: ", grid$cp[params], ", minsplit: ", grid$minsplit[params], "\n")</span></span>
<span id="cb52-79"><a href="#cb52-79" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb52-80"><a href="#cb52-80" aria-hidden="true" tabindex="-1"></a>            result <span class="ot">&lt;-</span> <span class="fu">tryCatch</span>({</span>
<span id="cb52-81"><a href="#cb52-81" aria-hidden="true" tabindex="-1"></a>              model <span class="ot">&lt;-</span> <span class="fu">rpart</span>(formula, <span class="at">data =</span> inner_train_data, <span class="at">method =</span> <span class="st">"class"</span>, </span>
<span id="cb52-82"><a href="#cb52-82" aria-hidden="true" tabindex="-1"></a>                             <span class="at">control =</span> <span class="fu">rpart.control</span>(<span class="at">cp =</span> grid<span class="sc">$</span>cp[params], <span class="at">minsplit =</span> grid<span class="sc">$</span>minsplit[params]))</span>
<span id="cb52-83"><a href="#cb52-83" aria-hidden="true" tabindex="-1"></a>              </span>
<span id="cb52-84"><a href="#cb52-84" aria-hidden="true" tabindex="-1"></a>              predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(model, inner_test_data, <span class="at">type =</span> <span class="st">"prob"</span>)[,<span class="dv">2</span>]</span>
<span id="cb52-85"><a href="#cb52-85" aria-hidden="true" tabindex="-1"></a>              roc_curve <span class="ot">&lt;-</span> <span class="fu">roc</span>(inner_test_data[[target_name]], predictions)</span>
<span id="cb52-86"><a href="#cb52-86" aria-hidden="true" tabindex="-1"></a>              auc_vals[inner_index] <span class="ot">&lt;-</span> roc_curve<span class="sc">$</span>auc</span>
<span id="cb52-87"><a href="#cb52-87" aria-hidden="true" tabindex="-1"></a>              <span class="co">#cat("AUC for inner fold ", inner_index, ": ", roc_curve$auc, "\n")</span></span>
<span id="cb52-88"><a href="#cb52-88" aria-hidden="true" tabindex="-1"></a>              </span>
<span id="cb52-89"><a href="#cb52-89" aria-hidden="true" tabindex="-1"></a>            }, <span class="at">error =</span> <span class="cf">function</span>(e) {</span>
<span id="cb52-90"><a href="#cb52-90" aria-hidden="true" tabindex="-1"></a>              <span class="fu">cat</span>(<span class="st">"Error with variables: "</span>, <span class="fu">paste</span>(selected_vars, <span class="at">collapse =</span> <span class="st">", "</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb52-91"><a href="#cb52-91" aria-hidden="true" tabindex="-1"></a>              <span class="fu">cat</span>(<span class="st">"Error message: "</span>, e<span class="sc">$</span>message, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb52-92"><a href="#cb52-92" aria-hidden="true" tabindex="-1"></a>              auc_vals[inner_index] <span class="ot">&lt;-</span> <span class="cn">NA</span>  <span class="co"># Set to NA or some other indicator of failure</span></span>
<span id="cb52-93"><a href="#cb52-93" aria-hidden="true" tabindex="-1"></a>            })</span>
<span id="cb52-94"><a href="#cb52-94" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb52-95"><a href="#cb52-95" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb52-96"><a href="#cb52-96" aria-hidden="true" tabindex="-1"></a>          mean_auc <span class="ot">&lt;-</span> <span class="fu">mean</span>(auc_vals, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb52-97"><a href="#cb52-97" aria-hidden="true" tabindex="-1"></a>          <span class="co">#cat("Mean AUC for params - cp: ", grid$cp[params], ", minsplit: ", grid$minsplit[params], ": ", mean_auc, "\n")</span></span>
<span id="cb52-98"><a href="#cb52-98" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.na</span>(mean_auc) <span class="sc">&amp;&amp;</span> mean_auc <span class="sc">&gt;</span> best_auc_in_step) {</span>
<span id="cb52-99"><a href="#cb52-99" aria-hidden="true" tabindex="-1"></a>            best_auc_in_step <span class="ot">&lt;-</span> mean_auc</span>
<span id="cb52-100"><a href="#cb52-100" aria-hidden="true" tabindex="-1"></a>            best_inner_model <span class="ot">&lt;-</span> model</span>
<span id="cb52-101"><a href="#cb52-101" aria-hidden="true" tabindex="-1"></a>            best_inner_cp <span class="ot">&lt;-</span> grid<span class="sc">$</span>cp[params]</span>
<span id="cb52-102"><a href="#cb52-102" aria-hidden="true" tabindex="-1"></a>            best_inner_minsplit <span class="ot">&lt;-</span> grid<span class="sc">$</span>minsplit[params]</span>
<span id="cb52-103"><a href="#cb52-103" aria-hidden="true" tabindex="-1"></a>            best_inner_vars <span class="ot">&lt;-</span> selected_vars</span>
<span id="cb52-104"><a href="#cb52-104" aria-hidden="true" tabindex="-1"></a>            improved <span class="ot">&lt;-</span> <span class="cn">TRUE</span></span>
<span id="cb52-105"><a href="#cb52-105" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb52-106"><a href="#cb52-106" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb52-107"><a href="#cb52-107" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb52-108"><a href="#cb52-108" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (improved) {</span>
<span id="cb52-109"><a href="#cb52-109" aria-hidden="true" tabindex="-1"></a>          vars <span class="ot">&lt;-</span> best_inner_vars</span>
<span id="cb52-110"><a href="#cb52-110" aria-hidden="true" tabindex="-1"></a>          best_inner_auc <span class="ot">&lt;-</span> best_auc_in_step</span>
<span id="cb52-111"><a href="#cb52-111" aria-hidden="true" tabindex="-1"></a>          <span class="fu">cat</span>(<span class="st">"Vars improved: "</span>, <span class="fu">paste</span>(vars, <span class="at">collapse=</span><span class="st">", "</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb52-112"><a href="#cb52-112" aria-hidden="true" tabindex="-1"></a>          <span class="fu">cat</span>(<span class="st">"AUC: "</span>, best_inner_auc, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb52-113"><a href="#cb52-113" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb52-114"><a href="#cb52-114" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb52-115"><a href="#cb52-115" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb52-116"><a href="#cb52-116" aria-hidden="true" tabindex="-1"></a>      <span class="fu">list</span>(<span class="at">model =</span> best_inner_model, <span class="at">auc =</span> best_inner_auc, </span>
<span id="cb52-117"><a href="#cb52-117" aria-hidden="true" tabindex="-1"></a>           <span class="at">cp =</span> best_inner_cp, <span class="at">minsplit =</span> best_inner_minsplit, </span>
<span id="cb52-118"><a href="#cb52-118" aria-hidden="true" tabindex="-1"></a>           <span class="at">vars =</span> best_inner_vars)</span>
<span id="cb52-119"><a href="#cb52-119" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb52-120"><a href="#cb52-120" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb52-121"><a href="#cb52-121" aria-hidden="true" tabindex="-1"></a>    best_result <span class="ot">&lt;-</span> <span class="fu">stepAUC</span>(best_vars, outer_train_data, target_name, grid, inner_folds)</span>
<span id="cb52-122"><a href="#cb52-122" aria-hidden="true" tabindex="-1"></a>    best_model <span class="ot">&lt;-</span> best_result<span class="sc">$</span>model</span>
<span id="cb52-123"><a href="#cb52-123" aria-hidden="true" tabindex="-1"></a>    best_auc <span class="ot">&lt;-</span> best_result<span class="sc">$</span>auc</span>
<span id="cb52-124"><a href="#cb52-124" aria-hidden="true" tabindex="-1"></a>    best_cp <span class="ot">&lt;-</span> best_result<span class="sc">$</span>cp</span>
<span id="cb52-125"><a href="#cb52-125" aria-hidden="true" tabindex="-1"></a>    best_minsplit <span class="ot">&lt;-</span> best_result<span class="sc">$</span>minsplit</span>
<span id="cb52-126"><a href="#cb52-126" aria-hidden="true" tabindex="-1"></a>    best_vars <span class="ot">&lt;-</span> best_result<span class="sc">$</span>vars</span>
<span id="cb52-127"><a href="#cb52-127" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb52-128"><a href="#cb52-128" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">is.null</span>(best_model)) {</span>
<span id="cb52-129"><a href="#cb52-129" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cat</span>(<span class="st">"Error: No valid model found for outer fold "</span>, outer_index, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb52-130"><a href="#cb52-130" aria-hidden="true" tabindex="-1"></a>      <span class="cf">next</span></span>
<span id="cb52-131"><a href="#cb52-131" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb52-132"><a href="#cb52-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-133"><a href="#cb52-133" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Evaluar el mejor modelo en el validation split del inner loop</span></span>
<span id="cb52-134"><a href="#cb52-134" aria-hidden="true" tabindex="-1"></a>    inner_auc_vals <span class="ot">&lt;-</span> <span class="fu">numeric</span>()</span>
<span id="cb52-135"><a href="#cb52-135" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (inner_index <span class="cf">in</span> <span class="fu">seq_along</span>(inner_folds)) {</span>
<span id="cb52-136"><a href="#cb52-136" aria-hidden="true" tabindex="-1"></a>      inner_train_data <span class="ot">&lt;-</span> outer_train_data[<span class="sc">-</span>inner_folds[[inner_index]], ]</span>
<span id="cb52-137"><a href="#cb52-137" aria-hidden="true" tabindex="-1"></a>      inner_test_data <span class="ot">&lt;-</span> outer_train_data[inner_folds[[inner_index]], ]</span>
<span id="cb52-138"><a href="#cb52-138" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb52-139"><a href="#cb52-139" aria-hidden="true" tabindex="-1"></a>      predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(best_model, inner_test_data, <span class="at">type =</span> <span class="st">"prob"</span>)[,<span class="dv">2</span>]</span>
<span id="cb52-140"><a href="#cb52-140" aria-hidden="true" tabindex="-1"></a>      roc_curve <span class="ot">&lt;-</span> <span class="fu">roc</span>(inner_test_data[[target_name]], predictions)</span>
<span id="cb52-141"><a href="#cb52-141" aria-hidden="true" tabindex="-1"></a>      inner_auc_vals[inner_index] <span class="ot">&lt;-</span> roc_curve<span class="sc">$</span>auc</span>
<span id="cb52-142"><a href="#cb52-142" aria-hidden="true" tabindex="-1"></a>      <span class="co">#cat("Inner fold ", inner_index, " AUC: ", roc_curve$auc, "\n")</span></span>
<span id="cb52-143"><a href="#cb52-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-144"><a href="#cb52-144" aria-hidden="true" tabindex="-1"></a>      pred_class <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(predictions <span class="sc">&gt;</span> threshold, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb52-145"><a href="#cb52-145" aria-hidden="true" tabindex="-1"></a>      confusion <span class="ot">&lt;-</span> <span class="fu">table</span>(<span class="at">Actual =</span> inner_test_data[[target_name]], <span class="at">Predicted =</span> pred_class)</span>
<span id="cb52-146"><a href="#cb52-146" aria-hidden="true" tabindex="-1"></a>      TP <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span>, confusion[<span class="dv">2</span>, <span class="dv">2</span>], <span class="dv">0</span>)</span>
<span id="cb52-147"><a href="#cb52-147" aria-hidden="true" tabindex="-1"></a>      TN <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span>, confusion[<span class="dv">1</span>, <span class="dv">1</span>], <span class="dv">0</span>)</span>
<span id="cb52-148"><a href="#cb52-148" aria-hidden="true" tabindex="-1"></a>      FP <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span>, confusion[<span class="dv">1</span>, <span class="dv">2</span>], <span class="dv">0</span>)</span>
<span id="cb52-149"><a href="#cb52-149" aria-hidden="true" tabindex="-1"></a>      FN <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span>, confusion[<span class="dv">2</span>, <span class="dv">1</span>], <span class="dv">0</span>)</span>
<span id="cb52-150"><a href="#cb52-150" aria-hidden="true" tabindex="-1"></a>      auc <span class="ot">&lt;-</span> roc_curve<span class="sc">$</span>auc</span>
<span id="cb52-151"><a href="#cb52-151" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb52-152"><a href="#cb52-152" aria-hidden="true" tabindex="-1"></a>      inner_metrics <span class="ot">&lt;-</span> <span class="fu">setNames</span>(<span class="fu">c</span>(outer_index, inner_index, TP, TN, FP, FN, auc), <span class="fu">names</span>(inner_fold_metrics))</span>
<span id="cb52-153"><a href="#cb52-153" aria-hidden="true" tabindex="-1"></a>      inner_fold_metrics <span class="ot">&lt;-</span> <span class="fu">rbind</span>(inner_fold_metrics, <span class="fu">as.data.frame</span>(<span class="fu">t</span>(inner_metrics)))</span>
<span id="cb52-154"><a href="#cb52-154" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb52-155"><a href="#cb52-155" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb52-156"><a href="#cb52-156" aria-hidden="true" tabindex="-1"></a>    best_inner_auc <span class="ot">&lt;-</span> <span class="fu">mean</span>(inner_auc_vals, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb52-157"><a href="#cb52-157" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Best inner AUC: "</span>, best_inner_auc, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb52-158"><a href="#cb52-158" aria-hidden="true" tabindex="-1"></a>    best_model <span class="ot">&lt;-</span> <span class="fu">rpart</span>(<span class="fu">as.formula</span>(<span class="fu">paste</span>(target_name, <span class="st">"~"</span>, <span class="fu">paste</span>(best_vars, <span class="at">collapse =</span> <span class="st">"+"</span>))),</span>
<span id="cb52-159"><a href="#cb52-159" aria-hidden="true" tabindex="-1"></a>                        <span class="at">data =</span> outer_train_data, <span class="at">method =</span> <span class="st">"class"</span>, </span>
<span id="cb52-160"><a href="#cb52-160" aria-hidden="true" tabindex="-1"></a>                        <span class="at">control =</span> <span class="fu">rpart.control</span>(<span class="at">cp =</span> best_cp, <span class="at">minsplit =</span> best_minsplit))</span>
<span id="cb52-161"><a href="#cb52-161" aria-hidden="true" tabindex="-1"></a>    predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(best_model, outer_test_data, <span class="at">type =</span> <span class="st">"prob"</span>)[,<span class="dv">2</span>]</span>
<span id="cb52-162"><a href="#cb52-162" aria-hidden="true" tabindex="-1"></a>    pred_class <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(predictions <span class="sc">&gt;</span> threshold, <span class="dv">1</span>, <span class="dv">0</span>)  <span class="co"># Asignar clases basadas en umbral</span></span>
<span id="cb52-163"><a href="#cb52-163" aria-hidden="true" tabindex="-1"></a>    confusion <span class="ot">&lt;-</span> <span class="fu">table</span>(<span class="at">Actual =</span> outer_test_data[[target_name]], <span class="at">Predicted =</span> pred_class)</span>
<span id="cb52-164"><a href="#cb52-164" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb52-165"><a href="#cb52-165" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">nrow</span>(confusion) <span class="sc">&lt;</span> <span class="dv">2</span> <span class="sc">||</span> <span class="fu">ncol</span>(confusion) <span class="sc">&lt;</span> <span class="dv">2</span>) {</span>
<span id="cb52-166"><a href="#cb52-166" aria-hidden="true" tabindex="-1"></a>      TP <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span>, confusion[<span class="dv">2</span>, <span class="dv">2</span>], <span class="dv">0</span>)</span>
<span id="cb52-167"><a href="#cb52-167" aria-hidden="true" tabindex="-1"></a>      TN <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span>, confusion[<span class="dv">1</span>, <span class="dv">1</span>], <span class="dv">0</span>)</span>
<span id="cb52-168"><a href="#cb52-168" aria-hidden="true" tabindex="-1"></a>      FP <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span>, confusion[<span class="dv">1</span>, <span class="dv">2</span>], <span class="dv">0</span>)</span>
<span id="cb52-169"><a href="#cb52-169" aria-hidden="true" tabindex="-1"></a>      FN <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span>, confusion[<span class="dv">2</span>, <span class="dv">1</span>], <span class="dv">0</span>)</span>
<span id="cb52-170"><a href="#cb52-170" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb52-171"><a href="#cb52-171" aria-hidden="true" tabindex="-1"></a>      TP <span class="ot">&lt;-</span> confusion[<span class="dv">2</span>, <span class="dv">2</span>]</span>
<span id="cb52-172"><a href="#cb52-172" aria-hidden="true" tabindex="-1"></a>      TN <span class="ot">&lt;-</span> confusion[<span class="dv">1</span>, <span class="dv">1</span>]</span>
<span id="cb52-173"><a href="#cb52-173" aria-hidden="true" tabindex="-1"></a>      FP <span class="ot">&lt;-</span> confusion[<span class="dv">1</span>, <span class="dv">2</span>]</span>
<span id="cb52-174"><a href="#cb52-174" aria-hidden="true" tabindex="-1"></a>      FN <span class="ot">&lt;-</span> confusion[<span class="dv">2</span>, <span class="dv">1</span>]</span>
<span id="cb52-175"><a href="#cb52-175" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb52-176"><a href="#cb52-176" aria-hidden="true" tabindex="-1"></a>    auc <span class="ot">&lt;-</span> <span class="fu">roc</span>(outer_test_data[[target_name]], predictions)<span class="sc">$</span>auc</span>
<span id="cb52-177"><a href="#cb52-177" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb52-178"><a href="#cb52-178" aria-hidden="true" tabindex="-1"></a>    metrics <span class="ot">&lt;-</span> <span class="fu">setNames</span>(<span class="fu">c</span>(outer_index, TP, TN, FP, FN, auc, </span>
<span id="cb52-179"><a href="#cb52-179" aria-hidden="true" tabindex="-1"></a>                          best_cp, best_minsplit, <span class="fu">paste</span>(best_vars, <span class="at">collapse =</span> <span class="st">","</span>)), </span>
<span id="cb52-180"><a href="#cb52-180" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">names</span>(performance_metrics))</span>
<span id="cb52-181"><a href="#cb52-181" aria-hidden="true" tabindex="-1"></a>    performance_metrics <span class="ot">&lt;-</span> <span class="fu">rbind</span>(performance_metrics, <span class="fu">as.data.frame</span>(<span class="fu">t</span>(metrics)))</span>
<span id="cb52-182"><a href="#cb52-182" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb52-183"><a href="#cb52-183" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Performance:</span><span class="sc">\n</span><span class="st">"</span>, <span class="fu">paste</span>(performance_metrics), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb52-184"><a href="#cb52-184" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Confusion Matrix for Fold %d:</span><span class="sc">\n</span><span class="st">"</span>, outer_index))</span>
<span id="cb52-185"><a href="#cb52-185" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(confusion)</span>
<span id="cb52-186"><a href="#cb52-186" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Metrics for Fold %d:</span><span class="sc">\n</span><span class="st">"</span>, outer_index))</span>
<span id="cb52-187"><a href="#cb52-187" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"TP: %d, TN: %d, FP: %d, FN: %d, AUC: %f, Best cp: %f, Best minsplit: %d, Best Variables: %s</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb52-188"><a href="#cb52-188" aria-hidden="true" tabindex="-1"></a>                TP, TN, FP, FN, auc, best_cp, best_minsplit, <span class="fu">paste</span>(best_vars, <span class="at">collapse =</span> <span class="st">","</span>)))</span>
<span id="cb52-189"><a href="#cb52-189" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb52-190"><a href="#cb52-190" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb52-191"><a href="#cb52-191" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="at">performance_metrics =</span> performance_metrics, <span class="at">inner_fold_metrics =</span> inner_fold_metrics)</span>
<span id="cb52-192"><a href="#cb52-192" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb52-193"><a href="#cb52-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-194"><a href="#cb52-194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-195"><a href="#cb52-195" aria-hidden="true" tabindex="-1"></a>evaluate_with_seeds_DecisionTree_lasso <span class="ot">&lt;-</span> </span>
<span id="cb52-196"><a href="#cb52-196" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(evaluation_function, data, target_var, vars, threshold, seeds, outer, inner, cp_values, minsplit_values) {</span>
<span id="cb52-197"><a href="#cb52-197" aria-hidden="true" tabindex="-1"></a>  results_list <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb52-198"><a href="#cb52-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-199"><a href="#cb52-199" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (seed <span class="cf">in</span> seeds) {</span>
<span id="cb52-200"><a href="#cb52-200" aria-hidden="true" tabindex="-1"></a>    <span class="fu">set.seed</span>(seed)</span>
<span id="cb52-201"><a href="#cb52-201" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Evaluating with seed:"</span>, seed, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb52-202"><a href="#cb52-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-203"><a href="#cb52-203" aria-hidden="true" tabindex="-1"></a>    results <span class="ot">&lt;-</span> <span class="fu">evaluation_function</span>(<span class="at">data =</span> data, </span>
<span id="cb52-204"><a href="#cb52-204" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">target_name =</span> target_var, </span>
<span id="cb52-205"><a href="#cb52-205" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">variables =</span> vars, </span>
<span id="cb52-206"><a href="#cb52-206" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">threshold =</span> threshold, </span>
<span id="cb52-207"><a href="#cb52-207" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">outer =</span> outer, </span>
<span id="cb52-208"><a href="#cb52-208" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">inner =</span> inner, </span>
<span id="cb52-209"><a href="#cb52-209" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">seed =</span> seed,</span>
<span id="cb52-210"><a href="#cb52-210" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">cps =</span> cp_values,</span>
<span id="cb52-211"><a href="#cb52-211" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">minsplits =</span> minsplit_values)</span>
<span id="cb52-212"><a href="#cb52-212" aria-hidden="true" tabindex="-1"></a>    results_list[[<span class="fu">paste0</span>(<span class="st">"seed_"</span>, seed)]] <span class="ot">&lt;-</span> results</span>
<span id="cb52-213"><a href="#cb52-213" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb52-214"><a href="#cb52-214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-215"><a href="#cb52-215" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(results_list)</span>
<span id="cb52-216"><a href="#cb52-216" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb52-217"><a href="#cb52-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-218"><a href="#cb52-218" aria-hidden="true" tabindex="-1"></a>performance_rpart_lasso <span class="ot">&lt;-</span> <span class="fu">evaluate_with_seeds_DecisionTree_lasso</span>(</span>
<span id="cb52-219"><a href="#cb52-219" aria-hidden="true" tabindex="-1"></a>  <span class="at">evaluation_function =</span> double_cross_validation_rpart_Lasso,</span>
<span id="cb52-220"><a href="#cb52-220" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_factor,</span>
<span id="cb52-221"><a href="#cb52-221" aria-hidden="true" tabindex="-1"></a>  <span class="at">outer =</span> <span class="dv">5</span>,</span>
<span id="cb52-222"><a href="#cb52-222" aria-hidden="true" tabindex="-1"></a>  <span class="at">inner =</span> <span class="dv">2</span>,</span>
<span id="cb52-223"><a href="#cb52-223" aria-hidden="true" tabindex="-1"></a>  <span class="at">target_var =</span> <span class="st">"PCR"</span>,</span>
<span id="cb52-224"><a href="#cb52-224" aria-hidden="true" tabindex="-1"></a>  <span class="at">cp_values =</span> <span class="fu">c</span>(<span class="fl">0.001</span>, <span class="fl">0.01</span>, <span class="fl">0.1</span>),</span>
<span id="cb52-225"><a href="#cb52-225" aria-hidden="true" tabindex="-1"></a>  <span class="at">minsplit_values =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">15</span>, <span class="dv">20</span>),</span>
<span id="cb52-226"><a href="#cb52-226" aria-hidden="true" tabindex="-1"></a>  <span class="at">vars =</span> todas_variables_factor,</span>
<span id="cb52-227"><a href="#cb52-227" aria-hidden="true" tabindex="-1"></a>  <span class="at">threshold =</span> .<span class="dv">35</span>,</span>
<span id="cb52-228"><a href="#cb52-228" aria-hidden="true" tabindex="-1"></a>  <span class="at">seeds =</span> seeds</span>
<span id="cb52-229"><a href="#cb52-229" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"RData_Files_Algorithms/DecisionTree_Lasso.RData"</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="k-nearest-neighbours-1" class="level2" data-number="3.5">
<h2 data-number="3.5" class="anchored" data-anchor-id="k-nearest-neighbours-1"><span class="header-section-number">3.5</span> K-Nearest Neighbours</h2>
<section id="aparente-4" class="level3" data-number="3.5.1">
<h3 data-number="3.5.1" class="anchored" data-anchor-id="aparente-4"><span class="header-section-number">3.5.1</span> Aparente</h3>
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>evaluate_aparent_performance_model_knn <span class="ot">&lt;-</span> <span class="cf">function</span>(data, target_var, model_func, <span class="at">vars =</span> <span class="cn">NULL</span>, <span class="at">threshold =</span> <span class="fl">0.5</span>) {</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.null</span>(vars)) {</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>    vars <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(<span class="fu">names</span>(data), target_var)</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>  data[[target_var]] <span class="ot">&lt;-</span> <span class="fu">factor</span>(data[[target_var]], <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>  formula <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(<span class="fu">paste</span>(target_var, <span class="st">"~"</span>, <span class="fu">paste</span>(vars, <span class="at">collapse =</span> <span class="st">"+"</span>)))</span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a>  model <span class="ot">&lt;-</span> <span class="fu">model_func</span>(formula, data)</span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a>  train_x <span class="ot">&lt;-</span> model<span class="sc">$</span>train_x</span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a>  train_y <span class="ot">&lt;-</span> model<span class="sc">$</span>train_y</span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true" tabindex="-1"></a>  test_x <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(formula, data)[, <span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb54-13"><a href="#cb54-13" aria-hidden="true" tabindex="-1"></a>  predictions <span class="ot">&lt;-</span> <span class="fu">knn</span>(<span class="at">train =</span> train_x, <span class="at">test =</span> test_x, <span class="at">cl =</span> train_y, <span class="at">k =</span> model<span class="sc">$</span>k, <span class="at">prob =</span> <span class="cn">TRUE</span>)</span>
<span id="cb54-14"><a href="#cb54-14" aria-hidden="true" tabindex="-1"></a>  predictions <span class="ot">&lt;-</span> <span class="fu">attr</span>(predictions, <span class="st">"prob"</span>)</span>
<span id="cb54-15"><a href="#cb54-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb54-16"><a href="#cb54-16" aria-hidden="true" tabindex="-1"></a>  actual_classes <span class="ot">&lt;-</span> data[[target_var]]</span>
<span id="cb54-17"><a href="#cb54-17" aria-hidden="true" tabindex="-1"></a>  predicted_classes <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(predictions <span class="sc">&gt;</span> threshold, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb54-18"><a href="#cb54-18" aria-hidden="true" tabindex="-1"></a>  confusion_matrix <span class="ot">&lt;-</span> <span class="fu">table</span>(predicted_classes, actual_classes)</span>
<span id="cb54-19"><a href="#cb54-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb54-20"><a href="#cb54-20" aria-hidden="true" tabindex="-1"></a>  tp <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="st">"1"</span> <span class="sc">%in%</span> <span class="fu">rownames</span>(confusion_matrix) <span class="sc">&amp;&amp;</span> <span class="st">"1"</span> <span class="sc">%in%</span> <span class="fu">colnames</span>(confusion_matrix), confusion_matrix[<span class="st">"1"</span>, <span class="st">"1"</span>], <span class="dv">0</span>)</span>
<span id="cb54-21"><a href="#cb54-21" aria-hidden="true" tabindex="-1"></a>  tn <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="st">"0"</span> <span class="sc">%in%</span> <span class="fu">rownames</span>(confusion_matrix) <span class="sc">&amp;&amp;</span> <span class="st">"0"</span> <span class="sc">%in%</span> <span class="fu">colnames</span>(confusion_matrix), confusion_matrix[<span class="st">"0"</span>, <span class="st">"0"</span>], <span class="dv">0</span>)</span>
<span id="cb54-22"><a href="#cb54-22" aria-hidden="true" tabindex="-1"></a>  fp <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="st">"1"</span> <span class="sc">%in%</span> <span class="fu">rownames</span>(confusion_matrix) <span class="sc">&amp;&amp;</span> <span class="st">"0"</span> <span class="sc">%in%</span> <span class="fu">colnames</span>(confusion_matrix), confusion_matrix[<span class="st">"1"</span>, <span class="st">"0"</span>], <span class="dv">0</span>)</span>
<span id="cb54-23"><a href="#cb54-23" aria-hidden="true" tabindex="-1"></a>  fn <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="st">"0"</span> <span class="sc">%in%</span> <span class="fu">rownames</span>(confusion_matrix) <span class="sc">&amp;&amp;</span> <span class="st">"1"</span> <span class="sc">%in%</span> <span class="fu">colnames</span>(confusion_matrix), confusion_matrix[<span class="st">"0"</span>, <span class="st">"1"</span>], <span class="dv">0</span>)</span>
<span id="cb54-24"><a href="#cb54-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb54-25"><a href="#cb54-25" aria-hidden="true" tabindex="-1"></a>  accuracy <span class="ot">&lt;-</span> (tp <span class="sc">+</span> tn) <span class="sc">/</span> (tp <span class="sc">+</span> tn <span class="sc">+</span> fp <span class="sc">+</span> fn)</span>
<span id="cb54-26"><a href="#cb54-26" aria-hidden="true" tabindex="-1"></a>  precision <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(tp <span class="sc">+</span> fp <span class="sc">&gt;</span> <span class="dv">0</span>, tp <span class="sc">/</span> (tp <span class="sc">+</span> fp), <span class="dv">0</span>)</span>
<span id="cb54-27"><a href="#cb54-27" aria-hidden="true" tabindex="-1"></a>  recall <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(tp <span class="sc">+</span> fn <span class="sc">&gt;</span> <span class="dv">0</span>, tp <span class="sc">/</span> (tp <span class="sc">+</span> fn), <span class="dv">0</span>)</span>
<span id="cb54-28"><a href="#cb54-28" aria-hidden="true" tabindex="-1"></a>  f1_score <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(precision <span class="sc">+</span> recall <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="dv">2</span> <span class="sc">*</span> (precision <span class="sc">*</span> recall) <span class="sc">/</span> (precision <span class="sc">+</span> recall), <span class="dv">0</span>)</span>
<span id="cb54-29"><a href="#cb54-29" aria-hidden="true" tabindex="-1"></a>  roc_obj <span class="ot">&lt;-</span> pROC<span class="sc">::</span><span class="fu">roc</span>(actual_classes, predictions)</span>
<span id="cb54-30"><a href="#cb54-30" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb54-31"><a href="#cb54-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="at">confusion_matrix =</span> confusion_matrix, <span class="at">accuracy =</span> accuracy, <span class="at">precision =</span> precision, </span>
<span id="cb54-32"><a href="#cb54-32" aria-hidden="true" tabindex="-1"></a>       <span class="at">recall =</span> recall, <span class="at">f1_score =</span> f1_score, <span class="at">roc_curve =</span> roc_obj)</span>
<span id="cb54-33"><a href="#cb54-33" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb54-34"><a href="#cb54-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-35"><a href="#cb54-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-36"><a href="#cb54-36" aria-hidden="true" tabindex="-1"></a>knn_model <span class="ot">&lt;-</span> <span class="cf">function</span>(formula, data) {</span>
<span id="cb54-37"><a href="#cb54-37" aria-hidden="true" tabindex="-1"></a>  train_x <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(formula, data)[, <span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb54-38"><a href="#cb54-38" aria-hidden="true" tabindex="-1"></a>  train_y <span class="ot">&lt;-</span> data[[<span class="fu">all.vars</span>(formula)[<span class="dv">1</span>]]]</span>
<span id="cb54-39"><a href="#cb54-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="at">train_x =</span> train_x, <span class="at">train_y =</span> train_y, <span class="at">k =</span> <span class="dv">5</span>)  </span>
<span id="cb54-40"><a href="#cb54-40" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb54-41"><a href="#cb54-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-42"><a href="#cb54-42" aria-hidden="true" tabindex="-1"></a>resultadosAparentesKNN <span class="ot">&lt;-</span> <span class="fu">evaluate_aparent_performance_model_knn</span>(<span class="at">data =</span> data_numeric, <span class="at">target_var =</span> <span class="st">"PCR"</span>,</span>
<span id="cb54-43"><a href="#cb54-43" aria-hidden="true" tabindex="-1"></a>                                                             <span class="at">model_func =</span> knn_model,</span>
<span id="cb54-44"><a href="#cb54-44" aria-hidden="true" tabindex="-1"></a>                                                             <span class="at">vars =</span> <span class="st">"."</span>,</span>
<span id="cb54-45"><a href="#cb54-45" aria-hidden="true" tabindex="-1"></a>                                                             <span class="at">threshold =</span> .<span class="dv">35</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"RData_Files_Algorithms/KNN_Aparente.RData"</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="todas-las-variables-4" class="level3" data-number="3.5.2">
<h3 data-number="3.5.2" class="anchored" data-anchor-id="todas-las-variables-4"><span class="header-section-number">3.5.2</span> Todas las Variables</h3>
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>double_cross_validation_knn <span class="ot">&lt;-</span> <span class="cf">function</span>(data, target_name, outer, inner, ks, ls, variables, threshold, seed) {</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(seed)</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>  performance_metrics <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Fold =</span> <span class="fu">integer</span>(), <span class="at">TP =</span> <span class="fu">integer</span>(), <span class="at">TN =</span> <span class="fu">integer</span>(),</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">FP =</span> <span class="fu">integer</span>(), <span class="at">FN =</span> <span class="fu">integer</span>(), <span class="at">AUC =</span> <span class="fu">numeric</span>(),</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">Best_k =</span> <span class="fu">integer</span>(), <span class="at">Best_l =</span> <span class="fu">numeric</span>(), <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>  data[[target_name]] <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(data[[target_name]])</span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>  outer_folds <span class="ot">&lt;-</span> <span class="fu">createFolds</span>(data[[target_name]], <span class="at">k =</span> outer, <span class="at">list =</span> <span class="cn">TRUE</span>, <span class="at">returnTrain =</span> <span class="cn">FALSE</span>)</span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (outer_index <span class="cf">in</span> <span class="fu">seq_along</span>(outer_folds)) {</span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a>    outer_train_data <span class="ot">&lt;-</span> data[<span class="sc">-</span>outer_folds[[outer_index]], ]</span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a>    outer_test_data <span class="ot">&lt;-</span> data[outer_folds[[outer_index]], ]</span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb56-14"><a href="#cb56-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Outer Fold %d</span><span class="sc">\n</span><span class="st">"</span>, outer_index))</span>
<span id="cb56-15"><a href="#cb56-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Training Data - Class 0: "</span>, <span class="fu">sum</span>(outer_train_data[[target_name]] <span class="sc">==</span> <span class="st">"0"</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb56-16"><a href="#cb56-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Training Data - Class 1: "</span>, <span class="fu">sum</span>(outer_train_data[[target_name]] <span class="sc">==</span> <span class="st">"1"</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb56-17"><a href="#cb56-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Testing Data - Class 0: "</span>, <span class="fu">sum</span>(outer_test_data[[target_name]] <span class="sc">==</span> <span class="st">"0"</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb56-18"><a href="#cb56-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Testing Data - Class 1: "</span>, <span class="fu">sum</span>(outer_test_data[[target_name]] <span class="sc">==</span> <span class="st">"1"</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb56-19"><a href="#cb56-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb56-20"><a href="#cb56-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">sum</span>(outer_train_data[[target_name]] <span class="sc">==</span> <span class="st">"0"</span>) <span class="sc">==</span> <span class="dv">0</span> <span class="sc">||</span> <span class="fu">sum</span>(outer_train_data[[target_name]] <span class="sc">==</span> <span class="st">"1"</span>) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb56-21"><a href="#cb56-21" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cat</span>(<span class="st">"Skipping outer fold due to lack of class diversity</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb56-22"><a href="#cb56-22" aria-hidden="true" tabindex="-1"></a>      <span class="cf">next</span></span>
<span id="cb56-23"><a href="#cb56-23" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb56-24"><a href="#cb56-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb56-25"><a href="#cb56-25" aria-hidden="true" tabindex="-1"></a>    inner_folds <span class="ot">&lt;-</span> <span class="fu">createFolds</span>(outer_train_data[[target_name]], <span class="at">k =</span> inner, <span class="at">list =</span> <span class="cn">TRUE</span>, <span class="at">returnTrain =</span> <span class="cn">FALSE</span>)</span>
<span id="cb56-26"><a href="#cb56-26" aria-hidden="true" tabindex="-1"></a>    best_model <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb56-27"><a href="#cb56-27" aria-hidden="true" tabindex="-1"></a>    best_auc <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb56-28"><a href="#cb56-28" aria-hidden="true" tabindex="-1"></a>    best_k <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb56-29"><a href="#cb56-29" aria-hidden="true" tabindex="-1"></a>    best_l <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb56-30"><a href="#cb56-30" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb56-31"><a href="#cb56-31" aria-hidden="true" tabindex="-1"></a>    grid <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">k =</span> ks, <span class="at">l =</span> ls)</span>
<span id="cb56-32"><a href="#cb56-32" aria-hidden="true" tabindex="-1"></a>    formula <span class="ot">&lt;-</span> <span class="fu">reformulate</span>(variables, target_name)</span>
<span id="cb56-33"><a href="#cb56-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-34"><a href="#cb56-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (params <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(grid)) {</span>
<span id="cb56-35"><a href="#cb56-35" aria-hidden="true" tabindex="-1"></a>      inner_auc <span class="ot">&lt;-</span> <span class="fu">numeric</span>()</span>
<span id="cb56-36"><a href="#cb56-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-37"><a href="#cb56-37" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (inner_index <span class="cf">in</span> <span class="fu">seq_along</span>(inner_folds)) {</span>
<span id="cb56-38"><a href="#cb56-38" aria-hidden="true" tabindex="-1"></a>        inner_train_data <span class="ot">&lt;-</span> outer_train_data[<span class="sc">-</span>inner_folds[[inner_index]], ]</span>
<span id="cb56-39"><a href="#cb56-39" aria-hidden="true" tabindex="-1"></a>        inner_test_data <span class="ot">&lt;-</span> outer_train_data[inner_folds[[inner_index]], ]</span>
<span id="cb56-40"><a href="#cb56-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-41"><a href="#cb56-41" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="fu">sum</span>(inner_train_data[[target_name]] <span class="sc">==</span> <span class="st">"0"</span>) <span class="sc">==</span> <span class="dv">0</span> <span class="sc">||</span> <span class="fu">sum</span>(inner_train_data[[target_name]] <span class="sc">==</span> <span class="st">"1"</span>) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb56-42"><a href="#cb56-42" aria-hidden="true" tabindex="-1"></a>          <span class="fu">cat</span>(<span class="st">"Skipping inner fold due to lack of class diversity</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb56-43"><a href="#cb56-43" aria-hidden="true" tabindex="-1"></a>          <span class="cf">next</span></span>
<span id="cb56-44"><a href="#cb56-44" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb56-45"><a href="#cb56-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-46"><a href="#cb56-46" aria-hidden="true" tabindex="-1"></a>        train_x <span class="ot">&lt;-</span> inner_train_data[, variables, drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb56-47"><a href="#cb56-47" aria-hidden="true" tabindex="-1"></a>        test_x <span class="ot">&lt;-</span> inner_test_data[, variables, drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb56-48"><a href="#cb56-48" aria-hidden="true" tabindex="-1"></a>        train_y <span class="ot">&lt;-</span> inner_train_data[[target_name]]</span>
<span id="cb56-49"><a href="#cb56-49" aria-hidden="true" tabindex="-1"></a>        test_y <span class="ot">&lt;-</span> inner_test_data[[target_name]]</span>
<span id="cb56-50"><a href="#cb56-50" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb56-51"><a href="#cb56-51" aria-hidden="true" tabindex="-1"></a>        result <span class="ot">&lt;-</span> <span class="fu">tryCatch</span>({</span>
<span id="cb56-52"><a href="#cb56-52" aria-hidden="true" tabindex="-1"></a>          predictions <span class="ot">&lt;-</span> <span class="fu">knn</span>(<span class="at">train =</span> train_x, <span class="at">test =</span> test_x, <span class="at">cl =</span> train_y, <span class="at">k =</span> grid<span class="sc">$</span>k[params], <span class="at">prob =</span> <span class="cn">TRUE</span>)</span>
<span id="cb56-53"><a href="#cb56-53" aria-hidden="true" tabindex="-1"></a>          probabilities <span class="ot">&lt;-</span> <span class="fu">attr</span>(predictions, <span class="st">"prob"</span>)</span>
<span id="cb56-54"><a href="#cb56-54" aria-hidden="true" tabindex="-1"></a>          probabilities <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(predictions <span class="sc">==</span> <span class="st">"1"</span>, probabilities, <span class="dv">1</span> <span class="sc">-</span> probabilities)</span>
<span id="cb56-55"><a href="#cb56-55" aria-hidden="true" tabindex="-1"></a>          roc_curve <span class="ot">&lt;-</span> <span class="fu">roc</span>(<span class="fu">as.numeric</span>(<span class="fu">as.character</span>(test_y)), probabilities)</span>
<span id="cb56-56"><a href="#cb56-56" aria-hidden="true" tabindex="-1"></a>          inner_auc[inner_index] <span class="ot">&lt;-</span> roc_curve<span class="sc">$</span>auc</span>
<span id="cb56-57"><a href="#cb56-57" aria-hidden="true" tabindex="-1"></a>        }, <span class="at">error =</span> <span class="cf">function</span>(e) {</span>
<span id="cb56-58"><a href="#cb56-58" aria-hidden="true" tabindex="-1"></a>          <span class="fu">cat</span>(<span class="st">"Error with parameters: k ="</span>, grid<span class="sc">$</span>k[params], <span class="st">", l ="</span>, grid<span class="sc">$</span>l[params], <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb56-59"><a href="#cb56-59" aria-hidden="true" tabindex="-1"></a>          <span class="fu">cat</span>(<span class="st">"Error message: "</span>, e<span class="sc">$</span>message, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb56-60"><a href="#cb56-60" aria-hidden="true" tabindex="-1"></a>          inner_auc[inner_index] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb56-61"><a href="#cb56-61" aria-hidden="true" tabindex="-1"></a>        })</span>
<span id="cb56-62"><a href="#cb56-62" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb56-63"><a href="#cb56-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-64"><a href="#cb56-64" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="fu">mean</span>(inner_auc, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">&gt;</span> best_auc) {</span>
<span id="cb56-65"><a href="#cb56-65" aria-hidden="true" tabindex="-1"></a>        best_auc <span class="ot">&lt;-</span> <span class="fu">mean</span>(inner_auc, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb56-66"><a href="#cb56-66" aria-hidden="true" tabindex="-1"></a>        best_model <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">train_x =</span> train_x, <span class="at">train_y =</span> train_y, <span class="at">k =</span> grid<span class="sc">$</span>k[params], <span class="at">l =</span> grid<span class="sc">$</span>l[params])</span>
<span id="cb56-67"><a href="#cb56-67" aria-hidden="true" tabindex="-1"></a>        best_k <span class="ot">&lt;-</span> grid<span class="sc">$</span>k[params]</span>
<span id="cb56-68"><a href="#cb56-68" aria-hidden="true" tabindex="-1"></a>        best_l <span class="ot">&lt;-</span> grid<span class="sc">$</span>l[params]</span>
<span id="cb56-69"><a href="#cb56-69" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb56-70"><a href="#cb56-70" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb56-71"><a href="#cb56-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-72"><a href="#cb56-72" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">is.null</span>(best_model)) {</span>
<span id="cb56-73"><a href="#cb56-73" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cat</span>(<span class="st">"No valid model found for outer fold "</span>, outer_index, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb56-74"><a href="#cb56-74" aria-hidden="true" tabindex="-1"></a>      <span class="cf">next</span></span>
<span id="cb56-75"><a href="#cb56-75" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb56-76"><a href="#cb56-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-77"><a href="#cb56-77" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Reentrenar el mejor modelo con todos los datos de outer_train_data</span></span>
<span id="cb56-78"><a href="#cb56-78" aria-hidden="true" tabindex="-1"></a>    train_x <span class="ot">&lt;-</span> outer_train_data[, variables, drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb56-79"><a href="#cb56-79" aria-hidden="true" tabindex="-1"></a>    train_y <span class="ot">&lt;-</span> outer_train_data[[target_name]]</span>
<span id="cb56-80"><a href="#cb56-80" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb56-81"><a href="#cb56-81" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Evaluar el mejor modelo en el conjunto de prueba del outer fold</span></span>
<span id="cb56-82"><a href="#cb56-82" aria-hidden="true" tabindex="-1"></a>    test_x <span class="ot">&lt;-</span> outer_test_data[, variables, drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb56-83"><a href="#cb56-83" aria-hidden="true" tabindex="-1"></a>    test_y <span class="ot">&lt;-</span> outer_test_data[[target_name]]</span>
<span id="cb56-84"><a href="#cb56-84" aria-hidden="true" tabindex="-1"></a>    predictions <span class="ot">&lt;-</span> <span class="fu">knn</span>(<span class="at">train =</span> train_x, <span class="at">test =</span> test_x, <span class="at">cl =</span> train_y, <span class="at">k =</span> best_k, <span class="at">prob =</span> <span class="cn">TRUE</span>)</span>
<span id="cb56-85"><a href="#cb56-85" aria-hidden="true" tabindex="-1"></a>    probabilities <span class="ot">&lt;-</span> <span class="fu">attr</span>(predictions, <span class="st">"prob"</span>)</span>
<span id="cb56-86"><a href="#cb56-86" aria-hidden="true" tabindex="-1"></a>    probabilities <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(predictions <span class="sc">==</span> <span class="st">"1"</span>, probabilities, <span class="dv">1</span> <span class="sc">-</span> probabilities)</span>
<span id="cb56-87"><a href="#cb56-87" aria-hidden="true" tabindex="-1"></a>    pred_class <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(probabilities <span class="sc">&gt;</span> threshold, <span class="st">"1"</span>, <span class="st">"0"</span>)</span>
<span id="cb56-88"><a href="#cb56-88" aria-hidden="true" tabindex="-1"></a>    confusion <span class="ot">&lt;-</span> <span class="fu">table</span>(<span class="at">Actual =</span> test_y, <span class="at">Predicted =</span> pred_class)</span>
<span id="cb56-89"><a href="#cb56-89" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb56-90"><a href="#cb56-90" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">nrow</span>(confusion) <span class="sc">&lt;</span> <span class="dv">2</span> <span class="sc">||</span> <span class="fu">ncol</span>(confusion) <span class="sc">&lt;</span> <span class="dv">2</span>) {</span>
<span id="cb56-91"><a href="#cb56-91" aria-hidden="true" tabindex="-1"></a>      TP <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span>, confusion[<span class="dv">2</span>, <span class="dv">2</span>], <span class="dv">0</span>)</span>
<span id="cb56-92"><a href="#cb56-92" aria-hidden="true" tabindex="-1"></a>      TN <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span>, confusion[<span class="dv">1</span>, <span class="dv">1</span>], <span class="dv">0</span>)</span>
<span id="cb56-93"><a href="#cb56-93" aria-hidden="true" tabindex="-1"></a>      FP <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span>, confusion[<span class="dv">1</span>, <span class="dv">2</span>], <span class="dv">0</span>)</span>
<span id="cb56-94"><a href="#cb56-94" aria-hidden="true" tabindex="-1"></a>      FN <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span>, confusion[<span class="dv">2</span>, <span class="dv">1</span>], <span class="dv">0</span>)</span>
<span id="cb56-95"><a href="#cb56-95" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb56-96"><a href="#cb56-96" aria-hidden="true" tabindex="-1"></a>      TP <span class="ot">&lt;-</span> confusion[<span class="dv">2</span>, <span class="dv">2</span>]</span>
<span id="cb56-97"><a href="#cb56-97" aria-hidden="true" tabindex="-1"></a>      TN <span class="ot">&lt;-</span> confusion[<span class="dv">1</span>, <span class="dv">1</span>]</span>
<span id="cb56-98"><a href="#cb56-98" aria-hidden="true" tabindex="-1"></a>      FP <span class="ot">&lt;-</span> confusion[<span class="dv">1</span>, <span class="dv">2</span>]</span>
<span id="cb56-99"><a href="#cb56-99" aria-hidden="true" tabindex="-1"></a>      FN <span class="ot">&lt;-</span> confusion[<span class="dv">2</span>, <span class="dv">1</span>]</span>
<span id="cb56-100"><a href="#cb56-100" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb56-101"><a href="#cb56-101" aria-hidden="true" tabindex="-1"></a>    auc <span class="ot">&lt;-</span> <span class="fu">roc</span>(test_y, probabilities)<span class="sc">$</span>auc</span>
<span id="cb56-102"><a href="#cb56-102" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb56-103"><a href="#cb56-103" aria-hidden="true" tabindex="-1"></a>    metrics <span class="ot">&lt;-</span> <span class="fu">setNames</span>(<span class="fu">c</span>(outer_index, TP, TN, FP, FN, auc, best_k, best_l), <span class="fu">names</span>(performance_metrics))</span>
<span id="cb56-104"><a href="#cb56-104" aria-hidden="true" tabindex="-1"></a>    performance_metrics <span class="ot">&lt;-</span> <span class="fu">rbind</span>(performance_metrics, <span class="fu">as.data.frame</span>(<span class="fu">t</span>(metrics)))</span>
<span id="cb56-105"><a href="#cb56-105" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb56-106"><a href="#cb56-106" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Performance:"</span>, <span class="fu">paste</span>(performance_metrics))</span>
<span id="cb56-107"><a href="#cb56-107" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Confusion Matrix for Fold %d:</span><span class="sc">\n</span><span class="st">"</span>, outer_index))</span>
<span id="cb56-108"><a href="#cb56-108" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(confusion)</span>
<span id="cb56-109"><a href="#cb56-109" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Metrics for Fold %d:</span><span class="sc">\n</span><span class="st">"</span>, outer_index))</span>
<span id="cb56-110"><a href="#cb56-110" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"TP: %d, TN: %d, FP: %d, FN: %d, AUC: %f, Best k: %d, Best l: %f</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb56-111"><a href="#cb56-111" aria-hidden="true" tabindex="-1"></a>                TP, TN, FP, FN, auc, best_k, best_l))</span>
<span id="cb56-112"><a href="#cb56-112" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb56-113"><a href="#cb56-113" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb56-114"><a href="#cb56-114" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(performance_metrics)</span>
<span id="cb56-115"><a href="#cb56-115" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb56-116"><a href="#cb56-116" aria-hidden="true" tabindex="-1"></a>evaluate_with_seeds_KNN_TodasVariables_Asociacion <span class="ot">&lt;-</span> </span>
<span id="cb56-117"><a href="#cb56-117" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(evaluation_function, data, target_var, vars, threshold, seeds, outer, inner, ks, ls) {</span>
<span id="cb56-118"><a href="#cb56-118" aria-hidden="true" tabindex="-1"></a>  results_list <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb56-119"><a href="#cb56-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-120"><a href="#cb56-120" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (seed <span class="cf">in</span> seeds) {</span>
<span id="cb56-121"><a href="#cb56-121" aria-hidden="true" tabindex="-1"></a>    <span class="fu">set.seed</span>(seed)</span>
<span id="cb56-122"><a href="#cb56-122" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Evaluating with seed:"</span>, seed, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb56-123"><a href="#cb56-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-124"><a href="#cb56-124" aria-hidden="true" tabindex="-1"></a>    results <span class="ot">&lt;-</span> <span class="fu">evaluation_function</span>(<span class="at">data =</span> data, </span>
<span id="cb56-125"><a href="#cb56-125" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">target_name =</span> target_var, </span>
<span id="cb56-126"><a href="#cb56-126" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">variables =</span> vars, </span>
<span id="cb56-127"><a href="#cb56-127" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">threshold =</span> threshold, </span>
<span id="cb56-128"><a href="#cb56-128" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">outer =</span> outer, </span>
<span id="cb56-129"><a href="#cb56-129" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">inner =</span> inner, </span>
<span id="cb56-130"><a href="#cb56-130" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">seed =</span> seed,</span>
<span id="cb56-131"><a href="#cb56-131" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">ks =</span> ks,</span>
<span id="cb56-132"><a href="#cb56-132" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">ls =</span> ls)</span>
<span id="cb56-133"><a href="#cb56-133" aria-hidden="true" tabindex="-1"></a>    results_list[[<span class="fu">paste0</span>(<span class="st">"seed_"</span>, seed)]] <span class="ot">&lt;-</span> results</span>
<span id="cb56-134"><a href="#cb56-134" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb56-135"><a href="#cb56-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-136"><a href="#cb56-136" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(results_list)</span>
<span id="cb56-137"><a href="#cb56-137" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb56-138"><a href="#cb56-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-139"><a href="#cb56-139" aria-hidden="true" tabindex="-1"></a>performance_knn_todasvariables <span class="ot">&lt;-</span> <span class="fu">evaluate_with_seeds_KNN_TodasVariables_Asociacion</span>(</span>
<span id="cb56-140"><a href="#cb56-140" aria-hidden="true" tabindex="-1"></a>  <span class="at">evaluation_function =</span> double_cross_validation_knn,</span>
<span id="cb56-141"><a href="#cb56-141" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_numeric,</span>
<span id="cb56-142"><a href="#cb56-142" aria-hidden="true" tabindex="-1"></a>  <span class="at">outer =</span> <span class="dv">5</span>,</span>
<span id="cb56-143"><a href="#cb56-143" aria-hidden="true" tabindex="-1"></a>  <span class="at">inner =</span> <span class="dv">2</span>,</span>
<span id="cb56-144"><a href="#cb56-144" aria-hidden="true" tabindex="-1"></a>  <span class="at">target_var =</span> <span class="st">"PCR"</span>,</span>
<span id="cb56-145"><a href="#cb56-145" aria-hidden="true" tabindex="-1"></a>  <span class="at">ks =</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">16</span>, <span class="dv">20</span>, <span class="dv">25</span>, <span class="dv">30</span>, <span class="dv">32</span>),</span>
<span id="cb56-146"><a href="#cb56-146" aria-hidden="true" tabindex="-1"></a>  <span class="at">ls =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>),</span>
<span id="cb56-147"><a href="#cb56-147" aria-hidden="true" tabindex="-1"></a>  <span class="at">vars =</span> todas_variables_numeric,</span>
<span id="cb56-148"><a href="#cb56-148" aria-hidden="true" tabindex="-1"></a>  <span class="at">threshold =</span> .<span class="dv">35</span>,</span>
<span id="cb56-149"><a href="#cb56-149" aria-hidden="true" tabindex="-1"></a>  <span class="at">seeds =</span> seeds</span>
<span id="cb56-150"><a href="#cb56-150" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"RData_Files_Algorithms/KNN_TodasVariables.RData"</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="filtrado-asociación-4" class="level3" data-number="3.5.3">
<h3 data-number="3.5.3" class="anchored" data-anchor-id="filtrado-asociación-4"><span class="header-section-number">3.5.3</span> Filtrado (Asociación)</h3>
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>performance_knn_Asociacion <span class="ot">&lt;-</span> <span class="fu">evaluate_with_seeds_KNN_TodasVariables_Asociacion</span>(</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">evaluation_function =</span> double_cross_validation_knn,</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_numeric,</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">outer =</span> <span class="dv">5</span>,</span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">inner =</span> <span class="dv">2</span>,</span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">target_var =</span> <span class="st">"PCR"</span>,</span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">ks =</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">16</span>, <span class="dv">20</span>, <span class="dv">25</span>, <span class="dv">30</span>, <span class="dv">32</span>),</span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">ls =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>),</span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">vars =</span> asociacion_numeric,</span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">threshold =</span> .<span class="dv">35</span>,</span>
<span id="cb58-11"><a href="#cb58-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">seeds =</span> seeds</span>
<span id="cb58-12"><a href="#cb58-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"RData_Files_Algorithms/KNN_Asociacion.RData"</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="wrapped-stepauc-4" class="level3" data-number="3.5.4">
<h3 data-number="3.5.4" class="anchored" data-anchor-id="wrapped-stepauc-4"><span class="header-section-number">3.5.4</span> Wrapped (StepAUC)</h3>
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>double_cross_validation_knn_stepAUC <span class="ot">&lt;-</span> <span class="cf">function</span>(data, target_name, outer, inner, ks, ls, variables, threshold, seed) {</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(seed)</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>  performance_metrics <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Fold =</span> <span class="fu">integer</span>(), <span class="at">TP =</span> <span class="fu">integer</span>(), <span class="at">TN =</span> <span class="fu">integer</span>(),</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">FP =</span> <span class="fu">integer</span>(), <span class="at">FN =</span> <span class="fu">integer</span>(), <span class="at">AUC =</span> <span class="fu">numeric</span>(),</span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">Best_k =</span> <span class="fu">integer</span>(), <span class="at">Best_l =</span> <span class="fu">numeric</span>(), <span class="at">Best_Variables =</span> <span class="fu">character</span>(), <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>  inner_fold_metrics <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Fold =</span> <span class="fu">integer</span>(), <span class="at">Inner_Fold =</span> <span class="fu">integer</span>(), </span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">TP =</span> <span class="fu">integer</span>(), <span class="at">TN =</span> <span class="fu">integer</span>(), <span class="at">FP =</span> <span class="fu">integer</span>(), </span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">FN =</span> <span class="fu">integer</span>(), <span class="at">AUC =</span> <span class="fu">numeric</span>(), <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a>  data[[target_name]] <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(data[[target_name]])</span>
<span id="cb60-12"><a href="#cb60-12" aria-hidden="true" tabindex="-1"></a>  outer_folds <span class="ot">&lt;-</span> <span class="fu">createFolds</span>(data[[target_name]], <span class="at">k =</span> outer, <span class="at">list =</span> <span class="cn">TRUE</span>, <span class="at">returnTrain =</span> <span class="cn">FALSE</span>)</span>
<span id="cb60-13"><a href="#cb60-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb60-14"><a href="#cb60-14" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (outer_index <span class="cf">in</span> <span class="fu">seq_along</span>(outer_folds)) {</span>
<span id="cb60-15"><a href="#cb60-15" aria-hidden="true" tabindex="-1"></a>    outer_train_data <span class="ot">&lt;-</span> data[<span class="sc">-</span>outer_folds[[outer_index]], ]</span>
<span id="cb60-16"><a href="#cb60-16" aria-hidden="true" tabindex="-1"></a>    outer_test_data <span class="ot">&lt;-</span> data[outer_folds[[outer_index]], ]</span>
<span id="cb60-17"><a href="#cb60-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb60-18"><a href="#cb60-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Outer Fold %d</span><span class="sc">\n</span><span class="st">"</span>, outer_index))</span>
<span id="cb60-19"><a href="#cb60-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Training Data - Class 0: "</span>, <span class="fu">sum</span>(outer_train_data[[target_name]] <span class="sc">==</span> <span class="st">"0"</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb60-20"><a href="#cb60-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Training Data - Class 1: "</span>, <span class="fu">sum</span>(outer_train_data[[target_name]] <span class="sc">==</span> <span class="st">"1"</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb60-21"><a href="#cb60-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Testing Data - Class 0: "</span>, <span class="fu">sum</span>(outer_test_data[[target_name]] <span class="sc">==</span> <span class="st">"0"</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb60-22"><a href="#cb60-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Testing Data - Class 1: "</span>, <span class="fu">sum</span>(outer_test_data[[target_name]] <span class="sc">==</span> <span class="st">"1"</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb60-23"><a href="#cb60-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb60-24"><a href="#cb60-24" aria-hidden="true" tabindex="-1"></a>    inner_folds <span class="ot">&lt;-</span> <span class="fu">createFolds</span>(outer_train_data[[target_name]], <span class="at">k =</span> inner, <span class="at">list =</span> <span class="cn">TRUE</span>, <span class="at">returnTrain =</span> <span class="cn">FALSE</span>)</span>
<span id="cb60-25"><a href="#cb60-25" aria-hidden="true" tabindex="-1"></a>    best_model <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb60-26"><a href="#cb60-26" aria-hidden="true" tabindex="-1"></a>    best_auc <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb60-27"><a href="#cb60-27" aria-hidden="true" tabindex="-1"></a>    best_k <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb60-28"><a href="#cb60-28" aria-hidden="true" tabindex="-1"></a>    best_l <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb60-29"><a href="#cb60-29" aria-hidden="true" tabindex="-1"></a>    best_vars <span class="ot">&lt;-</span> variables</span>
<span id="cb60-30"><a href="#cb60-30" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb60-31"><a href="#cb60-31" aria-hidden="true" tabindex="-1"></a>    grid <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">k =</span> ks, <span class="at">l =</span> ls)</span>
<span id="cb60-32"><a href="#cb60-32" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb60-33"><a href="#cb60-33" aria-hidden="true" tabindex="-1"></a>    stepAUC <span class="ot">&lt;-</span> <span class="cf">function</span>(vars, outer_train_data, target_name, grid, inner_folds) {</span>
<span id="cb60-34"><a href="#cb60-34" aria-hidden="true" tabindex="-1"></a>      current_vars <span class="ot">&lt;-</span> vars</span>
<span id="cb60-35"><a href="#cb60-35" aria-hidden="true" tabindex="-1"></a>      best_inner_auc <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb60-36"><a href="#cb60-36" aria-hidden="true" tabindex="-1"></a>      best_inner_model <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb60-37"><a href="#cb60-37" aria-hidden="true" tabindex="-1"></a>      best_inner_k <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb60-38"><a href="#cb60-38" aria-hidden="true" tabindex="-1"></a>      best_inner_l <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb60-39"><a href="#cb60-39" aria-hidden="true" tabindex="-1"></a>      best_inner_vars <span class="ot">&lt;-</span> current_vars</span>
<span id="cb60-40"><a href="#cb60-40" aria-hidden="true" tabindex="-1"></a>      improved <span class="ot">&lt;-</span> <span class="cn">TRUE</span></span>
<span id="cb60-41"><a href="#cb60-41" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb60-42"><a href="#cb60-42" aria-hidden="true" tabindex="-1"></a>      <span class="cf">while</span> (improved <span class="sc">&amp;&amp;</span> <span class="fu">length</span>(current_vars) <span class="sc">&gt;</span> <span class="dv">1</span>) {</span>
<span id="cb60-43"><a href="#cb60-43" aria-hidden="true" tabindex="-1"></a>        improved <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb60-44"><a href="#cb60-44" aria-hidden="true" tabindex="-1"></a>        best_auc_in_step <span class="ot">&lt;-</span> best_inner_auc</span>
<span id="cb60-45"><a href="#cb60-45" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb60-46"><a href="#cb60-46" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (var <span class="cf">in</span> current_vars) {</span>
<span id="cb60-47"><a href="#cb60-47" aria-hidden="true" tabindex="-1"></a>          temp_vars <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(current_vars, var)</span>
<span id="cb60-48"><a href="#cb60-48" aria-hidden="true" tabindex="-1"></a>          inner_auc <span class="ot">&lt;-</span> <span class="fu">numeric</span>()</span>
<span id="cb60-49"><a href="#cb60-49" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb60-50"><a href="#cb60-50" aria-hidden="true" tabindex="-1"></a>          <span class="cf">for</span> (params <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(grid)) {</span>
<span id="cb60-51"><a href="#cb60-51" aria-hidden="true" tabindex="-1"></a>            auc_vals <span class="ot">&lt;-</span> <span class="fu">numeric</span>()</span>
<span id="cb60-52"><a href="#cb60-52" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb60-53"><a href="#cb60-53" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> (inner_index <span class="cf">in</span> <span class="fu">seq_along</span>(inner_folds)) {</span>
<span id="cb60-54"><a href="#cb60-54" aria-hidden="true" tabindex="-1"></a>              inner_train_data <span class="ot">&lt;-</span> outer_train_data[<span class="sc">-</span>inner_folds[[inner_index]], ]</span>
<span id="cb60-55"><a href="#cb60-55" aria-hidden="true" tabindex="-1"></a>              inner_test_data <span class="ot">&lt;-</span> outer_train_data[inner_folds[[inner_index]], ]</span>
<span id="cb60-56"><a href="#cb60-56" aria-hidden="true" tabindex="-1"></a>              </span>
<span id="cb60-57"><a href="#cb60-57" aria-hidden="true" tabindex="-1"></a>              train_x <span class="ot">&lt;-</span> inner_train_data[, temp_vars, drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb60-58"><a href="#cb60-58" aria-hidden="true" tabindex="-1"></a>              test_x <span class="ot">&lt;-</span> inner_test_data[, temp_vars, drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb60-59"><a href="#cb60-59" aria-hidden="true" tabindex="-1"></a>              train_y <span class="ot">&lt;-</span> inner_train_data[[target_name]]</span>
<span id="cb60-60"><a href="#cb60-60" aria-hidden="true" tabindex="-1"></a>              test_y <span class="ot">&lt;-</span> inner_test_data[[target_name]]</span>
<span id="cb60-61"><a href="#cb60-61" aria-hidden="true" tabindex="-1"></a>              </span>
<span id="cb60-62"><a href="#cb60-62" aria-hidden="true" tabindex="-1"></a>              result <span class="ot">&lt;-</span> <span class="fu">tryCatch</span>({</span>
<span id="cb60-63"><a href="#cb60-63" aria-hidden="true" tabindex="-1"></a>                predictions <span class="ot">&lt;-</span> <span class="fu">knn</span>(<span class="at">train =</span> train_x, <span class="at">test =</span> test_x, <span class="at">cl =</span> train_y, <span class="at">k =</span> grid<span class="sc">$</span>k[params], <span class="at">l =</span> grid<span class="sc">$</span>l[params], <span class="at">prob =</span> <span class="cn">TRUE</span>)</span>
<span id="cb60-64"><a href="#cb60-64" aria-hidden="true" tabindex="-1"></a>                probabilities <span class="ot">&lt;-</span> <span class="fu">attr</span>(predictions, <span class="st">"prob"</span>)</span>
<span id="cb60-65"><a href="#cb60-65" aria-hidden="true" tabindex="-1"></a>                roc_curve <span class="ot">&lt;-</span> <span class="fu">roc</span>(<span class="fu">as.numeric</span>(<span class="fu">as.character</span>(test_y)), probabilities)</span>
<span id="cb60-66"><a href="#cb60-66" aria-hidden="true" tabindex="-1"></a>                auc_vals[inner_index] <span class="ot">&lt;-</span> roc_curve<span class="sc">$</span>auc</span>
<span id="cb60-67"><a href="#cb60-67" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb60-68"><a href="#cb60-68" aria-hidden="true" tabindex="-1"></a>              }, <span class="at">error =</span> <span class="cf">function</span>(e) {</span>
<span id="cb60-69"><a href="#cb60-69" aria-hidden="true" tabindex="-1"></a>                <span class="fu">cat</span>(<span class="st">"Error with variables:"</span>, <span class="fu">paste</span>(temp_vars, <span class="at">collapse =</span> <span class="st">", "</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb60-70"><a href="#cb60-70" aria-hidden="true" tabindex="-1"></a>                <span class="fu">cat</span>(<span class="st">"Error message: "</span>, e<span class="sc">$</span>message, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb60-71"><a href="#cb60-71" aria-hidden="true" tabindex="-1"></a>                auc_vals[inner_index] <span class="ot">&lt;-</span> <span class="dv">0</span>  <span class="co"># Set to NA or some other indicator of failure</span></span>
<span id="cb60-72"><a href="#cb60-72" aria-hidden="true" tabindex="-1"></a>              })</span>
<span id="cb60-73"><a href="#cb60-73" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb60-74"><a href="#cb60-74" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb60-75"><a href="#cb60-75" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> (<span class="fu">mean</span>(auc_vals, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">&gt;</span> best_auc_in_step) {</span>
<span id="cb60-76"><a href="#cb60-76" aria-hidden="true" tabindex="-1"></a>              best_auc_in_step <span class="ot">&lt;-</span> <span class="fu">mean</span>(auc_vals, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb60-77"><a href="#cb60-77" aria-hidden="true" tabindex="-1"></a>              best_inner_model <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">train_x =</span> train_x, <span class="at">train_y =</span> train_y, <span class="at">k =</span> grid<span class="sc">$</span>k[params], <span class="at">l =</span> grid<span class="sc">$</span>l[params])</span>
<span id="cb60-78"><a href="#cb60-78" aria-hidden="true" tabindex="-1"></a>              best_inner_k <span class="ot">&lt;-</span> grid<span class="sc">$</span>k[params]</span>
<span id="cb60-79"><a href="#cb60-79" aria-hidden="true" tabindex="-1"></a>              best_inner_l <span class="ot">&lt;-</span> grid<span class="sc">$</span>l[params]</span>
<span id="cb60-80"><a href="#cb60-80" aria-hidden="true" tabindex="-1"></a>              best_inner_vars <span class="ot">&lt;-</span> temp_vars</span>
<span id="cb60-81"><a href="#cb60-81" aria-hidden="true" tabindex="-1"></a>              improved <span class="ot">&lt;-</span> <span class="cn">TRUE</span></span>
<span id="cb60-82"><a href="#cb60-82" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb60-83"><a href="#cb60-83" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb60-84"><a href="#cb60-84" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb60-85"><a href="#cb60-85" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb60-86"><a href="#cb60-86" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (improved) {</span>
<span id="cb60-87"><a href="#cb60-87" aria-hidden="true" tabindex="-1"></a>          current_vars <span class="ot">&lt;-</span> best_inner_vars</span>
<span id="cb60-88"><a href="#cb60-88" aria-hidden="true" tabindex="-1"></a>          best_inner_auc <span class="ot">&lt;-</span> best_auc_in_step</span>
<span id="cb60-89"><a href="#cb60-89" aria-hidden="true" tabindex="-1"></a>          <span class="fu">cat</span>(<span class="st">"Vars improved: "</span>, <span class="fu">paste</span>(current_vars, <span class="at">collapse=</span><span class="st">", "</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb60-90"><a href="#cb60-90" aria-hidden="true" tabindex="-1"></a>          <span class="fu">cat</span>(<span class="st">"AUC: "</span>, <span class="fu">paste</span>(best_inner_auc), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb60-91"><a href="#cb60-91" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb60-92"><a href="#cb60-92" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb60-93"><a href="#cb60-93" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb60-94"><a href="#cb60-94" aria-hidden="true" tabindex="-1"></a>      <span class="fu">list</span>(<span class="at">model =</span> best_inner_model, <span class="at">auc =</span> best_inner_auc, </span>
<span id="cb60-95"><a href="#cb60-95" aria-hidden="true" tabindex="-1"></a>           <span class="at">k =</span> best_inner_k, <span class="at">l =</span> best_inner_l, </span>
<span id="cb60-96"><a href="#cb60-96" aria-hidden="true" tabindex="-1"></a>           <span class="at">vars =</span> best_inner_vars)</span>
<span id="cb60-97"><a href="#cb60-97" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb60-98"><a href="#cb60-98" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb60-99"><a href="#cb60-99" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb60-100"><a href="#cb60-100" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Después de seleccionar el mejor modelo y parámetros en los inner folds</span></span>
<span id="cb60-101"><a href="#cb60-101" aria-hidden="true" tabindex="-1"></a>    best_result <span class="ot">&lt;-</span> <span class="fu">stepAUC</span>(variables, outer_train_data, target_name, grid, inner_folds)</span>
<span id="cb60-102"><a href="#cb60-102" aria-hidden="true" tabindex="-1"></a>    best_model <span class="ot">&lt;-</span> best_result<span class="sc">$</span>model</span>
<span id="cb60-103"><a href="#cb60-103" aria-hidden="true" tabindex="-1"></a>    best_auc <span class="ot">&lt;-</span> best_result<span class="sc">$</span>auc</span>
<span id="cb60-104"><a href="#cb60-104" aria-hidden="true" tabindex="-1"></a>    best_k <span class="ot">&lt;-</span> best_result<span class="sc">$</span>k</span>
<span id="cb60-105"><a href="#cb60-105" aria-hidden="true" tabindex="-1"></a>    best_l <span class="ot">&lt;-</span> best_result<span class="sc">$</span>l</span>
<span id="cb60-106"><a href="#cb60-106" aria-hidden="true" tabindex="-1"></a>    best_vars <span class="ot">&lt;-</span> best_result<span class="sc">$</span>vars</span>
<span id="cb60-107"><a href="#cb60-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-108"><a href="#cb60-108" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Evaluar el mejor modelo en el validation split del inner loop</span></span>
<span id="cb60-109"><a href="#cb60-109" aria-hidden="true" tabindex="-1"></a>    inner_auc_vals <span class="ot">&lt;-</span> <span class="fu">numeric</span>()</span>
<span id="cb60-110"><a href="#cb60-110" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (inner_index <span class="cf">in</span> <span class="fu">seq_along</span>(inner_folds)) {</span>
<span id="cb60-111"><a href="#cb60-111" aria-hidden="true" tabindex="-1"></a>      inner_train_data <span class="ot">&lt;-</span> outer_train_data[<span class="sc">-</span>inner_folds[[inner_index]], ]</span>
<span id="cb60-112"><a href="#cb60-112" aria-hidden="true" tabindex="-1"></a>      inner_test_data <span class="ot">&lt;-</span> outer_train_data[inner_folds[[inner_index]], ]</span>
<span id="cb60-113"><a href="#cb60-113" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb60-114"><a href="#cb60-114" aria-hidden="true" tabindex="-1"></a>      train_x <span class="ot">&lt;-</span> best_model<span class="sc">$</span>train_x</span>
<span id="cb60-115"><a href="#cb60-115" aria-hidden="true" tabindex="-1"></a>      test_x <span class="ot">&lt;-</span> inner_test_data[, best_vars, drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb60-116"><a href="#cb60-116" aria-hidden="true" tabindex="-1"></a>      train_y <span class="ot">&lt;-</span> best_model<span class="sc">$</span>train_y</span>
<span id="cb60-117"><a href="#cb60-117" aria-hidden="true" tabindex="-1"></a>      test_y <span class="ot">&lt;-</span> inner_test_data[[target_name]]</span>
<span id="cb60-118"><a href="#cb60-118" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb60-119"><a href="#cb60-119" aria-hidden="true" tabindex="-1"></a>      predictions <span class="ot">&lt;-</span> <span class="fu">knn</span>(<span class="at">train =</span> train_x, <span class="at">test =</span> test_x, <span class="at">cl =</span> train_y, <span class="at">k =</span> best_k, <span class="at">l =</span> best_l, <span class="at">prob =</span> <span class="cn">TRUE</span>)</span>
<span id="cb60-120"><a href="#cb60-120" aria-hidden="true" tabindex="-1"></a>      probabilities <span class="ot">&lt;-</span> <span class="fu">attr</span>(predictions, <span class="st">"prob"</span>)</span>
<span id="cb60-121"><a href="#cb60-121" aria-hidden="true" tabindex="-1"></a>      roc_curve <span class="ot">&lt;-</span> <span class="fu">roc</span>(<span class="fu">as.numeric</span>(<span class="fu">as.character</span>(test_y)), probabilities)</span>
<span id="cb60-122"><a href="#cb60-122" aria-hidden="true" tabindex="-1"></a>      inner_auc_vals[inner_index] <span class="ot">&lt;-</span> roc_curve<span class="sc">$</span>auc</span>
<span id="cb60-123"><a href="#cb60-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-124"><a href="#cb60-124" aria-hidden="true" tabindex="-1"></a>      pred_class <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(probabilities <span class="sc">&gt;</span> threshold, <span class="st">"1"</span>, <span class="st">"0"</span>)</span>
<span id="cb60-125"><a href="#cb60-125" aria-hidden="true" tabindex="-1"></a>      confusion <span class="ot">&lt;-</span> <span class="fu">table</span>(<span class="at">Actual =</span> test_y, <span class="at">Predicted =</span> pred_class)</span>
<span id="cb60-126"><a href="#cb60-126" aria-hidden="true" tabindex="-1"></a>      TP <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span>, confusion[<span class="dv">2</span>, <span class="dv">2</span>], <span class="dv">0</span>)</span>
<span id="cb60-127"><a href="#cb60-127" aria-hidden="true" tabindex="-1"></a>      TN <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span>, confusion[<span class="dv">1</span>, <span class="dv">1</span>], <span class="dv">0</span>)</span>
<span id="cb60-128"><a href="#cb60-128" aria-hidden="true" tabindex="-1"></a>      FP <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span>, confusion[<span class="dv">1</span>, <span class="dv">2</span>], <span class="dv">0</span>)</span>
<span id="cb60-129"><a href="#cb60-129" aria-hidden="true" tabindex="-1"></a>      FN <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span>, confusion[<span class="dv">2</span>, <span class="dv">1</span>], <span class="dv">0</span>)</span>
<span id="cb60-130"><a href="#cb60-130" aria-hidden="true" tabindex="-1"></a>      auc <span class="ot">&lt;-</span> roc_curve<span class="sc">$</span>auc</span>
<span id="cb60-131"><a href="#cb60-131" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb60-132"><a href="#cb60-132" aria-hidden="true" tabindex="-1"></a>      inner_metrics <span class="ot">&lt;-</span> <span class="fu">setNames</span>(<span class="fu">c</span>(outer_index, inner_index, TP, TN, FP, FN, auc), <span class="fu">names</span>(inner_fold_metrics))</span>
<span id="cb60-133"><a href="#cb60-133" aria-hidden="true" tabindex="-1"></a>      inner_fold_metrics <span class="ot">&lt;-</span> <span class="fu">rbind</span>(inner_fold_metrics, <span class="fu">as.data.frame</span>(<span class="fu">t</span>(inner_metrics)))</span>
<span id="cb60-134"><a href="#cb60-134" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb60-135"><a href="#cb60-135" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb60-136"><a href="#cb60-136" aria-hidden="true" tabindex="-1"></a>    best_inner_auc <span class="ot">&lt;-</span> <span class="fu">mean</span>(inner_auc_vals, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb60-137"><a href="#cb60-137" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb60-138"><a href="#cb60-138" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Reentrenar el mejor modelo con todos los datos de outer_train_data</span></span>
<span id="cb60-139"><a href="#cb60-139" aria-hidden="true" tabindex="-1"></a>    train_x <span class="ot">&lt;-</span> outer_train_data[, best_vars, drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb60-140"><a href="#cb60-140" aria-hidden="true" tabindex="-1"></a>    train_y <span class="ot">&lt;-</span> outer_train_data[[target_name]]</span>
<span id="cb60-141"><a href="#cb60-141" aria-hidden="true" tabindex="-1"></a>    best_model <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">train_x =</span> train_x, <span class="at">train_y =</span> train_y, <span class="at">k =</span> best_k, <span class="at">l =</span> best_l)</span>
<span id="cb60-142"><a href="#cb60-142" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb60-143"><a href="#cb60-143" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Evaluar el mejor modelo en el conjunto de prueba del outer fold</span></span>
<span id="cb60-144"><a href="#cb60-144" aria-hidden="true" tabindex="-1"></a>    test_x <span class="ot">&lt;-</span> outer_test_data[, best_vars, drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb60-145"><a href="#cb60-145" aria-hidden="true" tabindex="-1"></a>    test_y <span class="ot">&lt;-</span> outer_test_data[[target_name]]</span>
<span id="cb60-146"><a href="#cb60-146" aria-hidden="true" tabindex="-1"></a>    predictions <span class="ot">&lt;-</span> <span class="fu">knn</span>(<span class="at">train =</span> best_model<span class="sc">$</span>train_x, <span class="at">test =</span> test_x, <span class="at">cl =</span> best_model<span class="sc">$</span>train_y, <span class="at">k =</span> best_k, <span class="at">l =</span> best_l, <span class="at">prob =</span> <span class="cn">TRUE</span>)</span>
<span id="cb60-147"><a href="#cb60-147" aria-hidden="true" tabindex="-1"></a>    probabilities <span class="ot">&lt;-</span> <span class="fu">attr</span>(predictions, <span class="st">"prob"</span>)</span>
<span id="cb60-148"><a href="#cb60-148" aria-hidden="true" tabindex="-1"></a>    pred_class <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(probabilities <span class="sc">&gt;</span> threshold, <span class="st">"1"</span>, <span class="st">"0"</span>)</span>
<span id="cb60-149"><a href="#cb60-149" aria-hidden="true" tabindex="-1"></a>    confusion <span class="ot">&lt;-</span> <span class="fu">table</span>(<span class="at">Actual =</span> test_y, <span class="at">Predicted =</span> pred_class)</span>
<span id="cb60-150"><a href="#cb60-150" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb60-151"><a href="#cb60-151" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">nrow</span>(confusion) <span class="sc">&lt;</span> <span class="dv">2</span> <span class="sc">||</span> <span class="fu">ncol</span>(confusion) <span class="sc">&lt;</span> <span class="dv">2</span>) {</span>
<span id="cb60-152"><a href="#cb60-152" aria-hidden="true" tabindex="-1"></a>      TP <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span>, confusion[<span class="dv">2</span>, <span class="dv">2</span>], <span class="dv">0</span>)</span>
<span id="cb60-153"><a href="#cb60-153" aria-hidden="true" tabindex="-1"></a>      TN <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span>, confusion[<span class="dv">1</span>, <span class="dv">1</span>], <span class="dv">0</span>)</span>
<span id="cb60-154"><a href="#cb60-154" aria-hidden="true" tabindex="-1"></a>      FP <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span>, confusion[<span class="dv">1</span>, <span class="dv">2</span>], <span class="dv">0</span>)</span>
<span id="cb60-155"><a href="#cb60-155" aria-hidden="true" tabindex="-1"></a>      FN <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span>, confusion[<span class="dv">2</span>, <span class="dv">1</span>], <span class="dv">0</span>)</span>
<span id="cb60-156"><a href="#cb60-156" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb60-157"><a href="#cb60-157" aria-hidden="true" tabindex="-1"></a>      TP <span class="ot">&lt;-</span> confusion[<span class="dv">2</span>, <span class="dv">2</span>]</span>
<span id="cb60-158"><a href="#cb60-158" aria-hidden="true" tabindex="-1"></a>      TN <span class="ot">&lt;-</span> confusion[<span class="dv">1</span>, <span class="dv">1</span>]</span>
<span id="cb60-159"><a href="#cb60-159" aria-hidden="true" tabindex="-1"></a>      FP <span class="ot">&lt;-</span> confusion[<span class="dv">1</span>, <span class="dv">2</span>]</span>
<span id="cb60-160"><a href="#cb60-160" aria-hidden="true" tabindex="-1"></a>      FN <span class="ot">&lt;-</span> confusion[<span class="dv">2</span>, <span class="dv">1</span>]</span>
<span id="cb60-161"><a href="#cb60-161" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb60-162"><a href="#cb60-162" aria-hidden="true" tabindex="-1"></a>    auc <span class="ot">&lt;-</span> <span class="fu">roc</span>(test_y, probabilities)<span class="sc">$</span>auc</span>
<span id="cb60-163"><a href="#cb60-163" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb60-164"><a href="#cb60-164" aria-hidden="true" tabindex="-1"></a>    metrics <span class="ot">&lt;-</span> <span class="fu">setNames</span>(<span class="fu">c</span>(outer_index, TP, TN, FP, FN, auc, </span>
<span id="cb60-165"><a href="#cb60-165" aria-hidden="true" tabindex="-1"></a>                          best_k, best_l, <span class="fu">paste</span>(best_vars, <span class="at">collapse =</span> <span class="st">","</span>)), </span>
<span id="cb60-166"><a href="#cb60-166" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">names</span>(performance_metrics))</span>
<span id="cb60-167"><a href="#cb60-167" aria-hidden="true" tabindex="-1"></a>    performance_metrics <span class="ot">&lt;-</span> <span class="fu">rbind</span>(performance_metrics, <span class="fu">as.data.frame</span>(<span class="fu">t</span>(metrics)))</span>
<span id="cb60-168"><a href="#cb60-168" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb60-169"><a href="#cb60-169" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Performance:"</span>, <span class="fu">paste</span>(performance_metrics))</span>
<span id="cb60-170"><a href="#cb60-170" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Confusion Matrix for Fold %d:</span><span class="sc">\n</span><span class="st">"</span>, outer_index))</span>
<span id="cb60-171"><a href="#cb60-171" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(confusion)</span>
<span id="cb60-172"><a href="#cb60-172" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Metrics for Fold %d:</span><span class="sc">\n</span><span class="st">"</span>, outer_index))</span>
<span id="cb60-173"><a href="#cb60-173" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"TP: %d, TN: %d, FP: %d, FN: %d, AUC: %f, Best k: %d, Best l: %f, Best Variables: %s</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb60-174"><a href="#cb60-174" aria-hidden="true" tabindex="-1"></a>                TP, TN, FP, FN, auc, best_k, best_l, <span class="fu">paste</span>(best_vars, <span class="at">collapse =</span> <span class="st">","</span>)))</span>
<span id="cb60-175"><a href="#cb60-175" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb60-176"><a href="#cb60-176" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb60-177"><a href="#cb60-177" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="at">performance_metrics =</span> performance_metrics, <span class="at">inner_fold_metrics =</span> inner_fold_metrics)</span>
<span id="cb60-178"><a href="#cb60-178" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb60-179"><a href="#cb60-179" aria-hidden="true" tabindex="-1"></a>evaluate_with_seeds_KNN_stepAUC <span class="ot">&lt;-</span> </span>
<span id="cb60-180"><a href="#cb60-180" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(evaluation_function, data, target_var, vars, threshold, seeds, outer, inner, ks, ls) {</span>
<span id="cb60-181"><a href="#cb60-181" aria-hidden="true" tabindex="-1"></a>  results_list <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb60-182"><a href="#cb60-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-183"><a href="#cb60-183" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (seed <span class="cf">in</span> seeds) {</span>
<span id="cb60-184"><a href="#cb60-184" aria-hidden="true" tabindex="-1"></a>    <span class="fu">set.seed</span>(seed)</span>
<span id="cb60-185"><a href="#cb60-185" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Evaluating with seed:"</span>, seed, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb60-186"><a href="#cb60-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-187"><a href="#cb60-187" aria-hidden="true" tabindex="-1"></a>    results <span class="ot">&lt;-</span> <span class="fu">evaluation_function</span>(<span class="at">data =</span> data, </span>
<span id="cb60-188"><a href="#cb60-188" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">target_name =</span> target_var, </span>
<span id="cb60-189"><a href="#cb60-189" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">variables =</span> vars, </span>
<span id="cb60-190"><a href="#cb60-190" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">threshold =</span> threshold, </span>
<span id="cb60-191"><a href="#cb60-191" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">outer =</span> outer, </span>
<span id="cb60-192"><a href="#cb60-192" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">inner =</span> inner, </span>
<span id="cb60-193"><a href="#cb60-193" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">seed =</span> seed,</span>
<span id="cb60-194"><a href="#cb60-194" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">ks =</span> ks,</span>
<span id="cb60-195"><a href="#cb60-195" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">ls =</span> ls)</span>
<span id="cb60-196"><a href="#cb60-196" aria-hidden="true" tabindex="-1"></a>    results_list[[<span class="fu">paste0</span>(<span class="st">"seed_"</span>, seed)]] <span class="ot">&lt;-</span> results</span>
<span id="cb60-197"><a href="#cb60-197" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb60-198"><a href="#cb60-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-199"><a href="#cb60-199" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(results_list)</span>
<span id="cb60-200"><a href="#cb60-200" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb60-201"><a href="#cb60-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-202"><a href="#cb60-202" aria-hidden="true" tabindex="-1"></a>performance_knn_stepauc <span class="ot">&lt;-</span> <span class="fu">evaluate_with_seeds_KNN_stepAUC</span>(</span>
<span id="cb60-203"><a href="#cb60-203" aria-hidden="true" tabindex="-1"></a>  <span class="at">evaluation_function =</span> double_cross_validation_knn_stepAUC,</span>
<span id="cb60-204"><a href="#cb60-204" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_numeric,</span>
<span id="cb60-205"><a href="#cb60-205" aria-hidden="true" tabindex="-1"></a>  <span class="at">outer =</span> <span class="dv">5</span>,</span>
<span id="cb60-206"><a href="#cb60-206" aria-hidden="true" tabindex="-1"></a>  <span class="at">inner =</span> <span class="dv">2</span>,</span>
<span id="cb60-207"><a href="#cb60-207" aria-hidden="true" tabindex="-1"></a>  <span class="at">target_var =</span> <span class="st">"PCR"</span>,</span>
<span id="cb60-208"><a href="#cb60-208" aria-hidden="true" tabindex="-1"></a>  <span class="at">ks =</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">16</span>, <span class="dv">20</span>, <span class="dv">25</span>, <span class="dv">30</span>, <span class="dv">32</span>),</span>
<span id="cb60-209"><a href="#cb60-209" aria-hidden="true" tabindex="-1"></a>  <span class="at">ls =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>),</span>
<span id="cb60-210"><a href="#cb60-210" aria-hidden="true" tabindex="-1"></a>  <span class="at">vars =</span> todas_variables_numeric,</span>
<span id="cb60-211"><a href="#cb60-211" aria-hidden="true" tabindex="-1"></a>  <span class="at">threshold =</span> .<span class="dv">35</span>,</span>
<span id="cb60-212"><a href="#cb60-212" aria-hidden="true" tabindex="-1"></a>  <span class="at">seeds =</span> seeds</span>
<span id="cb60-213"><a href="#cb60-213" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"RData_Files_Algorithms/KNN_StepAUC.RData"</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="embedded-lasso-4" class="level3" data-number="3.5.5">
<h3 data-number="3.5.5" class="anchored" data-anchor-id="embedded-lasso-4"><span class="header-section-number">3.5.5</span> Embedded (Lasso)</h3>
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>double_cross_validation_knn_lasso <span class="ot">&lt;-</span> <span class="cf">function</span>(data, target_name, outer, inner, ks, ls, variables, threshold, seed) {</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(seed)</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>  performance_metrics <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Fold =</span> <span class="fu">integer</span>(), <span class="at">TP =</span> <span class="fu">integer</span>(), <span class="at">TN =</span> <span class="fu">integer</span>(),</span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">FP =</span> <span class="fu">integer</span>(), <span class="at">FN =</span> <span class="fu">integer</span>(), <span class="at">AUC =</span> <span class="fu">numeric</span>(),</span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">Best_k =</span> <span class="fu">integer</span>(), <span class="at">Best_l =</span> <span class="fu">integer</span>(), </span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">Best_Variables =</span> <span class="fu">character</span>(), <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a>  inner_fold_metrics <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Fold =</span> <span class="fu">integer</span>(), <span class="at">Inner_Fold =</span> <span class="fu">integer</span>(), </span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">TP =</span> <span class="fu">integer</span>(), <span class="at">TN =</span> <span class="fu">integer</span>(), <span class="at">FP =</span> <span class="fu">integer</span>(), </span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">FN =</span> <span class="fu">integer</span>(), <span class="at">AUC =</span> <span class="fu">numeric</span>(), <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb62-12"><a href="#cb62-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Convertir las variables del dataset con model.matrix</span></span>
<span id="cb62-13"><a href="#cb62-13" aria-hidden="true" tabindex="-1"></a>  target <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(data[[target_name]]) <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb62-14"><a href="#cb62-14" aria-hidden="true" tabindex="-1"></a>  features <span class="ot">&lt;-</span> data[, <span class="fu">setdiff</span>(<span class="fu">names</span>(data), target_name)]</span>
<span id="cb62-15"><a href="#cb62-15" aria-hidden="true" tabindex="-1"></a>  data_matrix <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">model.matrix</span>(<span class="sc">~</span> ., <span class="at">data=</span>features)[,<span class="sc">-</span><span class="dv">1</span>])  <span class="co"># Eliminar el intercepto</span></span>
<span id="cb62-16"><a href="#cb62-16" aria-hidden="true" tabindex="-1"></a>  data_matrix[[target_name]] <span class="ot">&lt;-</span> target</span>
<span id="cb62-17"><a href="#cb62-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb62-18"><a href="#cb62-18" aria-hidden="true" tabindex="-1"></a>  outer_folds <span class="ot">&lt;-</span> <span class="fu">createFolds</span>(data_matrix[[target_name]], <span class="at">k =</span> outer)</span>
<span id="cb62-19"><a href="#cb62-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb62-20"><a href="#cb62-20" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (outer_index <span class="cf">in</span> <span class="fu">seq_along</span>(outer_folds)) {</span>
<span id="cb62-21"><a href="#cb62-21" aria-hidden="true" tabindex="-1"></a>    outer_train_data <span class="ot">&lt;-</span> data_matrix[<span class="sc">-</span>outer_folds[[outer_index]], ]</span>
<span id="cb62-22"><a href="#cb62-22" aria-hidden="true" tabindex="-1"></a>    outer_test_data <span class="ot">&lt;-</span> data_matrix[outer_folds[[outer_index]], ]</span>
<span id="cb62-23"><a href="#cb62-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb62-24"><a href="#cb62-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Outer Fold %d</span><span class="sc">\n</span><span class="st">"</span>, outer_index))</span>
<span id="cb62-25"><a href="#cb62-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Training Data - Class 0: "</span>, <span class="fu">sum</span>(outer_train_data[[target_name]] <span class="sc">==</span> <span class="dv">0</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb62-26"><a href="#cb62-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Training Data - Class 1: "</span>, <span class="fu">sum</span>(outer_train_data[[target_name]] <span class="sc">==</span> <span class="dv">1</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb62-27"><a href="#cb62-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Testing Data - Class 0: "</span>, <span class="fu">sum</span>(outer_test_data[[target_name]] <span class="sc">==</span> <span class="dv">0</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb62-28"><a href="#cb62-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Testing Data - Class 1: "</span>, <span class="fu">sum</span>(outer_test_data[[target_name]] <span class="sc">==</span> <span class="dv">1</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb62-29"><a href="#cb62-29" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb62-30"><a href="#cb62-30" aria-hidden="true" tabindex="-1"></a>    inner_folds <span class="ot">&lt;-</span> <span class="fu">createFolds</span>(outer_train_data[[target_name]], <span class="at">k =</span> inner)</span>
<span id="cb62-31"><a href="#cb62-31" aria-hidden="true" tabindex="-1"></a>    best_model <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb62-32"><a href="#cb62-32" aria-hidden="true" tabindex="-1"></a>    best_auc <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb62-33"><a href="#cb62-33" aria-hidden="true" tabindex="-1"></a>    best_k <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb62-34"><a href="#cb62-34" aria-hidden="true" tabindex="-1"></a>    best_l <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb62-35"><a href="#cb62-35" aria-hidden="true" tabindex="-1"></a>    best_vars <span class="ot">&lt;-</span> <span class="fu">colnames</span>(outer_train_data)[<span class="sc">!</span><span class="fu">colnames</span>(outer_train_data) <span class="sc">%in%</span> target_name]</span>
<span id="cb62-36"><a href="#cb62-36" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb62-37"><a href="#cb62-37" aria-hidden="true" tabindex="-1"></a>    grid <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">k =</span> ks, <span class="at">l =</span> ls)</span>
<span id="cb62-38"><a href="#cb62-38" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb62-39"><a href="#cb62-39" aria-hidden="true" tabindex="-1"></a>    select_vars_lasso <span class="ot">&lt;-</span> <span class="cf">function</span>(data, target_name) {</span>
<span id="cb62-40"><a href="#cb62-40" aria-hidden="true" tabindex="-1"></a>      target <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(data[[target_name]])</span>
<span id="cb62-41"><a href="#cb62-41" aria-hidden="true" tabindex="-1"></a>      features <span class="ot">&lt;-</span> data[, <span class="fu">setdiff</span>(<span class="fu">names</span>(data), target_name)]</span>
<span id="cb62-42"><a href="#cb62-42" aria-hidden="true" tabindex="-1"></a>      X <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(<span class="sc">~</span> ., <span class="at">data=</span>features)[,<span class="sc">-</span><span class="dv">1</span>]  <span class="co"># Eliminamos el intercepto</span></span>
<span id="cb62-43"><a href="#cb62-43" aria-hidden="true" tabindex="-1"></a>      y <span class="ot">&lt;-</span> target</span>
<span id="cb62-44"><a href="#cb62-44" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb62-45"><a href="#cb62-45" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Ajustamos el modelo Lasso</span></span>
<span id="cb62-46"><a href="#cb62-46" aria-hidden="true" tabindex="-1"></a>      lasso_model <span class="ot">&lt;-</span> <span class="fu">cv.glmnet</span>(X, y, <span class="at">alpha=</span><span class="dv">1</span>)</span>
<span id="cb62-47"><a href="#cb62-47" aria-hidden="true" tabindex="-1"></a>      lasso_coef <span class="ot">&lt;-</span> <span class="fu">coef</span>(lasso_model, <span class="at">s =</span> <span class="st">"lambda.min"</span>)</span>
<span id="cb62-48"><a href="#cb62-48" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb62-49"><a href="#cb62-49" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Seleccionamos las variables no nulas</span></span>
<span id="cb62-50"><a href="#cb62-50" aria-hidden="true" tabindex="-1"></a>      selected_vars <span class="ot">&lt;-</span> <span class="fu">rownames</span>(lasso_coef)[lasso_coef[, <span class="dv">1</span>] <span class="sc">!=</span> <span class="dv">0</span>]</span>
<span id="cb62-51"><a href="#cb62-51" aria-hidden="true" tabindex="-1"></a>      selected_vars <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(selected_vars, <span class="st">"(Intercept)"</span>)</span>
<span id="cb62-52"><a href="#cb62-52" aria-hidden="true" tabindex="-1"></a>      <span class="co">#cat("Selected variables by Lasso: ", paste(selected_vars, collapse=", "), "\n")</span></span>
<span id="cb62-53"><a href="#cb62-53" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(selected_vars)</span>
<span id="cb62-54"><a href="#cb62-54" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb62-55"><a href="#cb62-55" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb62-56"><a href="#cb62-56" aria-hidden="true" tabindex="-1"></a>    stepAUC <span class="ot">&lt;-</span> <span class="cf">function</span>(vars, data, target_name, grid, inner_folds) {</span>
<span id="cb62-57"><a href="#cb62-57" aria-hidden="true" tabindex="-1"></a>      best_inner_auc <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb62-58"><a href="#cb62-58" aria-hidden="true" tabindex="-1"></a>      best_inner_model <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb62-59"><a href="#cb62-59" aria-hidden="true" tabindex="-1"></a>      best_inner_k <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb62-60"><a href="#cb62-60" aria-hidden="true" tabindex="-1"></a>      best_inner_l <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb62-61"><a href="#cb62-61" aria-hidden="true" tabindex="-1"></a>      best_inner_vars <span class="ot">&lt;-</span> vars</span>
<span id="cb62-62"><a href="#cb62-62" aria-hidden="true" tabindex="-1"></a>      improved <span class="ot">&lt;-</span> <span class="cn">TRUE</span></span>
<span id="cb62-63"><a href="#cb62-63" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb62-64"><a href="#cb62-64" aria-hidden="true" tabindex="-1"></a>      <span class="cf">while</span> (improved <span class="sc">&amp;&amp;</span> <span class="fu">length</span>(vars) <span class="sc">&gt;</span> <span class="dv">1</span>) {</span>
<span id="cb62-65"><a href="#cb62-65" aria-hidden="true" tabindex="-1"></a>        improved <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb62-66"><a href="#cb62-66" aria-hidden="true" tabindex="-1"></a>        best_auc_in_step <span class="ot">&lt;-</span> best_inner_auc</span>
<span id="cb62-67"><a href="#cb62-67" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb62-68"><a href="#cb62-68" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (params <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(grid)) {</span>
<span id="cb62-69"><a href="#cb62-69" aria-hidden="true" tabindex="-1"></a>          auc_vals <span class="ot">&lt;-</span> <span class="fu">numeric</span>()</span>
<span id="cb62-70"><a href="#cb62-70" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb62-71"><a href="#cb62-71" aria-hidden="true" tabindex="-1"></a>          <span class="cf">for</span> (inner_index <span class="cf">in</span> <span class="fu">seq_along</span>(inner_folds)) {</span>
<span id="cb62-72"><a href="#cb62-72" aria-hidden="true" tabindex="-1"></a>            inner_train_data <span class="ot">&lt;-</span> outer_train_data[<span class="sc">-</span>inner_folds[[inner_index]], ]</span>
<span id="cb62-73"><a href="#cb62-73" aria-hidden="true" tabindex="-1"></a>            inner_test_data <span class="ot">&lt;-</span> outer_train_data[inner_folds[[inner_index]], ]</span>
<span id="cb62-74"><a href="#cb62-74" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb62-75"><a href="#cb62-75" aria-hidden="true" tabindex="-1"></a>            selected_vars <span class="ot">&lt;-</span> <span class="fu">select_vars_lasso</span>(inner_train_data, target_name)</span>
<span id="cb62-76"><a href="#cb62-76" aria-hidden="true" tabindex="-1"></a>            formula <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(<span class="fu">paste</span>(target_name, <span class="st">"~"</span>, <span class="fu">paste</span>(selected_vars, <span class="at">collapse =</span> <span class="st">"+"</span>)))</span>
<span id="cb62-77"><a href="#cb62-77" aria-hidden="true" tabindex="-1"></a>            <span class="co">#cat("Testing with formula: ", deparse(formula), "\n")</span></span>
<span id="cb62-78"><a href="#cb62-78" aria-hidden="true" tabindex="-1"></a>            <span class="co">#cat("Grid parameters - k: ", grid$k[params], ", l: ", grid$l[params], "\n")</span></span>
<span id="cb62-79"><a href="#cb62-79" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb62-80"><a href="#cb62-80" aria-hidden="true" tabindex="-1"></a>            result <span class="ot">&lt;-</span> <span class="fu">tryCatch</span>({</span>
<span id="cb62-81"><a href="#cb62-81" aria-hidden="true" tabindex="-1"></a>              train_x <span class="ot">&lt;-</span> inner_train_data[, selected_vars, drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb62-82"><a href="#cb62-82" aria-hidden="true" tabindex="-1"></a>              test_x <span class="ot">&lt;-</span> inner_test_data[, selected_vars, drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb62-83"><a href="#cb62-83" aria-hidden="true" tabindex="-1"></a>              train_y <span class="ot">&lt;-</span> inner_train_data[[target_name]]</span>
<span id="cb62-84"><a href="#cb62-84" aria-hidden="true" tabindex="-1"></a>              test_y <span class="ot">&lt;-</span> inner_test_data[[target_name]]</span>
<span id="cb62-85"><a href="#cb62-85" aria-hidden="true" tabindex="-1"></a>              </span>
<span id="cb62-86"><a href="#cb62-86" aria-hidden="true" tabindex="-1"></a>              predictions <span class="ot">&lt;-</span> <span class="fu">knn</span>(train_x, test_x, train_y, <span class="at">k =</span> grid<span class="sc">$</span>k[params], <span class="at">l =</span> grid<span class="sc">$</span>l[params], <span class="at">prob =</span> <span class="cn">TRUE</span>)</span>
<span id="cb62-87"><a href="#cb62-87" aria-hidden="true" tabindex="-1"></a>              prob_predictions <span class="ot">&lt;-</span> <span class="fu">attr</span>(predictions, <span class="st">"prob"</span>)</span>
<span id="cb62-88"><a href="#cb62-88" aria-hidden="true" tabindex="-1"></a>              prob_predictions <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(predictions <span class="sc">==</span> <span class="st">"1"</span>, prob_predictions, <span class="dv">1</span> <span class="sc">-</span> prob_predictions)</span>
<span id="cb62-89"><a href="#cb62-89" aria-hidden="true" tabindex="-1"></a>              roc_curve <span class="ot">&lt;-</span> <span class="fu">roc</span>(inner_test_data[[target_name]], prob_predictions)</span>
<span id="cb62-90"><a href="#cb62-90" aria-hidden="true" tabindex="-1"></a>              auc_vals[inner_index] <span class="ot">&lt;-</span> roc_curve<span class="sc">$</span>auc</span>
<span id="cb62-91"><a href="#cb62-91" aria-hidden="true" tabindex="-1"></a>              <span class="co">#cat("AUC for inner fold ", inner_index, ": ", roc_curve$auc, "\n")</span></span>
<span id="cb62-92"><a href="#cb62-92" aria-hidden="true" tabindex="-1"></a>              </span>
<span id="cb62-93"><a href="#cb62-93" aria-hidden="true" tabindex="-1"></a>            }, <span class="at">error =</span> <span class="cf">function</span>(e) {</span>
<span id="cb62-94"><a href="#cb62-94" aria-hidden="true" tabindex="-1"></a>              <span class="fu">cat</span>(<span class="st">"Error with variables: "</span>, <span class="fu">paste</span>(selected_vars, <span class="at">collapse =</span> <span class="st">", "</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb62-95"><a href="#cb62-95" aria-hidden="true" tabindex="-1"></a>              <span class="fu">cat</span>(<span class="st">"Error message: "</span>, e<span class="sc">$</span>message, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb62-96"><a href="#cb62-96" aria-hidden="true" tabindex="-1"></a>              auc_vals[inner_index] <span class="ot">&lt;-</span> <span class="cn">NA</span>  <span class="co"># Set to NA or some other indicator of failure</span></span>
<span id="cb62-97"><a href="#cb62-97" aria-hidden="true" tabindex="-1"></a>            })</span>
<span id="cb62-98"><a href="#cb62-98" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb62-99"><a href="#cb62-99" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb62-100"><a href="#cb62-100" aria-hidden="true" tabindex="-1"></a>          mean_auc <span class="ot">&lt;-</span> <span class="fu">mean</span>(auc_vals, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb62-101"><a href="#cb62-101" aria-hidden="true" tabindex="-1"></a>          <span class="co">#cat("Mean AUC for params - k: ", grid$k[params], ", l: ", grid$l[params], ": ", mean_auc, "\n")</span></span>
<span id="cb62-102"><a href="#cb62-102" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.na</span>(mean_auc) <span class="sc">&amp;&amp;</span> mean_auc <span class="sc">&gt;</span> best_auc_in_step) {</span>
<span id="cb62-103"><a href="#cb62-103" aria-hidden="true" tabindex="-1"></a>            best_auc_in_step <span class="ot">&lt;-</span> mean_auc</span>
<span id="cb62-104"><a href="#cb62-104" aria-hidden="true" tabindex="-1"></a>            best_inner_model <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">k =</span> grid<span class="sc">$</span>k[params], <span class="at">l =</span> grid<span class="sc">$</span>l[params])</span>
<span id="cb62-105"><a href="#cb62-105" aria-hidden="true" tabindex="-1"></a>            best_inner_k <span class="ot">&lt;-</span> grid<span class="sc">$</span>k[params]</span>
<span id="cb62-106"><a href="#cb62-106" aria-hidden="true" tabindex="-1"></a>            best_inner_l <span class="ot">&lt;-</span> grid<span class="sc">$</span>l[params]</span>
<span id="cb62-107"><a href="#cb62-107" aria-hidden="true" tabindex="-1"></a>            best_inner_vars <span class="ot">&lt;-</span> selected_vars</span>
<span id="cb62-108"><a href="#cb62-108" aria-hidden="true" tabindex="-1"></a>            improved <span class="ot">&lt;-</span> <span class="cn">TRUE</span></span>
<span id="cb62-109"><a href="#cb62-109" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb62-110"><a href="#cb62-110" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb62-111"><a href="#cb62-111" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb62-112"><a href="#cb62-112" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (improved) {</span>
<span id="cb62-113"><a href="#cb62-113" aria-hidden="true" tabindex="-1"></a>          vars <span class="ot">&lt;-</span> best_inner_vars</span>
<span id="cb62-114"><a href="#cb62-114" aria-hidden="true" tabindex="-1"></a>          best_inner_auc <span class="ot">&lt;-</span> best_auc_in_step</span>
<span id="cb62-115"><a href="#cb62-115" aria-hidden="true" tabindex="-1"></a>          <span class="fu">cat</span>(<span class="st">"Vars improved: "</span>, <span class="fu">paste</span>(vars, <span class="at">collapse=</span><span class="st">", "</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb62-116"><a href="#cb62-116" aria-hidden="true" tabindex="-1"></a>          <span class="fu">cat</span>(<span class="st">"AUC: "</span>, best_inner_auc, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb62-117"><a href="#cb62-117" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb62-118"><a href="#cb62-118" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb62-119"><a href="#cb62-119" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb62-120"><a href="#cb62-120" aria-hidden="true" tabindex="-1"></a>      <span class="fu">list</span>(<span class="at">model =</span> best_inner_model, <span class="at">auc =</span> best_inner_auc, </span>
<span id="cb62-121"><a href="#cb62-121" aria-hidden="true" tabindex="-1"></a>           <span class="at">k =</span> best_inner_k, <span class="at">l =</span> best_inner_l, </span>
<span id="cb62-122"><a href="#cb62-122" aria-hidden="true" tabindex="-1"></a>           <span class="at">vars =</span> best_inner_vars)</span>
<span id="cb62-123"><a href="#cb62-123" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb62-124"><a href="#cb62-124" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb62-125"><a href="#cb62-125" aria-hidden="true" tabindex="-1"></a>    best_result <span class="ot">&lt;-</span> <span class="fu">stepAUC</span>(best_vars, outer_train_data, target_name, grid, inner_folds)</span>
<span id="cb62-126"><a href="#cb62-126" aria-hidden="true" tabindex="-1"></a>    best_model <span class="ot">&lt;-</span> best_result<span class="sc">$</span>model</span>
<span id="cb62-127"><a href="#cb62-127" aria-hidden="true" tabindex="-1"></a>    best_auc <span class="ot">&lt;-</span> best_result<span class="sc">$</span>auc</span>
<span id="cb62-128"><a href="#cb62-128" aria-hidden="true" tabindex="-1"></a>    best_k <span class="ot">&lt;-</span> best_result<span class="sc">$</span>k</span>
<span id="cb62-129"><a href="#cb62-129" aria-hidden="true" tabindex="-1"></a>    best_l <span class="ot">&lt;-</span> best_result<span class="sc">$</span>l</span>
<span id="cb62-130"><a href="#cb62-130" aria-hidden="true" tabindex="-1"></a>    best_vars <span class="ot">&lt;-</span> best_result<span class="sc">$</span>vars</span>
<span id="cb62-131"><a href="#cb62-131" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb62-132"><a href="#cb62-132" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">is.null</span>(best_model)) {</span>
<span id="cb62-133"><a href="#cb62-133" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cat</span>(<span class="st">"Error: No valid model found for outer fold "</span>, outer_index, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb62-134"><a href="#cb62-134" aria-hidden="true" tabindex="-1"></a>      <span class="cf">next</span></span>
<span id="cb62-135"><a href="#cb62-135" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb62-136"><a href="#cb62-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-137"><a href="#cb62-137" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Evaluar el mejor modelo en el validation split del inner loop</span></span>
<span id="cb62-138"><a href="#cb62-138" aria-hidden="true" tabindex="-1"></a>    inner_auc_vals <span class="ot">&lt;-</span> <span class="fu">numeric</span>()</span>
<span id="cb62-139"><a href="#cb62-139" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (inner_index <span class="cf">in</span> <span class="fu">seq_along</span>(inner_folds)) {</span>
<span id="cb62-140"><a href="#cb62-140" aria-hidden="true" tabindex="-1"></a>      inner_train_data <span class="ot">&lt;-</span> outer_train_data[<span class="sc">-</span>inner_folds[[inner_index]], ]</span>
<span id="cb62-141"><a href="#cb62-141" aria-hidden="true" tabindex="-1"></a>      inner_test_data <span class="ot">&lt;-</span> outer_train_data[inner_folds[[inner_index]], ]</span>
<span id="cb62-142"><a href="#cb62-142" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb62-143"><a href="#cb62-143" aria-hidden="true" tabindex="-1"></a>      train_x <span class="ot">&lt;-</span> inner_train_data[, best_vars, drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb62-144"><a href="#cb62-144" aria-hidden="true" tabindex="-1"></a>      test_x <span class="ot">&lt;-</span> inner_test_data[, best_vars, drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb62-145"><a href="#cb62-145" aria-hidden="true" tabindex="-1"></a>      train_y <span class="ot">&lt;-</span> inner_train_data[[target_name]]</span>
<span id="cb62-146"><a href="#cb62-146" aria-hidden="true" tabindex="-1"></a>      test_y <span class="ot">&lt;-</span> inner_test_data[[target_name]]</span>
<span id="cb62-147"><a href="#cb62-147" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb62-148"><a href="#cb62-148" aria-hidden="true" tabindex="-1"></a>      predictions <span class="ot">&lt;-</span> <span class="fu">knn</span>(train_x, test_x, train_y, <span class="at">k =</span> best_k, <span class="at">l =</span> best_l, <span class="at">prob =</span> <span class="cn">TRUE</span>)</span>
<span id="cb62-149"><a href="#cb62-149" aria-hidden="true" tabindex="-1"></a>      prob_predictions <span class="ot">&lt;-</span> <span class="fu">attr</span>(predictions, <span class="st">"prob"</span>)</span>
<span id="cb62-150"><a href="#cb62-150" aria-hidden="true" tabindex="-1"></a>      prob_predictions <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(predictions <span class="sc">==</span> <span class="st">"1"</span>, prob_predictions, <span class="dv">1</span> <span class="sc">-</span> prob_predictions)</span>
<span id="cb62-151"><a href="#cb62-151" aria-hidden="true" tabindex="-1"></a>      roc_curve <span class="ot">&lt;-</span> <span class="fu">roc</span>(inner_test_data[[target_name]], prob_predictions)</span>
<span id="cb62-152"><a href="#cb62-152" aria-hidden="true" tabindex="-1"></a>      inner_auc_vals[inner_index] <span class="ot">&lt;-</span> roc_curve<span class="sc">$</span>auc</span>
<span id="cb62-153"><a href="#cb62-153" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cat</span>(<span class="st">"Inner fold "</span>, inner_index, <span class="st">" AUC: "</span>, roc_curve<span class="sc">$</span>auc, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb62-154"><a href="#cb62-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-155"><a href="#cb62-155" aria-hidden="true" tabindex="-1"></a>      pred_class <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(prob_predictions <span class="sc">&gt;</span> threshold, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb62-156"><a href="#cb62-156" aria-hidden="true" tabindex="-1"></a>      confusion <span class="ot">&lt;-</span> <span class="fu">table</span>(<span class="at">Actual =</span> inner_test_data[[target_name]], <span class="at">Predicted =</span> pred_class)</span>
<span id="cb62-157"><a href="#cb62-157" aria-hidden="true" tabindex="-1"></a>      TP <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span>, confusion[<span class="dv">2</span>, <span class="dv">2</span>], <span class="dv">0</span>)</span>
<span id="cb62-158"><a href="#cb62-158" aria-hidden="true" tabindex="-1"></a>      TN <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span>, confusion[<span class="dv">1</span>, <span class="dv">1</span>], <span class="dv">0</span>)</span>
<span id="cb62-159"><a href="#cb62-159" aria-hidden="true" tabindex="-1"></a>      FP <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span>, confusion[<span class="dv">1</span>, <span class="dv">2</span>], <span class="dv">0</span>)</span>
<span id="cb62-160"><a href="#cb62-160" aria-hidden="true" tabindex="-1"></a>      FN <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span>, confusion[<span class="dv">2</span>, <span class="dv">1</span>], <span class="dv">0</span>)</span>
<span id="cb62-161"><a href="#cb62-161" aria-hidden="true" tabindex="-1"></a>      auc <span class="ot">&lt;-</span> roc_curve<span class="sc">$</span>auc</span>
<span id="cb62-162"><a href="#cb62-162" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb62-163"><a href="#cb62-163" aria-hidden="true" tabindex="-1"></a>      inner_metrics <span class="ot">&lt;-</span> <span class="fu">setNames</span>(<span class="fu">c</span>(outer_index, inner_index, TP, TN, FP, FN, auc), <span class="fu">names</span>(inner_fold_metrics))</span>
<span id="cb62-164"><a href="#cb62-164" aria-hidden="true" tabindex="-1"></a>      inner_fold_metrics <span class="ot">&lt;-</span> <span class="fu">rbind</span>(inner_fold_metrics, <span class="fu">as.data.frame</span>(<span class="fu">t</span>(inner_metrics)))</span>
<span id="cb62-165"><a href="#cb62-165" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb62-166"><a href="#cb62-166" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb62-167"><a href="#cb62-167" aria-hidden="true" tabindex="-1"></a>    best_inner_auc <span class="ot">&lt;-</span> <span class="fu">mean</span>(inner_auc_vals, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb62-168"><a href="#cb62-168" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Best inner AUC: "</span>, best_inner_auc, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb62-169"><a href="#cb62-169" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb62-170"><a href="#cb62-170" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Reentrenar el mejor modelo con todos los datos de outer_train_data</span></span>
<span id="cb62-171"><a href="#cb62-171" aria-hidden="true" tabindex="-1"></a>    train_x <span class="ot">&lt;-</span> outer_train_data[, best_vars, drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb62-172"><a href="#cb62-172" aria-hidden="true" tabindex="-1"></a>    train_y <span class="ot">&lt;-</span> outer_train_data[[target_name]]</span>
<span id="cb62-173"><a href="#cb62-173" aria-hidden="true" tabindex="-1"></a>    best_model <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">train_x =</span> train_x, <span class="at">train_y =</span> train_y, <span class="at">k =</span> best_k, <span class="at">l =</span> best_l)</span>
<span id="cb62-174"><a href="#cb62-174" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb62-175"><a href="#cb62-175" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Evaluar el mejor modelo en el conjunto de prueba del outer fold</span></span>
<span id="cb62-176"><a href="#cb62-176" aria-hidden="true" tabindex="-1"></a>    test_x <span class="ot">&lt;-</span> outer_test_data[, best_vars, drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb62-177"><a href="#cb62-177" aria-hidden="true" tabindex="-1"></a>    test_y <span class="ot">&lt;-</span> outer_test_data[[target_name]]</span>
<span id="cb62-178"><a href="#cb62-178" aria-hidden="true" tabindex="-1"></a>    predictions <span class="ot">&lt;-</span> <span class="fu">knn</span>(<span class="at">train =</span> best_model<span class="sc">$</span>train_x, <span class="at">test =</span> test_x, <span class="at">cl =</span> best_model<span class="sc">$</span>train_y, <span class="at">k =</span> best_k, <span class="at">l =</span> best_l, <span class="at">prob =</span> <span class="cn">TRUE</span>)</span>
<span id="cb62-179"><a href="#cb62-179" aria-hidden="true" tabindex="-1"></a>    prob_predictions <span class="ot">&lt;-</span> <span class="fu">attr</span>(predictions, <span class="st">"prob"</span>)</span>
<span id="cb62-180"><a href="#cb62-180" aria-hidden="true" tabindex="-1"></a>    prob_predictions <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(predictions <span class="sc">==</span> <span class="st">"1"</span>, prob_predictions, <span class="dv">1</span> <span class="sc">-</span> prob_predictions)</span>
<span id="cb62-181"><a href="#cb62-181" aria-hidden="true" tabindex="-1"></a>    pred_class <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(prob_predictions <span class="sc">&gt;</span> threshold, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb62-182"><a href="#cb62-182" aria-hidden="true" tabindex="-1"></a>    confusion <span class="ot">&lt;-</span> <span class="fu">table</span>(<span class="at">Actual =</span> test_y, <span class="at">Predicted =</span> pred_class)</span>
<span id="cb62-183"><a href="#cb62-183" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb62-184"><a href="#cb62-184" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">nrow</span>(confusion) <span class="sc">&lt;</span> <span class="dv">2</span> <span class="sc">||</span> <span class="fu">ncol</span>(confusion) <span class="sc">&lt;</span> <span class="dv">2</span>) {</span>
<span id="cb62-185"><a href="#cb62-185" aria-hidden="true" tabindex="-1"></a>      TP <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span>, confusion[<span class="dv">2</span>, <span class="dv">2</span>], <span class="dv">0</span>)</span>
<span id="cb62-186"><a href="#cb62-186" aria-hidden="true" tabindex="-1"></a>      TN <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span>, confusion[<span class="dv">1</span>, <span class="dv">1</span>], <span class="dv">0</span>)</span>
<span id="cb62-187"><a href="#cb62-187" aria-hidden="true" tabindex="-1"></a>      FP <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span>, confusion[<span class="dv">1</span>, <span class="dv">2</span>], <span class="dv">0</span>)</span>
<span id="cb62-188"><a href="#cb62-188" aria-hidden="true" tabindex="-1"></a>      FN <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span>, confusion[<span class="dv">2</span>, <span class="dv">1</span>], <span class="dv">0</span>)</span>
<span id="cb62-189"><a href="#cb62-189" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb62-190"><a href="#cb62-190" aria-hidden="true" tabindex="-1"></a>      TP <span class="ot">&lt;-</span> confusion[<span class="dv">2</span>, <span class="dv">2</span>]</span>
<span id="cb62-191"><a href="#cb62-191" aria-hidden="true" tabindex="-1"></a>      TN <span class="ot">&lt;-</span> confusion[<span class="dv">1</span>, <span class="dv">1</span>]</span>
<span id="cb62-192"><a href="#cb62-192" aria-hidden="true" tabindex="-1"></a>      FP <span class="ot">&lt;-</span> confusion[<span class="dv">1</span>, <span class="dv">2</span>]</span>
<span id="cb62-193"><a href="#cb62-193" aria-hidden="true" tabindex="-1"></a>      FN <span class="ot">&lt;-</span> confusion[<span class="dv">2</span>, <span class="dv">1</span>]</span>
<span id="cb62-194"><a href="#cb62-194" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb62-195"><a href="#cb62-195" aria-hidden="true" tabindex="-1"></a>    auc <span class="ot">&lt;-</span> <span class="fu">roc</span>(outer_test_data[[target_name]], prob_predictions)<span class="sc">$</span>auc</span>
<span id="cb62-196"><a href="#cb62-196" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb62-197"><a href="#cb62-197" aria-hidden="true" tabindex="-1"></a>    metrics <span class="ot">&lt;-</span> <span class="fu">setNames</span>(<span class="fu">c</span>(outer_index, TP, TN, FP, FN, auc, </span>
<span id="cb62-198"><a href="#cb62-198" aria-hidden="true" tabindex="-1"></a>                          best_k, best_l, <span class="fu">paste</span>(best_vars, <span class="at">collapse =</span> <span class="st">","</span>)), </span>
<span id="cb62-199"><a href="#cb62-199" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">names</span>(performance_metrics))</span>
<span id="cb62-200"><a href="#cb62-200" aria-hidden="true" tabindex="-1"></a>    performance_metrics <span class="ot">&lt;-</span> <span class="fu">rbind</span>(performance_metrics, <span class="fu">as.data.frame</span>(<span class="fu">t</span>(metrics)))</span>
<span id="cb62-201"><a href="#cb62-201" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb62-202"><a href="#cb62-202" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Performance:</span><span class="sc">\n</span><span class="st">"</span>, <span class="fu">paste</span>(performance_metrics), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb62-203"><a href="#cb62-203" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Confusion Matrix for Fold %d:</span><span class="sc">\n</span><span class="st">"</span>, outer_index))</span>
<span id="cb62-204"><a href="#cb62-204" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(confusion)</span>
<span id="cb62-205"><a href="#cb62-205" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Metrics for Fold %d:</span><span class="sc">\n</span><span class="st">"</span>, outer_index))</span>
<span id="cb62-206"><a href="#cb62-206" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"TP: %d, TN: %d, FP: %d, FN: %d, AUC: %f, Best k: %d, Best l: %d, Best Variables: %s</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb62-207"><a href="#cb62-207" aria-hidden="true" tabindex="-1"></a>                TP, TN, FP, FN, auc, best_k, best_l, <span class="fu">paste</span>(best_vars, <span class="at">collapse =</span> <span class="st">","</span>)))</span>
<span id="cb62-208"><a href="#cb62-208" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb62-209"><a href="#cb62-209" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb62-210"><a href="#cb62-210" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="at">performance_metrics =</span> performance_metrics, <span class="at">inner_fold_metrics =</span> inner_fold_metrics)</span>
<span id="cb62-211"><a href="#cb62-211" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb62-212"><a href="#cb62-212" aria-hidden="true" tabindex="-1"></a>evaluate_with_seeds_KNN_lasso <span class="ot">&lt;-</span> </span>
<span id="cb62-213"><a href="#cb62-213" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(evaluation_function, data, target_var, vars, threshold, seeds, outer, inner, ks, ls) {</span>
<span id="cb62-214"><a href="#cb62-214" aria-hidden="true" tabindex="-1"></a>  results_list <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb62-215"><a href="#cb62-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-216"><a href="#cb62-216" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (seed <span class="cf">in</span> seeds) {</span>
<span id="cb62-217"><a href="#cb62-217" aria-hidden="true" tabindex="-1"></a>    <span class="fu">set.seed</span>(seed)</span>
<span id="cb62-218"><a href="#cb62-218" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Evaluating with seed:"</span>, seed, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb62-219"><a href="#cb62-219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-220"><a href="#cb62-220" aria-hidden="true" tabindex="-1"></a>    results <span class="ot">&lt;-</span> <span class="fu">evaluation_function</span>(<span class="at">data =</span> data, </span>
<span id="cb62-221"><a href="#cb62-221" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">target_name =</span> target_var, </span>
<span id="cb62-222"><a href="#cb62-222" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">variables =</span> vars, </span>
<span id="cb62-223"><a href="#cb62-223" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">threshold =</span> threshold, </span>
<span id="cb62-224"><a href="#cb62-224" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">outer =</span> outer, </span>
<span id="cb62-225"><a href="#cb62-225" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">inner =</span> inner, </span>
<span id="cb62-226"><a href="#cb62-226" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">seed =</span> seed,</span>
<span id="cb62-227"><a href="#cb62-227" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">ks =</span> ks,</span>
<span id="cb62-228"><a href="#cb62-228" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">ls =</span> ls)</span>
<span id="cb62-229"><a href="#cb62-229" aria-hidden="true" tabindex="-1"></a>    results_list[[<span class="fu">paste0</span>(<span class="st">"seed_"</span>, seed)]] <span class="ot">&lt;-</span> results</span>
<span id="cb62-230"><a href="#cb62-230" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb62-231"><a href="#cb62-231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-232"><a href="#cb62-232" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(results_list)</span>
<span id="cb62-233"><a href="#cb62-233" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb62-234"><a href="#cb62-234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-235"><a href="#cb62-235" aria-hidden="true" tabindex="-1"></a>performance_knn_lasso <span class="ot">&lt;-</span> <span class="fu">evaluate_with_seeds_KNN_lasso</span>(</span>
<span id="cb62-236"><a href="#cb62-236" aria-hidden="true" tabindex="-1"></a>  <span class="at">evaluation_function =</span> double_cross_validation_knn_lasso,</span>
<span id="cb62-237"><a href="#cb62-237" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_numeric,</span>
<span id="cb62-238"><a href="#cb62-238" aria-hidden="true" tabindex="-1"></a>  <span class="at">outer =</span> <span class="dv">5</span>,</span>
<span id="cb62-239"><a href="#cb62-239" aria-hidden="true" tabindex="-1"></a>  <span class="at">inner =</span> <span class="dv">2</span>,</span>
<span id="cb62-240"><a href="#cb62-240" aria-hidden="true" tabindex="-1"></a>  <span class="at">target_var =</span> <span class="st">"PCR"</span>,</span>
<span id="cb62-241"><a href="#cb62-241" aria-hidden="true" tabindex="-1"></a>  <span class="at">ks =</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">16</span>, <span class="dv">20</span>, <span class="dv">25</span>, <span class="dv">30</span>, <span class="dv">32</span>),</span>
<span id="cb62-242"><a href="#cb62-242" aria-hidden="true" tabindex="-1"></a>  <span class="at">ls =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>),</span>
<span id="cb62-243"><a href="#cb62-243" aria-hidden="true" tabindex="-1"></a>  <span class="at">vars =</span> todas_variables_numeric,</span>
<span id="cb62-244"><a href="#cb62-244" aria-hidden="true" tabindex="-1"></a>  <span class="at">threshold =</span> .<span class="dv">35</span>,</span>
<span id="cb62-245"><a href="#cb62-245" aria-hidden="true" tabindex="-1"></a>  <span class="at">seeds =</span> seeds</span>
<span id="cb62-246"><a href="#cb62-246" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"RData_Files_Algorithms/KNN_Lasso.RData"</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="support-vector-machines" class="level2" data-number="3.6">
<h2 data-number="3.6" class="anchored" data-anchor-id="support-vector-machines"><span class="header-section-number">3.6</span> Support Vector Machines</h2>
<section id="aparente-5" class="level3" data-number="3.6.1">
<h3 data-number="3.6.1" class="anchored" data-anchor-id="aparente-5"><span class="header-section-number">3.6.1</span> Aparente</h3>
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>evaluate_aparent_performance_model_svm <span class="ot">&lt;-</span> <span class="cf">function</span>(data, target_var, model_func, <span class="at">vars =</span> <span class="cn">NULL</span>, <span class="at">threshold =</span> <span class="fl">0.5</span>) {</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.null</span>(vars)) {</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>    vars <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(<span class="fu">names</span>(data), target_var)</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>  data[[target_var]] <span class="ot">&lt;-</span> <span class="fu">factor</span>(data[[target_var]], <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a>  formula <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(<span class="fu">paste</span>(target_var, <span class="st">"~"</span>, <span class="fu">paste</span>(vars, <span class="at">collapse =</span> <span class="st">"+"</span>)))</span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a>  model <span class="ot">&lt;-</span> <span class="fu">model_func</span>(formula, data)</span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a>  predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(model, <span class="at">newdata =</span> data, <span class="at">probability =</span> <span class="cn">TRUE</span>)</span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true" tabindex="-1"></a>  predictions <span class="ot">&lt;-</span> <span class="fu">attr</span>(predictions, <span class="st">"probabilities"</span>)[, <span class="dv">2</span>]</span>
<span id="cb64-12"><a href="#cb64-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb64-13"><a href="#cb64-13" aria-hidden="true" tabindex="-1"></a>  actual_classes <span class="ot">&lt;-</span> data[[target_var]]</span>
<span id="cb64-14"><a href="#cb64-14" aria-hidden="true" tabindex="-1"></a>  predicted_classes <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(predictions <span class="sc">&gt;</span> threshold, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb64-15"><a href="#cb64-15" aria-hidden="true" tabindex="-1"></a>  confusion_matrix <span class="ot">&lt;-</span> <span class="fu">table</span>(predicted_classes, actual_classes)</span>
<span id="cb64-16"><a href="#cb64-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb64-17"><a href="#cb64-17" aria-hidden="true" tabindex="-1"></a>  tp <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="st">"1"</span> <span class="sc">%in%</span> <span class="fu">rownames</span>(confusion_matrix) <span class="sc">&amp;&amp;</span> <span class="st">"1"</span> <span class="sc">%in%</span> <span class="fu">colnames</span>(confusion_matrix), confusion_matrix[<span class="st">"1"</span>, <span class="st">"1"</span>], <span class="dv">0</span>)</span>
<span id="cb64-18"><a href="#cb64-18" aria-hidden="true" tabindex="-1"></a>  tn <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="st">"0"</span> <span class="sc">%in%</span> <span class="fu">rownames</span>(confusion_matrix) <span class="sc">&amp;&amp;</span> <span class="st">"0"</span> <span class="sc">%in%</span> <span class="fu">colnames</span>(confusion_matrix), confusion_matrix[<span class="st">"0"</span>, <span class="st">"0"</span>], <span class="dv">0</span>)</span>
<span id="cb64-19"><a href="#cb64-19" aria-hidden="true" tabindex="-1"></a>  fp <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="st">"1"</span> <span class="sc">%in%</span> <span class="fu">rownames</span>(confusion_matrix) <span class="sc">&amp;&amp;</span> <span class="st">"0"</span> <span class="sc">%in%</span> <span class="fu">colnames</span>(confusion_matrix), confusion_matrix[<span class="st">"1"</span>, <span class="st">"0"</span>], <span class="dv">0</span>)</span>
<span id="cb64-20"><a href="#cb64-20" aria-hidden="true" tabindex="-1"></a>  fn <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="st">"0"</span> <span class="sc">%in%</span> <span class="fu">rownames</span>(confusion_matrix) <span class="sc">&amp;&amp;</span> <span class="st">"1"</span> <span class="sc">%in%</span> <span class="fu">colnames</span>(confusion_matrix), confusion_matrix[<span class="st">"0"</span>, <span class="st">"1"</span>], <span class="dv">0</span>)</span>
<span id="cb64-21"><a href="#cb64-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb64-22"><a href="#cb64-22" aria-hidden="true" tabindex="-1"></a>  accuracy <span class="ot">&lt;-</span> (tp <span class="sc">+</span> tn) <span class="sc">/</span> (tp <span class="sc">+</span> tn <span class="sc">+</span> fp <span class="sc">+</span> fn)</span>
<span id="cb64-23"><a href="#cb64-23" aria-hidden="true" tabindex="-1"></a>  precision <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(tp <span class="sc">+</span> fp <span class="sc">&gt;</span> <span class="dv">0</span>, tp <span class="sc">/</span> (tp <span class="sc">+</span> fp), <span class="dv">0</span>)</span>
<span id="cb64-24"><a href="#cb64-24" aria-hidden="true" tabindex="-1"></a>  recall <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(tp <span class="sc">+</span> fn <span class="sc">&gt;</span> <span class="dv">0</span>, tp <span class="sc">/</span> (tp <span class="sc">+</span> fn), <span class="dv">0</span>)</span>
<span id="cb64-25"><a href="#cb64-25" aria-hidden="true" tabindex="-1"></a>  f1_score <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(precision <span class="sc">+</span> recall <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="dv">2</span> <span class="sc">*</span> (precision <span class="sc">*</span> recall) <span class="sc">/</span> (precision <span class="sc">+</span> recall), <span class="dv">0</span>)</span>
<span id="cb64-26"><a href="#cb64-26" aria-hidden="true" tabindex="-1"></a>  roc_obj <span class="ot">&lt;-</span> pROC<span class="sc">::</span><span class="fu">roc</span>(actual_classes, predictions)</span>
<span id="cb64-27"><a href="#cb64-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb64-28"><a href="#cb64-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="at">confusion_matrix =</span> confusion_matrix, <span class="at">accuracy =</span> accuracy, <span class="at">precision =</span> precision, </span>
<span id="cb64-29"><a href="#cb64-29" aria-hidden="true" tabindex="-1"></a>       <span class="at">recall =</span> recall, <span class="at">f1_score =</span> f1_score, <span class="at">roc_curve =</span> roc_obj)</span>
<span id="cb64-30"><a href="#cb64-30" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb64-31"><a href="#cb64-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-32"><a href="#cb64-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-33"><a href="#cb64-33" aria-hidden="true" tabindex="-1"></a>svm_model <span class="ot">&lt;-</span> <span class="cf">function</span>(formula, data) {</span>
<span id="cb64-34"><a href="#cb64-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(<span class="dv">90</span>)</span>
<span id="cb64-35"><a href="#cb64-35" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(formula, data)</span>
<span id="cb64-36"><a href="#cb64-36" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> data[[<span class="fu">all.vars</span>(formula)[<span class="dv">1</span>]]]</span>
<span id="cb64-37"><a href="#cb64-37" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> <span class="fu">factor</span>(y, <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb64-38"><a href="#cb64-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">svm</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">kernel =</span> <span class="st">"linear"</span>, <span class="at">cost =</span> <span class="dv">100</span>, <span class="at">probability =</span> <span class="cn">TRUE</span>, <span class="at">maxiter=</span><span class="dv">300</span>, <span class="at">random_state=</span><span class="dv">90</span>)</span>
<span id="cb64-39"><a href="#cb64-39" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb64-40"><a href="#cb64-40" aria-hidden="true" tabindex="-1"></a><span class="co"># svm(x = x, y = y, kernel = "poly", cost = 5, gamma = .5, probability = TRUE, maxiter=150)</span></span>
<span id="cb64-41"><a href="#cb64-41" aria-hidden="true" tabindex="-1"></a><span class="co"># svm(x = x, y = y, kernel = "linear", cost = 50, probability = TRUE, maxiter=300, random_state=90)</span></span>
<span id="cb64-42"><a href="#cb64-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-43"><a href="#cb64-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-44"><a href="#cb64-44" aria-hidden="true" tabindex="-1"></a>resultadosAparentesSVM <span class="ot">&lt;-</span> <span class="fu">evaluate_aparent_performance_model_svm</span>(<span class="at">data =</span> data_numeric, <span class="at">target_var =</span> <span class="st">"PCR"</span>,</span>
<span id="cb64-45"><a href="#cb64-45" aria-hidden="true" tabindex="-1"></a>                                                             <span class="at">model_func =</span> svm_model,</span>
<span id="cb64-46"><a href="#cb64-46" aria-hidden="true" tabindex="-1"></a>                                                             <span class="at">vars =</span> <span class="st">"."</span>,</span>
<span id="cb64-47"><a href="#cb64-47" aria-hidden="true" tabindex="-1"></a>                                                             <span class="at">threshold =</span> .<span class="dv">35</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"RData_Files_Algorithms/SVM_Aparente.RData"</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="todas-las-variables-5" class="level3" data-number="3.6.2">
<h3 data-number="3.6.2" class="anchored" data-anchor-id="todas-las-variables-5"><span class="header-section-number">3.6.2</span> Todas las Variables</h3>
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>double_cross_validation_svm <span class="ot">&lt;-</span> <span class="cf">function</span>(data, target_name, outer, inner, kernels, costs, variables, threshold, seed) {</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(seed)</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>  performance_metrics <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Fold =</span> <span class="fu">integer</span>(), <span class="at">TP =</span> <span class="fu">integer</span>(), <span class="at">TN =</span> <span class="fu">integer</span>(),</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">FP =</span> <span class="fu">integer</span>(), <span class="at">FN =</span> <span class="fu">integer</span>(), <span class="at">AUC =</span> <span class="fu">numeric</span>(),</span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">Best_Kernel =</span> <span class="fu">character</span>(), <span class="at">Best_Cost =</span> <span class="fu">numeric</span>(), <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a>  data[[target_name]] <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(data[[target_name]])</span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a>  outer_folds <span class="ot">&lt;-</span> <span class="fu">createFolds</span>(data[[target_name]], <span class="at">k =</span> outer, <span class="at">list =</span> <span class="cn">TRUE</span>, <span class="at">returnTrain =</span> <span class="cn">FALSE</span>)</span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (outer_index <span class="cf">in</span> <span class="fu">seq_along</span>(outer_folds)) {</span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a>    outer_train_data <span class="ot">&lt;-</span> data[<span class="sc">-</span>outer_folds[[outer_index]], ]</span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a>    outer_test_data <span class="ot">&lt;-</span> data[outer_folds[[outer_index]], ]</span>
<span id="cb66-13"><a href="#cb66-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-14"><a href="#cb66-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Outer Fold %d</span><span class="sc">\n</span><span class="st">"</span>, outer_index))</span>
<span id="cb66-15"><a href="#cb66-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Training Data - Class 0: "</span>, <span class="fu">sum</span>(outer_train_data[[target_name]] <span class="sc">==</span> <span class="st">"0"</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb66-16"><a href="#cb66-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Training Data - Class 1: "</span>, <span class="fu">sum</span>(outer_train_data[[target_name]] <span class="sc">==</span> <span class="st">"1"</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb66-17"><a href="#cb66-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Testing Data - Class 0: "</span>, <span class="fu">sum</span>(outer_test_data[[target_name]] <span class="sc">==</span> <span class="st">"0"</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb66-18"><a href="#cb66-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Testing Data - Class 1: "</span>, <span class="fu">sum</span>(outer_test_data[[target_name]] <span class="sc">==</span> <span class="st">"1"</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb66-19"><a href="#cb66-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb66-20"><a href="#cb66-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">sum</span>(outer_train_data[[target_name]] <span class="sc">==</span> <span class="st">"0"</span>) <span class="sc">==</span> <span class="dv">0</span> <span class="sc">||</span> <span class="fu">sum</span>(outer_train_data[[target_name]] <span class="sc">==</span> <span class="st">"1"</span>) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb66-21"><a href="#cb66-21" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cat</span>(<span class="st">"Skipping outer fold due to lack of class diversity</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb66-22"><a href="#cb66-22" aria-hidden="true" tabindex="-1"></a>      <span class="cf">next</span></span>
<span id="cb66-23"><a href="#cb66-23" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb66-24"><a href="#cb66-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-25"><a href="#cb66-25" aria-hidden="true" tabindex="-1"></a>    inner_folds <span class="ot">&lt;-</span> <span class="fu">createFolds</span>(outer_train_data[[target_name]], <span class="at">k =</span> inner, <span class="at">list =</span> <span class="cn">TRUE</span>, <span class="at">returnTrain =</span> <span class="cn">FALSE</span>)</span>
<span id="cb66-26"><a href="#cb66-26" aria-hidden="true" tabindex="-1"></a>    best_model <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb66-27"><a href="#cb66-27" aria-hidden="true" tabindex="-1"></a>    best_auc <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb66-28"><a href="#cb66-28" aria-hidden="true" tabindex="-1"></a>    best_kernel <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb66-29"><a href="#cb66-29" aria-hidden="true" tabindex="-1"></a>    best_cost <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb66-30"><a href="#cb66-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-31"><a href="#cb66-31" aria-hidden="true" tabindex="-1"></a>    grid <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">kernel =</span> kernels, <span class="at">cost =</span> costs)</span>
<span id="cb66-32"><a href="#cb66-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-33"><a href="#cb66-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (params <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(grid)) {</span>
<span id="cb66-34"><a href="#cb66-34" aria-hidden="true" tabindex="-1"></a>      inner_auc <span class="ot">&lt;-</span> <span class="fu">numeric</span>()</span>
<span id="cb66-35"><a href="#cb66-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-36"><a href="#cb66-36" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (inner_index <span class="cf">in</span> <span class="fu">seq_along</span>(inner_folds)) {</span>
<span id="cb66-37"><a href="#cb66-37" aria-hidden="true" tabindex="-1"></a>        inner_train_data <span class="ot">&lt;-</span> outer_train_data[<span class="sc">-</span>inner_folds[[inner_index]], ]</span>
<span id="cb66-38"><a href="#cb66-38" aria-hidden="true" tabindex="-1"></a>        inner_test_data <span class="ot">&lt;-</span> outer_train_data[inner_folds[[inner_index]], ]</span>
<span id="cb66-39"><a href="#cb66-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-40"><a href="#cb66-40" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="fu">sum</span>(inner_train_data[[target_name]] <span class="sc">==</span> <span class="st">"0"</span>) <span class="sc">==</span> <span class="dv">0</span> <span class="sc">||</span> <span class="fu">sum</span>(inner_train_data[[target_name]] <span class="sc">==</span> <span class="st">"1"</span>) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb66-41"><a href="#cb66-41" aria-hidden="true" tabindex="-1"></a>          <span class="fu">cat</span>(<span class="st">"Skipping inner fold due to lack of class diversity</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb66-42"><a href="#cb66-42" aria-hidden="true" tabindex="-1"></a>          <span class="cf">next</span></span>
<span id="cb66-43"><a href="#cb66-43" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb66-44"><a href="#cb66-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-45"><a href="#cb66-45" aria-hidden="true" tabindex="-1"></a>        result <span class="ot">&lt;-</span> <span class="fu">tryCatch</span>({</span>
<span id="cb66-46"><a href="#cb66-46" aria-hidden="true" tabindex="-1"></a>          model <span class="ot">&lt;-</span> <span class="fu">svm</span>(<span class="fu">reformulate</span>(variables, target_name), </span>
<span id="cb66-47"><a href="#cb66-47" aria-hidden="true" tabindex="-1"></a>                       <span class="at">data =</span> inner_train_data, <span class="at">kernel =</span> grid<span class="sc">$</span>kernel[params], <span class="at">cost =</span> grid<span class="sc">$</span>cost[params], </span>
<span id="cb66-48"><a href="#cb66-48" aria-hidden="true" tabindex="-1"></a>                       <span class="at">probability =</span> <span class="cn">TRUE</span>)</span>
<span id="cb66-49"><a href="#cb66-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-50"><a href="#cb66-50" aria-hidden="true" tabindex="-1"></a>          pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(model, inner_test_data, <span class="at">probability =</span> <span class="cn">TRUE</span>)</span>
<span id="cb66-51"><a href="#cb66-51" aria-hidden="true" tabindex="-1"></a>          prob <span class="ot">&lt;-</span> <span class="fu">attr</span>(pred, <span class="st">"probabilities"</span>)[, <span class="dv">2</span>]</span>
<span id="cb66-52"><a href="#cb66-52" aria-hidden="true" tabindex="-1"></a>          roc_curve <span class="ot">&lt;-</span> pROC<span class="sc">::</span><span class="fu">roc</span>(inner_test_data[[target_name]], prob)</span>
<span id="cb66-53"><a href="#cb66-53" aria-hidden="true" tabindex="-1"></a>          inner_auc[inner_index] <span class="ot">&lt;-</span> roc_curve<span class="sc">$</span>auc</span>
<span id="cb66-54"><a href="#cb66-54" aria-hidden="true" tabindex="-1"></a>        }, <span class="at">error =</span> <span class="cf">function</span>(e) {</span>
<span id="cb66-55"><a href="#cb66-55" aria-hidden="true" tabindex="-1"></a>          <span class="fu">cat</span>(<span class="st">"Error with parameters: kernel ="</span>, grid<span class="sc">$</span>kernel[params], <span class="st">", cost ="</span>, grid<span class="sc">$</span>cost[params], <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb66-56"><a href="#cb66-56" aria-hidden="true" tabindex="-1"></a>          <span class="fu">cat</span>(<span class="st">"Error message: "</span>, e<span class="sc">$</span>message, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb66-57"><a href="#cb66-57" aria-hidden="true" tabindex="-1"></a>          inner_auc[inner_index] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb66-58"><a href="#cb66-58" aria-hidden="true" tabindex="-1"></a>        })</span>
<span id="cb66-59"><a href="#cb66-59" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb66-60"><a href="#cb66-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-61"><a href="#cb66-61" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="fu">mean</span>(inner_auc, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">&gt;</span> best_auc) {</span>
<span id="cb66-62"><a href="#cb66-62" aria-hidden="true" tabindex="-1"></a>        best_auc <span class="ot">&lt;-</span> <span class="fu">mean</span>(inner_auc, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb66-63"><a href="#cb66-63" aria-hidden="true" tabindex="-1"></a>        best_model <span class="ot">&lt;-</span> model</span>
<span id="cb66-64"><a href="#cb66-64" aria-hidden="true" tabindex="-1"></a>        best_kernel <span class="ot">&lt;-</span> grid<span class="sc">$</span>kernel[params]</span>
<span id="cb66-65"><a href="#cb66-65" aria-hidden="true" tabindex="-1"></a>        best_cost <span class="ot">&lt;-</span> grid<span class="sc">$</span>cost[params]</span>
<span id="cb66-66"><a href="#cb66-66" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb66-67"><a href="#cb66-67" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb66-68"><a href="#cb66-68" aria-hidden="true" tabindex="-1"></a>    best_model <span class="ot">&lt;-</span> <span class="fu">svm</span>(<span class="fu">reformulate</span>(variables, target_name), </span>
<span id="cb66-69"><a href="#cb66-69" aria-hidden="true" tabindex="-1"></a>                      <span class="at">data =</span> outer_train_data, <span class="at">kernel =</span> best_kernel, <span class="at">cost =</span> best_cost, </span>
<span id="cb66-70"><a href="#cb66-70" aria-hidden="true" tabindex="-1"></a>                      <span class="at">probability =</span> <span class="cn">TRUE</span>)</span>
<span id="cb66-71"><a href="#cb66-71" aria-hidden="true" tabindex="-1"></a>    predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(best_model, outer_test_data, <span class="at">probability =</span> <span class="cn">TRUE</span>)</span>
<span id="cb66-72"><a href="#cb66-72" aria-hidden="true" tabindex="-1"></a>    prob <span class="ot">&lt;-</span> <span class="fu">attr</span>(predictions, <span class="st">"probabilities"</span>)[, <span class="dv">2</span>]</span>
<span id="cb66-73"><a href="#cb66-73" aria-hidden="true" tabindex="-1"></a>    pred_class <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(prob <span class="sc">&gt;</span> threshold, <span class="dv">1</span>, <span class="dv">0</span>)  <span class="co"># Asignar clases basadas en umbral</span></span>
<span id="cb66-74"><a href="#cb66-74" aria-hidden="true" tabindex="-1"></a>    confusion <span class="ot">&lt;-</span> <span class="fu">table</span>(outer_test_data[[target_name]], pred_class)</span>
<span id="cb66-75"><a href="#cb66-75" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb66-76"><a href="#cb66-76" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">nrow</span>(confusion) <span class="sc">&lt;</span> <span class="dv">2</span> <span class="sc">||</span> <span class="fu">ncol</span>(confusion) <span class="sc">&lt;</span> <span class="dv">2</span>) {</span>
<span id="cb66-77"><a href="#cb66-77" aria-hidden="true" tabindex="-1"></a>      TP <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span>, confusion[<span class="dv">2</span>, <span class="dv">2</span>], <span class="dv">0</span>)</span>
<span id="cb66-78"><a href="#cb66-78" aria-hidden="true" tabindex="-1"></a>      TN <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span>, confusion[<span class="dv">1</span>, <span class="dv">1</span>], <span class="dv">0</span>)</span>
<span id="cb66-79"><a href="#cb66-79" aria-hidden="true" tabindex="-1"></a>      FP <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span>, confusion[<span class="dv">1</span>, <span class="dv">2</span>], <span class="dv">0</span>)</span>
<span id="cb66-80"><a href="#cb66-80" aria-hidden="true" tabindex="-1"></a>      FN <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span>, confusion[<span class="dv">2</span>, <span class="dv">1</span>], <span class="dv">0</span>)</span>
<span id="cb66-81"><a href="#cb66-81" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb66-82"><a href="#cb66-82" aria-hidden="true" tabindex="-1"></a>      TP <span class="ot">&lt;-</span> confusion[<span class="dv">2</span>, <span class="dv">2</span>]</span>
<span id="cb66-83"><a href="#cb66-83" aria-hidden="true" tabindex="-1"></a>      TN <span class="ot">&lt;-</span> confusion[<span class="dv">1</span>, <span class="dv">1</span>]</span>
<span id="cb66-84"><a href="#cb66-84" aria-hidden="true" tabindex="-1"></a>      FP <span class="ot">&lt;-</span> confusion[<span class="dv">1</span>, <span class="dv">2</span>]</span>
<span id="cb66-85"><a href="#cb66-85" aria-hidden="true" tabindex="-1"></a>      FN <span class="ot">&lt;-</span> confusion[<span class="dv">2</span>, <span class="dv">1</span>]</span>
<span id="cb66-86"><a href="#cb66-86" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb66-87"><a href="#cb66-87" aria-hidden="true" tabindex="-1"></a>    auc <span class="ot">&lt;-</span> pROC<span class="sc">::</span><span class="fu">roc</span>(outer_test_data[[target_name]], prob)<span class="sc">$</span>auc</span>
<span id="cb66-88"><a href="#cb66-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-89"><a href="#cb66-89" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Crear un vector con los nombres correctos y convertir a dataframe</span></span>
<span id="cb66-90"><a href="#cb66-90" aria-hidden="true" tabindex="-1"></a>    metrics <span class="ot">&lt;-</span> <span class="fu">setNames</span>(<span class="fu">c</span>(outer_index, TP, TN, FP, FN, auc, best_kernel, best_cost), <span class="fu">names</span>(performance_metrics))</span>
<span id="cb66-91"><a href="#cb66-91" aria-hidden="true" tabindex="-1"></a>    performance_metrics <span class="ot">&lt;-</span> <span class="fu">rbind</span>(performance_metrics, <span class="fu">as.data.frame</span>(<span class="fu">t</span>(metrics)))</span>
<span id="cb66-92"><a href="#cb66-92" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb66-93"><a href="#cb66-93" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb66-94"><a href="#cb66-94" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(performance_metrics)</span>
<span id="cb66-95"><a href="#cb66-95" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb66-96"><a href="#cb66-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-97"><a href="#cb66-97" aria-hidden="true" tabindex="-1"></a>evaluate_with_seeds_SVM_TodasVariables_Asociacion <span class="ot">&lt;-</span> </span>
<span id="cb66-98"><a href="#cb66-98" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(evaluation_function, data, target_var, vars, threshold, seeds, outer, inner, kernels, costs) {</span>
<span id="cb66-99"><a href="#cb66-99" aria-hidden="true" tabindex="-1"></a>  results_list <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb66-100"><a href="#cb66-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-101"><a href="#cb66-101" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (seed <span class="cf">in</span> seeds) {</span>
<span id="cb66-102"><a href="#cb66-102" aria-hidden="true" tabindex="-1"></a>    <span class="fu">set.seed</span>(seed)</span>
<span id="cb66-103"><a href="#cb66-103" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Evaluating with seed:"</span>, seed, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb66-104"><a href="#cb66-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-105"><a href="#cb66-105" aria-hidden="true" tabindex="-1"></a>    results <span class="ot">&lt;-</span> <span class="fu">evaluation_function</span>(<span class="at">data =</span> data, </span>
<span id="cb66-106"><a href="#cb66-106" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">target_name =</span> target_var, </span>
<span id="cb66-107"><a href="#cb66-107" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">variables =</span> vars, </span>
<span id="cb66-108"><a href="#cb66-108" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">threshold =</span> threshold, </span>
<span id="cb66-109"><a href="#cb66-109" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">outer =</span> outer, </span>
<span id="cb66-110"><a href="#cb66-110" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">inner =</span> inner, </span>
<span id="cb66-111"><a href="#cb66-111" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">seed =</span> seed,</span>
<span id="cb66-112"><a href="#cb66-112" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">kernels =</span> kernels,</span>
<span id="cb66-113"><a href="#cb66-113" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">costs =</span> costs)</span>
<span id="cb66-114"><a href="#cb66-114" aria-hidden="true" tabindex="-1"></a>    results_list[[<span class="fu">paste0</span>(<span class="st">"seed_"</span>, seed)]] <span class="ot">&lt;-</span> results</span>
<span id="cb66-115"><a href="#cb66-115" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb66-116"><a href="#cb66-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-117"><a href="#cb66-117" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(results_list)</span>
<span id="cb66-118"><a href="#cb66-118" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb66-119"><a href="#cb66-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-120"><a href="#cb66-120" aria-hidden="true" tabindex="-1"></a>performance_SVM_todasvariables <span class="ot">&lt;-</span> <span class="fu">evaluate_with_seeds_SVM_TodasVariables_Asociacion</span>(</span>
<span id="cb66-121"><a href="#cb66-121" aria-hidden="true" tabindex="-1"></a>  <span class="at">evaluation_function =</span> double_cross_validation_svm,</span>
<span id="cb66-122"><a href="#cb66-122" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_factor,</span>
<span id="cb66-123"><a href="#cb66-123" aria-hidden="true" tabindex="-1"></a>  <span class="at">outer =</span> <span class="dv">5</span>,</span>
<span id="cb66-124"><a href="#cb66-124" aria-hidden="true" tabindex="-1"></a>  <span class="at">inner =</span> <span class="dv">2</span>,</span>
<span id="cb66-125"><a href="#cb66-125" aria-hidden="true" tabindex="-1"></a>  <span class="at">target_var =</span> <span class="st">"PCR"</span>,</span>
<span id="cb66-126"><a href="#cb66-126" aria-hidden="true" tabindex="-1"></a>  <span class="at">kernels =</span> <span class="fu">c</span>(<span class="st">"linear"</span>, <span class="st">"poly"</span>),</span>
<span id="cb66-127"><a href="#cb66-127" aria-hidden="true" tabindex="-1"></a>  <span class="at">costs =</span> <span class="fu">c</span>(<span class="dv">50</span>, <span class="dv">100</span>, <span class="dv">200</span>),</span>
<span id="cb66-128"><a href="#cb66-128" aria-hidden="true" tabindex="-1"></a>  <span class="at">vars =</span> todas_variables_factor,</span>
<span id="cb66-129"><a href="#cb66-129" aria-hidden="true" tabindex="-1"></a>  <span class="at">threshold =</span> .<span class="dv">35</span>,</span>
<span id="cb66-130"><a href="#cb66-130" aria-hidden="true" tabindex="-1"></a>  <span class="at">seeds =</span> seeds</span>
<span id="cb66-131"><a href="#cb66-131" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"RData_Files_Algorithms/SVM_TodasVariables.RData"</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="filtrado-asociación-5" class="level3" data-number="3.6.3">
<h3 data-number="3.6.3" class="anchored" data-anchor-id="filtrado-asociación-5"><span class="header-section-number">3.6.3</span> Filtrado (Asociación)</h3>
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>performance_svm_asociacion <span class="ot">&lt;-</span> <span class="fu">evaluate_with_seeds_SVM_TodasVariables_Asociacion</span>(</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">evaluation_function =</span> double_cross_validation_svm,</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_factor,</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">outer =</span> <span class="dv">5</span>,</span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">inner =</span> <span class="dv">2</span>,</span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">target_var =</span> <span class="st">"PCR"</span>,</span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">kernels =</span> <span class="fu">c</span>(<span class="st">"linear"</span>, <span class="st">"poly"</span>),</span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">costs =</span> <span class="fu">c</span>(<span class="dv">50</span>, <span class="dv">100</span>, <span class="dv">200</span>),</span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">vars =</span> asociacion,</span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">threshold =</span> .<span class="dv">35</span>,</span>
<span id="cb68-11"><a href="#cb68-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">seeds =</span> seeds</span>
<span id="cb68-12"><a href="#cb68-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"RData_Files_Algorithms/SVM_Asociacion.RData"</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="wrapped-stepauc-5" class="level3" data-number="3.6.4">
<h3 data-number="3.6.4" class="anchored" data-anchor-id="wrapped-stepauc-5"><span class="header-section-number">3.6.4</span> Wrapped (StepAUC)</h3>
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>double_cross_validation_svm_stepAUC <span class="ot">&lt;-</span> <span class="cf">function</span>(data, target_name, outer, inner, kernels, costs, variables, threshold, seed) {</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(seed)</span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>  performance_metrics <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Fold =</span> <span class="fu">integer</span>(), <span class="at">TP =</span> <span class="fu">integer</span>(), <span class="at">TN =</span> <span class="fu">integer</span>(),</span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">FP =</span> <span class="fu">integer</span>(), <span class="at">FN =</span> <span class="fu">integer</span>(), <span class="at">AUC =</span> <span class="fu">numeric</span>(),</span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">Best_Kernel =</span> <span class="fu">character</span>(), <span class="at">Best_Cost =</span> <span class="fu">numeric</span>(), <span class="at">Best_Variables =</span> <span class="fu">character</span>(), <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a>  inner_fold_metrics <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Fold =</span> <span class="fu">integer</span>(), <span class="at">Inner_Fold =</span> <span class="fu">integer</span>(), </span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">TP =</span> <span class="fu">integer</span>(), <span class="at">TN =</span> <span class="fu">integer</span>(), <span class="at">FP =</span> <span class="fu">integer</span>(), </span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">FN =</span> <span class="fu">integer</span>(), <span class="at">AUC =</span> <span class="fu">numeric</span>(), <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb70-10"><a href="#cb70-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb70-11"><a href="#cb70-11" aria-hidden="true" tabindex="-1"></a>  data[[target_name]] <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(data[[target_name]])</span>
<span id="cb70-12"><a href="#cb70-12" aria-hidden="true" tabindex="-1"></a>  outer_folds <span class="ot">&lt;-</span> <span class="fu">createFolds</span>(data[[target_name]], <span class="at">k =</span> outer, <span class="at">list =</span> <span class="cn">TRUE</span>, <span class="at">returnTrain =</span> <span class="cn">FALSE</span>)</span>
<span id="cb70-13"><a href="#cb70-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb70-14"><a href="#cb70-14" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (outer_index <span class="cf">in</span> <span class="fu">seq_along</span>(outer_folds)) {</span>
<span id="cb70-15"><a href="#cb70-15" aria-hidden="true" tabindex="-1"></a>    outer_train_data <span class="ot">&lt;-</span> data[<span class="sc">-</span>outer_folds[[outer_index]], ]</span>
<span id="cb70-16"><a href="#cb70-16" aria-hidden="true" tabindex="-1"></a>    outer_test_data <span class="ot">&lt;-</span> data[outer_folds[[outer_index]], ]</span>
<span id="cb70-17"><a href="#cb70-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb70-18"><a href="#cb70-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Outer Fold %d</span><span class="sc">\n</span><span class="st">"</span>, outer_index))</span>
<span id="cb70-19"><a href="#cb70-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Training Data - Class 0: "</span>, <span class="fu">sum</span>(outer_train_data[[target_name]] <span class="sc">==</span> <span class="dv">0</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb70-20"><a href="#cb70-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Training Data - Class 1: "</span>, <span class="fu">sum</span>(outer_train_data[[target_name]] <span class="sc">==</span> <span class="dv">1</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb70-21"><a href="#cb70-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Training Data - Total: "</span>, <span class="fu">nrow</span>(outer_train_data), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb70-22"><a href="#cb70-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Testing Data - Class 0: "</span>, <span class="fu">sum</span>(outer_test_data[[target_name]] <span class="sc">==</span> <span class="dv">0</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb70-23"><a href="#cb70-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Testing Data - Class 1: "</span>, <span class="fu">sum</span>(outer_test_data[[target_name]] <span class="sc">==</span> <span class="dv">1</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb70-24"><a href="#cb70-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Testing Data - Total: "</span>, <span class="fu">nrow</span>(outer_test_data), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb70-25"><a href="#cb70-25" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb70-26"><a href="#cb70-26" aria-hidden="true" tabindex="-1"></a>    inner_folds <span class="ot">&lt;-</span> <span class="fu">createFolds</span>(outer_train_data[[target_name]], <span class="at">k =</span> inner, <span class="at">list =</span> <span class="cn">TRUE</span>, <span class="at">returnTrain =</span> <span class="cn">FALSE</span>)</span>
<span id="cb70-27"><a href="#cb70-27" aria-hidden="true" tabindex="-1"></a>    best_model <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb70-28"><a href="#cb70-28" aria-hidden="true" tabindex="-1"></a>    best_auc <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb70-29"><a href="#cb70-29" aria-hidden="true" tabindex="-1"></a>    best_kernel <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb70-30"><a href="#cb70-30" aria-hidden="true" tabindex="-1"></a>    best_cost <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb70-31"><a href="#cb70-31" aria-hidden="true" tabindex="-1"></a>    best_vars <span class="ot">&lt;-</span> variables</span>
<span id="cb70-32"><a href="#cb70-32" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb70-33"><a href="#cb70-33" aria-hidden="true" tabindex="-1"></a>    grid <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">kernel =</span> kernels, <span class="at">cost =</span> costs)</span>
<span id="cb70-34"><a href="#cb70-34" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb70-35"><a href="#cb70-35" aria-hidden="true" tabindex="-1"></a>    stepAUC <span class="ot">&lt;-</span> <span class="cf">function</span>(vars, outer_train_data, target_name, grid, inner_folds) {</span>
<span id="cb70-36"><a href="#cb70-36" aria-hidden="true" tabindex="-1"></a>      current_vars <span class="ot">&lt;-</span> vars</span>
<span id="cb70-37"><a href="#cb70-37" aria-hidden="true" tabindex="-1"></a>      best_inner_auc <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb70-38"><a href="#cb70-38" aria-hidden="true" tabindex="-1"></a>      best_inner_model <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb70-39"><a href="#cb70-39" aria-hidden="true" tabindex="-1"></a>      best_inner_kernel <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb70-40"><a href="#cb70-40" aria-hidden="true" tabindex="-1"></a>      best_inner_cost <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb70-41"><a href="#cb70-41" aria-hidden="true" tabindex="-1"></a>      best_inner_vars <span class="ot">&lt;-</span> current_vars</span>
<span id="cb70-42"><a href="#cb70-42" aria-hidden="true" tabindex="-1"></a>      improved <span class="ot">&lt;-</span> <span class="cn">TRUE</span></span>
<span id="cb70-43"><a href="#cb70-43" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb70-44"><a href="#cb70-44" aria-hidden="true" tabindex="-1"></a>      <span class="cf">while</span> (improved <span class="sc">&amp;&amp;</span> <span class="fu">length</span>(current_vars) <span class="sc">&gt;</span> <span class="dv">1</span>) {</span>
<span id="cb70-45"><a href="#cb70-45" aria-hidden="true" tabindex="-1"></a>        improved <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb70-46"><a href="#cb70-46" aria-hidden="true" tabindex="-1"></a>        best_auc_in_step <span class="ot">&lt;-</span> best_inner_auc</span>
<span id="cb70-47"><a href="#cb70-47" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb70-48"><a href="#cb70-48" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (var <span class="cf">in</span> current_vars) {</span>
<span id="cb70-49"><a href="#cb70-49" aria-hidden="true" tabindex="-1"></a>          temp_vars <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(current_vars, var)</span>
<span id="cb70-50"><a href="#cb70-50" aria-hidden="true" tabindex="-1"></a>          inner_auc <span class="ot">&lt;-</span> <span class="fu">numeric</span>()</span>
<span id="cb70-51"><a href="#cb70-51" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb70-52"><a href="#cb70-52" aria-hidden="true" tabindex="-1"></a>          <span class="cf">for</span> (params <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(grid)) {</span>
<span id="cb70-53"><a href="#cb70-53" aria-hidden="true" tabindex="-1"></a>            auc_vals <span class="ot">&lt;-</span> <span class="fu">numeric</span>()</span>
<span id="cb70-54"><a href="#cb70-54" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb70-55"><a href="#cb70-55" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> (inner_index <span class="cf">in</span> <span class="fu">seq_along</span>(inner_folds)) {</span>
<span id="cb70-56"><a href="#cb70-56" aria-hidden="true" tabindex="-1"></a>              inner_train_data <span class="ot">&lt;-</span> outer_train_data[<span class="sc">-</span>inner_folds[[inner_index]], ]</span>
<span id="cb70-57"><a href="#cb70-57" aria-hidden="true" tabindex="-1"></a>              inner_test_data <span class="ot">&lt;-</span> outer_train_data[inner_folds[[inner_index]], ]</span>
<span id="cb70-58"><a href="#cb70-58" aria-hidden="true" tabindex="-1"></a>              </span>
<span id="cb70-59"><a href="#cb70-59" aria-hidden="true" tabindex="-1"></a>              result <span class="ot">&lt;-</span> <span class="fu">tryCatch</span>({</span>
<span id="cb70-60"><a href="#cb70-60" aria-hidden="true" tabindex="-1"></a>                model <span class="ot">&lt;-</span> <span class="fu">svm</span>(<span class="fu">as.formula</span>(<span class="fu">paste</span>(target_name, <span class="st">"~"</span>, <span class="fu">paste</span>(temp_vars, <span class="at">collapse =</span> <span class="st">"+"</span>))),</span>
<span id="cb70-61"><a href="#cb70-61" aria-hidden="true" tabindex="-1"></a>                             <span class="at">data =</span> inner_train_data, <span class="at">kernel =</span> grid<span class="sc">$</span>kernel[params], <span class="at">cost =</span> grid<span class="sc">$</span>cost[params], </span>
<span id="cb70-62"><a href="#cb70-62" aria-hidden="true" tabindex="-1"></a>                             <span class="at">probability =</span> <span class="cn">TRUE</span>)</span>
<span id="cb70-63"><a href="#cb70-63" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb70-64"><a href="#cb70-64" aria-hidden="true" tabindex="-1"></a>                predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(model, <span class="at">newdata =</span> inner_test_data, <span class="at">probability =</span> <span class="cn">TRUE</span>)</span>
<span id="cb70-65"><a href="#cb70-65" aria-hidden="true" tabindex="-1"></a>                predictions <span class="ot">&lt;-</span> <span class="fu">attr</span>(predictions, <span class="st">"probabilities"</span>)[, <span class="dv">2</span>]</span>
<span id="cb70-66"><a href="#cb70-66" aria-hidden="true" tabindex="-1"></a>                roc_curve <span class="ot">&lt;-</span> <span class="fu">roc</span>(inner_test_data[[target_name]], predictions)</span>
<span id="cb70-67"><a href="#cb70-67" aria-hidden="true" tabindex="-1"></a>                auc_vals[inner_index] <span class="ot">&lt;-</span> roc_curve<span class="sc">$</span>auc</span>
<span id="cb70-68"><a href="#cb70-68" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb70-69"><a href="#cb70-69" aria-hidden="true" tabindex="-1"></a>              }, <span class="at">error =</span> <span class="cf">function</span>(e) {</span>
<span id="cb70-70"><a href="#cb70-70" aria-hidden="true" tabindex="-1"></a>                <span class="fu">cat</span>(<span class="st">"Error with variables:"</span>, <span class="fu">paste</span>(temp_vars, <span class="at">collapse =</span> <span class="st">", "</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb70-71"><a href="#cb70-71" aria-hidden="true" tabindex="-1"></a>                <span class="fu">cat</span>(<span class="st">"Error message: "</span>, e<span class="sc">$</span>message, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb70-72"><a href="#cb70-72" aria-hidden="true" tabindex="-1"></a>                auc_vals[inner_index] <span class="ot">&lt;-</span> <span class="dv">0</span>  <span class="co"># Set to NA or some other indicator of failure</span></span>
<span id="cb70-73"><a href="#cb70-73" aria-hidden="true" tabindex="-1"></a>              })</span>
<span id="cb70-74"><a href="#cb70-74" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb70-75"><a href="#cb70-75" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb70-76"><a href="#cb70-76" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> (<span class="fu">mean</span>(auc_vals, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">&gt;</span> best_auc_in_step) {</span>
<span id="cb70-77"><a href="#cb70-77" aria-hidden="true" tabindex="-1"></a>              best_auc_in_step <span class="ot">&lt;-</span> <span class="fu">mean</span>(auc_vals, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb70-78"><a href="#cb70-78" aria-hidden="true" tabindex="-1"></a>              best_inner_model <span class="ot">&lt;-</span> model</span>
<span id="cb70-79"><a href="#cb70-79" aria-hidden="true" tabindex="-1"></a>              best_inner_kernel <span class="ot">&lt;-</span> grid<span class="sc">$</span>kernel[params]</span>
<span id="cb70-80"><a href="#cb70-80" aria-hidden="true" tabindex="-1"></a>              best_inner_cost <span class="ot">&lt;-</span> grid<span class="sc">$</span>cost[params]</span>
<span id="cb70-81"><a href="#cb70-81" aria-hidden="true" tabindex="-1"></a>              best_inner_vars <span class="ot">&lt;-</span> temp_vars</span>
<span id="cb70-82"><a href="#cb70-82" aria-hidden="true" tabindex="-1"></a>              improved <span class="ot">&lt;-</span> <span class="cn">TRUE</span></span>
<span id="cb70-83"><a href="#cb70-83" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb70-84"><a href="#cb70-84" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb70-85"><a href="#cb70-85" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb70-86"><a href="#cb70-86" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb70-87"><a href="#cb70-87" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (improved) {</span>
<span id="cb70-88"><a href="#cb70-88" aria-hidden="true" tabindex="-1"></a>          current_vars <span class="ot">&lt;-</span> best_inner_vars</span>
<span id="cb70-89"><a href="#cb70-89" aria-hidden="true" tabindex="-1"></a>          best_inner_auc <span class="ot">&lt;-</span> best_auc_in_step</span>
<span id="cb70-90"><a href="#cb70-90" aria-hidden="true" tabindex="-1"></a>          <span class="fu">cat</span>(<span class="st">"Vars improved: "</span>, <span class="fu">paste</span>(current_vars, <span class="at">collapse=</span><span class="st">", "</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb70-91"><a href="#cb70-91" aria-hidden="true" tabindex="-1"></a>          <span class="fu">cat</span>(<span class="st">"AUC: "</span>, <span class="fu">paste</span>(best_inner_auc), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb70-92"><a href="#cb70-92" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb70-93"><a href="#cb70-93" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb70-94"><a href="#cb70-94" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb70-95"><a href="#cb70-95" aria-hidden="true" tabindex="-1"></a>      <span class="fu">list</span>(<span class="at">model =</span> best_inner_model, <span class="at">auc =</span> best_inner_auc, </span>
<span id="cb70-96"><a href="#cb70-96" aria-hidden="true" tabindex="-1"></a>           <span class="at">kernel =</span> best_inner_kernel, <span class="at">cost =</span> best_inner_cost, </span>
<span id="cb70-97"><a href="#cb70-97" aria-hidden="true" tabindex="-1"></a>           <span class="at">vars =</span> best_inner_vars)</span>
<span id="cb70-98"><a href="#cb70-98" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb70-99"><a href="#cb70-99" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb70-100"><a href="#cb70-100" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb70-101"><a href="#cb70-101" aria-hidden="true" tabindex="-1"></a>    best_result <span class="ot">&lt;-</span> <span class="fu">stepAUC</span>(variables, outer_train_data, target_name, grid, inner_folds)</span>
<span id="cb70-102"><a href="#cb70-102" aria-hidden="true" tabindex="-1"></a>    best_model <span class="ot">&lt;-</span> best_result<span class="sc">$</span>model</span>
<span id="cb70-103"><a href="#cb70-103" aria-hidden="true" tabindex="-1"></a>    best_auc <span class="ot">&lt;-</span> best_result<span class="sc">$</span>auc</span>
<span id="cb70-104"><a href="#cb70-104" aria-hidden="true" tabindex="-1"></a>    best_kernel <span class="ot">&lt;-</span> best_result<span class="sc">$</span>kernel</span>
<span id="cb70-105"><a href="#cb70-105" aria-hidden="true" tabindex="-1"></a>    best_cost <span class="ot">&lt;-</span> best_result<span class="sc">$</span>cost</span>
<span id="cb70-106"><a href="#cb70-106" aria-hidden="true" tabindex="-1"></a>    best_vars <span class="ot">&lt;-</span> best_result<span class="sc">$</span>vars</span>
<span id="cb70-107"><a href="#cb70-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-108"><a href="#cb70-108" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Evaluar el mejor modelo en el validation split del inner loop </span></span>
<span id="cb70-109"><a href="#cb70-109" aria-hidden="true" tabindex="-1"></a>    inner_auc_vals <span class="ot">&lt;-</span> <span class="fu">numeric</span>()</span>
<span id="cb70-110"><a href="#cb70-110" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (inner_index <span class="cf">in</span> <span class="fu">seq_along</span>(inner_folds)) {</span>
<span id="cb70-111"><a href="#cb70-111" aria-hidden="true" tabindex="-1"></a>      inner_train_data <span class="ot">&lt;-</span> outer_train_data[<span class="sc">-</span>inner_folds[[inner_index]], ]</span>
<span id="cb70-112"><a href="#cb70-112" aria-hidden="true" tabindex="-1"></a>      inner_test_data <span class="ot">&lt;-</span> outer_train_data[inner_folds[[inner_index]], ]</span>
<span id="cb70-113"><a href="#cb70-113" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb70-114"><a href="#cb70-114" aria-hidden="true" tabindex="-1"></a>      predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(best_model, <span class="at">newdata =</span> inner_test_data, <span class="at">probability =</span> <span class="cn">TRUE</span>)</span>
<span id="cb70-115"><a href="#cb70-115" aria-hidden="true" tabindex="-1"></a>      predictions <span class="ot">&lt;-</span> <span class="fu">attr</span>(predictions, <span class="st">"probabilities"</span>)[, <span class="dv">2</span>]</span>
<span id="cb70-116"><a href="#cb70-116" aria-hidden="true" tabindex="-1"></a>      roc_curve <span class="ot">&lt;-</span> <span class="fu">roc</span>(inner_test_data[[target_name]], predictions)</span>
<span id="cb70-117"><a href="#cb70-117" aria-hidden="true" tabindex="-1"></a>      inner_auc_vals[inner_index] <span class="ot">&lt;-</span> roc_curve<span class="sc">$</span>auc</span>
<span id="cb70-118"><a href="#cb70-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-119"><a href="#cb70-119" aria-hidden="true" tabindex="-1"></a>      pred_class <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(predictions <span class="sc">&gt;</span> threshold, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb70-120"><a href="#cb70-120" aria-hidden="true" tabindex="-1"></a>      confusion <span class="ot">&lt;-</span> <span class="fu">table</span>(<span class="at">Actual =</span> inner_test_data[[target_name]], <span class="at">Predicted =</span> pred_class)</span>
<span id="cb70-121"><a href="#cb70-121" aria-hidden="true" tabindex="-1"></a>      TP <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span>, confusion[<span class="dv">2</span>, <span class="dv">2</span>], <span class="dv">0</span>)</span>
<span id="cb70-122"><a href="#cb70-122" aria-hidden="true" tabindex="-1"></a>      TN <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span>, confusion[<span class="dv">1</span>, <span class="dv">1</span>], <span class="dv">0</span>)</span>
<span id="cb70-123"><a href="#cb70-123" aria-hidden="true" tabindex="-1"></a>      FP <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span>, confusion[<span class="dv">1</span>, <span class="dv">2</span>], <span class="dv">0</span>)</span>
<span id="cb70-124"><a href="#cb70-124" aria-hidden="true" tabindex="-1"></a>      FN <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span>, confusion[<span class="dv">2</span>, <span class="dv">1</span>], <span class="dv">0</span>)</span>
<span id="cb70-125"><a href="#cb70-125" aria-hidden="true" tabindex="-1"></a>      auc <span class="ot">&lt;-</span> roc_curve<span class="sc">$</span>auc</span>
<span id="cb70-126"><a href="#cb70-126" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb70-127"><a href="#cb70-127" aria-hidden="true" tabindex="-1"></a>      inner_metrics <span class="ot">&lt;-</span> <span class="fu">setNames</span>(<span class="fu">c</span>(outer_index, inner_index, TP, TN, FP, FN, auc), <span class="fu">names</span>(inner_fold_metrics))</span>
<span id="cb70-128"><a href="#cb70-128" aria-hidden="true" tabindex="-1"></a>      inner_fold_metrics <span class="ot">&lt;-</span> <span class="fu">rbind</span>(inner_fold_metrics, <span class="fu">as.data.frame</span>(<span class="fu">t</span>(inner_metrics)))</span>
<span id="cb70-129"><a href="#cb70-129" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb70-130"><a href="#cb70-130" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb70-131"><a href="#cb70-131" aria-hidden="true" tabindex="-1"></a>    best_inner_auc <span class="ot">&lt;-</span> <span class="fu">mean</span>(inner_auc_vals, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb70-132"><a href="#cb70-132" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Reentrenar el mejor modelo con todos los datos de outer_train_data</span></span>
<span id="cb70-133"><a href="#cb70-133" aria-hidden="true" tabindex="-1"></a>    best_model <span class="ot">&lt;-</span> <span class="fu">svm</span>(<span class="fu">as.formula</span>(<span class="fu">paste</span>(target_name, <span class="st">"~"</span>, <span class="fu">paste</span>(best_vars, <span class="at">collapse =</span> <span class="st">"+"</span>))),</span>
<span id="cb70-134"><a href="#cb70-134" aria-hidden="true" tabindex="-1"></a>                      <span class="at">data =</span> outer_train_data, <span class="at">kernel =</span> best_kernel, <span class="at">cost =</span> best_cost, </span>
<span id="cb70-135"><a href="#cb70-135" aria-hidden="true" tabindex="-1"></a>                      <span class="at">probability =</span> <span class="cn">TRUE</span>)</span>
<span id="cb70-136"><a href="#cb70-136" aria-hidden="true" tabindex="-1"></a>    predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(best_model, <span class="at">newdata =</span> outer_test_data, <span class="at">probability =</span> <span class="cn">TRUE</span>)</span>
<span id="cb70-137"><a href="#cb70-137" aria-hidden="true" tabindex="-1"></a>    predictions <span class="ot">&lt;-</span> <span class="fu">attr</span>(predictions, <span class="st">"probabilities"</span>)[, <span class="dv">2</span>]</span>
<span id="cb70-138"><a href="#cb70-138" aria-hidden="true" tabindex="-1"></a>    pred_class <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(predictions <span class="sc">&gt;</span> threshold, <span class="dv">1</span>, <span class="dv">0</span>)  <span class="co"># Asignar clases basadas en umbral</span></span>
<span id="cb70-139"><a href="#cb70-139" aria-hidden="true" tabindex="-1"></a>    confusion <span class="ot">&lt;-</span> <span class="fu">table</span>(<span class="at">Actual =</span> outer_test_data[[target_name]], <span class="at">Predicted =</span> pred_class)</span>
<span id="cb70-140"><a href="#cb70-140" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb70-141"><a href="#cb70-141" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">nrow</span>(confusion) <span class="sc">&lt;</span> <span class="dv">2</span> <span class="sc">||</span> <span class="fu">ncol</span>(confusion) <span class="sc">&lt;</span> <span class="dv">2</span>) {</span>
<span id="cb70-142"><a href="#cb70-142" aria-hidden="true" tabindex="-1"></a>      TP <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span>, confusion[<span class="dv">2</span>, <span class="dv">2</span>], <span class="dv">0</span>)</span>
<span id="cb70-143"><a href="#cb70-143" aria-hidden="true" tabindex="-1"></a>      TN <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span>, confusion[<span class="dv">1</span>, <span class="dv">1</span>], <span class="dv">0</span>)</span>
<span id="cb70-144"><a href="#cb70-144" aria-hidden="true" tabindex="-1"></a>      FP <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span>, confusion[<span class="dv">1</span>, <span class="dv">2</span>], <span class="dv">0</span>)</span>
<span id="cb70-145"><a href="#cb70-145" aria-hidden="true" tabindex="-1"></a>      FN <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span>, confusion[<span class="dv">2</span>, <span class="dv">1</span>], <span class="dv">0</span>)</span>
<span id="cb70-146"><a href="#cb70-146" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb70-147"><a href="#cb70-147" aria-hidden="true" tabindex="-1"></a>      TP <span class="ot">&lt;-</span> confusion[<span class="dv">2</span>, <span class="dv">2</span>]</span>
<span id="cb70-148"><a href="#cb70-148" aria-hidden="true" tabindex="-1"></a>      TN <span class="ot">&lt;-</span> confusion[<span class="dv">1</span>, <span class="dv">1</span>]</span>
<span id="cb70-149"><a href="#cb70-149" aria-hidden="true" tabindex="-1"></a>      FP <span class="ot">&lt;-</span> confusion[<span class="dv">1</span>, <span class="dv">2</span>]</span>
<span id="cb70-150"><a href="#cb70-150" aria-hidden="true" tabindex="-1"></a>      FN <span class="ot">&lt;-</span> confusion[<span class="dv">2</span>, <span class="dv">1</span>]</span>
<span id="cb70-151"><a href="#cb70-151" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb70-152"><a href="#cb70-152" aria-hidden="true" tabindex="-1"></a>    auc <span class="ot">&lt;-</span> <span class="fu">roc</span>(outer_test_data[[target_name]], predictions)<span class="sc">$</span>auc</span>
<span id="cb70-153"><a href="#cb70-153" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb70-154"><a href="#cb70-154" aria-hidden="true" tabindex="-1"></a>    metrics <span class="ot">&lt;-</span> <span class="fu">setNames</span>(<span class="fu">c</span>(outer_index, TP, TN, FP, FN, auc, </span>
<span id="cb70-155"><a href="#cb70-155" aria-hidden="true" tabindex="-1"></a>                          best_kernel, best_cost, <span class="fu">paste</span>(best_vars, <span class="at">collapse =</span> <span class="st">","</span>)), </span>
<span id="cb70-156"><a href="#cb70-156" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">names</span>(performance_metrics))</span>
<span id="cb70-157"><a href="#cb70-157" aria-hidden="true" tabindex="-1"></a>    performance_metrics <span class="ot">&lt;-</span> <span class="fu">rbind</span>(performance_metrics, <span class="fu">as.data.frame</span>(<span class="fu">t</span>(metrics)))</span>
<span id="cb70-158"><a href="#cb70-158" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb70-159"><a href="#cb70-159" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Performance:"</span>, <span class="fu">paste</span>(performance_metrics))</span>
<span id="cb70-160"><a href="#cb70-160" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Confusion Matrix for Fold %d:</span><span class="sc">\n</span><span class="st">"</span>, outer_index))</span>
<span id="cb70-161"><a href="#cb70-161" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(confusion)</span>
<span id="cb70-162"><a href="#cb70-162" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Metrics for Fold %d:</span><span class="sc">\n</span><span class="st">"</span>, outer_index))</span>
<span id="cb70-163"><a href="#cb70-163" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"TP: %d, TN: %d, FP: %d, FN: %d, AUC: %f, Best Kernel: %s, Best Cost: %f, Best Variables: %s</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb70-164"><a href="#cb70-164" aria-hidden="true" tabindex="-1"></a>                TP, TN, FP, FN, auc, best_kernel, best_cost, <span class="fu">paste</span>(best_vars, <span class="at">collapse =</span> <span class="st">","</span>)))</span>
<span id="cb70-165"><a href="#cb70-165" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb70-166"><a href="#cb70-166" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb70-167"><a href="#cb70-167" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="at">performance_metrics =</span> performance_metrics, <span class="at">inner_fold_metrics =</span> inner_fold_metrics)</span>
<span id="cb70-168"><a href="#cb70-168" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb70-169"><a href="#cb70-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-170"><a href="#cb70-170" aria-hidden="true" tabindex="-1"></a>evaluate_with_seeds_SVM_stepAUC <span class="ot">&lt;-</span> </span>
<span id="cb70-171"><a href="#cb70-171" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(evaluation_function, data, target_var, vars, threshold, seeds, outer, inner, kernels, costs) {</span>
<span id="cb70-172"><a href="#cb70-172" aria-hidden="true" tabindex="-1"></a>  results_list <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb70-173"><a href="#cb70-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-174"><a href="#cb70-174" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (seed <span class="cf">in</span> seeds) {</span>
<span id="cb70-175"><a href="#cb70-175" aria-hidden="true" tabindex="-1"></a>    <span class="fu">set.seed</span>(seed)</span>
<span id="cb70-176"><a href="#cb70-176" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Evaluating with seed:"</span>, seed, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb70-177"><a href="#cb70-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-178"><a href="#cb70-178" aria-hidden="true" tabindex="-1"></a>    results <span class="ot">&lt;-</span> <span class="fu">evaluation_function</span>(<span class="at">data =</span> data, </span>
<span id="cb70-179"><a href="#cb70-179" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">target_name =</span> target_var, </span>
<span id="cb70-180"><a href="#cb70-180" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">variables =</span> vars, </span>
<span id="cb70-181"><a href="#cb70-181" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">threshold =</span> threshold, </span>
<span id="cb70-182"><a href="#cb70-182" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">outer =</span> outer, </span>
<span id="cb70-183"><a href="#cb70-183" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">inner =</span> inner, </span>
<span id="cb70-184"><a href="#cb70-184" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">seed =</span> seed,</span>
<span id="cb70-185"><a href="#cb70-185" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">kernels =</span> kernels,</span>
<span id="cb70-186"><a href="#cb70-186" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">costs =</span> costs)</span>
<span id="cb70-187"><a href="#cb70-187" aria-hidden="true" tabindex="-1"></a>    results_list[[<span class="fu">paste0</span>(<span class="st">"seed_"</span>, seed)]] <span class="ot">&lt;-</span> results</span>
<span id="cb70-188"><a href="#cb70-188" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb70-189"><a href="#cb70-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-190"><a href="#cb70-190" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(results_list)</span>
<span id="cb70-191"><a href="#cb70-191" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb70-192"><a href="#cb70-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-193"><a href="#cb70-193" aria-hidden="true" tabindex="-1"></a>performance_SVM_stepauc <span class="ot">&lt;-</span> <span class="fu">evaluate_with_seeds_SVM_stepAUC</span>(</span>
<span id="cb70-194"><a href="#cb70-194" aria-hidden="true" tabindex="-1"></a>  <span class="at">evaluation_function =</span> double_cross_validation_svm_stepAUC,</span>
<span id="cb70-195"><a href="#cb70-195" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_numeric,</span>
<span id="cb70-196"><a href="#cb70-196" aria-hidden="true" tabindex="-1"></a>  <span class="at">outer =</span> <span class="dv">5</span>,</span>
<span id="cb70-197"><a href="#cb70-197" aria-hidden="true" tabindex="-1"></a>  <span class="at">inner =</span> <span class="dv">2</span>,</span>
<span id="cb70-198"><a href="#cb70-198" aria-hidden="true" tabindex="-1"></a>  <span class="at">target_var =</span> <span class="st">"PCR"</span>,</span>
<span id="cb70-199"><a href="#cb70-199" aria-hidden="true" tabindex="-1"></a>  <span class="at">kernels =</span> <span class="fu">c</span>(<span class="st">"linear"</span>, <span class="st">"poly"</span>),</span>
<span id="cb70-200"><a href="#cb70-200" aria-hidden="true" tabindex="-1"></a>  <span class="at">costs =</span> <span class="fu">c</span>(<span class="dv">50</span>, <span class="dv">100</span>, <span class="dv">200</span>),</span>
<span id="cb70-201"><a href="#cb70-201" aria-hidden="true" tabindex="-1"></a>  <span class="at">vars =</span> todas_variables_numeric,</span>
<span id="cb70-202"><a href="#cb70-202" aria-hidden="true" tabindex="-1"></a>  <span class="at">threshold =</span> .<span class="dv">35</span>,</span>
<span id="cb70-203"><a href="#cb70-203" aria-hidden="true" tabindex="-1"></a>  <span class="at">seeds =</span> seeds</span>
<span id="cb70-204"><a href="#cb70-204" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"RData_Files_Algorithms/SVM_StepAUC.RData"</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="embedded-lasso-5" class="level3" data-number="3.6.5">
<h3 data-number="3.6.5" class="anchored" data-anchor-id="embedded-lasso-5"><span class="header-section-number">3.6.5</span> Embedded (Lasso)</h3>
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>double_cross_validation_svm_lasso <span class="ot">&lt;-</span> <span class="cf">function</span>(data, target_name, outer, inner, kernels, costs, variables, threshold, seed) {</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(seed)</span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>  performance_metrics <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Fold =</span> <span class="fu">integer</span>(), <span class="at">TP =</span> <span class="fu">integer</span>(), <span class="at">TN =</span> <span class="fu">integer</span>(),</span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">FP =</span> <span class="fu">integer</span>(), <span class="at">FN =</span> <span class="fu">integer</span>(), <span class="at">AUC =</span> <span class="fu">numeric</span>(),</span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">Best_Kernel =</span> <span class="fu">character</span>(), <span class="at">Best_Cost =</span> <span class="fu">numeric</span>(),</span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">Best_Variables =</span> <span class="fu">character</span>(), <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a>  inner_fold_metrics <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Fold =</span> <span class="fu">integer</span>(), <span class="at">Inner_Fold =</span> <span class="fu">integer</span>(), </span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">TP =</span> <span class="fu">integer</span>(), <span class="at">TN =</span> <span class="fu">integer</span>(), <span class="at">FP =</span> <span class="fu">integer</span>(), </span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">FN =</span> <span class="fu">integer</span>(), <span class="at">AUC =</span> <span class="fu">numeric</span>(), <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb72-11"><a href="#cb72-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb72-12"><a href="#cb72-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Convertir las variables del dataset con model.matrix</span></span>
<span id="cb72-13"><a href="#cb72-13" aria-hidden="true" tabindex="-1"></a>  target <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(data[[target_name]])  <span class="co"># Aseguramos que la variable de respuesta sea factor</span></span>
<span id="cb72-14"><a href="#cb72-14" aria-hidden="true" tabindex="-1"></a>  features <span class="ot">&lt;-</span> data[, <span class="fu">setdiff</span>(<span class="fu">names</span>(data), target_name)]</span>
<span id="cb72-15"><a href="#cb72-15" aria-hidden="true" tabindex="-1"></a>  data_matrix <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">model.matrix</span>(<span class="sc">~</span> ., <span class="at">data=</span>features)[,<span class="sc">-</span><span class="dv">1</span>])  <span class="co"># Eliminar el intercepto</span></span>
<span id="cb72-16"><a href="#cb72-16" aria-hidden="true" tabindex="-1"></a>  data_matrix[[target_name]] <span class="ot">&lt;-</span> target</span>
<span id="cb72-17"><a href="#cb72-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb72-18"><a href="#cb72-18" aria-hidden="true" tabindex="-1"></a>  outer_folds <span class="ot">&lt;-</span> <span class="fu">createFolds</span>(data_matrix[[target_name]], <span class="at">k =</span> outer)</span>
<span id="cb72-19"><a href="#cb72-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb72-20"><a href="#cb72-20" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (outer_index <span class="cf">in</span> <span class="fu">seq_along</span>(outer_folds)) {</span>
<span id="cb72-21"><a href="#cb72-21" aria-hidden="true" tabindex="-1"></a>    outer_train_data <span class="ot">&lt;-</span> data_matrix[<span class="sc">-</span>outer_folds[[outer_index]], ]</span>
<span id="cb72-22"><a href="#cb72-22" aria-hidden="true" tabindex="-1"></a>    outer_test_data <span class="ot">&lt;-</span> data_matrix[outer_folds[[outer_index]], ]</span>
<span id="cb72-23"><a href="#cb72-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb72-24"><a href="#cb72-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Outer Fold %d</span><span class="sc">\n</span><span class="st">"</span>, outer_index))</span>
<span id="cb72-25"><a href="#cb72-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Training Data - Class 0: "</span>, <span class="fu">sum</span>(outer_train_data[[target_name]] <span class="sc">==</span> <span class="dv">0</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb72-26"><a href="#cb72-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Training Data - Class 1: "</span>, <span class="fu">sum</span>(outer_train_data[[target_name]] <span class="sc">==</span> <span class="dv">1</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb72-27"><a href="#cb72-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Testing Data - Class 0: "</span>, <span class="fu">sum</span>(outer_test_data[[target_name]] <span class="sc">==</span> <span class="dv">0</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb72-28"><a href="#cb72-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Testing Data - Class 1: "</span>, <span class="fu">sum</span>(outer_test_data[[target_name]] <span class="sc">==</span> <span class="dv">1</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb72-29"><a href="#cb72-29" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb72-30"><a href="#cb72-30" aria-hidden="true" tabindex="-1"></a>    inner_folds <span class="ot">&lt;-</span> <span class="fu">createFolds</span>(outer_train_data[[target_name]], <span class="at">k =</span> inner)</span>
<span id="cb72-31"><a href="#cb72-31" aria-hidden="true" tabindex="-1"></a>    best_model <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb72-32"><a href="#cb72-32" aria-hidden="true" tabindex="-1"></a>    best_auc <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb72-33"><a href="#cb72-33" aria-hidden="true" tabindex="-1"></a>    best_kernel <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb72-34"><a href="#cb72-34" aria-hidden="true" tabindex="-1"></a>    best_cost <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb72-35"><a href="#cb72-35" aria-hidden="true" tabindex="-1"></a>    best_vars <span class="ot">&lt;-</span> <span class="fu">colnames</span>(outer_train_data)[<span class="sc">!</span><span class="fu">colnames</span>(outer_train_data) <span class="sc">%in%</span> target_name]</span>
<span id="cb72-36"><a href="#cb72-36" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb72-37"><a href="#cb72-37" aria-hidden="true" tabindex="-1"></a>    grid <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">kernel =</span> kernels, <span class="at">cost =</span> costs)</span>
<span id="cb72-38"><a href="#cb72-38" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb72-39"><a href="#cb72-39" aria-hidden="true" tabindex="-1"></a>    select_vars_lasso <span class="ot">&lt;-</span> <span class="cf">function</span>(data, target_name) {</span>
<span id="cb72-40"><a href="#cb72-40" aria-hidden="true" tabindex="-1"></a>      target <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(data[[target_name]]) <span class="sc">-</span> <span class="dv">1</span>  <span class="co"># Convertimos a numérico para Lasso</span></span>
<span id="cb72-41"><a href="#cb72-41" aria-hidden="true" tabindex="-1"></a>      features <span class="ot">&lt;-</span> data[, <span class="fu">setdiff</span>(<span class="fu">names</span>(data), target_name)]</span>
<span id="cb72-42"><a href="#cb72-42" aria-hidden="true" tabindex="-1"></a>      X <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(<span class="sc">~</span> ., <span class="at">data=</span>features)[,<span class="sc">-</span><span class="dv">1</span>]  <span class="co"># Eliminamos el intercepto</span></span>
<span id="cb72-43"><a href="#cb72-43" aria-hidden="true" tabindex="-1"></a>      y <span class="ot">&lt;-</span> target</span>
<span id="cb72-44"><a href="#cb72-44" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb72-45"><a href="#cb72-45" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Ajustamos el modelo Lasso</span></span>
<span id="cb72-46"><a href="#cb72-46" aria-hidden="true" tabindex="-1"></a>      lasso_model <span class="ot">&lt;-</span> <span class="fu">cv.glmnet</span>(X, y, <span class="at">alpha=</span><span class="dv">1</span>)</span>
<span id="cb72-47"><a href="#cb72-47" aria-hidden="true" tabindex="-1"></a>      lasso_coef <span class="ot">&lt;-</span> <span class="fu">coef</span>(lasso_model, <span class="at">s =</span> <span class="st">"lambda.min"</span>)</span>
<span id="cb72-48"><a href="#cb72-48" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb72-49"><a href="#cb72-49" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Seleccionamos las variables no nulas</span></span>
<span id="cb72-50"><a href="#cb72-50" aria-hidden="true" tabindex="-1"></a>      selected_vars <span class="ot">&lt;-</span> <span class="fu">rownames</span>(lasso_coef)[lasso_coef[, <span class="dv">1</span>] <span class="sc">!=</span> <span class="dv">0</span>]</span>
<span id="cb72-51"><a href="#cb72-51" aria-hidden="true" tabindex="-1"></a>      selected_vars <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(selected_vars, <span class="st">"(Intercept)"</span>)</span>
<span id="cb72-52"><a href="#cb72-52" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cat</span>(<span class="st">"Selected variables by Lasso: "</span>, <span class="fu">paste</span>(selected_vars, <span class="at">collapse=</span><span class="st">", "</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb72-53"><a href="#cb72-53" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(selected_vars)</span>
<span id="cb72-54"><a href="#cb72-54" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb72-55"><a href="#cb72-55" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb72-56"><a href="#cb72-56" aria-hidden="true" tabindex="-1"></a>    stepAUC <span class="ot">&lt;-</span> <span class="cf">function</span>(vars, data, target_name, grid, inner_folds) {</span>
<span id="cb72-57"><a href="#cb72-57" aria-hidden="true" tabindex="-1"></a>      best_inner_auc <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb72-58"><a href="#cb72-58" aria-hidden="true" tabindex="-1"></a>      best_inner_model <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb72-59"><a href="#cb72-59" aria-hidden="true" tabindex="-1"></a>      best_inner_kernel <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb72-60"><a href="#cb72-60" aria-hidden="true" tabindex="-1"></a>      best_inner_cost <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb72-61"><a href="#cb72-61" aria-hidden="true" tabindex="-1"></a>      best_inner_vars <span class="ot">&lt;-</span> vars</span>
<span id="cb72-62"><a href="#cb72-62" aria-hidden="true" tabindex="-1"></a>      improved <span class="ot">&lt;-</span> <span class="cn">TRUE</span></span>
<span id="cb72-63"><a href="#cb72-63" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb72-64"><a href="#cb72-64" aria-hidden="true" tabindex="-1"></a>      <span class="cf">while</span> (improved <span class="sc">&amp;&amp;</span> <span class="fu">length</span>(vars) <span class="sc">&gt;</span> <span class="dv">1</span>) {</span>
<span id="cb72-65"><a href="#cb72-65" aria-hidden="true" tabindex="-1"></a>        improved <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb72-66"><a href="#cb72-66" aria-hidden="true" tabindex="-1"></a>        best_auc_in_step <span class="ot">&lt;-</span> best_inner_auc</span>
<span id="cb72-67"><a href="#cb72-67" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb72-68"><a href="#cb72-68" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (params <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(grid)) {</span>
<span id="cb72-69"><a href="#cb72-69" aria-hidden="true" tabindex="-1"></a>          auc_vals <span class="ot">&lt;-</span> <span class="fu">numeric</span>()</span>
<span id="cb72-70"><a href="#cb72-70" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb72-71"><a href="#cb72-71" aria-hidden="true" tabindex="-1"></a>          <span class="cf">for</span> (inner_index <span class="cf">in</span> <span class="fu">seq_along</span>(inner_folds)) {</span>
<span id="cb72-72"><a href="#cb72-72" aria-hidden="true" tabindex="-1"></a>            inner_train_data <span class="ot">&lt;-</span> outer_train_data[<span class="sc">-</span>inner_folds[[inner_index]], ]</span>
<span id="cb72-73"><a href="#cb72-73" aria-hidden="true" tabindex="-1"></a>            inner_test_data <span class="ot">&lt;-</span> outer_train_data[inner_folds[[inner_index]], ]</span>
<span id="cb72-74"><a href="#cb72-74" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb72-75"><a href="#cb72-75" aria-hidden="true" tabindex="-1"></a>            selected_vars <span class="ot">&lt;-</span> <span class="fu">select_vars_lasso</span>(inner_train_data, target_name)</span>
<span id="cb72-76"><a href="#cb72-76" aria-hidden="true" tabindex="-1"></a>            formula <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(<span class="fu">paste</span>(target_name, <span class="st">"~"</span>, <span class="fu">paste</span>(selected_vars, <span class="at">collapse =</span> <span class="st">"+"</span>)))</span>
<span id="cb72-77"><a href="#cb72-77" aria-hidden="true" tabindex="-1"></a>            <span class="fu">cat</span>(<span class="st">"Testing with formula: "</span>, <span class="fu">deparse</span>(formula), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb72-78"><a href="#cb72-78" aria-hidden="true" tabindex="-1"></a>            <span class="fu">cat</span>(<span class="st">"Grid parameters - kernel: "</span>, grid<span class="sc">$</span>kernel[params], <span class="st">", cost: "</span>, grid<span class="sc">$</span>cost[params], <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb72-79"><a href="#cb72-79" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb72-80"><a href="#cb72-80" aria-hidden="true" tabindex="-1"></a>            result <span class="ot">&lt;-</span> <span class="fu">tryCatch</span>({</span>
<span id="cb72-81"><a href="#cb72-81" aria-hidden="true" tabindex="-1"></a>              model <span class="ot">&lt;-</span> <span class="fu">svm</span>(formula, <span class="at">data =</span> inner_train_data, <span class="at">kernel =</span> grid<span class="sc">$</span>kernel[params], <span class="at">cost =</span> grid<span class="sc">$</span>cost[params], <span class="at">probability =</span> <span class="cn">TRUE</span>)</span>
<span id="cb72-82"><a href="#cb72-82" aria-hidden="true" tabindex="-1"></a>              </span>
<span id="cb72-83"><a href="#cb72-83" aria-hidden="true" tabindex="-1"></a>              predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(model, inner_test_data, <span class="at">probability =</span> <span class="cn">TRUE</span>)</span>
<span id="cb72-84"><a href="#cb72-84" aria-hidden="true" tabindex="-1"></a>              predictions_prob <span class="ot">&lt;-</span> <span class="fu">attr</span>(predictions, <span class="st">"probabilities"</span>)[, <span class="dv">2</span>]</span>
<span id="cb72-85"><a href="#cb72-85" aria-hidden="true" tabindex="-1"></a>              roc_curve <span class="ot">&lt;-</span> <span class="fu">roc</span>(inner_test_data[[target_name]], predictions_prob)</span>
<span id="cb72-86"><a href="#cb72-86" aria-hidden="true" tabindex="-1"></a>              auc_vals[inner_index] <span class="ot">&lt;-</span> roc_curve<span class="sc">$</span>auc</span>
<span id="cb72-87"><a href="#cb72-87" aria-hidden="true" tabindex="-1"></a>              <span class="fu">cat</span>(<span class="st">"AUC for inner fold "</span>, inner_index, <span class="st">": "</span>, roc_curve<span class="sc">$</span>auc, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb72-88"><a href="#cb72-88" aria-hidden="true" tabindex="-1"></a>              </span>
<span id="cb72-89"><a href="#cb72-89" aria-hidden="true" tabindex="-1"></a>            }, <span class="at">error =</span> <span class="cf">function</span>(e) {</span>
<span id="cb72-90"><a href="#cb72-90" aria-hidden="true" tabindex="-1"></a>              <span class="fu">cat</span>(<span class="st">"Error with variables: "</span>, <span class="fu">paste</span>(selected_vars, <span class="at">collapse =</span> <span class="st">", "</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb72-91"><a href="#cb72-91" aria-hidden="true" tabindex="-1"></a>              <span class="fu">cat</span>(<span class="st">"Error message: "</span>, e<span class="sc">$</span>message, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb72-92"><a href="#cb72-92" aria-hidden="true" tabindex="-1"></a>              auc_vals[inner_index] <span class="ot">&lt;-</span> <span class="cn">NA</span>  <span class="co"># Set to NA or some other indicator of failure</span></span>
<span id="cb72-93"><a href="#cb72-93" aria-hidden="true" tabindex="-1"></a>            })</span>
<span id="cb72-94"><a href="#cb72-94" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb72-95"><a href="#cb72-95" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb72-96"><a href="#cb72-96" aria-hidden="true" tabindex="-1"></a>          mean_auc <span class="ot">&lt;-</span> <span class="fu">mean</span>(auc_vals, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb72-97"><a href="#cb72-97" aria-hidden="true" tabindex="-1"></a>          <span class="fu">cat</span>(<span class="st">"Mean AUC for params - kernel: "</span>, grid<span class="sc">$</span>kernel[params], <span class="st">", cost: "</span>, grid<span class="sc">$</span>cost[params], <span class="st">": "</span>, mean_auc, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb72-98"><a href="#cb72-98" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.na</span>(mean_auc) <span class="sc">&amp;&amp;</span> mean_auc <span class="sc">&gt;</span> best_auc_in_step) {</span>
<span id="cb72-99"><a href="#cb72-99" aria-hidden="true" tabindex="-1"></a>            best_auc_in_step <span class="ot">&lt;-</span> mean_auc</span>
<span id="cb72-100"><a href="#cb72-100" aria-hidden="true" tabindex="-1"></a>            best_inner_model <span class="ot">&lt;-</span> model</span>
<span id="cb72-101"><a href="#cb72-101" aria-hidden="true" tabindex="-1"></a>            best_inner_kernel <span class="ot">&lt;-</span> grid<span class="sc">$</span>kernel[params]</span>
<span id="cb72-102"><a href="#cb72-102" aria-hidden="true" tabindex="-1"></a>            best_inner_cost <span class="ot">&lt;-</span> grid<span class="sc">$</span>cost[params]</span>
<span id="cb72-103"><a href="#cb72-103" aria-hidden="true" tabindex="-1"></a>            best_inner_vars <span class="ot">&lt;-</span> selected_vars</span>
<span id="cb72-104"><a href="#cb72-104" aria-hidden="true" tabindex="-1"></a>            improved <span class="ot">&lt;-</span> <span class="cn">TRUE</span></span>
<span id="cb72-105"><a href="#cb72-105" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb72-106"><a href="#cb72-106" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb72-107"><a href="#cb72-107" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb72-108"><a href="#cb72-108" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (improved) {</span>
<span id="cb72-109"><a href="#cb72-109" aria-hidden="true" tabindex="-1"></a>          vars <span class="ot">&lt;-</span> best_inner_vars</span>
<span id="cb72-110"><a href="#cb72-110" aria-hidden="true" tabindex="-1"></a>          best_inner_auc <span class="ot">&lt;-</span> best_auc_in_step</span>
<span id="cb72-111"><a href="#cb72-111" aria-hidden="true" tabindex="-1"></a>          <span class="fu">cat</span>(<span class="st">"Vars improved: "</span>, <span class="fu">paste</span>(vars, <span class="at">collapse=</span><span class="st">", "</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb72-112"><a href="#cb72-112" aria-hidden="true" tabindex="-1"></a>          <span class="fu">cat</span>(<span class="st">"AUC: "</span>, best_inner_auc, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb72-113"><a href="#cb72-113" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb72-114"><a href="#cb72-114" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb72-115"><a href="#cb72-115" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb72-116"><a href="#cb72-116" aria-hidden="true" tabindex="-1"></a>      <span class="fu">list</span>(<span class="at">model =</span> best_inner_model, <span class="at">auc =</span> best_inner_auc, </span>
<span id="cb72-117"><a href="#cb72-117" aria-hidden="true" tabindex="-1"></a>           <span class="at">kernel =</span> best_inner_kernel, <span class="at">cost =</span> best_inner_cost, </span>
<span id="cb72-118"><a href="#cb72-118" aria-hidden="true" tabindex="-1"></a>           <span class="at">vars =</span> best_inner_vars)</span>
<span id="cb72-119"><a href="#cb72-119" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb72-120"><a href="#cb72-120" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb72-121"><a href="#cb72-121" aria-hidden="true" tabindex="-1"></a>    best_result <span class="ot">&lt;-</span> <span class="fu">stepAUC</span>(best_vars, outer_train_data, target_name, grid, inner_folds)</span>
<span id="cb72-122"><a href="#cb72-122" aria-hidden="true" tabindex="-1"></a>    best_model <span class="ot">&lt;-</span> best_result<span class="sc">$</span>model</span>
<span id="cb72-123"><a href="#cb72-123" aria-hidden="true" tabindex="-1"></a>    best_auc <span class="ot">&lt;-</span> best_result<span class="sc">$</span>auc</span>
<span id="cb72-124"><a href="#cb72-124" aria-hidden="true" tabindex="-1"></a>    best_kernel <span class="ot">&lt;-</span> best_result<span class="sc">$</span>kernel</span>
<span id="cb72-125"><a href="#cb72-125" aria-hidden="true" tabindex="-1"></a>    best_cost <span class="ot">&lt;-</span> best_result<span class="sc">$</span>cost</span>
<span id="cb72-126"><a href="#cb72-126" aria-hidden="true" tabindex="-1"></a>    best_vars <span class="ot">&lt;-</span> best_result<span class="sc">$</span>vars</span>
<span id="cb72-127"><a href="#cb72-127" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb72-128"><a href="#cb72-128" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">is.null</span>(best_model)) {</span>
<span id="cb72-129"><a href="#cb72-129" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cat</span>(<span class="st">"Error: No valid model found for outer fold "</span>, outer_index, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb72-130"><a href="#cb72-130" aria-hidden="true" tabindex="-1"></a>      <span class="cf">next</span></span>
<span id="cb72-131"><a href="#cb72-131" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb72-132"><a href="#cb72-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-133"><a href="#cb72-133" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Evaluar el mejor modelo en el validation split del inner loop</span></span>
<span id="cb72-134"><a href="#cb72-134" aria-hidden="true" tabindex="-1"></a>    inner_auc_vals <span class="ot">&lt;-</span> <span class="fu">numeric</span>()</span>
<span id="cb72-135"><a href="#cb72-135" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (inner_index <span class="cf">in</span> <span class="fu">seq_along</span>(inner_folds)) {</span>
<span id="cb72-136"><a href="#cb72-136" aria-hidden="true" tabindex="-1"></a>      inner_train_data <span class="ot">&lt;-</span> outer_train_data[<span class="sc">-</span>inner_folds[[inner_index]], ]</span>
<span id="cb72-137"><a href="#cb72-137" aria-hidden="true" tabindex="-1"></a>      inner_test_data <span class="ot">&lt;-</span> outer_train_data[inner_folds[[inner_index]], ]</span>
<span id="cb72-138"><a href="#cb72-138" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb72-139"><a href="#cb72-139" aria-hidden="true" tabindex="-1"></a>      predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(best_model, inner_test_data, <span class="at">probability =</span> <span class="cn">TRUE</span>)</span>
<span id="cb72-140"><a href="#cb72-140" aria-hidden="true" tabindex="-1"></a>      predictions_prob <span class="ot">&lt;-</span> <span class="fu">attr</span>(predictions, <span class="st">"probabilities"</span>)[, <span class="dv">2</span>]</span>
<span id="cb72-141"><a href="#cb72-141" aria-hidden="true" tabindex="-1"></a>      roc_curve <span class="ot">&lt;-</span> <span class="fu">roc</span>(inner_test_data[[target_name]], predictions_prob)</span>
<span id="cb72-142"><a href="#cb72-142" aria-hidden="true" tabindex="-1"></a>      inner_auc_vals[inner_index] <span class="ot">&lt;-</span> roc_curve<span class="sc">$</span>auc</span>
<span id="cb72-143"><a href="#cb72-143" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cat</span>(<span class="st">"Inner fold "</span>, inner_index, <span class="st">" AUC: "</span>, roc_curve<span class="sc">$</span>auc, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb72-144"><a href="#cb72-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-145"><a href="#cb72-145" aria-hidden="true" tabindex="-1"></a>      pred_class <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(predictions_prob <span class="sc">&gt;</span> threshold, <span class="st">"1"</span>, <span class="st">"0"</span>)</span>
<span id="cb72-146"><a href="#cb72-146" aria-hidden="true" tabindex="-1"></a>      confusion <span class="ot">&lt;-</span> <span class="fu">table</span>(<span class="at">Actual =</span> inner_test_data[[target_name]], <span class="at">Predicted =</span> pred_class)</span>
<span id="cb72-147"><a href="#cb72-147" aria-hidden="true" tabindex="-1"></a>      TP <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span>, confusion[<span class="dv">2</span>, <span class="dv">2</span>], <span class="dv">0</span>)</span>
<span id="cb72-148"><a href="#cb72-148" aria-hidden="true" tabindex="-1"></a>      TN <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span>, confusion[<span class="dv">1</span>, <span class="dv">1</span>], <span class="dv">0</span>)</span>
<span id="cb72-149"><a href="#cb72-149" aria-hidden="true" tabindex="-1"></a>      FP <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span>, confusion[<span class="dv">1</span>, <span class="dv">2</span>], <span class="dv">0</span>)</span>
<span id="cb72-150"><a href="#cb72-150" aria-hidden="true" tabindex="-1"></a>      FN <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span>, confusion[<span class="dv">2</span>, <span class="dv">1</span>], <span class="dv">0</span>)</span>
<span id="cb72-151"><a href="#cb72-151" aria-hidden="true" tabindex="-1"></a>      auc <span class="ot">&lt;-</span> roc_curve<span class="sc">$</span>auc</span>
<span id="cb72-152"><a href="#cb72-152" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb72-153"><a href="#cb72-153" aria-hidden="true" tabindex="-1"></a>      inner_metrics <span class="ot">&lt;-</span> <span class="fu">setNames</span>(<span class="fu">c</span>(outer_index, inner_index, TP, TN, FP, FN, auc), <span class="fu">names</span>(inner_fold_metrics))</span>
<span id="cb72-154"><a href="#cb72-154" aria-hidden="true" tabindex="-1"></a>      inner_fold_metrics <span class="ot">&lt;-</span> <span class="fu">rbind</span>(inner_fold_metrics, <span class="fu">as.data.frame</span>(<span class="fu">t</span>(inner_metrics)))</span>
<span id="cb72-155"><a href="#cb72-155" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb72-156"><a href="#cb72-156" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb72-157"><a href="#cb72-157" aria-hidden="true" tabindex="-1"></a>    best_inner_auc <span class="ot">&lt;-</span> <span class="fu">mean</span>(inner_auc_vals, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb72-158"><a href="#cb72-158" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Best inner AUC: "</span>, best_inner_auc, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb72-159"><a href="#cb72-159" aria-hidden="true" tabindex="-1"></a>    best_model <span class="ot">&lt;-</span> <span class="fu">svm</span>(<span class="fu">as.formula</span>(<span class="fu">paste</span>(target_name, <span class="st">"~"</span>, <span class="fu">paste</span>(best_vars, <span class="at">collapse =</span> <span class="st">"+"</span>))),</span>
<span id="cb72-160"><a href="#cb72-160" aria-hidden="true" tabindex="-1"></a>                      <span class="at">data =</span> outer_train_data, <span class="at">kernel =</span> best_kernel, <span class="at">cost =</span> best_cost, </span>
<span id="cb72-161"><a href="#cb72-161" aria-hidden="true" tabindex="-1"></a>                      <span class="at">probability =</span> <span class="cn">TRUE</span>)</span>
<span id="cb72-162"><a href="#cb72-162" aria-hidden="true" tabindex="-1"></a>    predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(best_model, outer_test_data, <span class="at">probability =</span> <span class="cn">TRUE</span>)</span>
<span id="cb72-163"><a href="#cb72-163" aria-hidden="true" tabindex="-1"></a>    predictions_prob <span class="ot">&lt;-</span> <span class="fu">attr</span>(predictions, <span class="st">"probabilities"</span>)[, <span class="dv">2</span>]</span>
<span id="cb72-164"><a href="#cb72-164" aria-hidden="true" tabindex="-1"></a>    pred_class <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(predictions_prob <span class="sc">&gt;</span> threshold, <span class="st">"1"</span>, <span class="st">"0"</span>)  <span class="co"># Asignar clases basadas en umbral</span></span>
<span id="cb72-165"><a href="#cb72-165" aria-hidden="true" tabindex="-1"></a>    confusion <span class="ot">&lt;-</span> <span class="fu">table</span>(<span class="at">Actual =</span> outer_test_data[[target_name]], <span class="at">Predicted =</span> pred_class)</span>
<span id="cb72-166"><a href="#cb72-166" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb72-167"><a href="#cb72-167" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">nrow</span>(confusion) <span class="sc">&lt;</span> <span class="dv">2</span> <span class="sc">||</span> <span class="fu">ncol</span>(confusion) <span class="sc">&lt;</span> <span class="dv">2</span>) {</span>
<span id="cb72-168"><a href="#cb72-168" aria-hidden="true" tabindex="-1"></a>      TP <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span>, confusion[<span class="dv">2</span>, <span class="dv">2</span>], <span class="dv">0</span>)</span>
<span id="cb72-169"><a href="#cb72-169" aria-hidden="true" tabindex="-1"></a>      TN <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span>, confusion[<span class="dv">1</span>, <span class="dv">1</span>], <span class="dv">0</span>)</span>
<span id="cb72-170"><a href="#cb72-170" aria-hidden="true" tabindex="-1"></a>      FP <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span>, confusion[<span class="dv">1</span>, <span class="dv">2</span>], <span class="dv">0</span>)</span>
<span id="cb72-171"><a href="#cb72-171" aria-hidden="true" tabindex="-1"></a>      FN <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span>, confusion[<span class="dv">2</span>, <span class="dv">1</span>], <span class="dv">0</span>)</span>
<span id="cb72-172"><a href="#cb72-172" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb72-173"><a href="#cb72-173" aria-hidden="true" tabindex="-1"></a>      TP <span class="ot">&lt;-</span> confusion[<span class="dv">2</span>, <span class="dv">2</span>]</span>
<span id="cb72-174"><a href="#cb72-174" aria-hidden="true" tabindex="-1"></a>      TN <span class="ot">&lt;-</span> confusion[<span class="dv">1</span>, <span class="dv">1</span>]</span>
<span id="cb72-175"><a href="#cb72-175" aria-hidden="true" tabindex="-1"></a>      FP <span class="ot">&lt;-</span> confusion[<span class="dv">1</span>, <span class="dv">2</span>]</span>
<span id="cb72-176"><a href="#cb72-176" aria-hidden="true" tabindex="-1"></a>      FN <span class="ot">&lt;-</span> confusion[<span class="dv">2</span>, <span class="dv">1</span>]</span>
<span id="cb72-177"><a href="#cb72-177" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb72-178"><a href="#cb72-178" aria-hidden="true" tabindex="-1"></a>    auc <span class="ot">&lt;-</span> <span class="fu">roc</span>(outer_test_data[[target_name]], predictions_prob)<span class="sc">$</span>auc</span>
<span id="cb72-179"><a href="#cb72-179" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb72-180"><a href="#cb72-180" aria-hidden="true" tabindex="-1"></a>    metrics <span class="ot">&lt;-</span> <span class="fu">setNames</span>(<span class="fu">c</span>(outer_index, TP, TN, FP, FN, auc, </span>
<span id="cb72-181"><a href="#cb72-181" aria-hidden="true" tabindex="-1"></a>                          best_kernel, best_cost, <span class="fu">paste</span>(best_vars, <span class="at">collapse =</span> <span class="st">","</span>)), </span>
<span id="cb72-182"><a href="#cb72-182" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">names</span>(performance_metrics))</span>
<span id="cb72-183"><a href="#cb72-183" aria-hidden="true" tabindex="-1"></a>    performance_metrics <span class="ot">&lt;-</span> <span class="fu">rbind</span>(performance_metrics, <span class="fu">as.data.frame</span>(<span class="fu">t</span>(metrics)))</span>
<span id="cb72-184"><a href="#cb72-184" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb72-185"><a href="#cb72-185" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Performance:</span><span class="sc">\n</span><span class="st">"</span>, <span class="fu">paste</span>(performance_metrics), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb72-186"><a href="#cb72-186" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Confusion Matrix for Fold %d:</span><span class="sc">\n</span><span class="st">"</span>, outer_index))</span>
<span id="cb72-187"><a href="#cb72-187" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(confusion)</span>
<span id="cb72-188"><a href="#cb72-188" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Metrics for Fold %d:</span><span class="sc">\n</span><span class="st">"</span>, outer_index))</span>
<span id="cb72-189"><a href="#cb72-189" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"TP: %d, TN: %d, FP: %d, FN: %d, AUC: %f, Best Kernel: %s, Best Cost: %f, Best Variables: %s</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb72-190"><a href="#cb72-190" aria-hidden="true" tabindex="-1"></a>                TP, TN, FP, FN, auc, best_kernel, best_cost, <span class="fu">paste</span>(best_vars, <span class="at">collapse =</span> <span class="st">","</span>)))</span>
<span id="cb72-191"><a href="#cb72-191" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb72-192"><a href="#cb72-192" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb72-193"><a href="#cb72-193" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="at">performance_metrics =</span> performance_metrics, <span class="at">inner_fold_metrics =</span> inner_fold_metrics)</span>
<span id="cb72-194"><a href="#cb72-194" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb72-195"><a href="#cb72-195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-196"><a href="#cb72-196" aria-hidden="true" tabindex="-1"></a>evaluate_with_seeds_SVM_lasso <span class="ot">&lt;-</span> </span>
<span id="cb72-197"><a href="#cb72-197" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(evaluation_function, data, target_var, vars, threshold, seeds, outer, inner, kernels, costs) {</span>
<span id="cb72-198"><a href="#cb72-198" aria-hidden="true" tabindex="-1"></a>  results_list <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb72-199"><a href="#cb72-199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-200"><a href="#cb72-200" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (seed <span class="cf">in</span> seeds) {</span>
<span id="cb72-201"><a href="#cb72-201" aria-hidden="true" tabindex="-1"></a>    <span class="fu">set.seed</span>(seed)</span>
<span id="cb72-202"><a href="#cb72-202" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Evaluating with seed:"</span>, seed, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb72-203"><a href="#cb72-203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-204"><a href="#cb72-204" aria-hidden="true" tabindex="-1"></a>    results <span class="ot">&lt;-</span> <span class="fu">evaluation_function</span>(<span class="at">data =</span> data, </span>
<span id="cb72-205"><a href="#cb72-205" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">target_name =</span> target_var, </span>
<span id="cb72-206"><a href="#cb72-206" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">variables =</span> vars, </span>
<span id="cb72-207"><a href="#cb72-207" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">threshold =</span> threshold, </span>
<span id="cb72-208"><a href="#cb72-208" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">outer =</span> outer, </span>
<span id="cb72-209"><a href="#cb72-209" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">inner =</span> inner, </span>
<span id="cb72-210"><a href="#cb72-210" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">seed =</span> seed,</span>
<span id="cb72-211"><a href="#cb72-211" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">kernels =</span> kernels,</span>
<span id="cb72-212"><a href="#cb72-212" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">costs =</span> costs)</span>
<span id="cb72-213"><a href="#cb72-213" aria-hidden="true" tabindex="-1"></a>    results_list[[<span class="fu">paste0</span>(<span class="st">"seed_"</span>, seed)]] <span class="ot">&lt;-</span> results</span>
<span id="cb72-214"><a href="#cb72-214" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb72-215"><a href="#cb72-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-216"><a href="#cb72-216" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(results_list)</span>
<span id="cb72-217"><a href="#cb72-217" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb72-218"><a href="#cb72-218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-219"><a href="#cb72-219" aria-hidden="true" tabindex="-1"></a>performance_SVM_lasso <span class="ot">&lt;-</span> <span class="fu">evaluate_with_seeds_SVM_lasso</span>(</span>
<span id="cb72-220"><a href="#cb72-220" aria-hidden="true" tabindex="-1"></a>  <span class="at">evaluation_function =</span> double_cross_validation_svm_lasso,</span>
<span id="cb72-221"><a href="#cb72-221" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_factor,</span>
<span id="cb72-222"><a href="#cb72-222" aria-hidden="true" tabindex="-1"></a>  <span class="at">outer =</span> <span class="dv">5</span>,</span>
<span id="cb72-223"><a href="#cb72-223" aria-hidden="true" tabindex="-1"></a>  <span class="at">inner =</span> <span class="dv">2</span>,</span>
<span id="cb72-224"><a href="#cb72-224" aria-hidden="true" tabindex="-1"></a>  <span class="at">target_var =</span> <span class="st">"PCR"</span>,</span>
<span id="cb72-225"><a href="#cb72-225" aria-hidden="true" tabindex="-1"></a>  <span class="at">kernels =</span> <span class="fu">c</span>(<span class="st">"linear"</span>, <span class="st">"poly"</span>),</span>
<span id="cb72-226"><a href="#cb72-226" aria-hidden="true" tabindex="-1"></a>  <span class="at">costs =</span> <span class="fu">c</span>(<span class="dv">50</span>, <span class="dv">100</span>, <span class="dv">200</span>),</span>
<span id="cb72-227"><a href="#cb72-227" aria-hidden="true" tabindex="-1"></a>  <span class="at">vars =</span> todas_variables_factor,</span>
<span id="cb72-228"><a href="#cb72-228" aria-hidden="true" tabindex="-1"></a>  <span class="at">threshold =</span> .<span class="dv">35</span>,</span>
<span id="cb72-229"><a href="#cb72-229" aria-hidden="true" tabindex="-1"></a>  <span class="at">seeds =</span> seeds</span>
<span id="cb72-230"><a href="#cb72-230" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"RData_Files_Algorithms/SVM_Lasso.RData"</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="artificial-neural-networks-1" class="level2" data-number="3.7">
<h2 data-number="3.7" class="anchored" data-anchor-id="artificial-neural-networks-1"><span class="header-section-number">3.7</span> Artificial Neural Networks</h2>
<section id="aparente-6" class="level3" data-number="3.7.1">
<h3 data-number="3.7.1" class="anchored" data-anchor-id="aparente-6"><span class="header-section-number">3.7.1</span> Aparente</h3>
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>evaluate_aparent_performance_model_nnet <span class="ot">&lt;-</span> <span class="cf">function</span>(data, target_var, model_func, <span class="at">vars =</span> <span class="cn">NULL</span>, <span class="at">threshold =</span> <span class="fl">0.5</span>) {</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.null</span>(vars)) {</span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>    vars <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(<span class="fu">names</span>(data), target_var)</span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a>  data[[target_var]] <span class="ot">&lt;-</span> <span class="fu">factor</span>(data[[target_var]], <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a>  formula <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(<span class="fu">paste</span>(target_var, <span class="st">"~"</span>, <span class="fu">paste</span>(vars, <span class="at">collapse =</span> <span class="st">"+"</span>)))</span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a>  model <span class="ot">&lt;-</span> <span class="fu">model_func</span>(formula, data)</span>
<span id="cb74-10"><a href="#cb74-10" aria-hidden="true" tabindex="-1"></a>  predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(model, <span class="at">newdata =</span> data, <span class="at">type =</span> <span class="st">"raw"</span>)</span>
<span id="cb74-11"><a href="#cb74-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb74-12"><a href="#cb74-12" aria-hidden="true" tabindex="-1"></a>  actual_classes <span class="ot">&lt;-</span> data[[target_var]]</span>
<span id="cb74-13"><a href="#cb74-13" aria-hidden="true" tabindex="-1"></a>  predicted_classes <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(predictions <span class="sc">&gt;</span> threshold, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb74-14"><a href="#cb74-14" aria-hidden="true" tabindex="-1"></a>  confusion_matrix <span class="ot">&lt;-</span> <span class="fu">table</span>(predicted_classes, actual_classes)</span>
<span id="cb74-15"><a href="#cb74-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb74-16"><a href="#cb74-16" aria-hidden="true" tabindex="-1"></a>  tp <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="st">"1"</span> <span class="sc">%in%</span> <span class="fu">rownames</span>(confusion_matrix) <span class="sc">&amp;&amp;</span> <span class="st">"1"</span> <span class="sc">%in%</span> <span class="fu">colnames</span>(confusion_matrix), confusion_matrix[<span class="st">"1"</span>, <span class="st">"1"</span>], <span class="dv">0</span>)</span>
<span id="cb74-17"><a href="#cb74-17" aria-hidden="true" tabindex="-1"></a>  tn <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="st">"0"</span> <span class="sc">%in%</span> <span class="fu">rownames</span>(confusion_matrix) <span class="sc">&amp;&amp;</span> <span class="st">"0"</span> <span class="sc">%in%</span> <span class="fu">colnames</span>(confusion_matrix), confusion_matrix[<span class="st">"0"</span>, <span class="st">"0"</span>], <span class="dv">0</span>)</span>
<span id="cb74-18"><a href="#cb74-18" aria-hidden="true" tabindex="-1"></a>  fp <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="st">"1"</span> <span class="sc">%in%</span> <span class="fu">rownames</span>(confusion_matrix) <span class="sc">&amp;&amp;</span> <span class="st">"0"</span> <span class="sc">%in%</span> <span class="fu">colnames</span>(confusion_matrix), confusion_matrix[<span class="st">"1"</span>, <span class="st">"0"</span>], <span class="dv">0</span>)</span>
<span id="cb74-19"><a href="#cb74-19" aria-hidden="true" tabindex="-1"></a>  fn <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="st">"0"</span> <span class="sc">%in%</span> <span class="fu">rownames</span>(confusion_matrix) <span class="sc">&amp;&amp;</span> <span class="st">"1"</span> <span class="sc">%in%</span> <span class="fu">colnames</span>(confusion_matrix), confusion_matrix[<span class="st">"0"</span>, <span class="st">"1"</span>], <span class="dv">0</span>)</span>
<span id="cb74-20"><a href="#cb74-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb74-21"><a href="#cb74-21" aria-hidden="true" tabindex="-1"></a>  accuracy <span class="ot">&lt;-</span> (tp <span class="sc">+</span> tn) <span class="sc">/</span> (tp <span class="sc">+</span> tn <span class="sc">+</span> fp <span class="sc">+</span> fn)</span>
<span id="cb74-22"><a href="#cb74-22" aria-hidden="true" tabindex="-1"></a>  precision <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(tp <span class="sc">+</span> fp <span class="sc">&gt;</span> <span class="dv">0</span>, tp <span class="sc">/</span> (tp <span class="sc">+</span> fp), <span class="dv">0</span>)</span>
<span id="cb74-23"><a href="#cb74-23" aria-hidden="true" tabindex="-1"></a>  recall <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(tp <span class="sc">+</span> fn <span class="sc">&gt;</span> <span class="dv">0</span>, tp <span class="sc">/</span> (tp <span class="sc">+</span> fn), <span class="dv">0</span>)</span>
<span id="cb74-24"><a href="#cb74-24" aria-hidden="true" tabindex="-1"></a>  f1_score <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(precision <span class="sc">+</span> recall <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="dv">2</span> <span class="sc">*</span> (precision <span class="sc">*</span> recall) <span class="sc">/</span> (precision <span class="sc">+</span> recall), <span class="dv">0</span>)</span>
<span id="cb74-25"><a href="#cb74-25" aria-hidden="true" tabindex="-1"></a>  roc_obj <span class="ot">&lt;-</span> pROC<span class="sc">::</span><span class="fu">roc</span>(actual_classes, predictions)</span>
<span id="cb74-26"><a href="#cb74-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb74-27"><a href="#cb74-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="at">confusion_matrix =</span> confusion_matrix, <span class="at">accuracy =</span> accuracy, <span class="at">precision =</span> precision, </span>
<span id="cb74-28"><a href="#cb74-28" aria-hidden="true" tabindex="-1"></a>       <span class="at">recall =</span> recall, <span class="at">f1_score =</span> f1_score, <span class="at">roc_curve =</span> roc_obj)</span>
<span id="cb74-29"><a href="#cb74-29" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb74-30"><a href="#cb74-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-31"><a href="#cb74-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-32"><a href="#cb74-32" aria-hidden="true" tabindex="-1"></a>nn_model <span class="ot">&lt;-</span> <span class="cf">function</span>(formula, data) {</span>
<span id="cb74-33"><a href="#cb74-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(<span class="dv">90</span>)</span>
<span id="cb74-34"><a href="#cb74-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nnet</span>(<span class="at">formula =</span> formula, <span class="at">data =</span> data, <span class="at">size =</span> <span class="dv">15</span>, </span>
<span id="cb74-35"><a href="#cb74-35" aria-hidden="true" tabindex="-1"></a>       <span class="at">decay =</span> <span class="fl">0.1</span>, <span class="at">maxit =</span> <span class="dv">100</span>, <span class="at">trace =</span> <span class="cn">FALSE</span>, </span>
<span id="cb74-36"><a href="#cb74-36" aria-hidden="true" tabindex="-1"></a>       <span class="at">linout =</span> <span class="cn">FALSE</span>, <span class="at">random_state =</span> <span class="dv">90</span>)</span>
<span id="cb74-37"><a href="#cb74-37" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb74-38"><a href="#cb74-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-39"><a href="#cb74-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-40"><a href="#cb74-40" aria-hidden="true" tabindex="-1"></a>resultadosAparentesNN <span class="ot">&lt;-</span> <span class="fu">evaluate_aparent_performance_model_nnet</span>(<span class="at">data =</span> data_factor, <span class="at">target_var =</span> <span class="st">"PCR"</span>,</span>
<span id="cb74-41"><a href="#cb74-41" aria-hidden="true" tabindex="-1"></a>                                                             <span class="at">model_func =</span> nn_model,</span>
<span id="cb74-42"><a href="#cb74-42" aria-hidden="true" tabindex="-1"></a>                                                             <span class="at">vars =</span> <span class="st">"."</span>,</span>
<span id="cb74-43"><a href="#cb74-43" aria-hidden="true" tabindex="-1"></a>                                                             <span class="at">threshold =</span> .<span class="dv">35</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"RData_Files_Algorithms/ANN_Aparente.RData"</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="todas-las-variables-6" class="level3" data-number="3.7.2">
<h3 data-number="3.7.2" class="anchored" data-anchor-id="todas-las-variables-6"><span class="header-section-number">3.7.2</span> Todas las Variables</h3>
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>double_cross_validation_nnet <span class="ot">&lt;-</span> <span class="cf">function</span>(data, target_name, outer, inner, sizes, decays, variables, threshold, seed) {</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(seed)</span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>  performance_metrics <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Fold =</span> <span class="fu">integer</span>(), <span class="at">TP =</span> <span class="fu">integer</span>(), <span class="at">TN =</span> <span class="fu">integer</span>(),</span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">FP =</span> <span class="fu">integer</span>(), <span class="at">FN =</span> <span class="fu">integer</span>(), <span class="at">AUC =</span> <span class="fu">numeric</span>(),</span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">Best_Size =</span> <span class="fu">integer</span>(), <span class="at">Best_Decay =</span> <span class="fu">numeric</span>(), <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a>  data[[target_name]] <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(data[[target_name]]) <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a>  outer_folds <span class="ot">&lt;-</span> <span class="fu">createFolds</span>(data[[target_name]], <span class="at">k =</span> outer, <span class="at">list =</span> <span class="cn">TRUE</span>, <span class="at">returnTrain =</span> <span class="cn">FALSE</span>)</span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-9"><a href="#cb76-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (outer_index <span class="cf">in</span> <span class="fu">seq_along</span>(outer_folds)) {</span>
<span id="cb76-10"><a href="#cb76-10" aria-hidden="true" tabindex="-1"></a>    outer_train_data <span class="ot">&lt;-</span> data[<span class="sc">-</span>outer_folds[[outer_index]], ]</span>
<span id="cb76-11"><a href="#cb76-11" aria-hidden="true" tabindex="-1"></a>    outer_test_data <span class="ot">&lt;-</span> data[outer_folds[[outer_index]], ]</span>
<span id="cb76-12"><a href="#cb76-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-13"><a href="#cb76-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Outer Fold %d</span><span class="sc">\n</span><span class="st">"</span>, outer_index))</span>
<span id="cb76-14"><a href="#cb76-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Training Data - Class 0: "</span>, <span class="fu">sum</span>(outer_train_data[[target_name]] <span class="sc">==</span> <span class="dv">0</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb76-15"><a href="#cb76-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Training Data - Class 1: "</span>, <span class="fu">sum</span>(outer_train_data[[target_name]] <span class="sc">==</span> <span class="dv">1</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb76-16"><a href="#cb76-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Training Data - Total: "</span>, <span class="fu">nrow</span>(outer_train_data), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb76-17"><a href="#cb76-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Testing Data - Class 0: "</span>, <span class="fu">sum</span>(outer_test_data[[target_name]] <span class="sc">==</span> <span class="dv">0</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb76-18"><a href="#cb76-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Testing Data - Class 1: "</span>, <span class="fu">sum</span>(outer_test_data[[target_name]] <span class="sc">==</span> <span class="dv">1</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb76-19"><a href="#cb76-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Testing Data - Total: "</span>, <span class="fu">nrow</span>(outer_test_data), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb76-20"><a href="#cb76-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb76-21"><a href="#cb76-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">sum</span>(outer_train_data[[target_name]] <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">==</span> <span class="dv">0</span> <span class="sc">||</span> <span class="fu">sum</span>(outer_train_data[[target_name]] <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb76-22"><a href="#cb76-22" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cat</span>(<span class="st">"Skipping outer fold due to lack of class diversity</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb76-23"><a href="#cb76-23" aria-hidden="true" tabindex="-1"></a>      <span class="cf">next</span></span>
<span id="cb76-24"><a href="#cb76-24" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb76-25"><a href="#cb76-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-26"><a href="#cb76-26" aria-hidden="true" tabindex="-1"></a>    inner_folds <span class="ot">&lt;-</span> <span class="fu">createFolds</span>(outer_train_data[[target_name]], <span class="at">k =</span> inner, <span class="at">list =</span> <span class="cn">TRUE</span>, <span class="at">returnTrain =</span> <span class="cn">FALSE</span>)</span>
<span id="cb76-27"><a href="#cb76-27" aria-hidden="true" tabindex="-1"></a>    best_model <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb76-28"><a href="#cb76-28" aria-hidden="true" tabindex="-1"></a>    best_auc <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb76-29"><a href="#cb76-29" aria-hidden="true" tabindex="-1"></a>    best_size <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb76-30"><a href="#cb76-30" aria-hidden="true" tabindex="-1"></a>    best_decay <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb76-31"><a href="#cb76-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-32"><a href="#cb76-32" aria-hidden="true" tabindex="-1"></a>    grid <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">size =</span> sizes, <span class="at">decay =</span> decays)</span>
<span id="cb76-33"><a href="#cb76-33" aria-hidden="true" tabindex="-1"></a>    formula <span class="ot">&lt;-</span> <span class="fu">reformulate</span>(variables, target_name)</span>
<span id="cb76-34"><a href="#cb76-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-35"><a href="#cb76-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (params <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(grid)) {</span>
<span id="cb76-36"><a href="#cb76-36" aria-hidden="true" tabindex="-1"></a>      inner_auc <span class="ot">&lt;-</span> <span class="fu">numeric</span>()</span>
<span id="cb76-37"><a href="#cb76-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-38"><a href="#cb76-38" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (inner_index <span class="cf">in</span> <span class="fu">seq_along</span>(inner_folds)) {</span>
<span id="cb76-39"><a href="#cb76-39" aria-hidden="true" tabindex="-1"></a>        inner_train_data <span class="ot">&lt;-</span> outer_train_data[<span class="sc">-</span>inner_folds[[inner_index]], ]</span>
<span id="cb76-40"><a href="#cb76-40" aria-hidden="true" tabindex="-1"></a>        inner_test_data <span class="ot">&lt;-</span> outer_train_data[inner_folds[[inner_index]], ]</span>
<span id="cb76-41"><a href="#cb76-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-42"><a href="#cb76-42" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="fu">sum</span>(inner_train_data[[target_name]] <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">==</span> <span class="dv">0</span> <span class="sc">||</span> <span class="fu">sum</span>(inner_train_data[[target_name]] <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb76-43"><a href="#cb76-43" aria-hidden="true" tabindex="-1"></a>          <span class="fu">cat</span>(<span class="st">"Skipping inner fold due to lack of class diversity</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb76-44"><a href="#cb76-44" aria-hidden="true" tabindex="-1"></a>          <span class="cf">next</span></span>
<span id="cb76-45"><a href="#cb76-45" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb76-46"><a href="#cb76-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-47"><a href="#cb76-47" aria-hidden="true" tabindex="-1"></a>        result <span class="ot">&lt;-</span> <span class="fu">tryCatch</span>({</span>
<span id="cb76-48"><a href="#cb76-48" aria-hidden="true" tabindex="-1"></a>          model <span class="ot">&lt;-</span> <span class="fu">nnet</span>(formula, <span class="at">data =</span> inner_train_data, <span class="at">size =</span> grid<span class="sc">$</span>size[params], <span class="at">decay =</span> grid<span class="sc">$</span>decay[params], <span class="at">linout =</span> <span class="cn">FALSE</span>, <span class="at">maxit =</span> <span class="dv">200</span>)</span>
<span id="cb76-49"><a href="#cb76-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-50"><a href="#cb76-50" aria-hidden="true" tabindex="-1"></a>          predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(model, inner_test_data, <span class="at">type =</span> <span class="st">"raw"</span>)</span>
<span id="cb76-51"><a href="#cb76-51" aria-hidden="true" tabindex="-1"></a>          roc_curve <span class="ot">&lt;-</span> pROC<span class="sc">::</span><span class="fu">roc</span>(inner_test_data[[target_name]], predictions)</span>
<span id="cb76-52"><a href="#cb76-52" aria-hidden="true" tabindex="-1"></a>          inner_auc[inner_index] <span class="ot">&lt;-</span> roc_curve<span class="sc">$</span>auc</span>
<span id="cb76-53"><a href="#cb76-53" aria-hidden="true" tabindex="-1"></a>        }, <span class="at">error =</span> <span class="cf">function</span>(e) {</span>
<span id="cb76-54"><a href="#cb76-54" aria-hidden="true" tabindex="-1"></a>          <span class="fu">cat</span>(<span class="st">"Error with parameters: size ="</span>, grid<span class="sc">$</span>size[params], <span class="st">", decay ="</span>, grid<span class="sc">$</span>decay[params], <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb76-55"><a href="#cb76-55" aria-hidden="true" tabindex="-1"></a>          <span class="fu">cat</span>(<span class="st">"Error message: "</span>, e<span class="sc">$</span>message, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb76-56"><a href="#cb76-56" aria-hidden="true" tabindex="-1"></a>          inner_auc[inner_index] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb76-57"><a href="#cb76-57" aria-hidden="true" tabindex="-1"></a>        })</span>
<span id="cb76-58"><a href="#cb76-58" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb76-59"><a href="#cb76-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-60"><a href="#cb76-60" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="fu">mean</span>(inner_auc, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">&gt;</span> best_auc) {</span>
<span id="cb76-61"><a href="#cb76-61" aria-hidden="true" tabindex="-1"></a>        best_auc <span class="ot">&lt;-</span> <span class="fu">mean</span>(inner_auc, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb76-62"><a href="#cb76-62" aria-hidden="true" tabindex="-1"></a>        best_model <span class="ot">&lt;-</span> model</span>
<span id="cb76-63"><a href="#cb76-63" aria-hidden="true" tabindex="-1"></a>        best_size <span class="ot">&lt;-</span> grid<span class="sc">$</span>size[params]</span>
<span id="cb76-64"><a href="#cb76-64" aria-hidden="true" tabindex="-1"></a>        best_decay <span class="ot">&lt;-</span> grid<span class="sc">$</span>decay[params]</span>
<span id="cb76-65"><a href="#cb76-65" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb76-66"><a href="#cb76-66" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb76-67"><a href="#cb76-67" aria-hidden="true" tabindex="-1"></a>    model <span class="ot">&lt;-</span> <span class="fu">nnet</span>(formula, <span class="at">data =</span> outer_train_data, <span class="at">size =</span> best_size, <span class="at">decay =</span> best_decay, <span class="at">linout =</span> <span class="cn">FALSE</span>, <span class="at">maxit =</span> <span class="dv">200</span>)</span>
<span id="cb76-68"><a href="#cb76-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-69"><a href="#cb76-69" aria-hidden="true" tabindex="-1"></a>    predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(best_model, outer_test_data, <span class="at">type =</span> <span class="st">"raw"</span>)</span>
<span id="cb76-70"><a href="#cb76-70" aria-hidden="true" tabindex="-1"></a>    pred_class <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(predictions <span class="sc">&gt;</span> threshold, <span class="dv">1</span>, <span class="dv">0</span>)  <span class="co"># Asignar clases basadas en umbral</span></span>
<span id="cb76-71"><a href="#cb76-71" aria-hidden="true" tabindex="-1"></a>    confusion <span class="ot">&lt;-</span> <span class="fu">table</span>(<span class="at">Actual =</span> outer_test_data[[target_name]], <span class="at">Predicted =</span> pred_class)</span>
<span id="cb76-72"><a href="#cb76-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-73"><a href="#cb76-73" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">nrow</span>(confusion) <span class="sc">&lt;</span> <span class="dv">2</span> <span class="sc">||</span> <span class="fu">ncol</span>(confusion) <span class="sc">&lt;</span> <span class="dv">2</span>) {</span>
<span id="cb76-74"><a href="#cb76-74" aria-hidden="true" tabindex="-1"></a>      TP <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span>, confusion[<span class="dv">2</span>, <span class="dv">2</span>], <span class="dv">0</span>)</span>
<span id="cb76-75"><a href="#cb76-75" aria-hidden="true" tabindex="-1"></a>      TN <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span>, confusion[<span class="dv">1</span>, <span class="dv">1</span>], <span class="dv">0</span>)</span>
<span id="cb76-76"><a href="#cb76-76" aria-hidden="true" tabindex="-1"></a>      FP <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span>, confusion[<span class="dv">1</span>, <span class="dv">2</span>], <span class="dv">0</span>)</span>
<span id="cb76-77"><a href="#cb76-77" aria-hidden="true" tabindex="-1"></a>      FN <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span>, confusion[<span class="dv">2</span>, <span class="dv">1</span>], <span class="dv">0</span>)</span>
<span id="cb76-78"><a href="#cb76-78" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb76-79"><a href="#cb76-79" aria-hidden="true" tabindex="-1"></a>      TP <span class="ot">&lt;-</span> confusion[<span class="dv">2</span>, <span class="dv">2</span>]</span>
<span id="cb76-80"><a href="#cb76-80" aria-hidden="true" tabindex="-1"></a>      TN <span class="ot">&lt;-</span> confusion[<span class="dv">1</span>, <span class="dv">1</span>]</span>
<span id="cb76-81"><a href="#cb76-81" aria-hidden="true" tabindex="-1"></a>      FP <span class="ot">&lt;-</span> confusion[<span class="dv">1</span>, <span class="dv">2</span>]</span>
<span id="cb76-82"><a href="#cb76-82" aria-hidden="true" tabindex="-1"></a>      FN <span class="ot">&lt;-</span> confusion[<span class="dv">2</span>, <span class="dv">1</span>]</span>
<span id="cb76-83"><a href="#cb76-83" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb76-84"><a href="#cb76-84" aria-hidden="true" tabindex="-1"></a>    auc <span class="ot">&lt;-</span> pROC<span class="sc">::</span><span class="fu">roc</span>(outer_test_data[[target_name]], predictions)<span class="sc">$</span>auc</span>
<span id="cb76-85"><a href="#cb76-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-86"><a href="#cb76-86" aria-hidden="true" tabindex="-1"></a>    metrics <span class="ot">&lt;-</span> <span class="fu">setNames</span>(<span class="fu">c</span>(outer_index, TP, TN, FP, FN, auc, best_size, best_decay), <span class="fu">names</span>(performance_metrics))</span>
<span id="cb76-87"><a href="#cb76-87" aria-hidden="true" tabindex="-1"></a>    performance_metrics <span class="ot">&lt;-</span> <span class="fu">rbind</span>(performance_metrics, <span class="fu">as.data.frame</span>(<span class="fu">t</span>(metrics)))</span>
<span id="cb76-88"><a href="#cb76-88" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb76-89"><a href="#cb76-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-90"><a href="#cb76-90" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(performance_metrics)</span>
<span id="cb76-91"><a href="#cb76-91" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb76-92"><a href="#cb76-92" aria-hidden="true" tabindex="-1"></a>evaluate_with_seeds_ANN_TodasVariables_Asociacion <span class="ot">&lt;-</span> </span>
<span id="cb76-93"><a href="#cb76-93" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(evaluation_function, data, target_var, vars, threshold, seeds, outer, inner, sizes, decays) {</span>
<span id="cb76-94"><a href="#cb76-94" aria-hidden="true" tabindex="-1"></a>  results_list <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb76-95"><a href="#cb76-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-96"><a href="#cb76-96" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (seed <span class="cf">in</span> seeds) {</span>
<span id="cb76-97"><a href="#cb76-97" aria-hidden="true" tabindex="-1"></a>    <span class="fu">set.seed</span>(seed)</span>
<span id="cb76-98"><a href="#cb76-98" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Evaluating with seed:"</span>, seed, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb76-99"><a href="#cb76-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-100"><a href="#cb76-100" aria-hidden="true" tabindex="-1"></a>    results <span class="ot">&lt;-</span> <span class="fu">evaluation_function</span>(<span class="at">data =</span> data, </span>
<span id="cb76-101"><a href="#cb76-101" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">target_name =</span> target_var, </span>
<span id="cb76-102"><a href="#cb76-102" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">variables =</span> vars, </span>
<span id="cb76-103"><a href="#cb76-103" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">threshold =</span> threshold, </span>
<span id="cb76-104"><a href="#cb76-104" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">outer =</span> outer, </span>
<span id="cb76-105"><a href="#cb76-105" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">inner =</span> inner, </span>
<span id="cb76-106"><a href="#cb76-106" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">seed =</span> seed,</span>
<span id="cb76-107"><a href="#cb76-107" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">sizes =</span> sizes,</span>
<span id="cb76-108"><a href="#cb76-108" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">decays =</span> decays)</span>
<span id="cb76-109"><a href="#cb76-109" aria-hidden="true" tabindex="-1"></a>    results_list[[<span class="fu">paste0</span>(<span class="st">"seed_"</span>, seed)]] <span class="ot">&lt;-</span> results</span>
<span id="cb76-110"><a href="#cb76-110" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb76-111"><a href="#cb76-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-112"><a href="#cb76-112" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(results_list)</span>
<span id="cb76-113"><a href="#cb76-113" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb76-114"><a href="#cb76-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-115"><a href="#cb76-115" aria-hidden="true" tabindex="-1"></a>performance_ANN_todasvariables <span class="ot">&lt;-</span> <span class="fu">evaluate_with_seeds_ANN_TodasVariables_Asociacion</span>(</span>
<span id="cb76-116"><a href="#cb76-116" aria-hidden="true" tabindex="-1"></a>  <span class="at">evaluation_function =</span> double_cross_validation_nnet,</span>
<span id="cb76-117"><a href="#cb76-117" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_factor,</span>
<span id="cb76-118"><a href="#cb76-118" aria-hidden="true" tabindex="-1"></a>  <span class="at">outer =</span> <span class="dv">5</span>,</span>
<span id="cb76-119"><a href="#cb76-119" aria-hidden="true" tabindex="-1"></a>  <span class="at">inner =</span> <span class="dv">2</span>,</span>
<span id="cb76-120"><a href="#cb76-120" aria-hidden="true" tabindex="-1"></a>  <span class="at">target_var =</span> <span class="st">"PCR"</span>,</span>
<span id="cb76-121"><a href="#cb76-121" aria-hidden="true" tabindex="-1"></a>  <span class="at">sizes =</span> <span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">10</span>,<span class="dv">15</span>,<span class="dv">20</span>,<span class="dv">25</span>,<span class="dv">30</span>),</span>
<span id="cb76-122"><a href="#cb76-122" aria-hidden="true" tabindex="-1"></a>  <span class="at">decays =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.2</span>, <span class="fl">0.3</span>, <span class="fl">0.4</span>),</span>
<span id="cb76-123"><a href="#cb76-123" aria-hidden="true" tabindex="-1"></a>  <span class="at">vars =</span> todas_variables_factor,</span>
<span id="cb76-124"><a href="#cb76-124" aria-hidden="true" tabindex="-1"></a>  <span class="at">threshold =</span> .<span class="dv">35</span>,</span>
<span id="cb76-125"><a href="#cb76-125" aria-hidden="true" tabindex="-1"></a>  <span class="at">seeds =</span> seeds</span>
<span id="cb76-126"><a href="#cb76-126" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"RData_Files_Algorithms/ANN_TodasVariables.RData"</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="filtrado-asociación-6" class="level3" data-number="3.7.3">
<h3 data-number="3.7.3" class="anchored" data-anchor-id="filtrado-asociación-6"><span class="header-section-number">3.7.3</span> Filtrado (Asociación)</h3>
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>performance_ANN_asociacion <span class="ot">&lt;-</span> <span class="fu">evaluate_with_seeds_ANN_TodasVariables_Asociacion</span>(</span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">evaluation_function =</span> double_cross_validation_nnet,</span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_factor,</span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">outer =</span> <span class="dv">5</span>,</span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">inner =</span> <span class="dv">2</span>,</span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">target_var =</span> <span class="st">"PCR"</span>,</span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">sizes =</span> <span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">10</span>,<span class="dv">15</span>,<span class="dv">20</span>,<span class="dv">25</span>,<span class="dv">30</span>),</span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">decays =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.2</span>, <span class="fl">0.3</span>, <span class="fl">0.4</span>),</span>
<span id="cb78-9"><a href="#cb78-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">vars =</span> asociacion,</span>
<span id="cb78-10"><a href="#cb78-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">threshold =</span> .<span class="dv">35</span>,</span>
<span id="cb78-11"><a href="#cb78-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">seeds =</span> seeds</span>
<span id="cb78-12"><a href="#cb78-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"RData_Files_Algorithms/ANN_Asociacion.RData"</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="wrapped-stepauc-6" class="level3" data-number="3.7.4">
<h3 data-number="3.7.4" class="anchored" data-anchor-id="wrapped-stepauc-6"><span class="header-section-number">3.7.4</span> Wrapped (StepAUC)</h3>
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>double_cross_validation_nnet_stepAUC <span class="ot">&lt;-</span> <span class="cf">function</span>(data, target_name, outer, inner, sizes, decays, variables, threshold, seed) {</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(seed)</span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>  performance_metrics <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Fold =</span> <span class="fu">integer</span>(), <span class="at">TP =</span> <span class="fu">integer</span>(), <span class="at">TN =</span> <span class="fu">integer</span>(),</span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">FP =</span> <span class="fu">integer</span>(), <span class="at">FN =</span> <span class="fu">integer</span>(), <span class="at">AUC =</span> <span class="fu">numeric</span>(),</span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">Best_Size =</span> <span class="fu">integer</span>(), <span class="at">Best_Decay =</span> <span class="fu">numeric</span>(), <span class="at">Best_Variables =</span> <span class="fu">character</span>(), <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a>  inner_fold_metrics <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Fold =</span> <span class="fu">integer</span>(), <span class="at">Inner_Fold =</span> <span class="fu">integer</span>(), </span>
<span id="cb80-8"><a href="#cb80-8" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">TP =</span> <span class="fu">integer</span>(), <span class="at">TN =</span> <span class="fu">integer</span>(), <span class="at">FP =</span> <span class="fu">integer</span>(), </span>
<span id="cb80-9"><a href="#cb80-9" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">FN =</span> <span class="fu">integer</span>(), <span class="at">AUC =</span> <span class="fu">numeric</span>(), <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb80-10"><a href="#cb80-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb80-11"><a href="#cb80-11" aria-hidden="true" tabindex="-1"></a>  data[[target_name]] <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(data[[target_name]]) <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb80-12"><a href="#cb80-12" aria-hidden="true" tabindex="-1"></a>  outer_folds <span class="ot">&lt;-</span> <span class="fu">createFolds</span>(data[[target_name]], <span class="at">k =</span> outer)</span>
<span id="cb80-13"><a href="#cb80-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb80-14"><a href="#cb80-14" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (outer_index <span class="cf">in</span> <span class="fu">seq_along</span>(outer_folds)) {</span>
<span id="cb80-15"><a href="#cb80-15" aria-hidden="true" tabindex="-1"></a>    outer_train_data <span class="ot">&lt;-</span> data[<span class="sc">-</span>outer_folds[[outer_index]], ]</span>
<span id="cb80-16"><a href="#cb80-16" aria-hidden="true" tabindex="-1"></a>    outer_test_data <span class="ot">&lt;-</span> data[outer_folds[[outer_index]], ]</span>
<span id="cb80-17"><a href="#cb80-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb80-18"><a href="#cb80-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Outer Fold %d</span><span class="sc">\n</span><span class="st">"</span>, outer_index))</span>
<span id="cb80-19"><a href="#cb80-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Training Data - Class 0: "</span>, <span class="fu">sum</span>(outer_train_data[[target_name]] <span class="sc">==</span> <span class="dv">0</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb80-20"><a href="#cb80-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Training Data - Class 1: "</span>, <span class="fu">sum</span>(outer_train_data[[target_name]] <span class="sc">==</span> <span class="dv">1</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb80-21"><a href="#cb80-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Testing Data - Class 0: "</span>, <span class="fu">sum</span>(outer_test_data[[target_name]] <span class="sc">==</span> <span class="dv">0</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb80-22"><a href="#cb80-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Testing Data - Class 1: "</span>, <span class="fu">sum</span>(outer_test_data[[target_name]] <span class="sc">==</span> <span class="dv">1</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb80-23"><a href="#cb80-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb80-24"><a href="#cb80-24" aria-hidden="true" tabindex="-1"></a>    inner_folds <span class="ot">&lt;-</span> <span class="fu">createFolds</span>(outer_train_data[[target_name]], <span class="at">k =</span> inner)</span>
<span id="cb80-25"><a href="#cb80-25" aria-hidden="true" tabindex="-1"></a>    best_model <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb80-26"><a href="#cb80-26" aria-hidden="true" tabindex="-1"></a>    best_auc <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb80-27"><a href="#cb80-27" aria-hidden="true" tabindex="-1"></a>    best_size <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb80-28"><a href="#cb80-28" aria-hidden="true" tabindex="-1"></a>    best_decay <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb80-29"><a href="#cb80-29" aria-hidden="true" tabindex="-1"></a>    best_vars <span class="ot">&lt;-</span> variables</span>
<span id="cb80-30"><a href="#cb80-30" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb80-31"><a href="#cb80-31" aria-hidden="true" tabindex="-1"></a>    grid <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">size =</span> sizes, <span class="at">decay =</span> decays)</span>
<span id="cb80-32"><a href="#cb80-32" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb80-33"><a href="#cb80-33" aria-hidden="true" tabindex="-1"></a>    stepAUC <span class="ot">&lt;-</span> <span class="cf">function</span>(vars, data, target_name, grid, inner_folds) {</span>
<span id="cb80-34"><a href="#cb80-34" aria-hidden="true" tabindex="-1"></a>      current_vars <span class="ot">&lt;-</span> vars</span>
<span id="cb80-35"><a href="#cb80-35" aria-hidden="true" tabindex="-1"></a>      best_inner_auc <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb80-36"><a href="#cb80-36" aria-hidden="true" tabindex="-1"></a>      best_inner_model <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb80-37"><a href="#cb80-37" aria-hidden="true" tabindex="-1"></a>      best_inner_size <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb80-38"><a href="#cb80-38" aria-hidden="true" tabindex="-1"></a>      best_inner_decay <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb80-39"><a href="#cb80-39" aria-hidden="true" tabindex="-1"></a>      best_inner_vars <span class="ot">&lt;-</span> current_vars</span>
<span id="cb80-40"><a href="#cb80-40" aria-hidden="true" tabindex="-1"></a>      improved <span class="ot">&lt;-</span> <span class="cn">TRUE</span></span>
<span id="cb80-41"><a href="#cb80-41" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb80-42"><a href="#cb80-42" aria-hidden="true" tabindex="-1"></a>      <span class="cf">while</span> (improved <span class="sc">&amp;&amp;</span> <span class="fu">length</span>(current_vars) <span class="sc">&gt;</span> <span class="dv">1</span>) {</span>
<span id="cb80-43"><a href="#cb80-43" aria-hidden="true" tabindex="-1"></a>        improved <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb80-44"><a href="#cb80-44" aria-hidden="true" tabindex="-1"></a>        best_auc_in_step <span class="ot">&lt;-</span> best_inner_auc</span>
<span id="cb80-45"><a href="#cb80-45" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb80-46"><a href="#cb80-46" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (var <span class="cf">in</span> current_vars) {</span>
<span id="cb80-47"><a href="#cb80-47" aria-hidden="true" tabindex="-1"></a>          temp_vars <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(current_vars, var)</span>
<span id="cb80-48"><a href="#cb80-48" aria-hidden="true" tabindex="-1"></a>          inner_auc <span class="ot">&lt;-</span> <span class="fu">numeric</span>()</span>
<span id="cb80-49"><a href="#cb80-49" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb80-50"><a href="#cb80-50" aria-hidden="true" tabindex="-1"></a>          <span class="cf">for</span> (params <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(grid)) {</span>
<span id="cb80-51"><a href="#cb80-51" aria-hidden="true" tabindex="-1"></a>            auc_vals <span class="ot">&lt;-</span> <span class="fu">numeric</span>()</span>
<span id="cb80-52"><a href="#cb80-52" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb80-53"><a href="#cb80-53" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> (inner_index <span class="cf">in</span> <span class="fu">seq_along</span>(inner_folds)) {</span>
<span id="cb80-54"><a href="#cb80-54" aria-hidden="true" tabindex="-1"></a>              inner_train_data <span class="ot">&lt;-</span> outer_train_data[<span class="sc">-</span>inner_folds[[inner_index]], ]</span>
<span id="cb80-55"><a href="#cb80-55" aria-hidden="true" tabindex="-1"></a>              inner_test_data <span class="ot">&lt;-</span> outer_train_data[inner_folds[[inner_index]], ]</span>
<span id="cb80-56"><a href="#cb80-56" aria-hidden="true" tabindex="-1"></a>              </span>
<span id="cb80-57"><a href="#cb80-57" aria-hidden="true" tabindex="-1"></a>              result <span class="ot">&lt;-</span> <span class="fu">tryCatch</span>({</span>
<span id="cb80-58"><a href="#cb80-58" aria-hidden="true" tabindex="-1"></a>                model <span class="ot">&lt;-</span> <span class="fu">nnet</span>(<span class="fu">as.formula</span>(<span class="fu">paste</span>(target_name, <span class="st">"~"</span>, <span class="fu">paste</span>(temp_vars, <span class="at">collapse =</span> <span class="st">"+"</span>))),</span>
<span id="cb80-59"><a href="#cb80-59" aria-hidden="true" tabindex="-1"></a>                              <span class="at">data =</span> inner_train_data, <span class="at">size =</span> grid<span class="sc">$</span>size[params], <span class="at">decay =</span> grid<span class="sc">$</span>decay[params], </span>
<span id="cb80-60"><a href="#cb80-60" aria-hidden="true" tabindex="-1"></a>                              <span class="at">linout =</span> <span class="cn">FALSE</span>, <span class="at">maxit =</span> <span class="dv">200</span>, <span class="at">trace =</span> <span class="cn">FALSE</span>)</span>
<span id="cb80-61"><a href="#cb80-61" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb80-62"><a href="#cb80-62" aria-hidden="true" tabindex="-1"></a>                predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(model, inner_test_data, <span class="at">type =</span> <span class="st">"raw"</span>)</span>
<span id="cb80-63"><a href="#cb80-63" aria-hidden="true" tabindex="-1"></a>                roc_curve <span class="ot">&lt;-</span> <span class="fu">roc</span>(inner_test_data[[target_name]], predictions)</span>
<span id="cb80-64"><a href="#cb80-64" aria-hidden="true" tabindex="-1"></a>                auc_vals[inner_index] <span class="ot">&lt;-</span> roc_curve<span class="sc">$</span>auc</span>
<span id="cb80-65"><a href="#cb80-65" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb80-66"><a href="#cb80-66" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Guardar los datos del inner fold</span></span>
<span id="cb80-67"><a href="#cb80-67" aria-hidden="true" tabindex="-1"></a>                pred_class <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(predictions <span class="sc">&gt;</span> threshold, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb80-68"><a href="#cb80-68" aria-hidden="true" tabindex="-1"></a>                confusion <span class="ot">&lt;-</span> <span class="fu">table</span>(<span class="at">Actual =</span> inner_test_data[[target_name]], <span class="at">Predicted =</span> pred_class)</span>
<span id="cb80-69"><a href="#cb80-69" aria-hidden="true" tabindex="-1"></a>                TP <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span>, confusion[<span class="dv">2</span>, <span class="dv">2</span>], <span class="dv">0</span>)</span>
<span id="cb80-70"><a href="#cb80-70" aria-hidden="true" tabindex="-1"></a>                TN <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span>, confusion[<span class="dv">1</span>, <span class="dv">1</span>], <span class="dv">0</span>)</span>
<span id="cb80-71"><a href="#cb80-71" aria-hidden="true" tabindex="-1"></a>                FP <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span>, confusion[<span class="dv">1</span>, <span class="dv">2</span>], <span class="dv">0</span>)</span>
<span id="cb80-72"><a href="#cb80-72" aria-hidden="true" tabindex="-1"></a>                FN <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span>, confusion[<span class="dv">2</span>, <span class="dv">1</span>], <span class="dv">0</span>)</span>
<span id="cb80-73"><a href="#cb80-73" aria-hidden="true" tabindex="-1"></a>                auc <span class="ot">&lt;-</span> roc_curve<span class="sc">$</span>auc</span>
<span id="cb80-74"><a href="#cb80-74" aria-hidden="true" tabindex="-1"></a>                inner_metrics <span class="ot">&lt;-</span> <span class="fu">setNames</span>(<span class="fu">c</span>(outer_index, inner_index, TP, TN, FP, FN, auc), <span class="fu">names</span>(inner_fold_metrics))</span>
<span id="cb80-75"><a href="#cb80-75" aria-hidden="true" tabindex="-1"></a>                inner_fold_metrics <span class="ot">&lt;&lt;-</span> <span class="fu">rbind</span>(inner_fold_metrics, <span class="fu">as.data.frame</span>(<span class="fu">t</span>(inner_metrics)))</span>
<span id="cb80-76"><a href="#cb80-76" aria-hidden="true" tabindex="-1"></a>              }, <span class="at">error =</span> <span class="cf">function</span>(e) {</span>
<span id="cb80-77"><a href="#cb80-77" aria-hidden="true" tabindex="-1"></a>                <span class="fu">cat</span>(<span class="st">"Error with variables:"</span>, <span class="fu">paste</span>(temp_vars, <span class="at">collapse =</span> <span class="st">", "</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb80-78"><a href="#cb80-78" aria-hidden="true" tabindex="-1"></a>                auc_vals[inner_index] <span class="ot">&lt;-</span> <span class="dv">0</span>  <span class="co"># Set to NA or some other indicator of failure</span></span>
<span id="cb80-79"><a href="#cb80-79" aria-hidden="true" tabindex="-1"></a>              })</span>
<span id="cb80-80"><a href="#cb80-80" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb80-81"><a href="#cb80-81" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb80-82"><a href="#cb80-82" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> (<span class="fu">mean</span>(auc_vals, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">&gt;</span> best_auc_in_step) {</span>
<span id="cb80-83"><a href="#cb80-83" aria-hidden="true" tabindex="-1"></a>              best_auc_in_step <span class="ot">&lt;-</span> <span class="fu">mean</span>(auc_vals, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb80-84"><a href="#cb80-84" aria-hidden="true" tabindex="-1"></a>              best_inner_model <span class="ot">&lt;-</span> model</span>
<span id="cb80-85"><a href="#cb80-85" aria-hidden="true" tabindex="-1"></a>              best_inner_size <span class="ot">&lt;-</span> grid<span class="sc">$</span>size[params]</span>
<span id="cb80-86"><a href="#cb80-86" aria-hidden="true" tabindex="-1"></a>              best_inner_decay <span class="ot">&lt;-</span> grid<span class="sc">$</span>decay[params]</span>
<span id="cb80-87"><a href="#cb80-87" aria-hidden="true" tabindex="-1"></a>              best_inner_vars <span class="ot">&lt;-</span> temp_vars</span>
<span id="cb80-88"><a href="#cb80-88" aria-hidden="true" tabindex="-1"></a>              improved <span class="ot">&lt;-</span> <span class="cn">TRUE</span></span>
<span id="cb80-89"><a href="#cb80-89" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb80-90"><a href="#cb80-90" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb80-91"><a href="#cb80-91" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb80-92"><a href="#cb80-92" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb80-93"><a href="#cb80-93" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (improved) {</span>
<span id="cb80-94"><a href="#cb80-94" aria-hidden="true" tabindex="-1"></a>          current_vars <span class="ot">&lt;-</span> best_inner_vars</span>
<span id="cb80-95"><a href="#cb80-95" aria-hidden="true" tabindex="-1"></a>          best_inner_auc <span class="ot">&lt;-</span> best_auc_in_step</span>
<span id="cb80-96"><a href="#cb80-96" aria-hidden="true" tabindex="-1"></a>          <span class="fu">cat</span>(<span class="st">"Vars improved: "</span>, <span class="fu">paste</span>(current_vars, <span class="at">collapse=</span><span class="st">", "</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb80-97"><a href="#cb80-97" aria-hidden="true" tabindex="-1"></a>          <span class="fu">cat</span>(<span class="st">"AUC: "</span>, <span class="fu">paste</span>(best_inner_auc), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb80-98"><a href="#cb80-98" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb80-99"><a href="#cb80-99" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb80-100"><a href="#cb80-100" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb80-101"><a href="#cb80-101" aria-hidden="true" tabindex="-1"></a>      <span class="fu">list</span>(<span class="at">model =</span> best_inner_model, <span class="at">auc =</span> best_inner_auc, </span>
<span id="cb80-102"><a href="#cb80-102" aria-hidden="true" tabindex="-1"></a>           <span class="at">size =</span> best_inner_size, <span class="at">decay =</span> best_inner_decay, </span>
<span id="cb80-103"><a href="#cb80-103" aria-hidden="true" tabindex="-1"></a>           <span class="at">vars =</span> best_inner_vars)</span>
<span id="cb80-104"><a href="#cb80-104" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb80-105"><a href="#cb80-105" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb80-106"><a href="#cb80-106" aria-hidden="true" tabindex="-1"></a>    best_result <span class="ot">&lt;-</span> <span class="fu">stepAUC</span>(variables, outer_train_data, target_name, grid, inner_folds)</span>
<span id="cb80-107"><a href="#cb80-107" aria-hidden="true" tabindex="-1"></a>    best_auc <span class="ot">&lt;-</span> best_result<span class="sc">$</span>auc</span>
<span id="cb80-108"><a href="#cb80-108" aria-hidden="true" tabindex="-1"></a>    best_size <span class="ot">&lt;-</span> best_result<span class="sc">$</span>size</span>
<span id="cb80-109"><a href="#cb80-109" aria-hidden="true" tabindex="-1"></a>    best_decay <span class="ot">&lt;-</span> best_result<span class="sc">$</span>decay</span>
<span id="cb80-110"><a href="#cb80-110" aria-hidden="true" tabindex="-1"></a>    best_vars <span class="ot">&lt;-</span> best_result<span class="sc">$</span>vars</span>
<span id="cb80-111"><a href="#cb80-111" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb80-112"><a href="#cb80-112" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Reentrenar el mejor modelo con todos los datos de outer_train_data</span></span>
<span id="cb80-113"><a href="#cb80-113" aria-hidden="true" tabindex="-1"></a>    best_model <span class="ot">&lt;-</span> <span class="fu">nnet</span>(<span class="fu">as.formula</span>(<span class="fu">paste</span>(target_name, <span class="st">"~"</span>, <span class="fu">paste</span>(best_vars, <span class="at">collapse =</span> <span class="st">"+"</span>))),</span>
<span id="cb80-114"><a href="#cb80-114" aria-hidden="true" tabindex="-1"></a>                       <span class="at">data =</span> outer_train_data, <span class="at">size =</span> best_size, <span class="at">decay =</span> best_decay, </span>
<span id="cb80-115"><a href="#cb80-115" aria-hidden="true" tabindex="-1"></a>                       <span class="at">linout =</span> <span class="cn">FALSE</span>, <span class="at">maxit =</span> <span class="dv">200</span>, <span class="at">trace =</span> <span class="cn">FALSE</span>)</span>
<span id="cb80-116"><a href="#cb80-116" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb80-117"><a href="#cb80-117" aria-hidden="true" tabindex="-1"></a>    predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(best_model, outer_test_data, <span class="at">type =</span> <span class="st">"raw"</span>)</span>
<span id="cb80-118"><a href="#cb80-118" aria-hidden="true" tabindex="-1"></a>    pred_class <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(predictions <span class="sc">&gt;</span> threshold, <span class="dv">1</span>, <span class="dv">0</span>)  <span class="co"># Asignar clases basadas en umbral</span></span>
<span id="cb80-119"><a href="#cb80-119" aria-hidden="true" tabindex="-1"></a>    confusion <span class="ot">&lt;-</span> <span class="fu">table</span>(<span class="at">Actual =</span> outer_test_data[[target_name]], <span class="at">Predicted =</span> pred_class)</span>
<span id="cb80-120"><a href="#cb80-120" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb80-121"><a href="#cb80-121" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">nrow</span>(confusion) <span class="sc">&lt;</span> <span class="dv">2</span> <span class="sc">||</span> <span class="fu">ncol</span>(confusion) <span class="sc">&lt;</span> <span class="dv">2</span>) {</span>
<span id="cb80-122"><a href="#cb80-122" aria-hidden="true" tabindex="-1"></a>      TP <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span>, confusion[<span class="dv">2</span>, <span class="dv">2</span>], <span class="dv">0</span>)</span>
<span id="cb80-123"><a href="#cb80-123" aria-hidden="true" tabindex="-1"></a>      TN <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span>, confusion[<span class="dv">1</span>, <span class="dv">1</span>], <span class="dv">0</span>)</span>
<span id="cb80-124"><a href="#cb80-124" aria-hidden="true" tabindex="-1"></a>      FP <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span>, confusion[<span class="dv">1</span>, <span class="dv">2</span>], <span class="dv">0</span>)</span>
<span id="cb80-125"><a href="#cb80-125" aria-hidden="true" tabindex="-1"></a>      FN <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span>, confusion[<span class="dv">2</span>, <span class="dv">1</span>], <span class="dv">0</span>)</span>
<span id="cb80-126"><a href="#cb80-126" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb80-127"><a href="#cb80-127" aria-hidden="true" tabindex="-1"></a>      TP <span class="ot">&lt;-</span> confusion[<span class="dv">2</span>, <span class="dv">2</span>]</span>
<span id="cb80-128"><a href="#cb80-128" aria-hidden="true" tabindex="-1"></a>      TN <span class="ot">&lt;-</span> confusion[<span class="dv">1</span>, <span class="dv">1</span>]</span>
<span id="cb80-129"><a href="#cb80-129" aria-hidden="true" tabindex="-1"></a>      FP <span class="ot">&lt;-</span> confusion[<span class="dv">1</span>, <span class="dv">2</span>]</span>
<span id="cb80-130"><a href="#cb80-130" aria-hidden="true" tabindex="-1"></a>      FN <span class="ot">&lt;-</span> confusion[<span class="dv">2</span>, <span class="dv">1</span>]</span>
<span id="cb80-131"><a href="#cb80-131" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb80-132"><a href="#cb80-132" aria-hidden="true" tabindex="-1"></a>    auc <span class="ot">=</span> <span class="fu">roc</span>(outer_test_data[[target_name]], predictions)<span class="sc">$</span>auc</span>
<span id="cb80-133"><a href="#cb80-133" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb80-134"><a href="#cb80-134" aria-hidden="true" tabindex="-1"></a>    metrics <span class="ot">&lt;-</span> <span class="fu">setNames</span>(<span class="fu">c</span>(outer_index, TP, TN, FP, FN, auc, </span>
<span id="cb80-135"><a href="#cb80-135" aria-hidden="true" tabindex="-1"></a>                          best_size, best_decay, <span class="fu">paste</span>(best_vars, <span class="at">collapse =</span> <span class="st">","</span>)), </span>
<span id="cb80-136"><a href="#cb80-136" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">names</span>(performance_metrics))</span>
<span id="cb80-137"><a href="#cb80-137" aria-hidden="true" tabindex="-1"></a>    performance_metrics <span class="ot">&lt;-</span> <span class="fu">rbind</span>(performance_metrics, <span class="fu">as.data.frame</span>(<span class="fu">t</span>(metrics)))</span>
<span id="cb80-138"><a href="#cb80-138" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb80-139"><a href="#cb80-139" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Performance:"</span>, <span class="fu">paste</span>(performance_metrics))</span>
<span id="cb80-140"><a href="#cb80-140" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Confusion Matrix for Fold %d:</span><span class="sc">\n</span><span class="st">"</span>, outer_index))</span>
<span id="cb80-141"><a href="#cb80-141" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(confusion)</span>
<span id="cb80-142"><a href="#cb80-142" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Metrics for Fold %d:</span><span class="sc">\n</span><span class="st">"</span>, outer_index))</span>
<span id="cb80-143"><a href="#cb80-143" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"TP: %d, TN: %d, FP: %d, FN: %d, AUC: %f, Best Size: %d, Best Decay: %f, Best Variables: %s</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb80-144"><a href="#cb80-144" aria-hidden="true" tabindex="-1"></a>                TP, TN, FP, FN, auc, best_size, best_decay, <span class="fu">paste</span>(best_vars, <span class="at">collapse =</span> <span class="st">","</span>)))</span>
<span id="cb80-145"><a href="#cb80-145" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb80-146"><a href="#cb80-146" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb80-147"><a href="#cb80-147" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="at">performance_metrics =</span> performance_metrics, <span class="at">inner_fold_metrics =</span> inner_fold_metrics)</span>
<span id="cb80-148"><a href="#cb80-148" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb80-149"><a href="#cb80-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-150"><a href="#cb80-150" aria-hidden="true" tabindex="-1"></a>evaluate_with_seeds_ANN_StepAUC <span class="ot">&lt;-</span> </span>
<span id="cb80-151"><a href="#cb80-151" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(evaluation_function, data, target_var, vars, threshold, seeds, outer, inner, sizes, decays) {</span>
<span id="cb80-152"><a href="#cb80-152" aria-hidden="true" tabindex="-1"></a>  results_list <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb80-153"><a href="#cb80-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-154"><a href="#cb80-154" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (seed <span class="cf">in</span> seeds) {</span>
<span id="cb80-155"><a href="#cb80-155" aria-hidden="true" tabindex="-1"></a>    <span class="fu">set.seed</span>(seed)</span>
<span id="cb80-156"><a href="#cb80-156" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Evaluating with seed:"</span>, seed, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb80-157"><a href="#cb80-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-158"><a href="#cb80-158" aria-hidden="true" tabindex="-1"></a>    results <span class="ot">&lt;-</span> <span class="fu">evaluation_function</span>(<span class="at">data =</span> data, </span>
<span id="cb80-159"><a href="#cb80-159" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">target_name =</span> target_var, </span>
<span id="cb80-160"><a href="#cb80-160" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">variables =</span> vars, </span>
<span id="cb80-161"><a href="#cb80-161" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">threshold =</span> threshold, </span>
<span id="cb80-162"><a href="#cb80-162" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">outer =</span> outer, </span>
<span id="cb80-163"><a href="#cb80-163" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">inner =</span> inner, </span>
<span id="cb80-164"><a href="#cb80-164" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">seed =</span> seed,</span>
<span id="cb80-165"><a href="#cb80-165" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">sizes =</span> sizes,</span>
<span id="cb80-166"><a href="#cb80-166" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">decays =</span> decays)</span>
<span id="cb80-167"><a href="#cb80-167" aria-hidden="true" tabindex="-1"></a>    results_list[[<span class="fu">paste0</span>(<span class="st">"seed_"</span>, seed)]] <span class="ot">&lt;-</span> results</span>
<span id="cb80-168"><a href="#cb80-168" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb80-169"><a href="#cb80-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-170"><a href="#cb80-170" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(results_list)</span>
<span id="cb80-171"><a href="#cb80-171" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb80-172"><a href="#cb80-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-173"><a href="#cb80-173" aria-hidden="true" tabindex="-1"></a>performance_ANN_stepAUC <span class="ot">&lt;-</span> <span class="fu">evaluate_with_seeds_ANN_StepAUC</span>(</span>
<span id="cb80-174"><a href="#cb80-174" aria-hidden="true" tabindex="-1"></a>  <span class="at">evaluation_function =</span> double_cross_validation_nnet_stepAUC,</span>
<span id="cb80-175"><a href="#cb80-175" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_factor,</span>
<span id="cb80-176"><a href="#cb80-176" aria-hidden="true" tabindex="-1"></a>  <span class="at">outer =</span> <span class="dv">5</span>,</span>
<span id="cb80-177"><a href="#cb80-177" aria-hidden="true" tabindex="-1"></a>  <span class="at">inner =</span> <span class="dv">2</span>,</span>
<span id="cb80-178"><a href="#cb80-178" aria-hidden="true" tabindex="-1"></a>  <span class="at">target_var =</span> <span class="st">"PCR"</span>,</span>
<span id="cb80-179"><a href="#cb80-179" aria-hidden="true" tabindex="-1"></a>  <span class="at">sizes =</span> <span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">10</span>,<span class="dv">15</span>,<span class="dv">20</span>,<span class="dv">25</span>,<span class="dv">30</span>),</span>
<span id="cb80-180"><a href="#cb80-180" aria-hidden="true" tabindex="-1"></a>  <span class="at">decays =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.2</span>, <span class="fl">0.3</span>, <span class="fl">0.4</span>),</span>
<span id="cb80-181"><a href="#cb80-181" aria-hidden="true" tabindex="-1"></a>  <span class="at">vars =</span> todas_variables_factor,</span>
<span id="cb80-182"><a href="#cb80-182" aria-hidden="true" tabindex="-1"></a>  <span class="at">threshold =</span> .<span class="dv">35</span>,</span>
<span id="cb80-183"><a href="#cb80-183" aria-hidden="true" tabindex="-1"></a>  <span class="at">seeds =</span> seeds</span>
<span id="cb80-184"><a href="#cb80-184" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"RData_Files_Algorithms/ANN_StepAUC.RData"</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="embedded-lasso-6" class="level3" data-number="3.7.5">
<h3 data-number="3.7.5" class="anchored" data-anchor-id="embedded-lasso-6"><span class="header-section-number">3.7.5</span> Embedded (Lasso)</h3>
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>double_cross_validation_nnet_lasso <span class="ot">&lt;-</span> <span class="cf">function</span>(data, target_name, outer, inner, sizes, decays, threshold, seed) {</span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(seed)</span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>  performance_metrics <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Fold =</span> <span class="fu">integer</span>(), <span class="at">TP =</span> <span class="fu">integer</span>(), <span class="at">TN =</span> <span class="fu">integer</span>(),</span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">FP =</span> <span class="fu">integer</span>(), <span class="at">FN =</span> <span class="fu">integer</span>(), <span class="at">AUC =</span> <span class="fu">numeric</span>(),</span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">Best_Size =</span> <span class="fu">integer</span>(), <span class="at">Best_Decay =</span> <span class="fu">numeric</span>(), <span class="at">Best_Variables =</span> <span class="fu">character</span>(), <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a>  inner_fold_metrics <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Fold =</span> <span class="fu">integer</span>(), <span class="at">Inner_Fold =</span> <span class="fu">integer</span>(), </span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">TP =</span> <span class="fu">integer</span>(), <span class="at">TN =</span> <span class="fu">integer</span>(), <span class="at">FP =</span> <span class="fu">integer</span>(), </span>
<span id="cb82-9"><a href="#cb82-9" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">FN =</span> <span class="fu">integer</span>(), <span class="at">AUC =</span> <span class="fu">numeric</span>(), <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb82-10"><a href="#cb82-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb82-11"><a href="#cb82-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Convertir las variables del dataset con model.matrix</span></span>
<span id="cb82-12"><a href="#cb82-12" aria-hidden="true" tabindex="-1"></a>  target <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(data[[target_name]]) <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb82-13"><a href="#cb82-13" aria-hidden="true" tabindex="-1"></a>  features <span class="ot">&lt;-</span> data[, <span class="fu">setdiff</span>(<span class="fu">names</span>(data), target_name)]</span>
<span id="cb82-14"><a href="#cb82-14" aria-hidden="true" tabindex="-1"></a>  data_matrix <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">model.matrix</span>(<span class="sc">~</span> ., <span class="at">data=</span>features)[,<span class="sc">-</span><span class="dv">1</span>])  <span class="co"># Eliminar el intercepto</span></span>
<span id="cb82-15"><a href="#cb82-15" aria-hidden="true" tabindex="-1"></a>  data_matrix[[target_name]] <span class="ot">&lt;-</span> target</span>
<span id="cb82-16"><a href="#cb82-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb82-17"><a href="#cb82-17" aria-hidden="true" tabindex="-1"></a>  outer_folds <span class="ot">&lt;-</span> <span class="fu">createFolds</span>(data_matrix[[target_name]], <span class="at">k =</span> outer)</span>
<span id="cb82-18"><a href="#cb82-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb82-19"><a href="#cb82-19" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (outer_index <span class="cf">in</span> <span class="fu">seq_along</span>(outer_folds)) {</span>
<span id="cb82-20"><a href="#cb82-20" aria-hidden="true" tabindex="-1"></a>    outer_train_data <span class="ot">&lt;-</span> data_matrix[<span class="sc">-</span>outer_folds[[outer_index]], ]</span>
<span id="cb82-21"><a href="#cb82-21" aria-hidden="true" tabindex="-1"></a>    outer_test_data <span class="ot">&lt;-</span> data_matrix[outer_folds[[outer_index]], ]</span>
<span id="cb82-22"><a href="#cb82-22" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb82-23"><a href="#cb82-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Outer Fold %d</span><span class="sc">\n</span><span class="st">"</span>, outer_index))</span>
<span id="cb82-24"><a href="#cb82-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Training Data - Class 0: "</span>, <span class="fu">sum</span>(outer_train_data[[target_name]] <span class="sc">==</span> <span class="dv">0</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb82-25"><a href="#cb82-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Training Data - Class 1: "</span>, <span class="fu">sum</span>(outer_train_data[[target_name]] <span class="sc">==</span> <span class="dv">1</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb82-26"><a href="#cb82-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Testing Data - Class 0: "</span>, <span class="fu">sum</span>(outer_test_data[[target_name]] <span class="sc">==</span> <span class="dv">0</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb82-27"><a href="#cb82-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Testing Data - Class 1: "</span>, <span class="fu">sum</span>(outer_test_data[[target_name]] <span class="sc">==</span> <span class="dv">1</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb82-28"><a href="#cb82-28" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb82-29"><a href="#cb82-29" aria-hidden="true" tabindex="-1"></a>    inner_folds <span class="ot">&lt;-</span> <span class="fu">createFolds</span>(outer_train_data[[target_name]], <span class="at">k =</span> inner)</span>
<span id="cb82-30"><a href="#cb82-30" aria-hidden="true" tabindex="-1"></a>    best_model <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb82-31"><a href="#cb82-31" aria-hidden="true" tabindex="-1"></a>    best_auc <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb82-32"><a href="#cb82-32" aria-hidden="true" tabindex="-1"></a>    best_size <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb82-33"><a href="#cb82-33" aria-hidden="true" tabindex="-1"></a>    best_decay <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb82-34"><a href="#cb82-34" aria-hidden="true" tabindex="-1"></a>    best_vars <span class="ot">&lt;-</span> <span class="fu">colnames</span>(outer_train_data)[<span class="sc">!</span><span class="fu">colnames</span>(outer_train_data) <span class="sc">%in%</span> target_name]</span>
<span id="cb82-35"><a href="#cb82-35" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb82-36"><a href="#cb82-36" aria-hidden="true" tabindex="-1"></a>    grid <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">size =</span> sizes, <span class="at">decay =</span> decays)</span>
<span id="cb82-37"><a href="#cb82-37" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb82-38"><a href="#cb82-38" aria-hidden="true" tabindex="-1"></a>    select_vars_lasso <span class="ot">&lt;-</span> <span class="cf">function</span>(data, target_name) {</span>
<span id="cb82-39"><a href="#cb82-39" aria-hidden="true" tabindex="-1"></a>      target <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(data[[target_name]])</span>
<span id="cb82-40"><a href="#cb82-40" aria-hidden="true" tabindex="-1"></a>      features <span class="ot">&lt;-</span> data[, <span class="fu">setdiff</span>(<span class="fu">names</span>(data), target_name)]</span>
<span id="cb82-41"><a href="#cb82-41" aria-hidden="true" tabindex="-1"></a>      X <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(<span class="sc">~</span> ., <span class="at">data=</span>features)[,<span class="sc">-</span><span class="dv">1</span>]  <span class="co"># Eliminamos el intercepto</span></span>
<span id="cb82-42"><a href="#cb82-42" aria-hidden="true" tabindex="-1"></a>      y <span class="ot">&lt;-</span> target</span>
<span id="cb82-43"><a href="#cb82-43" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb82-44"><a href="#cb82-44" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Ajustamos el modelo Lasso</span></span>
<span id="cb82-45"><a href="#cb82-45" aria-hidden="true" tabindex="-1"></a>      lasso_model <span class="ot">&lt;-</span> <span class="fu">cv.glmnet</span>(X, y, <span class="at">alpha=</span><span class="dv">1</span>)</span>
<span id="cb82-46"><a href="#cb82-46" aria-hidden="true" tabindex="-1"></a>      lasso_coef <span class="ot">&lt;-</span> <span class="fu">coef</span>(lasso_model, <span class="at">s =</span> <span class="st">"lambda.min"</span>)</span>
<span id="cb82-47"><a href="#cb82-47" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb82-48"><a href="#cb82-48" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Seleccionamos las variables no nulas</span></span>
<span id="cb82-49"><a href="#cb82-49" aria-hidden="true" tabindex="-1"></a>      selected_vars <span class="ot">&lt;-</span> <span class="fu">rownames</span>(lasso_coef)[lasso_coef[, <span class="dv">1</span>] <span class="sc">!=</span> <span class="dv">0</span>]</span>
<span id="cb82-50"><a href="#cb82-50" aria-hidden="true" tabindex="-1"></a>      selected_vars <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(selected_vars, <span class="st">"(Intercept)"</span>)</span>
<span id="cb82-51"><a href="#cb82-51" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cat</span>(<span class="st">"Selected variables by Lasso: "</span>, <span class="fu">paste</span>(selected_vars, <span class="at">collapse=</span><span class="st">", "</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb82-52"><a href="#cb82-52" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(selected_vars)</span>
<span id="cb82-53"><a href="#cb82-53" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb82-54"><a href="#cb82-54" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb82-55"><a href="#cb82-55" aria-hidden="true" tabindex="-1"></a>    stepAUC <span class="ot">&lt;-</span> <span class="cf">function</span>(vars, data, target_name, grid, inner_folds) {</span>
<span id="cb82-56"><a href="#cb82-56" aria-hidden="true" tabindex="-1"></a>      best_inner_auc <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb82-57"><a href="#cb82-57" aria-hidden="true" tabindex="-1"></a>      best_inner_model <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb82-58"><a href="#cb82-58" aria-hidden="true" tabindex="-1"></a>      best_inner_size <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb82-59"><a href="#cb82-59" aria-hidden="true" tabindex="-1"></a>      best_inner_decay <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb82-60"><a href="#cb82-60" aria-hidden="true" tabindex="-1"></a>      best_inner_vars <span class="ot">&lt;-</span> vars</span>
<span id="cb82-61"><a href="#cb82-61" aria-hidden="true" tabindex="-1"></a>      improved <span class="ot">&lt;-</span> <span class="cn">TRUE</span></span>
<span id="cb82-62"><a href="#cb82-62" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb82-63"><a href="#cb82-63" aria-hidden="true" tabindex="-1"></a>      <span class="cf">while</span> (improved <span class="sc">&amp;&amp;</span> <span class="fu">length</span>(vars) <span class="sc">&gt;</span> <span class="dv">1</span>) {</span>
<span id="cb82-64"><a href="#cb82-64" aria-hidden="true" tabindex="-1"></a>        improved <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb82-65"><a href="#cb82-65" aria-hidden="true" tabindex="-1"></a>        best_auc_in_step <span class="ot">&lt;-</span> best_inner_auc</span>
<span id="cb82-66"><a href="#cb82-66" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb82-67"><a href="#cb82-67" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (params <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(grid)) {</span>
<span id="cb82-68"><a href="#cb82-68" aria-hidden="true" tabindex="-1"></a>          auc_vals <span class="ot">&lt;-</span> <span class="fu">numeric</span>()</span>
<span id="cb82-69"><a href="#cb82-69" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb82-70"><a href="#cb82-70" aria-hidden="true" tabindex="-1"></a>          <span class="cf">for</span> (inner_index <span class="cf">in</span> <span class="fu">seq_along</span>(inner_folds)) {</span>
<span id="cb82-71"><a href="#cb82-71" aria-hidden="true" tabindex="-1"></a>            inner_train_data <span class="ot">&lt;-</span> outer_train_data[<span class="sc">-</span>inner_folds[[inner_index]], ]</span>
<span id="cb82-72"><a href="#cb82-72" aria-hidden="true" tabindex="-1"></a>            inner_test_data <span class="ot">&lt;-</span> outer_train_data[inner_folds[[inner_index]], ]</span>
<span id="cb82-73"><a href="#cb82-73" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb82-74"><a href="#cb82-74" aria-hidden="true" tabindex="-1"></a>            selected_vars <span class="ot">&lt;-</span> <span class="fu">select_vars_lasso</span>(inner_train_data, target_name)</span>
<span id="cb82-75"><a href="#cb82-75" aria-hidden="true" tabindex="-1"></a>            formula <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(<span class="fu">paste</span>(target_name, <span class="st">"~"</span>, <span class="fu">paste</span>(selected_vars, <span class="at">collapse =</span> <span class="st">"+"</span>)))</span>
<span id="cb82-76"><a href="#cb82-76" aria-hidden="true" tabindex="-1"></a>            <span class="co">#cat("Testing with formula: ", deparse(formula), "\n")</span></span>
<span id="cb82-77"><a href="#cb82-77" aria-hidden="true" tabindex="-1"></a>            <span class="co">#cat("Grid parameters - size: ", grid$size[params], ", decay: ", grid$decay[params], "\n")</span></span>
<span id="cb82-78"><a href="#cb82-78" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb82-79"><a href="#cb82-79" aria-hidden="true" tabindex="-1"></a>            result <span class="ot">&lt;-</span> <span class="fu">tryCatch</span>({</span>
<span id="cb82-80"><a href="#cb82-80" aria-hidden="true" tabindex="-1"></a>              model <span class="ot">&lt;-</span> <span class="fu">nnet</span>(formula, <span class="at">data =</span> inner_train_data, <span class="at">size =</span> grid<span class="sc">$</span>size[params], </span>
<span id="cb82-81"><a href="#cb82-81" aria-hidden="true" tabindex="-1"></a>                            <span class="at">decay =</span> grid<span class="sc">$</span>decay[params], <span class="at">linout =</span> <span class="cn">FALSE</span>, <span class="at">maxit =</span> <span class="dv">200</span>, <span class="at">trace =</span> <span class="cn">FALSE</span>)</span>
<span id="cb82-82"><a href="#cb82-82" aria-hidden="true" tabindex="-1"></a>              </span>
<span id="cb82-83"><a href="#cb82-83" aria-hidden="true" tabindex="-1"></a>              predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(model, inner_test_data, <span class="at">type =</span> <span class="st">"raw"</span>)</span>
<span id="cb82-84"><a href="#cb82-84" aria-hidden="true" tabindex="-1"></a>              roc_curve <span class="ot">&lt;-</span> <span class="fu">roc</span>(inner_test_data[[target_name]], predictions)</span>
<span id="cb82-85"><a href="#cb82-85" aria-hidden="true" tabindex="-1"></a>              auc_vals[inner_index] <span class="ot">&lt;-</span> roc_curve<span class="sc">$</span>auc</span>
<span id="cb82-86"><a href="#cb82-86" aria-hidden="true" tabindex="-1"></a>              <span class="co">#cat("AUC for inner fold ", inner_index, ": ", roc_curve$auc, "\n")</span></span>
<span id="cb82-87"><a href="#cb82-87" aria-hidden="true" tabindex="-1"></a>              </span>
<span id="cb82-88"><a href="#cb82-88" aria-hidden="true" tabindex="-1"></a>            }, <span class="at">error =</span> <span class="cf">function</span>(e) {</span>
<span id="cb82-89"><a href="#cb82-89" aria-hidden="true" tabindex="-1"></a>              <span class="fu">cat</span>(<span class="st">"Error with variables: "</span>, <span class="fu">paste</span>(selected_vars, <span class="at">collapse =</span> <span class="st">", "</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb82-90"><a href="#cb82-90" aria-hidden="true" tabindex="-1"></a>              <span class="fu">cat</span>(<span class="st">"Error message: "</span>, e<span class="sc">$</span>message, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb82-91"><a href="#cb82-91" aria-hidden="true" tabindex="-1"></a>              auc_vals[inner_index] <span class="ot">&lt;-</span> <span class="cn">NA</span>  <span class="co"># Set to NA or some other indicator of failure</span></span>
<span id="cb82-92"><a href="#cb82-92" aria-hidden="true" tabindex="-1"></a>            })</span>
<span id="cb82-93"><a href="#cb82-93" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb82-94"><a href="#cb82-94" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb82-95"><a href="#cb82-95" aria-hidden="true" tabindex="-1"></a>          mean_auc <span class="ot">&lt;-</span> <span class="fu">mean</span>(auc_vals, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb82-96"><a href="#cb82-96" aria-hidden="true" tabindex="-1"></a>          <span class="co">#cat("Mean AUC for params - size: ", grid$size[params], ", decay: ", grid$decay[params], ": ", mean_auc, "\n")</span></span>
<span id="cb82-97"><a href="#cb82-97" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.na</span>(mean_auc) <span class="sc">&amp;&amp;</span> mean_auc <span class="sc">&gt;</span> best_auc_in_step) {</span>
<span id="cb82-98"><a href="#cb82-98" aria-hidden="true" tabindex="-1"></a>            best_auc_in_step <span class="ot">&lt;-</span> mean_auc</span>
<span id="cb82-99"><a href="#cb82-99" aria-hidden="true" tabindex="-1"></a>            best_inner_model <span class="ot">&lt;-</span> model</span>
<span id="cb82-100"><a href="#cb82-100" aria-hidden="true" tabindex="-1"></a>            best_inner_size <span class="ot">&lt;-</span> grid<span class="sc">$</span>size[params]</span>
<span id="cb82-101"><a href="#cb82-101" aria-hidden="true" tabindex="-1"></a>            best_inner_decay <span class="ot">&lt;-</span> grid<span class="sc">$</span>decay[params]</span>
<span id="cb82-102"><a href="#cb82-102" aria-hidden="true" tabindex="-1"></a>            best_inner_vars <span class="ot">&lt;-</span> selected_vars</span>
<span id="cb82-103"><a href="#cb82-103" aria-hidden="true" tabindex="-1"></a>            improved <span class="ot">&lt;-</span> <span class="cn">TRUE</span></span>
<span id="cb82-104"><a href="#cb82-104" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb82-105"><a href="#cb82-105" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb82-106"><a href="#cb82-106" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb82-107"><a href="#cb82-107" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (improved) {</span>
<span id="cb82-108"><a href="#cb82-108" aria-hidden="true" tabindex="-1"></a>          vars <span class="ot">&lt;-</span> best_inner_vars</span>
<span id="cb82-109"><a href="#cb82-109" aria-hidden="true" tabindex="-1"></a>          best_inner_auc <span class="ot">&lt;-</span> best_auc_in_step</span>
<span id="cb82-110"><a href="#cb82-110" aria-hidden="true" tabindex="-1"></a>          <span class="fu">cat</span>(<span class="st">"Vars improved: "</span>, <span class="fu">paste</span>(vars, <span class="at">collapse=</span><span class="st">", "</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb82-111"><a href="#cb82-111" aria-hidden="true" tabindex="-1"></a>          <span class="fu">cat</span>(<span class="st">"AUC: "</span>, best_inner_auc, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb82-112"><a href="#cb82-112" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb82-113"><a href="#cb82-113" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb82-114"><a href="#cb82-114" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb82-115"><a href="#cb82-115" aria-hidden="true" tabindex="-1"></a>      <span class="fu">list</span>(<span class="at">model =</span> best_inner_model, <span class="at">auc =</span> best_inner_auc, </span>
<span id="cb82-116"><a href="#cb82-116" aria-hidden="true" tabindex="-1"></a>           <span class="at">size =</span> best_inner_size, <span class="at">decay =</span> best_inner_decay, </span>
<span id="cb82-117"><a href="#cb82-117" aria-hidden="true" tabindex="-1"></a>           <span class="at">vars =</span> best_inner_vars)</span>
<span id="cb82-118"><a href="#cb82-118" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb82-119"><a href="#cb82-119" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb82-120"><a href="#cb82-120" aria-hidden="true" tabindex="-1"></a>    best_result <span class="ot">&lt;-</span> <span class="fu">stepAUC</span>(best_vars, outer_train_data, target_name, grid, inner_folds)</span>
<span id="cb82-121"><a href="#cb82-121" aria-hidden="true" tabindex="-1"></a>    best_model <span class="ot">&lt;-</span> best_result<span class="sc">$</span>model</span>
<span id="cb82-122"><a href="#cb82-122" aria-hidden="true" tabindex="-1"></a>    best_auc <span class="ot">&lt;-</span> best_result<span class="sc">$</span>auc</span>
<span id="cb82-123"><a href="#cb82-123" aria-hidden="true" tabindex="-1"></a>    best_size <span class="ot">&lt;-</span> best_result<span class="sc">$</span>size</span>
<span id="cb82-124"><a href="#cb82-124" aria-hidden="true" tabindex="-1"></a>    best_decay <span class="ot">&lt;-</span> best_result<span class="sc">$</span>decay</span>
<span id="cb82-125"><a href="#cb82-125" aria-hidden="true" tabindex="-1"></a>    best_vars <span class="ot">&lt;-</span> best_result<span class="sc">$</span>vars</span>
<span id="cb82-126"><a href="#cb82-126" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb82-127"><a href="#cb82-127" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">is.null</span>(best_model)) {</span>
<span id="cb82-128"><a href="#cb82-128" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cat</span>(<span class="st">"Error: No valid model found for outer fold "</span>, outer_index, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb82-129"><a href="#cb82-129" aria-hidden="true" tabindex="-1"></a>      <span class="cf">next</span></span>
<span id="cb82-130"><a href="#cb82-130" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb82-131"><a href="#cb82-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-132"><a href="#cb82-132" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Evaluar el mejor modelo en el validation split del inner loop</span></span>
<span id="cb82-133"><a href="#cb82-133" aria-hidden="true" tabindex="-1"></a>    inner_auc_vals <span class="ot">&lt;-</span> <span class="fu">numeric</span>()</span>
<span id="cb82-134"><a href="#cb82-134" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (inner_index <span class="cf">in</span> <span class="fu">seq_along</span>(inner_folds)) {</span>
<span id="cb82-135"><a href="#cb82-135" aria-hidden="true" tabindex="-1"></a>      inner_train_data <span class="ot">&lt;-</span> outer_train_data[<span class="sc">-</span>inner_folds[[inner_index]], ]</span>
<span id="cb82-136"><a href="#cb82-136" aria-hidden="true" tabindex="-1"></a>      inner_test_data <span class="ot">&lt;-</span> outer_train_data[inner_folds[[inner_index]], ]</span>
<span id="cb82-137"><a href="#cb82-137" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb82-138"><a href="#cb82-138" aria-hidden="true" tabindex="-1"></a>      predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(best_model, inner_test_data, <span class="at">type =</span> <span class="st">"raw"</span>)</span>
<span id="cb82-139"><a href="#cb82-139" aria-hidden="true" tabindex="-1"></a>      roc_curve <span class="ot">&lt;-</span> <span class="fu">roc</span>(inner_test_data[[target_name]], predictions)</span>
<span id="cb82-140"><a href="#cb82-140" aria-hidden="true" tabindex="-1"></a>      inner_auc_vals[inner_index] <span class="ot">&lt;-</span> roc_curve<span class="sc">$</span>auc</span>
<span id="cb82-141"><a href="#cb82-141" aria-hidden="true" tabindex="-1"></a>      <span class="co">#cat("Inner fold ", inner_index, " AUC: ", roc_curve$auc, "\n")</span></span>
<span id="cb82-142"><a href="#cb82-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-143"><a href="#cb82-143" aria-hidden="true" tabindex="-1"></a>      pred_class <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(predictions <span class="sc">&gt;</span> threshold, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb82-144"><a href="#cb82-144" aria-hidden="true" tabindex="-1"></a>      confusion <span class="ot">&lt;-</span> <span class="fu">table</span>(<span class="at">Actual =</span> inner_test_data[[target_name]], <span class="at">Predicted =</span> pred_class)</span>
<span id="cb82-145"><a href="#cb82-145" aria-hidden="true" tabindex="-1"></a>      TP <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span>, confusion[<span class="dv">2</span>, <span class="dv">2</span>], <span class="dv">0</span>)</span>
<span id="cb82-146"><a href="#cb82-146" aria-hidden="true" tabindex="-1"></a>      TN <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span>, confusion[<span class="dv">1</span>, <span class="dv">1</span>], <span class="dv">0</span>)</span>
<span id="cb82-147"><a href="#cb82-147" aria-hidden="true" tabindex="-1"></a>      FP <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span>, confusion[<span class="dv">1</span>, <span class="dv">2</span>], <span class="dv">0</span>)</span>
<span id="cb82-148"><a href="#cb82-148" aria-hidden="true" tabindex="-1"></a>      FN <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span>, confusion[<span class="dv">2</span>, <span class="dv">1</span>], <span class="dv">0</span>)</span>
<span id="cb82-149"><a href="#cb82-149" aria-hidden="true" tabindex="-1"></a>      auc <span class="ot">&lt;-</span> roc_curve<span class="sc">$</span>auc</span>
<span id="cb82-150"><a href="#cb82-150" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb82-151"><a href="#cb82-151" aria-hidden="true" tabindex="-1"></a>      inner_metrics <span class="ot">&lt;-</span> <span class="fu">setNames</span>(<span class="fu">c</span>(outer_index, inner_index, TP, TN, FP, FN, auc), <span class="fu">names</span>(inner_fold_metrics))</span>
<span id="cb82-152"><a href="#cb82-152" aria-hidden="true" tabindex="-1"></a>      inner_fold_metrics <span class="ot">&lt;-</span> <span class="fu">rbind</span>(inner_fold_metrics, <span class="fu">as.data.frame</span>(<span class="fu">t</span>(inner_metrics)))</span>
<span id="cb82-153"><a href="#cb82-153" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb82-154"><a href="#cb82-154" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb82-155"><a href="#cb82-155" aria-hidden="true" tabindex="-1"></a>    best_inner_auc <span class="ot">&lt;-</span> <span class="fu">mean</span>(inner_auc_vals, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb82-156"><a href="#cb82-156" aria-hidden="true" tabindex="-1"></a>    <span class="co">#cat("Best inner AUC: ", best_inner_auc, "\n")</span></span>
<span id="cb82-157"><a href="#cb82-157" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Reentrenar el mejor modelo con todos los datos de outer_train_data</span></span>
<span id="cb82-158"><a href="#cb82-158" aria-hidden="true" tabindex="-1"></a>    best_model <span class="ot">&lt;-</span> <span class="fu">nnet</span>(<span class="fu">as.formula</span>(<span class="fu">paste</span>(target_name, <span class="st">"~"</span>, <span class="fu">paste</span>(best_vars, <span class="at">collapse =</span> <span class="st">"+"</span>))),</span>
<span id="cb82-159"><a href="#cb82-159" aria-hidden="true" tabindex="-1"></a>                       <span class="at">data =</span> outer_train_data, <span class="at">size =</span> best_size, <span class="at">decay =</span> best_decay, </span>
<span id="cb82-160"><a href="#cb82-160" aria-hidden="true" tabindex="-1"></a>                       <span class="at">linout =</span> <span class="cn">FALSE</span>, <span class="at">maxit =</span> <span class="dv">200</span>, <span class="at">trace =</span> <span class="cn">FALSE</span>)</span>
<span id="cb82-161"><a href="#cb82-161" aria-hidden="true" tabindex="-1"></a>    predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(best_model, outer_test_data, <span class="at">type =</span> <span class="st">"raw"</span>)</span>
<span id="cb82-162"><a href="#cb82-162" aria-hidden="true" tabindex="-1"></a>    pred_class <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(predictions <span class="sc">&gt;</span> threshold, <span class="dv">1</span>, <span class="dv">0</span>)  <span class="co"># Asignar clases basadas en umbral</span></span>
<span id="cb82-163"><a href="#cb82-163" aria-hidden="true" tabindex="-1"></a>    confusion <span class="ot">&lt;-</span> <span class="fu">table</span>(<span class="at">Actual =</span> outer_test_data[[target_name]], <span class="at">Predicted =</span> pred_class)</span>
<span id="cb82-164"><a href="#cb82-164" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb82-165"><a href="#cb82-165" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">nrow</span>(confusion) <span class="sc">&lt;</span> <span class="dv">2</span> <span class="sc">||</span> <span class="fu">ncol</span>(confusion) <span class="sc">&lt;</span> <span class="dv">2</span>) {</span>
<span id="cb82-166"><a href="#cb82-166" aria-hidden="true" tabindex="-1"></a>      TP <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span>, confusion[<span class="dv">2</span>, <span class="dv">2</span>], <span class="dv">0</span>)</span>
<span id="cb82-167"><a href="#cb82-167" aria-hidden="true" tabindex="-1"></a>      TN <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span>, confusion[<span class="dv">1</span>, <span class="dv">1</span>], <span class="dv">0</span>)</span>
<span id="cb82-168"><a href="#cb82-168" aria-hidden="true" tabindex="-1"></a>      FP <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span>, confusion[<span class="dv">1</span>, <span class="dv">2</span>], <span class="dv">0</span>)</span>
<span id="cb82-169"><a href="#cb82-169" aria-hidden="true" tabindex="-1"></a>      FN <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">2</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(confusion) <span class="sc">&gt;=</span> <span class="dv">1</span>, confusion[<span class="dv">2</span>, <span class="dv">1</span>], <span class="dv">0</span>)</span>
<span id="cb82-170"><a href="#cb82-170" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb82-171"><a href="#cb82-171" aria-hidden="true" tabindex="-1"></a>      TP <span class="ot">&lt;-</span> confusion[<span class="dv">2</span>, <span class="dv">2</span>]</span>
<span id="cb82-172"><a href="#cb82-172" aria-hidden="true" tabindex="-1"></a>      TN <span class="ot">&lt;-</span> confusion[<span class="dv">1</span>, <span class="dv">1</span>]</span>
<span id="cb82-173"><a href="#cb82-173" aria-hidden="true" tabindex="-1"></a>      FP <span class="ot">&lt;-</span> confusion[<span class="dv">1</span>, <span class="dv">2</span>]</span>
<span id="cb82-174"><a href="#cb82-174" aria-hidden="true" tabindex="-1"></a>      FN <span class="ot">&lt;-</span> confusion[<span class="dv">2</span>, <span class="dv">1</span>]</span>
<span id="cb82-175"><a href="#cb82-175" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb82-176"><a href="#cb82-176" aria-hidden="true" tabindex="-1"></a>    auc <span class="ot">&lt;-</span> <span class="fu">roc</span>(outer_test_data[[target_name]], predictions)<span class="sc">$</span>auc</span>
<span id="cb82-177"><a href="#cb82-177" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb82-178"><a href="#cb82-178" aria-hidden="true" tabindex="-1"></a>    metrics <span class="ot">&lt;-</span> <span class="fu">setNames</span>(<span class="fu">c</span>(outer_index, TP, TN, FP, FN, auc, </span>
<span id="cb82-179"><a href="#cb82-179" aria-hidden="true" tabindex="-1"></a>                          best_size, best_decay, <span class="fu">paste</span>(best_vars, <span class="at">collapse =</span> <span class="st">","</span>)), </span>
<span id="cb82-180"><a href="#cb82-180" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">names</span>(performance_metrics))</span>
<span id="cb82-181"><a href="#cb82-181" aria-hidden="true" tabindex="-1"></a>    performance_metrics <span class="ot">&lt;-</span> <span class="fu">rbind</span>(performance_metrics, <span class="fu">as.data.frame</span>(<span class="fu">t</span>(metrics)))</span>
<span id="cb82-182"><a href="#cb82-182" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb82-183"><a href="#cb82-183" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Performance:</span><span class="sc">\n</span><span class="st">"</span>, <span class="fu">paste</span>(performance_metrics), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb82-184"><a href="#cb82-184" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Confusion Matrix for Fold %d:</span><span class="sc">\n</span><span class="st">"</span>, outer_index))</span>
<span id="cb82-185"><a href="#cb82-185" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(confusion)</span>
<span id="cb82-186"><a href="#cb82-186" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Metrics for Fold %d:</span><span class="sc">\n</span><span class="st">"</span>, outer_index))</span>
<span id="cb82-187"><a href="#cb82-187" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"TP: %d, TN: %d, FP: %d, FN: %d, AUC: %f, Best Size: %d, Best Decay: %f, Best Variables: %s</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb82-188"><a href="#cb82-188" aria-hidden="true" tabindex="-1"></a>                TP, TN, FP, FN, auc, best_size, best_decay, <span class="fu">paste</span>(best_vars, <span class="at">collapse =</span> <span class="st">","</span>)))</span>
<span id="cb82-189"><a href="#cb82-189" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb82-190"><a href="#cb82-190" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb82-191"><a href="#cb82-191" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="at">performance_metrics =</span> performance_metrics, <span class="at">inner_fold_metrics =</span> inner_fold_metrics)</span>
<span id="cb82-192"><a href="#cb82-192" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb82-193"><a href="#cb82-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-194"><a href="#cb82-194" aria-hidden="true" tabindex="-1"></a>evaluate_with_seeds_ANN_lasso <span class="ot">&lt;-</span> </span>
<span id="cb82-195"><a href="#cb82-195" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(evaluation_function, data, target_var, vars, threshold, seeds, outer, inner, sizes, decays) {</span>
<span id="cb82-196"><a href="#cb82-196" aria-hidden="true" tabindex="-1"></a>  results_list <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb82-197"><a href="#cb82-197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-198"><a href="#cb82-198" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (seed <span class="cf">in</span> seeds) {</span>
<span id="cb82-199"><a href="#cb82-199" aria-hidden="true" tabindex="-1"></a>    <span class="fu">set.seed</span>(seed)</span>
<span id="cb82-200"><a href="#cb82-200" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Evaluating with seed:"</span>, seed, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb82-201"><a href="#cb82-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-202"><a href="#cb82-202" aria-hidden="true" tabindex="-1"></a>    results <span class="ot">&lt;-</span> <span class="fu">evaluation_function</span>(<span class="at">data =</span> data, </span>
<span id="cb82-203"><a href="#cb82-203" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">target_name =</span> target_var, </span>
<span id="cb82-204"><a href="#cb82-204" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">threshold =</span> threshold, </span>
<span id="cb82-205"><a href="#cb82-205" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">outer =</span> outer, </span>
<span id="cb82-206"><a href="#cb82-206" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">inner =</span> inner, </span>
<span id="cb82-207"><a href="#cb82-207" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">seed =</span> seed,</span>
<span id="cb82-208"><a href="#cb82-208" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">sizes =</span> sizes,</span>
<span id="cb82-209"><a href="#cb82-209" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">decays =</span> decays)</span>
<span id="cb82-210"><a href="#cb82-210" aria-hidden="true" tabindex="-1"></a>    results_list[[<span class="fu">paste0</span>(<span class="st">"seed_"</span>, seed)]] <span class="ot">&lt;-</span> results</span>
<span id="cb82-211"><a href="#cb82-211" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb82-212"><a href="#cb82-212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-213"><a href="#cb82-213" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(results_list)</span>
<span id="cb82-214"><a href="#cb82-214" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb82-215"><a href="#cb82-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-216"><a href="#cb82-216" aria-hidden="true" tabindex="-1"></a>performance_ANN_lasso <span class="ot">&lt;-</span> <span class="fu">evaluate_with_seeds_ANN_lasso</span>(</span>
<span id="cb82-217"><a href="#cb82-217" aria-hidden="true" tabindex="-1"></a>  <span class="at">evaluation_function =</span> double_cross_validation_nnet_lasso,</span>
<span id="cb82-218"><a href="#cb82-218" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_factor,</span>
<span id="cb82-219"><a href="#cb82-219" aria-hidden="true" tabindex="-1"></a>  <span class="at">outer =</span> <span class="dv">5</span>,</span>
<span id="cb82-220"><a href="#cb82-220" aria-hidden="true" tabindex="-1"></a>  <span class="at">inner =</span> <span class="dv">2</span>,</span>
<span id="cb82-221"><a href="#cb82-221" aria-hidden="true" tabindex="-1"></a>  <span class="at">target_var =</span> <span class="st">"PCR"</span>,</span>
<span id="cb82-222"><a href="#cb82-222" aria-hidden="true" tabindex="-1"></a>  <span class="at">sizes =</span> <span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">10</span>,<span class="dv">15</span>,<span class="dv">20</span>,<span class="dv">25</span>,<span class="dv">30</span>),</span>
<span id="cb82-223"><a href="#cb82-223" aria-hidden="true" tabindex="-1"></a>  <span class="at">decays =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.2</span>, <span class="fl">0.3</span>, <span class="fl">0.4</span>),</span>
<span id="cb82-224"><a href="#cb82-224" aria-hidden="true" tabindex="-1"></a>  <span class="at">threshold =</span> .<span class="dv">35</span>,</span>
<span id="cb82-225"><a href="#cb82-225" aria-hidden="true" tabindex="-1"></a>  <span class="at">seeds =</span> seeds</span>
<span id="cb82-226"><a href="#cb82-226" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"RData_Files_Algorithms/ANN_Lasso.RData"</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
</section>
<section id="discusión" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Discusión</h1>
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="co">#  Función que combina los dataframes de métricas de rendimiento (performance_metrics) </span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a><span class="co"># e inner_fold_metrics de cada semilla en un solo dataframe, añadiendo una columna </span></span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a><span class="co"># "semilla" para diferenciar cada uno</span></span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a>process_experiment_data <span class="ot">&lt;-</span> <span class="cf">function</span>(raw_data, hyperparameters) {</span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Combinar performance_metrics en un solo dataframe</span></span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a>  performance_metrics <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb84-8"><a href="#cb84-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">lapply</span>(<span class="fu">names</span>(raw_data), <span class="cf">function</span>(seed) {</span>
<span id="cb84-9"><a href="#cb84-9" aria-hidden="true" tabindex="-1"></a>      df <span class="ot">&lt;-</span> raw_data[[seed]]<span class="sc">$</span>performance_metrics</span>
<span id="cb84-10"><a href="#cb84-10" aria-hidden="true" tabindex="-1"></a>      df<span class="sc">$</span>seed <span class="ot">&lt;-</span> seed</span>
<span id="cb84-11"><a href="#cb84-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(df)</span>
<span id="cb84-12"><a href="#cb84-12" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb84-13"><a href="#cb84-13" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb84-14"><a href="#cb84-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb84-15"><a href="#cb84-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Convertir las columnas relevantes a tipo numérico</span></span>
<span id="cb84-16"><a href="#cb84-16" aria-hidden="true" tabindex="-1"></a>  performance_metrics <span class="ot">&lt;-</span> performance_metrics <span class="sc">%&gt;%</span></span>
<span id="cb84-17"><a href="#cb84-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">AUC =</span> <span class="fu">as.numeric</span>(AUC),</span>
<span id="cb84-18"><a href="#cb84-18" aria-hidden="true" tabindex="-1"></a>           <span class="at">Fold =</span> <span class="fu">as.numeric</span>(Fold),</span>
<span id="cb84-19"><a href="#cb84-19" aria-hidden="true" tabindex="-1"></a>           <span class="at">TP =</span> <span class="fu">as.numeric</span>(TP),</span>
<span id="cb84-20"><a href="#cb84-20" aria-hidden="true" tabindex="-1"></a>           <span class="at">TN =</span> <span class="fu">as.numeric</span>(TN),</span>
<span id="cb84-21"><a href="#cb84-21" aria-hidden="true" tabindex="-1"></a>           <span class="at">FP =</span> <span class="fu">as.numeric</span>(FP),</span>
<span id="cb84-22"><a href="#cb84-22" aria-hidden="true" tabindex="-1"></a>           <span class="at">FN =</span> <span class="fu">as.numeric</span>(FN),</span>
<span id="cb84-23"><a href="#cb84-23" aria-hidden="true" tabindex="-1"></a>           <span class="at">Seed =</span> <span class="fu">as.factor</span>(seed))</span>
<span id="cb84-24"><a href="#cb84-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb84-25"><a href="#cb84-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Convertir los hiperparámetros relevantes a tipo numérico</span></span>
<span id="cb84-26"><a href="#cb84-26" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (param <span class="cf">in</span> hyperparameters) {</span>
<span id="cb84-27"><a href="#cb84-27" aria-hidden="true" tabindex="-1"></a>    performance_metrics[[param]] <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(performance_metrics[[param]])</span>
<span id="cb84-28"><a href="#cb84-28" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb84-29"><a href="#cb84-29" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb84-30"><a href="#cb84-30" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Combinar inner_fold_metrics en un solo dataframe</span></span>
<span id="cb84-31"><a href="#cb84-31" aria-hidden="true" tabindex="-1"></a>  inner_fold_metrics <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb84-32"><a href="#cb84-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">lapply</span>(<span class="fu">names</span>(raw_data), <span class="cf">function</span>(seed) {</span>
<span id="cb84-33"><a href="#cb84-33" aria-hidden="true" tabindex="-1"></a>      df <span class="ot">&lt;-</span> raw_data[[seed]]<span class="sc">$</span>inner_fold_metrics</span>
<span id="cb84-34"><a href="#cb84-34" aria-hidden="true" tabindex="-1"></a>      df<span class="sc">$</span>seed <span class="ot">&lt;-</span> seed</span>
<span id="cb84-35"><a href="#cb84-35" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(df)</span>
<span id="cb84-36"><a href="#cb84-36" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb84-37"><a href="#cb84-37" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb84-38"><a href="#cb84-38" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb84-39"><a href="#cb84-39" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Convertir las columnas relevantes a tipo numérico</span></span>
<span id="cb84-40"><a href="#cb84-40" aria-hidden="true" tabindex="-1"></a>  inner_fold_metrics <span class="ot">&lt;-</span> inner_fold_metrics <span class="sc">%&gt;%</span></span>
<span id="cb84-41"><a href="#cb84-41" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">AUC =</span> <span class="fu">as.numeric</span>(AUC),</span>
<span id="cb84-42"><a href="#cb84-42" aria-hidden="true" tabindex="-1"></a>           <span class="at">Fold =</span> <span class="fu">as.numeric</span>(Fold),</span>
<span id="cb84-43"><a href="#cb84-43" aria-hidden="true" tabindex="-1"></a>           <span class="at">Inner_Fold =</span> <span class="fu">as.numeric</span>(Inner_Fold),</span>
<span id="cb84-44"><a href="#cb84-44" aria-hidden="true" tabindex="-1"></a>           <span class="at">TP =</span> <span class="fu">as.numeric</span>(TP),</span>
<span id="cb84-45"><a href="#cb84-45" aria-hidden="true" tabindex="-1"></a>           <span class="at">TN =</span> <span class="fu">as.numeric</span>(TN),</span>
<span id="cb84-46"><a href="#cb84-46" aria-hidden="true" tabindex="-1"></a>           <span class="at">FP =</span> <span class="fu">as.numeric</span>(FP),</span>
<span id="cb84-47"><a href="#cb84-47" aria-hidden="true" tabindex="-1"></a>           <span class="at">FN =</span> <span class="fu">as.numeric</span>(FN),</span>
<span id="cb84-48"><a href="#cb84-48" aria-hidden="true" tabindex="-1"></a>           <span class="at">Seed =</span> <span class="fu">as.factor</span>(seed))</span>
<span id="cb84-49"><a href="#cb84-49" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb84-50"><a href="#cb84-50" aria-hidden="true" tabindex="-1"></a>  inner_fold_metrics<span class="sc">$</span>seed <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb84-51"><a href="#cb84-51" aria-hidden="true" tabindex="-1"></a>  performance_metrics<span class="sc">$</span>seed <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb84-52"><a href="#cb84-52" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb84-53"><a href="#cb84-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">performance_metrics =</span> performance_metrics, <span class="at">inner_fold_metrics =</span> inner_fold_metrics))</span>
<span id="cb84-54"><a href="#cb84-54" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ANN</span></span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>hyperparameters_ann <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Best_Size"</span>, <span class="st">"Best_Decay"</span>)</span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a>ANN_TodasVariables_Metrics <span class="ot">&lt;-</span> <span class="fu">process_experiment_data</span>(performance_ANN_todasvariables, hyperparameters_ann)</span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a>ANN_Asociacion_Metrics <span class="ot">&lt;-</span> <span class="fu">process_experiment_data</span>(performance_ANN_asociacion, hyperparameters_ann)</span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a>ANN_StepAUC_Metrics <span class="ot">&lt;-</span> <span class="fu">process_experiment_data</span>(performance_ANN_stepAUC, hyperparameters_ann)</span>
<span id="cb85-7"><a href="#cb85-7" aria-hidden="true" tabindex="-1"></a>ANN_Lasso_Metrics <span class="ot">&lt;-</span> <span class="fu">process_experiment_data</span>(performance_ANN_lasso, hyperparameters_ann)</span>
<span id="cb85-8"><a href="#cb85-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-9"><a href="#cb85-9" aria-hidden="true" tabindex="-1"></a><span class="co"># SVM</span></span>
<span id="cb85-10"><a href="#cb85-10" aria-hidden="true" tabindex="-1"></a>hyperparameters_svm <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Best_Cost"</span>, <span class="st">"Best_Kernel"</span>)</span>
<span id="cb85-11"><a href="#cb85-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-12"><a href="#cb85-12" aria-hidden="true" tabindex="-1"></a>SVM_TodasVariables_Metrics <span class="ot">&lt;-</span> <span class="fu">process_experiment_data</span>(performance_SVM_todasvariables, hyperparameters_svm)</span>
<span id="cb85-13"><a href="#cb85-13" aria-hidden="true" tabindex="-1"></a>SVM_Asociacion_Metrics <span class="ot">&lt;-</span> <span class="fu">process_experiment_data</span>(performance_svm_asociacion,hyperparameters_svm)</span>
<span id="cb85-14"><a href="#cb85-14" aria-hidden="true" tabindex="-1"></a>SVM_StepAUC_Metrics <span class="ot">&lt;-</span> <span class="fu">process_experiment_data</span>(performance_SVM_stepauc, hyperparameters_svm)</span>
<span id="cb85-15"><a href="#cb85-15" aria-hidden="true" tabindex="-1"></a>SVM_Lasso_Metrics <span class="ot">&lt;-</span> <span class="fu">process_experiment_data</span>(performance_SVM_lasso, hyperparameters_svm)</span>
<span id="cb85-16"><a href="#cb85-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-17"><a href="#cb85-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-18"><a href="#cb85-18" aria-hidden="true" tabindex="-1"></a><span class="co"># KNN</span></span>
<span id="cb85-19"><a href="#cb85-19" aria-hidden="true" tabindex="-1"></a>hyperparameters_knn <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Best_k"</span>, <span class="st">"Best_l"</span>)</span>
<span id="cb85-20"><a href="#cb85-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-21"><a href="#cb85-21" aria-hidden="true" tabindex="-1"></a>KNN_TodasVariables_Metrics <span class="ot">&lt;-</span> <span class="fu">process_experiment_data</span>(performance_knn_todasvariables, hyperparameters_knn)</span>
<span id="cb85-22"><a href="#cb85-22" aria-hidden="true" tabindex="-1"></a>KNN_Asociacion_Metrics <span class="ot">&lt;-</span> <span class="fu">process_experiment_data</span>(performance_knn_Asociacion, hyperparameters_knn)</span>
<span id="cb85-23"><a href="#cb85-23" aria-hidden="true" tabindex="-1"></a>KNN_StepAUC_Metrics <span class="ot">&lt;-</span> <span class="fu">process_experiment_data</span>(performance_knn_stepauc, hyperparameters_knn)</span>
<span id="cb85-24"><a href="#cb85-24" aria-hidden="true" tabindex="-1"></a>KNN_Lasso_Metrics <span class="ot">&lt;-</span> <span class="fu">process_experiment_data</span>(performance_knn_lasso, hyperparameters_knn)</span>
<span id="cb85-25"><a href="#cb85-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-26"><a href="#cb85-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-27"><a href="#cb85-27" aria-hidden="true" tabindex="-1"></a><span class="co"># RandomForest</span></span>
<span id="cb85-28"><a href="#cb85-28" aria-hidden="true" tabindex="-1"></a>hyperparameters_RandomForest <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Best_ntree"</span>, <span class="st">"Best_mtry"</span>)</span>
<span id="cb85-29"><a href="#cb85-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-30"><a href="#cb85-30" aria-hidden="true" tabindex="-1"></a>RandomForest_TodasVariables_Metrics <span class="ot">&lt;-</span> <span class="fu">process_experiment_data</span>(performance_RandomForest_todasvariables, hyperparameters_RandomForest)</span>
<span id="cb85-31"><a href="#cb85-31" aria-hidden="true" tabindex="-1"></a>RandomForest_Asociacion_Metrics <span class="ot">&lt;-</span> <span class="fu">process_experiment_data</span>(performance_RandomForest_Asociacion, hyperparameters_RandomForest)</span>
<span id="cb85-32"><a href="#cb85-32" aria-hidden="true" tabindex="-1"></a>RandomForest_StepAUC_Metrics <span class="ot">&lt;-</span> <span class="fu">process_experiment_data</span>(performance_RandomForest_StepAUC, <span class="fu">c</span>(<span class="st">"Best_Ntree"</span>, <span class="st">"Best_Mtry"</span>))</span>
<span id="cb85-33"><a href="#cb85-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-34"><a href="#cb85-34" aria-hidden="true" tabindex="-1"></a>RandomForest_StepAUC_Metrics<span class="sc">$</span>performance_metrics <span class="ot">&lt;-</span> RandomForest_StepAUC_Metrics<span class="sc">$</span>performance_metrics <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">Best_ntree =</span> Best_Ntree)</span>
<span id="cb85-35"><a href="#cb85-35" aria-hidden="true" tabindex="-1"></a>RandomForest_StepAUC_Metrics<span class="sc">$</span>performance_metrics <span class="ot">&lt;-</span> RandomForest_StepAUC_Metrics<span class="sc">$</span>performance_metrics <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">Best_mtry =</span> Best_Mtry)</span>
<span id="cb85-36"><a href="#cb85-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-37"><a href="#cb85-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-38"><a href="#cb85-38" aria-hidden="true" tabindex="-1"></a><span class="co"># NaiveBayes</span></span>
<span id="cb85-39"><a href="#cb85-39" aria-hidden="true" tabindex="-1"></a>hyperparameters_NaiveBayes <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb85-40"><a href="#cb85-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-41"><a href="#cb85-41" aria-hidden="true" tabindex="-1"></a>NaiveBayes_TodasVariables_Metrics <span class="ot">&lt;-</span> <span class="fu">process_experiment_data</span>(performance_naiveBayes_todasVariables, hyperparameters_NaiveBayes)</span>
<span id="cb85-42"><a href="#cb85-42" aria-hidden="true" tabindex="-1"></a>NaiveBayes_Asociacion_Metrics <span class="ot">&lt;-</span> <span class="fu">process_experiment_data</span>(performance_naiveBayes_Asociacion, hyperparameters_NaiveBayes)</span>
<span id="cb85-43"><a href="#cb85-43" aria-hidden="true" tabindex="-1"></a>NaiveBayes_StepAUC_Metrics <span class="ot">&lt;-</span> <span class="fu">process_experiment_data</span>(performance_naiveBayes_stepAUC, hyperparameters_NaiveBayes)</span>
<span id="cb85-44"><a href="#cb85-44" aria-hidden="true" tabindex="-1"></a>NaiveBayes_Lasso_Metrics <span class="ot">&lt;-</span> <span class="fu">process_experiment_data</span>(performance_naiveBayes_lasso, hyperparameters_NaiveBayes)</span>
<span id="cb85-45"><a href="#cb85-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-46"><a href="#cb85-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-47"><a href="#cb85-47" aria-hidden="true" tabindex="-1"></a><span class="co"># AdaBoost</span></span>
<span id="cb85-48"><a href="#cb85-48" aria-hidden="true" tabindex="-1"></a>hyperparameters_AdaBoost <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Best_Iteration"</span>)</span>
<span id="cb85-49"><a href="#cb85-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-50"><a href="#cb85-50" aria-hidden="true" tabindex="-1"></a>AdaBoost_TodasVariables_Metrics <span class="ot">&lt;-</span> <span class="fu">process_experiment_data</span>(performance_adaboost_todasvariables, hyperparameters_AdaBoost)</span>
<span id="cb85-51"><a href="#cb85-51" aria-hidden="true" tabindex="-1"></a>AdaBoost_Asociacion_Metrics <span class="ot">&lt;-</span> <span class="fu">process_experiment_data</span>(performance_adaboost_Asociacion, hyperparameters_AdaBoost)</span>
<span id="cb85-52"><a href="#cb85-52" aria-hidden="true" tabindex="-1"></a>AdaBoost_StepAUC_Metrics <span class="ot">&lt;-</span> <span class="fu">process_experiment_data</span>(performance_adaboost_stepAUC, <span class="fu">c</span>(<span class="st">"Best_Iterations"</span>))</span>
<span id="cb85-53"><a href="#cb85-53" aria-hidden="true" tabindex="-1"></a>AdaBoost_Lasso_Metrics <span class="ot">&lt;-</span> <span class="fu">process_experiment_data</span>(performance_adaboost_lasso, hyperparameters_AdaBoost)</span>
<span id="cb85-54"><a href="#cb85-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-55"><a href="#cb85-55" aria-hidden="true" tabindex="-1"></a>AdaBoost_StepAUC_Metrics<span class="sc">$</span>performance_metrics <span class="ot">&lt;-</span> AdaBoost_StepAUC_Metrics<span class="sc">$</span>performance_metrics <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">Best_Iteration =</span> Best_Iterations)</span>
<span id="cb85-56"><a href="#cb85-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-57"><a href="#cb85-57" aria-hidden="true" tabindex="-1"></a><span class="co"># RPart</span></span>
<span id="cb85-58"><a href="#cb85-58" aria-hidden="true" tabindex="-1"></a>hyperparameters_RPart <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Best_cp"</span>, <span class="st">"Best_minsplit"</span>)</span>
<span id="cb85-59"><a href="#cb85-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-60"><a href="#cb85-60" aria-hidden="true" tabindex="-1"></a>RPart_TodasVariables_Metrics <span class="ot">&lt;-</span> <span class="fu">process_experiment_data</span>(performance_rpart_todasvariables, hyperparameters_RPart)</span>
<span id="cb85-61"><a href="#cb85-61" aria-hidden="true" tabindex="-1"></a>RPart_Asociacion_Metrics <span class="ot">&lt;-</span> <span class="fu">process_experiment_data</span>(performance_rpart_Asociacion, hyperparameters_RPart)</span>
<span id="cb85-62"><a href="#cb85-62" aria-hidden="true" tabindex="-1"></a>RPart_StepAUC_Metrics <span class="ot">&lt;-</span> <span class="fu">process_experiment_data</span>(performance_rpart_StepAUC, <span class="fu">c</span>(<span class="st">"Best_CP"</span>, <span class="st">"Best_Minsplit"</span>))</span>
<span id="cb85-63"><a href="#cb85-63" aria-hidden="true" tabindex="-1"></a>RPart_Lasso_Metrics <span class="ot">&lt;-</span> <span class="fu">process_experiment_data</span>(performance_rpart_lasso, hyperparameters_RPart)</span>
<span id="cb85-64"><a href="#cb85-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-65"><a href="#cb85-65" aria-hidden="true" tabindex="-1"></a>RPart_StepAUC_Metrics<span class="sc">$</span>performance_metrics <span class="ot">&lt;-</span> RPart_StepAUC_Metrics<span class="sc">$</span>performance_metrics <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">Best_cp =</span> Best_CP)</span>
<span id="cb85-66"><a href="#cb85-66" aria-hidden="true" tabindex="-1"></a>RPart_StepAUC_Metrics<span class="sc">$</span>performance_metrics <span class="ot">&lt;-</span> RPart_StepAUC_Metrics<span class="sc">$</span>performance_metrics <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">Best_minsplit =</span> Best_Minsplit)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>El primer paso que se seguirá consiste en estandarizar los datos de los experimentos realizados en el apartado <code>Resultados</code> de tal forma que tengamos un único objeto <code>data.frame</code> por cada método de selección de variables. Este objeto <code>data.frame</code> contentrá métricas de rendimiento del modelo (TP, TN, AUC, etc.), las variables seleccionadas por el método aplicado y los hiperparámetros que han dado lugar al mejor rendimiento del modelo, estos datos se repiten por cada outer fold, por cada semilla aplicada, de tal forma que, como hemos aplicado 5 semillas (<code>27, 3, 123, 50, 90</code>), y hemos realizado una doble validación cruzada 5x2, tendremos un <code>data.frame</code> de 25 filas por cada método de selección de variables aplicado. Por otra parte, también se han estandarizado de la misma forma las métricas de rendmiento de la evaluación del mejor modelo encontrado en los folds internos con los conjuntos de validación de los folds internos. Estos datos servirán para validar que no haya habido sobre entrenamientos.</p>
<p>A continuación se muestra una porción de cada uno de estos <code>data.frame</code>:</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" role="tab" aria-controls="tabset-2-1" aria-selected="true" href="">Conjunto <code>performance_metrics</code> de los Folds Externos</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" role="tab" aria-controls="tabset-2-2" aria-selected="false" href="">Conjunto <code>inner_performance</code> de los Folds Internos</a></li></ul>
<div class="tab-content">
<div id="tabset-2-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-2-1-tab">
<p>Se muestra el <code>data.frame</code> generado con los datos de rendimiento para los folds externos por semillas y folds para el método wrapped <em>StepAUC</em> para las redes de neuronas artificiales.</p>
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="fu">head</span>(ANN_StepAUC_Metrics<span class="sc">$</span>performance_metrics, <span class="dv">10</span>))</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 5%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 11%">
<col style="width: 42%">
<col style="width: 8%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">Fold</th>
<th style="text-align: right;">TP</th>
<th style="text-align: right;">TN</th>
<th style="text-align: right;">FP</th>
<th style="text-align: right;">FN</th>
<th style="text-align: right;">AUC</th>
<th style="text-align: right;">Best_Size</th>
<th style="text-align: right;">Best_Decay</th>
<th style="text-align: left;">Best_Variables</th>
<th style="text-align: left;">Seed</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">66</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">0.7172619</td>
<td style="text-align: right;">30</td>
<td style="text-align: right;">0.3</td>
<td style="text-align: left;">Edad,REst,Estadio,NodAfec,Grado,Fenotipo</td>
<td style="text-align: left;">seed_27</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">82</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">0.7979497</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">0.4</td>
<td style="text-align: left;">Edad,REst,RPro,NodAfec,Grado</td>
<td style="text-align: left;">seed_27</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">68</td>
<td style="text-align: right;">17</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">0.7231618</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">0.1</td>
<td style="text-align: left;">Edad,Estadio,Grado,Fenotipo</td>
<td style="text-align: left;">seed_27</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">71</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">17</td>
<td style="text-align: right;">0.7528894</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">0.3</td>
<td style="text-align: left;">Edad,REst,Grado,Fenotipo</td>
<td style="text-align: left;">seed_27</td>
</tr>
<tr class="odd">
<td style="text-align: right;">5</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">52</td>
<td style="text-align: right;">29</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">0.6405056</td>
<td style="text-align: right;">25</td>
<td style="text-align: right;">0.4</td>
<td style="text-align: left;">REst,Estadio,Grado,Fenotipo</td>
<td style="text-align: left;">seed_27</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">66</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">0.7953488</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">0.3</td>
<td style="text-align: left;">REst,Estadio,Grado,Fenotipo</td>
<td style="text-align: left;">seed_3</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">67</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">0.7520638</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">0.1</td>
<td style="text-align: left;">Edad,Grado,Fenotipo</td>
<td style="text-align: left;">seed_3</td>
</tr>
<tr class="even">
<td style="text-align: right;">3</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">75</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">0.6663996</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">0.2</td>
<td style="text-align: left;">NodAfec,Grado,Fenotipo</td>
<td style="text-align: left;">seed_3</td>
</tr>
<tr class="odd">
<td style="text-align: right;">4</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">73</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">0.8110294</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">0.2</td>
<td style="text-align: left;">Edad,Estadio,Grado,Fenotipo</td>
<td style="text-align: left;">seed_3</td>
</tr>
<tr class="even">
<td style="text-align: right;">5</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">74</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">0.7254556</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">0.4</td>
<td style="text-align: left;">Edad,REst,NodAfec,Grado,Fenotipo</td>
<td style="text-align: left;">seed_3</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div id="tabset-2-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-2-tab">
<p>Se muestra el <code>data.frame</code> generado con los datos de rendimiento para los folds iternos por semillas y folds para el método wrapped <em>StepAUC</em> para las redes de neuronas artificiales.</p>
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="fu">head</span>(ANN_StepAUC_Metrics<span class="sc">$</span>inner_fold_metrics, <span class="dv">15</span>))</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">Fold</th>
<th style="text-align: right;">Inner_Fold</th>
<th style="text-align: right;">TP</th>
<th style="text-align: right;">TN</th>
<th style="text-align: right;">FP</th>
<th style="text-align: right;">FN</th>
<th style="text-align: right;">AUC</th>
<th style="text-align: left;">Seed</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">17</td>
<td style="text-align: right;">148</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">23</td>
<td style="text-align: right;">0.7957822</td>
<td style="text-align: left;">seed_27</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">151</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">28</td>
<td style="text-align: right;">0.7771877</td>
<td style="text-align: left;">seed_27</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">151</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">40</td>
<td style="text-align: right;">0.7231997</td>
<td style="text-align: left;">seed_27</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">166</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">31</td>
<td style="text-align: right;">0.7717543</td>
<td style="text-align: left;">seed_27</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">29</td>
<td style="text-align: right;">134</td>
<td style="text-align: right;">25</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">0.8262579</td>
<td style="text-align: left;">seed_27</td>
</tr>
<tr class="even">
<td style="text-align: right;">3</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">125</td>
<td style="text-align: right;">40</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">0.7383838</td>
<td style="text-align: left;">seed_27</td>
</tr>
<tr class="odd">
<td style="text-align: right;">4</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">174</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">29</td>
<td style="text-align: right;">0.7679350</td>
<td style="text-align: left;">seed_27</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">156</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">47</td>
<td style="text-align: right;">0.7714130</td>
<td style="text-align: left;">seed_27</td>
</tr>
<tr class="odd">
<td style="text-align: right;">5</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">166</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">33</td>
<td style="text-align: right;">0.8341837</td>
<td style="text-align: left;">seed_27</td>
</tr>
<tr class="even">
<td style="text-align: right;">5</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">158</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">43</td>
<td style="text-align: right;">0.7369913</td>
<td style="text-align: left;">seed_27</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">164</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">40</td>
<td style="text-align: right;">0.7891006</td>
<td style="text-align: left;">seed_3</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">159</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">44</td>
<td style="text-align: right;">0.7339909</td>
<td style="text-align: left;">seed_3</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">149</td>
<td style="text-align: right;">17</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">0.7802833</td>
<td style="text-align: left;">seed_3</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">146</td>
<td style="text-align: right;">18</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">0.7987805</td>
<td style="text-align: left;">seed_3</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">164</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">39</td>
<td style="text-align: right;">0.7952627</td>
<td style="text-align: left;">seed_3</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</div>
<section id="rendimiento-aparente" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="rendimiento-aparente"><span class="header-section-number">4.1</span> Rendimiento Aparente</h2>
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>modelos <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"NaiveBayes"</span>, <span class="st">"Adaboost"</span>, <span class="st">"KNN"</span>, <span class="st">"DT"</span>, <span class="st">"RF"</span>, <span class="st">"SVM"</span>, <span class="st">"ANN"</span>)</span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>auc_values <span class="ot">&lt;-</span> <span class="fu">c</span>(resultadosAparentesNaiveBayes<span class="sc">$</span>roc_curve<span class="sc">$</span>auc,</span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>                resultadosAparentesAdaBoost<span class="sc">$</span>roc_curve<span class="sc">$</span>auc,</span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a>                resultadosAparentesKNN<span class="sc">$</span>roc_curve<span class="sc">$</span>auc,</span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a>                resultadosAparentesDT<span class="sc">$</span>roc_curve<span class="sc">$</span>auc,</span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a>                resultadosAparentesRF<span class="sc">$</span>roc_curve<span class="sc">$</span>auc,</span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a>                resultadosAparentesSVM<span class="sc">$</span>roc_curve<span class="sc">$</span>auc,</span>
<span id="cb88-8"><a href="#cb88-8" aria-hidden="true" tabindex="-1"></a>                resultadosAparentesNN<span class="sc">$</span>roc_curve<span class="sc">$</span>auc)</span>
<span id="cb88-9"><a href="#cb88-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-10"><a href="#cb88-10" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Modelo =</span> modelos, <span class="at">AUC =</span> auc_values)</span>
<span id="cb88-11"><a href="#cb88-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-12"><a href="#cb88-12" aria-hidden="true" tabindex="-1"></a>fig <span class="ot">&lt;-</span> <span class="fu">plot_ly</span>(data, <span class="at">x =</span> <span class="sc">~</span>Modelo, <span class="at">y =</span> <span class="sc">~</span>AUC, <span class="at">type =</span> <span class="st">'bar'</span>,</span>
<span id="cb88-13"><a href="#cb88-13" aria-hidden="true" tabindex="-1"></a>               <span class="at">marker =</span> <span class="fu">list</span>(<span class="at">color =</span> <span class="st">'rgb(158,202,225)'</span>,</span>
<span id="cb88-14"><a href="#cb88-14" aria-hidden="true" tabindex="-1"></a>                             <span class="at">line =</span> <span class="fu">list</span>(<span class="at">color =</span> <span class="st">'rgb(8,48,107)'</span>, <span class="at">width =</span> <span class="fl">1.5</span>)))</span>
<span id="cb88-15"><a href="#cb88-15" aria-hidden="true" tabindex="-1"></a>fig <span class="ot">&lt;-</span> fig <span class="sc">%&gt;%</span> <span class="fu">layout</span>(<span class="at">title =</span> <span class="st">"Diferencia de AUC entre Modelos"</span>,</span>
<span id="cb88-16"><a href="#cb88-16" aria-hidden="true" tabindex="-1"></a>                      <span class="at">xaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">"Modelo"</span>),</span>
<span id="cb88-17"><a href="#cb88-17" aria-hidden="true" tabindex="-1"></a>                      <span class="at">yaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">"AUC"</span>),</span>
<span id="cb88-18"><a href="#cb88-18" aria-hidden="true" tabindex="-1"></a>                      <span class="at">margin =</span> <span class="fu">list</span>(<span class="at">b =</span> <span class="dv">100</span>))</span>
<span id="cb88-19"><a href="#cb88-19" aria-hidden="true" tabindex="-1"></a>                      </span>
<span id="cb88-20"><a href="#cb88-20" aria-hidden="true" tabindex="-1"></a>fig</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-378e76caa374e8ae920c" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-378e76caa374e8ae920c">{"x":{"visdat":{"3f58621837b2":["function () ","plotlyVisDat"]},"cur_data":"3f58621837b2","attrs":{"3f58621837b2":{"x":{},"y":{},"marker":{"color":"rgb(158,202,225)","line":{"color":"rgb(8,48,107)","width":1.5}},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"bar"}},"layout":{"margin":{"b":100,"l":60,"t":25,"r":10},"title":"Diferencia de AUC entre Modelos","xaxis":{"domain":[0,1],"automargin":true,"title":"Modelo","type":"category","categoryorder":"array","categoryarray":["Adaboost","ANN","DT","KNN","NaiveBayes","RF","SVM"]},"yaxis":{"domain":[0,1],"automargin":true,"title":"AUC"},"hovermode":"closest","showlegend":false},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":["NaiveBayes","Adaboost","KNN","DT","RF","SVM","ANN"],"y":[0.77672816181373638,0.76671359067447087,0.80679657207774569,0.96978340865871426,0.94819836506878075,0.66590106443407182,0.97301869551258302],"marker":{"color":"rgb(158,202,225)","line":{"color":"rgb(8,48,107)","width":1.5}},"type":"bar","error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>Como se puede observar por el rendimiento aparente, los modelos más prometedores en este estudio parecen ser las Redes de Neuronas Artificiales, los Decision Tree, y los Random Forest. Se tomarán estas medidas como cuantificaciones optimistas del máximo rendimiento que se puede obtener para el modelo, sirviendo así como base para la comparación continua de esta sección del proyecto.</p>
</section>
<section id="estabilidad-de-auc-entre-folds" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="estabilidad-de-auc-entre-folds"><span class="header-section-number">4.2</span> Estabilidad de AUC entre Folds</h2>
<p>Esta sección se dedica al estudio de la estabilidad de las métricas de rendimiento para todos los modelos. Una de las principales características deseadas en un modelo de Aprendizaje Automático es la robustez en sus predicciones. Un modelo puede alcanzar un AUC máximo alto; sin embargo, si la varianza del AUC correspondiente a sus predicciones es muy alta, esto indica que el modelo es demasiado sensible a los datos de entrada, lo que podría resultar en predicciones inesperadas.</p>
<p>Para abordar esta cuestión, se llevará a cabo un estudio comparativo para cada método de selección de variables utilizado por cada modelo, considerando las diferentes semillas y folds externos aplicados en la validación interna.</p>
<p>Un modelo será considerado óptimo en esta sección si logra un alto AUC medio y si la variabilidad de sus AUC en función de la semilla y el fold es baja. Además, se evaluará si todos los métodos de selección de variables muestran un patrón consistente de AUC a lo largo de los diferentes folds, independientemente de la semilla. Esto indicaría que las fluctuaciones observadas se deben a la divisiones de los datos y no a la estructura del modelo, señalando una limitación impuesta por las muestras utilizadas.</p>
<p>A continuación, se comentan las gráficas que serán generadas para el estudio comparativo</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-3-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-1" role="tab" aria-controls="tabset-3-1" aria-selected="true" href="">AUC Medio entre Inner Folds y Outer Folds</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-2" role="tab" aria-controls="tabset-3-2" aria-selected="false" href="">AUC Medio por Outer Fold</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-3" role="tab" aria-controls="tabset-3-3" aria-selected="false" href="">Comparativa entre los métodos de Selección de Variables</a></li></ul>
<div class="tab-content">
<div id="tabset-3-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-3-1-tab">
<p>El objetivo del gráfico comparativo del AUC medio de los inner folds y los outer folds es visualizar y comparar el rendimiento del modelo durante el proceso de validación cruzada. Específicamente, el gráfico de barras muestra los valores promedio del AUC tanto para los inner folds como para los outer folds, agrupados por fold. Al hacerlo, permite evaluar si el rendimiento del modelo es consistente entre las dos fases de validación y detectar posibles discrepancias o sobreajustes. La visualización ayuda a entender cómo el modelo generaliza a datos no vistos y proporciona una medida de estabilidad y confianza en el rendimiento del modelo.</p>
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Gráfico de barras comparativo del AUC medio de los inner folds y el AUC medio de los outer folds</span></span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>generate_inner_outer_auc_comparison <span class="ot">&lt;-</span> <span class="cf">function</span>(inner_fold_metrics, outer_fold_metrics) {</span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calcular AUC medio por fold para inner folds</span></span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a>  mean_inner_auc <span class="ot">&lt;-</span> inner_fold_metrics <span class="sc">%&gt;%</span></span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(Fold) <span class="sc">%&gt;%</span></span>
<span id="cb89-6"><a href="#cb89-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">mean_AUC_inner =</span> <span class="fu">mean</span>(AUC, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb89-7"><a href="#cb89-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb89-8"><a href="#cb89-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calcular AUC medio por fold para outer folds</span></span>
<span id="cb89-9"><a href="#cb89-9" aria-hidden="true" tabindex="-1"></a>  mean_outer_auc <span class="ot">&lt;-</span> outer_fold_metrics <span class="sc">%&gt;%</span></span>
<span id="cb89-10"><a href="#cb89-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(Fold) <span class="sc">%&gt;%</span></span>
<span id="cb89-11"><a href="#cb89-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">mean_AUC_outer =</span> <span class="fu">mean</span>(AUC, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb89-12"><a href="#cb89-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb89-13"><a href="#cb89-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Unir los dataframes por Fold</span></span>
<span id="cb89-14"><a href="#cb89-14" aria-hidden="true" tabindex="-1"></a>  comparison_data <span class="ot">&lt;-</span> <span class="fu">merge</span>(mean_inner_auc, mean_outer_auc, <span class="at">by =</span> <span class="st">"Fold"</span>)</span>
<span id="cb89-15"><a href="#cb89-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb89-16"><a href="#cb89-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Crear la gráfica de barras comparativa</span></span>
<span id="cb89-17"><a href="#cb89-17" aria-hidden="true" tabindex="-1"></a>  fig <span class="ot">&lt;-</span> <span class="fu">plot_ly</span>(<span class="at">data =</span> comparison_data, <span class="at">x =</span> <span class="sc">~</span>Fold) <span class="sc">%&gt;%</span></span>
<span id="cb89-18"><a href="#cb89-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">add_trace</span>(</span>
<span id="cb89-19"><a href="#cb89-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="sc">~</span>mean_AUC_inner, </span>
<span id="cb89-20"><a href="#cb89-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">type =</span> <span class="st">'bar'</span>, </span>
<span id="cb89-21"><a href="#cb89-21" aria-hidden="true" tabindex="-1"></a>      <span class="at">name =</span> <span class="st">'AUC Medio Inner Folds'</span>,</span>
<span id="cb89-22"><a href="#cb89-22" aria-hidden="true" tabindex="-1"></a>      <span class="at">marker =</span> <span class="fu">list</span>(<span class="at">color =</span> <span class="st">'blue'</span>)</span>
<span id="cb89-23"><a href="#cb89-23" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb89-24"><a href="#cb89-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">add_trace</span>(</span>
<span id="cb89-25"><a href="#cb89-25" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="sc">~</span>mean_AUC_outer, </span>
<span id="cb89-26"><a href="#cb89-26" aria-hidden="true" tabindex="-1"></a>      <span class="at">type =</span> <span class="st">'bar'</span>, </span>
<span id="cb89-27"><a href="#cb89-27" aria-hidden="true" tabindex="-1"></a>      <span class="at">name =</span> <span class="st">'AUC Medio Outer Folds'</span>,</span>
<span id="cb89-28"><a href="#cb89-28" aria-hidden="true" tabindex="-1"></a>      <span class="at">marker =</span> <span class="fu">list</span>(<span class="at">color =</span> <span class="st">'red'</span>)</span>
<span id="cb89-29"><a href="#cb89-29" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb89-30"><a href="#cb89-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">layout</span>(</span>
<span id="cb89-31"><a href="#cb89-31" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="st">'Comparación de AUC Medio: Inner Folds vs Outer Folds'</span>,</span>
<span id="cb89-32"><a href="#cb89-32" aria-hidden="true" tabindex="-1"></a>      <span class="at">xaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">'Fold'</span>),</span>
<span id="cb89-33"><a href="#cb89-33" aria-hidden="true" tabindex="-1"></a>      <span class="at">yaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">'AUC Medio'</span>, <span class="at">range =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)),</span>
<span id="cb89-34"><a href="#cb89-34" aria-hidden="true" tabindex="-1"></a>      <span class="at">barmode =</span> <span class="st">'group'</span></span>
<span id="cb89-35"><a href="#cb89-35" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb89-36"><a href="#cb89-36" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb89-37"><a href="#cb89-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(fig)</span>
<span id="cb89-38"><a href="#cb89-38" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<div id="tabset-3-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-2-tab">
<p>El objetivo de la gráfica de violín del AUC medio por outer fold es proporcionar una visualización clara y detallada de la distribución del AUC para cada fold, distinguiendo los resultados por diferentes semillas de validación. Esta visualización es útil para detectar si hay algún fold específico que muestra una mayor variabilidad o si el rendimiento del modelo es consistentemente estable a través de todos los folds y semillas. Además, los elementos de la gráfica de violín, como la línea de la media y los puntos de datos individuales, facilitan la comprensión de la distribución del AUC y de los posibles outliers en los resultados.</p>
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="co">#  Gráfico de violín del AUC medio por outer fold con colores distintos para cada fold</span></span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>generate_outer_auc_violin_plot <span class="ot">&lt;-</span> <span class="cf">function</span>(outer_fold_metrics) {</span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Colores para cada fold</span></span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a>  colors <span class="ot">&lt;-</span> RColorBrewer<span class="sc">::</span><span class="fu">brewer.pal</span>(<span class="at">n =</span> <span class="fu">length</span>(<span class="fu">unique</span>(outer_fold_metrics<span class="sc">$</span>Fold)), <span class="at">name =</span> <span class="st">"Set1"</span>)</span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Crear la gráfica de violín</span></span>
<span id="cb90-7"><a href="#cb90-7" aria-hidden="true" tabindex="-1"></a>  fig <span class="ot">&lt;-</span> <span class="fu">plot_ly</span>(<span class="at">data =</span> outer_fold_metrics, <span class="at">y =</span> <span class="sc">~</span>AUC, <span class="at">x =</span> <span class="sc">~</span><span class="fu">factor</span>(Fold), <span class="at">type =</span> <span class="st">'violin'</span>, </span>
<span id="cb90-8"><a href="#cb90-8" aria-hidden="true" tabindex="-1"></a>                 <span class="at">box =</span> <span class="fu">list</span>(<span class="at">visible =</span> <span class="cn">TRUE</span>), <span class="at">meanline =</span> <span class="fu">list</span>(<span class="at">visible =</span> <span class="cn">TRUE</span>), <span class="at">points =</span> <span class="st">'all'</span>, <span class="at">spanmode =</span> <span class="st">'hard'</span>,</span>
<span id="cb90-9"><a href="#cb90-9" aria-hidden="true" tabindex="-1"></a>                 <span class="at">color =</span> <span class="sc">~</span><span class="fu">factor</span>(Fold), <span class="at">colors =</span> colors) <span class="sc">%&gt;%</span></span>
<span id="cb90-10"><a href="#cb90-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">layout</span>(</span>
<span id="cb90-11"><a href="#cb90-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="st">'Distribución del AUC por Outer Fold'</span>,</span>
<span id="cb90-12"><a href="#cb90-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">xaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">'Fold'</span>),</span>
<span id="cb90-13"><a href="#cb90-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">yaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">'AUC'</span>)</span>
<span id="cb90-14"><a href="#cb90-14" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb90-15"><a href="#cb90-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb90-16"><a href="#cb90-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(fig)</span>
<span id="cb90-17"><a href="#cb90-17" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<div id="tabset-3-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-3-tab">
<p>El objetivo de esta gráfica 3D es comparar la eficacia de diferentes métodos de selección de características (Todas Variables, Asociación, StepAUC y Lasso) en términos de su rendimiento medido por el AUC (Area Under the Curve). La visualización representa los resultados de múltiples ejecuciones (diferentes semillas) y los pliegues (folds) de validación cruzada para cada método. Cada punto en la gráfica indica el AUC obtenido en un pliegue específico para una semilla dada, y estos puntos se conectan con líneas para mostrar la continuidad dentro del mismo método y semilla. Los diferentes métodos se distinguen por colores, y en la leyenda se muestra el AUC medio global para cada método, proporcionando una comparación clara y visual de cómo cada método performa en promedio y cómo varía su rendimiento a través de diferentes pliegues y ejecuciones. Esto facilita la identificación de métodos consistentes y estables, así como aquellos que pueden necesitar ajustes adicionales.</p>
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>generate_combined_auc_3d_plot <span class="ot">&lt;-</span> <span class="cf">function</span>(dataframes, names) {</span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Definir los colores para cada dataframe</span></span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>  colors <span class="ot">&lt;-</span> <span class="fu">brewer.pal</span>(<span class="at">n =</span> <span class="fu">length</span>(dataframes), <span class="at">name =</span> <span class="st">"Set1"</span>)</span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calcular el AUC promedio global para cada dataframe</span></span>
<span id="cb91-6"><a href="#cb91-6" aria-hidden="true" tabindex="-1"></a>  mean_aucs <span class="ot">&lt;-</span> <span class="fu">sapply</span>(dataframes, <span class="cf">function</span>(df) <span class="fu">mean</span>(df<span class="sc">$</span>AUC, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb91-7"><a href="#cb91-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb91-8"><a href="#cb91-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Crear las trazas 3D para cada dataframe y semilla</span></span>
<span id="cb91-9"><a href="#cb91-9" aria-hidden="true" tabindex="-1"></a>  fig <span class="ot">&lt;-</span> <span class="fu">plot_ly</span>()</span>
<span id="cb91-10"><a href="#cb91-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb91-11"><a href="#cb91-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(dataframes)) {</span>
<span id="cb91-12"><a href="#cb91-12" aria-hidden="true" tabindex="-1"></a>    df <span class="ot">&lt;-</span> dataframes[[i]]</span>
<span id="cb91-13"><a href="#cb91-13" aria-hidden="true" tabindex="-1"></a>    unique_seeds <span class="ot">&lt;-</span> <span class="fu">unique</span>(df<span class="sc">$</span>Seed)</span>
<span id="cb91-14"><a href="#cb91-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (seed <span class="cf">in</span> unique_seeds) {</span>
<span id="cb91-15"><a href="#cb91-15" aria-hidden="true" tabindex="-1"></a>      seed_data <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Seed <span class="sc">==</span> seed)</span>
<span id="cb91-16"><a href="#cb91-16" aria-hidden="true" tabindex="-1"></a>      fig <span class="ot">&lt;-</span> fig <span class="sc">%&gt;%</span></span>
<span id="cb91-17"><a href="#cb91-17" aria-hidden="true" tabindex="-1"></a>        <span class="fu">add_trace</span>(<span class="at">data =</span> seed_data, <span class="at">x =</span> <span class="sc">~</span>Fold, <span class="at">y =</span> <span class="sc">~</span>Seed, <span class="at">z =</span> <span class="sc">~</span>AUC, <span class="at">type =</span> <span class="st">'scatter3d'</span>, <span class="at">mode =</span> <span class="st">'lines+markers'</span>,</span>
<span id="cb91-18"><a href="#cb91-18" aria-hidden="true" tabindex="-1"></a>                  <span class="at">line =</span> <span class="fu">list</span>(<span class="at">color =</span> colors[i]), <span class="at">marker =</span> <span class="fu">list</span>(<span class="at">size =</span> <span class="dv">5</span>, <span class="at">color =</span> colors[i]),</span>
<span id="cb91-19"><a href="#cb91-19" aria-hidden="true" tabindex="-1"></a>                  <span class="at">showlegend =</span> <span class="fu">ifelse</span>(seed <span class="sc">==</span> unique_seeds[<span class="dv">1</span>], <span class="cn">TRUE</span>, <span class="cn">FALSE</span>),</span>
<span id="cb91-20"><a href="#cb91-20" aria-hidden="true" tabindex="-1"></a>                  <span class="at">name =</span> <span class="fu">ifelse</span>(seed <span class="sc">==</span> unique_seeds[<span class="dv">1</span>], <span class="fu">paste</span>(names[i], <span class="st">"- AUC medio global:"</span>, <span class="fu">round</span>(mean_aucs[i], <span class="dv">3</span>)), <span class="st">""</span>))</span>
<span id="cb91-21"><a href="#cb91-21" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb91-22"><a href="#cb91-22" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb91-23"><a href="#cb91-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb91-24"><a href="#cb91-24" aria-hidden="true" tabindex="-1"></a>  fig <span class="ot">&lt;-</span> fig <span class="sc">%&gt;%</span></span>
<span id="cb91-25"><a href="#cb91-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">layout</span>(</span>
<span id="cb91-26"><a href="#cb91-26" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="st">'Comparación de AUC por Semilla y Fold para Diferentes Métodos'</span>,</span>
<span id="cb91-27"><a href="#cb91-27" aria-hidden="true" tabindex="-1"></a>      <span class="at">scene =</span> <span class="fu">list</span>(</span>
<span id="cb91-28"><a href="#cb91-28" aria-hidden="true" tabindex="-1"></a>        <span class="at">xaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">'Fold'</span>),</span>
<span id="cb91-29"><a href="#cb91-29" aria-hidden="true" tabindex="-1"></a>        <span class="at">yaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">'Semilla'</span>),</span>
<span id="cb91-30"><a href="#cb91-30" aria-hidden="true" tabindex="-1"></a>        <span class="at">zaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">'AUC'</span>)</span>
<span id="cb91-31"><a href="#cb91-31" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb91-32"><a href="#cb91-32" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb91-33"><a href="#cb91-33" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb91-34"><a href="#cb91-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(fig)</span>
<span id="cb91-35"><a href="#cb91-35" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Adicionalmente, se mostrará la <strong>distribución de AUC a través de Folds y Semillas</strong>. El objetivo de esta gráfica es proporcionar una visualización tridimensional detallada de la distribución del AUC a través de diferentes folds y semillas para un modelo específico. La gráfica permite observar cómo varía el rendimiento del modelo (medido por el AUC) en cada fold y cómo esta variación se distribuye a lo largo de varias ejecuciones independientes (diferentes semillas). Cada color representa una semilla distinta, lo que facilita la identificación de patrones de estabilidad y variabilidad en el rendimiento del modelo. Es gráfica se dejará de manera complementaria a la comparativa general, para que el lector pueda observar las diferencias específicas para cada modelo, sin embargo, <em>no se comentará</em>.</p>
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Función para generar la distribución de AUC a través de folds para todas las semillas usadas de un modelo</span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>generate_auc_per_seed_and_fold <span class="ot">&lt;-</span> <span class="cf">function</span>(performance_metrics) {</span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calcular el AUC medio por semilla</span></span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a>  mean_auc_by_seed <span class="ot">&lt;-</span> performance_metrics <span class="sc">%&gt;%</span></span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(Seed) <span class="sc">%&gt;%</span></span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">mean_AUC =</span> <span class="fu">mean</span>(AUC, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb92-7"><a href="#cb92-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb92-8"><a href="#cb92-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Crear la visualización en 3D con plotly</span></span>
<span id="cb92-9"><a href="#cb92-9" aria-hidden="true" tabindex="-1"></a>  fig <span class="ot">&lt;-</span> <span class="fu">plot_ly</span>()</span>
<span id="cb92-10"><a href="#cb92-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb92-11"><a href="#cb92-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Colores para cada semilla</span></span>
<span id="cb92-12"><a href="#cb92-12" aria-hidden="true" tabindex="-1"></a>  colors <span class="ot">&lt;-</span> RColorBrewer<span class="sc">::</span><span class="fu">brewer.pal</span>(<span class="at">n =</span> <span class="fu">length</span>(<span class="fu">unique</span>(performance_metrics<span class="sc">$</span>Seed)), <span class="at">name =</span> <span class="st">"Set1"</span>)</span>
<span id="cb92-13"><a href="#cb92-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb92-14"><a href="#cb92-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Añadir los datos de cada semilla como histogramas</span></span>
<span id="cb92-15"><a href="#cb92-15" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(<span class="fu">unique</span>(performance_metrics<span class="sc">$</span>Seed))) {</span>
<span id="cb92-16"><a href="#cb92-16" aria-hidden="true" tabindex="-1"></a>    seed <span class="ot">&lt;-</span> <span class="fu">unique</span>(performance_metrics<span class="sc">$</span>Seed)[i]</span>
<span id="cb92-17"><a href="#cb92-17" aria-hidden="true" tabindex="-1"></a>    subset_data <span class="ot">&lt;-</span> performance_metrics <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Seed <span class="sc">==</span> seed)</span>
<span id="cb92-18"><a href="#cb92-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb92-19"><a href="#cb92-19" aria-hidden="true" tabindex="-1"></a>    fig <span class="ot">&lt;-</span> fig <span class="sc">%&gt;%</span></span>
<span id="cb92-20"><a href="#cb92-20" aria-hidden="true" tabindex="-1"></a>      <span class="fu">add_trace</span>(</span>
<span id="cb92-21"><a href="#cb92-21" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> subset_data<span class="sc">$</span>Fold, </span>
<span id="cb92-22"><a href="#cb92-22" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> <span class="fu">rep</span>(i, <span class="fu">nrow</span>(subset_data)), </span>
<span id="cb92-23"><a href="#cb92-23" aria-hidden="true" tabindex="-1"></a>        <span class="at">z =</span> subset_data<span class="sc">$</span>AUC, </span>
<span id="cb92-24"><a href="#cb92-24" aria-hidden="true" tabindex="-1"></a>        <span class="at">type =</span> <span class="st">'scatter3d'</span>,</span>
<span id="cb92-25"><a href="#cb92-25" aria-hidden="true" tabindex="-1"></a>        <span class="at">mode =</span> <span class="st">'lines+markers'</span>,</span>
<span id="cb92-26"><a href="#cb92-26" aria-hidden="true" tabindex="-1"></a>        <span class="at">line =</span> <span class="fu">list</span>(<span class="at">width =</span> <span class="dv">2</span>, <span class="at">color =</span> colors[i]),</span>
<span id="cb92-27"><a href="#cb92-27" aria-hidden="true" tabindex="-1"></a>        <span class="at">marker =</span> <span class="fu">list</span>(<span class="at">size =</span> <span class="dv">5</span>, <span class="at">color =</span> colors[i]),</span>
<span id="cb92-28"><a href="#cb92-28" aria-hidden="true" tabindex="-1"></a>        <span class="at">name =</span> <span class="fu">paste</span>(<span class="st">'Semilla'</span>, <span class="fu">gsub</span>(<span class="st">"seed_"</span>, <span class="st">""</span>, seed), <span class="st">'AUC medio:'</span>, <span class="fu">round</span>(mean_auc_by_seed<span class="sc">$</span>mean_AUC[i], <span class="dv">3</span>))</span>
<span id="cb92-29"><a href="#cb92-29" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb92-30"><a href="#cb92-30" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb92-31"><a href="#cb92-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb92-32"><a href="#cb92-32" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Añadir detalles al gráfico</span></span>
<span id="cb92-33"><a href="#cb92-33" aria-hidden="true" tabindex="-1"></a>  fig <span class="ot">&lt;-</span> fig <span class="sc">%&gt;%</span> <span class="fu">layout</span>(<span class="at">scene =</span> <span class="fu">list</span>(</span>
<span id="cb92-34"><a href="#cb92-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">xaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">'Fold'</span>),</span>
<span id="cb92-35"><a href="#cb92-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">yaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">'Semilla'</span>),</span>
<span id="cb92-36"><a href="#cb92-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">zaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">'AUC'</span>),</span>
<span id="cb92-37"><a href="#cb92-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Visualización 3D de Folds, Semillas y AUC"</span></span>
<span id="cb92-38"><a href="#cb92-38" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb92-39"><a href="#cb92-39" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb92-40"><a href="#cb92-40" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Mostrar el gráfico</span></span>
<span id="cb92-41"><a href="#cb92-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(fig)</span>
<span id="cb92-42"><a href="#cb92-42" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
<section id="naive-bayes-2" class="level3" data-number="4.2.1">
<h3 data-number="4.2.1" class="anchored" data-anchor-id="naive-bayes-2"><span class="header-section-number">4.2.1</span> Naive Bayes</h3>
<section id="auc-fold-interno-vs-externo" class="level4" data-number="4.2.1.1">
<h4 data-number="4.2.1.1" class="anchored" data-anchor-id="auc-fold-interno-vs-externo"><span class="header-section-number">4.2.1.1</span> AUC Fold Interno vs Externo</h4>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-4-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-1" role="tab" aria-controls="tabset-4-1" aria-selected="true" href="">TodasVariables</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-2" role="tab" aria-controls="tabset-4-2" aria-selected="false" href="">Asociacion</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-3" role="tab" aria-controls="tabset-4-3" aria-selected="false" href="">StepAUC</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-4" role="tab" aria-controls="tabset-4-4" aria-selected="false" href="">Lasso</a></li></ul>
<div class="tab-content">
<div id="tabset-4-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-4-1-tab">
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="fu">generate_inner_outer_auc_comparison</span>(NaiveBayes_TodasVariables_Metrics<span class="sc">$</span>inner_fold_metrics, NaiveBayes_TodasVariables_Metrics<span class="sc">$</span>performance_metrics)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-ff1e068136fafb8e3187" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-ff1e068136fafb8e3187">{"x":{"visdat":{"3f582af91c2b":["function () ","plotlyVisDat"]},"cur_data":"3f582af91c2b","attrs":{"3f582af91c2b":{"x":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"y":{},"type":"bar","name":"AUC Medio Inner Folds","marker":{"color":"blue"},"inherit":true},"3f582af91c2b.1":{"x":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"y":{},"type":"bar","name":"AUC Medio Outer Folds","marker":{"color":"red"},"inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"Comparación de AUC Medio: Inner Folds vs Outer Folds","xaxis":{"domain":[0,1],"automargin":true,"title":"Fold"},"yaxis":{"domain":[0,1],"automargin":true,"title":"AUC Medio","range":[0,1]},"barmode":"group","hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":[1,2,3,4,5],"y":[0.7754025378208006,0.77671476397249817,0.77995458482487134,0.78194304602761688,0.78179531302155869],"type":"bar","name":"AUC Medio Inner Folds","marker":{"color":"blue","line":{"color":"rgba(31,119,180,1)"}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[1,2,3,4,5],"y":[0.75551589565603261,0.75249298721057389,0.74431120144534779,0.72658536585365852,0.74090179717586646],"type":"bar","name":"AUC Medio Outer Folds","marker":{"color":"red","line":{"color":"rgba(255,127,14,1)"}},"error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</div>
<div id="tabset-4-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-2-tab">
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="fu">generate_inner_outer_auc_comparison</span>(NaiveBayes_Asociacion_Metrics<span class="sc">$</span>inner_fold_metrics, NaiveBayes_Asociacion_Metrics<span class="sc">$</span>performance_metrics)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-d91efb8c6815e5a2bbfd" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-d91efb8c6815e5a2bbfd">{"x":{"visdat":{"3f5867fd3914":["function () ","plotlyVisDat"]},"cur_data":"3f5867fd3914","attrs":{"3f5867fd3914":{"x":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"y":{},"type":"bar","name":"AUC Medio Inner Folds","marker":{"color":"blue"},"inherit":true},"3f5867fd3914.1":{"x":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"y":{},"type":"bar","name":"AUC Medio Outer Folds","marker":{"color":"red"},"inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"Comparación de AUC Medio: Inner Folds vs Outer Folds","xaxis":{"domain":[0,1],"automargin":true,"title":"Fold"},"yaxis":{"domain":[0,1],"automargin":true,"title":"AUC Medio","range":[0,1]},"barmode":"group","hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":[1,2,3,4,5],"y":[0.75104785942709595,0.74855917904978952,0.75347209313144337,0.7607228612015946,0.75501943555596485],"type":"bar","name":"AUC Medio Inner Folds","marker":{"color":"blue","line":{"color":"rgba(31,119,180,1)"}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[1,2,3,4,5],"y":[0.74926837192348528,0.74629788110746598,0.7316184884071063,0.72713414634146345,0.7406803594351733],"type":"bar","name":"AUC Medio Outer Folds","marker":{"color":"red","line":{"color":"rgba(255,127,14,1)"}},"error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</div>
<div id="tabset-4-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-3-tab">
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="fu">generate_inner_outer_auc_comparison</span>(NaiveBayes_StepAUC_Metrics<span class="sc">$</span>inner_fold_metrics, NaiveBayes_StepAUC_Metrics<span class="sc">$</span>performance_metrics)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-9dcb6b69092c38ec4c8f" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-9dcb6b69092c38ec4c8f">{"x":{"visdat":{"3f584a2d244b":["function () ","plotlyVisDat"]},"cur_data":"3f584a2d244b","attrs":{"3f584a2d244b":{"x":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"y":{},"type":"bar","name":"AUC Medio Inner Folds","marker":{"color":"blue"},"inherit":true},"3f584a2d244b.1":{"x":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"y":{},"type":"bar","name":"AUC Medio Outer Folds","marker":{"color":"red"},"inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"Comparación de AUC Medio: Inner Folds vs Outer Folds","xaxis":{"domain":[0,1],"automargin":true,"title":"Fold"},"yaxis":{"domain":[0,1],"automargin":true,"title":"AUC Medio","range":[0,1]},"barmode":"group","hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":[1,2,3,4,5],"y":[0.78166558278371834,0.76557181180147105,0.76803166616788865,0.77926383245663511,0.77792262682389679],"type":"bar","name":"AUC Medio Inner Folds","marker":{"color":"blue","line":{"color":"rgba(31,119,180,1)"}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[1,2,3,4,5],"y":[0.75945030824577253,0.75095833531434741,0.7469963866305328,0.70847560975609736,0.7427053915275994],"type":"bar","name":"AUC Medio Outer Folds","marker":{"color":"red","line":{"color":"rgba(255,127,14,1)"}},"error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</div>
<div id="tabset-4-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-4-tab">
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="fu">generate_inner_outer_auc_comparison</span>(NaiveBayes_Lasso_Metrics<span class="sc">$</span>inner_fold_metrics, NaiveBayes_Lasso_Metrics<span class="sc">$</span>performance_metrics)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-a233d6e6dd5de70075e8" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-a233d6e6dd5de70075e8">{"x":{"visdat":{"3f5832e05b1a":["function () ","plotlyVisDat"]},"cur_data":"3f5832e05b1a","attrs":{"3f5832e05b1a":{"x":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"y":{},"type":"bar","name":"AUC Medio Inner Folds","marker":{"color":"blue"},"inherit":true},"3f5832e05b1a.1":{"x":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"y":{},"type":"bar","name":"AUC Medio Outer Folds","marker":{"color":"red"},"inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"Comparación de AUC Medio: Inner Folds vs Outer Folds","xaxis":{"domain":[0,1],"automargin":true,"title":"Fold"},"yaxis":{"domain":[0,1],"automargin":true,"title":"AUC Medio","range":[0,1]},"barmode":"group","hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":[1,2,3,4,5],"y":[0.76860335447384676,0.76713099300943455,0.7660482371075481,0.7578349174330582,0.75568287023714975],"type":"bar","name":"AUC Medio Inner Folds","marker":{"color":"blue","line":{"color":"rgba(31,119,180,1)"}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[1,2,3,4,5],"y":[0.74204912122220634,0.73679503637141619,0.75308340861186396,0.7067073170731708,0.74234595635430023],"type":"bar","name":"AUC Medio Outer Folds","marker":{"color":"red","line":{"color":"rgba(255,127,14,1)"}},"error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</div>
</div>
</div>
<p>El valor de AUC medio para todas las semillas por cada Fold es excepcional con el método del algoritmo de Naive Bayes. Como se puede observar, independientemente del método de selección de características aplicado, el rendimiento en los folds internos y externos es prácticamente el mismo, sin que el del externo supere al interno, que podría ser un signo de que el conjunto de datos ha sido mal construído, o de overfitting. En concreto se deben destacar los métodos de TodasVariables y StepAUC, por mantener el AUC promedio más alto, y el método de Asociación, por mantener el mismo rendimiento en los folds internos y externos, exhibiendo una gran capacidad de generalización y predicción.</p>
</section>
<section id="auc-medio-folds-externos" class="level4" data-number="4.2.1.2">
<h4 data-number="4.2.1.2" class="anchored" data-anchor-id="auc-medio-folds-externos"><span class="header-section-number">4.2.1.2</span> AUC Medio Folds Externos</h4>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-5-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-1" role="tab" aria-controls="tabset-5-1" aria-selected="true" href="">TodasVariables</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-5-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-2" role="tab" aria-controls="tabset-5-2" aria-selected="false" href="">Asociacion</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-5-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-3" role="tab" aria-controls="tabset-5-3" aria-selected="false" href="">StepAUC</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-5-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-4" role="tab" aria-controls="tabset-5-4" aria-selected="false" href="">Lasso</a></li></ul>
<div class="tab-content">
<div id="tabset-5-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-5-1-tab">
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="fu">generate_outer_auc_violin_plot</span>(NaiveBayes_TodasVariables_Metrics<span class="sc">$</span>performance_metrics)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-568411d95aff178263e8" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-568411d95aff178263e8">{"x":{"visdat":{"3f5861342a75":["function () ","plotlyVisDat"]},"cur_data":"3f5861342a75","attrs":{"3f5861342a75":{"y":{},"x":{},"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","color":{},"colors":["#E41A1C","#377EB8","#4DAF4A","#984EA3","#FF7F00"],"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"violin"}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"Distribución del AUC por Outer Fold","xaxis":{"domain":[0,1],"automargin":true,"title":"Fold","type":"category","categoryorder":"array","categoryarray":["1","2","3","4","5"]},"yaxis":{"domain":[0,1],"automargin":true,"title":"AUC"},"hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"fillcolor":"rgba(228,26,28,0.5)","y":[0.72774390243902443,0.7944444444444444,0.7657569850552306,0.7475609756097561,0.74207317073170731],"x":["1","1","1","1","1"],"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","type":"violin","name":"1","marker":{"color":"rgba(228,26,28,1)","line":{"color":"rgba(228,26,28,1)"}},"line":{"color":"rgba(228,26,28,1)"},"xaxis":"x","yaxis":"y","frame":null},{"fillcolor":"rgba(55,126,184,0.5)","y":[0.70635430038510916,0.74133504492939672,0.77195121951219514,0.7300194931773879,0.81280487804878054],"x":["2","2","2","2","2"],"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","type":"violin","name":"2","marker":{"color":"rgba(55,126,184,1)","line":{"color":"rgba(55,126,184,1)"}},"line":{"color":"rgba(55,126,184,1)"},"xaxis":"x","yaxis":"y","frame":null},{"fillcolor":"rgba(77,175,74,0.5)","y":[0.76975308641975304,0.77713414634146338,0.73414634146341462,0.69268292682926824,0.74783950617283945],"x":["3","3","3","3","3"],"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","type":"violin","name":"3","marker":{"color":"rgba(77,175,74,1)","line":{"color":"rgba(77,175,74,1)"}},"line":{"color":"rgba(77,175,74,1)"},"xaxis":"x","yaxis":"y","frame":null},{"fillcolor":"rgba(152,78,163,0.5)","y":[0.72408536585365857,0.70884146341463417,0.72317073170731705,0.78597560975609759,0.69085365853658542],"x":["4","4","4","4","4"],"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","type":"violin","name":"4","marker":{"color":"rgba(152,78,163,1)","line":{"color":"rgba(152,78,163,1)"}},"line":{"color":"rgba(152,78,163,1)"},"xaxis":"x","yaxis":"y","frame":null},{"fillcolor":"rgba(255,127,0,0.5)","y":[0.78262195121951217,0.70884146341463417,0.71920731707317076,0.70853658536585362,0.7853016688061617],"x":["5","5","5","5","5"],"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","type":"violin","name":"5","marker":{"color":"rgba(255,127,0,1)","line":{"color":"rgba(255,127,0,1)"}},"line":{"color":"rgba(255,127,0,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</div>
<div id="tabset-5-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-5-2-tab">
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="fu">generate_outer_auc_violin_plot</span>(NaiveBayes_Asociacion_Metrics<span class="sc">$</span>performance_metrics)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-34c2adccc97e36484ca0" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-34c2adccc97e36484ca0">{"x":{"visdat":{"3f5874037923":["function () ","plotlyVisDat"]},"cur_data":"3f5874037923","attrs":{"3f5874037923":{"y":{},"x":{},"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","color":{},"colors":["#E41A1C","#377EB8","#4DAF4A","#984EA3","#FF7F00"],"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"violin"}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"Distribución del AUC por Outer Fold","xaxis":{"domain":[0,1],"automargin":true,"title":"Fold","type":"category","categoryorder":"array","categoryarray":["1","2","3","4","5"]},"yaxis":{"domain":[0,1],"automargin":true,"title":"AUC"},"hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"fillcolor":"rgba(228,26,28,0.5)","y":[0.72652439024390236,0.80679012345679013,0.75113710201429496,0.73414634146341462,0.72774390243902443],"x":["1","1","1","1","1"],"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","type":"violin","name":"1","marker":{"color":"rgba(228,26,28,1)","line":{"color":"rgba(228,26,28,1)"}},"line":{"color":"rgba(228,26,28,1)"},"xaxis":"x","yaxis":"y","frame":null},{"fillcolor":"rgba(55,126,184,0.5)","y":[0.68709884467265725,0.73202824133504496,0.76981707317073167,0.74528914879792063,0.7972560975609756],"x":["2","2","2","2","2"],"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","type":"violin","name":"2","marker":{"color":"rgba(55,126,184,1)","line":{"color":"rgba(55,126,184,1)"}},"line":{"color":"rgba(55,126,184,1)"},"xaxis":"x","yaxis":"y","frame":null},{"fillcolor":"rgba(77,175,74,0.5)","y":[0.76265432098765429,0.77042682926829265,0.7115853658536585,0.6875,0.72592592592592597],"x":["3","3","3","3","3"],"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","type":"violin","name":"3","marker":{"color":"rgba(77,175,74,1)","line":{"color":"rgba(77,175,74,1)"}},"line":{"color":"rgba(77,175,74,1)"},"xaxis":"x","yaxis":"y","frame":null},{"fillcolor":"rgba(152,78,163,0.5)","y":[0.73780487804878048,0.70487804878048788,0.72256097560975607,0.79542682926829267,0.67500000000000004],"x":["4","4","4","4","4"],"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","type":"violin","name":"4","marker":{"color":"rgba(152,78,163,1)","line":{"color":"rgba(152,78,163,1)"}},"line":{"color":"rgba(152,78,163,1)"},"xaxis":"x","yaxis":"y","frame":null},{"fillcolor":"rgba(255,127,0,0.5)","y":[0.78140243902439022,0.70609756097560972,0.73262195121951224,0.69573170731707323,0.78754813863928108],"x":["5","5","5","5","5"],"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","type":"violin","name":"5","marker":{"color":"rgba(255,127,0,1)","line":{"color":"rgba(255,127,0,1)"}},"line":{"color":"rgba(255,127,0,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</div>
<div id="tabset-5-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-5-3-tab">
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="fu">generate_outer_auc_violin_plot</span>(NaiveBayes_StepAUC_Metrics<span class="sc">$</span>performance_metrics)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-7df3bfe78d4a2376b73c" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-7df3bfe78d4a2376b73c">{"x":{"visdat":{"3f5848137d1e":["function () ","plotlyVisDat"]},"cur_data":"3f5848137d1e","attrs":{"3f5848137d1e":{"y":{},"x":{},"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","color":{},"colors":["#E41A1C","#377EB8","#4DAF4A","#984EA3","#FF7F00"],"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"violin"}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"Distribución del AUC por Outer Fold","xaxis":{"domain":[0,1],"automargin":true,"title":"Fold","type":"category","categoryorder":"array","categoryarray":["1","2","3","4","5"]},"yaxis":{"domain":[0,1],"automargin":true,"title":"AUC"},"hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"fillcolor":"rgba(228,26,28,0.5)","y":[0.72743902439024399,0.79598765432098795,0.78784925276153295,0.75121951219512195,0.73475609756097604],"x":["1","1","1","1","1"],"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","type":"violin","name":"1","marker":{"color":"rgba(228,26,28,1)","line":{"color":"rgba(228,26,28,1)"}},"line":{"color":"rgba(228,26,28,1)"},"xaxis":"x","yaxis":"y","frame":null},{"fillcolor":"rgba(55,126,184,0.5)","y":[0.71405648267009003,0.751604621309371,0.75914634146341498,0.72449642625081201,0.80548780487804905],"x":["2","2","2","2","2"],"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","type":"violin","name":"2","marker":{"color":"rgba(55,126,184,1)","line":{"color":"rgba(55,126,184,1)"}},"line":{"color":"rgba(55,126,184,1)"},"xaxis":"x","yaxis":"y","frame":null},{"fillcolor":"rgba(77,175,74,0.5)","y":[0.78858024691357997,0.78506097560975596,0.76463414634146298,0.64176829268292701,0.75493827160493798],"x":["3","3","3","3","3"],"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","type":"violin","name":"3","marker":{"color":"rgba(77,175,74,1)","line":{"color":"rgba(77,175,74,1)"}},"line":{"color":"rgba(77,175,74,1)"},"xaxis":"x","yaxis":"y","frame":null},{"fillcolor":"rgba(152,78,163,0.5)","y":[0.70518292682926798,0.65884146341463401,0.72134146341463401,0.78079268292682902,0.676219512195122],"x":["4","4","4","4","4"],"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","type":"violin","name":"4","marker":{"color":"rgba(152,78,163,1)","line":{"color":"rgba(152,78,163,1)"}},"line":{"color":"rgba(152,78,163,1)"},"xaxis":"x","yaxis":"y","frame":null},{"fillcolor":"rgba(255,127,0,0.5)","y":[0.76615853658536603,0.730182926829268,0.71707317073170695,0.69908536585365899,0.80102695763799703],"x":["5","5","5","5","5"],"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","type":"violin","name":"5","marker":{"color":"rgba(255,127,0,1)","line":{"color":"rgba(255,127,0,1)"}},"line":{"color":"rgba(255,127,0,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</div>
<div id="tabset-5-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-5-4-tab">
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="fu">generate_outer_auc_violin_plot</span>(NaiveBayes_Lasso_Metrics<span class="sc">$</span>performance_metrics)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-3fdbf4f94f5fce4de0f3" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-3fdbf4f94f5fce4de0f3">{"x":{"visdat":{"3f5868d603b":["function () ","plotlyVisDat"]},"cur_data":"3f5868d603b","attrs":{"3f5868d603b":{"y":{},"x":{},"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","color":{},"colors":["#E41A1C","#377EB8","#4DAF4A","#984EA3","#FF7F00"],"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"violin"}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"Distribución del AUC por Outer Fold","xaxis":{"domain":[0,1],"automargin":true,"title":"Fold","type":"category","categoryorder":"array","categoryarray":["1","2","3","4","5"]},"yaxis":{"domain":[0,1],"automargin":true,"title":"AUC"},"hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"fillcolor":"rgba(228,26,28,0.5)","y":[0.68323170731707294,0.77932098765432101,0.73976608187134496,0.75060975609756098,0.75731707317073205],"x":["1","1","1","1","1"],"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","type":"violin","name":"1","marker":{"color":"rgba(228,26,28,1)","line":{"color":"rgba(228,26,28,1)"}},"line":{"color":"rgba(228,26,28,1)"},"xaxis":"x","yaxis":"y","frame":null},{"fillcolor":"rgba(55,126,184,0.5)","y":[0.70282413350449302,0.70186136071886995,0.71737804878048805,0.72807017543859598,0.83384146341463405],"x":["2","2","2","2","2"],"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","type":"violin","name":"2","marker":{"color":"rgba(55,126,184,1)","line":{"color":"rgba(55,126,184,1)"}},"line":{"color":"rgba(55,126,184,1)"},"xaxis":"x","yaxis":"y","frame":null},{"fillcolor":"rgba(77,175,74,0.5)","y":[0.79691358024691406,0.78810975609756095,0.74085365853658502,0.69725609756097595,0.74228395061728403],"x":["3","3","3","3","3"],"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","type":"violin","name":"3","marker":{"color":"rgba(77,175,74,1)","line":{"color":"rgba(77,175,74,1)"}},"line":{"color":"rgba(77,175,74,1)"},"xaxis":"x","yaxis":"y","frame":null},{"fillcolor":"rgba(152,78,163,0.5)","y":[0.72286585365853695,0.60731707317073202,0.73689024390243896,0.76524390243902396,0.70121951219512202],"x":["4","4","4","4","4"],"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","type":"violin","name":"4","marker":{"color":"rgba(152,78,163,1)","line":{"color":"rgba(152,78,163,1)"}},"line":{"color":"rgba(152,78,163,1)"},"xaxis":"x","yaxis":"y","frame":null},{"fillcolor":"rgba(255,127,0,0.5)","y":[0.71951219512195097,0.76463414634146298,0.73140243902438995,0.74329268292682904,0.75288831835686798],"x":["5","5","5","5","5"],"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","type":"violin","name":"5","marker":{"color":"rgba(255,127,0,1)","line":{"color":"rgba(255,127,0,1)"}},"line":{"color":"rgba(255,127,0,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</div>
</div>
</div>
<p>El método más destacable de este apartado podría ser el método de selección de características Lasso, ya que la dispersión del AUC se mantiene muy baja en los folds 1 y 5, y bastante estable en los folds 2 y 3, con la excepción del cuarto fold, el cual parece mostrar un valor de AUC bajo. La dispersión del resto de métodos es, en general, alta, sin embargo, hay que destacar que los métodos TodasVariables y StepAuc tienen la mediana en el valor de AUC alto, indicando que el, o los datos que causan la dispersión, pueden ser excepciones.</p>
</section>
<section id="comparativa-naive-bayes" class="level4" data-number="4.2.1.3">
<h4 data-number="4.2.1.3" class="anchored" data-anchor-id="comparativa-naive-bayes"><span class="header-section-number">4.2.1.3</span> Comparativa Naive Bayes</h4>
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>fig <span class="ot">&lt;-</span> <span class="fu">generate_combined_auc_3d_plot</span>(</span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(</span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a>    NaiveBayes_TodasVariables_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a>    NaiveBayes_Asociacion_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a>    NaiveBayes_StepAUC_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb101-6"><a href="#cb101-6" aria-hidden="true" tabindex="-1"></a>    NaiveBayes_Lasso_Metrics<span class="sc">$</span>performance_metrics</span>
<span id="cb101-7"><a href="#cb101-7" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb101-8"><a href="#cb101-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">"Todas Variables"</span>, <span class="st">"Asociacion"</span>, <span class="st">"StepAUC"</span>, <span class="st">"Lasso"</span>)</span>
<span id="cb101-9"><a href="#cb101-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb101-10"><a href="#cb101-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-11"><a href="#cb101-11" aria-hidden="true" tabindex="-1"></a>fig</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-66c68f550b664460de63" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-66c68f550b664460de63">{"x":{"visdat":{"3f5877b1180d":["function () ","plotlyVisDat"],"3f5815303e90":["function () ","data"],"3f586dc77507":["function () ","data"],"3f581bc84074":["function () ","data"],"3f585c592ce2":["function () ","data"],"3f5848cc1dec":["function () ","data"],"3f586f9f643e":["function () ","data"],"3f587267484a":["function () ","data"],"3f58383b7b8c":["function () ","data"],"3f585c2d14":["function () ","data"],"3f583f27232b":["function () ","data"],"3f583f99b4d":["function () ","data"],"3f5815eb7ad1":["function () ","data"],"3f58140e2df6":["function () ","data"],"3f583713402d":["function () ","data"],"3f587cbf2fd5":["function () ","data"],"3f584ae050cb":["function () ","data"],"3f581e182c75":["function () ","data"],"3f58243e337":["function () ","data"],"3f58468126e":["function () ","data"],"3f589f61b65":["function () ","data"]},"cur_data":"3f589f61b65","attrs":{"3f5815303e90":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines+markers","line":{"color":"#E41A1C"},"marker":{"size":5,"color":"#E41A1C"},"showlegend":true,"name":"Todas Variables - AUC medio global: 0.744","inherit":true},"3f586dc77507":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines+markers","line":{"color":"#E41A1C"},"marker":{"size":5,"color":"#E41A1C"},"showlegend":false,"name":"","inherit":true},"3f581bc84074":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines+markers","line":{"color":"#E41A1C"},"marker":{"size":5,"color":"#E41A1C"},"showlegend":false,"name":"","inherit":true},"3f585c592ce2":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines+markers","line":{"color":"#E41A1C"},"marker":{"size":5,"color":"#E41A1C"},"showlegend":false,"name":"","inherit":true},"3f5848cc1dec":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines+markers","line":{"color":"#E41A1C"},"marker":{"size":5,"color":"#E41A1C"},"showlegend":false,"name":"","inherit":true},"3f586f9f643e":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines+markers","line":{"color":"#377EB8"},"marker":{"size":5,"color":"#377EB8"},"showlegend":true,"name":"Asociacion - AUC medio global: 0.739","inherit":true},"3f587267484a":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines+markers","line":{"color":"#377EB8"},"marker":{"size":5,"color":"#377EB8"},"showlegend":false,"name":"","inherit":true},"3f58383b7b8c":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines+markers","line":{"color":"#377EB8"},"marker":{"size":5,"color":"#377EB8"},"showlegend":false,"name":"","inherit":true},"3f585c2d14":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines+markers","line":{"color":"#377EB8"},"marker":{"size":5,"color":"#377EB8"},"showlegend":false,"name":"","inherit":true},"3f583f27232b":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines+markers","line":{"color":"#377EB8"},"marker":{"size":5,"color":"#377EB8"},"showlegend":false,"name":"","inherit":true},"3f583f99b4d":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines+markers","line":{"color":"#4DAF4A"},"marker":{"size":5,"color":"#4DAF4A"},"showlegend":true,"name":"StepAUC - AUC medio global: 0.742","inherit":true},"3f5815eb7ad1":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines+markers","line":{"color":"#4DAF4A"},"marker":{"size":5,"color":"#4DAF4A"},"showlegend":false,"name":"","inherit":true},"3f58140e2df6":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines+markers","line":{"color":"#4DAF4A"},"marker":{"size":5,"color":"#4DAF4A"},"showlegend":false,"name":"","inherit":true},"3f583713402d":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines+markers","line":{"color":"#4DAF4A"},"marker":{"size":5,"color":"#4DAF4A"},"showlegend":false,"name":"","inherit":true},"3f587cbf2fd5":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines+markers","line":{"color":"#4DAF4A"},"marker":{"size":5,"color":"#4DAF4A"},"showlegend":false,"name":"","inherit":true},"3f584ae050cb":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines+markers","line":{"color":"#984EA3"},"marker":{"size":5,"color":"#984EA3"},"showlegend":true,"name":"Lasso - AUC medio global: 0.736","inherit":true},"3f581e182c75":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines+markers","line":{"color":"#984EA3"},"marker":{"size":5,"color":"#984EA3"},"showlegend":false,"name":"","inherit":true},"3f58243e337":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines+markers","line":{"color":"#984EA3"},"marker":{"size":5,"color":"#984EA3"},"showlegend":false,"name":"","inherit":true},"3f58468126e":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines+markers","line":{"color":"#984EA3"},"marker":{"size":5,"color":"#984EA3"},"showlegend":false,"name":"","inherit":true},"3f589f61b65":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines+markers","line":{"color":"#984EA3"},"marker":{"size":5,"color":"#984EA3"},"showlegend":false,"name":"","inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"Comparación de AUC por Semilla y Fold para Diferentes Métodos","scene":{"xaxis":{"title":"Fold"},"yaxis":{"title":"Semilla"},"zaxis":{"title":"AUC"}},"yaxis":{"type":"category","categoryorder":"array","categoryarray":["seed_123","seed_27","seed_3","seed_50","seed_90"]},"hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":[1,2,3,4,5],"y":["seed_27","seed_27","seed_27","seed_27","seed_27"],"z":[0.72774390243902443,0.70635430038510916,0.76975308641975304,0.72408536585365857,0.78262195121951217],"type":"scatter3d","mode":"lines+markers","line":{"color":"#E41A1C"},"marker":{"color":"#E41A1C","size":5,"line":{"color":"rgba(31,119,180,1)"}},"showlegend":true,"name":"Todas Variables - AUC medio global: 0.744","error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"frame":null},{"x":[1,2,3,4,5],"y":["seed_3","seed_3","seed_3","seed_3","seed_3"],"z":[0.7944444444444444,0.74133504492939672,0.77713414634146338,0.70884146341463417,0.70884146341463417],"type":"scatter3d","mode":"lines+markers","line":{"color":"#E41A1C"},"marker":{"color":"#E41A1C","size":5,"line":{"color":"rgba(255,127,14,1)"}},"showlegend":false,"name":"","error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"frame":null},{"x":[1,2,3,4,5],"y":["seed_123","seed_123","seed_123","seed_123","seed_123"],"z":[0.7657569850552306,0.77195121951219514,0.73414634146341462,0.72317073170731705,0.71920731707317076],"type":"scatter3d","mode":"lines+markers","line":{"color":"#E41A1C"},"marker":{"color":"#E41A1C","size":5,"line":{"color":"rgba(44,160,44,1)"}},"showlegend":false,"name":"","error_y":{"color":"rgba(44,160,44,1)"},"error_x":{"color":"rgba(44,160,44,1)"},"frame":null},{"x":[1,2,3,4,5],"y":["seed_50","seed_50","seed_50","seed_50","seed_50"],"z":[0.7475609756097561,0.7300194931773879,0.69268292682926824,0.78597560975609759,0.70853658536585362],"type":"scatter3d","mode":"lines+markers","line":{"color":"#E41A1C"},"marker":{"color":"#E41A1C","size":5,"line":{"color":"rgba(214,39,40,1)"}},"showlegend":false,"name":"","error_y":{"color":"rgba(214,39,40,1)"},"error_x":{"color":"rgba(214,39,40,1)"},"frame":null},{"x":[1,2,3,4,5],"y":["seed_90","seed_90","seed_90","seed_90","seed_90"],"z":[0.74207317073170731,0.81280487804878054,0.74783950617283945,0.69085365853658542,0.7853016688061617],"type":"scatter3d","mode":"lines+markers","line":{"color":"#E41A1C"},"marker":{"color":"#E41A1C","size":5,"line":{"color":"rgba(148,103,189,1)"}},"showlegend":false,"name":"","error_y":{"color":"rgba(148,103,189,1)"},"error_x":{"color":"rgba(148,103,189,1)"},"frame":null},{"x":[1,2,3,4,5],"y":["seed_27","seed_27","seed_27","seed_27","seed_27"],"z":[0.72652439024390236,0.68709884467265725,0.76265432098765429,0.73780487804878048,0.78140243902439022],"type":"scatter3d","mode":"lines+markers","line":{"color":"#377EB8"},"marker":{"color":"#377EB8","size":5,"line":{"color":"rgba(140,86,75,1)"}},"showlegend":true,"name":"Asociacion - AUC medio global: 0.739","error_y":{"color":"rgba(140,86,75,1)"},"error_x":{"color":"rgba(140,86,75,1)"},"frame":null},{"x":[1,2,3,4,5],"y":["seed_3","seed_3","seed_3","seed_3","seed_3"],"z":[0.80679012345679013,0.73202824133504496,0.77042682926829265,0.70487804878048788,0.70609756097560972],"type":"scatter3d","mode":"lines+markers","line":{"color":"#377EB8"},"marker":{"color":"#377EB8","size":5,"line":{"color":"rgba(227,119,194,1)"}},"showlegend":false,"name":"","error_y":{"color":"rgba(227,119,194,1)"},"error_x":{"color":"rgba(227,119,194,1)"},"frame":null},{"x":[1,2,3,4,5],"y":["seed_123","seed_123","seed_123","seed_123","seed_123"],"z":[0.75113710201429496,0.76981707317073167,0.7115853658536585,0.72256097560975607,0.73262195121951224],"type":"scatter3d","mode":"lines+markers","line":{"color":"#377EB8"},"marker":{"color":"#377EB8","size":5,"line":{"color":"rgba(127,127,127,1)"}},"showlegend":false,"name":"","error_y":{"color":"rgba(127,127,127,1)"},"error_x":{"color":"rgba(127,127,127,1)"},"frame":null},{"x":[1,2,3,4,5],"y":["seed_50","seed_50","seed_50","seed_50","seed_50"],"z":[0.73414634146341462,0.74528914879792063,0.6875,0.79542682926829267,0.69573170731707323],"type":"scatter3d","mode":"lines+markers","line":{"color":"#377EB8"},"marker":{"color":"#377EB8","size":5,"line":{"color":"rgba(188,189,34,1)"}},"showlegend":false,"name":"","error_y":{"color":"rgba(188,189,34,1)"},"error_x":{"color":"rgba(188,189,34,1)"},"frame":null},{"x":[1,2,3,4,5],"y":["seed_90","seed_90","seed_90","seed_90","seed_90"],"z":[0.72774390243902443,0.7972560975609756,0.72592592592592597,0.67500000000000004,0.78754813863928108],"type":"scatter3d","mode":"lines+markers","line":{"color":"#377EB8"},"marker":{"color":"#377EB8","size":5,"line":{"color":"rgba(23,190,207,1)"}},"showlegend":false,"name":"","error_y":{"color":"rgba(23,190,207,1)"},"error_x":{"color":"rgba(23,190,207,1)"},"frame":null},{"x":[1,2,3,4,5],"y":["seed_27","seed_27","seed_27","seed_27","seed_27"],"z":[0.72743902439024399,0.71405648267009003,0.78858024691357997,0.70518292682926798,0.76615853658536603],"type":"scatter3d","mode":"lines+markers","line":{"color":"#4DAF4A"},"marker":{"color":"#4DAF4A","size":5,"line":{"color":"rgba(31,119,180,1)"}},"showlegend":true,"name":"StepAUC - AUC medio global: 0.742","error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"frame":null},{"x":[1,2,3,4,5],"y":["seed_3","seed_3","seed_3","seed_3","seed_3"],"z":[0.79598765432098795,0.751604621309371,0.78506097560975596,0.65884146341463401,0.730182926829268],"type":"scatter3d","mode":"lines+markers","line":{"color":"#4DAF4A"},"marker":{"color":"#4DAF4A","size":5,"line":{"color":"rgba(255,127,14,1)"}},"showlegend":false,"name":"","error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"frame":null},{"x":[1,2,3,4,5],"y":["seed_123","seed_123","seed_123","seed_123","seed_123"],"z":[0.78784925276153295,0.75914634146341498,0.76463414634146298,0.72134146341463401,0.71707317073170695],"type":"scatter3d","mode":"lines+markers","line":{"color":"#4DAF4A"},"marker":{"color":"#4DAF4A","size":5,"line":{"color":"rgba(44,160,44,1)"}},"showlegend":false,"name":"","error_y":{"color":"rgba(44,160,44,1)"},"error_x":{"color":"rgba(44,160,44,1)"},"frame":null},{"x":[1,2,3,4,5],"y":["seed_50","seed_50","seed_50","seed_50","seed_50"],"z":[0.75121951219512195,0.72449642625081201,0.64176829268292701,0.78079268292682902,0.69908536585365899],"type":"scatter3d","mode":"lines+markers","line":{"color":"#4DAF4A"},"marker":{"color":"#4DAF4A","size":5,"line":{"color":"rgba(214,39,40,1)"}},"showlegend":false,"name":"","error_y":{"color":"rgba(214,39,40,1)"},"error_x":{"color":"rgba(214,39,40,1)"},"frame":null},{"x":[1,2,3,4,5],"y":["seed_90","seed_90","seed_90","seed_90","seed_90"],"z":[0.73475609756097604,0.80548780487804905,0.75493827160493798,0.676219512195122,0.80102695763799703],"type":"scatter3d","mode":"lines+markers","line":{"color":"#4DAF4A"},"marker":{"color":"#4DAF4A","size":5,"line":{"color":"rgba(148,103,189,1)"}},"showlegend":false,"name":"","error_y":{"color":"rgba(148,103,189,1)"},"error_x":{"color":"rgba(148,103,189,1)"},"frame":null},{"x":[1,2,3,4,5],"y":["seed_27","seed_27","seed_27","seed_27","seed_27"],"z":[0.68323170731707294,0.70282413350449302,0.79691358024691406,0.72286585365853695,0.71951219512195097],"type":"scatter3d","mode":"lines+markers","line":{"color":"#984EA3"},"marker":{"color":"#984EA3","size":5,"line":{"color":"rgba(140,86,75,1)"}},"showlegend":true,"name":"Lasso - AUC medio global: 0.736","error_y":{"color":"rgba(140,86,75,1)"},"error_x":{"color":"rgba(140,86,75,1)"},"frame":null},{"x":[1,2,3,4,5],"y":["seed_3","seed_3","seed_3","seed_3","seed_3"],"z":[0.77932098765432101,0.70186136071886995,0.78810975609756095,0.60731707317073202,0.76463414634146298],"type":"scatter3d","mode":"lines+markers","line":{"color":"#984EA3"},"marker":{"color":"#984EA3","size":5,"line":{"color":"rgba(227,119,194,1)"}},"showlegend":false,"name":"","error_y":{"color":"rgba(227,119,194,1)"},"error_x":{"color":"rgba(227,119,194,1)"},"frame":null},{"x":[1,2,3,4,5],"y":["seed_123","seed_123","seed_123","seed_123","seed_123"],"z":[0.73976608187134496,0.71737804878048805,0.74085365853658502,0.73689024390243896,0.73140243902438995],"type":"scatter3d","mode":"lines+markers","line":{"color":"#984EA3"},"marker":{"color":"#984EA3","size":5,"line":{"color":"rgba(127,127,127,1)"}},"showlegend":false,"name":"","error_y":{"color":"rgba(127,127,127,1)"},"error_x":{"color":"rgba(127,127,127,1)"},"frame":null},{"x":[1,2,3,4,5],"y":["seed_50","seed_50","seed_50","seed_50","seed_50"],"z":[0.75060975609756098,0.72807017543859598,0.69725609756097595,0.76524390243902396,0.74329268292682904],"type":"scatter3d","mode":"lines+markers","line":{"color":"#984EA3"},"marker":{"color":"#984EA3","size":5,"line":{"color":"rgba(188,189,34,1)"}},"showlegend":false,"name":"","error_y":{"color":"rgba(188,189,34,1)"},"error_x":{"color":"rgba(188,189,34,1)"},"frame":null},{"x":[1,2,3,4,5],"y":["seed_90","seed_90","seed_90","seed_90","seed_90"],"z":[0.75731707317073205,0.83384146341463405,0.74228395061728403,0.70121951219512202,0.75288831835686798],"type":"scatter3d","mode":"lines+markers","line":{"color":"#984EA3"},"marker":{"color":"#984EA3","size":5,"line":{"color":"rgba(23,190,207,1)"}},"showlegend":false,"name":"","error_y":{"color":"rgba(23,190,207,1)"},"error_x":{"color":"rgba(23,190,207,1)"},"frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>Los valores de AUC, para todos los métodos de selección de características aplicados, muestran una notable estabilidad, pareciendo que, independientemente de la semilla, las fluctuaciones entre folds se mantienen, indicando que el modelo aprende bien de los datos, siendo robusto a la incorporación de nuevos datos, y realizando buenas predicciones a futuro. La técnica que mejores métricas muestra es la de TodasVariables, seguida muy cerca por StepAUC, la cual muestra la ventaja de usar menos cantidad de características.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-6-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-1" role="tab" aria-controls="tabset-6-1" aria-selected="true" href="">TodasVariables</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-6-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-2" role="tab" aria-controls="tabset-6-2" aria-selected="false" href="">Asociacion</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-6-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-3" role="tab" aria-controls="tabset-6-3" aria-selected="false" href="">StepAUC</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-6-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-4" role="tab" aria-controls="tabset-6-4" aria-selected="false" href="">Lasso</a></li></ul>
<div class="tab-content">
<div id="tabset-6-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-6-1-tab">
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="fu">generate_auc_per_seed_and_fold</span>(NaiveBayes_TodasVariables_Metrics<span class="sc">$</span>performance_metrics)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-cccce63da149a1b986ca" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-cccce63da149a1b986ca">{"x":{"visdat":{"3f5820255e50":["function () ","plotlyVisDat"]},"cur_data":"3f5820255e50","attrs":{"3f5820255e50":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1,2,3,4,5],"y":[1,1,1,1,1],"z":[0.72774390243902443,0.70635430038510916,0.76975308641975304,0.72408536585365857,0.78262195121951217],"type":"scatter3d","mode":"lines+markers","line":{"width":2,"color":"#E41A1C"},"marker":{"size":5,"color":"#E41A1C"},"name":"Semilla 27 AUC medio: 0.743","inherit":true},"3f5820255e50.1":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1,2,3,4,5],"y":[2,2,2,2,2],"z":[0.7944444444444444,0.74133504492939672,0.77713414634146338,0.70884146341463417,0.70884146341463417],"type":"scatter3d","mode":"lines+markers","line":{"width":2,"color":"#377EB8"},"marker":{"size":5,"color":"#377EB8"},"name":"Semilla 3 AUC medio: 0.742","inherit":true},"3f5820255e50.2":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1,2,3,4,5],"y":[3,3,3,3,3],"z":[0.7657569850552306,0.77195121951219514,0.73414634146341462,0.72317073170731705,0.71920731707317076],"type":"scatter3d","mode":"lines+markers","line":{"width":2,"color":"#4DAF4A"},"marker":{"size":5,"color":"#4DAF4A"},"name":"Semilla 123 AUC medio: 0.746","inherit":true},"3f5820255e50.3":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1,2,3,4,5],"y":[4,4,4,4,4],"z":[0.7475609756097561,0.7300194931773879,0.69268292682926824,0.78597560975609759,0.70853658536585362],"type":"scatter3d","mode":"lines+markers","line":{"width":2,"color":"#984EA3"},"marker":{"size":5,"color":"#984EA3"},"name":"Semilla 50 AUC medio: 0.733","inherit":true},"3f5820255e50.4":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1,2,3,4,5],"y":[5,5,5,5,5],"z":[0.74207317073170731,0.81280487804878054,0.74783950617283945,0.69085365853658542,0.7853016688061617],"type":"scatter3d","mode":"lines+markers","line":{"width":2,"color":"#FF7F00"},"marker":{"size":5,"color":"#FF7F00"},"name":"Semilla 90 AUC medio: 0.756","inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"scene":{"xaxis":{"title":"Fold"},"yaxis":{"title":"Semilla"},"zaxis":{"title":"AUC"},"title":"Visualización 3D de Folds, Semillas y AUC"},"hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":[1,2,3,4,5],"y":[1,1,1,1,1],"z":[0.72774390243902443,0.70635430038510916,0.76975308641975304,0.72408536585365857,0.78262195121951217],"type":"scatter3d","mode":"lines+markers","line":{"color":"#E41A1C","width":2},"marker":{"color":"#E41A1C","size":5,"line":{"color":"rgba(31,119,180,1)"}},"name":"Semilla 27 AUC medio: 0.743","error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"frame":null},{"x":[1,2,3,4,5],"y":[2,2,2,2,2],"z":[0.7944444444444444,0.74133504492939672,0.77713414634146338,0.70884146341463417,0.70884146341463417],"type":"scatter3d","mode":"lines+markers","line":{"color":"#377EB8","width":2},"marker":{"color":"#377EB8","size":5,"line":{"color":"rgba(255,127,14,1)"}},"name":"Semilla 3 AUC medio: 0.742","error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"frame":null},{"x":[1,2,3,4,5],"y":[3,3,3,3,3],"z":[0.7657569850552306,0.77195121951219514,0.73414634146341462,0.72317073170731705,0.71920731707317076],"type":"scatter3d","mode":"lines+markers","line":{"color":"#4DAF4A","width":2},"marker":{"color":"#4DAF4A","size":5,"line":{"color":"rgba(44,160,44,1)"}},"name":"Semilla 123 AUC medio: 0.746","error_y":{"color":"rgba(44,160,44,1)"},"error_x":{"color":"rgba(44,160,44,1)"},"frame":null},{"x":[1,2,3,4,5],"y":[4,4,4,4,4],"z":[0.7475609756097561,0.7300194931773879,0.69268292682926824,0.78597560975609759,0.70853658536585362],"type":"scatter3d","mode":"lines+markers","line":{"color":"#984EA3","width":2},"marker":{"color":"#984EA3","size":5,"line":{"color":"rgba(214,39,40,1)"}},"name":"Semilla 50 AUC medio: 0.733","error_y":{"color":"rgba(214,39,40,1)"},"error_x":{"color":"rgba(214,39,40,1)"},"frame":null},{"x":[1,2,3,4,5],"y":[5,5,5,5,5],"z":[0.74207317073170731,0.81280487804878054,0.74783950617283945,0.69085365853658542,0.7853016688061617],"type":"scatter3d","mode":"lines+markers","line":{"color":"#FF7F00","width":2},"marker":{"color":"#FF7F00","size":5,"line":{"color":"rgba(148,103,189,1)"}},"name":"Semilla 90 AUC medio: 0.756","error_y":{"color":"rgba(148,103,189,1)"},"error_x":{"color":"rgba(148,103,189,1)"},"frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</div>
<div id="tabset-6-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-6-2-tab">
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="fu">generate_auc_per_seed_and_fold</span>(NaiveBayes_Asociacion_Metrics<span class="sc">$</span>performance_metrics)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-6b9a805de8c81d705073" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-6b9a805de8c81d705073">{"x":{"visdat":{"3f585ed8e2":["function () ","plotlyVisDat"]},"cur_data":"3f585ed8e2","attrs":{"3f585ed8e2":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1,2,3,4,5],"y":[1,1,1,1,1],"z":[0.72652439024390236,0.68709884467265725,0.76265432098765429,0.73780487804878048,0.78140243902439022],"type":"scatter3d","mode":"lines+markers","line":{"width":2,"color":"#E41A1C"},"marker":{"size":5,"color":"#E41A1C"},"name":"Semilla 27 AUC medio: 0.738","inherit":true},"3f585ed8e2.1":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1,2,3,4,5],"y":[2,2,2,2,2],"z":[0.80679012345679013,0.73202824133504496,0.77042682926829265,0.70487804878048788,0.70609756097560972],"type":"scatter3d","mode":"lines+markers","line":{"width":2,"color":"#377EB8"},"marker":{"size":5,"color":"#377EB8"},"name":"Semilla 3 AUC medio: 0.739","inherit":true},"3f585ed8e2.2":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1,2,3,4,5],"y":[3,3,3,3,3],"z":[0.75113710201429496,0.76981707317073167,0.7115853658536585,0.72256097560975607,0.73262195121951224],"type":"scatter3d","mode":"lines+markers","line":{"width":2,"color":"#4DAF4A"},"marker":{"size":5,"color":"#4DAF4A"},"name":"Semilla 123 AUC medio: 0.744","inherit":true},"3f585ed8e2.3":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1,2,3,4,5],"y":[4,4,4,4,4],"z":[0.73414634146341462,0.74528914879792063,0.6875,0.79542682926829267,0.69573170731707323],"type":"scatter3d","mode":"lines+markers","line":{"width":2,"color":"#984EA3"},"marker":{"size":5,"color":"#984EA3"},"name":"Semilla 50 AUC medio: 0.732","inherit":true},"3f585ed8e2.4":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1,2,3,4,5],"y":[5,5,5,5,5],"z":[0.72774390243902443,0.7972560975609756,0.72592592592592597,0.67500000000000004,0.78754813863928108],"type":"scatter3d","mode":"lines+markers","line":{"width":2,"color":"#FF7F00"},"marker":{"size":5,"color":"#FF7F00"},"name":"Semilla 90 AUC medio: 0.743","inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"scene":{"xaxis":{"title":"Fold"},"yaxis":{"title":"Semilla"},"zaxis":{"title":"AUC"},"title":"Visualización 3D de Folds, Semillas y AUC"},"hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":[1,2,3,4,5],"y":[1,1,1,1,1],"z":[0.72652439024390236,0.68709884467265725,0.76265432098765429,0.73780487804878048,0.78140243902439022],"type":"scatter3d","mode":"lines+markers","line":{"color":"#E41A1C","width":2},"marker":{"color":"#E41A1C","size":5,"line":{"color":"rgba(31,119,180,1)"}},"name":"Semilla 27 AUC medio: 0.738","error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"frame":null},{"x":[1,2,3,4,5],"y":[2,2,2,2,2],"z":[0.80679012345679013,0.73202824133504496,0.77042682926829265,0.70487804878048788,0.70609756097560972],"type":"scatter3d","mode":"lines+markers","line":{"color":"#377EB8","width":2},"marker":{"color":"#377EB8","size":5,"line":{"color":"rgba(255,127,14,1)"}},"name":"Semilla 3 AUC medio: 0.739","error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"frame":null},{"x":[1,2,3,4,5],"y":[3,3,3,3,3],"z":[0.75113710201429496,0.76981707317073167,0.7115853658536585,0.72256097560975607,0.73262195121951224],"type":"scatter3d","mode":"lines+markers","line":{"color":"#4DAF4A","width":2},"marker":{"color":"#4DAF4A","size":5,"line":{"color":"rgba(44,160,44,1)"}},"name":"Semilla 123 AUC medio: 0.744","error_y":{"color":"rgba(44,160,44,1)"},"error_x":{"color":"rgba(44,160,44,1)"},"frame":null},{"x":[1,2,3,4,5],"y":[4,4,4,4,4],"z":[0.73414634146341462,0.74528914879792063,0.6875,0.79542682926829267,0.69573170731707323],"type":"scatter3d","mode":"lines+markers","line":{"color":"#984EA3","width":2},"marker":{"color":"#984EA3","size":5,"line":{"color":"rgba(214,39,40,1)"}},"name":"Semilla 50 AUC medio: 0.732","error_y":{"color":"rgba(214,39,40,1)"},"error_x":{"color":"rgba(214,39,40,1)"},"frame":null},{"x":[1,2,3,4,5],"y":[5,5,5,5,5],"z":[0.72774390243902443,0.7972560975609756,0.72592592592592597,0.67500000000000004,0.78754813863928108],"type":"scatter3d","mode":"lines+markers","line":{"color":"#FF7F00","width":2},"marker":{"color":"#FF7F00","size":5,"line":{"color":"rgba(148,103,189,1)"}},"name":"Semilla 90 AUC medio: 0.743","error_y":{"color":"rgba(148,103,189,1)"},"error_x":{"color":"rgba(148,103,189,1)"},"frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</div>
<div id="tabset-6-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-6-3-tab">
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="fu">generate_auc_per_seed_and_fold</span>(NaiveBayes_StepAUC_Metrics<span class="sc">$</span>performance_metrics)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-5d65700bacc51a20d60a" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-5d65700bacc51a20d60a">{"x":{"visdat":{"3f587b6a2e14":["function () ","plotlyVisDat"]},"cur_data":"3f587b6a2e14","attrs":{"3f587b6a2e14":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1,2,3,4,5],"y":[1,1,1,1,1],"z":[0.72743902439024399,0.71405648267009003,0.78858024691357997,0.70518292682926798,0.76615853658536603],"type":"scatter3d","mode":"lines+markers","line":{"width":2,"color":"#E41A1C"},"marker":{"size":5,"color":"#E41A1C"},"name":"Semilla 27 AUC medio: 0.75","inherit":true},"3f587b6a2e14.1":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1,2,3,4,5],"y":[2,2,2,2,2],"z":[0.79598765432098795,0.751604621309371,0.78506097560975596,0.65884146341463401,0.730182926829268],"type":"scatter3d","mode":"lines+markers","line":{"width":2,"color":"#377EB8"},"marker":{"size":5,"color":"#377EB8"},"name":"Semilla 3 AUC medio: 0.74","inherit":true},"3f587b6a2e14.2":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1,2,3,4,5],"y":[3,3,3,3,3],"z":[0.78784925276153295,0.75914634146341498,0.76463414634146298,0.72134146341463401,0.71707317073170695],"type":"scatter3d","mode":"lines+markers","line":{"width":2,"color":"#4DAF4A"},"marker":{"size":5,"color":"#4DAF4A"},"name":"Semilla 123 AUC medio: 0.744","inherit":true},"3f587b6a2e14.3":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1,2,3,4,5],"y":[4,4,4,4,4],"z":[0.75121951219512195,0.72449642625081201,0.64176829268292701,0.78079268292682902,0.69908536585365899],"type":"scatter3d","mode":"lines+markers","line":{"width":2,"color":"#984EA3"},"marker":{"size":5,"color":"#984EA3"},"name":"Semilla 50 AUC medio: 0.719","inherit":true},"3f587b6a2e14.4":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1,2,3,4,5],"y":[5,5,5,5,5],"z":[0.73475609756097604,0.80548780487804905,0.75493827160493798,0.676219512195122,0.80102695763799703],"type":"scatter3d","mode":"lines+markers","line":{"width":2,"color":"#FF7F00"},"marker":{"size":5,"color":"#FF7F00"},"name":"Semilla 90 AUC medio: 0.754","inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"scene":{"xaxis":{"title":"Fold"},"yaxis":{"title":"Semilla"},"zaxis":{"title":"AUC"},"title":"Visualización 3D de Folds, Semillas y AUC"},"hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":[1,2,3,4,5],"y":[1,1,1,1,1],"z":[0.72743902439024399,0.71405648267009003,0.78858024691357997,0.70518292682926798,0.76615853658536603],"type":"scatter3d","mode":"lines+markers","line":{"color":"#E41A1C","width":2},"marker":{"color":"#E41A1C","size":5,"line":{"color":"rgba(31,119,180,1)"}},"name":"Semilla 27 AUC medio: 0.75","error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"frame":null},{"x":[1,2,3,4,5],"y":[2,2,2,2,2],"z":[0.79598765432098795,0.751604621309371,0.78506097560975596,0.65884146341463401,0.730182926829268],"type":"scatter3d","mode":"lines+markers","line":{"color":"#377EB8","width":2},"marker":{"color":"#377EB8","size":5,"line":{"color":"rgba(255,127,14,1)"}},"name":"Semilla 3 AUC medio: 0.74","error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"frame":null},{"x":[1,2,3,4,5],"y":[3,3,3,3,3],"z":[0.78784925276153295,0.75914634146341498,0.76463414634146298,0.72134146341463401,0.71707317073170695],"type":"scatter3d","mode":"lines+markers","line":{"color":"#4DAF4A","width":2},"marker":{"color":"#4DAF4A","size":5,"line":{"color":"rgba(44,160,44,1)"}},"name":"Semilla 123 AUC medio: 0.744","error_y":{"color":"rgba(44,160,44,1)"},"error_x":{"color":"rgba(44,160,44,1)"},"frame":null},{"x":[1,2,3,4,5],"y":[4,4,4,4,4],"z":[0.75121951219512195,0.72449642625081201,0.64176829268292701,0.78079268292682902,0.69908536585365899],"type":"scatter3d","mode":"lines+markers","line":{"color":"#984EA3","width":2},"marker":{"color":"#984EA3","size":5,"line":{"color":"rgba(214,39,40,1)"}},"name":"Semilla 50 AUC medio: 0.719","error_y":{"color":"rgba(214,39,40,1)"},"error_x":{"color":"rgba(214,39,40,1)"},"frame":null},{"x":[1,2,3,4,5],"y":[5,5,5,5,5],"z":[0.73475609756097604,0.80548780487804905,0.75493827160493798,0.676219512195122,0.80102695763799703],"type":"scatter3d","mode":"lines+markers","line":{"color":"#FF7F00","width":2},"marker":{"color":"#FF7F00","size":5,"line":{"color":"rgba(148,103,189,1)"}},"name":"Semilla 90 AUC medio: 0.754","error_y":{"color":"rgba(148,103,189,1)"},"error_x":{"color":"rgba(148,103,189,1)"},"frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</div>
<div id="tabset-6-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-6-4-tab">
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="fu">generate_auc_per_seed_and_fold</span>(NaiveBayes_Lasso_Metrics<span class="sc">$</span>performance_metrics)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-2bb9dbd0cb8eb4551343" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-2bb9dbd0cb8eb4551343">{"x":{"visdat":{"3f5823e74056":["function () ","plotlyVisDat"]},"cur_data":"3f5823e74056","attrs":{"3f5823e74056":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1,2,3,4,5],"y":[1,1,1,1,1],"z":[0.68323170731707294,0.70282413350449302,0.79691358024691406,0.72286585365853695,0.71951219512195097],"type":"scatter3d","mode":"lines+markers","line":{"width":2,"color":"#E41A1C"},"marker":{"size":5,"color":"#E41A1C"},"name":"Semilla 27 AUC medio: 0.733","inherit":true},"3f5823e74056.1":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1,2,3,4,5],"y":[2,2,2,2,2],"z":[0.77932098765432101,0.70186136071886995,0.78810975609756095,0.60731707317073202,0.76463414634146298],"type":"scatter3d","mode":"lines+markers","line":{"width":2,"color":"#377EB8"},"marker":{"size":5,"color":"#377EB8"},"name":"Semilla 3 AUC medio: 0.725","inherit":true},"3f5823e74056.2":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1,2,3,4,5],"y":[3,3,3,3,3],"z":[0.73976608187134496,0.71737804878048805,0.74085365853658502,0.73689024390243896,0.73140243902438995],"type":"scatter3d","mode":"lines+markers","line":{"width":2,"color":"#4DAF4A"},"marker":{"size":5,"color":"#4DAF4A"},"name":"Semilla 123 AUC medio: 0.728","inherit":true},"3f5823e74056.3":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1,2,3,4,5],"y":[4,4,4,4,4],"z":[0.75060975609756098,0.72807017543859598,0.69725609756097595,0.76524390243902396,0.74329268292682904],"type":"scatter3d","mode":"lines+markers","line":{"width":2,"color":"#984EA3"},"marker":{"size":5,"color":"#984EA3"},"name":"Semilla 50 AUC medio: 0.737","inherit":true},"3f5823e74056.4":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1,2,3,4,5],"y":[5,5,5,5,5],"z":[0.75731707317073205,0.83384146341463405,0.74228395061728403,0.70121951219512202,0.75288831835686798],"type":"scatter3d","mode":"lines+markers","line":{"width":2,"color":"#FF7F00"},"marker":{"size":5,"color":"#FF7F00"},"name":"Semilla 90 AUC medio: 0.758","inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"scene":{"xaxis":{"title":"Fold"},"yaxis":{"title":"Semilla"},"zaxis":{"title":"AUC"},"title":"Visualización 3D de Folds, Semillas y AUC"},"hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":[1,2,3,4,5],"y":[1,1,1,1,1],"z":[0.68323170731707294,0.70282413350449302,0.79691358024691406,0.72286585365853695,0.71951219512195097],"type":"scatter3d","mode":"lines+markers","line":{"color":"#E41A1C","width":2},"marker":{"color":"#E41A1C","size":5,"line":{"color":"rgba(31,119,180,1)"}},"name":"Semilla 27 AUC medio: 0.733","error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"frame":null},{"x":[1,2,3,4,5],"y":[2,2,2,2,2],"z":[0.77932098765432101,0.70186136071886995,0.78810975609756095,0.60731707317073202,0.76463414634146298],"type":"scatter3d","mode":"lines+markers","line":{"color":"#377EB8","width":2},"marker":{"color":"#377EB8","size":5,"line":{"color":"rgba(255,127,14,1)"}},"name":"Semilla 3 AUC medio: 0.725","error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"frame":null},{"x":[1,2,3,4,5],"y":[3,3,3,3,3],"z":[0.73976608187134496,0.71737804878048805,0.74085365853658502,0.73689024390243896,0.73140243902438995],"type":"scatter3d","mode":"lines+markers","line":{"color":"#4DAF4A","width":2},"marker":{"color":"#4DAF4A","size":5,"line":{"color":"rgba(44,160,44,1)"}},"name":"Semilla 123 AUC medio: 0.728","error_y":{"color":"rgba(44,160,44,1)"},"error_x":{"color":"rgba(44,160,44,1)"},"frame":null},{"x":[1,2,3,4,5],"y":[4,4,4,4,4],"z":[0.75060975609756098,0.72807017543859598,0.69725609756097595,0.76524390243902396,0.74329268292682904],"type":"scatter3d","mode":"lines+markers","line":{"color":"#984EA3","width":2},"marker":{"color":"#984EA3","size":5,"line":{"color":"rgba(214,39,40,1)"}},"name":"Semilla 50 AUC medio: 0.737","error_y":{"color":"rgba(214,39,40,1)"},"error_x":{"color":"rgba(214,39,40,1)"},"frame":null},{"x":[1,2,3,4,5],"y":[5,5,5,5,5],"z":[0.75731707317073205,0.83384146341463405,0.74228395061728403,0.70121951219512202,0.75288831835686798],"type":"scatter3d","mode":"lines+markers","line":{"color":"#FF7F00","width":2},"marker":{"color":"#FF7F00","size":5,"line":{"color":"rgba(148,103,189,1)"}},"name":"Semilla 90 AUC medio: 0.758","error_y":{"color":"rgba(148,103,189,1)"},"error_x":{"color":"rgba(148,103,189,1)"},"frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="adaboost-2" class="level3" data-number="4.2.2">
<h3 data-number="4.2.2" class="anchored" data-anchor-id="adaboost-2"><span class="header-section-number">4.2.2</span> AdaBoost</h3>
<section id="auc-fold-interno-vs-externo-1" class="level4" data-number="4.2.2.1">
<h4 data-number="4.2.2.1" class="anchored" data-anchor-id="auc-fold-interno-vs-externo-1"><span class="header-section-number">4.2.2.1</span> AUC Fold Interno vs Externo</h4>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-7-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-1" role="tab" aria-controls="tabset-7-1" aria-selected="true" href="">TodasVariables</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-7-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-2" role="tab" aria-controls="tabset-7-2" aria-selected="false" href="">Asociacion</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-7-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-3" role="tab" aria-controls="tabset-7-3" aria-selected="false" href="">StepAUC</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-7-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-4" role="tab" aria-controls="tabset-7-4" aria-selected="false" href="">Lasso</a></li></ul>
<div class="tab-content">
<div id="tabset-7-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-7-1-tab">
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="fu">generate_inner_outer_auc_comparison</span>(AdaBoost_TodasVariables_Metrics<span class="sc">$</span>inner_fold_metrics, AdaBoost_TodasVariables_Metrics<span class="sc">$</span>performance_metrics)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-74f116c05363b5e32509" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-74f116c05363b5e32509">{"x":{"visdat":{"3f5838524a31":["function () ","plotlyVisDat"]},"cur_data":"3f5838524a31","attrs":{"3f5838524a31":{"x":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"y":{},"type":"bar","name":"AUC Medio Inner Folds","marker":{"color":"blue"},"inherit":true},"3f5838524a31.1":{"x":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"y":{},"type":"bar","name":"AUC Medio Outer Folds","marker":{"color":"red"},"inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"Comparación de AUC Medio: Inner Folds vs Outer Folds","xaxis":{"domain":[0,1],"automargin":true,"title":"Fold"},"yaxis":{"domain":[0,1],"automargin":true,"title":"AUC Medio","range":[0,1]},"barmode":"group","hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":[1,2,3,4,5],"y":[0.80036229267141656,0.80529215441399338,0.79903737885449877,0.81003414471084301,0.80897776289437029],"type":"bar","name":"AUC Medio Inner Folds","marker":{"color":"blue","line":{"color":"rgba(31,119,180,1)"}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[1,2,3,4,5],"y":[0.74978351479421224,0.73351091142490366,0.73384447455585666,0.70951219512195118,0.71113607188703465],"type":"bar","name":"AUC Medio Outer Folds","marker":{"color":"red","line":{"color":"rgba(255,127,14,1)"}},"error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</div>
<div id="tabset-7-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-7-2-tab">
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="fu">generate_inner_outer_auc_comparison</span>(AdaBoost_Asociacion_Metrics<span class="sc">$</span>inner_fold_metrics, AdaBoost_Asociacion_Metrics<span class="sc">$</span>performance_metrics)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-829dca1576e1bb71c03a" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-829dca1576e1bb71c03a">{"x":{"visdat":{"3f583dee1a2b":["function () ","plotlyVisDat"]},"cur_data":"3f583dee1a2b","attrs":{"3f583dee1a2b":{"x":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"y":{},"type":"bar","name":"AUC Medio Inner Folds","marker":{"color":"blue"},"inherit":true},"3f583dee1a2b.1":{"x":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"y":{},"type":"bar","name":"AUC Medio Outer Folds","marker":{"color":"red"},"inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"Comparación de AUC Medio: Inner Folds vs Outer Folds","xaxis":{"domain":[0,1],"automargin":true,"title":"Fold"},"yaxis":{"domain":[0,1],"automargin":true,"title":"AUC Medio","range":[0,1]},"barmode":"group","hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":[1,2,3,4,5],"y":[0.77221550110882187,0.76981425435567474,0.76967680384979875,0.79069085428200903,0.77780897258447568],"type":"bar","name":"AUC Medio Inner Folds","marker":{"color":"blue","line":{"color":"rgba(31,119,180,1)"}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[1,2,3,4,5],"y":[0.73315349688584608,0.75110663401955657,0.72660117434507676,0.70560975609756094,0.72863607188703472],"type":"bar","name":"AUC Medio Outer Folds","marker":{"color":"red","line":{"color":"rgba(255,127,14,1)"}},"error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</div>
<div id="tabset-7-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-7-3-tab">
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="fu">generate_inner_outer_auc_comparison</span>(AdaBoost_StepAUC_Metrics<span class="sc">$</span>inner_fold_metrics, AdaBoost_StepAUC_Metrics<span class="sc">$</span>performance_metrics)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-1b00d3992800066c8eaa" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-1b00d3992800066c8eaa">{"x":{"visdat":{"3f58154865eb":["function () ","plotlyVisDat"]},"cur_data":"3f58154865eb","attrs":{"3f58154865eb":{"x":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"y":{},"type":"bar","name":"AUC Medio Inner Folds","marker":{"color":"blue"},"inherit":true},"3f58154865eb.1":{"x":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"y":{},"type":"bar","name":"AUC Medio Outer Folds","marker":{"color":"red"},"inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"Comparación de AUC Medio: Inner Folds vs Outer Folds","xaxis":{"domain":[0,1],"automargin":true,"title":"Fold"},"yaxis":{"domain":[0,1],"automargin":true,"title":"AUC Medio","range":[0,1]},"barmode":"group","hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":[1,2,3,4,5],"y":[0.78127130237648534,0.76468927929457442,0.77385401679347143,0.77802264020457568,0.7746848778185752],"type":"bar","name":"AUC Medio Inner Folds","marker":{"color":"blue","line":{"color":"rgba(31,119,180,1)"}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[1,2,3,4,5],"y":[0.76096614050935818,0.7399251969127878,0.75306383619391715,0.70567073170731698,0.72906611039794622],"type":"bar","name":"AUC Medio Outer Folds","marker":{"color":"red","line":{"color":"rgba(255,127,14,1)"}},"error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</div>
<div id="tabset-7-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-7-4-tab">
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="fu">generate_inner_outer_auc_comparison</span>(AdaBoost_Lasso_Metrics<span class="sc">$</span>inner_fold_metrics, AdaBoost_Lasso_Metrics<span class="sc">$</span>performance_metrics)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-42224f3595eb05ee95a6" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-42224f3595eb05ee95a6">{"x":{"visdat":{"3f58756c289d":["function () ","plotlyVisDat"]},"cur_data":"3f58756c289d","attrs":{"3f58756c289d":{"x":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"y":{},"type":"bar","name":"AUC Medio Inner Folds","marker":{"color":"blue"},"inherit":true},"3f58756c289d.1":{"x":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"y":{},"type":"bar","name":"AUC Medio Outer Folds","marker":{"color":"red"},"inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"Comparación de AUC Medio: Inner Folds vs Outer Folds","xaxis":{"domain":[0,1],"automargin":true,"title":"Fold"},"yaxis":{"domain":[0,1],"automargin":true,"title":"AUC Medio","range":[0,1]},"barmode":"group","hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":[1,2,3,4,5],"y":[0.77925846819522937,0.76926889097672246,0.77769354024946569,0.78722420814197525,0.78569624971703944],"type":"bar","name":"AUC Medio Inner Folds","marker":{"color":"blue","line":{"color":"rgba(31,119,180,1)"}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[1,2,3,4,5],"y":[0.74140430117751466,0.74480617759393986,0.75454456489009325,0.725670731707317,0.73652118100128394],"type":"bar","name":"AUC Medio Outer Folds","marker":{"color":"red","line":{"color":"rgba(255,127,14,1)"}},"error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</div>
</div>
</div>
<p>Se puede observar que todos los métodos de selección de características mantienen un rendimiento mayor en los folds internos que externos, asegurando así que el conjunto de datos está bien construído. Sin embargo, <strong>el método donde más pareados parecen estar estos dos valores, y por ello donde el modelo final podría tener una mayor capacidad de generalización, es en el método de selección de variables Lasso</strong>.</p>
</section>
<section id="auc-medio-folds-externos-1" class="level4" data-number="4.2.2.2">
<h4 data-number="4.2.2.2" class="anchored" data-anchor-id="auc-medio-folds-externos-1"><span class="header-section-number">4.2.2.2</span> AUC Medio Folds Externos</h4>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-8-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-8-1" role="tab" aria-controls="tabset-8-1" aria-selected="true" href="">TodasVariables</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-8-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-8-2" role="tab" aria-controls="tabset-8-2" aria-selected="false" href="">Asociacion</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-8-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-8-3" role="tab" aria-controls="tabset-8-3" aria-selected="false" href="">StepAUC</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-8-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-8-4" role="tab" aria-controls="tabset-8-4" aria-selected="false" href="">Lasso</a></li></ul>
<div class="tab-content">
<div id="tabset-8-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-8-1-tab">
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="fu">generate_outer_auc_violin_plot</span>(AdaBoost_TodasVariables_Metrics<span class="sc">$</span>performance_metrics)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-b3a8bf1a32b89d4ebe1a" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-b3a8bf1a32b89d4ebe1a">{"x":{"visdat":{"3f5827584098":["function () ","plotlyVisDat"]},"cur_data":"3f5827584098","attrs":{"3f5827584098":{"y":{},"x":{},"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","color":{},"colors":["#E41A1C","#377EB8","#4DAF4A","#984EA3","#FF7F00"],"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"violin"}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"Distribución del AUC por Outer Fold","xaxis":{"domain":[0,1],"automargin":true,"title":"Fold","type":"category","categoryorder":"array","categoryarray":["1","2","3","4","5"]},"yaxis":{"domain":[0,1],"automargin":true,"title":"AUC"},"hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"fillcolor":"rgba(228,26,28,0.5)","y":[0.70518292682926831,0.7910493827160493,0.72677063027940214,0.75121951219512195,0.77469512195121948],"x":["1","1","1","1","1"],"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","type":"violin","name":"1","marker":{"color":"rgba(228,26,28,1)","line":{"color":"rgba(228,26,28,1)"}},"line":{"color":"rgba(228,26,28,1)"},"xaxis":"x","yaxis":"y","frame":null},{"fillcolor":"rgba(55,126,184,0.5)","y":[0.70057766367137353,0.73074454428754809,0.6890243902439025,0.73684210526315785,0.81036585365853653],"x":["2","2","2","2","2"],"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","type":"violin","name":"2","marker":{"color":"rgba(55,126,184,1)","line":{"color":"rgba(55,126,184,1)"}},"line":{"color":"rgba(55,126,184,1)"},"xaxis":"x","yaxis":"y","frame":null},{"fillcolor":"rgba(77,175,74,0.5)","y":[0.73302469135802462,0.77591463414634143,0.7347560975609756,0.68231707317073165,0.7432098765432098],"x":["3","3","3","3","3"],"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","type":"violin","name":"3","marker":{"color":"rgba(77,175,74,1)","line":{"color":"rgba(77,175,74,1)"}},"line":{"color":"rgba(77,175,74,1)"},"xaxis":"x","yaxis":"y","frame":null},{"fillcolor":"rgba(152,78,163,0.5)","y":[0.73506097560975614,0.676219512195122,0.72347560975609759,0.71707317073170729,0.69573170731707312],"x":["4","4","4","4","4"],"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","type":"violin","name":"4","marker":{"color":"rgba(152,78,163,1)","line":{"color":"rgba(152,78,163,1)"}},"line":{"color":"rgba(152,78,163,1)"},"xaxis":"x","yaxis":"y","frame":null},{"fillcolor":"rgba(255,127,0,0.5)","y":[0.78780487804878052,0.71737804878048783,0.67164634146341462,0.70426829268292679,0.67458279845956348],"x":["5","5","5","5","5"],"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","type":"violin","name":"5","marker":{"color":"rgba(255,127,0,1)","line":{"color":"rgba(255,127,0,1)"}},"line":{"color":"rgba(255,127,0,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</div>
<div id="tabset-8-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-8-2-tab">
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="fu">generate_outer_auc_violin_plot</span>(AdaBoost_Asociacion_Metrics<span class="sc">$</span>performance_metrics)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-b26d8e209bd71ad3e6f2" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-b26d8e209bd71ad3e6f2">{"x":{"visdat":{"3f5815b1103e":["function () ","plotlyVisDat"]},"cur_data":"3f5815b1103e","attrs":{"3f5815b1103e":{"y":{},"x":{},"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","color":{},"colors":["#E41A1C","#377EB8","#4DAF4A","#984EA3","#FF7F00"],"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"violin"}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"Distribución del AUC por Outer Fold","xaxis":{"domain":[0,1],"automargin":true,"title":"Fold","type":"category","categoryorder":"array","categoryarray":["1","2","3","4","5"]},"yaxis":{"domain":[0,1],"automargin":true,"title":"AUC"},"hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"fillcolor":"rgba(228,26,28,0.5)","y":[0.70426829268292679,0.81111111111111112,0.66471734892787526,0.72408536585365857,0.76158536585365855],"x":["1","1","1","1","1"],"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","type":"violin","name":"1","marker":{"color":"rgba(228,26,28,1)","line":{"color":"rgba(228,26,28,1)"}},"line":{"color":"rgba(228,26,28,1)"},"xaxis":"x","yaxis":"y","frame":null},{"fillcolor":"rgba(55,126,184,0.5)","y":[0.73331193838254172,0.7339537869062901,0.75731707317073171,0.7550357374918778,0.77591463414634143],"x":["2","2","2","2","2"],"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","type":"violin","name":"2","marker":{"color":"rgba(55,126,184,1)","line":{"color":"rgba(55,126,184,1)"}},"line":{"color":"rgba(55,126,184,1)"},"xaxis":"x","yaxis":"y","frame":null},{"fillcolor":"rgba(77,175,74,0.5)","y":[0.71512345679012346,0.78231707317073174,0.67743902439024384,0.71676829268292686,0.74135802469135803],"x":["3","3","3","3","3"],"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","type":"violin","name":"3","marker":{"color":"rgba(77,175,74,1)","line":{"color":"rgba(77,175,74,1)"}},"line":{"color":"rgba(77,175,74,1)"},"xaxis":"x","yaxis":"y","frame":null},{"fillcolor":"rgba(152,78,163,0.5)","y":[0.74176829268292677,0.66829268292682931,0.71036585365853655,0.72896341463414627,0.6786585365853659],"x":["4","4","4","4","4"],"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","type":"violin","name":"4","marker":{"color":"rgba(152,78,163,1)","line":{"color":"rgba(152,78,163,1)"}},"line":{"color":"rgba(152,78,163,1)"},"xaxis":"x","yaxis":"y","frame":null},{"fillcolor":"rgba(255,127,0,0.5)","y":[0.7780487804878049,0.74146341463414633,0.69481707317073171,0.65670731707317076,0.77214377406931967],"x":["5","5","5","5","5"],"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","type":"violin","name":"5","marker":{"color":"rgba(255,127,0,1)","line":{"color":"rgba(255,127,0,1)"}},"line":{"color":"rgba(255,127,0,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</div>
<div id="tabset-8-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-8-3-tab">
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="fu">generate_outer_auc_violin_plot</span>(AdaBoost_StepAUC_Metrics<span class="sc">$</span>performance_metrics)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-d7ba2918c1e54800daf9" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-d7ba2918c1e54800daf9">{"x":{"visdat":{"3f584b52624":["function () ","plotlyVisDat"]},"cur_data":"3f584b52624","attrs":{"3f584b52624":{"y":{},"x":{},"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","color":{},"colors":["#E41A1C","#377EB8","#4DAF4A","#984EA3","#FF7F00"],"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"violin"}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"Distribución del AUC por Outer Fold","xaxis":{"domain":[0,1],"automargin":true,"title":"Fold","type":"category","categoryorder":"array","categoryarray":["1","2","3","4","5"]},"yaxis":{"domain":[0,1],"automargin":true,"title":"AUC"},"hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"fillcolor":"rgba(228,26,28,0.5)","y":[0.70152439024390201,0.79537037037036995,0.78232618583495805,0.77957317073170695,0.74603658536585404],"x":["1","1","1","1","1"],"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","type":"violin","name":"1","marker":{"color":"rgba(228,26,28,1)","line":{"color":"rgba(228,26,28,1)"}},"line":{"color":"rgba(228,26,28,1)"},"xaxis":"x","yaxis":"y","frame":null},{"fillcolor":"rgba(55,126,184,0.5)","y":[0.71598202824133494,0.723042362002567,0.74969512195121901,0.71669915529564698,0.79420731707317105],"x":["2","2","2","2","2"],"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","type":"violin","name":"2","marker":{"color":"rgba(55,126,184,1)","line":{"color":"rgba(55,126,184,1)"}},"line":{"color":"rgba(55,126,184,1)"},"xaxis":"x","yaxis":"y","frame":null},{"fillcolor":"rgba(77,175,74,0.5)","y":[0.70987654320987603,0.79939024390243896,0.78262195121951195,0.70213414634146298,0.77129629629629604],"x":["3","3","3","3","3"],"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","type":"violin","name":"3","marker":{"color":"rgba(77,175,74,1)","line":{"color":"rgba(77,175,74,1)"}},"line":{"color":"rgba(77,175,74,1)"},"xaxis":"x","yaxis":"y","frame":null},{"fillcolor":"rgba(152,78,163,0.5)","y":[0.73201219512195104,0.70213414634146298,0.70945121951219503,0.73628048780487798,0.64847560975609797],"x":["4","4","4","4","4"],"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","type":"violin","name":"4","marker":{"color":"rgba(152,78,163,1)","line":{"color":"rgba(152,78,163,1)"}},"line":{"color":"rgba(152,78,163,1)"},"xaxis":"x","yaxis":"y","frame":null},{"fillcolor":"rgba(255,127,0,0.5)","y":[0.77317073170731698,0.744207317073171,0.70548780487804896,0.65609756097561001,0.76636713735558404],"x":["5","5","5","5","5"],"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","type":"violin","name":"5","marker":{"color":"rgba(255,127,0,1)","line":{"color":"rgba(255,127,0,1)"}},"line":{"color":"rgba(255,127,0,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</div>
<div id="tabset-8-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-8-4-tab">
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="fu">generate_outer_auc_violin_plot</span>(AdaBoost_Lasso_Metrics<span class="sc">$</span>performance_metrics)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-720d8826d974c6803467" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-720d8826d974c6803467">{"x":{"visdat":{"3f586713074":["function () ","plotlyVisDat"]},"cur_data":"3f586713074","attrs":{"3f586713074":{"y":{},"x":{},"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","color":{},"colors":["#E41A1C","#377EB8","#4DAF4A","#984EA3","#FF7F00"],"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"violin"}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"Distribución del AUC por Outer Fold","xaxis":{"domain":[0,1],"automargin":true,"title":"Fold","type":"category","categoryorder":"array","categoryarray":["1","2","3","4","5"]},"yaxis":{"domain":[0,1],"automargin":true,"title":"AUC"},"hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"fillcolor":"rgba(228,26,28,0.5)","y":[0.66463414634146301,0.77932098765432101,0.73196881091617905,0.79451219512195104,0.73658536585365897],"x":["1","1","1","1","1"],"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","type":"violin","name":"1","marker":{"color":"rgba(228,26,28,1)","line":{"color":"rgba(228,26,28,1)"}},"line":{"color":"rgba(228,26,28,1)"},"xaxis":"x","yaxis":"y","frame":null},{"fillcolor":"rgba(55,126,184,0.5)","y":[0.71726572528883203,0.70282413350449302,0.73689024390243896,0.75211176088369103,0.81493902439024402],"x":["2","2","2","2","2"],"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","type":"violin","name":"2","marker":{"color":"rgba(55,126,184,1)","line":{"color":"rgba(55,126,184,1)"}},"line":{"color":"rgba(55,126,184,1)"},"xaxis":"x","yaxis":"y","frame":null},{"fillcolor":"rgba(77,175,74,0.5)","y":[0.76944444444444404,0.77439024390243905,0.74664634146341502,0.71341463414634099,0.76882716049382704],"x":["3","3","3","3","3"],"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","type":"violin","name":"3","marker":{"color":"rgba(77,175,74,1)","line":{"color":"rgba(77,175,74,1)"}},"line":{"color":"rgba(77,175,74,1)"},"xaxis":"x","yaxis":"y","frame":null},{"fillcolor":"rgba(152,78,163,0.5)","y":[0.76951219512195101,0.70213414634146298,0.73231707317073202,0.77317073170731698,0.65121951219512197],"x":["4","4","4","4","4"],"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","type":"violin","name":"4","marker":{"color":"rgba(152,78,163,1)","line":{"color":"rgba(152,78,163,1)"}},"line":{"color":"rgba(152,78,163,1)"},"xaxis":"x","yaxis":"y","frame":null},{"fillcolor":"rgba(255,127,0,0.5)","y":[0.798170731707317,0.76219512195121997,0.71097560975609797,0.68597560975609795,0.72528883183568704],"x":["5","5","5","5","5"],"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","type":"violin","name":"5","marker":{"color":"rgba(255,127,0,1)","line":{"color":"rgba(255,127,0,1)"}},"line":{"color":"rgba(255,127,0,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</div>
</div>
</div>
<p>En el método TodasVariables se puede observar una alta dispersión en todos los folds, con el cuarto siendo el que menos muestra, pero para el cual la mediana es de menor valor. Para el método Asociación, se puede observar que el segundo fold muestra una muy baja dispersión y un valor de AUC medio alto, sin embargo, los folds 1 y 5 muestran características totalmente opuestas. El método stepAUC podría ser una mezcla entre los dos anteriores, mostrando una dispersión hacia valores altos de AUC, pero, debido a que la mayoría de muestras caen en valores algo más mediocres de AUC, la media está más centrada en la escala. Por último, El método Lasso muestra una estabilidad en la dispersión de los AUC, ya que todos los folds están igual de dispersos, manteniendo las medianas en los mismos valores aproximadamente, sin embargo, también parecer ser el método con más outliers. Podemos concluir que parece que <strong>los métodos Lasso y Asociación son algo más apropiados en cuanto a la robustez de los datos de entrada</strong> al modelo.</p>
</section>
<section id="comparativa-adaboost" class="level4" data-number="4.2.2.3">
<h4 data-number="4.2.2.3" class="anchored" data-anchor-id="comparativa-adaboost"><span class="header-section-number">4.2.2.3</span> Comparativa AdaBoost</h4>
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a>fig <span class="ot">&lt;-</span> <span class="fu">generate_combined_auc_3d_plot</span>(</span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(</span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a>    AdaBoost_TodasVariables_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb114-4"><a href="#cb114-4" aria-hidden="true" tabindex="-1"></a>    AdaBoost_Asociacion_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb114-5"><a href="#cb114-5" aria-hidden="true" tabindex="-1"></a>    AdaBoost_StepAUC_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb114-6"><a href="#cb114-6" aria-hidden="true" tabindex="-1"></a>    AdaBoost_Lasso_Metrics<span class="sc">$</span>performance_metrics</span>
<span id="cb114-7"><a href="#cb114-7" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb114-8"><a href="#cb114-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">"Todas Variables"</span>, <span class="st">"Asociacion"</span>, <span class="st">"StepAUC"</span>, <span class="st">"Lasso"</span>)</span>
<span id="cb114-9"><a href="#cb114-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb114-10"><a href="#cb114-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-11"><a href="#cb114-11" aria-hidden="true" tabindex="-1"></a>fig</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-095539f4791ec672d9a3" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-095539f4791ec672d9a3">{"x":{"visdat":{"3f587f343f8f":["function () ","plotlyVisDat"],"3f584b4c621c":["function () ","data"],"3f584e431bf6":["function () ","data"],"3f5850981cf3":["function () ","data"],"3f586ece336a":["function () ","data"],"3f585a3a5e52":["function () ","data"],"3f5825236152":["function () ","data"],"3f581d0d7275":["function () ","data"],"3f58c22165e":["function () ","data"],"3f584313272a":["function () ","data"],"3f5816f1236a":["function () ","data"],"3f581ac4dd5":["function () ","data"],"3f585af12ba5":["function () ","data"],"3f5850a61eb8":["function () ","data"],"3f5835f01f2":["function () ","data"],"3f58671e2171":["function () ","data"],"3f5824a0758e":["function () ","data"],"3f5860867ec4":["function () ","data"],"3f585d4751f3":["function () ","data"],"3f584f7f5f9b":["function () ","data"],"3f582b915fd":["function () ","data"]},"cur_data":"3f582b915fd","attrs":{"3f584b4c621c":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines+markers","line":{"color":"#E41A1C"},"marker":{"size":5,"color":"#E41A1C"},"showlegend":true,"name":"Todas Variables - AUC medio global: 0.728","inherit":true},"3f584e431bf6":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines+markers","line":{"color":"#E41A1C"},"marker":{"size":5,"color":"#E41A1C"},"showlegend":false,"name":"","inherit":true},"3f5850981cf3":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines+markers","line":{"color":"#E41A1C"},"marker":{"size":5,"color":"#E41A1C"},"showlegend":false,"name":"","inherit":true},"3f586ece336a":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines+markers","line":{"color":"#E41A1C"},"marker":{"size":5,"color":"#E41A1C"},"showlegend":false,"name":"","inherit":true},"3f585a3a5e52":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines+markers","line":{"color":"#E41A1C"},"marker":{"size":5,"color":"#E41A1C"},"showlegend":false,"name":"","inherit":true},"3f5825236152":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines+markers","line":{"color":"#377EB8"},"marker":{"size":5,"color":"#377EB8"},"showlegend":true,"name":"Asociacion - AUC medio global: 0.729","inherit":true},"3f581d0d7275":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines+markers","line":{"color":"#377EB8"},"marker":{"size":5,"color":"#377EB8"},"showlegend":false,"name":"","inherit":true},"3f58c22165e":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines+markers","line":{"color":"#377EB8"},"marker":{"size":5,"color":"#377EB8"},"showlegend":false,"name":"","inherit":true},"3f584313272a":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines+markers","line":{"color":"#377EB8"},"marker":{"size":5,"color":"#377EB8"},"showlegend":false,"name":"","inherit":true},"3f5816f1236a":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines+markers","line":{"color":"#377EB8"},"marker":{"size":5,"color":"#377EB8"},"showlegend":false,"name":"","inherit":true},"3f581ac4dd5":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines+markers","line":{"color":"#4DAF4A"},"marker":{"size":5,"color":"#4DAF4A"},"showlegend":true,"name":"StepAUC - AUC medio global: 0.738","inherit":true},"3f585af12ba5":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines+markers","line":{"color":"#4DAF4A"},"marker":{"size":5,"color":"#4DAF4A"},"showlegend":false,"name":"","inherit":true},"3f5850a61eb8":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines+markers","line":{"color":"#4DAF4A"},"marker":{"size":5,"color":"#4DAF4A"},"showlegend":false,"name":"","inherit":true},"3f5835f01f2":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines+markers","line":{"color":"#4DAF4A"},"marker":{"size":5,"color":"#4DAF4A"},"showlegend":false,"name":"","inherit":true},"3f58671e2171":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines+markers","line":{"color":"#4DAF4A"},"marker":{"size":5,"color":"#4DAF4A"},"showlegend":false,"name":"","inherit":true},"3f5824a0758e":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines+markers","line":{"color":"#984EA3"},"marker":{"size":5,"color":"#984EA3"},"showlegend":true,"name":"Lasso - AUC medio global: 0.741","inherit":true},"3f5860867ec4":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines+markers","line":{"color":"#984EA3"},"marker":{"size":5,"color":"#984EA3"},"showlegend":false,"name":"","inherit":true},"3f585d4751f3":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines+markers","line":{"color":"#984EA3"},"marker":{"size":5,"color":"#984EA3"},"showlegend":false,"name":"","inherit":true},"3f584f7f5f9b":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines+markers","line":{"color":"#984EA3"},"marker":{"size":5,"color":"#984EA3"},"showlegend":false,"name":"","inherit":true},"3f582b915fd":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines+markers","line":{"color":"#984EA3"},"marker":{"size":5,"color":"#984EA3"},"showlegend":false,"name":"","inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"Comparación de AUC por Semilla y Fold para Diferentes Métodos","scene":{"xaxis":{"title":"Fold"},"yaxis":{"title":"Semilla"},"zaxis":{"title":"AUC"}},"yaxis":{"type":"category","categoryorder":"array","categoryarray":["seed_123","seed_27","seed_3","seed_50","seed_90"]},"hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":[1,2,3,4,5],"y":["seed_27","seed_27","seed_27","seed_27","seed_27"],"z":[0.70518292682926831,0.70057766367137353,0.73302469135802462,0.73506097560975614,0.78780487804878052],"type":"scatter3d","mode":"lines+markers","line":{"color":"#E41A1C"},"marker":{"color":"#E41A1C","size":5,"line":{"color":"rgba(31,119,180,1)"}},"showlegend":true,"name":"Todas Variables - AUC medio global: 0.728","error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"frame":null},{"x":[1,2,3,4,5],"y":["seed_3","seed_3","seed_3","seed_3","seed_3"],"z":[0.7910493827160493,0.73074454428754809,0.77591463414634143,0.676219512195122,0.71737804878048783],"type":"scatter3d","mode":"lines+markers","line":{"color":"#E41A1C"},"marker":{"color":"#E41A1C","size":5,"line":{"color":"rgba(255,127,14,1)"}},"showlegend":false,"name":"","error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"frame":null},{"x":[1,2,3,4,5],"y":["seed_123","seed_123","seed_123","seed_123","seed_123"],"z":[0.72677063027940214,0.6890243902439025,0.7347560975609756,0.72347560975609759,0.67164634146341462],"type":"scatter3d","mode":"lines+markers","line":{"color":"#E41A1C"},"marker":{"color":"#E41A1C","size":5,"line":{"color":"rgba(44,160,44,1)"}},"showlegend":false,"name":"","error_y":{"color":"rgba(44,160,44,1)"},"error_x":{"color":"rgba(44,160,44,1)"},"frame":null},{"x":[1,2,3,4,5],"y":["seed_50","seed_50","seed_50","seed_50","seed_50"],"z":[0.75121951219512195,0.73684210526315785,0.68231707317073165,0.71707317073170729,0.70426829268292679],"type":"scatter3d","mode":"lines+markers","line":{"color":"#E41A1C"},"marker":{"color":"#E41A1C","size":5,"line":{"color":"rgba(214,39,40,1)"}},"showlegend":false,"name":"","error_y":{"color":"rgba(214,39,40,1)"},"error_x":{"color":"rgba(214,39,40,1)"},"frame":null},{"x":[1,2,3,4,5],"y":["seed_90","seed_90","seed_90","seed_90","seed_90"],"z":[0.77469512195121948,0.81036585365853653,0.7432098765432098,0.69573170731707312,0.67458279845956348],"type":"scatter3d","mode":"lines+markers","line":{"color":"#E41A1C"},"marker":{"color":"#E41A1C","size":5,"line":{"color":"rgba(148,103,189,1)"}},"showlegend":false,"name":"","error_y":{"color":"rgba(148,103,189,1)"},"error_x":{"color":"rgba(148,103,189,1)"},"frame":null},{"x":[1,2,3,4,5],"y":["seed_27","seed_27","seed_27","seed_27","seed_27"],"z":[0.70426829268292679,0.73331193838254172,0.71512345679012346,0.74176829268292677,0.7780487804878049],"type":"scatter3d","mode":"lines+markers","line":{"color":"#377EB8"},"marker":{"color":"#377EB8","size":5,"line":{"color":"rgba(140,86,75,1)"}},"showlegend":true,"name":"Asociacion - AUC medio global: 0.729","error_y":{"color":"rgba(140,86,75,1)"},"error_x":{"color":"rgba(140,86,75,1)"},"frame":null},{"x":[1,2,3,4,5],"y":["seed_3","seed_3","seed_3","seed_3","seed_3"],"z":[0.81111111111111112,0.7339537869062901,0.78231707317073174,0.66829268292682931,0.74146341463414633],"type":"scatter3d","mode":"lines+markers","line":{"color":"#377EB8"},"marker":{"color":"#377EB8","size":5,"line":{"color":"rgba(227,119,194,1)"}},"showlegend":false,"name":"","error_y":{"color":"rgba(227,119,194,1)"},"error_x":{"color":"rgba(227,119,194,1)"},"frame":null},{"x":[1,2,3,4,5],"y":["seed_123","seed_123","seed_123","seed_123","seed_123"],"z":[0.66471734892787526,0.75731707317073171,0.67743902439024384,0.71036585365853655,0.69481707317073171],"type":"scatter3d","mode":"lines+markers","line":{"color":"#377EB8"},"marker":{"color":"#377EB8","size":5,"line":{"color":"rgba(127,127,127,1)"}},"showlegend":false,"name":"","error_y":{"color":"rgba(127,127,127,1)"},"error_x":{"color":"rgba(127,127,127,1)"},"frame":null},{"x":[1,2,3,4,5],"y":["seed_50","seed_50","seed_50","seed_50","seed_50"],"z":[0.72408536585365857,0.7550357374918778,0.71676829268292686,0.72896341463414627,0.65670731707317076],"type":"scatter3d","mode":"lines+markers","line":{"color":"#377EB8"},"marker":{"color":"#377EB8","size":5,"line":{"color":"rgba(188,189,34,1)"}},"showlegend":false,"name":"","error_y":{"color":"rgba(188,189,34,1)"},"error_x":{"color":"rgba(188,189,34,1)"},"frame":null},{"x":[1,2,3,4,5],"y":["seed_90","seed_90","seed_90","seed_90","seed_90"],"z":[0.76158536585365855,0.77591463414634143,0.74135802469135803,0.6786585365853659,0.77214377406931967],"type":"scatter3d","mode":"lines+markers","line":{"color":"#377EB8"},"marker":{"color":"#377EB8","size":5,"line":{"color":"rgba(23,190,207,1)"}},"showlegend":false,"name":"","error_y":{"color":"rgba(23,190,207,1)"},"error_x":{"color":"rgba(23,190,207,1)"},"frame":null},{"x":[1,2,3,4,5],"y":["seed_27","seed_27","seed_27","seed_27","seed_27"],"z":[0.70152439024390201,0.71598202824133494,0.70987654320987603,0.73201219512195104,0.77317073170731698],"type":"scatter3d","mode":"lines+markers","line":{"color":"#4DAF4A"},"marker":{"color":"#4DAF4A","size":5,"line":{"color":"rgba(31,119,180,1)"}},"showlegend":true,"name":"StepAUC - AUC medio global: 0.738","error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"frame":null},{"x":[1,2,3,4,5],"y":["seed_3","seed_3","seed_3","seed_3","seed_3"],"z":[0.79537037037036995,0.723042362002567,0.79939024390243896,0.70213414634146298,0.744207317073171],"type":"scatter3d","mode":"lines+markers","line":{"color":"#4DAF4A"},"marker":{"color":"#4DAF4A","size":5,"line":{"color":"rgba(255,127,14,1)"}},"showlegend":false,"name":"","error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"frame":null},{"x":[1,2,3,4,5],"y":["seed_123","seed_123","seed_123","seed_123","seed_123"],"z":[0.78232618583495805,0.74969512195121901,0.78262195121951195,0.70945121951219503,0.70548780487804896],"type":"scatter3d","mode":"lines+markers","line":{"color":"#4DAF4A"},"marker":{"color":"#4DAF4A","size":5,"line":{"color":"rgba(44,160,44,1)"}},"showlegend":false,"name":"","error_y":{"color":"rgba(44,160,44,1)"},"error_x":{"color":"rgba(44,160,44,1)"},"frame":null},{"x":[1,2,3,4,5],"y":["seed_50","seed_50","seed_50","seed_50","seed_50"],"z":[0.77957317073170695,0.71669915529564698,0.70213414634146298,0.73628048780487798,0.65609756097561001],"type":"scatter3d","mode":"lines+markers","line":{"color":"#4DAF4A"},"marker":{"color":"#4DAF4A","size":5,"line":{"color":"rgba(214,39,40,1)"}},"showlegend":false,"name":"","error_y":{"color":"rgba(214,39,40,1)"},"error_x":{"color":"rgba(214,39,40,1)"},"frame":null},{"x":[1,2,3,4,5],"y":["seed_90","seed_90","seed_90","seed_90","seed_90"],"z":[0.74603658536585404,0.79420731707317105,0.77129629629629604,0.64847560975609797,0.76636713735558404],"type":"scatter3d","mode":"lines+markers","line":{"color":"#4DAF4A"},"marker":{"color":"#4DAF4A","size":5,"line":{"color":"rgba(148,103,189,1)"}},"showlegend":false,"name":"","error_y":{"color":"rgba(148,103,189,1)"},"error_x":{"color":"rgba(148,103,189,1)"},"frame":null},{"x":[1,2,3,4,5],"y":["seed_27","seed_27","seed_27","seed_27","seed_27"],"z":[0.66463414634146301,0.71726572528883203,0.76944444444444404,0.76951219512195101,0.798170731707317],"type":"scatter3d","mode":"lines+markers","line":{"color":"#984EA3"},"marker":{"color":"#984EA3","size":5,"line":{"color":"rgba(140,86,75,1)"}},"showlegend":true,"name":"Lasso - AUC medio global: 0.741","error_y":{"color":"rgba(140,86,75,1)"},"error_x":{"color":"rgba(140,86,75,1)"},"frame":null},{"x":[1,2,3,4,5],"y":["seed_3","seed_3","seed_3","seed_3","seed_3"],"z":[0.77932098765432101,0.70282413350449302,0.77439024390243905,0.70213414634146298,0.76219512195121997],"type":"scatter3d","mode":"lines+markers","line":{"color":"#984EA3"},"marker":{"color":"#984EA3","size":5,"line":{"color":"rgba(227,119,194,1)"}},"showlegend":false,"name":"","error_y":{"color":"rgba(227,119,194,1)"},"error_x":{"color":"rgba(227,119,194,1)"},"frame":null},{"x":[1,2,3,4,5],"y":["seed_123","seed_123","seed_123","seed_123","seed_123"],"z":[0.73196881091617905,0.73689024390243896,0.74664634146341502,0.73231707317073202,0.71097560975609797],"type":"scatter3d","mode":"lines+markers","line":{"color":"#984EA3"},"marker":{"color":"#984EA3","size":5,"line":{"color":"rgba(127,127,127,1)"}},"showlegend":false,"name":"","error_y":{"color":"rgba(127,127,127,1)"},"error_x":{"color":"rgba(127,127,127,1)"},"frame":null},{"x":[1,2,3,4,5],"y":["seed_50","seed_50","seed_50","seed_50","seed_50"],"z":[0.79451219512195104,0.75211176088369103,0.71341463414634099,0.77317073170731698,0.68597560975609795],"type":"scatter3d","mode":"lines+markers","line":{"color":"#984EA3"},"marker":{"color":"#984EA3","size":5,"line":{"color":"rgba(188,189,34,1)"}},"showlegend":false,"name":"","error_y":{"color":"rgba(188,189,34,1)"},"error_x":{"color":"rgba(188,189,34,1)"},"frame":null},{"x":[1,2,3,4,5],"y":["seed_90","seed_90","seed_90","seed_90","seed_90"],"z":[0.73658536585365897,0.81493902439024402,0.76882716049382704,0.65121951219512197,0.72528883183568704],"type":"scatter3d","mode":"lines+markers","line":{"color":"#984EA3"},"marker":{"color":"#984EA3","size":5,"line":{"color":"rgba(23,190,207,1)"}},"showlegend":false,"name":"","error_y":{"color":"rgba(23,190,207,1)"},"error_x":{"color":"rgba(23,190,207,1)"},"frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>Se puede observar que la dispersión de las medidas de AUC a través de los Folds no es demasiado alta, manteniendo estos valores entre .65 y .8, adicionalmente, parece que todos los puntos siguen un patrón a lo largo de las semillas para los folds generados, transmitiendo que el modelo es robusto a la aleatoriedad de la división de los datos, y concluyendo que es robusto ante nuevos datos, con una buena capacidad de predicción. Estos patrones que se repiten pueden incluir una tendencia a la disminución del AUC en el fold 1, una inestabilidad en el fold 2, una estabilidad en el 3, y una tendencia a la mejora en el 4 y 5. Por otra aprte, el modelo que parece haber obtenido mejores métricas es el que ha empleado la selección de características Lasso, concordando con lo concluído en las anteriores secciones.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-9-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-9-1" role="tab" aria-controls="tabset-9-1" aria-selected="true" href="">TodasVariables</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-9-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-9-2" role="tab" aria-controls="tabset-9-2" aria-selected="false" href="">Asociacion</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-9-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-9-3" role="tab" aria-controls="tabset-9-3" aria-selected="false" href="">StepAUC</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-9-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-9-4" role="tab" aria-controls="tabset-9-4" aria-selected="false" href="">Lasso</a></li></ul>
<div class="tab-content">
<div id="tabset-9-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-9-1-tab">
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="fu">generate_auc_per_seed_and_fold</span>(AdaBoost_TodasVariables_Metrics<span class="sc">$</span>performance_metrics)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-73921c9570b63a5f3b90" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-73921c9570b63a5f3b90">{"x":{"visdat":{"3f58384264c":["function () ","plotlyVisDat"]},"cur_data":"3f58384264c","attrs":{"3f58384264c":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1,2,3,4,5],"y":[1,1,1,1,1],"z":[0.70518292682926831,0.70057766367137353,0.73302469135802462,0.73506097560975614,0.78780487804878052],"type":"scatter3d","mode":"lines+markers","line":{"width":2,"color":"#E41A1C"},"marker":{"size":5,"color":"#E41A1C"},"name":"Semilla 27 AUC medio: 0.709","inherit":true},"3f58384264c.1":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1,2,3,4,5],"y":[2,2,2,2,2],"z":[0.7910493827160493,0.73074454428754809,0.77591463414634143,0.676219512195122,0.71737804878048783],"type":"scatter3d","mode":"lines+markers","line":{"width":2,"color":"#377EB8"},"marker":{"size":5,"color":"#377EB8"},"name":"Semilla 3 AUC medio: 0.732","inherit":true},"3f58384264c.2":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1,2,3,4,5],"y":[3,3,3,3,3],"z":[0.72677063027940214,0.6890243902439025,0.7347560975609756,0.72347560975609759,0.67164634146341462],"type":"scatter3d","mode":"lines+markers","line":{"width":2,"color":"#4DAF4A"},"marker":{"size":5,"color":"#4DAF4A"},"name":"Semilla 123 AUC medio: 0.738","inherit":true},"3f58384264c.3":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1,2,3,4,5],"y":[4,4,4,4,4],"z":[0.75121951219512195,0.73684210526315785,0.68231707317073165,0.71707317073170729,0.70426829268292679],"type":"scatter3d","mode":"lines+markers","line":{"width":2,"color":"#984EA3"},"marker":{"size":5,"color":"#984EA3"},"name":"Semilla 50 AUC medio: 0.718","inherit":true},"3f58384264c.4":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1,2,3,4,5],"y":[5,5,5,5,5],"z":[0.77469512195121948,0.81036585365853653,0.7432098765432098,0.69573170731707312,0.67458279845956348],"type":"scatter3d","mode":"lines+markers","line":{"width":2,"color":"#FF7F00"},"marker":{"size":5,"color":"#FF7F00"},"name":"Semilla 90 AUC medio: 0.74","inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"scene":{"xaxis":{"title":"Fold"},"yaxis":{"title":"Semilla"},"zaxis":{"title":"AUC"},"title":"Visualización 3D de Folds, Semillas y AUC"},"hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":[1,2,3,4,5],"y":[1,1,1,1,1],"z":[0.70518292682926831,0.70057766367137353,0.73302469135802462,0.73506097560975614,0.78780487804878052],"type":"scatter3d","mode":"lines+markers","line":{"color":"#E41A1C","width":2},"marker":{"color":"#E41A1C","size":5,"line":{"color":"rgba(31,119,180,1)"}},"name":"Semilla 27 AUC medio: 0.709","error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"frame":null},{"x":[1,2,3,4,5],"y":[2,2,2,2,2],"z":[0.7910493827160493,0.73074454428754809,0.77591463414634143,0.676219512195122,0.71737804878048783],"type":"scatter3d","mode":"lines+markers","line":{"color":"#377EB8","width":2},"marker":{"color":"#377EB8","size":5,"line":{"color":"rgba(255,127,14,1)"}},"name":"Semilla 3 AUC medio: 0.732","error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"frame":null},{"x":[1,2,3,4,5],"y":[3,3,3,3,3],"z":[0.72677063027940214,0.6890243902439025,0.7347560975609756,0.72347560975609759,0.67164634146341462],"type":"scatter3d","mode":"lines+markers","line":{"color":"#4DAF4A","width":2},"marker":{"color":"#4DAF4A","size":5,"line":{"color":"rgba(44,160,44,1)"}},"name":"Semilla 123 AUC medio: 0.738","error_y":{"color":"rgba(44,160,44,1)"},"error_x":{"color":"rgba(44,160,44,1)"},"frame":null},{"x":[1,2,3,4,5],"y":[4,4,4,4,4],"z":[0.75121951219512195,0.73684210526315785,0.68231707317073165,0.71707317073170729,0.70426829268292679],"type":"scatter3d","mode":"lines+markers","line":{"color":"#984EA3","width":2},"marker":{"color":"#984EA3","size":5,"line":{"color":"rgba(214,39,40,1)"}},"name":"Semilla 50 AUC medio: 0.718","error_y":{"color":"rgba(214,39,40,1)"},"error_x":{"color":"rgba(214,39,40,1)"},"frame":null},{"x":[1,2,3,4,5],"y":[5,5,5,5,5],"z":[0.77469512195121948,0.81036585365853653,0.7432098765432098,0.69573170731707312,0.67458279845956348],"type":"scatter3d","mode":"lines+markers","line":{"color":"#FF7F00","width":2},"marker":{"color":"#FF7F00","size":5,"line":{"color":"rgba(148,103,189,1)"}},"name":"Semilla 90 AUC medio: 0.74","error_y":{"color":"rgba(148,103,189,1)"},"error_x":{"color":"rgba(148,103,189,1)"},"frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</div>
<div id="tabset-9-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-9-2-tab">
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="fu">generate_auc_per_seed_and_fold</span>(AdaBoost_Asociacion_Metrics<span class="sc">$</span>performance_metrics)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-2f4989c3553cdf1af207" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-2f4989c3553cdf1af207">{"x":{"visdat":{"3f58796a7ee9":["function () ","plotlyVisDat"]},"cur_data":"3f58796a7ee9","attrs":{"3f58796a7ee9":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1,2,3,4,5],"y":[1,1,1,1,1],"z":[0.70426829268292679,0.73331193838254172,0.71512345679012346,0.74176829268292677,0.7780487804878049],"type":"scatter3d","mode":"lines+markers","line":{"width":2,"color":"#E41A1C"},"marker":{"size":5,"color":"#E41A1C"},"name":"Semilla 27 AUC medio: 0.701","inherit":true},"3f58796a7ee9.1":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1,2,3,4,5],"y":[2,2,2,2,2],"z":[0.81111111111111112,0.7339537869062901,0.78231707317073174,0.66829268292682931,0.74146341463414633],"type":"scatter3d","mode":"lines+markers","line":{"width":2,"color":"#377EB8"},"marker":{"size":5,"color":"#377EB8"},"name":"Semilla 3 AUC medio: 0.735","inherit":true},"3f58796a7ee9.2":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1,2,3,4,5],"y":[3,3,3,3,3],"z":[0.66471734892787526,0.75731707317073171,0.67743902439024384,0.71036585365853655,0.69481707317073171],"type":"scatter3d","mode":"lines+markers","line":{"width":2,"color":"#4DAF4A"},"marker":{"size":5,"color":"#4DAF4A"},"name":"Semilla 123 AUC medio: 0.747","inherit":true},"3f58796a7ee9.3":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1,2,3,4,5],"y":[4,4,4,4,4],"z":[0.72408536585365857,0.7550357374918778,0.71676829268292686,0.72896341463414627,0.65670731707317076],"type":"scatter3d","mode":"lines+markers","line":{"width":2,"color":"#984EA3"},"marker":{"size":5,"color":"#984EA3"},"name":"Semilla 50 AUC medio: 0.716","inherit":true},"3f58796a7ee9.4":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1,2,3,4,5],"y":[5,5,5,5,5],"z":[0.76158536585365855,0.77591463414634143,0.74135802469135803,0.6786585365853659,0.77214377406931967],"type":"scatter3d","mode":"lines+markers","line":{"width":2,"color":"#FF7F00"},"marker":{"size":5,"color":"#FF7F00"},"name":"Semilla 90 AUC medio: 0.746","inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"scene":{"xaxis":{"title":"Fold"},"yaxis":{"title":"Semilla"},"zaxis":{"title":"AUC"},"title":"Visualización 3D de Folds, Semillas y AUC"},"hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":[1,2,3,4,5],"y":[1,1,1,1,1],"z":[0.70426829268292679,0.73331193838254172,0.71512345679012346,0.74176829268292677,0.7780487804878049],"type":"scatter3d","mode":"lines+markers","line":{"color":"#E41A1C","width":2},"marker":{"color":"#E41A1C","size":5,"line":{"color":"rgba(31,119,180,1)"}},"name":"Semilla 27 AUC medio: 0.701","error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"frame":null},{"x":[1,2,3,4,5],"y":[2,2,2,2,2],"z":[0.81111111111111112,0.7339537869062901,0.78231707317073174,0.66829268292682931,0.74146341463414633],"type":"scatter3d","mode":"lines+markers","line":{"color":"#377EB8","width":2},"marker":{"color":"#377EB8","size":5,"line":{"color":"rgba(255,127,14,1)"}},"name":"Semilla 3 AUC medio: 0.735","error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"frame":null},{"x":[1,2,3,4,5],"y":[3,3,3,3,3],"z":[0.66471734892787526,0.75731707317073171,0.67743902439024384,0.71036585365853655,0.69481707317073171],"type":"scatter3d","mode":"lines+markers","line":{"color":"#4DAF4A","width":2},"marker":{"color":"#4DAF4A","size":5,"line":{"color":"rgba(44,160,44,1)"}},"name":"Semilla 123 AUC medio: 0.747","error_y":{"color":"rgba(44,160,44,1)"},"error_x":{"color":"rgba(44,160,44,1)"},"frame":null},{"x":[1,2,3,4,5],"y":[4,4,4,4,4],"z":[0.72408536585365857,0.7550357374918778,0.71676829268292686,0.72896341463414627,0.65670731707317076],"type":"scatter3d","mode":"lines+markers","line":{"color":"#984EA3","width":2},"marker":{"color":"#984EA3","size":5,"line":{"color":"rgba(214,39,40,1)"}},"name":"Semilla 50 AUC medio: 0.716","error_y":{"color":"rgba(214,39,40,1)"},"error_x":{"color":"rgba(214,39,40,1)"},"frame":null},{"x":[1,2,3,4,5],"y":[5,5,5,5,5],"z":[0.76158536585365855,0.77591463414634143,0.74135802469135803,0.6786585365853659,0.77214377406931967],"type":"scatter3d","mode":"lines+markers","line":{"color":"#FF7F00","width":2},"marker":{"color":"#FF7F00","size":5,"line":{"color":"rgba(148,103,189,1)"}},"name":"Semilla 90 AUC medio: 0.746","error_y":{"color":"rgba(148,103,189,1)"},"error_x":{"color":"rgba(148,103,189,1)"},"frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</div>
<div id="tabset-9-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-9-3-tab">
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="fu">generate_auc_per_seed_and_fold</span>(AdaBoost_StepAUC_Metrics<span class="sc">$</span>performance_metrics)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-f37dddd8b6f09eff019f" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-f37dddd8b6f09eff019f">{"x":{"visdat":{"3f581d14282c":["function () ","plotlyVisDat"]},"cur_data":"3f581d14282c","attrs":{"3f581d14282c":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1,2,3,4,5],"y":[1,1,1,1,1],"z":[0.70152439024390201,0.71598202824133494,0.70987654320987603,0.73201219512195104,0.77317073170731698],"type":"scatter3d","mode":"lines+markers","line":{"width":2,"color":"#E41A1C"},"marker":{"size":5,"color":"#E41A1C"},"name":"Semilla 27 AUC medio: 0.746","inherit":true},"3f581d14282c.1":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1,2,3,4,5],"y":[2,2,2,2,2],"z":[0.79537037037036995,0.723042362002567,0.79939024390243896,0.70213414634146298,0.744207317073171],"type":"scatter3d","mode":"lines+markers","line":{"width":2,"color":"#377EB8"},"marker":{"size":5,"color":"#377EB8"},"name":"Semilla 3 AUC medio: 0.727","inherit":true},"3f581d14282c.2":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1,2,3,4,5],"y":[3,3,3,3,3],"z":[0.78232618583495805,0.74969512195121901,0.78262195121951195,0.70945121951219503,0.70548780487804896],"type":"scatter3d","mode":"lines+markers","line":{"width":2,"color":"#4DAF4A"},"marker":{"size":5,"color":"#4DAF4A"},"name":"Semilla 123 AUC medio: 0.753","inherit":true},"3f581d14282c.3":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1,2,3,4,5],"y":[4,4,4,4,4],"z":[0.77957317073170695,0.71669915529564698,0.70213414634146298,0.73628048780487798,0.65609756097561001],"type":"scatter3d","mode":"lines+markers","line":{"width":2,"color":"#984EA3"},"marker":{"size":5,"color":"#984EA3"},"name":"Semilla 50 AUC medio: 0.718","inherit":true},"3f581d14282c.4":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1,2,3,4,5],"y":[5,5,5,5,5],"z":[0.74603658536585404,0.79420731707317105,0.77129629629629604,0.64847560975609797,0.76636713735558404],"type":"scatter3d","mode":"lines+markers","line":{"width":2,"color":"#FF7F00"},"marker":{"size":5,"color":"#FF7F00"},"name":"Semilla 90 AUC medio: 0.745","inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"scene":{"xaxis":{"title":"Fold"},"yaxis":{"title":"Semilla"},"zaxis":{"title":"AUC"},"title":"Visualización 3D de Folds, Semillas y AUC"},"hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":[1,2,3,4,5],"y":[1,1,1,1,1],"z":[0.70152439024390201,0.71598202824133494,0.70987654320987603,0.73201219512195104,0.77317073170731698],"type":"scatter3d","mode":"lines+markers","line":{"color":"#E41A1C","width":2},"marker":{"color":"#E41A1C","size":5,"line":{"color":"rgba(31,119,180,1)"}},"name":"Semilla 27 AUC medio: 0.746","error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"frame":null},{"x":[1,2,3,4,5],"y":[2,2,2,2,2],"z":[0.79537037037036995,0.723042362002567,0.79939024390243896,0.70213414634146298,0.744207317073171],"type":"scatter3d","mode":"lines+markers","line":{"color":"#377EB8","width":2},"marker":{"color":"#377EB8","size":5,"line":{"color":"rgba(255,127,14,1)"}},"name":"Semilla 3 AUC medio: 0.727","error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"frame":null},{"x":[1,2,3,4,5],"y":[3,3,3,3,3],"z":[0.78232618583495805,0.74969512195121901,0.78262195121951195,0.70945121951219503,0.70548780487804896],"type":"scatter3d","mode":"lines+markers","line":{"color":"#4DAF4A","width":2},"marker":{"color":"#4DAF4A","size":5,"line":{"color":"rgba(44,160,44,1)"}},"name":"Semilla 123 AUC medio: 0.753","error_y":{"color":"rgba(44,160,44,1)"},"error_x":{"color":"rgba(44,160,44,1)"},"frame":null},{"x":[1,2,3,4,5],"y":[4,4,4,4,4],"z":[0.77957317073170695,0.71669915529564698,0.70213414634146298,0.73628048780487798,0.65609756097561001],"type":"scatter3d","mode":"lines+markers","line":{"color":"#984EA3","width":2},"marker":{"color":"#984EA3","size":5,"line":{"color":"rgba(214,39,40,1)"}},"name":"Semilla 50 AUC medio: 0.718","error_y":{"color":"rgba(214,39,40,1)"},"error_x":{"color":"rgba(214,39,40,1)"},"frame":null},{"x":[1,2,3,4,5],"y":[5,5,5,5,5],"z":[0.74603658536585404,0.79420731707317105,0.77129629629629604,0.64847560975609797,0.76636713735558404],"type":"scatter3d","mode":"lines+markers","line":{"color":"#FF7F00","width":2},"marker":{"color":"#FF7F00","size":5,"line":{"color":"rgba(148,103,189,1)"}},"name":"Semilla 90 AUC medio: 0.745","error_y":{"color":"rgba(148,103,189,1)"},"error_x":{"color":"rgba(148,103,189,1)"},"frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</div>
<div id="tabset-9-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-9-4-tab">
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="fu">generate_auc_per_seed_and_fold</span>(AdaBoost_Lasso_Metrics<span class="sc">$</span>performance_metrics)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-31ff9c858187697aaa76" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-31ff9c858187697aaa76">{"x":{"visdat":{"3f58220472dd":["function () ","plotlyVisDat"]},"cur_data":"3f58220472dd","attrs":{"3f58220472dd":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1,2,3,4,5],"y":[1,1,1,1,1],"z":[0.66463414634146301,0.71726572528883203,0.76944444444444404,0.76951219512195101,0.798170731707317],"type":"scatter3d","mode":"lines+markers","line":{"width":2,"color":"#E41A1C"},"marker":{"size":5,"color":"#E41A1C"},"name":"Semilla 27 AUC medio: 0.732","inherit":true},"3f58220472dd.1":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1,2,3,4,5],"y":[2,2,2,2,2],"z":[0.77932098765432101,0.70282413350449302,0.77439024390243905,0.70213414634146298,0.76219512195121997],"type":"scatter3d","mode":"lines+markers","line":{"width":2,"color":"#377EB8"},"marker":{"size":5,"color":"#377EB8"},"name":"Semilla 3 AUC medio: 0.744","inherit":true},"3f58220472dd.2":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1,2,3,4,5],"y":[3,3,3,3,3],"z":[0.73196881091617905,0.73689024390243896,0.74664634146341502,0.73231707317073202,0.71097560975609797],"type":"scatter3d","mode":"lines+markers","line":{"width":2,"color":"#4DAF4A"},"marker":{"size":5,"color":"#4DAF4A"},"name":"Semilla 123 AUC medio: 0.744","inherit":true},"3f58220472dd.3":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1,2,3,4,5],"y":[4,4,4,4,4],"z":[0.79451219512195104,0.75211176088369103,0.71341463414634099,0.77317073170731698,0.68597560975609795],"type":"scatter3d","mode":"lines+markers","line":{"width":2,"color":"#984EA3"},"marker":{"size":5,"color":"#984EA3"},"name":"Semilla 50 AUC medio: 0.744","inherit":true},"3f58220472dd.4":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1,2,3,4,5],"y":[5,5,5,5,5],"z":[0.73658536585365897,0.81493902439024402,0.76882716049382704,0.65121951219512197,0.72528883183568704],"type":"scatter3d","mode":"lines+markers","line":{"width":2,"color":"#FF7F00"},"marker":{"size":5,"color":"#FF7F00"},"name":"Semilla 90 AUC medio: 0.739","inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"scene":{"xaxis":{"title":"Fold"},"yaxis":{"title":"Semilla"},"zaxis":{"title":"AUC"},"title":"Visualización 3D de Folds, Semillas y AUC"},"hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":[1,2,3,4,5],"y":[1,1,1,1,1],"z":[0.66463414634146301,0.71726572528883203,0.76944444444444404,0.76951219512195101,0.798170731707317],"type":"scatter3d","mode":"lines+markers","line":{"color":"#E41A1C","width":2},"marker":{"color":"#E41A1C","size":5,"line":{"color":"rgba(31,119,180,1)"}},"name":"Semilla 27 AUC medio: 0.732","error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"frame":null},{"x":[1,2,3,4,5],"y":[2,2,2,2,2],"z":[0.77932098765432101,0.70282413350449302,0.77439024390243905,0.70213414634146298,0.76219512195121997],"type":"scatter3d","mode":"lines+markers","line":{"color":"#377EB8","width":2},"marker":{"color":"#377EB8","size":5,"line":{"color":"rgba(255,127,14,1)"}},"name":"Semilla 3 AUC medio: 0.744","error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"frame":null},{"x":[1,2,3,4,5],"y":[3,3,3,3,3],"z":[0.73196881091617905,0.73689024390243896,0.74664634146341502,0.73231707317073202,0.71097560975609797],"type":"scatter3d","mode":"lines+markers","line":{"color":"#4DAF4A","width":2},"marker":{"color":"#4DAF4A","size":5,"line":{"color":"rgba(44,160,44,1)"}},"name":"Semilla 123 AUC medio: 0.744","error_y":{"color":"rgba(44,160,44,1)"},"error_x":{"color":"rgba(44,160,44,1)"},"frame":null},{"x":[1,2,3,4,5],"y":[4,4,4,4,4],"z":[0.79451219512195104,0.75211176088369103,0.71341463414634099,0.77317073170731698,0.68597560975609795],"type":"scatter3d","mode":"lines+markers","line":{"color":"#984EA3","width":2},"marker":{"color":"#984EA3","size":5,"line":{"color":"rgba(214,39,40,1)"}},"name":"Semilla 50 AUC medio: 0.744","error_y":{"color":"rgba(214,39,40,1)"},"error_x":{"color":"rgba(214,39,40,1)"},"frame":null},{"x":[1,2,3,4,5],"y":[5,5,5,5,5],"z":[0.73658536585365897,0.81493902439024402,0.76882716049382704,0.65121951219512197,0.72528883183568704],"type":"scatter3d","mode":"lines+markers","line":{"color":"#FF7F00","width":2},"marker":{"color":"#FF7F00","size":5,"line":{"color":"rgba(148,103,189,1)"}},"name":"Semilla 90 AUC medio: 0.739","error_y":{"color":"rgba(148,103,189,1)"},"error_x":{"color":"rgba(148,103,189,1)"},"frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="knn" class="level3" data-number="4.2.3">
<h3 data-number="4.2.3" class="anchored" data-anchor-id="knn"><span class="header-section-number">4.2.3</span> KNN</h3>
<section id="auc-fold-interno-vs-externo-2" class="level4" data-number="4.2.3.1">
<h4 data-number="4.2.3.1" class="anchored" data-anchor-id="auc-fold-interno-vs-externo-2"><span class="header-section-number">4.2.3.1</span> AUC Fold Interno vs Externo</h4>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-10-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-10-1" role="tab" aria-controls="tabset-10-1" aria-selected="true" href="">TodasVariables</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-10-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-10-2" role="tab" aria-controls="tabset-10-2" aria-selected="false" href="">Asociacion</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-10-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-10-3" role="tab" aria-controls="tabset-10-3" aria-selected="false" href="">StepAUC</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-10-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-10-4" role="tab" aria-controls="tabset-10-4" aria-selected="false" href="">Lasso</a></li></ul>
<div class="tab-content">
<div id="tabset-10-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-10-1-tab">
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a><span class="fu">generate_inner_outer_auc_comparison</span>(KNN_TodasVariables_Metrics<span class="sc">$</span>inner_fold_metrics,</span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a>                                    KNN_TodasVariables_Metrics<span class="sc">$</span>performance_metrics)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-0faf31624f7b5a5b8f54" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-0faf31624f7b5a5b8f54">{"x":{"visdat":{"3f58ecc3f99":["function () ","plotlyVisDat"]},"cur_data":"3f58ecc3f99","attrs":{"3f58ecc3f99":{"x":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"y":{},"type":"bar","name":"AUC Medio Inner Folds","marker":{"color":"blue"},"inherit":true},"3f58ecc3f99.1":{"x":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"y":{},"type":"bar","name":"AUC Medio Outer Folds","marker":{"color":"red"},"inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"Comparación de AUC Medio: Inner Folds vs Outer Folds","xaxis":{"domain":[0,1],"automargin":true,"title":"Fold"},"yaxis":{"domain":[0,1],"automargin":true,"title":"AUC Medio","range":[0,1]},"barmode":"group","hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":[1,2,3,4,5],"y":[0.72535100302336197,0.72357416517033268,0.7153436784205619,0.73347943571902685,0.75116333972152838],"type":"bar","name":"AUC Medio Inner Folds","marker":{"color":"blue","line":{"color":"rgba(31,119,180,1)"}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[1,2,3,4,5],"y":[0.70760903500847872,0.67053915275994858,0.69137082204155376,0.64743902439024392,0.75065789473684208],"type":"bar","name":"AUC Medio Outer Folds","marker":{"color":"red","line":{"color":"rgba(255,127,14,1)"}},"error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</div>
<div id="tabset-10-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-10-2-tab">
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="fu">generate_inner_outer_auc_comparison</span>(KNN_Asociacion_Metrics<span class="sc">$</span>inner_fold_metrics,</span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a>                                    KNN_Asociacion_Metrics<span class="sc">$</span>performance_metrics)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-f59004e1334c6fe47756" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-f59004e1334c6fe47756">{"x":{"visdat":{"3f58657d5577":["function () ","plotlyVisDat"]},"cur_data":"3f58657d5577","attrs":{"3f58657d5577":{"x":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"y":{},"type":"bar","name":"AUC Medio Inner Folds","marker":{"color":"blue"},"inherit":true},"3f58657d5577.1":{"x":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"y":{},"type":"bar","name":"AUC Medio Outer Folds","marker":{"color":"red"},"inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"Comparación de AUC Medio: Inner Folds vs Outer Folds","xaxis":{"domain":[0,1],"automargin":true,"title":"Fold"},"yaxis":{"domain":[0,1],"automargin":true,"title":"AUC Medio","range":[0,1]},"barmode":"group","hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":[1,2,3,4,5],"y":[0.75421855636383173,0.76965900730709758,0.75197939807088021,0.76188940940848771,0.75349761114116576],"type":"bar","name":"AUC Medio Inner Folds","marker":{"color":"blue","line":{"color":"rgba(31,119,180,1)"}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[1,2,3,4,5],"y":[0.76124784069478124,0.75713688014073122,0.75271604938271608,0.71219512195121948,0.74548459563543001],"type":"bar","name":"AUC Medio Outer Folds","marker":{"color":"red","line":{"color":"rgba(255,127,14,1)"}},"error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</div>
<div id="tabset-10-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-10-3-tab">
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="fu">generate_inner_outer_auc_comparison</span>(KNN_StepAUC_Metrics<span class="sc">$</span>inner_fold_metrics, </span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a>                                    KNN_StepAUC_Metrics<span class="sc">$</span>performance_metrics)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-6bb3e5819dacea766449" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-6bb3e5819dacea766449">{"x":{"visdat":{"3f583063bec":["function () ","plotlyVisDat"]},"cur_data":"3f583063bec","attrs":{"3f583063bec":{"x":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"y":{},"type":"bar","name":"AUC Medio Inner Folds","marker":{"color":"blue"},"inherit":true},"3f583063bec.1":{"x":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"y":{},"type":"bar","name":"AUC Medio Outer Folds","marker":{"color":"red"},"inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"Comparación de AUC Medio: Inner Folds vs Outer Folds","xaxis":{"domain":[0,1],"automargin":true,"title":"Fold"},"yaxis":{"domain":[0,1],"automargin":true,"title":"AUC Medio","range":[0,1]},"barmode":"group","hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":[1,2,3,4,5],"y":[0.7615698989399049,0.75743337237230324,0.76178758316163864,0.77785450406120393,0.75862906552024467],"type":"bar","name":"AUC Medio Inner Folds","marker":{"color":"blue","line":{"color":"rgba(31,119,180,1)"}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[1,2,3,4,5],"y":[0.71394463462178503,0.73604855069018515,0.72812631737428479,0.6880487804878046,0.7271854942233632],"type":"bar","name":"AUC Medio Outer Folds","marker":{"color":"red","line":{"color":"rgba(255,127,14,1)"}},"error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</div>
<div id="tabset-10-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-10-4-tab">
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a><span class="fu">generate_inner_outer_auc_comparison</span>(KNN_Lasso_Metrics<span class="sc">$</span>inner_fold_metrics, </span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a>                                    KNN_Lasso_Metrics<span class="sc">$</span>performance_metrics)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-6a6055d9b4ece5c37d0e" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-6a6055d9b4ece5c37d0e">{"x":{"visdat":{"3f5846ef4bec":["function () ","plotlyVisDat"]},"cur_data":"3f5846ef4bec","attrs":{"3f5846ef4bec":{"x":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"y":{},"type":"bar","name":"AUC Medio Inner Folds","marker":{"color":"blue"},"inherit":true},"3f5846ef4bec.1":{"x":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"y":{},"type":"bar","name":"AUC Medio Outer Folds","marker":{"color":"red"},"inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"Comparación de AUC Medio: Inner Folds vs Outer Folds","xaxis":{"domain":[0,1],"automargin":true,"title":"Fold"},"yaxis":{"domain":[0,1],"automargin":true,"title":"AUC Medio","range":[0,1]},"barmode":"group","hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":[1,2,3,4,5],"y":[0.76061322225355577,0.7355021497467672,0.74256776490517851,0.69696617625990576,0.71573813335957959],"type":"bar","name":"AUC Medio Inner Folds","marker":{"color":"blue","line":{"color":"rgba(31,119,180,1)"}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[1,2,3,4,5],"y":[0.74556447375375157,0.72124028749028779,0.69871961664912297,0.73603741875876116,0.68622099947744353],"type":"bar","name":"AUC Medio Outer Folds","marker":{"color":"red","line":{"color":"rgba(255,127,14,1)"}},"error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</div>
</div>
</div>
<p>Habiendo observados las gráficas de comparación del AUC de los folds internos contra los externos, se puede percibir que todos los métodos de selección de características proveen al KNN de una estabilidad robusta frente a predicciones, demostrado a través de la igualdad entre el AUC medio interno y externo. En los métodos TodasVariables, Asociación, y Lasso, se pueden observar que el AUC externo de los primeros folds incluso llega a superar al interno, si este comportamiento se repitiera de una manera más exagerada se podría sospechar de un sobreajuste o fuga de muestras de test en train, sin embargo, en este caso, parece que es un hecho más que resalta la capacidad de generalización del modelo KNN para nuestro problema. La contraparte es, que el AUC máximo no es tan alto como otros modelos que hemos observado anteriormente, sin embargo, de este análisis se puede concluir que el KNN es robusto al entrenamiento con datos aleatorios.</p>
</section>
<section id="auc-medio-folds-externos-2" class="level4" data-number="4.2.3.2">
<h4 data-number="4.2.3.2" class="anchored" data-anchor-id="auc-medio-folds-externos-2"><span class="header-section-number">4.2.3.2</span> AUC Medio Folds Externos</h4>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-11-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-11-1" role="tab" aria-controls="tabset-11-1" aria-selected="true" href="">TodasVariables</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-11-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-11-2" role="tab" aria-controls="tabset-11-2" aria-selected="false" href="">Asociacion</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-11-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-11-3" role="tab" aria-controls="tabset-11-3" aria-selected="false" href="">StepAUC</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-11-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-11-4" role="tab" aria-controls="tabset-11-4" aria-selected="false" href="">Lasso</a></li></ul>
<div class="tab-content">
<div id="tabset-11-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-11-1-tab">
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a><span class="fu">generate_outer_auc_violin_plot</span>(KNN_TodasVariables_Metrics<span class="sc">$</span>performance_metrics)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-3d67ba4cad66798aacbb" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-3d67ba4cad66798aacbb">{"x":{"visdat":{"3f585ef52c52":["function () ","plotlyVisDat"]},"cur_data":"3f585ef52c52","attrs":{"3f585ef52c52":{"y":{},"x":{},"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","color":{},"colors":["#E41A1C","#377EB8","#4DAF4A","#984EA3","#FF7F00"],"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"violin"}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"Distribución del AUC por Outer Fold","xaxis":{"domain":[0,1],"automargin":true,"title":"Fold","type":"category","categoryorder":"array","categoryarray":["1","2","3","4","5"]},"yaxis":{"domain":[0,1],"automargin":true,"title":"AUC"},"hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"fillcolor":"rgba(228,26,28,0.5)","y":[0.73109756097560974,0.68271604938271602,0.72514619883040932,0.65701219512195119,0.74207317073170731],"x":["1","1","1","1","1"],"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","type":"violin","name":"1","marker":{"color":"rgba(228,26,28,1)","line":{"color":"rgba(228,26,28,1)"}},"line":{"color":"rgba(228,26,28,1)"},"xaxis":"x","yaxis":"y","frame":null},{"fillcolor":"rgba(55,126,184,0.5)","y":[0.60141206675224645,0.64441591784338892,0.673170731707317,0.71052631578947367,0.72317073170731705],"x":["2","2","2","2","2"],"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","type":"violin","name":"2","marker":{"color":"rgba(55,126,184,1)","line":{"color":"rgba(55,126,184,1)"}},"line":{"color":"rgba(55,126,184,1)"},"xaxis":"x","yaxis":"y","frame":null},{"fillcolor":"rgba(77,175,74,0.5)","y":[0.69228395061728398,0.698780487804878,0.76371951219512191,0.60731707317073169,0.69475308641975309],"x":["3","3","3","3","3"],"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","type":"violin","name":"3","marker":{"color":"rgba(77,175,74,1)","line":{"color":"rgba(77,175,74,1)"}},"line":{"color":"rgba(77,175,74,1)"},"xaxis":"x","yaxis":"y","frame":null},{"fillcolor":"rgba(152,78,163,0.5)","y":[0.62012195121951219,0.58841463414634143,0.6963414634146341,0.65701219512195119,0.67530487804878048],"x":["4","4","4","4","4"],"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","type":"violin","name":"4","marker":{"color":"rgba(152,78,163,1)","line":{"color":"rgba(152,78,163,1)"}},"line":{"color":"rgba(152,78,163,1)"},"xaxis":"x","yaxis":"y","frame":null},{"fillcolor":"rgba(255,127,0,0.5)","y":[0.79054878048780486,0.76737804878048776,0.70457317073170733,0.7908536585365854,0.69993581514762515],"x":["5","5","5","5","5"],"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","type":"violin","name":"5","marker":{"color":"rgba(255,127,0,1)","line":{"color":"rgba(255,127,0,1)"}},"line":{"color":"rgba(255,127,0,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</div>
<div id="tabset-11-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-11-2-tab">
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a><span class="fu">generate_outer_auc_violin_plot</span>(KNN_Asociacion_Metrics<span class="sc">$</span>performance_metrics)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-b1608fa7081b89026359" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-b1608fa7081b89026359">{"x":{"visdat":{"3f583e182d82":["function () ","plotlyVisDat"]},"cur_data":"3f583e182d82","attrs":{"3f583e182d82":{"y":{},"x":{},"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","color":{},"colors":["#E41A1C","#377EB8","#4DAF4A","#984EA3","#FF7F00"],"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"violin"}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"Distribución del AUC por Outer Fold","xaxis":{"domain":[0,1],"automargin":true,"title":"Fold","type":"category","categoryorder":"array","categoryarray":["1","2","3","4","5"]},"yaxis":{"domain":[0,1],"automargin":true,"title":"AUC"},"hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"fillcolor":"rgba(228,26,28,0.5)","y":[0.72621951219512193,0.79907407407407405,0.75990903183885639,0.8213414634146341,0.69969512195121952],"x":["1","1","1","1","1"],"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","type":"violin","name":"1","marker":{"color":"rgba(228,26,28,1)","line":{"color":"rgba(228,26,28,1)"}},"line":{"color":"rgba(228,26,28,1)"},"xaxis":"x","yaxis":"y","frame":null},{"fillcolor":"rgba(55,126,184,0.5)","y":[0.70988446726572529,0.72946084724005134,0.78170731707317076,0.75243664717348924,0.81219512195121946],"x":["2","2","2","2","2"],"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","type":"violin","name":"2","marker":{"color":"rgba(55,126,184,1)","line":{"color":"rgba(55,126,184,1)"}},"line":{"color":"rgba(55,126,184,1)"},"xaxis":"x","yaxis":"y","frame":null},{"fillcolor":"rgba(77,175,74,0.5)","y":[0.78179012345679011,0.78018292682926826,0.69786585365853659,0.74695121951219512,0.75679012345679009],"x":["3","3","3","3","3"],"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","type":"violin","name":"3","marker":{"color":"rgba(77,175,74,1)","line":{"color":"rgba(77,175,74,1)"}},"line":{"color":"rgba(77,175,74,1)"},"xaxis":"x","yaxis":"y","frame":null},{"fillcolor":"rgba(152,78,163,0.5)","y":[0.74542682926829262,0.67560975609756102,0.71219512195121948,0.69695121951219507,0.73079268292682931],"x":["4","4","4","4","4"],"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","type":"violin","name":"4","marker":{"color":"rgba(152,78,163,1)","line":{"color":"rgba(152,78,163,1)"}},"line":{"color":"rgba(152,78,163,1)"},"xaxis":"x","yaxis":"y","frame":null},{"fillcolor":"rgba(255,127,0,0.5)","y":[0.76951219512195124,0.73048780487804876,0.75335365853658531,0.71829268292682924,0.75577663671373552],"x":["5","5","5","5","5"],"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","type":"violin","name":"5","marker":{"color":"rgba(255,127,0,1)","line":{"color":"rgba(255,127,0,1)"}},"line":{"color":"rgba(255,127,0,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</div>
<div id="tabset-11-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-11-3-tab">
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a><span class="fu">generate_outer_auc_violin_plot</span>(KNN_StepAUC_Metrics<span class="sc">$</span>performance_metrics)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-b3bf3088f53a88166bbc" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-b3bf3088f53a88166bbc">{"x":{"visdat":{"3f581f82584d":["function () ","plotlyVisDat"]},"cur_data":"3f581f82584d","attrs":{"3f581f82584d":{"y":{},"x":{},"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","color":{},"colors":["#E41A1C","#377EB8","#4DAF4A","#984EA3","#FF7F00"],"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"violin"}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"Distribución del AUC por Outer Fold","xaxis":{"domain":[0,1],"automargin":true,"title":"Fold","type":"category","categoryorder":"array","categoryarray":["1","2","3","4","5"]},"yaxis":{"domain":[0,1],"automargin":true,"title":"AUC"},"hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"fillcolor":"rgba(228,26,28,0.5)","y":[0.72103658536585402,0.79320987654320996,0.67803768680961696,0.66859756097560996,0.70884146341463405],"x":["1","1","1","1","1"],"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","type":"violin","name":"1","marker":{"color":"rgba(228,26,28,1)","line":{"color":"rgba(228,26,28,1)"}},"line":{"color":"rgba(228,26,28,1)"},"xaxis":"x","yaxis":"y","frame":null},{"fillcolor":"rgba(55,126,184,0.5)","y":[0.72560975609756095,0.71084724005134803,0.72256097560975596,0.76543209876543195,0.755792682926829],"x":["2","2","2","2","2"],"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","type":"violin","name":"2","marker":{"color":"rgba(55,126,184,1)","line":{"color":"rgba(55,126,184,1)"}},"line":{"color":"rgba(55,126,184,1)"},"xaxis":"x","yaxis":"y","frame":null},{"fillcolor":"rgba(77,175,74,0.5)","y":[0.65895061728395099,0.79207317073170702,0.69268292682926802,0.72408536585365901,0.77283950617283903],"x":["3","3","3","3","3"],"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","type":"violin","name":"3","marker":{"color":"rgba(77,175,74,1)","line":{"color":"rgba(77,175,74,1)"}},"line":{"color":"rgba(77,175,74,1)"},"xaxis":"x","yaxis":"y","frame":null},{"fillcolor":"rgba(152,78,163,0.5)","y":[0.62957317073170704,0.68841463414634096,0.73506097560975603,0.70152439024390201,0.68567073170731696],"x":["4","4","4","4","4"],"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","type":"violin","name":"4","marker":{"color":"rgba(152,78,163,1)","line":{"color":"rgba(152,78,163,1)"}},"line":{"color":"rgba(152,78,163,1)"},"xaxis":"x","yaxis":"y","frame":null},{"fillcolor":"rgba(255,127,0,0.5)","y":[0.73079268292682897,0.70396341463414602,0.76859756097561005,0.73231707317073202,0.70025673940949895],"x":["5","5","5","5","5"],"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","type":"violin","name":"5","marker":{"color":"rgba(255,127,0,1)","line":{"color":"rgba(255,127,0,1)"}},"line":{"color":"rgba(255,127,0,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</div>
<div id="tabset-11-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-11-4-tab">
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a><span class="fu">generate_outer_auc_violin_plot</span>(KNN_Lasso_Metrics<span class="sc">$</span>performance_metrics)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-eac7dfa567a9cb1ec807" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-eac7dfa567a9cb1ec807">{"x":{"visdat":{"3f5821d84415":["function () ","plotlyVisDat"]},"cur_data":"3f5821d84415","attrs":{"3f5821d84415":{"y":{},"x":{},"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","color":{},"colors":["#E41A1C","#377EB8","#4DAF4A","#984EA3","#FF7F00"],"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"violin"}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"Distribución del AUC por Outer Fold","xaxis":{"domain":[0,1],"automargin":true,"title":"Fold","type":"category","categoryorder":"array","categoryarray":["1","2","3","4","5"]},"yaxis":{"domain":[0,1],"automargin":true,"title":"AUC"},"hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"fillcolor":"rgba(228,26,28,0.5)","y":[0.73124999999999996,0.79411764705882304,0.64473684210526305,0.80142857142857105,0.75628930817610096],"x":["1","1","1","1","1"],"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","type":"violin","name":"1","marker":{"color":"rgba(228,26,28,1)","line":{"color":"rgba(228,26,28,1)"}},"line":{"color":"rgba(228,26,28,1)"},"xaxis":"x","yaxis":"y","frame":null},{"fillcolor":"rgba(55,126,184,0.5)","y":[0.77777777777777801,0.61454545454545495,0.61666666666666703,0.83999999999999997,0.75721153846153899],"x":["2","2","2","2","2"],"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","type":"violin","name":"2","marker":{"color":"rgba(55,126,184,1)","line":{"color":"rgba(55,126,184,1)"}},"line":{"color":"rgba(55,126,184,1)"},"xaxis":"x","yaxis":"y","frame":null},{"fillcolor":"rgba(77,175,74,0.5)","y":[0.78965517241379302,0.65100154083204897,0.870056497175141,0.63788487282463202,0.54500000000000004],"x":["3","3","3","3","3"],"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","type":"violin","name":"3","marker":{"color":"rgba(77,175,74,1)","line":{"color":"rgba(77,175,74,1)"}},"line":{"color":"rgba(77,175,74,1)"},"xaxis":"x","yaxis":"y","frame":null},{"fillcolor":"rgba(152,78,163,0.5)","y":[0.75175438596491195,0.884533898305085,0.640625,0.67708333333333304,0.72619047619047605],"x":["4","4","4","4","4"],"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","type":"violin","name":"4","marker":{"color":"rgba(152,78,163,1)","line":{"color":"rgba(152,78,163,1)"}},"line":{"color":"rgba(152,78,163,1)"},"xaxis":"x","yaxis":"y","frame":null},{"fillcolor":"rgba(255,127,0,0.5)","y":[0.57746913580246895,0.76865671641791,0.83437499999999998,0.50816993464052296,0.74243421052631597],"x":["5","5","5","5","5"],"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","type":"violin","name":"5","marker":{"color":"rgba(255,127,0,1)","line":{"color":"rgba(255,127,0,1)"}},"line":{"color":"rgba(255,127,0,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</div>
</div>
</div>
<p>A partir de los gráficos de violín del AUC por cada Fold, se deben destar dos métodos, el primero de ellos siendo el método StepAUC, que muestra una dispersión relativamente alta, pero centrada alrededor de valores altos de AUC, indicando que el modelo tiene una buena capacidad predictiva, pero no es muy robusto. En el otro extremo, se encuentra el método de Asociación, el cual tiene valores máximos de AUC algo más bajos, pero su dispersión es mucho menor, haciendo que la media global del AUC pueda acabar siendo más alta para este método, ya que se vería menos afectado por valores atípicos pequeños.</p>
</section>
<section id="comparativa-knn" class="level4" data-number="4.2.3.3">
<h4 data-number="4.2.3.3" class="anchored" data-anchor-id="comparativa-knn"><span class="header-section-number">4.2.3.3</span> Comparativa KNN</h4>
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a>fig <span class="ot">&lt;-</span> <span class="fu">generate_combined_auc_3d_plot</span>(</span>
<span id="cb127-2"><a href="#cb127-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(</span>
<span id="cb127-3"><a href="#cb127-3" aria-hidden="true" tabindex="-1"></a>    KNN_TodasVariables_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb127-4"><a href="#cb127-4" aria-hidden="true" tabindex="-1"></a>    KNN_Asociacion_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb127-5"><a href="#cb127-5" aria-hidden="true" tabindex="-1"></a>    KNN_StepAUC_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb127-6"><a href="#cb127-6" aria-hidden="true" tabindex="-1"></a>    KNN_Lasso_Metrics<span class="sc">$</span>performance_metrics</span>
<span id="cb127-7"><a href="#cb127-7" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb127-8"><a href="#cb127-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">"Todas Variables"</span>, <span class="st">"Asociacion"</span>, <span class="st">"StepAUC"</span>, <span class="st">"Lasso"</span>)</span>
<span id="cb127-9"><a href="#cb127-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb127-10"><a href="#cb127-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-11"><a href="#cb127-11" aria-hidden="true" tabindex="-1"></a>fig</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-bd9bdaab816e4134d770" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-bd9bdaab816e4134d770">{"x":{"visdat":{"3f58516c4831":["function () ","plotlyVisDat"],"3f585e422262":["function () ","data"],"3f5822b55c92":["function () ","data"],"3f585baac5":["function () ","data"],"3f5870fd6da7":["function () ","data"],"3f58be53fe9":["function () ","data"],"3f58555a277f":["function () ","data"],"3f5844d5ff5":["function () ","data"],"3f5869df7c2e":["function () ","data"],"3f582f4c3944":["function () ","data"],"3f584d136971":["function () ","data"],"3f586222f20":["function () ","data"],"3f5879a24195":["function () ","data"],"3f584b853fce":["function () ","data"],"3f5846537b94":["function () ","data"],"3f5868915cc":["function () ","data"],"3f58223a4e82":["function () ","data"],"3f586b207e56":["function () ","data"],"3f58612f1c27":["function () ","data"],"3f5855e4692e":["function () ","data"],"3f582c7f6eee":["function () ","data"]},"cur_data":"3f582c7f6eee","attrs":{"3f585e422262":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines+markers","line":{"color":"#E41A1C"},"marker":{"size":5,"color":"#E41A1C"},"showlegend":true,"name":"Todas Variables - AUC medio global: 0.694","inherit":true},"3f5822b55c92":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines+markers","line":{"color":"#E41A1C"},"marker":{"size":5,"color":"#E41A1C"},"showlegend":false,"name":"","inherit":true},"3f585baac5":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines+markers","line":{"color":"#E41A1C"},"marker":{"size":5,"color":"#E41A1C"},"showlegend":false,"name":"","inherit":true},"3f5870fd6da7":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines+markers","line":{"color":"#E41A1C"},"marker":{"size":5,"color":"#E41A1C"},"showlegend":false,"name":"","inherit":true},"3f58be53fe9":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines+markers","line":{"color":"#E41A1C"},"marker":{"size":5,"color":"#E41A1C"},"showlegend":false,"name":"","inherit":true},"3f58555a277f":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines+markers","line":{"color":"#377EB8"},"marker":{"size":5,"color":"#377EB8"},"showlegend":true,"name":"Asociacion - AUC medio global: 0.746","inherit":true},"3f5844d5ff5":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines+markers","line":{"color":"#377EB8"},"marker":{"size":5,"color":"#377EB8"},"showlegend":false,"name":"","inherit":true},"3f5869df7c2e":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines+markers","line":{"color":"#377EB8"},"marker":{"size":5,"color":"#377EB8"},"showlegend":false,"name":"","inherit":true},"3f582f4c3944":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines+markers","line":{"color":"#377EB8"},"marker":{"size":5,"color":"#377EB8"},"showlegend":false,"name":"","inherit":true},"3f584d136971":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines+markers","line":{"color":"#377EB8"},"marker":{"size":5,"color":"#377EB8"},"showlegend":false,"name":"","inherit":true},"3f586222f20":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines+markers","line":{"color":"#4DAF4A"},"marker":{"size":5,"color":"#4DAF4A"},"showlegend":true,"name":"StepAUC - AUC medio global: 0.719","inherit":true},"3f5879a24195":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines+markers","line":{"color":"#4DAF4A"},"marker":{"size":5,"color":"#4DAF4A"},"showlegend":false,"name":"","inherit":true},"3f584b853fce":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines+markers","line":{"color":"#4DAF4A"},"marker":{"size":5,"color":"#4DAF4A"},"showlegend":false,"name":"","inherit":true},"3f5846537b94":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines+markers","line":{"color":"#4DAF4A"},"marker":{"size":5,"color":"#4DAF4A"},"showlegend":false,"name":"","inherit":true},"3f5868915cc":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines+markers","line":{"color":"#4DAF4A"},"marker":{"size":5,"color":"#4DAF4A"},"showlegend":false,"name":"","inherit":true},"3f58223a4e82":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines+markers","line":{"color":"#984EA3"},"marker":{"size":5,"color":"#984EA3"},"showlegend":true,"name":"Lasso - AUC medio global: 0.718","inherit":true},"3f586b207e56":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines+markers","line":{"color":"#984EA3"},"marker":{"size":5,"color":"#984EA3"},"showlegend":false,"name":"","inherit":true},"3f58612f1c27":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines+markers","line":{"color":"#984EA3"},"marker":{"size":5,"color":"#984EA3"},"showlegend":false,"name":"","inherit":true},"3f5855e4692e":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines+markers","line":{"color":"#984EA3"},"marker":{"size":5,"color":"#984EA3"},"showlegend":false,"name":"","inherit":true},"3f582c7f6eee":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines+markers","line":{"color":"#984EA3"},"marker":{"size":5,"color":"#984EA3"},"showlegend":false,"name":"","inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"Comparación de AUC por Semilla y Fold para Diferentes Métodos","scene":{"xaxis":{"title":"Fold"},"yaxis":{"title":"Semilla"},"zaxis":{"title":"AUC"}},"yaxis":{"type":"category","categoryorder":"array","categoryarray":["seed_123","seed_27","seed_3","seed_50","seed_90"]},"hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":[1,2,3,4,5],"y":["seed_27","seed_27","seed_27","seed_27","seed_27"],"z":[0.73109756097560974,0.60141206675224645,0.69228395061728398,0.62012195121951219,0.79054878048780486],"type":"scatter3d","mode":"lines+markers","line":{"color":"#E41A1C"},"marker":{"color":"#E41A1C","size":5,"line":{"color":"rgba(31,119,180,1)"}},"showlegend":true,"name":"Todas Variables - AUC medio global: 0.694","error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"frame":null},{"x":[1,2,3,4,5],"y":["seed_3","seed_3","seed_3","seed_3","seed_3"],"z":[0.68271604938271602,0.64441591784338892,0.698780487804878,0.58841463414634143,0.76737804878048776],"type":"scatter3d","mode":"lines+markers","line":{"color":"#E41A1C"},"marker":{"color":"#E41A1C","size":5,"line":{"color":"rgba(255,127,14,1)"}},"showlegend":false,"name":"","error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"frame":null},{"x":[1,2,3,4,5],"y":["seed_123","seed_123","seed_123","seed_123","seed_123"],"z":[0.72514619883040932,0.673170731707317,0.76371951219512191,0.6963414634146341,0.70457317073170733],"type":"scatter3d","mode":"lines+markers","line":{"color":"#E41A1C"},"marker":{"color":"#E41A1C","size":5,"line":{"color":"rgba(44,160,44,1)"}},"showlegend":false,"name":"","error_y":{"color":"rgba(44,160,44,1)"},"error_x":{"color":"rgba(44,160,44,1)"},"frame":null},{"x":[1,2,3,4,5],"y":["seed_50","seed_50","seed_50","seed_50","seed_50"],"z":[0.65701219512195119,0.71052631578947367,0.60731707317073169,0.65701219512195119,0.7908536585365854],"type":"scatter3d","mode":"lines+markers","line":{"color":"#E41A1C"},"marker":{"color":"#E41A1C","size":5,"line":{"color":"rgba(214,39,40,1)"}},"showlegend":false,"name":"","error_y":{"color":"rgba(214,39,40,1)"},"error_x":{"color":"rgba(214,39,40,1)"},"frame":null},{"x":[1,2,3,4,5],"y":["seed_90","seed_90","seed_90","seed_90","seed_90"],"z":[0.74207317073170731,0.72317073170731705,0.69475308641975309,0.67530487804878048,0.69993581514762515],"type":"scatter3d","mode":"lines+markers","line":{"color":"#E41A1C"},"marker":{"color":"#E41A1C","size":5,"line":{"color":"rgba(148,103,189,1)"}},"showlegend":false,"name":"","error_y":{"color":"rgba(148,103,189,1)"},"error_x":{"color":"rgba(148,103,189,1)"},"frame":null},{"x":[1,2,3,4,5],"y":["seed_27","seed_27","seed_27","seed_27","seed_27"],"z":[0.72621951219512193,0.70988446726572529,0.78179012345679011,0.74542682926829262,0.76951219512195124],"type":"scatter3d","mode":"lines+markers","line":{"color":"#377EB8"},"marker":{"color":"#377EB8","size":5,"line":{"color":"rgba(140,86,75,1)"}},"showlegend":true,"name":"Asociacion - AUC medio global: 0.746","error_y":{"color":"rgba(140,86,75,1)"},"error_x":{"color":"rgba(140,86,75,1)"},"frame":null},{"x":[1,2,3,4,5],"y":["seed_3","seed_3","seed_3","seed_3","seed_3"],"z":[0.79907407407407405,0.72946084724005134,0.78018292682926826,0.67560975609756102,0.73048780487804876],"type":"scatter3d","mode":"lines+markers","line":{"color":"#377EB8"},"marker":{"color":"#377EB8","size":5,"line":{"color":"rgba(227,119,194,1)"}},"showlegend":false,"name":"","error_y":{"color":"rgba(227,119,194,1)"},"error_x":{"color":"rgba(227,119,194,1)"},"frame":null},{"x":[1,2,3,4,5],"y":["seed_123","seed_123","seed_123","seed_123","seed_123"],"z":[0.75990903183885639,0.78170731707317076,0.69786585365853659,0.71219512195121948,0.75335365853658531],"type":"scatter3d","mode":"lines+markers","line":{"color":"#377EB8"},"marker":{"color":"#377EB8","size":5,"line":{"color":"rgba(127,127,127,1)"}},"showlegend":false,"name":"","error_y":{"color":"rgba(127,127,127,1)"},"error_x":{"color":"rgba(127,127,127,1)"},"frame":null},{"x":[1,2,3,4,5],"y":["seed_50","seed_50","seed_50","seed_50","seed_50"],"z":[0.8213414634146341,0.75243664717348924,0.74695121951219512,0.69695121951219507,0.71829268292682924],"type":"scatter3d","mode":"lines+markers","line":{"color":"#377EB8"},"marker":{"color":"#377EB8","size":5,"line":{"color":"rgba(188,189,34,1)"}},"showlegend":false,"name":"","error_y":{"color":"rgba(188,189,34,1)"},"error_x":{"color":"rgba(188,189,34,1)"},"frame":null},{"x":[1,2,3,4,5],"y":["seed_90","seed_90","seed_90","seed_90","seed_90"],"z":[0.69969512195121952,0.81219512195121946,0.75679012345679009,0.73079268292682931,0.75577663671373552],"type":"scatter3d","mode":"lines+markers","line":{"color":"#377EB8"},"marker":{"color":"#377EB8","size":5,"line":{"color":"rgba(23,190,207,1)"}},"showlegend":false,"name":"","error_y":{"color":"rgba(23,190,207,1)"},"error_x":{"color":"rgba(23,190,207,1)"},"frame":null},{"x":[1,2,3,4,5],"y":["seed_27","seed_27","seed_27","seed_27","seed_27"],"z":[0.72103658536585402,0.72560975609756095,0.65895061728395099,0.62957317073170704,0.73079268292682897],"type":"scatter3d","mode":"lines+markers","line":{"color":"#4DAF4A"},"marker":{"color":"#4DAF4A","size":5,"line":{"color":"rgba(31,119,180,1)"}},"showlegend":true,"name":"StepAUC - AUC medio global: 0.719","error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"frame":null},{"x":[1,2,3,4,5],"y":["seed_3","seed_3","seed_3","seed_3","seed_3"],"z":[0.79320987654320996,0.71084724005134803,0.79207317073170702,0.68841463414634096,0.70396341463414602],"type":"scatter3d","mode":"lines+markers","line":{"color":"#4DAF4A"},"marker":{"color":"#4DAF4A","size":5,"line":{"color":"rgba(255,127,14,1)"}},"showlegend":false,"name":"","error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"frame":null},{"x":[1,2,3,4,5],"y":["seed_123","seed_123","seed_123","seed_123","seed_123"],"z":[0.67803768680961696,0.72256097560975596,0.69268292682926802,0.73506097560975603,0.76859756097561005],"type":"scatter3d","mode":"lines+markers","line":{"color":"#4DAF4A"},"marker":{"color":"#4DAF4A","size":5,"line":{"color":"rgba(44,160,44,1)"}},"showlegend":false,"name":"","error_y":{"color":"rgba(44,160,44,1)"},"error_x":{"color":"rgba(44,160,44,1)"},"frame":null},{"x":[1,2,3,4,5],"y":["seed_50","seed_50","seed_50","seed_50","seed_50"],"z":[0.66859756097560996,0.76543209876543195,0.72408536585365901,0.70152439024390201,0.73231707317073202],"type":"scatter3d","mode":"lines+markers","line":{"color":"#4DAF4A"},"marker":{"color":"#4DAF4A","size":5,"line":{"color":"rgba(214,39,40,1)"}},"showlegend":false,"name":"","error_y":{"color":"rgba(214,39,40,1)"},"error_x":{"color":"rgba(214,39,40,1)"},"frame":null},{"x":[1,2,3,4,5],"y":["seed_90","seed_90","seed_90","seed_90","seed_90"],"z":[0.70884146341463405,0.755792682926829,0.77283950617283903,0.68567073170731696,0.70025673940949895],"type":"scatter3d","mode":"lines+markers","line":{"color":"#4DAF4A"},"marker":{"color":"#4DAF4A","size":5,"line":{"color":"rgba(148,103,189,1)"}},"showlegend":false,"name":"","error_y":{"color":"rgba(148,103,189,1)"},"error_x":{"color":"rgba(148,103,189,1)"},"frame":null},{"x":[1,2,3,4,5],"y":["seed_27","seed_27","seed_27","seed_27","seed_27"],"z":[0.73124999999999996,0.77777777777777801,0.78965517241379302,0.75175438596491195,0.57746913580246895],"type":"scatter3d","mode":"lines+markers","line":{"color":"#984EA3"},"marker":{"color":"#984EA3","size":5,"line":{"color":"rgba(140,86,75,1)"}},"showlegend":true,"name":"Lasso - AUC medio global: 0.718","error_y":{"color":"rgba(140,86,75,1)"},"error_x":{"color":"rgba(140,86,75,1)"},"frame":null},{"x":[1,2,3,4,5],"y":["seed_3","seed_3","seed_3","seed_3","seed_3"],"z":[0.79411764705882304,0.61454545454545495,0.65100154083204897,0.884533898305085,0.76865671641791],"type":"scatter3d","mode":"lines+markers","line":{"color":"#984EA3"},"marker":{"color":"#984EA3","size":5,"line":{"color":"rgba(227,119,194,1)"}},"showlegend":false,"name":"","error_y":{"color":"rgba(227,119,194,1)"},"error_x":{"color":"rgba(227,119,194,1)"},"frame":null},{"x":[1,2,3,4,5],"y":["seed_123","seed_123","seed_123","seed_123","seed_123"],"z":[0.64473684210526305,0.61666666666666703,0.870056497175141,0.640625,0.83437499999999998],"type":"scatter3d","mode":"lines+markers","line":{"color":"#984EA3"},"marker":{"color":"#984EA3","size":5,"line":{"color":"rgba(127,127,127,1)"}},"showlegend":false,"name":"","error_y":{"color":"rgba(127,127,127,1)"},"error_x":{"color":"rgba(127,127,127,1)"},"frame":null},{"x":[1,2,3,4,5],"y":["seed_50","seed_50","seed_50","seed_50","seed_50"],"z":[0.80142857142857105,0.83999999999999997,0.63788487282463202,0.67708333333333304,0.50816993464052296],"type":"scatter3d","mode":"lines+markers","line":{"color":"#984EA3"},"marker":{"color":"#984EA3","size":5,"line":{"color":"rgba(188,189,34,1)"}},"showlegend":false,"name":"","error_y":{"color":"rgba(188,189,34,1)"},"error_x":{"color":"rgba(188,189,34,1)"},"frame":null},{"x":[1,2,3,4,5],"y":["seed_90","seed_90","seed_90","seed_90","seed_90"],"z":[0.75628930817610096,0.75721153846153899,0.54500000000000004,0.72619047619047605,0.74243421052631597],"type":"scatter3d","mode":"lines+markers","line":{"color":"#984EA3"},"marker":{"color":"#984EA3","size":5,"line":{"color":"rgba(23,190,207,1)"}},"showlegend":false,"name":"","error_y":{"color":"rgba(23,190,207,1)"},"error_x":{"color":"rgba(23,190,207,1)"},"frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>Respaldando los dos anteriores contrastes, y observando la gráfica del valor de AUC por fold y semilla, para cada método de selección de características, para el modelo KNN, se puede concluir que los dos métodos más destacados son el método Asociación y StepAUC, con 0.749 y 0.717 de AUC, respectivamente. Como se comentó anteriormente, el AUC elevado del método de asociación proviene de una baja dispersión de los datos, con una mediana alta, en la mayoría de sus pliegues, a lo largo de todas las semillas. Por otra parte, el método StepAUC, aunque con un AUC menor, muestra una capacidad predictiva notable y robusta.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-12-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-12-1" role="tab" aria-controls="tabset-12-1" aria-selected="true" href="">TodasVariables</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-12-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-12-2" role="tab" aria-controls="tabset-12-2" aria-selected="false" href="">Asociacion</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-12-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-12-3" role="tab" aria-controls="tabset-12-3" aria-selected="false" href="">StepAUC</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-12-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-12-4" role="tab" aria-controls="tabset-12-4" aria-selected="false" href="">Lasso</a></li></ul>
<div class="tab-content">
<div id="tabset-12-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-12-1-tab">
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a><span class="fu">generate_auc_per_seed_and_fold</span>(RPart_TodasVariables_Metrics<span class="sc">$</span>performance_metrics)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-430610bf6d4b5597c231" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-430610bf6d4b5597c231">{"x":{"visdat":{"3f586be1efe":["function () ","plotlyVisDat"]},"cur_data":"3f586be1efe","attrs":{"3f586be1efe":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1,2,3,4,5],"y":[1,1,1,1,1],"z":[0.69115853658536586,0.65436456996148906,0.53240740740740733,0.72652439024390247,0.73628048780487798],"type":"scatter3d","mode":"lines+markers","line":{"width":2,"color":"#E41A1C"},"marker":{"size":5,"color":"#E41A1C"},"name":"Semilla 27 AUC medio: 0.64","inherit":true},"3f586be1efe.1":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1,2,3,4,5],"y":[2,2,2,2,2],"z":[0.77654320987654313,0.68709884467265725,0.801219512195122,0.53262195121951228,0.7667682926829269],"type":"scatter3d","mode":"lines+markers","line":{"width":2,"color":"#377EB8"},"marker":{"size":5,"color":"#377EB8"},"name":"Semilla 3 AUC medio: 0.668","inherit":true},"3f586be1efe.2":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1,2,3,4,5],"y":[3,3,3,3,3],"z":[0.66374269005847952,0.71890243902439022,0.5,0.68048780487804883,0.63567073170731703],"type":"scatter3d","mode":"lines+markers","line":{"width":2,"color":"#4DAF4A"},"marker":{"size":5,"color":"#4DAF4A"},"name":"Semilla 123 AUC medio: 0.713","inherit":true},"3f586be1efe.3":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1,2,3,4,5],"y":[4,4,4,4,4],"z":[0.76219512195121952,0.71247563352826515,0.72225609756097564,0.67347560975609755,0.65975609756097564],"type":"scatter3d","mode":"lines+markers","line":{"width":2,"color":"#984EA3"},"marker":{"size":5,"color":"#984EA3"},"name":"Semilla 50 AUC medio: 0.706","inherit":true},"3f586be1efe.4":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1,2,3,4,5],"y":[5,5,5,5,5],"z":[0.7740853658536585,0.76798780487804874,0.7231481481481481,0.60365853658536583,0.71052631578947356],"type":"scatter3d","mode":"lines+markers","line":{"width":2,"color":"#FF7F00"},"marker":{"size":5,"color":"#FF7F00"},"name":"Semilla 90 AUC medio: 0.716","inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"scene":{"xaxis":{"title":"Fold"},"yaxis":{"title":"Semilla"},"zaxis":{"title":"AUC"},"title":"Visualización 3D de Folds, Semillas y AUC"},"hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":[1,2,3,4,5],"y":[1,1,1,1,1],"z":[0.69115853658536586,0.65436456996148906,0.53240740740740733,0.72652439024390247,0.73628048780487798],"type":"scatter3d","mode":"lines+markers","line":{"color":"#E41A1C","width":2},"marker":{"color":"#E41A1C","size":5,"line":{"color":"rgba(31,119,180,1)"}},"name":"Semilla 27 AUC medio: 0.64","error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"frame":null},{"x":[1,2,3,4,5],"y":[2,2,2,2,2],"z":[0.77654320987654313,0.68709884467265725,0.801219512195122,0.53262195121951228,0.7667682926829269],"type":"scatter3d","mode":"lines+markers","line":{"color":"#377EB8","width":2},"marker":{"color":"#377EB8","size":5,"line":{"color":"rgba(255,127,14,1)"}},"name":"Semilla 3 AUC medio: 0.668","error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"frame":null},{"x":[1,2,3,4,5],"y":[3,3,3,3,3],"z":[0.66374269005847952,0.71890243902439022,0.5,0.68048780487804883,0.63567073170731703],"type":"scatter3d","mode":"lines+markers","line":{"color":"#4DAF4A","width":2},"marker":{"color":"#4DAF4A","size":5,"line":{"color":"rgba(44,160,44,1)"}},"name":"Semilla 123 AUC medio: 0.713","error_y":{"color":"rgba(44,160,44,1)"},"error_x":{"color":"rgba(44,160,44,1)"},"frame":null},{"x":[1,2,3,4,5],"y":[4,4,4,4,4],"z":[0.76219512195121952,0.71247563352826515,0.72225609756097564,0.67347560975609755,0.65975609756097564],"type":"scatter3d","mode":"lines+markers","line":{"color":"#984EA3","width":2},"marker":{"color":"#984EA3","size":5,"line":{"color":"rgba(214,39,40,1)"}},"name":"Semilla 50 AUC medio: 0.706","error_y":{"color":"rgba(214,39,40,1)"},"error_x":{"color":"rgba(214,39,40,1)"},"frame":null},{"x":[1,2,3,4,5],"y":[5,5,5,5,5],"z":[0.7740853658536585,0.76798780487804874,0.7231481481481481,0.60365853658536583,0.71052631578947356],"type":"scatter3d","mode":"lines+markers","line":{"color":"#FF7F00","width":2},"marker":{"color":"#FF7F00","size":5,"line":{"color":"rgba(148,103,189,1)"}},"name":"Semilla 90 AUC medio: 0.716","error_y":{"color":"rgba(148,103,189,1)"},"error_x":{"color":"rgba(148,103,189,1)"},"frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</div>
<div id="tabset-12-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-12-2-tab">
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a><span class="fu">generate_auc_per_seed_and_fold</span>(RPart_Asociacion_Metrics<span class="sc">$</span>performance_metrics)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-eb6bdc8ec3ec9b016562" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-eb6bdc8ec3ec9b016562">{"x":{"visdat":{"3f583aab72a6":["function () ","plotlyVisDat"]},"cur_data":"3f583aab72a6","attrs":{"3f583aab72a6":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1,2,3,4,5],"y":[1,1,1,1,1],"z":[0.66219512195121943,0.70827984595635429,0.5,0.71250000000000002,0.5],"type":"scatter3d","mode":"lines+markers","line":{"width":2,"color":"#E41A1C"},"marker":{"size":5,"color":"#E41A1C"},"name":"Semilla 27 AUC medio: 0.688","inherit":true},"3f583aab72a6.1":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1,2,3,4,5],"y":[2,2,2,2,2],"z":[0.78518518518518521,0.69833119383825415,0.74176829268292688,0.61524390243902438,0.68445121951219512],"type":"scatter3d","mode":"lines+markers","line":{"width":2,"color":"#377EB8"},"marker":{"size":5,"color":"#377EB8"},"name":"Semilla 3 AUC medio: 0.617","inherit":true},"3f583aab72a6.2":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1,2,3,4,5],"y":[3,3,3,3,3],"z":[0.6871345029239766,0.77987804878048772,0.66707317073170735,0.61402439024390243,0.69207317073170727],"type":"scatter3d","mode":"lines+markers","line":{"width":2,"color":"#4DAF4A"},"marker":{"size":5,"color":"#4DAF4A"},"name":"Semilla 123 AUC medio: 0.705","inherit":true},"3f583aab72a6.3":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1,2,3,4,5],"y":[4,4,4,4,4],"z":[0.761280487804878,0.7586094866796621,0.73353658536585364,0.68414634146341458,0.5753048780487805],"type":"scatter3d","mode":"lines+markers","line":{"width":2,"color":"#984EA3"},"marker":{"size":5,"color":"#984EA3"},"name":"Semilla 50 AUC medio: 0.703","inherit":true},"3f583aab72a6.4":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1,2,3,4,5],"y":[5,5,5,5,5],"z":[0.72957317073170735,0.5,0.65987654320987654,0.67408536585365852,0.5],"type":"scatter3d","mode":"lines+markers","line":{"width":2,"color":"#FF7F00"},"marker":{"size":5,"color":"#FF7F00"},"name":"Semilla 90 AUC medio: 0.613","inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"scene":{"xaxis":{"title":"Fold"},"yaxis":{"title":"Semilla"},"zaxis":{"title":"AUC"},"title":"Visualización 3D de Folds, Semillas y AUC"},"hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":[1,2,3,4,5],"y":[1,1,1,1,1],"z":[0.66219512195121943,0.70827984595635429,0.5,0.71250000000000002,0.5],"type":"scatter3d","mode":"lines+markers","line":{"color":"#E41A1C","width":2},"marker":{"color":"#E41A1C","size":5,"line":{"color":"rgba(31,119,180,1)"}},"name":"Semilla 27 AUC medio: 0.688","error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"frame":null},{"x":[1,2,3,4,5],"y":[2,2,2,2,2],"z":[0.78518518518518521,0.69833119383825415,0.74176829268292688,0.61524390243902438,0.68445121951219512],"type":"scatter3d","mode":"lines+markers","line":{"color":"#377EB8","width":2},"marker":{"color":"#377EB8","size":5,"line":{"color":"rgba(255,127,14,1)"}},"name":"Semilla 3 AUC medio: 0.617","error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"frame":null},{"x":[1,2,3,4,5],"y":[3,3,3,3,3],"z":[0.6871345029239766,0.77987804878048772,0.66707317073170735,0.61402439024390243,0.69207317073170727],"type":"scatter3d","mode":"lines+markers","line":{"color":"#4DAF4A","width":2},"marker":{"color":"#4DAF4A","size":5,"line":{"color":"rgba(44,160,44,1)"}},"name":"Semilla 123 AUC medio: 0.705","error_y":{"color":"rgba(44,160,44,1)"},"error_x":{"color":"rgba(44,160,44,1)"},"frame":null},{"x":[1,2,3,4,5],"y":[4,4,4,4,4],"z":[0.761280487804878,0.7586094866796621,0.73353658536585364,0.68414634146341458,0.5753048780487805],"type":"scatter3d","mode":"lines+markers","line":{"color":"#984EA3","width":2},"marker":{"color":"#984EA3","size":5,"line":{"color":"rgba(214,39,40,1)"}},"name":"Semilla 50 AUC medio: 0.703","error_y":{"color":"rgba(214,39,40,1)"},"error_x":{"color":"rgba(214,39,40,1)"},"frame":null},{"x":[1,2,3,4,5],"y":[5,5,5,5,5],"z":[0.72957317073170735,0.5,0.65987654320987654,0.67408536585365852,0.5],"type":"scatter3d","mode":"lines+markers","line":{"color":"#FF7F00","width":2},"marker":{"color":"#FF7F00","size":5,"line":{"color":"rgba(148,103,189,1)"}},"name":"Semilla 90 AUC medio: 0.613","error_y":{"color":"rgba(148,103,189,1)"},"error_x":{"color":"rgba(148,103,189,1)"},"frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</div>
<div id="tabset-12-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-12-3-tab">
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb130"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a><span class="fu">generate_auc_per_seed_and_fold</span>(RPart_StepAUC_Metrics<span class="sc">$</span>performance_metrics)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-d7080151208ad7fdc0b7" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-d7080151208ad7fdc0b7">{"x":{"visdat":{"3f583d45dfe":["function () ","plotlyVisDat"]},"cur_data":"3f583d45dfe","attrs":{"3f583d45dfe":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1,2,3,4,5],"y":[1,1,1,1,1],"z":[0.5,0.65917843388960196,0.64259259259259205,0.65182926829268295,0.67926829268292699],"type":"scatter3d","mode":"lines+markers","line":{"width":2,"color":"#E41A1C"},"marker":{"size":5,"color":"#E41A1C"},"name":"Semilla 27 AUC medio: 0.649","inherit":true},"3f583d45dfe.1":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1,2,3,4,5],"y":[2,2,2,2,2],"z":[0.75987654320987696,0.69929396662387699,0.67500000000000004,0.59451219512195097,0.741463414634146],"type":"scatter3d","mode":"lines+markers","line":{"width":2,"color":"#377EB8"},"marker":{"size":5,"color":"#377EB8"},"name":"Semilla 3 AUC medio: 0.627","inherit":true},"3f583d45dfe.2":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1,2,3,4,5],"y":[3,3,3,3,3],"z":[0.70532813515269699,0.72560975609756095,0.5,0.64237804878048799,0.67134146341463397],"type":"scatter3d","mode":"lines+markers","line":{"width":2,"color":"#4DAF4A"},"marker":{"size":5,"color":"#4DAF4A"},"name":"Semilla 123 AUC medio: 0.694","inherit":true},"3f583d45dfe.3":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1,2,3,4,5],"y":[4,4,4,4,4],"z":[0.5,0.71442495126705696,0.70914634146341504,0.70945121951219503,0.56768292682926802],"type":"scatter3d","mode":"lines+markers","line":{"width":2,"color":"#984EA3"},"marker":{"size":5,"color":"#984EA3"},"name":"Semilla 50 AUC medio: 0.64","inherit":true},"3f583d45dfe.4":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1,2,3,4,5],"y":[5,5,5,5,5],"z":[0.58353658536585395,0.72073170731707303,0.71111111111111103,0.60670731707317105,0.678754813863928],"type":"scatter3d","mode":"lines+markers","line":{"width":2,"color":"#FF7F00"},"marker":{"size":5,"color":"#FF7F00"},"name":"Semilla 90 AUC medio: 0.66","inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"scene":{"xaxis":{"title":"Fold"},"yaxis":{"title":"Semilla"},"zaxis":{"title":"AUC"},"title":"Visualización 3D de Folds, Semillas y AUC"},"hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":[1,2,3,4,5],"y":[1,1,1,1,1],"z":[0.5,0.65917843388960196,0.64259259259259205,0.65182926829268295,0.67926829268292699],"type":"scatter3d","mode":"lines+markers","line":{"color":"#E41A1C","width":2},"marker":{"color":"#E41A1C","size":5,"line":{"color":"rgba(31,119,180,1)"}},"name":"Semilla 27 AUC medio: 0.649","error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"frame":null},{"x":[1,2,3,4,5],"y":[2,2,2,2,2],"z":[0.75987654320987696,0.69929396662387699,0.67500000000000004,0.59451219512195097,0.741463414634146],"type":"scatter3d","mode":"lines+markers","line":{"color":"#377EB8","width":2},"marker":{"color":"#377EB8","size":5,"line":{"color":"rgba(255,127,14,1)"}},"name":"Semilla 3 AUC medio: 0.627","error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"frame":null},{"x":[1,2,3,4,5],"y":[3,3,3,3,3],"z":[0.70532813515269699,0.72560975609756095,0.5,0.64237804878048799,0.67134146341463397],"type":"scatter3d","mode":"lines+markers","line":{"color":"#4DAF4A","width":2},"marker":{"color":"#4DAF4A","size":5,"line":{"color":"rgba(44,160,44,1)"}},"name":"Semilla 123 AUC medio: 0.694","error_y":{"color":"rgba(44,160,44,1)"},"error_x":{"color":"rgba(44,160,44,1)"},"frame":null},{"x":[1,2,3,4,5],"y":[4,4,4,4,4],"z":[0.5,0.71442495126705696,0.70914634146341504,0.70945121951219503,0.56768292682926802],"type":"scatter3d","mode":"lines+markers","line":{"color":"#984EA3","width":2},"marker":{"color":"#984EA3","size":5,"line":{"color":"rgba(214,39,40,1)"}},"name":"Semilla 50 AUC medio: 0.64","error_y":{"color":"rgba(214,39,40,1)"},"error_x":{"color":"rgba(214,39,40,1)"},"frame":null},{"x":[1,2,3,4,5],"y":[5,5,5,5,5],"z":[0.58353658536585395,0.72073170731707303,0.71111111111111103,0.60670731707317105,0.678754813863928],"type":"scatter3d","mode":"lines+markers","line":{"color":"#FF7F00","width":2},"marker":{"color":"#FF7F00","size":5,"line":{"color":"rgba(148,103,189,1)"}},"name":"Semilla 90 AUC medio: 0.66","error_y":{"color":"rgba(148,103,189,1)"},"error_x":{"color":"rgba(148,103,189,1)"},"frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</div>
<div id="tabset-12-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-12-4-tab">
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a><span class="fu">generate_auc_per_seed_and_fold</span>(RPart_Lasso_Metrics<span class="sc">$</span>performance_metrics)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-6e335e97ff21d23a70b6" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-6e335e97ff21d23a70b6">{"x":{"visdat":{"3f586ade45cb":["function () ","plotlyVisDat"]},"cur_data":"3f586ade45cb","attrs":{"3f586ade45cb":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1,2,3,4,5],"y":[1,1,1,1,1],"z":[0.69821428571428601,0.67195767195767198,0.73419117647058796,0.70638414969730301,0.5],"type":"scatter3d","mode":"lines+markers","line":{"width":2,"color":"#E41A1C"},"marker":{"size":5,"color":"#E41A1C"},"name":"Semilla 27 AUC medio: 0.644","inherit":true},"3f586ade45cb.1":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1,2,3,4,5],"y":[2,2,2,2,2],"z":[0.76007751937984502,0.5,0.5,0.77095588235294099,0.70928865373309802],"type":"scatter3d","mode":"lines+markers","line":{"width":2,"color":"#377EB8"},"marker":{"size":5,"color":"#377EB8"},"name":"Semilla 3 AUC medio: 0.662","inherit":true},"3f586ade45cb.2":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1,2,3,4,5],"y":[3,3,3,3,3],"z":[0.68482142857142803,0.5,0.57994814174589404,0.75224646983311905,0.70358998582900301],"type":"scatter3d","mode":"lines+markers","line":{"width":2,"color":"#4DAF4A"},"marker":{"size":5,"color":"#4DAF4A"},"name":"Semilla 123 AUC medio: 0.648","inherit":true},"3f586ade45cb.3":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1,2,3,4,5],"y":[4,4,4,4,4],"z":[0.5,0.71544117647058803,0.75264550264550301,0.5,0.66219512195121999],"type":"scatter3d","mode":"lines+markers","line":{"width":2,"color":"#984EA3"},"marker":{"size":5,"color":"#984EA3"},"name":"Semilla 50 AUC medio: 0.626","inherit":true},"3f586ade45cb.4":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1,2,3,4,5],"y":[5,5,5,5,5],"z":[0.73601190476190503,0.5,0.68294573643410905,0.60615079365079405,0.75823170731707301],"type":"scatter3d","mode":"lines+markers","line":{"width":2,"color":"#FF7F00"},"marker":{"size":5,"color":"#FF7F00"},"name":"Semilla 90 AUC medio: 0.657","inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"scene":{"xaxis":{"title":"Fold"},"yaxis":{"title":"Semilla"},"zaxis":{"title":"AUC"},"title":"Visualización 3D de Folds, Semillas y AUC"},"hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":[1,2,3,4,5],"y":[1,1,1,1,1],"z":[0.69821428571428601,0.67195767195767198,0.73419117647058796,0.70638414969730301,0.5],"type":"scatter3d","mode":"lines+markers","line":{"color":"#E41A1C","width":2},"marker":{"color":"#E41A1C","size":5,"line":{"color":"rgba(31,119,180,1)"}},"name":"Semilla 27 AUC medio: 0.644","error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"frame":null},{"x":[1,2,3,4,5],"y":[2,2,2,2,2],"z":[0.76007751937984502,0.5,0.5,0.77095588235294099,0.70928865373309802],"type":"scatter3d","mode":"lines+markers","line":{"color":"#377EB8","width":2},"marker":{"color":"#377EB8","size":5,"line":{"color":"rgba(255,127,14,1)"}},"name":"Semilla 3 AUC medio: 0.662","error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"frame":null},{"x":[1,2,3,4,5],"y":[3,3,3,3,3],"z":[0.68482142857142803,0.5,0.57994814174589404,0.75224646983311905,0.70358998582900301],"type":"scatter3d","mode":"lines+markers","line":{"color":"#4DAF4A","width":2},"marker":{"color":"#4DAF4A","size":5,"line":{"color":"rgba(44,160,44,1)"}},"name":"Semilla 123 AUC medio: 0.648","error_y":{"color":"rgba(44,160,44,1)"},"error_x":{"color":"rgba(44,160,44,1)"},"frame":null},{"x":[1,2,3,4,5],"y":[4,4,4,4,4],"z":[0.5,0.71544117647058803,0.75264550264550301,0.5,0.66219512195121999],"type":"scatter3d","mode":"lines+markers","line":{"color":"#984EA3","width":2},"marker":{"color":"#984EA3","size":5,"line":{"color":"rgba(214,39,40,1)"}},"name":"Semilla 50 AUC medio: 0.626","error_y":{"color":"rgba(214,39,40,1)"},"error_x":{"color":"rgba(214,39,40,1)"},"frame":null},{"x":[1,2,3,4,5],"y":[5,5,5,5,5],"z":[0.73601190476190503,0.5,0.68294573643410905,0.60615079365079405,0.75823170731707301],"type":"scatter3d","mode":"lines+markers","line":{"color":"#FF7F00","width":2},"marker":{"color":"#FF7F00","size":5,"line":{"color":"rgba(148,103,189,1)"}},"name":"Semilla 90 AUC medio: 0.657","error_y":{"color":"rgba(148,103,189,1)"},"error_x":{"color":"rgba(148,103,189,1)"},"frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="decision-tree-1" class="level3" data-number="4.2.4">
<h3 data-number="4.2.4" class="anchored" data-anchor-id="decision-tree-1"><span class="header-section-number">4.2.4</span> Decision Tree</h3>
<section id="auc-fold-interno-vs-externo-3" class="level4" data-number="4.2.4.1">
<h4 data-number="4.2.4.1" class="anchored" data-anchor-id="auc-fold-interno-vs-externo-3"><span class="header-section-number">4.2.4.1</span> AUC Fold Interno vs Externo</h4>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-13-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-13-1" role="tab" aria-controls="tabset-13-1" aria-selected="true" href="">TodasVariables</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-13-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-13-2" role="tab" aria-controls="tabset-13-2" aria-selected="false" href="">Asociacion</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-13-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-13-3" role="tab" aria-controls="tabset-13-3" aria-selected="false" href="">StepAUC</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-13-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-13-4" role="tab" aria-controls="tabset-13-4" aria-selected="false" href="">Lasso</a></li></ul>
<div class="tab-content">
<div id="tabset-13-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-13-1-tab">
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb132"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a><span class="fu">generate_inner_outer_auc_comparison</span>(RPart_TodasVariables_Metrics<span class="sc">$</span>inner_fold_metrics,</span>
<span id="cb132-2"><a href="#cb132-2" aria-hidden="true" tabindex="-1"></a>                                    RPart_TodasVariables_Metrics<span class="sc">$</span>performance_metrics)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-75022e7cd4f673e4da79" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-75022e7cd4f673e4da79">{"x":{"visdat":{"3f581f5f9a4":["function () ","plotlyVisDat"]},"cur_data":"3f581f5f9a4","attrs":{"3f581f5f9a4":{"x":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"y":{},"type":"bar","name":"AUC Medio Inner Folds","marker":{"color":"blue"},"inherit":true},"3f581f5f9a4.1":{"x":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"y":{},"type":"bar","name":"AUC Medio Outer Folds","marker":{"color":"red"},"inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"Comparación de AUC Medio: Inner Folds vs Outer Folds","xaxis":{"domain":[0,1],"automargin":true,"title":"Fold"},"yaxis":{"domain":[0,1],"automargin":true,"title":"AUC Medio","range":[0,1]},"barmode":"group","hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":[1,2,3,4,5],"y":[0.7571142180024325,0.77160025965231338,0.78093283474717712,0.77704944160844391,0.7278257116219109],"type":"bar","name":"AUC Medio Inner Folds","marker":{"color":"blue","line":{"color":"rgba(31,119,180,1)"}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[1,2,3,4,5],"y":[0.73354498486505326,0.70816585841297008,0.65580623306233066,0.64335365853658544,0.70180038510911424],"type":"bar","name":"AUC Medio Outer Folds","marker":{"color":"red","line":{"color":"rgba(255,127,14,1)"}},"error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</div>
<div id="tabset-13-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-13-2-tab">
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a><span class="fu">generate_inner_outer_auc_comparison</span>(RPart_Asociacion_Metrics<span class="sc">$</span>inner_fold_metrics,</span>
<span id="cb133-2"><a href="#cb133-2" aria-hidden="true" tabindex="-1"></a>                                    RPart_Asociacion_Metrics<span class="sc">$</span>performance_metrics)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-4ab27b8e328b8627a818" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-4ab27b8e328b8627a818">{"x":{"visdat":{"3f5899d5953":["function () ","plotlyVisDat"]},"cur_data":"3f5899d5953","attrs":{"3f5899d5953":{"x":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"y":{},"type":"bar","name":"AUC Medio Inner Folds","marker":{"color":"blue"},"inherit":true},"3f5899d5953.1":{"x":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"y":{},"type":"bar","name":"AUC Medio Outer Folds","marker":{"color":"red"},"inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"Comparación de AUC Medio: Inner Folds vs Outer Folds","xaxis":{"domain":[0,1],"automargin":true,"title":"Fold"},"yaxis":{"domain":[0,1],"automargin":true,"title":"AUC Medio","range":[0,1]},"barmode":"group","hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":[1,2,3,4,5],"y":[0.75978615013409456,0.74848185407290602,0.73946165188557267,0.77840287209797532,0.73440539308501862],"type":"bar","name":"AUC Medio Inner Folds","marker":{"color":"blue","line":{"color":"rgba(31,119,180,1)"}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[1,2,3,4,5],"y":[0.72507369371939334,0.68901971505095161,0.66045091839807291,0.66000000000000003,0.59036585365853655],"type":"bar","name":"AUC Medio Outer Folds","marker":{"color":"red","line":{"color":"rgba(255,127,14,1)"}},"error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</div>
<div id="tabset-13-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-13-3-tab">
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a><span class="fu">generate_inner_outer_auc_comparison</span>(RPart_StepAUC_Metrics<span class="sc">$</span>inner_fold_metrics, </span>
<span id="cb134-2"><a href="#cb134-2" aria-hidden="true" tabindex="-1"></a>                                    RPart_StepAUC_Metrics<span class="sc">$</span>performance_metrics)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-b9f400cb1c4ce6e50e4e" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-b9f400cb1c4ce6e50e4e">{"x":{"visdat":{"3f5849d3397e":["function () ","plotlyVisDat"]},"cur_data":"3f5849d3397e","attrs":{"3f5849d3397e":{"x":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"y":{},"type":"bar","name":"AUC Medio Inner Folds","marker":{"color":"blue"},"inherit":true},"3f5849d3397e.1":{"x":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"y":{},"type":"bar","name":"AUC Medio Outer Folds","marker":{"color":"red"},"inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"Comparación de AUC Medio: Inner Folds vs Outer Folds","xaxis":{"domain":[0,1],"automargin":true,"title":"Fold"},"yaxis":{"domain":[0,1],"automargin":true,"title":"AUC Medio","range":[0,1]},"barmode":"group","hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":[1,2,3,4,5],"y":[0.76099531508381391,0.76996979875267135,0.78956692281794216,0.7797963019448505,0.80801461899116389],"type":"bar","name":"AUC Medio Inner Folds","marker":{"color":"blue","line":{"color":"rgba(31,119,180,1)"}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[1,2,3,4,5],"y":[0.60974825274568556,0.70384776303903396,0.64757000903342365,0.64097560975609758,0.66770218228498057],"type":"bar","name":"AUC Medio Outer Folds","marker":{"color":"red","line":{"color":"rgba(255,127,14,1)"}},"error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</div>
<div id="tabset-13-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-13-4-tab">
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a><span class="fu">generate_inner_outer_auc_comparison</span>(RPart_Lasso_Metrics<span class="sc">$</span>inner_fold_metrics, </span>
<span id="cb135-2"><a href="#cb135-2" aria-hidden="true" tabindex="-1"></a>                                    RPart_Lasso_Metrics<span class="sc">$</span>performance_metrics)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-b85390acbb8e7f204224" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-b85390acbb8e7f204224">{"x":{"visdat":{"3f58544f5b87":["function () ","plotlyVisDat"]},"cur_data":"3f58544f5b87","attrs":{"3f58544f5b87":{"x":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"y":{},"type":"bar","name":"AUC Medio Inner Folds","marker":{"color":"blue"},"inherit":true},"3f58544f5b87.1":{"x":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"y":{},"type":"bar","name":"AUC Medio Outer Folds","marker":{"color":"red"},"inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"Comparación de AUC Medio: Inner Folds vs Outer Folds","xaxis":{"domain":[0,1],"automargin":true,"title":"Fold"},"yaxis":{"domain":[0,1],"automargin":true,"title":"AUC Medio","range":[0,1]},"barmode":"group","hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":[1,2,3,4,5],"y":[0.71736225896433203,0.62559665858356461,0.73670920823947206,0.76380041157030232,0.77034612861310503],"type":"bar","name":"AUC Medio Inner Folds","marker":{"color":"blue","line":{"color":"rgba(31,119,180,1)"}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[1,2,3,4,5],"y":[0.6758250276854928,0.57747976968565196,0.64994611145921877,0.66714745910683138,0.66666109376607885],"type":"bar","name":"AUC Medio Outer Folds","marker":{"color":"red","line":{"color":"rgba(255,127,14,1)"}},"error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</div>
</div>
</div>
<p>De la comparativa del AUC interno y externo para el método de los árboles de decisión se puede concluir que el rendimiento del modelo es subóptimo en varios sentidos. Por una parte, el AUC máximo de cada método parece no ser muy elevado, no llegando al <span class="math inline">80%</span> en ninguna de las ocasiones, adicionalmente, parece que rara vez el AUC de la predicción sobre el fold externo está parejo con el AUC de la validación del fold interno, mostrando así que la capacidad de generalización de este modelo es algo pobre.</p>
</section>
<section id="auc-medio-folds-externos-3" class="level4" data-number="4.2.4.2">
<h4 data-number="4.2.4.2" class="anchored" data-anchor-id="auc-medio-folds-externos-3"><span class="header-section-number">4.2.4.2</span> AUC Medio Folds Externos</h4>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-14-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-14-1" role="tab" aria-controls="tabset-14-1" aria-selected="true" href="">TodasVariables</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-14-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-14-2" role="tab" aria-controls="tabset-14-2" aria-selected="false" href="">Asociacion</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-14-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-14-3" role="tab" aria-controls="tabset-14-3" aria-selected="false" href="">StepAUC</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-14-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-14-4" role="tab" aria-controls="tabset-14-4" aria-selected="false" href="">Lasso</a></li></ul>
<div class="tab-content">
<div id="tabset-14-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-14-1-tab">
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb136"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a><span class="fu">generate_outer_auc_violin_plot</span>(RPart_TodasVariables_Metrics<span class="sc">$</span>performance_metrics)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-81506a261c7e33fcc3d8" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-81506a261c7e33fcc3d8">{"x":{"visdat":{"3f586c6b7cb0":["function () ","plotlyVisDat"]},"cur_data":"3f586c6b7cb0","attrs":{"3f586c6b7cb0":{"y":{},"x":{},"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","color":{},"colors":["#E41A1C","#377EB8","#4DAF4A","#984EA3","#FF7F00"],"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"violin"}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"Distribución del AUC por Outer Fold","xaxis":{"domain":[0,1],"automargin":true,"title":"Fold","type":"category","categoryorder":"array","categoryarray":["1","2","3","4","5"]},"yaxis":{"domain":[0,1],"automargin":true,"title":"AUC"},"hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"fillcolor":"rgba(228,26,28,0.5)","y":[0.69115853658536586,0.77654320987654313,0.66374269005847952,0.76219512195121952,0.7740853658536585],"x":["1","1","1","1","1"],"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","type":"violin","name":"1","marker":{"color":"rgba(228,26,28,1)","line":{"color":"rgba(228,26,28,1)"}},"line":{"color":"rgba(228,26,28,1)"},"xaxis":"x","yaxis":"y","frame":null},{"fillcolor":"rgba(55,126,184,0.5)","y":[0.65436456996148906,0.68709884467265725,0.71890243902439022,0.71247563352826515,0.76798780487804874],"x":["2","2","2","2","2"],"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","type":"violin","name":"2","marker":{"color":"rgba(55,126,184,1)","line":{"color":"rgba(55,126,184,1)"}},"line":{"color":"rgba(55,126,184,1)"},"xaxis":"x","yaxis":"y","frame":null},{"fillcolor":"rgba(77,175,74,0.5)","y":[0.53240740740740733,0.801219512195122,0.5,0.72225609756097564,0.7231481481481481],"x":["3","3","3","3","3"],"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","type":"violin","name":"3","marker":{"color":"rgba(77,175,74,1)","line":{"color":"rgba(77,175,74,1)"}},"line":{"color":"rgba(77,175,74,1)"},"xaxis":"x","yaxis":"y","frame":null},{"fillcolor":"rgba(152,78,163,0.5)","y":[0.72652439024390247,0.53262195121951228,0.68048780487804883,0.67347560975609755,0.60365853658536583],"x":["4","4","4","4","4"],"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","type":"violin","name":"4","marker":{"color":"rgba(152,78,163,1)","line":{"color":"rgba(152,78,163,1)"}},"line":{"color":"rgba(152,78,163,1)"},"xaxis":"x","yaxis":"y","frame":null},{"fillcolor":"rgba(255,127,0,0.5)","y":[0.73628048780487798,0.7667682926829269,0.63567073170731703,0.65975609756097564,0.71052631578947356],"x":["5","5","5","5","5"],"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","type":"violin","name":"5","marker":{"color":"rgba(255,127,0,1)","line":{"color":"rgba(255,127,0,1)"}},"line":{"color":"rgba(255,127,0,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</div>
<div id="tabset-14-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-14-2-tab">
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb137"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a><span class="fu">generate_outer_auc_violin_plot</span>(RPart_Asociacion_Metrics<span class="sc">$</span>performance_metrics)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-79159a2bcaac59ecef85" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-79159a2bcaac59ecef85">{"x":{"visdat":{"3f584bbf4083":["function () ","plotlyVisDat"]},"cur_data":"3f584bbf4083","attrs":{"3f584bbf4083":{"y":{},"x":{},"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","color":{},"colors":["#E41A1C","#377EB8","#4DAF4A","#984EA3","#FF7F00"],"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"violin"}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"Distribución del AUC por Outer Fold","xaxis":{"domain":[0,1],"automargin":true,"title":"Fold","type":"category","categoryorder":"array","categoryarray":["1","2","3","4","5"]},"yaxis":{"domain":[0,1],"automargin":true,"title":"AUC"},"hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"fillcolor":"rgba(228,26,28,0.5)","y":[0.66219512195121943,0.78518518518518521,0.6871345029239766,0.761280487804878,0.72957317073170735],"x":["1","1","1","1","1"],"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","type":"violin","name":"1","marker":{"color":"rgba(228,26,28,1)","line":{"color":"rgba(228,26,28,1)"}},"line":{"color":"rgba(228,26,28,1)"},"xaxis":"x","yaxis":"y","frame":null},{"fillcolor":"rgba(55,126,184,0.5)","y":[0.70827984595635429,0.69833119383825415,0.77987804878048772,0.7586094866796621,0.5],"x":["2","2","2","2","2"],"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","type":"violin","name":"2","marker":{"color":"rgba(55,126,184,1)","line":{"color":"rgba(55,126,184,1)"}},"line":{"color":"rgba(55,126,184,1)"},"xaxis":"x","yaxis":"y","frame":null},{"fillcolor":"rgba(77,175,74,0.5)","y":[0.5,0.74176829268292688,0.66707317073170735,0.73353658536585364,0.65987654320987654],"x":["3","3","3","3","3"],"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","type":"violin","name":"3","marker":{"color":"rgba(77,175,74,1)","line":{"color":"rgba(77,175,74,1)"}},"line":{"color":"rgba(77,175,74,1)"},"xaxis":"x","yaxis":"y","frame":null},{"fillcolor":"rgba(152,78,163,0.5)","y":[0.71250000000000002,0.61524390243902438,0.61402439024390243,0.68414634146341458,0.67408536585365852],"x":["4","4","4","4","4"],"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","type":"violin","name":"4","marker":{"color":"rgba(152,78,163,1)","line":{"color":"rgba(152,78,163,1)"}},"line":{"color":"rgba(152,78,163,1)"},"xaxis":"x","yaxis":"y","frame":null},{"fillcolor":"rgba(255,127,0,0.5)","y":[0.5,0.68445121951219512,0.69207317073170727,0.5753048780487805,0.5],"x":["5","5","5","5","5"],"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","type":"violin","name":"5","marker":{"color":"rgba(255,127,0,1)","line":{"color":"rgba(255,127,0,1)"}},"line":{"color":"rgba(255,127,0,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</div>
<div id="tabset-14-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-14-3-tab">
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb138"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a><span class="fu">generate_outer_auc_violin_plot</span>(RPart_StepAUC_Metrics<span class="sc">$</span>performance_metrics)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-ba9c21013fd66e258ed9" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-ba9c21013fd66e258ed9">{"x":{"visdat":{"3f584995a71":["function () ","plotlyVisDat"]},"cur_data":"3f584995a71","attrs":{"3f584995a71":{"y":{},"x":{},"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","color":{},"colors":["#E41A1C","#377EB8","#4DAF4A","#984EA3","#FF7F00"],"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"violin"}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"Distribución del AUC por Outer Fold","xaxis":{"domain":[0,1],"automargin":true,"title":"Fold","type":"category","categoryorder":"array","categoryarray":["1","2","3","4","5"]},"yaxis":{"domain":[0,1],"automargin":true,"title":"AUC"},"hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"fillcolor":"rgba(228,26,28,0.5)","y":[0.5,0.75987654320987696,0.70532813515269699,0.5,0.58353658536585395],"x":["1","1","1","1","1"],"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","type":"violin","name":"1","marker":{"color":"rgba(228,26,28,1)","line":{"color":"rgba(228,26,28,1)"}},"line":{"color":"rgba(228,26,28,1)"},"xaxis":"x","yaxis":"y","frame":null},{"fillcolor":"rgba(55,126,184,0.5)","y":[0.65917843388960196,0.69929396662387699,0.72560975609756095,0.71442495126705696,0.72073170731707303],"x":["2","2","2","2","2"],"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","type":"violin","name":"2","marker":{"color":"rgba(55,126,184,1)","line":{"color":"rgba(55,126,184,1)"}},"line":{"color":"rgba(55,126,184,1)"},"xaxis":"x","yaxis":"y","frame":null},{"fillcolor":"rgba(77,175,74,0.5)","y":[0.64259259259259205,0.67500000000000004,0.5,0.70914634146341504,0.71111111111111103],"x":["3","3","3","3","3"],"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","type":"violin","name":"3","marker":{"color":"rgba(77,175,74,1)","line":{"color":"rgba(77,175,74,1)"}},"line":{"color":"rgba(77,175,74,1)"},"xaxis":"x","yaxis":"y","frame":null},{"fillcolor":"rgba(152,78,163,0.5)","y":[0.65182926829268295,0.59451219512195097,0.64237804878048799,0.70945121951219503,0.60670731707317105],"x":["4","4","4","4","4"],"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","type":"violin","name":"4","marker":{"color":"rgba(152,78,163,1)","line":{"color":"rgba(152,78,163,1)"}},"line":{"color":"rgba(152,78,163,1)"},"xaxis":"x","yaxis":"y","frame":null},{"fillcolor":"rgba(255,127,0,0.5)","y":[0.67926829268292699,0.741463414634146,0.67134146341463397,0.56768292682926802,0.678754813863928],"x":["5","5","5","5","5"],"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","type":"violin","name":"5","marker":{"color":"rgba(255,127,0,1)","line":{"color":"rgba(255,127,0,1)"}},"line":{"color":"rgba(255,127,0,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</div>
<div id="tabset-14-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-14-4-tab">
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb139"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a><span class="fu">generate_outer_auc_violin_plot</span>(RPart_Lasso_Metrics<span class="sc">$</span>performance_metrics)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-cf741b4721a17cd9dca6" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-cf741b4721a17cd9dca6">{"x":{"visdat":{"3f58169d1ab9":["function () ","plotlyVisDat"]},"cur_data":"3f58169d1ab9","attrs":{"3f58169d1ab9":{"y":{},"x":{},"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","color":{},"colors":["#E41A1C","#377EB8","#4DAF4A","#984EA3","#FF7F00"],"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"violin"}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"Distribución del AUC por Outer Fold","xaxis":{"domain":[0,1],"automargin":true,"title":"Fold","type":"category","categoryorder":"array","categoryarray":["1","2","3","4","5"]},"yaxis":{"domain":[0,1],"automargin":true,"title":"AUC"},"hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"fillcolor":"rgba(228,26,28,0.5)","y":[0.69821428571428601,0.76007751937984502,0.68482142857142803,0.5,0.73601190476190503],"x":["1","1","1","1","1"],"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","type":"violin","name":"1","marker":{"color":"rgba(228,26,28,1)","line":{"color":"rgba(228,26,28,1)"}},"line":{"color":"rgba(228,26,28,1)"},"xaxis":"x","yaxis":"y","frame":null},{"fillcolor":"rgba(55,126,184,0.5)","y":[0.67195767195767198,0.5,0.5,0.71544117647058803,0.5],"x":["2","2","2","2","2"],"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","type":"violin","name":"2","marker":{"color":"rgba(55,126,184,1)","line":{"color":"rgba(55,126,184,1)"}},"line":{"color":"rgba(55,126,184,1)"},"xaxis":"x","yaxis":"y","frame":null},{"fillcolor":"rgba(77,175,74,0.5)","y":[0.73419117647058796,0.5,0.57994814174589404,0.75264550264550301,0.68294573643410905],"x":["3","3","3","3","3"],"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","type":"violin","name":"3","marker":{"color":"rgba(77,175,74,1)","line":{"color":"rgba(77,175,74,1)"}},"line":{"color":"rgba(77,175,74,1)"},"xaxis":"x","yaxis":"y","frame":null},{"fillcolor":"rgba(152,78,163,0.5)","y":[0.70638414969730301,0.77095588235294099,0.75224646983311905,0.5,0.60615079365079405],"x":["4","4","4","4","4"],"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","type":"violin","name":"4","marker":{"color":"rgba(152,78,163,1)","line":{"color":"rgba(152,78,163,1)"}},"line":{"color":"rgba(152,78,163,1)"},"xaxis":"x","yaxis":"y","frame":null},{"fillcolor":"rgba(255,127,0,0.5)","y":[0.5,0.70928865373309802,0.70358998582900301,0.66219512195121999,0.75823170731707301],"x":["5","5","5","5","5"],"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","type":"violin","name":"5","marker":{"color":"rgba(255,127,0,1)","line":{"color":"rgba(255,127,0,1)"}},"line":{"color":"rgba(255,127,0,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</div>
</div>
</div>
<p>Confirmando las afirmaciones anteriores, parece que la dispersión del AUC por cada Fold es la causante de una baja media. Se puede observar un patrón constante a través de los folds de los diferentes métodos de selección de características, y es que la dispersión de los valores de AUC es muy alta, mostrando una inestabilidad en el modelo a la hora de poder realizar predicciones robustas sobre datos no vistos anteriormente. Se pueden observar algunas excepciones a la regla, como el fold 2 del método Asociación, que tiene una dispersión baja y una mediana que posiciona el correspondiente AUC como un valor competitivo, sin embargo, el resto de folds de este mismo método están en clara desventaja, pudiendo atribuir el éxito del segundo fold a una <strong>distribución afortunada de los datos</strong>.</p>
</section>
<section id="comparativa-decision-tree" class="level4" data-number="4.2.4.3">
<h4 data-number="4.2.4.3" class="anchored" data-anchor-id="comparativa-decision-tree"><span class="header-section-number">4.2.4.3</span> Comparativa Decision Tree</h4>
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb140"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a>fig <span class="ot">&lt;-</span> <span class="fu">generate_combined_auc_3d_plot</span>(</span>
<span id="cb140-2"><a href="#cb140-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(</span>
<span id="cb140-3"><a href="#cb140-3" aria-hidden="true" tabindex="-1"></a>    RPart_TodasVariables_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb140-4"><a href="#cb140-4" aria-hidden="true" tabindex="-1"></a>    RPart_Asociacion_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb140-5"><a href="#cb140-5" aria-hidden="true" tabindex="-1"></a>    RPart_StepAUC_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb140-6"><a href="#cb140-6" aria-hidden="true" tabindex="-1"></a>    RPart_Lasso_Metrics<span class="sc">$</span>performance_metrics</span>
<span id="cb140-7"><a href="#cb140-7" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb140-8"><a href="#cb140-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">"Todas Variables"</span>, <span class="st">"Asociacion"</span>, <span class="st">"StepAUC"</span>, <span class="st">"Lasso"</span>)</span>
<span id="cb140-9"><a href="#cb140-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb140-10"><a href="#cb140-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-11"><a href="#cb140-11" aria-hidden="true" tabindex="-1"></a>fig</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-dbf153d068d892d9ca9b" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-dbf153d068d892d9ca9b">{"x":{"visdat":{"3f5860e3728b":["function () ","plotlyVisDat"],"3f583bd3813":["function () ","data"],"3f5873fd436d":["function () ","data"],"3f5861be5e5b":["function () ","data"],"3f5829896ddf":["function () ","data"],"3f58346f5679":["function () ","data"],"3f583dd7533a":["function () ","data"],"3f5854cd5e4a":["function () ","data"],"3f585ce27ede":["function () ","data"],"3f5832d02fb5":["function () ","data"],"3f587b856a8c":["function () ","data"],"3f581841830":["function () ","data"],"3f5850eb6211":["function () ","data"],"3f58dcc4986":["function () ","data"],"3f584484a25":["function () ","data"],"3f58165617d7":["function () ","data"],"3f5862c64e92":["function () ","data"],"3f58349118e0":["function () ","data"],"3f5831c33b99":["function () ","data"],"3f586ecd387c":["function () ","data"],"3f587139691":["function () ","data"]},"cur_data":"3f587139691","attrs":{"3f583bd3813":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines+markers","line":{"color":"#E41A1C"},"marker":{"size":5,"color":"#E41A1C"},"showlegend":true,"name":"Todas Variables - AUC medio global: 0.689","inherit":true},"3f5873fd436d":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines+markers","line":{"color":"#E41A1C"},"marker":{"size":5,"color":"#E41A1C"},"showlegend":false,"name":"","inherit":true},"3f5861be5e5b":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines+markers","line":{"color":"#E41A1C"},"marker":{"size":5,"color":"#E41A1C"},"showlegend":false,"name":"","inherit":true},"3f5829896ddf":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines+markers","line":{"color":"#E41A1C"},"marker":{"size":5,"color":"#E41A1C"},"showlegend":false,"name":"","inherit":true},"3f58346f5679":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines+markers","line":{"color":"#E41A1C"},"marker":{"size":5,"color":"#E41A1C"},"showlegend":false,"name":"","inherit":true},"3f583dd7533a":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines+markers","line":{"color":"#377EB8"},"marker":{"size":5,"color":"#377EB8"},"showlegend":true,"name":"Asociacion - AUC medio global: 0.665","inherit":true},"3f5854cd5e4a":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines+markers","line":{"color":"#377EB8"},"marker":{"size":5,"color":"#377EB8"},"showlegend":false,"name":"","inherit":true},"3f585ce27ede":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines+markers","line":{"color":"#377EB8"},"marker":{"size":5,"color":"#377EB8"},"showlegend":false,"name":"","inherit":true},"3f5832d02fb5":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines+markers","line":{"color":"#377EB8"},"marker":{"size":5,"color":"#377EB8"},"showlegend":false,"name":"","inherit":true},"3f587b856a8c":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines+markers","line":{"color":"#377EB8"},"marker":{"size":5,"color":"#377EB8"},"showlegend":false,"name":"","inherit":true},"3f581841830":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines+markers","line":{"color":"#4DAF4A"},"marker":{"size":5,"color":"#4DAF4A"},"showlegend":true,"name":"StepAUC - AUC medio global: 0.654","inherit":true},"3f5850eb6211":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines+markers","line":{"color":"#4DAF4A"},"marker":{"size":5,"color":"#4DAF4A"},"showlegend":false,"name":"","inherit":true},"3f58dcc4986":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines+markers","line":{"color":"#4DAF4A"},"marker":{"size":5,"color":"#4DAF4A"},"showlegend":false,"name":"","inherit":true},"3f584484a25":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines+markers","line":{"color":"#4DAF4A"},"marker":{"size":5,"color":"#4DAF4A"},"showlegend":false,"name":"","inherit":true},"3f58165617d7":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines+markers","line":{"color":"#4DAF4A"},"marker":{"size":5,"color":"#4DAF4A"},"showlegend":false,"name":"","inherit":true},"3f5862c64e92":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines+markers","line":{"color":"#984EA3"},"marker":{"size":5,"color":"#984EA3"},"showlegend":true,"name":"Lasso - AUC medio global: 0.647","inherit":true},"3f58349118e0":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines+markers","line":{"color":"#984EA3"},"marker":{"size":5,"color":"#984EA3"},"showlegend":false,"name":"","inherit":true},"3f5831c33b99":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines+markers","line":{"color":"#984EA3"},"marker":{"size":5,"color":"#984EA3"},"showlegend":false,"name":"","inherit":true},"3f586ecd387c":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines+markers","line":{"color":"#984EA3"},"marker":{"size":5,"color":"#984EA3"},"showlegend":false,"name":"","inherit":true},"3f587139691":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines+markers","line":{"color":"#984EA3"},"marker":{"size":5,"color":"#984EA3"},"showlegend":false,"name":"","inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"Comparación de AUC por Semilla y Fold para Diferentes Métodos","scene":{"xaxis":{"title":"Fold"},"yaxis":{"title":"Semilla"},"zaxis":{"title":"AUC"}},"yaxis":{"type":"category","categoryorder":"array","categoryarray":["seed_123","seed_27","seed_3","seed_50","seed_90"]},"hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":[1,2,3,4,5],"y":["seed_27","seed_27","seed_27","seed_27","seed_27"],"z":[0.69115853658536586,0.65436456996148906,0.53240740740740733,0.72652439024390247,0.73628048780487798],"type":"scatter3d","mode":"lines+markers","line":{"color":"#E41A1C"},"marker":{"color":"#E41A1C","size":5,"line":{"color":"rgba(31,119,180,1)"}},"showlegend":true,"name":"Todas Variables - AUC medio global: 0.689","error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"frame":null},{"x":[1,2,3,4,5],"y":["seed_3","seed_3","seed_3","seed_3","seed_3"],"z":[0.77654320987654313,0.68709884467265725,0.801219512195122,0.53262195121951228,0.7667682926829269],"type":"scatter3d","mode":"lines+markers","line":{"color":"#E41A1C"},"marker":{"color":"#E41A1C","size":5,"line":{"color":"rgba(255,127,14,1)"}},"showlegend":false,"name":"","error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"frame":null},{"x":[1,2,3,4,5],"y":["seed_123","seed_123","seed_123","seed_123","seed_123"],"z":[0.66374269005847952,0.71890243902439022,0.5,0.68048780487804883,0.63567073170731703],"type":"scatter3d","mode":"lines+markers","line":{"color":"#E41A1C"},"marker":{"color":"#E41A1C","size":5,"line":{"color":"rgba(44,160,44,1)"}},"showlegend":false,"name":"","error_y":{"color":"rgba(44,160,44,1)"},"error_x":{"color":"rgba(44,160,44,1)"},"frame":null},{"x":[1,2,3,4,5],"y":["seed_50","seed_50","seed_50","seed_50","seed_50"],"z":[0.76219512195121952,0.71247563352826515,0.72225609756097564,0.67347560975609755,0.65975609756097564],"type":"scatter3d","mode":"lines+markers","line":{"color":"#E41A1C"},"marker":{"color":"#E41A1C","size":5,"line":{"color":"rgba(214,39,40,1)"}},"showlegend":false,"name":"","error_y":{"color":"rgba(214,39,40,1)"},"error_x":{"color":"rgba(214,39,40,1)"},"frame":null},{"x":[1,2,3,4,5],"y":["seed_90","seed_90","seed_90","seed_90","seed_90"],"z":[0.7740853658536585,0.76798780487804874,0.7231481481481481,0.60365853658536583,0.71052631578947356],"type":"scatter3d","mode":"lines+markers","line":{"color":"#E41A1C"},"marker":{"color":"#E41A1C","size":5,"line":{"color":"rgba(148,103,189,1)"}},"showlegend":false,"name":"","error_y":{"color":"rgba(148,103,189,1)"},"error_x":{"color":"rgba(148,103,189,1)"},"frame":null},{"x":[1,2,3,4,5],"y":["seed_27","seed_27","seed_27","seed_27","seed_27"],"z":[0.66219512195121943,0.70827984595635429,0.5,0.71250000000000002,0.5],"type":"scatter3d","mode":"lines+markers","line":{"color":"#377EB8"},"marker":{"color":"#377EB8","size":5,"line":{"color":"rgba(140,86,75,1)"}},"showlegend":true,"name":"Asociacion - AUC medio global: 0.665","error_y":{"color":"rgba(140,86,75,1)"},"error_x":{"color":"rgba(140,86,75,1)"},"frame":null},{"x":[1,2,3,4,5],"y":["seed_3","seed_3","seed_3","seed_3","seed_3"],"z":[0.78518518518518521,0.69833119383825415,0.74176829268292688,0.61524390243902438,0.68445121951219512],"type":"scatter3d","mode":"lines+markers","line":{"color":"#377EB8"},"marker":{"color":"#377EB8","size":5,"line":{"color":"rgba(227,119,194,1)"}},"showlegend":false,"name":"","error_y":{"color":"rgba(227,119,194,1)"},"error_x":{"color":"rgba(227,119,194,1)"},"frame":null},{"x":[1,2,3,4,5],"y":["seed_123","seed_123","seed_123","seed_123","seed_123"],"z":[0.6871345029239766,0.77987804878048772,0.66707317073170735,0.61402439024390243,0.69207317073170727],"type":"scatter3d","mode":"lines+markers","line":{"color":"#377EB8"},"marker":{"color":"#377EB8","size":5,"line":{"color":"rgba(127,127,127,1)"}},"showlegend":false,"name":"","error_y":{"color":"rgba(127,127,127,1)"},"error_x":{"color":"rgba(127,127,127,1)"},"frame":null},{"x":[1,2,3,4,5],"y":["seed_50","seed_50","seed_50","seed_50","seed_50"],"z":[0.761280487804878,0.7586094866796621,0.73353658536585364,0.68414634146341458,0.5753048780487805],"type":"scatter3d","mode":"lines+markers","line":{"color":"#377EB8"},"marker":{"color":"#377EB8","size":5,"line":{"color":"rgba(188,189,34,1)"}},"showlegend":false,"name":"","error_y":{"color":"rgba(188,189,34,1)"},"error_x":{"color":"rgba(188,189,34,1)"},"frame":null},{"x":[1,2,3,4,5],"y":["seed_90","seed_90","seed_90","seed_90","seed_90"],"z":[0.72957317073170735,0.5,0.65987654320987654,0.67408536585365852,0.5],"type":"scatter3d","mode":"lines+markers","line":{"color":"#377EB8"},"marker":{"color":"#377EB8","size":5,"line":{"color":"rgba(23,190,207,1)"}},"showlegend":false,"name":"","error_y":{"color":"rgba(23,190,207,1)"},"error_x":{"color":"rgba(23,190,207,1)"},"frame":null},{"x":[1,2,3,4,5],"y":["seed_27","seed_27","seed_27","seed_27","seed_27"],"z":[0.5,0.65917843388960196,0.64259259259259205,0.65182926829268295,0.67926829268292699],"type":"scatter3d","mode":"lines+markers","line":{"color":"#4DAF4A"},"marker":{"color":"#4DAF4A","size":5,"line":{"color":"rgba(31,119,180,1)"}},"showlegend":true,"name":"StepAUC - AUC medio global: 0.654","error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"frame":null},{"x":[1,2,3,4,5],"y":["seed_3","seed_3","seed_3","seed_3","seed_3"],"z":[0.75987654320987696,0.69929396662387699,0.67500000000000004,0.59451219512195097,0.741463414634146],"type":"scatter3d","mode":"lines+markers","line":{"color":"#4DAF4A"},"marker":{"color":"#4DAF4A","size":5,"line":{"color":"rgba(255,127,14,1)"}},"showlegend":false,"name":"","error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"frame":null},{"x":[1,2,3,4,5],"y":["seed_123","seed_123","seed_123","seed_123","seed_123"],"z":[0.70532813515269699,0.72560975609756095,0.5,0.64237804878048799,0.67134146341463397],"type":"scatter3d","mode":"lines+markers","line":{"color":"#4DAF4A"},"marker":{"color":"#4DAF4A","size":5,"line":{"color":"rgba(44,160,44,1)"}},"showlegend":false,"name":"","error_y":{"color":"rgba(44,160,44,1)"},"error_x":{"color":"rgba(44,160,44,1)"},"frame":null},{"x":[1,2,3,4,5],"y":["seed_50","seed_50","seed_50","seed_50","seed_50"],"z":[0.5,0.71442495126705696,0.70914634146341504,0.70945121951219503,0.56768292682926802],"type":"scatter3d","mode":"lines+markers","line":{"color":"#4DAF4A"},"marker":{"color":"#4DAF4A","size":5,"line":{"color":"rgba(214,39,40,1)"}},"showlegend":false,"name":"","error_y":{"color":"rgba(214,39,40,1)"},"error_x":{"color":"rgba(214,39,40,1)"},"frame":null},{"x":[1,2,3,4,5],"y":["seed_90","seed_90","seed_90","seed_90","seed_90"],"z":[0.58353658536585395,0.72073170731707303,0.71111111111111103,0.60670731707317105,0.678754813863928],"type":"scatter3d","mode":"lines+markers","line":{"color":"#4DAF4A"},"marker":{"color":"#4DAF4A","size":5,"line":{"color":"rgba(148,103,189,1)"}},"showlegend":false,"name":"","error_y":{"color":"rgba(148,103,189,1)"},"error_x":{"color":"rgba(148,103,189,1)"},"frame":null},{"x":[1,2,3,4,5],"y":["seed_27","seed_27","seed_27","seed_27","seed_27"],"z":[0.69821428571428601,0.67195767195767198,0.73419117647058796,0.70638414969730301,0.5],"type":"scatter3d","mode":"lines+markers","line":{"color":"#984EA3"},"marker":{"color":"#984EA3","size":5,"line":{"color":"rgba(140,86,75,1)"}},"showlegend":true,"name":"Lasso - AUC medio global: 0.647","error_y":{"color":"rgba(140,86,75,1)"},"error_x":{"color":"rgba(140,86,75,1)"},"frame":null},{"x":[1,2,3,4,5],"y":["seed_3","seed_3","seed_3","seed_3","seed_3"],"z":[0.76007751937984502,0.5,0.5,0.77095588235294099,0.70928865373309802],"type":"scatter3d","mode":"lines+markers","line":{"color":"#984EA3"},"marker":{"color":"#984EA3","size":5,"line":{"color":"rgba(227,119,194,1)"}},"showlegend":false,"name":"","error_y":{"color":"rgba(227,119,194,1)"},"error_x":{"color":"rgba(227,119,194,1)"},"frame":null},{"x":[1,2,3,4,5],"y":["seed_123","seed_123","seed_123","seed_123","seed_123"],"z":[0.68482142857142803,0.5,0.57994814174589404,0.75224646983311905,0.70358998582900301],"type":"scatter3d","mode":"lines+markers","line":{"color":"#984EA3"},"marker":{"color":"#984EA3","size":5,"line":{"color":"rgba(127,127,127,1)"}},"showlegend":false,"name":"","error_y":{"color":"rgba(127,127,127,1)"},"error_x":{"color":"rgba(127,127,127,1)"},"frame":null},{"x":[1,2,3,4,5],"y":["seed_50","seed_50","seed_50","seed_50","seed_50"],"z":[0.5,0.71544117647058803,0.75264550264550301,0.5,0.66219512195121999],"type":"scatter3d","mode":"lines+markers","line":{"color":"#984EA3"},"marker":{"color":"#984EA3","size":5,"line":{"color":"rgba(188,189,34,1)"}},"showlegend":false,"name":"","error_y":{"color":"rgba(188,189,34,1)"},"error_x":{"color":"rgba(188,189,34,1)"},"frame":null},{"x":[1,2,3,4,5],"y":["seed_90","seed_90","seed_90","seed_90","seed_90"],"z":[0.73601190476190503,0.5,0.68294573643410905,0.60615079365079405,0.75823170731707301],"type":"scatter3d","mode":"lines+markers","line":{"color":"#984EA3"},"marker":{"color":"#984EA3","size":5,"line":{"color":"rgba(23,190,207,1)"}},"showlegend":false,"name":"","error_y":{"color":"rgba(23,190,207,1)"},"error_x":{"color":"rgba(23,190,207,1)"},"frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>Como se podría esperar por las observaciones anteriores, el AUC ofrecido por el ajuste de este modelo, tanto de sus hiperparámetros como de sus características, es relativamente bajo comparado con los modelos que se han comentado hasta ahora. Con un AUC global de 0.689, el método que no incluye una selección de variables (TodasVariables), podría ser considerado el más óptimo, sin embargo, se pueden observar claras fluctuaciones en el valor de su AUC para las diferentes semillas, demostrando que no es un método muy robusto a la hora de enfrentarse a datos aleatorios, siendo los folds 3 y 4 los más desfavorecidos para este método, llegando a obtener un AUC de 0.5 en el tercer fold de la semilla <code>123</code>.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-15-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-15-1" role="tab" aria-controls="tabset-15-1" aria-selected="true" href="">TodasVariables</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-15-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-15-2" role="tab" aria-controls="tabset-15-2" aria-selected="false" href="">Asociacion</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-15-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-15-3" role="tab" aria-controls="tabset-15-3" aria-selected="false" href="">StepAUC</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-15-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-15-4" role="tab" aria-controls="tabset-15-4" aria-selected="false" href="">Lasso</a></li></ul>
<div class="tab-content">
<div id="tabset-15-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-15-1-tab">
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb141"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a><span class="fu">generate_auc_per_seed_and_fold</span>(RPart_TodasVariables_Metrics<span class="sc">$</span>performance_metrics)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-8c918e3122fde42ef875" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-8c918e3122fde42ef875">{"x":{"visdat":{"3f58227d49d1":["function () ","plotlyVisDat"]},"cur_data":"3f58227d49d1","attrs":{"3f58227d49d1":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1,2,3,4,5],"y":[1,1,1,1,1],"z":[0.69115853658536586,0.65436456996148906,0.53240740740740733,0.72652439024390247,0.73628048780487798],"type":"scatter3d","mode":"lines+markers","line":{"width":2,"color":"#E41A1C"},"marker":{"size":5,"color":"#E41A1C"},"name":"Semilla 27 AUC medio: 0.64","inherit":true},"3f58227d49d1.1":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1,2,3,4,5],"y":[2,2,2,2,2],"z":[0.77654320987654313,0.68709884467265725,0.801219512195122,0.53262195121951228,0.7667682926829269],"type":"scatter3d","mode":"lines+markers","line":{"width":2,"color":"#377EB8"},"marker":{"size":5,"color":"#377EB8"},"name":"Semilla 3 AUC medio: 0.668","inherit":true},"3f58227d49d1.2":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1,2,3,4,5],"y":[3,3,3,3,3],"z":[0.66374269005847952,0.71890243902439022,0.5,0.68048780487804883,0.63567073170731703],"type":"scatter3d","mode":"lines+markers","line":{"width":2,"color":"#4DAF4A"},"marker":{"size":5,"color":"#4DAF4A"},"name":"Semilla 123 AUC medio: 0.713","inherit":true},"3f58227d49d1.3":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1,2,3,4,5],"y":[4,4,4,4,4],"z":[0.76219512195121952,0.71247563352826515,0.72225609756097564,0.67347560975609755,0.65975609756097564],"type":"scatter3d","mode":"lines+markers","line":{"width":2,"color":"#984EA3"},"marker":{"size":5,"color":"#984EA3"},"name":"Semilla 50 AUC medio: 0.706","inherit":true},"3f58227d49d1.4":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1,2,3,4,5],"y":[5,5,5,5,5],"z":[0.7740853658536585,0.76798780487804874,0.7231481481481481,0.60365853658536583,0.71052631578947356],"type":"scatter3d","mode":"lines+markers","line":{"width":2,"color":"#FF7F00"},"marker":{"size":5,"color":"#FF7F00"},"name":"Semilla 90 AUC medio: 0.716","inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"scene":{"xaxis":{"title":"Fold"},"yaxis":{"title":"Semilla"},"zaxis":{"title":"AUC"},"title":"Visualización 3D de Folds, Semillas y AUC"},"hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":[1,2,3,4,5],"y":[1,1,1,1,1],"z":[0.69115853658536586,0.65436456996148906,0.53240740740740733,0.72652439024390247,0.73628048780487798],"type":"scatter3d","mode":"lines+markers","line":{"color":"#E41A1C","width":2},"marker":{"color":"#E41A1C","size":5,"line":{"color":"rgba(31,119,180,1)"}},"name":"Semilla 27 AUC medio: 0.64","error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"frame":null},{"x":[1,2,3,4,5],"y":[2,2,2,2,2],"z":[0.77654320987654313,0.68709884467265725,0.801219512195122,0.53262195121951228,0.7667682926829269],"type":"scatter3d","mode":"lines+markers","line":{"color":"#377EB8","width":2},"marker":{"color":"#377EB8","size":5,"line":{"color":"rgba(255,127,14,1)"}},"name":"Semilla 3 AUC medio: 0.668","error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"frame":null},{"x":[1,2,3,4,5],"y":[3,3,3,3,3],"z":[0.66374269005847952,0.71890243902439022,0.5,0.68048780487804883,0.63567073170731703],"type":"scatter3d","mode":"lines+markers","line":{"color":"#4DAF4A","width":2},"marker":{"color":"#4DAF4A","size":5,"line":{"color":"rgba(44,160,44,1)"}},"name":"Semilla 123 AUC medio: 0.713","error_y":{"color":"rgba(44,160,44,1)"},"error_x":{"color":"rgba(44,160,44,1)"},"frame":null},{"x":[1,2,3,4,5],"y":[4,4,4,4,4],"z":[0.76219512195121952,0.71247563352826515,0.72225609756097564,0.67347560975609755,0.65975609756097564],"type":"scatter3d","mode":"lines+markers","line":{"color":"#984EA3","width":2},"marker":{"color":"#984EA3","size":5,"line":{"color":"rgba(214,39,40,1)"}},"name":"Semilla 50 AUC medio: 0.706","error_y":{"color":"rgba(214,39,40,1)"},"error_x":{"color":"rgba(214,39,40,1)"},"frame":null},{"x":[1,2,3,4,5],"y":[5,5,5,5,5],"z":[0.7740853658536585,0.76798780487804874,0.7231481481481481,0.60365853658536583,0.71052631578947356],"type":"scatter3d","mode":"lines+markers","line":{"color":"#FF7F00","width":2},"marker":{"color":"#FF7F00","size":5,"line":{"color":"rgba(148,103,189,1)"}},"name":"Semilla 90 AUC medio: 0.716","error_y":{"color":"rgba(148,103,189,1)"},"error_x":{"color":"rgba(148,103,189,1)"},"frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</div>
<div id="tabset-15-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-15-2-tab">
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb142"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a><span class="fu">generate_auc_per_seed_and_fold</span>(RPart_Asociacion_Metrics<span class="sc">$</span>performance_metrics)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-8e3a525fde81ae2da56e" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-8e3a525fde81ae2da56e">{"x":{"visdat":{"3f58672d37d0":["function () ","plotlyVisDat"]},"cur_data":"3f58672d37d0","attrs":{"3f58672d37d0":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1,2,3,4,5],"y":[1,1,1,1,1],"z":[0.66219512195121943,0.70827984595635429,0.5,0.71250000000000002,0.5],"type":"scatter3d","mode":"lines+markers","line":{"width":2,"color":"#E41A1C"},"marker":{"size":5,"color":"#E41A1C"},"name":"Semilla 27 AUC medio: 0.688","inherit":true},"3f58672d37d0.1":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1,2,3,4,5],"y":[2,2,2,2,2],"z":[0.78518518518518521,0.69833119383825415,0.74176829268292688,0.61524390243902438,0.68445121951219512],"type":"scatter3d","mode":"lines+markers","line":{"width":2,"color":"#377EB8"},"marker":{"size":5,"color":"#377EB8"},"name":"Semilla 3 AUC medio: 0.617","inherit":true},"3f58672d37d0.2":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1,2,3,4,5],"y":[3,3,3,3,3],"z":[0.6871345029239766,0.77987804878048772,0.66707317073170735,0.61402439024390243,0.69207317073170727],"type":"scatter3d","mode":"lines+markers","line":{"width":2,"color":"#4DAF4A"},"marker":{"size":5,"color":"#4DAF4A"},"name":"Semilla 123 AUC medio: 0.705","inherit":true},"3f58672d37d0.3":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1,2,3,4,5],"y":[4,4,4,4,4],"z":[0.761280487804878,0.7586094866796621,0.73353658536585364,0.68414634146341458,0.5753048780487805],"type":"scatter3d","mode":"lines+markers","line":{"width":2,"color":"#984EA3"},"marker":{"size":5,"color":"#984EA3"},"name":"Semilla 50 AUC medio: 0.703","inherit":true},"3f58672d37d0.4":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1,2,3,4,5],"y":[5,5,5,5,5],"z":[0.72957317073170735,0.5,0.65987654320987654,0.67408536585365852,0.5],"type":"scatter3d","mode":"lines+markers","line":{"width":2,"color":"#FF7F00"},"marker":{"size":5,"color":"#FF7F00"},"name":"Semilla 90 AUC medio: 0.613","inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"scene":{"xaxis":{"title":"Fold"},"yaxis":{"title":"Semilla"},"zaxis":{"title":"AUC"},"title":"Visualización 3D de Folds, Semillas y AUC"},"hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":[1,2,3,4,5],"y":[1,1,1,1,1],"z":[0.66219512195121943,0.70827984595635429,0.5,0.71250000000000002,0.5],"type":"scatter3d","mode":"lines+markers","line":{"color":"#E41A1C","width":2},"marker":{"color":"#E41A1C","size":5,"line":{"color":"rgba(31,119,180,1)"}},"name":"Semilla 27 AUC medio: 0.688","error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"frame":null},{"x":[1,2,3,4,5],"y":[2,2,2,2,2],"z":[0.78518518518518521,0.69833119383825415,0.74176829268292688,0.61524390243902438,0.68445121951219512],"type":"scatter3d","mode":"lines+markers","line":{"color":"#377EB8","width":2},"marker":{"color":"#377EB8","size":5,"line":{"color":"rgba(255,127,14,1)"}},"name":"Semilla 3 AUC medio: 0.617","error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"frame":null},{"x":[1,2,3,4,5],"y":[3,3,3,3,3],"z":[0.6871345029239766,0.77987804878048772,0.66707317073170735,0.61402439024390243,0.69207317073170727],"type":"scatter3d","mode":"lines+markers","line":{"color":"#4DAF4A","width":2},"marker":{"color":"#4DAF4A","size":5,"line":{"color":"rgba(44,160,44,1)"}},"name":"Semilla 123 AUC medio: 0.705","error_y":{"color":"rgba(44,160,44,1)"},"error_x":{"color":"rgba(44,160,44,1)"},"frame":null},{"x":[1,2,3,4,5],"y":[4,4,4,4,4],"z":[0.761280487804878,0.7586094866796621,0.73353658536585364,0.68414634146341458,0.5753048780487805],"type":"scatter3d","mode":"lines+markers","line":{"color":"#984EA3","width":2},"marker":{"color":"#984EA3","size":5,"line":{"color":"rgba(214,39,40,1)"}},"name":"Semilla 50 AUC medio: 0.703","error_y":{"color":"rgba(214,39,40,1)"},"error_x":{"color":"rgba(214,39,40,1)"},"frame":null},{"x":[1,2,3,4,5],"y":[5,5,5,5,5],"z":[0.72957317073170735,0.5,0.65987654320987654,0.67408536585365852,0.5],"type":"scatter3d","mode":"lines+markers","line":{"color":"#FF7F00","width":2},"marker":{"color":"#FF7F00","size":5,"line":{"color":"rgba(148,103,189,1)"}},"name":"Semilla 90 AUC medio: 0.613","error_y":{"color":"rgba(148,103,189,1)"},"error_x":{"color":"rgba(148,103,189,1)"},"frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</div>
<div id="tabset-15-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-15-3-tab">
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb143"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a><span class="fu">generate_auc_per_seed_and_fold</span>(RPart_StepAUC_Metrics<span class="sc">$</span>performance_metrics)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-cc20772010605a1eb8d5" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-cc20772010605a1eb8d5">{"x":{"visdat":{"3f58c63498b":["function () ","plotlyVisDat"]},"cur_data":"3f58c63498b","attrs":{"3f58c63498b":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1,2,3,4,5],"y":[1,1,1,1,1],"z":[0.5,0.65917843388960196,0.64259259259259205,0.65182926829268295,0.67926829268292699],"type":"scatter3d","mode":"lines+markers","line":{"width":2,"color":"#E41A1C"},"marker":{"size":5,"color":"#E41A1C"},"name":"Semilla 27 AUC medio: 0.649","inherit":true},"3f58c63498b.1":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1,2,3,4,5],"y":[2,2,2,2,2],"z":[0.75987654320987696,0.69929396662387699,0.67500000000000004,0.59451219512195097,0.741463414634146],"type":"scatter3d","mode":"lines+markers","line":{"width":2,"color":"#377EB8"},"marker":{"size":5,"color":"#377EB8"},"name":"Semilla 3 AUC medio: 0.627","inherit":true},"3f58c63498b.2":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1,2,3,4,5],"y":[3,3,3,3,3],"z":[0.70532813515269699,0.72560975609756095,0.5,0.64237804878048799,0.67134146341463397],"type":"scatter3d","mode":"lines+markers","line":{"width":2,"color":"#4DAF4A"},"marker":{"size":5,"color":"#4DAF4A"},"name":"Semilla 123 AUC medio: 0.694","inherit":true},"3f58c63498b.3":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1,2,3,4,5],"y":[4,4,4,4,4],"z":[0.5,0.71442495126705696,0.70914634146341504,0.70945121951219503,0.56768292682926802],"type":"scatter3d","mode":"lines+markers","line":{"width":2,"color":"#984EA3"},"marker":{"size":5,"color":"#984EA3"},"name":"Semilla 50 AUC medio: 0.64","inherit":true},"3f58c63498b.4":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1,2,3,4,5],"y":[5,5,5,5,5],"z":[0.58353658536585395,0.72073170731707303,0.71111111111111103,0.60670731707317105,0.678754813863928],"type":"scatter3d","mode":"lines+markers","line":{"width":2,"color":"#FF7F00"},"marker":{"size":5,"color":"#FF7F00"},"name":"Semilla 90 AUC medio: 0.66","inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"scene":{"xaxis":{"title":"Fold"},"yaxis":{"title":"Semilla"},"zaxis":{"title":"AUC"},"title":"Visualización 3D de Folds, Semillas y AUC"},"hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":[1,2,3,4,5],"y":[1,1,1,1,1],"z":[0.5,0.65917843388960196,0.64259259259259205,0.65182926829268295,0.67926829268292699],"type":"scatter3d","mode":"lines+markers","line":{"color":"#E41A1C","width":2},"marker":{"color":"#E41A1C","size":5,"line":{"color":"rgba(31,119,180,1)"}},"name":"Semilla 27 AUC medio: 0.649","error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"frame":null},{"x":[1,2,3,4,5],"y":[2,2,2,2,2],"z":[0.75987654320987696,0.69929396662387699,0.67500000000000004,0.59451219512195097,0.741463414634146],"type":"scatter3d","mode":"lines+markers","line":{"color":"#377EB8","width":2},"marker":{"color":"#377EB8","size":5,"line":{"color":"rgba(255,127,14,1)"}},"name":"Semilla 3 AUC medio: 0.627","error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"frame":null},{"x":[1,2,3,4,5],"y":[3,3,3,3,3],"z":[0.70532813515269699,0.72560975609756095,0.5,0.64237804878048799,0.67134146341463397],"type":"scatter3d","mode":"lines+markers","line":{"color":"#4DAF4A","width":2},"marker":{"color":"#4DAF4A","size":5,"line":{"color":"rgba(44,160,44,1)"}},"name":"Semilla 123 AUC medio: 0.694","error_y":{"color":"rgba(44,160,44,1)"},"error_x":{"color":"rgba(44,160,44,1)"},"frame":null},{"x":[1,2,3,4,5],"y":[4,4,4,4,4],"z":[0.5,0.71442495126705696,0.70914634146341504,0.70945121951219503,0.56768292682926802],"type":"scatter3d","mode":"lines+markers","line":{"color":"#984EA3","width":2},"marker":{"color":"#984EA3","size":5,"line":{"color":"rgba(214,39,40,1)"}},"name":"Semilla 50 AUC medio: 0.64","error_y":{"color":"rgba(214,39,40,1)"},"error_x":{"color":"rgba(214,39,40,1)"},"frame":null},{"x":[1,2,3,4,5],"y":[5,5,5,5,5],"z":[0.58353658536585395,0.72073170731707303,0.71111111111111103,0.60670731707317105,0.678754813863928],"type":"scatter3d","mode":"lines+markers","line":{"color":"#FF7F00","width":2},"marker":{"color":"#FF7F00","size":5,"line":{"color":"rgba(148,103,189,1)"}},"name":"Semilla 90 AUC medio: 0.66","error_y":{"color":"rgba(148,103,189,1)"},"error_x":{"color":"rgba(148,103,189,1)"},"frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</div>
<div id="tabset-15-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-15-4-tab">
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb144"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a><span class="fu">generate_auc_per_seed_and_fold</span>(RPart_Lasso_Metrics<span class="sc">$</span>performance_metrics)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-63a07ab48ccbc4793d80" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-63a07ab48ccbc4793d80">{"x":{"visdat":{"3f58562f2c27":["function () ","plotlyVisDat"]},"cur_data":"3f58562f2c27","attrs":{"3f58562f2c27":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1,2,3,4,5],"y":[1,1,1,1,1],"z":[0.69821428571428601,0.67195767195767198,0.73419117647058796,0.70638414969730301,0.5],"type":"scatter3d","mode":"lines+markers","line":{"width":2,"color":"#E41A1C"},"marker":{"size":5,"color":"#E41A1C"},"name":"Semilla 27 AUC medio: 0.644","inherit":true},"3f58562f2c27.1":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1,2,3,4,5],"y":[2,2,2,2,2],"z":[0.76007751937984502,0.5,0.5,0.77095588235294099,0.70928865373309802],"type":"scatter3d","mode":"lines+markers","line":{"width":2,"color":"#377EB8"},"marker":{"size":5,"color":"#377EB8"},"name":"Semilla 3 AUC medio: 0.662","inherit":true},"3f58562f2c27.2":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1,2,3,4,5],"y":[3,3,3,3,3],"z":[0.68482142857142803,0.5,0.57994814174589404,0.75224646983311905,0.70358998582900301],"type":"scatter3d","mode":"lines+markers","line":{"width":2,"color":"#4DAF4A"},"marker":{"size":5,"color":"#4DAF4A"},"name":"Semilla 123 AUC medio: 0.648","inherit":true},"3f58562f2c27.3":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1,2,3,4,5],"y":[4,4,4,4,4],"z":[0.5,0.71544117647058803,0.75264550264550301,0.5,0.66219512195121999],"type":"scatter3d","mode":"lines+markers","line":{"width":2,"color":"#984EA3"},"marker":{"size":5,"color":"#984EA3"},"name":"Semilla 50 AUC medio: 0.626","inherit":true},"3f58562f2c27.4":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1,2,3,4,5],"y":[5,5,5,5,5],"z":[0.73601190476190503,0.5,0.68294573643410905,0.60615079365079405,0.75823170731707301],"type":"scatter3d","mode":"lines+markers","line":{"width":2,"color":"#FF7F00"},"marker":{"size":5,"color":"#FF7F00"},"name":"Semilla 90 AUC medio: 0.657","inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"scene":{"xaxis":{"title":"Fold"},"yaxis":{"title":"Semilla"},"zaxis":{"title":"AUC"},"title":"Visualización 3D de Folds, Semillas y AUC"},"hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":[1,2,3,4,5],"y":[1,1,1,1,1],"z":[0.69821428571428601,0.67195767195767198,0.73419117647058796,0.70638414969730301,0.5],"type":"scatter3d","mode":"lines+markers","line":{"color":"#E41A1C","width":2},"marker":{"color":"#E41A1C","size":5,"line":{"color":"rgba(31,119,180,1)"}},"name":"Semilla 27 AUC medio: 0.644","error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"frame":null},{"x":[1,2,3,4,5],"y":[2,2,2,2,2],"z":[0.76007751937984502,0.5,0.5,0.77095588235294099,0.70928865373309802],"type":"scatter3d","mode":"lines+markers","line":{"color":"#377EB8","width":2},"marker":{"color":"#377EB8","size":5,"line":{"color":"rgba(255,127,14,1)"}},"name":"Semilla 3 AUC medio: 0.662","error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"frame":null},{"x":[1,2,3,4,5],"y":[3,3,3,3,3],"z":[0.68482142857142803,0.5,0.57994814174589404,0.75224646983311905,0.70358998582900301],"type":"scatter3d","mode":"lines+markers","line":{"color":"#4DAF4A","width":2},"marker":{"color":"#4DAF4A","size":5,"line":{"color":"rgba(44,160,44,1)"}},"name":"Semilla 123 AUC medio: 0.648","error_y":{"color":"rgba(44,160,44,1)"},"error_x":{"color":"rgba(44,160,44,1)"},"frame":null},{"x":[1,2,3,4,5],"y":[4,4,4,4,4],"z":[0.5,0.71544117647058803,0.75264550264550301,0.5,0.66219512195121999],"type":"scatter3d","mode":"lines+markers","line":{"color":"#984EA3","width":2},"marker":{"color":"#984EA3","size":5,"line":{"color":"rgba(214,39,40,1)"}},"name":"Semilla 50 AUC medio: 0.626","error_y":{"color":"rgba(214,39,40,1)"},"error_x":{"color":"rgba(214,39,40,1)"},"frame":null},{"x":[1,2,3,4,5],"y":[5,5,5,5,5],"z":[0.73601190476190503,0.5,0.68294573643410905,0.60615079365079405,0.75823170731707301],"type":"scatter3d","mode":"lines+markers","line":{"color":"#FF7F00","width":2},"marker":{"color":"#FF7F00","size":5,"line":{"color":"rgba(148,103,189,1)"}},"name":"Semilla 90 AUC medio: 0.657","error_y":{"color":"rgba(148,103,189,1)"},"error_x":{"color":"rgba(148,103,189,1)"},"frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="randomforest" class="level3" data-number="4.2.5">
<h3 data-number="4.2.5" class="anchored" data-anchor-id="randomforest"><span class="header-section-number">4.2.5</span> RandomForest</h3>
<section id="auc-fold-interno-vs-externo-4" class="level4" data-number="4.2.5.1">
<h4 data-number="4.2.5.1" class="anchored" data-anchor-id="auc-fold-interno-vs-externo-4"><span class="header-section-number">4.2.5.1</span> AUC Fold Interno vs Externo</h4>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-16-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-16-1" role="tab" aria-controls="tabset-16-1" aria-selected="true" href="">TodasVariables</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-16-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-16-2" role="tab" aria-controls="tabset-16-2" aria-selected="false" href="">Asociacion</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-16-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-16-3" role="tab" aria-controls="tabset-16-3" aria-selected="false" href="">StepAUC</a></li></ul>
<div class="tab-content">
<div id="tabset-16-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-16-1-tab">
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb145"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a><span class="fu">generate_inner_outer_auc_comparison</span>(RandomForest_TodasVariables_Metrics<span class="sc">$</span>inner_fold_metrics, RandomForest_TodasVariables_Metrics<span class="sc">$</span>performance_metrics)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-9688c8c05b08f3083d8a" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-9688c8c05b08f3083d8a">{"x":{"visdat":{"3f581f4531d8":["function () ","plotlyVisDat"]},"cur_data":"3f581f4531d8","attrs":{"3f581f4531d8":{"x":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"y":{},"type":"bar","name":"AUC Medio Inner Folds","marker":{"color":"blue"},"inherit":true},"3f581f4531d8.1":{"x":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"y":{},"type":"bar","name":"AUC Medio Outer Folds","marker":{"color":"red"},"inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"Comparación de AUC Medio: Inner Folds vs Outer Folds","xaxis":{"domain":[0,1],"automargin":true,"title":"Fold"},"yaxis":{"domain":[0,1],"automargin":true,"title":"AUC Medio","range":[0,1]},"barmode":"group","hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":[1,2,3,4,5],"y":[0.82803057389204138,0.83738769102237975,0.8270495195425055,0.8277804511159198,0.85256757602527655],"type":"bar","name":"AUC Medio Inner Folds","marker":{"color":"blue","line":{"color":"rgba(31,119,180,1)"}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[1,2,3,4,5],"y":[0.70581784180414897,0.69021105722753129,0.67848915989159897,0.66304878048780491,0.67209563543003847],"type":"bar","name":"AUC Medio Outer Folds","marker":{"color":"red","line":{"color":"rgba(255,127,14,1)"}},"error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</div>
<div id="tabset-16-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-16-2-tab">
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb146"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a><span class="fu">generate_inner_outer_auc_comparison</span>(RandomForest_Asociacion_Metrics<span class="sc">$</span>inner_fold_metrics, RandomForest_Asociacion_Metrics<span class="sc">$</span>performance_metrics)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-fa84a0446284a8425037" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-fa84a0446284a8425037">{"x":{"visdat":{"3f5820f24a01":["function () ","plotlyVisDat"]},"cur_data":"3f5820f24a01","attrs":{"3f5820f24a01":{"x":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"y":{},"type":"bar","name":"AUC Medio Inner Folds","marker":{"color":"blue"},"inherit":true},"3f5820f24a01.1":{"x":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"y":{},"type":"bar","name":"AUC Medio Outer Folds","marker":{"color":"red"},"inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"Comparación de AUC Medio: Inner Folds vs Outer Folds","xaxis":{"domain":[0,1],"automargin":true,"title":"Fold"},"yaxis":{"domain":[0,1],"automargin":true,"title":"AUC Medio","range":[0,1]},"barmode":"group","hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":[1,2,3,4,5],"y":[0.76418568737362691,0.77097461819503754,0.76168759735762759,0.7870915020219692,0.7772806359994936],"type":"bar","name":"AUC Medio Inner Folds","marker":{"color":"blue","line":{"color":"rgba(31,119,180,1)"}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[1,2,3,4,5],"y":[0.66597105342398455,0.67820773704813075,0.63333785004516707,0.62670731707317073,0.6471405648267009],"type":"bar","name":"AUC Medio Outer Folds","marker":{"color":"red","line":{"color":"rgba(255,127,14,1)"}},"error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</div>
<div id="tabset-16-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-16-3-tab">
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb147"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a><span class="fu">generate_inner_outer_auc_comparison</span>(RandomForest_StepAUC_Metrics<span class="sc">$</span>inner_fold_metrics, RandomForest_StepAUC_Metrics<span class="sc">$</span>performance_metrics)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-098d249dc86d3f5911c1" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-098d249dc86d3f5911c1">{"x":{"visdat":{"3f587755449d":["function () ","plotlyVisDat"]},"cur_data":"3f587755449d","attrs":{"3f587755449d":{"x":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"y":{},"type":"bar","name":"AUC Medio Inner Folds","marker":{"color":"blue"},"inherit":true},"3f587755449d.1":{"x":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"y":{},"type":"bar","name":"AUC Medio Outer Folds","marker":{"color":"red"},"inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"Comparación de AUC Medio: Inner Folds vs Outer Folds","xaxis":{"domain":[0,1],"automargin":true,"title":"Fold"},"yaxis":{"domain":[0,1],"automargin":true,"title":"AUC Medio","range":[0,1]},"barmode":"group","hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":[1,2,3,4,5],"y":[0.78655278581897425,0.80549517983824248,0.79889429191749439,0.83365837712028612,0.8140395346305398],"type":"bar","name":"AUC Medio Inner Folds","marker":{"color":"blue","line":{"color":"rgba(31,119,180,1)"}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[1,2,3,4,5],"y":[0.68406198988890476,0.69470237246232103,0.66777326106594403,0.6777439024390246,0.66129653401797184],"type":"bar","name":"AUC Medio Outer Folds","marker":{"color":"red","line":{"color":"rgba(255,127,14,1)"}},"error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</div>
</div>
</div>
<p>Se puede observar que el rendimiento en para los Folds externos es notablemente más bajo que el rendimiento para los internos a lo largo de todos los métodos de selección de características. Este hecho denota que el modelo es estable y no se han cometido errores a la hora de evaluarlo, sin embargo, también resalta la pobre capacidad de generalización, incluso habiendo ajustado los hiperparámetros a sus mejores valores.</p>
</section>
<section id="auc-medio-folds-externos-4" class="level4" data-number="4.2.5.2">
<h4 data-number="4.2.5.2" class="anchored" data-anchor-id="auc-medio-folds-externos-4"><span class="header-section-number">4.2.5.2</span> AUC Medio Folds Externos</h4>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-17-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-17-1" role="tab" aria-controls="tabset-17-1" aria-selected="true" href="">TodasVariables</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-17-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-17-2" role="tab" aria-controls="tabset-17-2" aria-selected="false" href="">Asociacion</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-17-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-17-3" role="tab" aria-controls="tabset-17-3" aria-selected="false" href="">StepAUC</a></li></ul>
<div class="tab-content">
<div id="tabset-17-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-17-1-tab">
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb148"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a><span class="fu">generate_outer_auc_violin_plot</span>(RandomForest_TodasVariables_Metrics<span class="sc">$</span>performance_metrics)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-ca0464909687f3e3845e" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-ca0464909687f3e3845e">{"x":{"visdat":{"3f5835cb64dd":["function () ","plotlyVisDat"]},"cur_data":"3f5835cb64dd","attrs":{"3f5835cb64dd":{"y":{},"x":{},"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","color":{},"colors":["#E41A1C","#377EB8","#4DAF4A","#984EA3","#FF7F00"],"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"violin"}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"Distribución del AUC por Outer Fold","xaxis":{"domain":[0,1],"automargin":true,"title":"Fold","type":"category","categoryorder":"array","categoryarray":["1","2","3","4","5"]},"yaxis":{"domain":[0,1],"automargin":true,"title":"AUC"},"hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"fillcolor":"rgba(228,26,28,0.5)","y":[0.69268292682926824,0.72746913580246908,0.71442495126705652,0.69481707317073171,0.69969512195121952],"x":["1","1","1","1","1"],"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","type":"violin","name":"1","marker":{"color":"rgba(228,26,28,1)","line":{"color":"rgba(228,26,28,1)"}},"line":{"color":"rgba(228,26,28,1)"},"xaxis":"x","yaxis":"y","frame":null},{"fillcolor":"rgba(55,126,184,0.5)","y":[0.63735558408215665,0.71790757381258019,0.67042682926829267,0.70890188434048074,0.71646341463414631],"x":["2","2","2","2","2"],"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","type":"violin","name":"2","marker":{"color":"rgba(55,126,184,1)","line":{"color":"rgba(55,126,184,1)"}},"line":{"color":"rgba(55,126,184,1)"},"xaxis":"x","yaxis":"y","frame":null},{"fillcolor":"rgba(77,175,74,0.5)","y":[0.63796296296296295,0.72530487804878052,0.69786585365853659,0.613719512195122,0.71759259259259256],"x":["3","3","3","3","3"],"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","type":"violin","name":"3","marker":{"color":"rgba(77,175,74,1)","line":{"color":"rgba(77,175,74,1)"}},"line":{"color":"rgba(77,175,74,1)"},"xaxis":"x","yaxis":"y","frame":null},{"fillcolor":"rgba(152,78,163,0.5)","y":[0.70396341463414636,0.65701219512195119,0.65701219512195119,0.6914634146341464,0.60579268292682931],"x":["4","4","4","4","4"],"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","type":"violin","name":"4","marker":{"color":"rgba(152,78,163,1)","line":{"color":"rgba(152,78,163,1)"}},"line":{"color":"rgba(152,78,163,1)"},"xaxis":"x","yaxis":"y","frame":null},{"fillcolor":"rgba(255,127,0,0.5)","y":[0.64237804878048776,0.73445121951219505,0.62317073170731707,0.69359756097560976,0.66688061617458283],"x":["5","5","5","5","5"],"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","type":"violin","name":"5","marker":{"color":"rgba(255,127,0,1)","line":{"color":"rgba(255,127,0,1)"}},"line":{"color":"rgba(255,127,0,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</div>
<div id="tabset-17-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-17-2-tab">
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb149"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a><span class="fu">generate_outer_auc_violin_plot</span>(RandomForest_Asociacion_Metrics<span class="sc">$</span>performance_metrics)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-37a54de329228fdba981" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-37a54de329228fdba981">{"x":{"visdat":{"3f581fab712":["function () ","plotlyVisDat"]},"cur_data":"3f581fab712","attrs":{"3f581fab712":{"y":{},"x":{},"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","color":{},"colors":["#E41A1C","#377EB8","#4DAF4A","#984EA3","#FF7F00"],"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"violin"}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"Distribución del AUC por Outer Fold","xaxis":{"domain":[0,1],"automargin":true,"title":"Fold","type":"category","categoryorder":"array","categoryarray":["1","2","3","4","5"]},"yaxis":{"domain":[0,1],"automargin":true,"title":"AUC"},"hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"fillcolor":"rgba(228,26,28,0.5)","y":[0.63292682926829269,0.67037037037037028,0.67381416504223512,0.71189024390243905,0.64085365853658538],"x":["1","1","1","1","1"],"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","type":"violin","name":"1","marker":{"color":"rgba(228,26,28,1)","line":{"color":"rgba(228,26,28,1)"}},"line":{"color":"rgba(228,26,28,1)"},"xaxis":"x","yaxis":"y","frame":null},{"fillcolor":"rgba(55,126,184,0.5)","y":[0.67843388960205397,0.69576379974326052,0.69054878048780488,0.65464587394411955,0.67164634146341462],"x":["2","2","2","2","2"],"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","type":"violin","name":"2","marker":{"color":"rgba(55,126,184,1)","line":{"color":"rgba(55,126,184,1)"}},"line":{"color":"rgba(55,126,184,1)"},"xaxis":"x","yaxis":"y","frame":null},{"fillcolor":"rgba(77,175,74,0.5)","y":[0.61111111111111116,0.69329268292682922,0.61615853658536579,0.613719512195122,0.63240740740740742],"x":["3","3","3","3","3"],"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","type":"violin","name":"3","marker":{"color":"rgba(77,175,74,1)","line":{"color":"rgba(77,175,74,1)"}},"line":{"color":"rgba(77,175,74,1)"},"xaxis":"x","yaxis":"y","frame":null},{"fillcolor":"rgba(152,78,163,0.5)","y":[0.72652439024390247,0.64237804878048776,0.5649390243902439,0.61128048780487798,0.58841463414634143],"x":["4","4","4","4","4"],"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","type":"violin","name":"4","marker":{"color":"rgba(152,78,163,1)","line":{"color":"rgba(152,78,163,1)"}},"line":{"color":"rgba(152,78,163,1)"},"xaxis":"x","yaxis":"y","frame":null},{"fillcolor":"rgba(255,127,0,0.5)","y":[0.64512195121951221,0.63750000000000007,0.68323170731707317,0.61676829268292677,0.65308087291399231],"x":["5","5","5","5","5"],"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","type":"violin","name":"5","marker":{"color":"rgba(255,127,0,1)","line":{"color":"rgba(255,127,0,1)"}},"line":{"color":"rgba(255,127,0,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</div>
<div id="tabset-17-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-17-3-tab">
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb150"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a><span class="fu">generate_outer_auc_violin_plot</span>(RandomForest_StepAUC_Metrics<span class="sc">$</span>performance_metrics)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-d10bf36e4889765b4e55" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-d10bf36e4889765b4e55">{"x":{"visdat":{"3f5859345dce":["function () ","plotlyVisDat"]},"cur_data":"3f5859345dce","attrs":{"3f5859345dce":{"y":{},"x":{},"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","color":{},"colors":["#E41A1C","#377EB8","#4DAF4A","#984EA3","#FF7F00"],"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"violin"}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"Distribución del AUC por Outer Fold","xaxis":{"domain":[0,1],"automargin":true,"title":"Fold","type":"category","categoryorder":"array","categoryarray":["1","2","3","4","5"]},"yaxis":{"domain":[0,1],"automargin":true,"title":"AUC"},"hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"fillcolor":"rgba(228,26,28,0.5)","y":[0.5,0.71388888888888902,0.772579597141001,0.76524390243902396,0.66859756097560996],"x":["1","1","1","1","1"],"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","type":"violin","name":"1","marker":{"color":"rgba(228,26,28,1)","line":{"color":"rgba(228,26,28,1)"}},"line":{"color":"rgba(228,26,28,1)"},"xaxis":"x","yaxis":"y","frame":null},{"fillcolor":"rgba(55,126,184,0.5)","y":[0.594993581514762,0.71694480102695801,0.70060975609756104,0.76218323586744596,0.698780487804878],"x":["2","2","2","2","2"],"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","type":"violin","name":"2","marker":{"color":"rgba(55,126,184,1)","line":{"color":"rgba(55,126,184,1)"}},"line":{"color":"rgba(55,126,184,1)"},"xaxis":"x","yaxis":"y","frame":null},{"fillcolor":"rgba(77,175,74,0.5)","y":[0.63734567901234596,0.69054878048780499,0.70121951219512202,0.63506097560975605,0.67469135802469105],"x":["3","3","3","3","3"],"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","type":"violin","name":"3","marker":{"color":"rgba(77,175,74,1)","line":{"color":"rgba(77,175,74,1)"}},"line":{"color":"rgba(77,175,74,1)"},"xaxis":"x","yaxis":"y","frame":null},{"fillcolor":"rgba(152,78,163,0.5)","y":[0.71067073170731698,0.63658536585365899,0.63292682926829302,0.77317073170731698,0.63536585365853704],"x":["4","4","4","4","4"],"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","type":"violin","name":"4","marker":{"color":"rgba(152,78,163,1)","line":{"color":"rgba(152,78,163,1)"}},"line":{"color":"rgba(152,78,163,1)"},"xaxis":"x","yaxis":"y","frame":null},{"fillcolor":"rgba(255,127,0,0.5)","y":[0.72225609756097597,0.55945121951219501,0.68323170731707294,0.6875,0.65404364569961504],"x":["5","5","5","5","5"],"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","type":"violin","name":"5","marker":{"color":"rgba(255,127,0,1)","line":{"color":"rgba(255,127,0,1)"}},"line":{"color":"rgba(255,127,0,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</div>
</div>
</div>
<p>En el método TodasVariables se puede observar que la dispersión del Fold 1 es muy baja y centrada en un valor alto del AUC, sin embargo, el resto de folds tienen una varianza alta, demostrando una baja capacidad de generalización y predicción. Por otra parte, el método Asociación muestra una baja dispersión en los Folds 1, 2 y 5, con alguna excepción en los Folds 3 y 4, adicionalmente, todos los Folds están centrados alrededor de un valor de AUC común, que se sitúa entre el 0.62 y el 0.68, mostrando una estabilidad. Finalmente, el método StepAUC muestra una alta dispersión en el primer y último Fold, pero un alto valor de AUC promedio, al igual que el primer método. Se puede concluir que, para este modelo, el método de selección de características más adecuado podría ser el de TodasVariables.</p>
</section>
<section id="comparativa-randomforest" class="level4" data-number="4.2.5.3">
<h4 data-number="4.2.5.3" class="anchored" data-anchor-id="comparativa-randomforest"><span class="header-section-number">4.2.5.3</span> Comparativa RandomForest</h4>
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb151"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb151-1"><a href="#cb151-1" aria-hidden="true" tabindex="-1"></a>fig <span class="ot">&lt;-</span> <span class="fu">generate_combined_auc_3d_plot</span>(</span>
<span id="cb151-2"><a href="#cb151-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(</span>
<span id="cb151-3"><a href="#cb151-3" aria-hidden="true" tabindex="-1"></a>    RandomForest_TodasVariables_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb151-4"><a href="#cb151-4" aria-hidden="true" tabindex="-1"></a>    RandomForest_Asociacion_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb151-5"><a href="#cb151-5" aria-hidden="true" tabindex="-1"></a>    RandomForest_StepAUC_Metrics<span class="sc">$</span>performance_metrics</span>
<span id="cb151-6"><a href="#cb151-6" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb151-7"><a href="#cb151-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">"Todas Variables"</span>, <span class="st">"Asociacion"</span>, <span class="st">"StepAUC"</span>)</span>
<span id="cb151-8"><a href="#cb151-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb151-9"><a href="#cb151-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-10"><a href="#cb151-10" aria-hidden="true" tabindex="-1"></a>fig</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-f29b83238414719f784d" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-f29b83238414719f784d">{"x":{"visdat":{"3f5824c3a46":["function () ","plotlyVisDat"],"3f587ab45ff4":["function () ","data"],"3f584913fb":["function () ","data"],"3f58bfe171c":["function () ","data"],"3f5836fd39a":["function () ","data"],"3f58939256d":["function () ","data"],"3f583b4e2520":["function () ","data"],"3f5864787275":["function () ","data"],"3f585d1c3541":["function () ","data"],"3f5822b47e25":["function () ","data"],"3f5830277e0b":["function () ","data"],"3f5815d3290":["function () ","data"],"3f5836c826c7":["function () ","data"],"3f587d0a62f0":["function () ","data"],"3f5824df3b20":["function () ","data"],"3f587f65bea":["function () ","data"]},"cur_data":"3f587f65bea","attrs":{"3f587ab45ff4":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines+markers","line":{"color":"#E41A1C"},"marker":{"size":5,"color":"#E41A1C"},"showlegend":true,"name":"Todas Variables - AUC medio global: 0.682","inherit":true},"3f584913fb":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines+markers","line":{"color":"#E41A1C"},"marker":{"size":5,"color":"#E41A1C"},"showlegend":false,"name":"","inherit":true},"3f58bfe171c":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines+markers","line":{"color":"#E41A1C"},"marker":{"size":5,"color":"#E41A1C"},"showlegend":false,"name":"","inherit":true},"3f5836fd39a":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines+markers","line":{"color":"#E41A1C"},"marker":{"size":5,"color":"#E41A1C"},"showlegend":false,"name":"","inherit":true},"3f58939256d":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines+markers","line":{"color":"#E41A1C"},"marker":{"size":5,"color":"#E41A1C"},"showlegend":false,"name":"","inherit":true},"3f583b4e2520":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines+markers","line":{"color":"#377EB8"},"marker":{"size":5,"color":"#377EB8"},"showlegend":true,"name":"Asociacion - AUC medio global: 0.65","inherit":true},"3f5864787275":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines+markers","line":{"color":"#377EB8"},"marker":{"size":5,"color":"#377EB8"},"showlegend":false,"name":"","inherit":true},"3f585d1c3541":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines+markers","line":{"color":"#377EB8"},"marker":{"size":5,"color":"#377EB8"},"showlegend":false,"name":"","inherit":true},"3f5822b47e25":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines+markers","line":{"color":"#377EB8"},"marker":{"size":5,"color":"#377EB8"},"showlegend":false,"name":"","inherit":true},"3f5830277e0b":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines+markers","line":{"color":"#377EB8"},"marker":{"size":5,"color":"#377EB8"},"showlegend":false,"name":"","inherit":true},"3f5815d3290":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines+markers","line":{"color":"#4DAF4A"},"marker":{"size":5,"color":"#4DAF4A"},"showlegend":true,"name":"StepAUC - AUC medio global: 0.677","inherit":true},"3f5836c826c7":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines+markers","line":{"color":"#4DAF4A"},"marker":{"size":5,"color":"#4DAF4A"},"showlegend":false,"name":"","inherit":true},"3f587d0a62f0":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines+markers","line":{"color":"#4DAF4A"},"marker":{"size":5,"color":"#4DAF4A"},"showlegend":false,"name":"","inherit":true},"3f5824df3b20":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines+markers","line":{"color":"#4DAF4A"},"marker":{"size":5,"color":"#4DAF4A"},"showlegend":false,"name":"","inherit":true},"3f587f65bea":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines+markers","line":{"color":"#4DAF4A"},"marker":{"size":5,"color":"#4DAF4A"},"showlegend":false,"name":"","inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"Comparación de AUC por Semilla y Fold para Diferentes Métodos","scene":{"xaxis":{"title":"Fold"},"yaxis":{"title":"Semilla"},"zaxis":{"title":"AUC"}},"yaxis":{"type":"category","categoryorder":"array","categoryarray":["seed_123","seed_27","seed_3","seed_50","seed_90"]},"hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":[1,2,3,4,5],"y":["seed_27","seed_27","seed_27","seed_27","seed_27"],"z":[0.69268292682926824,0.63735558408215665,0.63796296296296295,0.70396341463414636,0.64237804878048776],"type":"scatter3d","mode":"lines+markers","line":{"color":"#E41A1C"},"marker":{"color":"#E41A1C","size":5,"line":{"color":"rgba(31,119,180,1)"}},"showlegend":true,"name":"Todas Variables - AUC medio global: 0.682","error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"frame":null},{"x":[1,2,3,4,5],"y":["seed_3","seed_3","seed_3","seed_3","seed_3"],"z":[0.72746913580246908,0.71790757381258019,0.72530487804878052,0.65701219512195119,0.73445121951219505],"type":"scatter3d","mode":"lines+markers","line":{"color":"#E41A1C"},"marker":{"color":"#E41A1C","size":5,"line":{"color":"rgba(255,127,14,1)"}},"showlegend":false,"name":"","error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"frame":null},{"x":[1,2,3,4,5],"y":["seed_123","seed_123","seed_123","seed_123","seed_123"],"z":[0.71442495126705652,0.67042682926829267,0.69786585365853659,0.65701219512195119,0.62317073170731707],"type":"scatter3d","mode":"lines+markers","line":{"color":"#E41A1C"},"marker":{"color":"#E41A1C","size":5,"line":{"color":"rgba(44,160,44,1)"}},"showlegend":false,"name":"","error_y":{"color":"rgba(44,160,44,1)"},"error_x":{"color":"rgba(44,160,44,1)"},"frame":null},{"x":[1,2,3,4,5],"y":["seed_50","seed_50","seed_50","seed_50","seed_50"],"z":[0.69481707317073171,0.70890188434048074,0.613719512195122,0.6914634146341464,0.69359756097560976],"type":"scatter3d","mode":"lines+markers","line":{"color":"#E41A1C"},"marker":{"color":"#E41A1C","size":5,"line":{"color":"rgba(214,39,40,1)"}},"showlegend":false,"name":"","error_y":{"color":"rgba(214,39,40,1)"},"error_x":{"color":"rgba(214,39,40,1)"},"frame":null},{"x":[1,2,3,4,5],"y":["seed_90","seed_90","seed_90","seed_90","seed_90"],"z":[0.69969512195121952,0.71646341463414631,0.71759259259259256,0.60579268292682931,0.66688061617458283],"type":"scatter3d","mode":"lines+markers","line":{"color":"#E41A1C"},"marker":{"color":"#E41A1C","size":5,"line":{"color":"rgba(148,103,189,1)"}},"showlegend":false,"name":"","error_y":{"color":"rgba(148,103,189,1)"},"error_x":{"color":"rgba(148,103,189,1)"},"frame":null},{"x":[1,2,3,4,5],"y":["seed_27","seed_27","seed_27","seed_27","seed_27"],"z":[0.63292682926829269,0.67843388960205397,0.61111111111111116,0.72652439024390247,0.64512195121951221],"type":"scatter3d","mode":"lines+markers","line":{"color":"#377EB8"},"marker":{"color":"#377EB8","size":5,"line":{"color":"rgba(140,86,75,1)"}},"showlegend":true,"name":"Asociacion - AUC medio global: 0.65","error_y":{"color":"rgba(140,86,75,1)"},"error_x":{"color":"rgba(140,86,75,1)"},"frame":null},{"x":[1,2,3,4,5],"y":["seed_3","seed_3","seed_3","seed_3","seed_3"],"z":[0.67037037037037028,0.69576379974326052,0.69329268292682922,0.64237804878048776,0.63750000000000007],"type":"scatter3d","mode":"lines+markers","line":{"color":"#377EB8"},"marker":{"color":"#377EB8","size":5,"line":{"color":"rgba(227,119,194,1)"}},"showlegend":false,"name":"","error_y":{"color":"rgba(227,119,194,1)"},"error_x":{"color":"rgba(227,119,194,1)"},"frame":null},{"x":[1,2,3,4,5],"y":["seed_123","seed_123","seed_123","seed_123","seed_123"],"z":[0.67381416504223512,0.69054878048780488,0.61615853658536579,0.5649390243902439,0.68323170731707317],"type":"scatter3d","mode":"lines+markers","line":{"color":"#377EB8"},"marker":{"color":"#377EB8","size":5,"line":{"color":"rgba(127,127,127,1)"}},"showlegend":false,"name":"","error_y":{"color":"rgba(127,127,127,1)"},"error_x":{"color":"rgba(127,127,127,1)"},"frame":null},{"x":[1,2,3,4,5],"y":["seed_50","seed_50","seed_50","seed_50","seed_50"],"z":[0.71189024390243905,0.65464587394411955,0.613719512195122,0.61128048780487798,0.61676829268292677],"type":"scatter3d","mode":"lines+markers","line":{"color":"#377EB8"},"marker":{"color":"#377EB8","size":5,"line":{"color":"rgba(188,189,34,1)"}},"showlegend":false,"name":"","error_y":{"color":"rgba(188,189,34,1)"},"error_x":{"color":"rgba(188,189,34,1)"},"frame":null},{"x":[1,2,3,4,5],"y":["seed_90","seed_90","seed_90","seed_90","seed_90"],"z":[0.64085365853658538,0.67164634146341462,0.63240740740740742,0.58841463414634143,0.65308087291399231],"type":"scatter3d","mode":"lines+markers","line":{"color":"#377EB8"},"marker":{"color":"#377EB8","size":5,"line":{"color":"rgba(23,190,207,1)"}},"showlegend":false,"name":"","error_y":{"color":"rgba(23,190,207,1)"},"error_x":{"color":"rgba(23,190,207,1)"},"frame":null},{"x":[1,2,3,4,5],"y":["seed_27","seed_27","seed_27","seed_27","seed_27"],"z":[0.5,0.594993581514762,0.63734567901234596,0.71067073170731698,0.72225609756097597],"type":"scatter3d","mode":"lines+markers","line":{"color":"#4DAF4A"},"marker":{"color":"#4DAF4A","size":5,"line":{"color":"rgba(31,119,180,1)"}},"showlegend":true,"name":"StepAUC - AUC medio global: 0.677","error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"frame":null},{"x":[1,2,3,4,5],"y":["seed_3","seed_3","seed_3","seed_3","seed_3"],"z":[0.71388888888888902,0.71694480102695801,0.69054878048780499,0.63658536585365899,0.55945121951219501],"type":"scatter3d","mode":"lines+markers","line":{"color":"#4DAF4A"},"marker":{"color":"#4DAF4A","size":5,"line":{"color":"rgba(255,127,14,1)"}},"showlegend":false,"name":"","error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"frame":null},{"x":[1,2,3,4,5],"y":["seed_123","seed_123","seed_123","seed_123","seed_123"],"z":[0.772579597141001,0.70060975609756104,0.70121951219512202,0.63292682926829302,0.68323170731707294],"type":"scatter3d","mode":"lines+markers","line":{"color":"#4DAF4A"},"marker":{"color":"#4DAF4A","size":5,"line":{"color":"rgba(44,160,44,1)"}},"showlegend":false,"name":"","error_y":{"color":"rgba(44,160,44,1)"},"error_x":{"color":"rgba(44,160,44,1)"},"frame":null},{"x":[1,2,3,4,5],"y":["seed_50","seed_50","seed_50","seed_50","seed_50"],"z":[0.76524390243902396,0.76218323586744596,0.63506097560975605,0.77317073170731698,0.6875],"type":"scatter3d","mode":"lines+markers","line":{"color":"#4DAF4A"},"marker":{"color":"#4DAF4A","size":5,"line":{"color":"rgba(214,39,40,1)"}},"showlegend":false,"name":"","error_y":{"color":"rgba(214,39,40,1)"},"error_x":{"color":"rgba(214,39,40,1)"},"frame":null},{"x":[1,2,3,4,5],"y":["seed_90","seed_90","seed_90","seed_90","seed_90"],"z":[0.66859756097560996,0.698780487804878,0.67469135802469105,0.63536585365853704,0.65404364569961504],"type":"scatter3d","mode":"lines+markers","line":{"color":"#4DAF4A"},"marker":{"color":"#4DAF4A","size":5,"line":{"color":"rgba(148,103,189,1)"}},"showlegend":false,"name":"","error_y":{"color":"rgba(148,103,189,1)"},"error_x":{"color":"rgba(148,103,189,1)"},"frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>Los métodos de selección más competitivos son StepAUC y TodasVariables, con AUC’s de 0.677 y 0.682, respectivamente. Parece que, aunque el StepAUC muestre un mayor AUC global, la estabilidad del método hace que la dispersión del AUC sea más alta, teniendo un mínimo de 0.5 en la semila 27 para el Fold 1. Se podría concluir que el método más adecuado para el rendimiento con respecto al AUC del RandomForest es el de TodasVariables.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-18-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-18-1" role="tab" aria-controls="tabset-18-1" aria-selected="true" href="">TodasVariables</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-18-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-18-2" role="tab" aria-controls="tabset-18-2" aria-selected="false" href="">Asociacion</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-18-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-18-3" role="tab" aria-controls="tabset-18-3" aria-selected="false" href="">StepAUC</a></li></ul>
<div class="tab-content">
<div id="tabset-18-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-18-1-tab">
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb152"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a><span class="fu">generate_auc_per_seed_and_fold</span>(RandomForest_TodasVariables_Metrics<span class="sc">$</span>performance_metrics)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-0cee10190821c17fc885" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-0cee10190821c17fc885">{"x":{"visdat":{"3f5834a42913":["function () ","plotlyVisDat"]},"cur_data":"3f5834a42913","attrs":{"3f5834a42913":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1,2,3,4,5],"y":[1,1,1,1,1],"z":[0.69268292682926824,0.63735558408215665,0.63796296296296295,0.70396341463414636,0.64237804878048776],"type":"scatter3d","mode":"lines+markers","line":{"width":2,"color":"#E41A1C"},"marker":{"size":5,"color":"#E41A1C"},"name":"Semilla 27 AUC medio: 0.673","inherit":true},"3f5834a42913.1":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1,2,3,4,5],"y":[2,2,2,2,2],"z":[0.72746913580246908,0.71790757381258019,0.72530487804878052,0.65701219512195119,0.73445121951219505],"type":"scatter3d","mode":"lines+markers","line":{"width":2,"color":"#377EB8"},"marker":{"size":5,"color":"#377EB8"},"name":"Semilla 3 AUC medio: 0.663","inherit":true},"3f5834a42913.2":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1,2,3,4,5],"y":[3,3,3,3,3],"z":[0.71442495126705652,0.67042682926829267,0.69786585365853659,0.65701219512195119,0.62317073170731707],"type":"scatter3d","mode":"lines+markers","line":{"width":2,"color":"#4DAF4A"},"marker":{"size":5,"color":"#4DAF4A"},"name":"Semilla 123 AUC medio: 0.712","inherit":true},"3f5834a42913.3":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1,2,3,4,5],"y":[4,4,4,4,4],"z":[0.69481707317073171,0.70890188434048074,0.613719512195122,0.6914634146341464,0.69359756097560976],"type":"scatter3d","mode":"lines+markers","line":{"width":2,"color":"#984EA3"},"marker":{"size":5,"color":"#984EA3"},"name":"Semilla 50 AUC medio: 0.68","inherit":true},"3f5834a42913.4":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1,2,3,4,5],"y":[5,5,5,5,5],"z":[0.69969512195121952,0.71646341463414631,0.71759259259259256,0.60579268292682931,0.66688061617458283],"type":"scatter3d","mode":"lines+markers","line":{"width":2,"color":"#FF7F00"},"marker":{"size":5,"color":"#FF7F00"},"name":"Semilla 90 AUC medio: 0.681","inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"scene":{"xaxis":{"title":"Fold"},"yaxis":{"title":"Semilla"},"zaxis":{"title":"AUC"},"title":"Visualización 3D de Folds, Semillas y AUC"},"hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":[1,2,3,4,5],"y":[1,1,1,1,1],"z":[0.69268292682926824,0.63735558408215665,0.63796296296296295,0.70396341463414636,0.64237804878048776],"type":"scatter3d","mode":"lines+markers","line":{"color":"#E41A1C","width":2},"marker":{"color":"#E41A1C","size":5,"line":{"color":"rgba(31,119,180,1)"}},"name":"Semilla 27 AUC medio: 0.673","error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"frame":null},{"x":[1,2,3,4,5],"y":[2,2,2,2,2],"z":[0.72746913580246908,0.71790757381258019,0.72530487804878052,0.65701219512195119,0.73445121951219505],"type":"scatter3d","mode":"lines+markers","line":{"color":"#377EB8","width":2},"marker":{"color":"#377EB8","size":5,"line":{"color":"rgba(255,127,14,1)"}},"name":"Semilla 3 AUC medio: 0.663","error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"frame":null},{"x":[1,2,3,4,5],"y":[3,3,3,3,3],"z":[0.71442495126705652,0.67042682926829267,0.69786585365853659,0.65701219512195119,0.62317073170731707],"type":"scatter3d","mode":"lines+markers","line":{"color":"#4DAF4A","width":2},"marker":{"color":"#4DAF4A","size":5,"line":{"color":"rgba(44,160,44,1)"}},"name":"Semilla 123 AUC medio: 0.712","error_y":{"color":"rgba(44,160,44,1)"},"error_x":{"color":"rgba(44,160,44,1)"},"frame":null},{"x":[1,2,3,4,5],"y":[4,4,4,4,4],"z":[0.69481707317073171,0.70890188434048074,0.613719512195122,0.6914634146341464,0.69359756097560976],"type":"scatter3d","mode":"lines+markers","line":{"color":"#984EA3","width":2},"marker":{"color":"#984EA3","size":5,"line":{"color":"rgba(214,39,40,1)"}},"name":"Semilla 50 AUC medio: 0.68","error_y":{"color":"rgba(214,39,40,1)"},"error_x":{"color":"rgba(214,39,40,1)"},"frame":null},{"x":[1,2,3,4,5],"y":[5,5,5,5,5],"z":[0.69969512195121952,0.71646341463414631,0.71759259259259256,0.60579268292682931,0.66688061617458283],"type":"scatter3d","mode":"lines+markers","line":{"color":"#FF7F00","width":2},"marker":{"color":"#FF7F00","size":5,"line":{"color":"rgba(148,103,189,1)"}},"name":"Semilla 90 AUC medio: 0.681","error_y":{"color":"rgba(148,103,189,1)"},"error_x":{"color":"rgba(148,103,189,1)"},"frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</div>
<div id="tabset-18-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-18-2-tab">
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb153"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb153-1"><a href="#cb153-1" aria-hidden="true" tabindex="-1"></a><span class="fu">generate_auc_per_seed_and_fold</span>(RandomForest_Asociacion_Metrics<span class="sc">$</span>performance_metrics)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-6484b9e5f3f52f53f642" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-6484b9e5f3f52f53f642">{"x":{"visdat":{"3f58304953b2":["function () ","plotlyVisDat"]},"cur_data":"3f58304953b2","attrs":{"3f58304953b2":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1,2,3,4,5],"y":[1,1,1,1,1],"z":[0.63292682926829269,0.67843388960205397,0.61111111111111116,0.72652439024390247,0.64512195121951221],"type":"scatter3d","mode":"lines+markers","line":{"width":2,"color":"#E41A1C"},"marker":{"size":5,"color":"#E41A1C"},"name":"Semilla 27 AUC medio: 0.646","inherit":true},"3f58304953b2.1":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1,2,3,4,5],"y":[2,2,2,2,2],"z":[0.67037037037037028,0.69576379974326052,0.69329268292682922,0.64237804878048776,0.63750000000000007],"type":"scatter3d","mode":"lines+markers","line":{"width":2,"color":"#377EB8"},"marker":{"size":5,"color":"#377EB8"},"name":"Semilla 3 AUC medio: 0.659","inherit":true},"3f58304953b2.2":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1,2,3,4,5],"y":[3,3,3,3,3],"z":[0.67381416504223512,0.69054878048780488,0.61615853658536579,0.5649390243902439,0.68323170731707317],"type":"scatter3d","mode":"lines+markers","line":{"width":2,"color":"#4DAF4A"},"marker":{"size":5,"color":"#4DAF4A"},"name":"Semilla 123 AUC medio: 0.668","inherit":true},"3f58304953b2.3":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1,2,3,4,5],"y":[4,4,4,4,4],"z":[0.71189024390243905,0.65464587394411955,0.613719512195122,0.61128048780487798,0.61676829268292677],"type":"scatter3d","mode":"lines+markers","line":{"width":2,"color":"#984EA3"},"marker":{"size":5,"color":"#984EA3"},"name":"Semilla 50 AUC medio: 0.642","inherit":true},"3f58304953b2.4":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1,2,3,4,5],"y":[5,5,5,5,5],"z":[0.64085365853658538,0.67164634146341462,0.63240740740740742,0.58841463414634143,0.65308087291399231],"type":"scatter3d","mode":"lines+markers","line":{"width":2,"color":"#FF7F00"},"marker":{"size":5,"color":"#FF7F00"},"name":"Semilla 90 AUC medio: 0.637","inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"scene":{"xaxis":{"title":"Fold"},"yaxis":{"title":"Semilla"},"zaxis":{"title":"AUC"},"title":"Visualización 3D de Folds, Semillas y AUC"},"hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":[1,2,3,4,5],"y":[1,1,1,1,1],"z":[0.63292682926829269,0.67843388960205397,0.61111111111111116,0.72652439024390247,0.64512195121951221],"type":"scatter3d","mode":"lines+markers","line":{"color":"#E41A1C","width":2},"marker":{"color":"#E41A1C","size":5,"line":{"color":"rgba(31,119,180,1)"}},"name":"Semilla 27 AUC medio: 0.646","error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"frame":null},{"x":[1,2,3,4,5],"y":[2,2,2,2,2],"z":[0.67037037037037028,0.69576379974326052,0.69329268292682922,0.64237804878048776,0.63750000000000007],"type":"scatter3d","mode":"lines+markers","line":{"color":"#377EB8","width":2},"marker":{"color":"#377EB8","size":5,"line":{"color":"rgba(255,127,14,1)"}},"name":"Semilla 3 AUC medio: 0.659","error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"frame":null},{"x":[1,2,3,4,5],"y":[3,3,3,3,3],"z":[0.67381416504223512,0.69054878048780488,0.61615853658536579,0.5649390243902439,0.68323170731707317],"type":"scatter3d","mode":"lines+markers","line":{"color":"#4DAF4A","width":2},"marker":{"color":"#4DAF4A","size":5,"line":{"color":"rgba(44,160,44,1)"}},"name":"Semilla 123 AUC medio: 0.668","error_y":{"color":"rgba(44,160,44,1)"},"error_x":{"color":"rgba(44,160,44,1)"},"frame":null},{"x":[1,2,3,4,5],"y":[4,4,4,4,4],"z":[0.71189024390243905,0.65464587394411955,0.613719512195122,0.61128048780487798,0.61676829268292677],"type":"scatter3d","mode":"lines+markers","line":{"color":"#984EA3","width":2},"marker":{"color":"#984EA3","size":5,"line":{"color":"rgba(214,39,40,1)"}},"name":"Semilla 50 AUC medio: 0.642","error_y":{"color":"rgba(214,39,40,1)"},"error_x":{"color":"rgba(214,39,40,1)"},"frame":null},{"x":[1,2,3,4,5],"y":[5,5,5,5,5],"z":[0.64085365853658538,0.67164634146341462,0.63240740740740742,0.58841463414634143,0.65308087291399231],"type":"scatter3d","mode":"lines+markers","line":{"color":"#FF7F00","width":2},"marker":{"color":"#FF7F00","size":5,"line":{"color":"rgba(148,103,189,1)"}},"name":"Semilla 90 AUC medio: 0.637","error_y":{"color":"rgba(148,103,189,1)"},"error_x":{"color":"rgba(148,103,189,1)"},"frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</div>
<div id="tabset-18-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-18-3-tab">
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb154"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a><span class="fu">generate_auc_per_seed_and_fold</span>(RandomForest_StepAUC_Metrics<span class="sc">$</span>performance_metrics)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-c045e373ff95efaa8da2" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-c045e373ff95efaa8da2">{"x":{"visdat":{"3f5842ef1ec8":["function () ","plotlyVisDat"]},"cur_data":"3f5842ef1ec8","attrs":{"3f5842ef1ec8":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1,2,3,4,5],"y":[1,1,1,1,1],"z":[0.5,0.594993581514762,0.63734567901234596,0.71067073170731698,0.72225609756097597],"type":"scatter3d","mode":"lines+markers","line":{"width":2,"color":"#E41A1C"},"marker":{"size":5,"color":"#E41A1C"},"name":"Semilla 27 AUC medio: 0.698","inherit":true},"3f5842ef1ec8.1":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1,2,3,4,5],"y":[2,2,2,2,2],"z":[0.71388888888888902,0.71694480102695801,0.69054878048780499,0.63658536585365899,0.55945121951219501],"type":"scatter3d","mode":"lines+markers","line":{"width":2,"color":"#377EB8"},"marker":{"size":5,"color":"#377EB8"},"name":"Semilla 3 AUC medio: 0.633","inherit":true},"3f5842ef1ec8.2":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1,2,3,4,5],"y":[3,3,3,3,3],"z":[0.772579597141001,0.70060975609756104,0.70121951219512202,0.63292682926829302,0.68323170731707294],"type":"scatter3d","mode":"lines+markers","line":{"width":2,"color":"#4DAF4A"},"marker":{"size":5,"color":"#4DAF4A"},"name":"Semilla 123 AUC medio: 0.663","inherit":true},"3f5842ef1ec8.3":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1,2,3,4,5],"y":[4,4,4,4,4],"z":[0.76524390243902396,0.76218323586744596,0.63506097560975605,0.77317073170731698,0.6875],"type":"scatter3d","mode":"lines+markers","line":{"width":2,"color":"#984EA3"},"marker":{"size":5,"color":"#984EA3"},"name":"Semilla 50 AUC medio: 0.725","inherit":true},"3f5842ef1ec8.4":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1,2,3,4,5],"y":[5,5,5,5,5],"z":[0.66859756097560996,0.698780487804878,0.67469135802469105,0.63536585365853704,0.65404364569961504],"type":"scatter3d","mode":"lines+markers","line":{"width":2,"color":"#FF7F00"},"marker":{"size":5,"color":"#FF7F00"},"name":"Semilla 90 AUC medio: 0.666","inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"scene":{"xaxis":{"title":"Fold"},"yaxis":{"title":"Semilla"},"zaxis":{"title":"AUC"},"title":"Visualización 3D de Folds, Semillas y AUC"},"hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":[1,2,3,4,5],"y":[1,1,1,1,1],"z":[0.5,0.594993581514762,0.63734567901234596,0.71067073170731698,0.72225609756097597],"type":"scatter3d","mode":"lines+markers","line":{"color":"#E41A1C","width":2},"marker":{"color":"#E41A1C","size":5,"line":{"color":"rgba(31,119,180,1)"}},"name":"Semilla 27 AUC medio: 0.698","error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"frame":null},{"x":[1,2,3,4,5],"y":[2,2,2,2,2],"z":[0.71388888888888902,0.71694480102695801,0.69054878048780499,0.63658536585365899,0.55945121951219501],"type":"scatter3d","mode":"lines+markers","line":{"color":"#377EB8","width":2},"marker":{"color":"#377EB8","size":5,"line":{"color":"rgba(255,127,14,1)"}},"name":"Semilla 3 AUC medio: 0.633","error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"frame":null},{"x":[1,2,3,4,5],"y":[3,3,3,3,3],"z":[0.772579597141001,0.70060975609756104,0.70121951219512202,0.63292682926829302,0.68323170731707294],"type":"scatter3d","mode":"lines+markers","line":{"color":"#4DAF4A","width":2},"marker":{"color":"#4DAF4A","size":5,"line":{"color":"rgba(44,160,44,1)"}},"name":"Semilla 123 AUC medio: 0.663","error_y":{"color":"rgba(44,160,44,1)"},"error_x":{"color":"rgba(44,160,44,1)"},"frame":null},{"x":[1,2,3,4,5],"y":[4,4,4,4,4],"z":[0.76524390243902396,0.76218323586744596,0.63506097560975605,0.77317073170731698,0.6875],"type":"scatter3d","mode":"lines+markers","line":{"color":"#984EA3","width":2},"marker":{"color":"#984EA3","size":5,"line":{"color":"rgba(214,39,40,1)"}},"name":"Semilla 50 AUC medio: 0.725","error_y":{"color":"rgba(214,39,40,1)"},"error_x":{"color":"rgba(214,39,40,1)"},"frame":null},{"x":[1,2,3,4,5],"y":[5,5,5,5,5],"z":[0.66859756097560996,0.698780487804878,0.67469135802469105,0.63536585365853704,0.65404364569961504],"type":"scatter3d","mode":"lines+markers","line":{"color":"#FF7F00","width":2},"marker":{"color":"#FF7F00","size":5,"line":{"color":"rgba(148,103,189,1)"}},"name":"Semilla 90 AUC medio: 0.666","error_y":{"color":"rgba(148,103,189,1)"},"error_x":{"color":"rgba(148,103,189,1)"},"frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="svm" class="level3" data-number="4.2.6">
<h3 data-number="4.2.6" class="anchored" data-anchor-id="svm"><span class="header-section-number">4.2.6</span> SVM</h3>
<section id="auc-fold-interno-vs-externo-5" class="level4" data-number="4.2.6.1">
<h4 data-number="4.2.6.1" class="anchored" data-anchor-id="auc-fold-interno-vs-externo-5"><span class="header-section-number">4.2.6.1</span> AUC Fold Interno vs Externo</h4>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-19-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-19-1" role="tab" aria-controls="tabset-19-1" aria-selected="true" href="">TodasVariables</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-19-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-19-2" role="tab" aria-controls="tabset-19-2" aria-selected="false" href="">Asociacion</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-19-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-19-3" role="tab" aria-controls="tabset-19-3" aria-selected="false" href="">StepAUC</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-19-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-19-4" role="tab" aria-controls="tabset-19-4" aria-selected="false" href="">Lasso</a></li></ul>
<div class="tab-content">
<div id="tabset-19-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-19-1-tab">
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb155"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb155-1"><a href="#cb155-1" aria-hidden="true" tabindex="-1"></a><span class="fu">generate_inner_outer_auc_comparison</span>(SVM_TodasVariables_Metrics<span class="sc">$</span>inner_fold_metrics, SVM_TodasVariables_Metrics<span class="sc">$</span>performance_metrics)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-e12ae4ce6feb452e4c59" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-e12ae4ce6feb452e4c59">{"x":{"visdat":{"3f5865dd244d":["function () ","plotlyVisDat"]},"cur_data":"3f5865dd244d","attrs":{"3f5865dd244d":{"x":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"y":{},"type":"bar","name":"AUC Medio Inner Folds","marker":{"color":"blue"},"inherit":true},"3f5865dd244d.1":{"x":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"y":{},"type":"bar","name":"AUC Medio Outer Folds","marker":{"color":"red"},"inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"Comparación de AUC Medio: Inner Folds vs Outer Folds","xaxis":{"domain":[0,1],"automargin":true,"title":"Fold"},"yaxis":{"domain":[0,1],"automargin":true,"title":"AUC Medio","range":[0,1]},"barmode":"group","hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":[1,2,3,4,5],"y":[0.74728052209586515,0.76067168490083914,0.76349181764292862,0.7790680405122834,0.76148817008905101],"type":"bar","name":"AUC Medio Inner Folds","marker":{"color":"blue","line":{"color":"rgba(31,119,180,1)"}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[1,2,3,4,5],"y":[0.66393195613242684,0.62574937796161589,0.58211758506473954,0.59560975609756095,0.6163286264441592],"type":"bar","name":"AUC Medio Outer Folds","marker":{"color":"red","line":{"color":"rgba(255,127,14,1)"}},"error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</div>
<div id="tabset-19-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-19-2-tab">
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb156"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true" tabindex="-1"></a><span class="fu">generate_inner_outer_auc_comparison</span>(SVM_Asociacion_Metrics<span class="sc">$</span>inner_fold_metrics, SVM_Asociacion_Metrics<span class="sc">$</span>performance_metrics)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-99a59e8af6f0e760e148" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-99a59e8af6f0e760e148">{"x":{"visdat":{"3f584db77bd":["function () ","plotlyVisDat"]},"cur_data":"3f584db77bd","attrs":{"3f584db77bd":{"x":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"y":{},"type":"bar","name":"AUC Medio Inner Folds","marker":{"color":"blue"},"inherit":true},"3f584db77bd.1":{"x":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"y":{},"type":"bar","name":"AUC Medio Outer Folds","marker":{"color":"red"},"inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"Comparación de AUC Medio: Inner Folds vs Outer Folds","xaxis":{"domain":[0,1],"automargin":true,"title":"Fold"},"yaxis":{"domain":[0,1],"automargin":true,"title":"AUC Medio","range":[0,1]},"barmode":"group","hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":[1,2,3,4,5],"y":[0.74811393696021666,0.72951418423899905,0.70902141196376567,0.73063746465390556,0.75878973917747672],"type":"bar","name":"AUC Medio Inner Folds","marker":{"color":"blue","line":{"color":"rgba(31,119,180,1)"}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[1,2,3,4,5],"y":[0.60640683687538632,0.58491434095627504,0.64348840710629329,0.62719512195121951,0.65548780487804881],"type":"bar","name":"AUC Medio Outer Folds","marker":{"color":"red","line":{"color":"rgba(255,127,14,1)"}},"error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</div>
<div id="tabset-19-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-19-3-tab">
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb157"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb157-1"><a href="#cb157-1" aria-hidden="true" tabindex="-1"></a><span class="fu">generate_inner_outer_auc_comparison</span>(SVM_StepAUC_Metrics<span class="sc">$</span>inner_fold_metrics, SVM_StepAUC_Metrics<span class="sc">$</span>performance_metrics)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-1feebdccdbfb4ee8286e" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-1feebdccdbfb4ee8286e">{"x":{"visdat":{"3f581a4521d3":["function () ","plotlyVisDat"]},"cur_data":"3f581a4521d3","attrs":{"3f581a4521d3":{"x":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"y":{},"type":"bar","name":"AUC Medio Inner Folds","marker":{"color":"blue"},"inherit":true},"3f581a4521d3.1":{"x":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"y":{},"type":"bar","name":"AUC Medio Outer Folds","marker":{"color":"red"},"inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"Comparación de AUC Medio: Inner Folds vs Outer Folds","xaxis":{"domain":[0,1],"automargin":true,"title":"Fold"},"yaxis":{"domain":[0,1],"automargin":true,"title":"AUC Medio","range":[0,1]},"barmode":"group","hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":[1,2,3,4,5],"y":[0.74510032032098283,0.73346913163710448,0.72579365290614917,0.74016354402866824,0.73052154792872848],"type":"bar","name":"AUC Medio Inner Folds","marker":{"color":"blue","line":{"color":"rgba(31,119,180,1)"}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[1,2,3,4,5],"y":[0.57870196041141697,0.59782032995768541,0.6403357422463114,0.62658536585365854,0.64591463414634154],"type":"bar","name":"AUC Medio Outer Folds","marker":{"color":"red","line":{"color":"rgba(255,127,14,1)"}},"error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</div>
<div id="tabset-19-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-19-4-tab">
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb158"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb158-1"><a href="#cb158-1" aria-hidden="true" tabindex="-1"></a><span class="fu">generate_inner_outer_auc_comparison</span>(SVM_Lasso_Metrics<span class="sc">$</span>inner_fold_metrics, SVM_Lasso_Metrics<span class="sc">$</span>performance_metrics)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-6cd2c1a0aba41accd997" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-6cd2c1a0aba41accd997">{"x":{"visdat":{"3f58515d994":["function () ","plotlyVisDat"]},"cur_data":"3f58515d994","attrs":{"3f58515d994":{"x":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"y":{},"type":"bar","name":"AUC Medio Inner Folds","marker":{"color":"blue"},"inherit":true},"3f58515d994.1":{"x":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"y":{},"type":"bar","name":"AUC Medio Outer Folds","marker":{"color":"red"},"inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"Comparación de AUC Medio: Inner Folds vs Outer Folds","xaxis":{"domain":[0,1],"automargin":true,"title":"Fold"},"yaxis":{"domain":[0,1],"automargin":true,"title":"AUC Medio","range":[0,1]},"barmode":"group","hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":[1,2,3,4,5],"y":[0.75815323371202092,0.75324203657769229,0.72545541907902555,0.75603536479855127,0.74111732385463303],"type":"bar","name":"AUC Medio Inner Folds","marker":{"color":"blue","line":{"color":"rgba(31,119,180,1)"}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[1,2,3,4,5],"y":[0.65640980839632956,0.61448695700407285,0.65872628726287241,0.63926829268292706,0.62935173299101399],"type":"bar","name":"AUC Medio Outer Folds","marker":{"color":"red","line":{"color":"rgba(255,127,14,1)"}},"error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</div>
</div>
</div>
<p>En el método de todas las variables, el AUC medio en los inner folds es consistentemente mayor que en los outer folds. El método de todas las variables muestra valores notablemente bajos de AUC en el fold externo que en el interno, indicando estabilidad interna pero una pobre generalización. En el método de asociación, las diferencias entre los AUC medios de inner y outer folds son menores, sugiriendo una mejor generalización y consistencia en el rendimiento del modelo, llegando, de manera puntual y seguramente por outliers, a sobrepasar el rendimiento con test al rendimiento con la validación. El método stepAUC muestra una variabilidad similar a la de todas las variables, con inner folds generalmente superiores, pero con menos diferencia en comparación. Finalmente, el método Lasso presenta una paridad notable entre los AUC de inner y outer folds, reflejando una mayor estabilidad y generalización, con los valores más cercanos entre sí. En resumen, <strong>los métodos de asociación y Lasso parecen ofrecer una mejor generalización y estabilidad en el rendimiento del modelo</strong> en comparación con las técnicas que utilizan todas las variables y stepAUC.</p>
</section>
<section id="auc-medio-folds-externos-5" class="level4" data-number="4.2.6.2">
<h4 data-number="4.2.6.2" class="anchored" data-anchor-id="auc-medio-folds-externos-5"><span class="header-section-number">4.2.6.2</span> AUC Medio Folds Externos</h4>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-20-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-20-1" role="tab" aria-controls="tabset-20-1" aria-selected="true" href="">TodasVariables</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-20-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-20-2" role="tab" aria-controls="tabset-20-2" aria-selected="false" href="">Asociacion</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-20-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-20-3" role="tab" aria-controls="tabset-20-3" aria-selected="false" href="">StepAUC</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-20-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-20-4" role="tab" aria-controls="tabset-20-4" aria-selected="false" href="">Lasso</a></li></ul>
<div class="tab-content">
<div id="tabset-20-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-20-1-tab">
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb159"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb159-1"><a href="#cb159-1" aria-hidden="true" tabindex="-1"></a><span class="fu">generate_outer_auc_violin_plot</span>(SVM_TodasVariables_Metrics<span class="sc">$</span>performance_metrics)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-aa2f3ca139297a73ce84" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-aa2f3ca139297a73ce84">{"x":{"visdat":{"3f5822e56e90":["function () ","plotlyVisDat"]},"cur_data":"3f5822e56e90","attrs":{"3f5822e56e90":{"y":{},"x":{},"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","color":{},"colors":["#E41A1C","#377EB8","#4DAF4A","#984EA3","#FF7F00"],"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"violin"}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"Distribución del AUC por Outer Fold","xaxis":{"domain":[0,1],"automargin":true,"title":"Fold","type":"category","categoryorder":"array","categoryarray":["1","2","3","4","5"]},"yaxis":{"domain":[0,1],"automargin":true,"title":"AUC"},"hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"fillcolor":"rgba(228,26,28,0.5)","y":[0.72225609756097564,0.59753086419753088,0.75536062378167634,0.50060975609756098,0.74390243902439024],"x":["1","1","1","1","1"],"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","type":"violin","name":"1","marker":{"color":"rgba(228,26,28,1)","line":{"color":"rgba(228,26,28,1)"}},"line":{"color":"rgba(228,26,28,1)"},"xaxis":"x","yaxis":"y","frame":null},{"fillcolor":"rgba(55,126,184,0.5)","y":[0.6241976893453145,0.70154043645699615,0.64573170731707319,0.4993502274204028,0.65792682926829271],"x":["2","2","2","2","2"],"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","type":"violin","name":"2","marker":{"color":"rgba(55,126,184,1)","line":{"color":"rgba(55,126,184,1)"}},"line":{"color":"rgba(55,126,184,1)"},"xaxis":"x","yaxis":"y","frame":null},{"fillcolor":"rgba(77,175,74,0.5)","y":[0.61049382716049383,0.67774390243902438,0.56402439024390238,0.55060975609756091,0.50771604938271608],"x":["3","3","3","3","3"],"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","type":"violin","name":"3","marker":{"color":"rgba(77,175,74,1)","line":{"color":"rgba(77,175,74,1)"}},"line":{"color":"rgba(77,175,74,1)"},"xaxis":"x","yaxis":"y","frame":null},{"fillcolor":"rgba(152,78,163,0.5)","y":[0.57286585365853659,0.63567073170731703,0.63170731707317074,0.61036585365853657,0.52743902439024393],"x":["4","4","4","4","4"],"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","type":"violin","name":"4","marker":{"color":"rgba(152,78,163,1)","line":{"color":"rgba(152,78,163,1)"}},"line":{"color":"rgba(152,78,163,1)"},"xaxis":"x","yaxis":"y","frame":null},{"fillcolor":"rgba(255,127,0,0.5)","y":[0.61006097560975614,0.58689024390243905,0.54115853658536583,0.70457317073170733,0.63896020539152765],"x":["5","5","5","5","5"],"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","type":"violin","name":"5","marker":{"color":"rgba(255,127,0,1)","line":{"color":"rgba(255,127,0,1)"}},"line":{"color":"rgba(255,127,0,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</div>
<div id="tabset-20-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-20-2-tab">
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb160"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb160-1"><a href="#cb160-1" aria-hidden="true" tabindex="-1"></a><span class="fu">generate_outer_auc_violin_plot</span>(SVM_Asociacion_Metrics<span class="sc">$</span>performance_metrics)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-c73059f14186002d1454" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-c73059f14186002d1454">{"x":{"visdat":{"3f581fee5865":["function () ","plotlyVisDat"]},"cur_data":"3f581fee5865","attrs":{"3f581fee5865":{"y":{},"x":{},"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","color":{},"colors":["#E41A1C","#377EB8","#4DAF4A","#984EA3","#FF7F00"],"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"violin"}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"Distribución del AUC por Outer Fold","xaxis":{"domain":[0,1],"automargin":true,"title":"Fold","type":"category","categoryorder":"array","categoryarray":["1","2","3","4","5"]},"yaxis":{"domain":[0,1],"automargin":true,"title":"AUC"},"hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"fillcolor":"rgba(228,26,28,0.5)","y":[0.61859756097560981,0.67592592592592593,0.61403508771929827,0.66097560975609759,0.46250000000000002],"x":["1","1","1","1","1"],"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","type":"violin","name":"1","marker":{"color":"rgba(228,26,28,1)","line":{"color":"rgba(228,26,28,1)"}},"line":{"color":"rgba(228,26,28,1)"},"xaxis":"x","yaxis":"y","frame":null},{"fillcolor":"rgba(55,126,184,0.5)","y":[0.56578947368421051,0.66720154043645696,0.56432926829268293,0.54645873944119561,0.58079268292682928],"x":["2","2","2","2","2"],"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","type":"violin","name":"2","marker":{"color":"rgba(55,126,184,1)","line":{"color":"rgba(55,126,184,1)"}},"line":{"color":"rgba(55,126,184,1)"},"xaxis":"x","yaxis":"y","frame":null},{"fillcolor":"rgba(77,175,74,0.5)","y":[0.75648148148148142,0.61310975609756102,0.66219512195121955,0.58689024390243905,0.59876543209876543],"x":["3","3","3","3","3"],"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","type":"violin","name":"3","marker":{"color":"rgba(77,175,74,1)","line":{"color":"rgba(77,175,74,1)"}},"line":{"color":"rgba(77,175,74,1)"},"xaxis":"x","yaxis":"y","frame":null},{"fillcolor":"rgba(152,78,163,0.5)","y":[0.65426829268292686,0.53475609756097564,0.56128048780487805,0.72225609756097564,0.6634146341463415],"x":["4","4","4","4","4"],"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","type":"violin","name":"4","marker":{"color":"rgba(152,78,163,1)","line":{"color":"rgba(152,78,163,1)"}},"line":{"color":"rgba(152,78,163,1)"},"xaxis":"x","yaxis":"y","frame":null},{"fillcolor":"rgba(255,127,0,0.5)","y":[0.6722560975609756,0.68414634146341469,0.68384146341463414,0.48109756097560974,0.75609756097560976],"x":["5","5","5","5","5"],"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","type":"violin","name":"5","marker":{"color":"rgba(255,127,0,1)","line":{"color":"rgba(255,127,0,1)"}},"line":{"color":"rgba(255,127,0,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</div>
<div id="tabset-20-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-20-3-tab">
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb161"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb161-1"><a href="#cb161-1" aria-hidden="true" tabindex="-1"></a><span class="fu">generate_outer_auc_violin_plot</span>(SVM_StepAUC_Metrics<span class="sc">$</span>performance_metrics)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-ac720bf60f49690e4a02" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-ac720bf60f49690e4a02">{"x":{"visdat":{"3f585eeb1f84":["function () ","plotlyVisDat"]},"cur_data":"3f585eeb1f84","attrs":{"3f585eeb1f84":{"y":{},"x":{},"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","color":{},"colors":["#E41A1C","#377EB8","#4DAF4A","#984EA3","#FF7F00"],"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"violin"}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"Distribución del AUC por Outer Fold","xaxis":{"domain":[0,1],"automargin":true,"title":"Fold","type":"category","categoryorder":"array","categoryarray":["1","2","3","4","5"]},"yaxis":{"domain":[0,1],"automargin":true,"title":"AUC"},"hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"fillcolor":"rgba(228,26,28,0.5)","y":[0.52256097560975601,0.65833333333333299,0.61078622482131295,0.51890243902439004,0.58292682926829298],"x":["1","1","1","1","1"],"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","type":"violin","name":"1","marker":{"color":"rgba(228,26,28,1)","line":{"color":"rgba(228,26,28,1)"}},"line":{"color":"rgba(228,26,28,1)"},"xaxis":"x","yaxis":"y","frame":null},{"fillcolor":"rgba(55,126,184,0.5)","y":[0.51347881899871595,0.52182284980744498,0.59512195121951195,0.73001949317738801,0.62865853658536597],"x":["2","2","2","2","2"],"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","type":"violin","name":"2","marker":{"color":"rgba(55,126,184,1)","line":{"color":"rgba(55,126,184,1)"}},"line":{"color":"rgba(55,126,184,1)"},"xaxis":"x","yaxis":"y","frame":null},{"fillcolor":"rgba(77,175,74,0.5)","y":[0.67469135802469105,0.65792682926829305,0.59634146341463401,0.65975609756097597,0.61296296296296304],"x":["3","3","3","3","3"],"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","type":"violin","name":"3","marker":{"color":"rgba(77,175,74,1)","line":{"color":"rgba(77,175,74,1)"}},"line":{"color":"rgba(77,175,74,1)"},"xaxis":"x","yaxis":"y","frame":null},{"fillcolor":"rgba(152,78,163,0.5)","y":[0.70304878048780495,0.69207317073170704,0.55487804878048796,0.52073170731707297,0.66219512195121999],"x":["4","4","4","4","4"],"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","type":"violin","name":"4","marker":{"color":"rgba(152,78,163,1)","line":{"color":"rgba(152,78,163,1)"}},"line":{"color":"rgba(152,78,163,1)"},"xaxis":"x","yaxis":"y","frame":null},{"fillcolor":"rgba(255,127,0,0.5)","y":[0.68536585365853697,0.66006097560975596,0.684756097560976,0.54085365853658496,0.65853658536585402],"x":["5","5","5","5","5"],"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","type":"violin","name":"5","marker":{"color":"rgba(255,127,0,1)","line":{"color":"rgba(255,127,0,1)"}},"line":{"color":"rgba(255,127,0,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</div>
<div id="tabset-20-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-20-4-tab">
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb162"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb162-1"><a href="#cb162-1" aria-hidden="true" tabindex="-1"></a><span class="fu">generate_outer_auc_violin_plot</span>(SVM_Lasso_Metrics<span class="sc">$</span>performance_metrics)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-3b0c9f1fe48a9be13a77" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-3b0c9f1fe48a9be13a77">{"x":{"visdat":{"3f583f097338":["function () ","plotlyVisDat"]},"cur_data":"3f583f097338","attrs":{"3f583f097338":{"y":{},"x":{},"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","color":{},"colors":["#E41A1C","#377EB8","#4DAF4A","#984EA3","#FF7F00"],"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"violin"}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"Distribución del AUC por Outer Fold","xaxis":{"domain":[0,1],"automargin":true,"title":"Fold","type":"category","categoryorder":"array","categoryarray":["1","2","3","4","5"]},"yaxis":{"domain":[0,1],"automargin":true,"title":"AUC"},"hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"fillcolor":"rgba(228,26,28,0.5)","y":[0.60701219512195104,0.78580246913580198,0.70142949967511403,0.508536585365854,0.67926829268292699],"x":["1","1","1","1","1"],"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","type":"violin","name":"1","marker":{"color":"rgba(228,26,28,1)","line":{"color":"rgba(228,26,28,1)"}},"line":{"color":"rgba(228,26,28,1)"},"xaxis":"x","yaxis":"y","frame":null},{"fillcolor":"rgba(55,126,184,0.5)","y":[0.57028241335044905,0.55905006418485204,0.73506097560975603,0.59096816114359996,0.61707317073170698],"x":["2","2","2","2","2"],"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","type":"violin","name":"2","marker":{"color":"rgba(55,126,184,1)","line":{"color":"rgba(55,126,184,1)"}},"line":{"color":"rgba(55,126,184,1)"},"xaxis":"x","yaxis":"y","frame":null},{"fillcolor":"rgba(77,175,74,0.5)","y":[0.70308641975308594,0.65396341463414598,0.67713414634146296,0.53475609756097597,0.72469135802469098],"x":["3","3","3","3","3"],"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","type":"violin","name":"3","marker":{"color":"rgba(77,175,74,1)","line":{"color":"rgba(77,175,74,1)"}},"line":{"color":"rgba(77,175,74,1)"},"xaxis":"x","yaxis":"y","frame":null},{"fillcolor":"rgba(152,78,163,0.5)","y":[0.64725609756097602,0.63871951219512202,0.673170731707317,0.72042682926829305,0.51676829268292701],"x":["4","4","4","4","4"],"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","type":"violin","name":"4","marker":{"color":"rgba(152,78,163,1)","line":{"color":"rgba(152,78,163,1)"}},"line":{"color":"rgba(152,78,163,1)"},"xaxis":"x","yaxis":"y","frame":null},{"fillcolor":"rgba(255,127,0,0.5)","y":[0.74786585365853697,0.68963414634146303,0.59329268292682902,0.55274390243902405,0.563222079589217],"x":["5","5","5","5","5"],"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","type":"violin","name":"5","marker":{"color":"rgba(255,127,0,1)","line":{"color":"rgba(255,127,0,1)"}},"line":{"color":"rgba(255,127,0,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</div>
</div>
</div>
<p>En el método de todas las variables, se observa una mayor variabilidad en los valores de AUC, especialmente en el Fold 1, indicando inestabilidad en el rendimiento del modelo. El método de asociación presenta una distribución más compacta en general, con menos variabilidad, especialmente en los folds 1, 3 y 5, lo que sugiere una mayor consistencia en el rendimiento. El método stepAUC muestra una mayor variabilidad en el Fold 2, con un rango amplio de AUC, y menor consistencia en los folds 4 y 5. Finalmente, el método Lasso exhibe una distribución más equilibrada a través de todos los folds, con un AUC medio más alto, pero con una dispersión muy grande a pesar de todo. En conjunto, podríamos concluir que, <strong>los métodos de asociación y, de manera secundaria, Lasso demuestran un rendimiento más confiable y menos variable en comparación con todas las variables y stepAUC</strong>.</p>
</section>
<section id="comparativa-svm" class="level4" data-number="4.2.6.3">
<h4 data-number="4.2.6.3" class="anchored" data-anchor-id="comparativa-svm"><span class="header-section-number">4.2.6.3</span> Comparativa SVM</h4>
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb163"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb163-1"><a href="#cb163-1" aria-hidden="true" tabindex="-1"></a>fig <span class="ot">&lt;-</span> <span class="fu">generate_combined_auc_3d_plot</span>(</span>
<span id="cb163-2"><a href="#cb163-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(</span>
<span id="cb163-3"><a href="#cb163-3" aria-hidden="true" tabindex="-1"></a>    SVM_TodasVariables_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb163-4"><a href="#cb163-4" aria-hidden="true" tabindex="-1"></a>    SVM_Asociacion_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb163-5"><a href="#cb163-5" aria-hidden="true" tabindex="-1"></a>    SVM_StepAUC_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb163-6"><a href="#cb163-6" aria-hidden="true" tabindex="-1"></a>    SVM_Lasso_Metrics<span class="sc">$</span>performance_metrics</span>
<span id="cb163-7"><a href="#cb163-7" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb163-8"><a href="#cb163-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">"Todas Variables"</span>, <span class="st">"Asociacion"</span>, <span class="st">"StepAUC"</span>, <span class="st">"Lasso"</span>)</span>
<span id="cb163-9"><a href="#cb163-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb163-10"><a href="#cb163-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-11"><a href="#cb163-11" aria-hidden="true" tabindex="-1"></a>fig</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-f7d62f9b34e59b2c754d" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-f7d62f9b34e59b2c754d">{"x":{"visdat":{"3f5875c3e4":["function () ","plotlyVisDat"],"3f585eea4c8d":["function () ","data"],"3f581ab0208c":["function () ","data"],"3f585dde1a2c":["function () ","data"],"3f5825a02a96":["function () ","data"],"3f582c6e20a8":["function () ","data"],"3f5812e85ad2":["function () ","data"],"3f5844c128de":["function () ","data"],"3f5821fa64b9":["function () ","data"],"3f5876f942b5":["function () ","data"],"3f5862391cf2":["function () ","data"],"3f587cac5aba":["function () ","data"],"3f5820b5c1b":["function () ","data"],"3f5860985308":["function () ","data"],"3f58142f7ec5":["function () ","data"],"3f58e92236b":["function () ","data"],"3f583f5126c0":["function () ","data"],"3f581fc044c5":["function () ","data"],"3f58bdb219a":["function () ","data"],"3f5837086bb0":["function () ","data"],"3f58440f1862":["function () ","data"]},"cur_data":"3f58440f1862","attrs":{"3f585eea4c8d":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines+markers","line":{"color":"#E41A1C"},"marker":{"size":5,"color":"#E41A1C"},"showlegend":true,"name":"Todas Variables - AUC medio global: 0.617","inherit":true},"3f581ab0208c":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines+markers","line":{"color":"#E41A1C"},"marker":{"size":5,"color":"#E41A1C"},"showlegend":false,"name":"","inherit":true},"3f585dde1a2c":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines+markers","line":{"color":"#E41A1C"},"marker":{"size":5,"color":"#E41A1C"},"showlegend":false,"name":"","inherit":true},"3f5825a02a96":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines+markers","line":{"color":"#E41A1C"},"marker":{"size":5,"color":"#E41A1C"},"showlegend":false,"name":"","inherit":true},"3f582c6e20a8":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines+markers","line":{"color":"#E41A1C"},"marker":{"size":5,"color":"#E41A1C"},"showlegend":false,"name":"","inherit":true},"3f5812e85ad2":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines+markers","line":{"color":"#377EB8"},"marker":{"size":5,"color":"#377EB8"},"showlegend":true,"name":"Asociacion - AUC medio global: 0.623","inherit":true},"3f5844c128de":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines+markers","line":{"color":"#377EB8"},"marker":{"size":5,"color":"#377EB8"},"showlegend":false,"name":"","inherit":true},"3f5821fa64b9":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines+markers","line":{"color":"#377EB8"},"marker":{"size":5,"color":"#377EB8"},"showlegend":false,"name":"","inherit":true},"3f5876f942b5":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines+markers","line":{"color":"#377EB8"},"marker":{"size":5,"color":"#377EB8"},"showlegend":false,"name":"","inherit":true},"3f5862391cf2":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines+markers","line":{"color":"#377EB8"},"marker":{"size":5,"color":"#377EB8"},"showlegend":false,"name":"","inherit":true},"3f587cac5aba":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines+markers","line":{"color":"#4DAF4A"},"marker":{"size":5,"color":"#4DAF4A"},"showlegend":true,"name":"StepAUC - AUC medio global: 0.618","inherit":true},"3f5820b5c1b":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines+markers","line":{"color":"#4DAF4A"},"marker":{"size":5,"color":"#4DAF4A"},"showlegend":false,"name":"","inherit":true},"3f5860985308":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines+markers","line":{"color":"#4DAF4A"},"marker":{"size":5,"color":"#4DAF4A"},"showlegend":false,"name":"","inherit":true},"3f58142f7ec5":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines+markers","line":{"color":"#4DAF4A"},"marker":{"size":5,"color":"#4DAF4A"},"showlegend":false,"name":"","inherit":true},"3f58e92236b":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines+markers","line":{"color":"#4DAF4A"},"marker":{"size":5,"color":"#4DAF4A"},"showlegend":false,"name":"","inherit":true},"3f583f5126c0":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines+markers","line":{"color":"#984EA3"},"marker":{"size":5,"color":"#984EA3"},"showlegend":true,"name":"Lasso - AUC medio global: 0.64","inherit":true},"3f581fc044c5":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines+markers","line":{"color":"#984EA3"},"marker":{"size":5,"color":"#984EA3"},"showlegend":false,"name":"","inherit":true},"3f58bdb219a":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines+markers","line":{"color":"#984EA3"},"marker":{"size":5,"color":"#984EA3"},"showlegend":false,"name":"","inherit":true},"3f5837086bb0":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines+markers","line":{"color":"#984EA3"},"marker":{"size":5,"color":"#984EA3"},"showlegend":false,"name":"","inherit":true},"3f58440f1862":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines+markers","line":{"color":"#984EA3"},"marker":{"size":5,"color":"#984EA3"},"showlegend":false,"name":"","inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"Comparación de AUC por Semilla y Fold para Diferentes Métodos","scene":{"xaxis":{"title":"Fold"},"yaxis":{"title":"Semilla"},"zaxis":{"title":"AUC"}},"yaxis":{"type":"category","categoryorder":"array","categoryarray":["seed_123","seed_27","seed_3","seed_50","seed_90"]},"hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":[1,2,3,4,5],"y":["seed_27","seed_27","seed_27","seed_27","seed_27"],"z":[0.72225609756097564,0.6241976893453145,0.61049382716049383,0.57286585365853659,0.61006097560975614],"type":"scatter3d","mode":"lines+markers","line":{"color":"#E41A1C"},"marker":{"color":"#E41A1C","size":5,"line":{"color":"rgba(31,119,180,1)"}},"showlegend":true,"name":"Todas Variables - AUC medio global: 0.617","error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"frame":null},{"x":[1,2,3,4,5],"y":["seed_3","seed_3","seed_3","seed_3","seed_3"],"z":[0.59753086419753088,0.70154043645699615,0.67774390243902438,0.63567073170731703,0.58689024390243905],"type":"scatter3d","mode":"lines+markers","line":{"color":"#E41A1C"},"marker":{"color":"#E41A1C","size":5,"line":{"color":"rgba(255,127,14,1)"}},"showlegend":false,"name":"","error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"frame":null},{"x":[1,2,3,4,5],"y":["seed_123","seed_123","seed_123","seed_123","seed_123"],"z":[0.75536062378167634,0.64573170731707319,0.56402439024390238,0.63170731707317074,0.54115853658536583],"type":"scatter3d","mode":"lines+markers","line":{"color":"#E41A1C"},"marker":{"color":"#E41A1C","size":5,"line":{"color":"rgba(44,160,44,1)"}},"showlegend":false,"name":"","error_y":{"color":"rgba(44,160,44,1)"},"error_x":{"color":"rgba(44,160,44,1)"},"frame":null},{"x":[1,2,3,4,5],"y":["seed_50","seed_50","seed_50","seed_50","seed_50"],"z":[0.50060975609756098,0.4993502274204028,0.55060975609756091,0.61036585365853657,0.70457317073170733],"type":"scatter3d","mode":"lines+markers","line":{"color":"#E41A1C"},"marker":{"color":"#E41A1C","size":5,"line":{"color":"rgba(214,39,40,1)"}},"showlegend":false,"name":"","error_y":{"color":"rgba(214,39,40,1)"},"error_x":{"color":"rgba(214,39,40,1)"},"frame":null},{"x":[1,2,3,4,5],"y":["seed_90","seed_90","seed_90","seed_90","seed_90"],"z":[0.74390243902439024,0.65792682926829271,0.50771604938271608,0.52743902439024393,0.63896020539152765],"type":"scatter3d","mode":"lines+markers","line":{"color":"#E41A1C"},"marker":{"color":"#E41A1C","size":5,"line":{"color":"rgba(148,103,189,1)"}},"showlegend":false,"name":"","error_y":{"color":"rgba(148,103,189,1)"},"error_x":{"color":"rgba(148,103,189,1)"},"frame":null},{"x":[1,2,3,4,5],"y":["seed_27","seed_27","seed_27","seed_27","seed_27"],"z":[0.61859756097560981,0.56578947368421051,0.75648148148148142,0.65426829268292686,0.6722560975609756],"type":"scatter3d","mode":"lines+markers","line":{"color":"#377EB8"},"marker":{"color":"#377EB8","size":5,"line":{"color":"rgba(140,86,75,1)"}},"showlegend":true,"name":"Asociacion - AUC medio global: 0.623","error_y":{"color":"rgba(140,86,75,1)"},"error_x":{"color":"rgba(140,86,75,1)"},"frame":null},{"x":[1,2,3,4,5],"y":["seed_3","seed_3","seed_3","seed_3","seed_3"],"z":[0.67592592592592593,0.66720154043645696,0.61310975609756102,0.53475609756097564,0.68414634146341469],"type":"scatter3d","mode":"lines+markers","line":{"color":"#377EB8"},"marker":{"color":"#377EB8","size":5,"line":{"color":"rgba(227,119,194,1)"}},"showlegend":false,"name":"","error_y":{"color":"rgba(227,119,194,1)"},"error_x":{"color":"rgba(227,119,194,1)"},"frame":null},{"x":[1,2,3,4,5],"y":["seed_123","seed_123","seed_123","seed_123","seed_123"],"z":[0.61403508771929827,0.56432926829268293,0.66219512195121955,0.56128048780487805,0.68384146341463414],"type":"scatter3d","mode":"lines+markers","line":{"color":"#377EB8"},"marker":{"color":"#377EB8","size":5,"line":{"color":"rgba(127,127,127,1)"}},"showlegend":false,"name":"","error_y":{"color":"rgba(127,127,127,1)"},"error_x":{"color":"rgba(127,127,127,1)"},"frame":null},{"x":[1,2,3,4,5],"y":["seed_50","seed_50","seed_50","seed_50","seed_50"],"z":[0.66097560975609759,0.54645873944119561,0.58689024390243905,0.72225609756097564,0.48109756097560974],"type":"scatter3d","mode":"lines+markers","line":{"color":"#377EB8"},"marker":{"color":"#377EB8","size":5,"line":{"color":"rgba(188,189,34,1)"}},"showlegend":false,"name":"","error_y":{"color":"rgba(188,189,34,1)"},"error_x":{"color":"rgba(188,189,34,1)"},"frame":null},{"x":[1,2,3,4,5],"y":["seed_90","seed_90","seed_90","seed_90","seed_90"],"z":[0.46250000000000002,0.58079268292682928,0.59876543209876543,0.6634146341463415,0.75609756097560976],"type":"scatter3d","mode":"lines+markers","line":{"color":"#377EB8"},"marker":{"color":"#377EB8","size":5,"line":{"color":"rgba(23,190,207,1)"}},"showlegend":false,"name":"","error_y":{"color":"rgba(23,190,207,1)"},"error_x":{"color":"rgba(23,190,207,1)"},"frame":null},{"x":[1,2,3,4,5],"y":["seed_27","seed_27","seed_27","seed_27","seed_27"],"z":[0.52256097560975601,0.51347881899871595,0.67469135802469105,0.70304878048780495,0.68536585365853697],"type":"scatter3d","mode":"lines+markers","line":{"color":"#4DAF4A"},"marker":{"color":"#4DAF4A","size":5,"line":{"color":"rgba(31,119,180,1)"}},"showlegend":true,"name":"StepAUC - AUC medio global: 0.618","error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"frame":null},{"x":[1,2,3,4,5],"y":["seed_3","seed_3","seed_3","seed_3","seed_3"],"z":[0.65833333333333299,0.52182284980744498,0.65792682926829305,0.69207317073170704,0.66006097560975596],"type":"scatter3d","mode":"lines+markers","line":{"color":"#4DAF4A"},"marker":{"color":"#4DAF4A","size":5,"line":{"color":"rgba(255,127,14,1)"}},"showlegend":false,"name":"","error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"frame":null},{"x":[1,2,3,4,5],"y":["seed_123","seed_123","seed_123","seed_123","seed_123"],"z":[0.61078622482131295,0.59512195121951195,0.59634146341463401,0.55487804878048796,0.684756097560976],"type":"scatter3d","mode":"lines+markers","line":{"color":"#4DAF4A"},"marker":{"color":"#4DAF4A","size":5,"line":{"color":"rgba(44,160,44,1)"}},"showlegend":false,"name":"","error_y":{"color":"rgba(44,160,44,1)"},"error_x":{"color":"rgba(44,160,44,1)"},"frame":null},{"x":[1,2,3,4,5],"y":["seed_50","seed_50","seed_50","seed_50","seed_50"],"z":[0.51890243902439004,0.73001949317738801,0.65975609756097597,0.52073170731707297,0.54085365853658496],"type":"scatter3d","mode":"lines+markers","line":{"color":"#4DAF4A"},"marker":{"color":"#4DAF4A","size":5,"line":{"color":"rgba(214,39,40,1)"}},"showlegend":false,"name":"","error_y":{"color":"rgba(214,39,40,1)"},"error_x":{"color":"rgba(214,39,40,1)"},"frame":null},{"x":[1,2,3,4,5],"y":["seed_90","seed_90","seed_90","seed_90","seed_90"],"z":[0.58292682926829298,0.62865853658536597,0.61296296296296304,0.66219512195121999,0.65853658536585402],"type":"scatter3d","mode":"lines+markers","line":{"color":"#4DAF4A"},"marker":{"color":"#4DAF4A","size":5,"line":{"color":"rgba(148,103,189,1)"}},"showlegend":false,"name":"","error_y":{"color":"rgba(148,103,189,1)"},"error_x":{"color":"rgba(148,103,189,1)"},"frame":null},{"x":[1,2,3,4,5],"y":["seed_27","seed_27","seed_27","seed_27","seed_27"],"z":[0.60701219512195104,0.57028241335044905,0.70308641975308594,0.64725609756097602,0.74786585365853697],"type":"scatter3d","mode":"lines+markers","line":{"color":"#984EA3"},"marker":{"color":"#984EA3","size":5,"line":{"color":"rgba(140,86,75,1)"}},"showlegend":true,"name":"Lasso - AUC medio global: 0.64","error_y":{"color":"rgba(140,86,75,1)"},"error_x":{"color":"rgba(140,86,75,1)"},"frame":null},{"x":[1,2,3,4,5],"y":["seed_3","seed_3","seed_3","seed_3","seed_3"],"z":[0.78580246913580198,0.55905006418485204,0.65396341463414598,0.63871951219512202,0.68963414634146303],"type":"scatter3d","mode":"lines+markers","line":{"color":"#984EA3"},"marker":{"color":"#984EA3","size":5,"line":{"color":"rgba(227,119,194,1)"}},"showlegend":false,"name":"","error_y":{"color":"rgba(227,119,194,1)"},"error_x":{"color":"rgba(227,119,194,1)"},"frame":null},{"x":[1,2,3,4,5],"y":["seed_123","seed_123","seed_123","seed_123","seed_123"],"z":[0.70142949967511403,0.73506097560975603,0.67713414634146296,0.673170731707317,0.59329268292682902],"type":"scatter3d","mode":"lines+markers","line":{"color":"#984EA3"},"marker":{"color":"#984EA3","size":5,"line":{"color":"rgba(127,127,127,1)"}},"showlegend":false,"name":"","error_y":{"color":"rgba(127,127,127,1)"},"error_x":{"color":"rgba(127,127,127,1)"},"frame":null},{"x":[1,2,3,4,5],"y":["seed_50","seed_50","seed_50","seed_50","seed_50"],"z":[0.508536585365854,0.59096816114359996,0.53475609756097597,0.72042682926829305,0.55274390243902405],"type":"scatter3d","mode":"lines+markers","line":{"color":"#984EA3"},"marker":{"color":"#984EA3","size":5,"line":{"color":"rgba(188,189,34,1)"}},"showlegend":false,"name":"","error_y":{"color":"rgba(188,189,34,1)"},"error_x":{"color":"rgba(188,189,34,1)"},"frame":null},{"x":[1,2,3,4,5],"y":["seed_90","seed_90","seed_90","seed_90","seed_90"],"z":[0.67926829268292699,0.61707317073170698,0.72469135802469098,0.51676829268292701,0.563222079589217],"type":"scatter3d","mode":"lines+markers","line":{"color":"#984EA3"},"marker":{"color":"#984EA3","size":5,"line":{"color":"rgba(23,190,207,1)"}},"showlegend":false,"name":"","error_y":{"color":"rgba(23,190,207,1)"},"error_x":{"color":"rgba(23,190,207,1)"},"frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>Las gráficas comparativas del AUC para todos los métodos muestran una <strong>notable inestabilidad en el rendimiento del SVM independientemente del método de selección de características utilizado</strong>. Aunque el método Lasso presenta el AUC medio global más alto (0.64), seguido por la asociación (0.623), stepAUC (0.618) y todas las variables (0.617), en general, se observa una considerable variabilidad a través de diferentes semillas y folds. En todas las gráficas, los valores de AUC fluctúan significativamente, especialmente en los métodos de todas las variables y stepAUC, donde los puntos individuales muestran amplios rangos de dispersión. Incluso los métodos de selección de características que generalmente mejoran la estabilidad, como Lasso y asociación, no eliminan completamente la variabilidad, sugiriendo que el SVM es inherentemente inestable en este contexto. Esta inestabilidad destaca la dificultad del SVM para mantener un rendimiento consistente, lo que puede estar influenciado por la naturaleza de los datos y la sensibilidad del modelo a las particiones específicas de entrenamiento y prueba.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-21-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-21-1" role="tab" aria-controls="tabset-21-1" aria-selected="true" href="">TodasVariables</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-21-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-21-2" role="tab" aria-controls="tabset-21-2" aria-selected="false" href="">Asociacion</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-21-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-21-3" role="tab" aria-controls="tabset-21-3" aria-selected="false" href="">StepAUC</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-21-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-21-4" role="tab" aria-controls="tabset-21-4" aria-selected="false" href="">Lasso</a></li></ul>
<div class="tab-content">
<div id="tabset-21-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-21-1-tab">
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb164"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb164-1"><a href="#cb164-1" aria-hidden="true" tabindex="-1"></a><span class="fu">generate_auc_per_seed_and_fold</span>(SVM_TodasVariables_Metrics<span class="sc">$</span>performance_metrics)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-2f81df5a694923697970" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-2f81df5a694923697970">{"x":{"visdat":{"3f581a536cb1":["function () ","plotlyVisDat"]},"cur_data":"3f581a536cb1","attrs":{"3f581a536cb1":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1,2,3,4,5],"y":[1,1,1,1,1],"z":[0.72225609756097564,0.6241976893453145,0.61049382716049383,0.57286585365853659,0.61006097560975614],"type":"scatter3d","mode":"lines+markers","line":{"width":2,"color":"#E41A1C"},"marker":{"size":5,"color":"#E41A1C"},"name":"Semilla 27 AUC medio: 0.628","inherit":true},"3f581a536cb1.1":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1,2,3,4,5],"y":[2,2,2,2,2],"z":[0.59753086419753088,0.70154043645699615,0.67774390243902438,0.63567073170731703,0.58689024390243905],"type":"scatter3d","mode":"lines+markers","line":{"width":2,"color":"#377EB8"},"marker":{"size":5,"color":"#377EB8"},"name":"Semilla 3 AUC medio: 0.628","inherit":true},"3f581a536cb1.2":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1,2,3,4,5],"y":[3,3,3,3,3],"z":[0.75536062378167634,0.64573170731707319,0.56402439024390238,0.63170731707317074,0.54115853658536583],"type":"scatter3d","mode":"lines+markers","line":{"width":2,"color":"#4DAF4A"},"marker":{"size":5,"color":"#4DAF4A"},"name":"Semilla 123 AUC medio: 0.64","inherit":true},"3f581a536cb1.3":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1,2,3,4,5],"y":[4,4,4,4,4],"z":[0.50060975609756098,0.4993502274204028,0.55060975609756091,0.61036585365853657,0.70457317073170733],"type":"scatter3d","mode":"lines+markers","line":{"width":2,"color":"#984EA3"},"marker":{"size":5,"color":"#984EA3"},"name":"Semilla 50 AUC medio: 0.573","inherit":true},"3f581a536cb1.4":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1,2,3,4,5],"y":[5,5,5,5,5],"z":[0.74390243902439024,0.65792682926829271,0.50771604938271608,0.52743902439024393,0.63896020539152765],"type":"scatter3d","mode":"lines+markers","line":{"width":2,"color":"#FF7F00"},"marker":{"size":5,"color":"#FF7F00"},"name":"Semilla 90 AUC medio: 0.615","inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"scene":{"xaxis":{"title":"Fold"},"yaxis":{"title":"Semilla"},"zaxis":{"title":"AUC"},"title":"Visualización 3D de Folds, Semillas y AUC"},"hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":[1,2,3,4,5],"y":[1,1,1,1,1],"z":[0.72225609756097564,0.6241976893453145,0.61049382716049383,0.57286585365853659,0.61006097560975614],"type":"scatter3d","mode":"lines+markers","line":{"color":"#E41A1C","width":2},"marker":{"color":"#E41A1C","size":5,"line":{"color":"rgba(31,119,180,1)"}},"name":"Semilla 27 AUC medio: 0.628","error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"frame":null},{"x":[1,2,3,4,5],"y":[2,2,2,2,2],"z":[0.59753086419753088,0.70154043645699615,0.67774390243902438,0.63567073170731703,0.58689024390243905],"type":"scatter3d","mode":"lines+markers","line":{"color":"#377EB8","width":2},"marker":{"color":"#377EB8","size":5,"line":{"color":"rgba(255,127,14,1)"}},"name":"Semilla 3 AUC medio: 0.628","error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"frame":null},{"x":[1,2,3,4,5],"y":[3,3,3,3,3],"z":[0.75536062378167634,0.64573170731707319,0.56402439024390238,0.63170731707317074,0.54115853658536583],"type":"scatter3d","mode":"lines+markers","line":{"color":"#4DAF4A","width":2},"marker":{"color":"#4DAF4A","size":5,"line":{"color":"rgba(44,160,44,1)"}},"name":"Semilla 123 AUC medio: 0.64","error_y":{"color":"rgba(44,160,44,1)"},"error_x":{"color":"rgba(44,160,44,1)"},"frame":null},{"x":[1,2,3,4,5],"y":[4,4,4,4,4],"z":[0.50060975609756098,0.4993502274204028,0.55060975609756091,0.61036585365853657,0.70457317073170733],"type":"scatter3d","mode":"lines+markers","line":{"color":"#984EA3","width":2},"marker":{"color":"#984EA3","size":5,"line":{"color":"rgba(214,39,40,1)"}},"name":"Semilla 50 AUC medio: 0.573","error_y":{"color":"rgba(214,39,40,1)"},"error_x":{"color":"rgba(214,39,40,1)"},"frame":null},{"x":[1,2,3,4,5],"y":[5,5,5,5,5],"z":[0.74390243902439024,0.65792682926829271,0.50771604938271608,0.52743902439024393,0.63896020539152765],"type":"scatter3d","mode":"lines+markers","line":{"color":"#FF7F00","width":2},"marker":{"color":"#FF7F00","size":5,"line":{"color":"rgba(148,103,189,1)"}},"name":"Semilla 90 AUC medio: 0.615","error_y":{"color":"rgba(148,103,189,1)"},"error_x":{"color":"rgba(148,103,189,1)"},"frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</div>
<div id="tabset-21-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-21-2-tab">
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb165"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb165-1"><a href="#cb165-1" aria-hidden="true" tabindex="-1"></a><span class="fu">generate_auc_per_seed_and_fold</span>(SVM_Asociacion_Metrics<span class="sc">$</span>performance_metrics)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-467b070a281e7b4313c4" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-467b070a281e7b4313c4">{"x":{"visdat":{"3f589cb66ec":["function () ","plotlyVisDat"]},"cur_data":"3f589cb66ec","attrs":{"3f589cb66ec":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1,2,3,4,5],"y":[1,1,1,1,1],"z":[0.61859756097560981,0.56578947368421051,0.75648148148148142,0.65426829268292686,0.6722560975609756],"type":"scatter3d","mode":"lines+markers","line":{"width":2,"color":"#E41A1C"},"marker":{"size":5,"color":"#E41A1C"},"name":"Semilla 27 AUC medio: 0.617","inherit":true},"3f589cb66ec.1":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1,2,3,4,5],"y":[2,2,2,2,2],"z":[0.67592592592592593,0.66720154043645696,0.61310975609756102,0.53475609756097564,0.68414634146341469],"type":"scatter3d","mode":"lines+markers","line":{"width":2,"color":"#377EB8"},"marker":{"size":5,"color":"#377EB8"},"name":"Semilla 3 AUC medio: 0.653","inherit":true},"3f589cb66ec.2":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1,2,3,4,5],"y":[3,3,3,3,3],"z":[0.61403508771929827,0.56432926829268293,0.66219512195121955,0.56128048780487805,0.68384146341463414],"type":"scatter3d","mode":"lines+markers","line":{"width":2,"color":"#4DAF4A"},"marker":{"size":5,"color":"#4DAF4A"},"name":"Semilla 123 AUC medio: 0.635","inherit":true},"3f589cb66ec.3":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1,2,3,4,5],"y":[4,4,4,4,4],"z":[0.66097560975609759,0.54645873944119561,0.58689024390243905,0.72225609756097564,0.48109756097560974],"type":"scatter3d","mode":"lines+markers","line":{"width":2,"color":"#984EA3"},"marker":{"size":5,"color":"#984EA3"},"name":"Semilla 50 AUC medio: 0.6","inherit":true},"3f589cb66ec.4":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1,2,3,4,5],"y":[5,5,5,5,5],"z":[0.46250000000000002,0.58079268292682928,0.59876543209876543,0.6634146341463415,0.75609756097560976],"type":"scatter3d","mode":"lines+markers","line":{"width":2,"color":"#FF7F00"},"marker":{"size":5,"color":"#FF7F00"},"name":"Semilla 90 AUC medio: 0.612","inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"scene":{"xaxis":{"title":"Fold"},"yaxis":{"title":"Semilla"},"zaxis":{"title":"AUC"},"title":"Visualización 3D de Folds, Semillas y AUC"},"hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":[1,2,3,4,5],"y":[1,1,1,1,1],"z":[0.61859756097560981,0.56578947368421051,0.75648148148148142,0.65426829268292686,0.6722560975609756],"type":"scatter3d","mode":"lines+markers","line":{"color":"#E41A1C","width":2},"marker":{"color":"#E41A1C","size":5,"line":{"color":"rgba(31,119,180,1)"}},"name":"Semilla 27 AUC medio: 0.617","error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"frame":null},{"x":[1,2,3,4,5],"y":[2,2,2,2,2],"z":[0.67592592592592593,0.66720154043645696,0.61310975609756102,0.53475609756097564,0.68414634146341469],"type":"scatter3d","mode":"lines+markers","line":{"color":"#377EB8","width":2},"marker":{"color":"#377EB8","size":5,"line":{"color":"rgba(255,127,14,1)"}},"name":"Semilla 3 AUC medio: 0.653","error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"frame":null},{"x":[1,2,3,4,5],"y":[3,3,3,3,3],"z":[0.61403508771929827,0.56432926829268293,0.66219512195121955,0.56128048780487805,0.68384146341463414],"type":"scatter3d","mode":"lines+markers","line":{"color":"#4DAF4A","width":2},"marker":{"color":"#4DAF4A","size":5,"line":{"color":"rgba(44,160,44,1)"}},"name":"Semilla 123 AUC medio: 0.635","error_y":{"color":"rgba(44,160,44,1)"},"error_x":{"color":"rgba(44,160,44,1)"},"frame":null},{"x":[1,2,3,4,5],"y":[4,4,4,4,4],"z":[0.66097560975609759,0.54645873944119561,0.58689024390243905,0.72225609756097564,0.48109756097560974],"type":"scatter3d","mode":"lines+markers","line":{"color":"#984EA3","width":2},"marker":{"color":"#984EA3","size":5,"line":{"color":"rgba(214,39,40,1)"}},"name":"Semilla 50 AUC medio: 0.6","error_y":{"color":"rgba(214,39,40,1)"},"error_x":{"color":"rgba(214,39,40,1)"},"frame":null},{"x":[1,2,3,4,5],"y":[5,5,5,5,5],"z":[0.46250000000000002,0.58079268292682928,0.59876543209876543,0.6634146341463415,0.75609756097560976],"type":"scatter3d","mode":"lines+markers","line":{"color":"#FF7F00","width":2},"marker":{"color":"#FF7F00","size":5,"line":{"color":"rgba(148,103,189,1)"}},"name":"Semilla 90 AUC medio: 0.612","error_y":{"color":"rgba(148,103,189,1)"},"error_x":{"color":"rgba(148,103,189,1)"},"frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</div>
<div id="tabset-21-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-21-3-tab">
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb166"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb166-1"><a href="#cb166-1" aria-hidden="true" tabindex="-1"></a><span class="fu">generate_auc_per_seed_and_fold</span>(SVM_StepAUC_Metrics<span class="sc">$</span>performance_metrics)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-54f4c4ad8d568d233a2c" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-54f4c4ad8d568d233a2c">{"x":{"visdat":{"3f58252d19c3":["function () ","plotlyVisDat"]},"cur_data":"3f58252d19c3","attrs":{"3f58252d19c3":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1,2,3,4,5],"y":[1,1,1,1,1],"z":[0.52256097560975601,0.51347881899871595,0.67469135802469105,0.70304878048780495,0.68536585365853697],"type":"scatter3d","mode":"lines+markers","line":{"width":2,"color":"#E41A1C"},"marker":{"size":5,"color":"#E41A1C"},"name":"Semilla 27 AUC medio: 0.608","inherit":true},"3f58252d19c3.1":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1,2,3,4,5],"y":[2,2,2,2,2],"z":[0.65833333333333299,0.52182284980744498,0.65792682926829305,0.69207317073170704,0.66006097560975596],"type":"scatter3d","mode":"lines+markers","line":{"width":2,"color":"#377EB8"},"marker":{"size":5,"color":"#377EB8"},"name":"Semilla 3 AUC medio: 0.62","inherit":true},"3f58252d19c3.2":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1,2,3,4,5],"y":[3,3,3,3,3],"z":[0.61078622482131295,0.59512195121951195,0.59634146341463401,0.55487804878048796,0.684756097560976],"type":"scatter3d","mode":"lines+markers","line":{"width":2,"color":"#4DAF4A"},"marker":{"size":5,"color":"#4DAF4A"},"name":"Semilla 123 AUC medio: 0.638","inherit":true},"3f58252d19c3.3":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1,2,3,4,5],"y":[4,4,4,4,4],"z":[0.51890243902439004,0.73001949317738801,0.65975609756097597,0.52073170731707297,0.54085365853658496],"type":"scatter3d","mode":"lines+markers","line":{"width":2,"color":"#984EA3"},"marker":{"size":5,"color":"#984EA3"},"name":"Semilla 50 AUC medio: 0.594","inherit":true},"3f58252d19c3.4":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1,2,3,4,5],"y":[5,5,5,5,5],"z":[0.58292682926829298,0.62865853658536597,0.61296296296296304,0.66219512195121999,0.65853658536585402],"type":"scatter3d","mode":"lines+markers","line":{"width":2,"color":"#FF7F00"},"marker":{"size":5,"color":"#FF7F00"},"name":"Semilla 90 AUC medio: 0.629","inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"scene":{"xaxis":{"title":"Fold"},"yaxis":{"title":"Semilla"},"zaxis":{"title":"AUC"},"title":"Visualización 3D de Folds, Semillas y AUC"},"hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":[1,2,3,4,5],"y":[1,1,1,1,1],"z":[0.52256097560975601,0.51347881899871595,0.67469135802469105,0.70304878048780495,0.68536585365853697],"type":"scatter3d","mode":"lines+markers","line":{"color":"#E41A1C","width":2},"marker":{"color":"#E41A1C","size":5,"line":{"color":"rgba(31,119,180,1)"}},"name":"Semilla 27 AUC medio: 0.608","error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"frame":null},{"x":[1,2,3,4,5],"y":[2,2,2,2,2],"z":[0.65833333333333299,0.52182284980744498,0.65792682926829305,0.69207317073170704,0.66006097560975596],"type":"scatter3d","mode":"lines+markers","line":{"color":"#377EB8","width":2},"marker":{"color":"#377EB8","size":5,"line":{"color":"rgba(255,127,14,1)"}},"name":"Semilla 3 AUC medio: 0.62","error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"frame":null},{"x":[1,2,3,4,5],"y":[3,3,3,3,3],"z":[0.61078622482131295,0.59512195121951195,0.59634146341463401,0.55487804878048796,0.684756097560976],"type":"scatter3d","mode":"lines+markers","line":{"color":"#4DAF4A","width":2},"marker":{"color":"#4DAF4A","size":5,"line":{"color":"rgba(44,160,44,1)"}},"name":"Semilla 123 AUC medio: 0.638","error_y":{"color":"rgba(44,160,44,1)"},"error_x":{"color":"rgba(44,160,44,1)"},"frame":null},{"x":[1,2,3,4,5],"y":[4,4,4,4,4],"z":[0.51890243902439004,0.73001949317738801,0.65975609756097597,0.52073170731707297,0.54085365853658496],"type":"scatter3d","mode":"lines+markers","line":{"color":"#984EA3","width":2},"marker":{"color":"#984EA3","size":5,"line":{"color":"rgba(214,39,40,1)"}},"name":"Semilla 50 AUC medio: 0.594","error_y":{"color":"rgba(214,39,40,1)"},"error_x":{"color":"rgba(214,39,40,1)"},"frame":null},{"x":[1,2,3,4,5],"y":[5,5,5,5,5],"z":[0.58292682926829298,0.62865853658536597,0.61296296296296304,0.66219512195121999,0.65853658536585402],"type":"scatter3d","mode":"lines+markers","line":{"color":"#FF7F00","width":2},"marker":{"color":"#FF7F00","size":5,"line":{"color":"rgba(148,103,189,1)"}},"name":"Semilla 90 AUC medio: 0.629","error_y":{"color":"rgba(148,103,189,1)"},"error_x":{"color":"rgba(148,103,189,1)"},"frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</div>
<div id="tabset-21-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-21-4-tab">
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb167"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb167-1"><a href="#cb167-1" aria-hidden="true" tabindex="-1"></a><span class="fu">generate_auc_per_seed_and_fold</span>(SVM_Lasso_Metrics<span class="sc">$</span>performance_metrics)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-6fdf84d234e321d9d353" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-6fdf84d234e321d9d353">{"x":{"visdat":{"3f5847d11efd":["function () ","plotlyVisDat"]},"cur_data":"3f5847d11efd","attrs":{"3f5847d11efd":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1,2,3,4,5],"y":[1,1,1,1,1],"z":[0.60701219512195104,0.57028241335044905,0.70308641975308594,0.64725609756097602,0.74786585365853697],"type":"scatter3d","mode":"lines+markers","line":{"width":2,"color":"#E41A1C"},"marker":{"size":5,"color":"#E41A1C"},"name":"Semilla 27 AUC medio: 0.676","inherit":true},"3f5847d11efd.1":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1,2,3,4,5],"y":[2,2,2,2,2],"z":[0.78580246913580198,0.55905006418485204,0.65396341463414598,0.63871951219512202,0.68963414634146303],"type":"scatter3d","mode":"lines+markers","line":{"width":2,"color":"#377EB8"},"marker":{"size":5,"color":"#377EB8"},"name":"Semilla 3 AUC medio: 0.655","inherit":true},"3f5847d11efd.2":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1,2,3,4,5],"y":[3,3,3,3,3],"z":[0.70142949967511403,0.73506097560975603,0.67713414634146296,0.673170731707317,0.59329268292682902],"type":"scatter3d","mode":"lines+markers","line":{"width":2,"color":"#4DAF4A"},"marker":{"size":5,"color":"#4DAF4A"},"name":"Semilla 123 AUC medio: 0.665","inherit":true},"3f5847d11efd.3":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1,2,3,4,5],"y":[4,4,4,4,4],"z":[0.508536585365854,0.59096816114359996,0.53475609756097597,0.72042682926829305,0.55274390243902405],"type":"scatter3d","mode":"lines+markers","line":{"width":2,"color":"#984EA3"},"marker":{"size":5,"color":"#984EA3"},"name":"Semilla 50 AUC medio: 0.581","inherit":true},"3f5847d11efd.4":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1,2,3,4,5],"y":[5,5,5,5,5],"z":[0.67926829268292699,0.61707317073170698,0.72469135802469098,0.51676829268292701,0.563222079589217],"type":"scatter3d","mode":"lines+markers","line":{"width":2,"color":"#FF7F00"},"marker":{"size":5,"color":"#FF7F00"},"name":"Semilla 90 AUC medio: 0.62","inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"scene":{"xaxis":{"title":"Fold"},"yaxis":{"title":"Semilla"},"zaxis":{"title":"AUC"},"title":"Visualización 3D de Folds, Semillas y AUC"},"hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":[1,2,3,4,5],"y":[1,1,1,1,1],"z":[0.60701219512195104,0.57028241335044905,0.70308641975308594,0.64725609756097602,0.74786585365853697],"type":"scatter3d","mode":"lines+markers","line":{"color":"#E41A1C","width":2},"marker":{"color":"#E41A1C","size":5,"line":{"color":"rgba(31,119,180,1)"}},"name":"Semilla 27 AUC medio: 0.676","error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"frame":null},{"x":[1,2,3,4,5],"y":[2,2,2,2,2],"z":[0.78580246913580198,0.55905006418485204,0.65396341463414598,0.63871951219512202,0.68963414634146303],"type":"scatter3d","mode":"lines+markers","line":{"color":"#377EB8","width":2},"marker":{"color":"#377EB8","size":5,"line":{"color":"rgba(255,127,14,1)"}},"name":"Semilla 3 AUC medio: 0.655","error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"frame":null},{"x":[1,2,3,4,5],"y":[3,3,3,3,3],"z":[0.70142949967511403,0.73506097560975603,0.67713414634146296,0.673170731707317,0.59329268292682902],"type":"scatter3d","mode":"lines+markers","line":{"color":"#4DAF4A","width":2},"marker":{"color":"#4DAF4A","size":5,"line":{"color":"rgba(44,160,44,1)"}},"name":"Semilla 123 AUC medio: 0.665","error_y":{"color":"rgba(44,160,44,1)"},"error_x":{"color":"rgba(44,160,44,1)"},"frame":null},{"x":[1,2,3,4,5],"y":[4,4,4,4,4],"z":[0.508536585365854,0.59096816114359996,0.53475609756097597,0.72042682926829305,0.55274390243902405],"type":"scatter3d","mode":"lines+markers","line":{"color":"#984EA3","width":2},"marker":{"color":"#984EA3","size":5,"line":{"color":"rgba(214,39,40,1)"}},"name":"Semilla 50 AUC medio: 0.581","error_y":{"color":"rgba(214,39,40,1)"},"error_x":{"color":"rgba(214,39,40,1)"},"frame":null},{"x":[1,2,3,4,5],"y":[5,5,5,5,5],"z":[0.67926829268292699,0.61707317073170698,0.72469135802469098,0.51676829268292701,0.563222079589217],"type":"scatter3d","mode":"lines+markers","line":{"color":"#FF7F00","width":2},"marker":{"color":"#FF7F00","size":5,"line":{"color":"rgba(148,103,189,1)"}},"name":"Semilla 90 AUC medio: 0.62","error_y":{"color":"rgba(148,103,189,1)"},"error_x":{"color":"rgba(148,103,189,1)"},"frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="ann" class="level3" data-number="4.2.7">
<h3 data-number="4.2.7" class="anchored" data-anchor-id="ann"><span class="header-section-number">4.2.7</span> ANN</h3>
<section id="auc-fold-interno-vs-externo-6" class="level4" data-number="4.2.7.1">
<h4 data-number="4.2.7.1" class="anchored" data-anchor-id="auc-fold-interno-vs-externo-6"><span class="header-section-number">4.2.7.1</span> AUC Fold Interno vs Externo</h4>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-22-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-22-1" role="tab" aria-controls="tabset-22-1" aria-selected="true" href="">TodasVariables</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-22-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-22-2" role="tab" aria-controls="tabset-22-2" aria-selected="false" href="">Asociacion</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-22-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-22-3" role="tab" aria-controls="tabset-22-3" aria-selected="false" href="">StepAUC</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-22-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-22-4" role="tab" aria-controls="tabset-22-4" aria-selected="false" href="">Lasso</a></li></ul>
<div class="tab-content">
<div id="tabset-22-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-22-1-tab">
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb168"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb168-1"><a href="#cb168-1" aria-hidden="true" tabindex="-1"></a><span class="fu">generate_inner_outer_auc_comparison</span>(ANN_TodasVariables_Metrics<span class="sc">$</span>inner_fold_metrics, ANN_TodasVariables_Metrics<span class="sc">$</span>performance_metrics)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-42eaafa4f984c525f50f" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-42eaafa4f984c525f50f">{"x":{"visdat":{"3f585d081178":["function () ","plotlyVisDat"]},"cur_data":"3f585d081178","attrs":{"3f585d081178":{"x":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"y":{},"type":"bar","name":"AUC Medio Inner Folds","marker":{"color":"blue"},"inherit":true},"3f585d081178.1":{"x":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"y":{},"type":"bar","name":"AUC Medio Outer Folds","marker":{"color":"red"},"inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"Comparación de AUC Medio: Inner Folds vs Outer Folds","xaxis":{"domain":[0,1],"automargin":true,"title":"Fold"},"yaxis":{"domain":[0,1],"automargin":true,"title":"AUC Medio","range":[0,1]},"barmode":"group","hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":[1,2,3,4,5],"y":[0.77058282822292623,0.77252686214722899,0.77221274208905677,0.77953956911273259,0.77361869405842498],"type":"bar","name":"AUC Medio Inner Folds","marker":{"color":"blue","line":{"color":"rgba(31,119,180,1)"}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[1,2,3,4,5],"y":[0.76545475042315281,0.75113061503012235,0.76036999443972342,0.71743999724216045,0.73363994480163686],"type":"bar","name":"AUC Medio Outer Folds","marker":{"color":"red","line":{"color":"rgba(255,127,14,1)"}},"error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</div>
<div id="tabset-22-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-22-2-tab">
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb169"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb169-1"><a href="#cb169-1" aria-hidden="true" tabindex="-1"></a><span class="fu">generate_inner_outer_auc_comparison</span>(ANN_Asociacion_Metrics<span class="sc">$</span>inner_fold_metrics, ANN_Asociacion_Metrics<span class="sc">$</span>performance_metrics)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-b81e2cb2d739402327e8" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-b81e2cb2d739402327e8">{"x":{"visdat":{"3f5831af686b":["function () ","plotlyVisDat"]},"cur_data":"3f5831af686b","attrs":{"3f5831af686b":{"x":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"y":{},"type":"bar","name":"AUC Medio Inner Folds","marker":{"color":"blue"},"inherit":true},"3f5831af686b.1":{"x":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"y":{},"type":"bar","name":"AUC Medio Outer Folds","marker":{"color":"red"},"inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"Comparación de AUC Medio: Inner Folds vs Outer Folds","xaxis":{"domain":[0,1],"automargin":true,"title":"Fold"},"yaxis":{"domain":[0,1],"automargin":true,"title":"AUC Medio","range":[0,1]},"barmode":"group","hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":[1,2,3,4,5],"y":[0.75397317516487883,0.7518055268549263,0.75548821732173688,0.76586805009248926,0.75474348959567783],"type":"bar","name":"AUC Medio Inner Folds","marker":{"color":"blue","line":{"color":"rgba(31,119,180,1)"}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[1,2,3,4,5],"y":[0.75975554358011388,0.74480085690862274,0.75822453898534847,0.72747164378678619,0.74131137123816726],"type":"bar","name":"AUC Medio Outer Folds","marker":{"color":"red","line":{"color":"rgba(255,127,14,1)"}},"error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</div>
<div id="tabset-22-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-22-3-tab">
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb170"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb170-1"><a href="#cb170-1" aria-hidden="true" tabindex="-1"></a><span class="fu">generate_inner_outer_auc_comparison</span>(ANN_StepAUC_Metrics<span class="sc">$</span>inner_fold_metrics, ANN_StepAUC_Metrics<span class="sc">$</span>performance_metrics)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-d3d03fe17b64645cf50a" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-d3d03fe17b64645cf50a">{"x":{"visdat":{"3f5840417ef":["function () ","plotlyVisDat"]},"cur_data":"3f5840417ef","attrs":{"3f5840417ef":{"x":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"y":{},"type":"bar","name":"AUC Medio Inner Folds","marker":{"color":"blue"},"inherit":true},"3f5840417ef.1":{"x":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"y":{},"type":"bar","name":"AUC Medio Outer Folds","marker":{"color":"red"},"inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"Comparación de AUC Medio: Inner Folds vs Outer Folds","xaxis":{"domain":[0,1],"automargin":true,"title":"Fold"},"yaxis":{"domain":[0,1],"automargin":true,"title":"AUC Medio","range":[0,1]},"barmode":"group","hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":[1,2,3,4,5],"y":[0.76682940173539405,0.75493413082315242,0.7704008757244839,0.78616243904583527,0.77331899348215993],"type":"bar","name":"AUC Medio Inner Folds","marker":{"color":"blue","line":{"color":"rgba(31,119,180,1)"}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[1,2,3,4,5],"y":[0.74687574769349296,0.72288064196103985,0.73796924141296161,0.70339517040314659,0.72855267858374717],"type":"bar","name":"AUC Medio Outer Folds","marker":{"color":"red","line":{"color":"rgba(255,127,14,1)"}},"error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</div>
<div id="tabset-22-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-22-4-tab">
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb171"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb171-1"><a href="#cb171-1" aria-hidden="true" tabindex="-1"></a><span class="fu">generate_inner_outer_auc_comparison</span>(ANN_Lasso_Metrics<span class="sc">$</span>inner_fold_metrics, ANN_Lasso_Metrics<span class="sc">$</span>performance_metrics)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-f6b9d41910a9e5f102c7" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-f6b9d41910a9e5f102c7">{"x":{"visdat":{"3f5845b81abe":["function () ","plotlyVisDat"]},"cur_data":"3f5845b81abe","attrs":{"3f5845b81abe":{"x":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"y":{},"type":"bar","name":"AUC Medio Inner Folds","marker":{"color":"blue"},"inherit":true},"3f5845b81abe.1":{"x":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"y":{},"type":"bar","name":"AUC Medio Outer Folds","marker":{"color":"red"},"inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"Comparación de AUC Medio: Inner Folds vs Outer Folds","xaxis":{"domain":[0,1],"automargin":true,"title":"Fold"},"yaxis":{"domain":[0,1],"automargin":true,"title":"AUC Medio","range":[0,1]},"barmode":"group","hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":[1,2,3,4,5],"y":[0.76289541644387726,0.77786908485979367,0.77585141189799756,0.77659056881825117,0.76889045682072943],"type":"bar","name":"AUC Medio Inner Folds","marker":{"color":"blue","line":{"color":"rgba(31,119,180,1)"}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[1,2,3,4,5],"y":[0.76454615236465584,0.76705813707119463,0.73330507531928546,0.73288644140775461,0.74092460998670295],"type":"bar","name":"AUC Medio Outer Folds","marker":{"color":"red","line":{"color":"rgba(255,127,14,1)"}},"error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</div>
</div>
</div>
<p>Todas las gráficas muestran que <strong>en ningún momento el AUC del outer fold supera al del inner fold, lo que indica que no ha habido errores en la división de datos, confirmando la correcta implementación de la validación cruzada</strong>. En general, el AUC medio de los inner folds es consistentemente mayor o igual al de los outer folds a través de todos los folds, sugiriendo que el modelo generaliza adecuadamente sin sobreajustarse a los datos de entrenamiento. La similitud en los AUC medios entre los inner y outer folds en la mayoría de los casos refleja una buena estabilidad y consistencia en el rendimiento de las redes neuronales, con algunas diferencias observadas que son esperadas y muestran la variabilidad en el rendimiento del modelo dependiendo de la partición de los datos.</p>
</section>
<section id="auc-medio-folds-externos-6" class="level4" data-number="4.2.7.2">
<h4 data-number="4.2.7.2" class="anchored" data-anchor-id="auc-medio-folds-externos-6"><span class="header-section-number">4.2.7.2</span> AUC Medio Folds Externos</h4>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-23-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-23-1" role="tab" aria-controls="tabset-23-1" aria-selected="true" href="">TodasVariables</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-23-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-23-2" role="tab" aria-controls="tabset-23-2" aria-selected="false" href="">Asociacion</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-23-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-23-3" role="tab" aria-controls="tabset-23-3" aria-selected="false" href="">StepAUC</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-23-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-23-4" role="tab" aria-controls="tabset-23-4" aria-selected="false" href="">Lasso</a></li></ul>
<div class="tab-content">
<div id="tabset-23-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-23-1-tab">
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb172"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb172-1"><a href="#cb172-1" aria-hidden="true" tabindex="-1"></a><span class="fu">generate_outer_auc_violin_plot</span>(ANN_TodasVariables_Metrics<span class="sc">$</span>performance_metrics)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-c636a32a0e131c598efb" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-c636a32a0e131c598efb">{"x":{"visdat":{"3f584445493a":["function () ","plotlyVisDat"]},"cur_data":"3f584445493a","attrs":{"3f584445493a":{"y":{},"x":{},"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","color":{},"colors":["#E41A1C","#377EB8","#4DAF4A","#984EA3","#FF7F00"],"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"violin"}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"Distribución del AUC por Outer Fold","xaxis":{"domain":[0,1],"automargin":true,"title":"Fold","type":"category","categoryorder":"array","categoryarray":["1","2","3","4","5"]},"yaxis":{"domain":[0,1],"automargin":true,"title":"AUC"},"hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"fillcolor":"rgba(228,26,28,0.5)","y":[0.75714285714285712,0.84147286821705425,0.72261904761904761,0.72240802675585281,0.78363095238095237],"x":["1","1","1","1","1"],"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","type":"violin","name":"1","marker":{"color":"rgba(228,26,28,1)","line":{"color":"rgba(228,26,28,1)"}},"line":{"color":"rgba(228,26,28,1)"},"xaxis":"x","yaxis":"y","frame":null},{"fillcolor":"rgba(55,126,184,0.5)","y":[0.78604497354497349,0.71684094661529996,0.71349480968858126,0.7904411764705882,0.74883116883116885],"x":["2","2","2","2","2"],"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","type":"violin","name":"2","marker":{"color":"rgba(55,126,184,1)","line":{"color":"rgba(55,126,184,1)"}},"line":{"color":"rgba(55,126,184,1)"},"xaxis":"x","yaxis":"y","frame":null},{"fillcolor":"rgba(77,175,74,0.5)","y":[0.71323529411764708,0.70512820512820507,0.77614520311149526,0.79067460317460314,0.81666666666666665],"x":["3","3","3","3","3"],"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","type":"violin","name":"3","marker":{"color":"rgba(77,175,74,1)","line":{"color":"rgba(77,175,74,1)"}},"line":{"color":"rgba(77,175,74,1)"},"xaxis":"x","yaxis":"y","frame":null},{"fillcolor":"rgba(152,78,163,0.5)","y":[0.75013758943313158,0.76213235294117643,0.74711168164313224,0.69289772727272725,0.63492063492063489],"x":["4","4","4","4","4"],"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","type":"violin","name":"4","marker":{"color":"rgba(152,78,163,1)","line":{"color":"rgba(152,78,163,1)"}},"line":{"color":"rgba(152,78,163,1)"},"xaxis":"x","yaxis":"y","frame":null},{"fillcolor":"rgba(255,127,0,0.5)","y":[0.66255144032921809,0.71340388007054667,0.78767123287671237,0.68902439024390238,0.81554878048780488],"x":["5","5","5","5","5"],"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","type":"violin","name":"5","marker":{"color":"rgba(255,127,0,1)","line":{"color":"rgba(255,127,0,1)"}},"line":{"color":"rgba(255,127,0,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</div>
<div id="tabset-23-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-23-2-tab">
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb173"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb173-1"><a href="#cb173-1" aria-hidden="true" tabindex="-1"></a><span class="fu">generate_outer_auc_violin_plot</span>(ANN_Asociacion_Metrics<span class="sc">$</span>performance_metrics)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-e9a2e8f785f1b1f2527d" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-e9a2e8f785f1b1f2527d">{"x":{"visdat":{"3f582b8121b1":["function () ","plotlyVisDat"]},"cur_data":"3f582b8121b1","attrs":{"3f582b8121b1":{"y":{},"x":{},"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","color":{},"colors":["#E41A1C","#377EB8","#4DAF4A","#984EA3","#FF7F00"],"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"violin"}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"Distribución del AUC por Outer Fold","xaxis":{"domain":[0,1],"automargin":true,"title":"Fold","type":"category","categoryorder":"array","categoryarray":["1","2","3","4","5"]},"yaxis":{"domain":[0,1],"automargin":true,"title":"AUC"},"hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"fillcolor":"rgba(228,26,28,0.5)","y":[0.73363095238095233,0.81279069767441858,0.72976190476190472,0.77229654403567449,0.75029761904761905],"x":["1","1","1","1","1"],"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","type":"violin","name":"1","marker":{"color":"rgba(228,26,28,1)","line":{"color":"rgba(228,26,28,1)"}},"line":{"color":"rgba(228,26,28,1)"},"xaxis":"x","yaxis":"y","frame":null},{"fillcolor":"rgba(55,126,184,0.5)","y":[0.78141534391534395,0.74848651623555307,0.65986159169550174,0.77683823529411766,0.75740259740259741],"x":["2","2","2","2","2"],"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","type":"violin","name":"2","marker":{"color":"rgba(55,126,184,1)","line":{"color":"rgba(55,126,184,1)"}},"line":{"color":"rgba(55,126,184,1)"},"xaxis":"x","yaxis":"y","frame":null},{"fillcolor":"rgba(77,175,74,0.5)","y":[0.74191176470588238,0.71153846153846156,0.75496974935177186,0.77843915343915349,0.80426356589147285],"x":["3","3","3","3","3"],"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","type":"violin","name":"3","marker":{"color":"rgba(77,175,74,1)","line":{"color":"rgba(77,175,74,1)"}},"line":{"color":"rgba(77,175,74,1)"},"xaxis":"x","yaxis":"y","frame":null},{"fillcolor":"rgba(152,78,163,0.5)","y":[0.75591634562465604,0.77022058823529416,0.77118100128369704,0.68693181818181814,0.65310846560846558],"x":["4","4","4","4","4"],"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","type":"violin","name":"4","marker":{"color":"rgba(152,78,163,1)","line":{"color":"rgba(152,78,163,1)"}},"line":{"color":"rgba(152,78,163,1)"},"xaxis":"x","yaxis":"y","frame":null},{"fillcolor":"rgba(255,127,0,0.5)","y":[0.63609641387419158,0.76043503821281599,0.77161076995748701,0.71981707317073174,0.81859756097560976],"x":["5","5","5","5","5"],"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","type":"violin","name":"5","marker":{"color":"rgba(255,127,0,1)","line":{"color":"rgba(255,127,0,1)"}},"line":{"color":"rgba(255,127,0,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</div>
<div id="tabset-23-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-23-3-tab">
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb174"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb174-1"><a href="#cb174-1" aria-hidden="true" tabindex="-1"></a><span class="fu">generate_outer_auc_violin_plot</span>(ANN_StepAUC_Metrics<span class="sc">$</span>performance_metrics)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-34d7cd68b3123e4885fd" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-34d7cd68b3123e4885fd">{"x":{"visdat":{"3f58167365df":["function () ","plotlyVisDat"]},"cur_data":"3f58167365df","attrs":{"3f58167365df":{"y":{},"x":{},"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","color":{},"colors":["#E41A1C","#377EB8","#4DAF4A","#984EA3","#FF7F00"],"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"violin"}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"Distribución del AUC por Outer Fold","xaxis":{"domain":[0,1],"automargin":true,"title":"Fold","type":"category","categoryorder":"array","categoryarray":["1","2","3","4","5"]},"yaxis":{"domain":[0,1],"automargin":true,"title":"AUC"},"hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"fillcolor":"rgba(228,26,28,0.5)","y":[0.71726190476190499,0.79534883720930205,0.72916666666666696,0.76254180602006705,0.73005952380952399],"x":["1","1","1","1","1"],"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","type":"violin","name":"1","marker":{"color":"rgba(228,26,28,1)","line":{"color":"rgba(228,26,28,1)"}},"line":{"color":"rgba(228,26,28,1)"},"xaxis":"x","yaxis":"y","frame":null},{"fillcolor":"rgba(55,126,184,0.5)","y":[0.79794973544973502,0.75206384149697303,0.64394463667820101,0.73602941176470604,0.68441558441558403],"x":["2","2","2","2","2"],"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","type":"violin","name":"2","marker":{"color":"rgba(55,126,184,1)","line":{"color":"rgba(55,126,184,1)"}},"line":{"color":"rgba(55,126,184,1)"},"xaxis":"x","yaxis":"y","frame":null},{"fillcolor":"rgba(77,175,74,0.5)","y":[0.723161764705882,0.66639957264957295,0.72687986171132202,0.75363756613756605,0.81976744186046502],"x":["3","3","3","3","3"],"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","type":"violin","name":"3","marker":{"color":"rgba(77,175,74,1)","line":{"color":"rgba(77,175,74,1)"}},"line":{"color":"rgba(77,175,74,1)"},"xaxis":"x","yaxis":"y","frame":null},{"fillcolor":"rgba(152,78,163,0.5)","y":[0.75288937809576195,0.811029411764706,0.73587933247753501,0.62954545454545496,0.58763227513227501],"x":["4","4","4","4","4"],"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","type":"violin","name":"4","marker":{"color":"rgba(152,78,163,1)","line":{"color":"rgba(152,78,163,1)"}},"line":{"color":"rgba(152,78,163,1)"},"xaxis":"x","yaxis":"y","frame":null},{"fillcolor":"rgba(255,127,0,0.5)","y":[0.64050558495002896,0.72545561434450301,0.76948512045347195,0.71951219512195097,0.78780487804878097],"x":["5","5","5","5","5"],"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","type":"violin","name":"5","marker":{"color":"rgba(255,127,0,1)","line":{"color":"rgba(255,127,0,1)"}},"line":{"color":"rgba(255,127,0,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</div>
<div id="tabset-23-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-23-4-tab">
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb175"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb175-1"><a href="#cb175-1" aria-hidden="true" tabindex="-1"></a><span class="fu">generate_outer_auc_violin_plot</span>(ANN_Lasso_Metrics<span class="sc">$</span>performance_metrics)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-d671bfc4d6ad189dd75a" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-d671bfc4d6ad189dd75a">{"x":{"visdat":{"3f58226631b4":["function () ","plotlyVisDat"]},"cur_data":"3f58226631b4","attrs":{"3f58226631b4":{"y":{},"x":{},"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","color":{},"colors":["#E41A1C","#377EB8","#4DAF4A","#984EA3","#FF7F00"],"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"violin"}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"Distribución del AUC por Outer Fold","xaxis":{"domain":[0,1],"automargin":true,"title":"Fold","type":"category","categoryorder":"array","categoryarray":["1","2","3","4","5"]},"yaxis":{"domain":[0,1],"automargin":true,"title":"AUC"},"hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"fillcolor":"rgba(228,26,28,0.5)","y":[0.74166666666666703,0.81395348837209303,0.73244047619047603,0.75222965440356704,0.78244047619047596],"x":["1","1","1","1","1"],"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","type":"violin","name":"1","marker":{"color":"rgba(228,26,28,1)","line":{"color":"rgba(228,26,28,1)"}},"line":{"color":"rgba(228,26,28,1)"},"xaxis":"x","yaxis":"y","frame":null},{"fillcolor":"rgba(55,126,184,0.5)","y":[0.84689153439153397,0.74903687396807905,0.72076124567473998,0.79080882352941195,0.72779220779220799],"x":["2","2","2","2","2"],"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","type":"violin","name":"2","marker":{"color":"rgba(55,126,184,1)","line":{"color":"rgba(55,126,184,1)"}},"line":{"color":"rgba(55,126,184,1)"},"xaxis":"x","yaxis":"y","frame":null},{"fillcolor":"rgba(77,175,74,0.5)","y":[0.73308823529411804,0.69230769230769196,0.71996542783059603,0.77116402116402105,0.75],"x":["3","3","3","3","3"],"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","type":"violin","name":"3","marker":{"color":"rgba(77,175,74,1)","line":{"color":"rgba(77,175,74,1)"}},"line":{"color":"rgba(77,175,74,1)"},"xaxis":"x","yaxis":"y","frame":null},{"fillcolor":"rgba(152,78,163,0.5)","y":[0.77050082553659904,0.80551470588235297,0.77471116816431296,0.69829545454545505,0.61541005291005302],"x":["4","4","4","4","4"],"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","type":"violin","name":"4","marker":{"color":"rgba(152,78,163,1)","line":{"color":"rgba(152,78,163,1)"}},"line":{"color":"rgba(152,78,163,1)"},"xaxis":"x","yaxis":"y","frame":null},{"fillcolor":"rgba(255,127,0,0.5)","y":[0.68489124044679595,0.75161669606114001,0.76476145488899405,0.69390243902438997,0.80945121951219501],"x":["5","5","5","5","5"],"box":{"visible":true},"meanline":{"visible":true},"points":"all","spanmode":"hard","type":"violin","name":"5","marker":{"color":"rgba(255,127,0,1)","line":{"color":"rgba(255,127,0,1)"}},"line":{"color":"rgba(255,127,0,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</div>
</div>
</div>
<p>Los gráficos de violín comparan la distribución del AUC por fold para los métodos de todas las variables, filtrado por análisis de asociación, stepAUC y embedded Lasso. En general, los métodos que usan todas las variables y el filtrado por análisis de asociación muestran distribuciones de AUC relativamente estrechas y consistentes en la mayoría de los folds, con valores centrados alrededor de 0.75 a 0.8, lo que indica un rendimiento estable. El método stepAUC muestra una variabilidad más amplia, especialmente en los folds 4 y 5, con AUC que varían desde aproximadamente 0.55 hasta 0.75, indicando una inestabilidad significativa en estos folds. Similarmente, el método embedded Lasso presenta una mayor dispersión en los folds 4 y 5, con rangos de AUC que van desde 0.6 a 0.75, sugiriendo una mayor inestabilidad y sensibilidad a las particiones de datos. En resumen, <strong>mientras que los métodos de todas las variables y el filtrado por análisis de asociación mantienen una consistencia aceptable, los métodos stepAUC y Lasso muestran mayor variabilidad y menor estabilidad en ciertos folds</strong>.</p>
</section>
<section id="comparativa-ann" class="level4" data-number="4.2.7.3">
<h4 data-number="4.2.7.3" class="anchored" data-anchor-id="comparativa-ann"><span class="header-section-number">4.2.7.3</span> Comparativa ANN</h4>
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb176"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb176-1"><a href="#cb176-1" aria-hidden="true" tabindex="-1"></a>fig <span class="ot">&lt;-</span> <span class="fu">generate_combined_auc_3d_plot</span>(</span>
<span id="cb176-2"><a href="#cb176-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(</span>
<span id="cb176-3"><a href="#cb176-3" aria-hidden="true" tabindex="-1"></a>    ANN_TodasVariables_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb176-4"><a href="#cb176-4" aria-hidden="true" tabindex="-1"></a>    ANN_Asociacion_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb176-5"><a href="#cb176-5" aria-hidden="true" tabindex="-1"></a>    ANN_StepAUC_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb176-6"><a href="#cb176-6" aria-hidden="true" tabindex="-1"></a>    ANN_Lasso_Metrics<span class="sc">$</span>performance_metrics</span>
<span id="cb176-7"><a href="#cb176-7" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb176-8"><a href="#cb176-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">"Todas Variables"</span>, <span class="st">"Asociacion"</span>, <span class="st">"StepAUC"</span>, <span class="st">"Lasso"</span>)</span>
<span id="cb176-9"><a href="#cb176-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb176-10"><a href="#cb176-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb176-11"><a href="#cb176-11" aria-hidden="true" tabindex="-1"></a>fig</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-a88d305991b597aeae4c" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-a88d305991b597aeae4c">{"x":{"visdat":{"3f58383d6f58":["function () ","plotlyVisDat"],"3f585aa349df":["function () ","data"],"3f5864c6d":["function () ","data"],"3f586b54503e":["function () ","data"],"3f5832d21494":["function () ","data"],"3f585a837004":["function () ","data"],"3f583ec31532":["function () ","data"],"3f5838914e5e":["function () ","data"],"3f5871666e74":["function () ","data"],"3f584a8a6b79":["function () ","data"],"3f581c437590":["function () ","data"],"3f58735836e8":["function () ","data"],"3f5867b3c4e":["function () ","data"],"3f583d364346":["function () ","data"],"3f5847f211c8":["function () ","data"],"3f5817675d1c":["function () ","data"],"3f584875506d":["function () ","data"],"3f581c27904":["function () ","data"],"3f58217ed4c":["function () ","data"],"3f5872e22d0f":["function () ","data"],"3f584bed1c90":["function () ","data"]},"cur_data":"3f584bed1c90","attrs":{"3f585aa349df":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines+markers","line":{"color":"#E41A1C"},"marker":{"size":5,"color":"#E41A1C"},"showlegend":true,"name":"Todas Variables - AUC medio global: 0.746","inherit":true},"3f5864c6d":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines+markers","line":{"color":"#E41A1C"},"marker":{"size":5,"color":"#E41A1C"},"showlegend":false,"name":"","inherit":true},"3f586b54503e":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines+markers","line":{"color":"#E41A1C"},"marker":{"size":5,"color":"#E41A1C"},"showlegend":false,"name":"","inherit":true},"3f5832d21494":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines+markers","line":{"color":"#E41A1C"},"marker":{"size":5,"color":"#E41A1C"},"showlegend":false,"name":"","inherit":true},"3f585a837004":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines+markers","line":{"color":"#E41A1C"},"marker":{"size":5,"color":"#E41A1C"},"showlegend":false,"name":"","inherit":true},"3f583ec31532":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines+markers","line":{"color":"#377EB8"},"marker":{"size":5,"color":"#377EB8"},"showlegend":true,"name":"Asociacion - AUC medio global: 0.746","inherit":true},"3f5838914e5e":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines+markers","line":{"color":"#377EB8"},"marker":{"size":5,"color":"#377EB8"},"showlegend":false,"name":"","inherit":true},"3f5871666e74":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines+markers","line":{"color":"#377EB8"},"marker":{"size":5,"color":"#377EB8"},"showlegend":false,"name":"","inherit":true},"3f584a8a6b79":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines+markers","line":{"color":"#377EB8"},"marker":{"size":5,"color":"#377EB8"},"showlegend":false,"name":"","inherit":true},"3f581c437590":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines+markers","line":{"color":"#377EB8"},"marker":{"size":5,"color":"#377EB8"},"showlegend":false,"name":"","inherit":true},"3f58735836e8":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines+markers","line":{"color":"#4DAF4A"},"marker":{"size":5,"color":"#4DAF4A"},"showlegend":true,"name":"StepAUC - AUC medio global: 0.728","inherit":true},"3f5867b3c4e":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines+markers","line":{"color":"#4DAF4A"},"marker":{"size":5,"color":"#4DAF4A"},"showlegend":false,"name":"","inherit":true},"3f583d364346":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines+markers","line":{"color":"#4DAF4A"},"marker":{"size":5,"color":"#4DAF4A"},"showlegend":false,"name":"","inherit":true},"3f5847f211c8":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines+markers","line":{"color":"#4DAF4A"},"marker":{"size":5,"color":"#4DAF4A"},"showlegend":false,"name":"","inherit":true},"3f5817675d1c":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines+markers","line":{"color":"#4DAF4A"},"marker":{"size":5,"color":"#4DAF4A"},"showlegend":false,"name":"","inherit":true},"3f584875506d":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines+markers","line":{"color":"#984EA3"},"marker":{"size":5,"color":"#984EA3"},"showlegend":true,"name":"Lasso - AUC medio global: 0.748","inherit":true},"3f581c27904":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines+markers","line":{"color":"#984EA3"},"marker":{"size":5,"color":"#984EA3"},"showlegend":false,"name":"","inherit":true},"3f58217ed4c":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines+markers","line":{"color":"#984EA3"},"marker":{"size":5,"color":"#984EA3"},"showlegend":false,"name":"","inherit":true},"3f5872e22d0f":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines+markers","line":{"color":"#984EA3"},"marker":{"size":5,"color":"#984EA3"},"showlegend":false,"name":"","inherit":true},"3f584bed1c90":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines+markers","line":{"color":"#984EA3"},"marker":{"size":5,"color":"#984EA3"},"showlegend":false,"name":"","inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"Comparación de AUC por Semilla y Fold para Diferentes Métodos","scene":{"xaxis":{"title":"Fold"},"yaxis":{"title":"Semilla"},"zaxis":{"title":"AUC"}},"yaxis":{"type":"category","categoryorder":"array","categoryarray":["seed_123","seed_27","seed_3","seed_50","seed_90"]},"hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":[1,2,3,4,5],"y":["seed_27","seed_27","seed_27","seed_27","seed_27"],"z":[0.75714285714285712,0.78604497354497349,0.71323529411764708,0.75013758943313158,0.66255144032921809],"type":"scatter3d","mode":"lines+markers","line":{"color":"#E41A1C"},"marker":{"color":"#E41A1C","size":5,"line":{"color":"rgba(31,119,180,1)"}},"showlegend":true,"name":"Todas Variables - AUC medio global: 0.746","error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"frame":null},{"x":[1,2,3,4,5],"y":["seed_3","seed_3","seed_3","seed_3","seed_3"],"z":[0.84147286821705425,0.71684094661529996,0.70512820512820507,0.76213235294117643,0.71340388007054667],"type":"scatter3d","mode":"lines+markers","line":{"color":"#E41A1C"},"marker":{"color":"#E41A1C","size":5,"line":{"color":"rgba(255,127,14,1)"}},"showlegend":false,"name":"","error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"frame":null},{"x":[1,2,3,4,5],"y":["seed_123","seed_123","seed_123","seed_123","seed_123"],"z":[0.72261904761904761,0.71349480968858126,0.77614520311149526,0.74711168164313224,0.78767123287671237],"type":"scatter3d","mode":"lines+markers","line":{"color":"#E41A1C"},"marker":{"color":"#E41A1C","size":5,"line":{"color":"rgba(44,160,44,1)"}},"showlegend":false,"name":"","error_y":{"color":"rgba(44,160,44,1)"},"error_x":{"color":"rgba(44,160,44,1)"},"frame":null},{"x":[1,2,3,4,5],"y":["seed_50","seed_50","seed_50","seed_50","seed_50"],"z":[0.72240802675585281,0.7904411764705882,0.79067460317460314,0.69289772727272725,0.68902439024390238],"type":"scatter3d","mode":"lines+markers","line":{"color":"#E41A1C"},"marker":{"color":"#E41A1C","size":5,"line":{"color":"rgba(214,39,40,1)"}},"showlegend":false,"name":"","error_y":{"color":"rgba(214,39,40,1)"},"error_x":{"color":"rgba(214,39,40,1)"},"frame":null},{"x":[1,2,3,4,5],"y":["seed_90","seed_90","seed_90","seed_90","seed_90"],"z":[0.78363095238095237,0.74883116883116885,0.81666666666666665,0.63492063492063489,0.81554878048780488],"type":"scatter3d","mode":"lines+markers","line":{"color":"#E41A1C"},"marker":{"color":"#E41A1C","size":5,"line":{"color":"rgba(148,103,189,1)"}},"showlegend":false,"name":"","error_y":{"color":"rgba(148,103,189,1)"},"error_x":{"color":"rgba(148,103,189,1)"},"frame":null},{"x":[1,2,3,4,5],"y":["seed_27","seed_27","seed_27","seed_27","seed_27"],"z":[0.73363095238095233,0.78141534391534395,0.74191176470588238,0.75591634562465604,0.63609641387419158],"type":"scatter3d","mode":"lines+markers","line":{"color":"#377EB8"},"marker":{"color":"#377EB8","size":5,"line":{"color":"rgba(140,86,75,1)"}},"showlegend":true,"name":"Asociacion - AUC medio global: 0.746","error_y":{"color":"rgba(140,86,75,1)"},"error_x":{"color":"rgba(140,86,75,1)"},"frame":null},{"x":[1,2,3,4,5],"y":["seed_3","seed_3","seed_3","seed_3","seed_3"],"z":[0.81279069767441858,0.74848651623555307,0.71153846153846156,0.77022058823529416,0.76043503821281599],"type":"scatter3d","mode":"lines+markers","line":{"color":"#377EB8"},"marker":{"color":"#377EB8","size":5,"line":{"color":"rgba(227,119,194,1)"}},"showlegend":false,"name":"","error_y":{"color":"rgba(227,119,194,1)"},"error_x":{"color":"rgba(227,119,194,1)"},"frame":null},{"x":[1,2,3,4,5],"y":["seed_123","seed_123","seed_123","seed_123","seed_123"],"z":[0.72976190476190472,0.65986159169550174,0.75496974935177186,0.77118100128369704,0.77161076995748701],"type":"scatter3d","mode":"lines+markers","line":{"color":"#377EB8"},"marker":{"color":"#377EB8","size":5,"line":{"color":"rgba(127,127,127,1)"}},"showlegend":false,"name":"","error_y":{"color":"rgba(127,127,127,1)"},"error_x":{"color":"rgba(127,127,127,1)"},"frame":null},{"x":[1,2,3,4,5],"y":["seed_50","seed_50","seed_50","seed_50","seed_50"],"z":[0.77229654403567449,0.77683823529411766,0.77843915343915349,0.68693181818181814,0.71981707317073174],"type":"scatter3d","mode":"lines+markers","line":{"color":"#377EB8"},"marker":{"color":"#377EB8","size":5,"line":{"color":"rgba(188,189,34,1)"}},"showlegend":false,"name":"","error_y":{"color":"rgba(188,189,34,1)"},"error_x":{"color":"rgba(188,189,34,1)"},"frame":null},{"x":[1,2,3,4,5],"y":["seed_90","seed_90","seed_90","seed_90","seed_90"],"z":[0.75029761904761905,0.75740259740259741,0.80426356589147285,0.65310846560846558,0.81859756097560976],"type":"scatter3d","mode":"lines+markers","line":{"color":"#377EB8"},"marker":{"color":"#377EB8","size":5,"line":{"color":"rgba(23,190,207,1)"}},"showlegend":false,"name":"","error_y":{"color":"rgba(23,190,207,1)"},"error_x":{"color":"rgba(23,190,207,1)"},"frame":null},{"x":[1,2,3,4,5],"y":["seed_27","seed_27","seed_27","seed_27","seed_27"],"z":[0.71726190476190499,0.79794973544973502,0.723161764705882,0.75288937809576195,0.64050558495002896],"type":"scatter3d","mode":"lines+markers","line":{"color":"#4DAF4A"},"marker":{"color":"#4DAF4A","size":5,"line":{"color":"rgba(31,119,180,1)"}},"showlegend":true,"name":"StepAUC - AUC medio global: 0.728","error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"frame":null},{"x":[1,2,3,4,5],"y":["seed_3","seed_3","seed_3","seed_3","seed_3"],"z":[0.79534883720930205,0.75206384149697303,0.66639957264957295,0.811029411764706,0.72545561434450301],"type":"scatter3d","mode":"lines+markers","line":{"color":"#4DAF4A"},"marker":{"color":"#4DAF4A","size":5,"line":{"color":"rgba(255,127,14,1)"}},"showlegend":false,"name":"","error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"frame":null},{"x":[1,2,3,4,5],"y":["seed_123","seed_123","seed_123","seed_123","seed_123"],"z":[0.72916666666666696,0.64394463667820101,0.72687986171132202,0.73587933247753501,0.76948512045347195],"type":"scatter3d","mode":"lines+markers","line":{"color":"#4DAF4A"},"marker":{"color":"#4DAF4A","size":5,"line":{"color":"rgba(44,160,44,1)"}},"showlegend":false,"name":"","error_y":{"color":"rgba(44,160,44,1)"},"error_x":{"color":"rgba(44,160,44,1)"},"frame":null},{"x":[1,2,3,4,5],"y":["seed_50","seed_50","seed_50","seed_50","seed_50"],"z":[0.76254180602006705,0.73602941176470604,0.75363756613756605,0.62954545454545496,0.71951219512195097],"type":"scatter3d","mode":"lines+markers","line":{"color":"#4DAF4A"},"marker":{"color":"#4DAF4A","size":5,"line":{"color":"rgba(214,39,40,1)"}},"showlegend":false,"name":"","error_y":{"color":"rgba(214,39,40,1)"},"error_x":{"color":"rgba(214,39,40,1)"},"frame":null},{"x":[1,2,3,4,5],"y":["seed_90","seed_90","seed_90","seed_90","seed_90"],"z":[0.73005952380952399,0.68441558441558403,0.81976744186046502,0.58763227513227501,0.78780487804878097],"type":"scatter3d","mode":"lines+markers","line":{"color":"#4DAF4A"},"marker":{"color":"#4DAF4A","size":5,"line":{"color":"rgba(148,103,189,1)"}},"showlegend":false,"name":"","error_y":{"color":"rgba(148,103,189,1)"},"error_x":{"color":"rgba(148,103,189,1)"},"frame":null},{"x":[1,2,3,4,5],"y":["seed_27","seed_27","seed_27","seed_27","seed_27"],"z":[0.74166666666666703,0.84689153439153397,0.73308823529411804,0.77050082553659904,0.68489124044679595],"type":"scatter3d","mode":"lines+markers","line":{"color":"#984EA3"},"marker":{"color":"#984EA3","size":5,"line":{"color":"rgba(140,86,75,1)"}},"showlegend":true,"name":"Lasso - AUC medio global: 0.748","error_y":{"color":"rgba(140,86,75,1)"},"error_x":{"color":"rgba(140,86,75,1)"},"frame":null},{"x":[1,2,3,4,5],"y":["seed_3","seed_3","seed_3","seed_3","seed_3"],"z":[0.81395348837209303,0.74903687396807905,0.69230769230769196,0.80551470588235297,0.75161669606114001],"type":"scatter3d","mode":"lines+markers","line":{"color":"#984EA3"},"marker":{"color":"#984EA3","size":5,"line":{"color":"rgba(227,119,194,1)"}},"showlegend":false,"name":"","error_y":{"color":"rgba(227,119,194,1)"},"error_x":{"color":"rgba(227,119,194,1)"},"frame":null},{"x":[1,2,3,4,5],"y":["seed_123","seed_123","seed_123","seed_123","seed_123"],"z":[0.73244047619047603,0.72076124567473998,0.71996542783059603,0.77471116816431296,0.76476145488899405],"type":"scatter3d","mode":"lines+markers","line":{"color":"#984EA3"},"marker":{"color":"#984EA3","size":5,"line":{"color":"rgba(127,127,127,1)"}},"showlegend":false,"name":"","error_y":{"color":"rgba(127,127,127,1)"},"error_x":{"color":"rgba(127,127,127,1)"},"frame":null},{"x":[1,2,3,4,5],"y":["seed_50","seed_50","seed_50","seed_50","seed_50"],"z":[0.75222965440356704,0.79080882352941195,0.77116402116402105,0.69829545454545505,0.69390243902438997],"type":"scatter3d","mode":"lines+markers","line":{"color":"#984EA3"},"marker":{"color":"#984EA3","size":5,"line":{"color":"rgba(188,189,34,1)"}},"showlegend":false,"name":"","error_y":{"color":"rgba(188,189,34,1)"},"error_x":{"color":"rgba(188,189,34,1)"},"frame":null},{"x":[1,2,3,4,5],"y":["seed_90","seed_90","seed_90","seed_90","seed_90"],"z":[0.78244047619047596,0.72779220779220799,0.75,0.61541005291005302,0.80945121951219501],"type":"scatter3d","mode":"lines+markers","line":{"color":"#984EA3"},"marker":{"color":"#984EA3","size":5,"line":{"color":"rgba(23,190,207,1)"}},"showlegend":false,"name":"","error_y":{"color":"rgba(23,190,207,1)"},"error_x":{"color":"rgba(23,190,207,1)"},"frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>Los gráficos 3D muestran un análisis comparativo del AUC a través de los métodos de todas las variables, filtrado por asociación, stepAUC y Lasso, destacando sus desempeños a lo largo de diferentes semillas y folds. En general, el método Lasso presenta el AUC medio global más alto (0.746), seguido por el filtrado por asociación (0.74), todas las variables (0.733) y stepAUC (0.731). El método Lasso muestra una mayor consistencia en los valores de AUC, particularmente en las semillas 27 y 90, con menos variabilidad en comparación con los otros métodos. El filtrado por asociación también demuestra una consistencia razonable, aunque con ligeras fluctuaciones. Por otro lado, los métodos de todas las variables y stepAUC muestran una mayor variabilidad, especialmente en ciertos folds y semillas, indicando inestabilidades en su rendimiento. La visualización revela que, aunque todos los métodos tienen rendimientos comparables, <strong>Lasso y filtrado por asociación parecen ofrecer una mayor estabilidad y un rendimiento ligeramente superior</strong>.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-24-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-24-1" role="tab" aria-controls="tabset-24-1" aria-selected="true" href="">TodasVariables</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-24-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-24-2" role="tab" aria-controls="tabset-24-2" aria-selected="false" href="">Asociacion</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-24-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-24-3" role="tab" aria-controls="tabset-24-3" aria-selected="false" href="">StepAUC</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-24-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-24-4" role="tab" aria-controls="tabset-24-4" aria-selected="false" href="">Lasso</a></li></ul>
<div class="tab-content">
<div id="tabset-24-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-24-1-tab">
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb177"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb177-1"><a href="#cb177-1" aria-hidden="true" tabindex="-1"></a><span class="fu">generate_auc_per_seed_and_fold</span>(ANN_TodasVariables_Metrics<span class="sc">$</span>performance_metrics)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-a0ad704cb00bda7860b4" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-a0ad704cb00bda7860b4">{"x":{"visdat":{"3f587591f46":["function () ","plotlyVisDat"]},"cur_data":"3f587591f46","attrs":{"3f587591f46":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1,2,3,4,5],"y":[1,1,1,1,1],"z":[0.75714285714285712,0.78604497354497349,0.71323529411764708,0.75013758943313158,0.66255144032921809],"type":"scatter3d","mode":"lines+markers","line":{"width":2,"color":"#E41A1C"},"marker":{"size":5,"color":"#E41A1C"},"name":"Semilla 27 AUC medio: 0.749","inherit":true},"3f587591f46.1":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1,2,3,4,5],"y":[2,2,2,2,2],"z":[0.84147286821705425,0.71684094661529996,0.70512820512820507,0.76213235294117643,0.71340388007054667],"type":"scatter3d","mode":"lines+markers","line":{"width":2,"color":"#377EB8"},"marker":{"size":5,"color":"#377EB8"},"name":"Semilla 3 AUC medio: 0.734","inherit":true},"3f587591f46.2":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1,2,3,4,5],"y":[3,3,3,3,3],"z":[0.72261904761904761,0.71349480968858126,0.77614520311149526,0.74711168164313224,0.78767123287671237],"type":"scatter3d","mode":"lines+markers","line":{"width":2,"color":"#4DAF4A"},"marker":{"size":5,"color":"#4DAF4A"},"name":"Semilla 123 AUC medio: 0.748","inherit":true},"3f587591f46.3":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1,2,3,4,5],"y":[4,4,4,4,4],"z":[0.72240802675585281,0.7904411764705882,0.79067460317460314,0.69289772727272725,0.68902439024390238],"type":"scatter3d","mode":"lines+markers","line":{"width":2,"color":"#984EA3"},"marker":{"size":5,"color":"#984EA3"},"name":"Semilla 50 AUC medio: 0.737","inherit":true},"3f587591f46.4":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1,2,3,4,5],"y":[5,5,5,5,5],"z":[0.78363095238095237,0.74883116883116885,0.81666666666666665,0.63492063492063489,0.81554878048780488],"type":"scatter3d","mode":"lines+markers","line":{"width":2,"color":"#FF7F00"},"marker":{"size":5,"color":"#FF7F00"},"name":"Semilla 90 AUC medio: 0.76","inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"scene":{"xaxis":{"title":"Fold"},"yaxis":{"title":"Semilla"},"zaxis":{"title":"AUC"},"title":"Visualización 3D de Folds, Semillas y AUC"},"hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":[1,2,3,4,5],"y":[1,1,1,1,1],"z":[0.75714285714285712,0.78604497354497349,0.71323529411764708,0.75013758943313158,0.66255144032921809],"type":"scatter3d","mode":"lines+markers","line":{"color":"#E41A1C","width":2},"marker":{"color":"#E41A1C","size":5,"line":{"color":"rgba(31,119,180,1)"}},"name":"Semilla 27 AUC medio: 0.749","error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"frame":null},{"x":[1,2,3,4,5],"y":[2,2,2,2,2],"z":[0.84147286821705425,0.71684094661529996,0.70512820512820507,0.76213235294117643,0.71340388007054667],"type":"scatter3d","mode":"lines+markers","line":{"color":"#377EB8","width":2},"marker":{"color":"#377EB8","size":5,"line":{"color":"rgba(255,127,14,1)"}},"name":"Semilla 3 AUC medio: 0.734","error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"frame":null},{"x":[1,2,3,4,5],"y":[3,3,3,3,3],"z":[0.72261904761904761,0.71349480968858126,0.77614520311149526,0.74711168164313224,0.78767123287671237],"type":"scatter3d","mode":"lines+markers","line":{"color":"#4DAF4A","width":2},"marker":{"color":"#4DAF4A","size":5,"line":{"color":"rgba(44,160,44,1)"}},"name":"Semilla 123 AUC medio: 0.748","error_y":{"color":"rgba(44,160,44,1)"},"error_x":{"color":"rgba(44,160,44,1)"},"frame":null},{"x":[1,2,3,4,5],"y":[4,4,4,4,4],"z":[0.72240802675585281,0.7904411764705882,0.79067460317460314,0.69289772727272725,0.68902439024390238],"type":"scatter3d","mode":"lines+markers","line":{"color":"#984EA3","width":2},"marker":{"color":"#984EA3","size":5,"line":{"color":"rgba(214,39,40,1)"}},"name":"Semilla 50 AUC medio: 0.737","error_y":{"color":"rgba(214,39,40,1)"},"error_x":{"color":"rgba(214,39,40,1)"},"frame":null},{"x":[1,2,3,4,5],"y":[5,5,5,5,5],"z":[0.78363095238095237,0.74883116883116885,0.81666666666666665,0.63492063492063489,0.81554878048780488],"type":"scatter3d","mode":"lines+markers","line":{"color":"#FF7F00","width":2},"marker":{"color":"#FF7F00","size":5,"line":{"color":"rgba(148,103,189,1)"}},"name":"Semilla 90 AUC medio: 0.76","error_y":{"color":"rgba(148,103,189,1)"},"error_x":{"color":"rgba(148,103,189,1)"},"frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</div>
<div id="tabset-24-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-24-2-tab">
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb178"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb178-1"><a href="#cb178-1" aria-hidden="true" tabindex="-1"></a><span class="fu">generate_auc_per_seed_and_fold</span>(ANN_Asociacion_Metrics<span class="sc">$</span>performance_metrics)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-4f7de961419dffa21a83" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-4f7de961419dffa21a83">{"x":{"visdat":{"3f5865f4e67":["function () ","plotlyVisDat"]},"cur_data":"3f5865f4e67","attrs":{"3f5865f4e67":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1,2,3,4,5],"y":[1,1,1,1,1],"z":[0.73363095238095233,0.78141534391534395,0.74191176470588238,0.75591634562465604,0.63609641387419158],"type":"scatter3d","mode":"lines+markers","line":{"width":2,"color":"#E41A1C"},"marker":{"size":5,"color":"#E41A1C"},"name":"Semilla 27 AUC medio: 0.737","inherit":true},"3f5865f4e67.1":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1,2,3,4,5],"y":[2,2,2,2,2],"z":[0.81279069767441858,0.74848651623555307,0.71153846153846156,0.77022058823529416,0.76043503821281599],"type":"scatter3d","mode":"lines+markers","line":{"width":2,"color":"#377EB8"},"marker":{"size":5,"color":"#377EB8"},"name":"Semilla 3 AUC medio: 0.73","inherit":true},"3f5865f4e67.2":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1,2,3,4,5],"y":[3,3,3,3,3],"z":[0.72976190476190472,0.65986159169550174,0.75496974935177186,0.77118100128369704,0.77161076995748701],"type":"scatter3d","mode":"lines+markers","line":{"width":2,"color":"#4DAF4A"},"marker":{"size":5,"color":"#4DAF4A"},"name":"Semilla 123 AUC medio: 0.761","inherit":true},"3f5865f4e67.3":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1,2,3,4,5],"y":[4,4,4,4,4],"z":[0.77229654403567449,0.77683823529411766,0.77843915343915349,0.68693181818181814,0.71981707317073174],"type":"scatter3d","mode":"lines+markers","line":{"width":2,"color":"#984EA3"},"marker":{"size":5,"color":"#984EA3"},"name":"Semilla 50 AUC medio: 0.747","inherit":true},"3f5865f4e67.4":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1,2,3,4,5],"y":[5,5,5,5,5],"z":[0.75029761904761905,0.75740259740259741,0.80426356589147285,0.65310846560846558,0.81859756097560976],"type":"scatter3d","mode":"lines+markers","line":{"width":2,"color":"#FF7F00"},"marker":{"size":5,"color":"#FF7F00"},"name":"Semilla 90 AUC medio: 0.757","inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"scene":{"xaxis":{"title":"Fold"},"yaxis":{"title":"Semilla"},"zaxis":{"title":"AUC"},"title":"Visualización 3D de Folds, Semillas y AUC"},"hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":[1,2,3,4,5],"y":[1,1,1,1,1],"z":[0.73363095238095233,0.78141534391534395,0.74191176470588238,0.75591634562465604,0.63609641387419158],"type":"scatter3d","mode":"lines+markers","line":{"color":"#E41A1C","width":2},"marker":{"color":"#E41A1C","size":5,"line":{"color":"rgba(31,119,180,1)"}},"name":"Semilla 27 AUC medio: 0.737","error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"frame":null},{"x":[1,2,3,4,5],"y":[2,2,2,2,2],"z":[0.81279069767441858,0.74848651623555307,0.71153846153846156,0.77022058823529416,0.76043503821281599],"type":"scatter3d","mode":"lines+markers","line":{"color":"#377EB8","width":2},"marker":{"color":"#377EB8","size":5,"line":{"color":"rgba(255,127,14,1)"}},"name":"Semilla 3 AUC medio: 0.73","error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"frame":null},{"x":[1,2,3,4,5],"y":[3,3,3,3,3],"z":[0.72976190476190472,0.65986159169550174,0.75496974935177186,0.77118100128369704,0.77161076995748701],"type":"scatter3d","mode":"lines+markers","line":{"color":"#4DAF4A","width":2},"marker":{"color":"#4DAF4A","size":5,"line":{"color":"rgba(44,160,44,1)"}},"name":"Semilla 123 AUC medio: 0.761","error_y":{"color":"rgba(44,160,44,1)"},"error_x":{"color":"rgba(44,160,44,1)"},"frame":null},{"x":[1,2,3,4,5],"y":[4,4,4,4,4],"z":[0.77229654403567449,0.77683823529411766,0.77843915343915349,0.68693181818181814,0.71981707317073174],"type":"scatter3d","mode":"lines+markers","line":{"color":"#984EA3","width":2},"marker":{"color":"#984EA3","size":5,"line":{"color":"rgba(214,39,40,1)"}},"name":"Semilla 50 AUC medio: 0.747","error_y":{"color":"rgba(214,39,40,1)"},"error_x":{"color":"rgba(214,39,40,1)"},"frame":null},{"x":[1,2,3,4,5],"y":[5,5,5,5,5],"z":[0.75029761904761905,0.75740259740259741,0.80426356589147285,0.65310846560846558,0.81859756097560976],"type":"scatter3d","mode":"lines+markers","line":{"color":"#FF7F00","width":2},"marker":{"color":"#FF7F00","size":5,"line":{"color":"rgba(148,103,189,1)"}},"name":"Semilla 90 AUC medio: 0.757","error_y":{"color":"rgba(148,103,189,1)"},"error_x":{"color":"rgba(148,103,189,1)"},"frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</div>
<div id="tabset-24-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-24-3-tab">
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb179"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb179-1"><a href="#cb179-1" aria-hidden="true" tabindex="-1"></a><span class="fu">generate_auc_per_seed_and_fold</span>(ANN_StepAUC_Metrics<span class="sc">$</span>performance_metrics)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-ff7f384dd8a6c6abaab7" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-ff7f384dd8a6c6abaab7">{"x":{"visdat":{"3f58353a7712":["function () ","plotlyVisDat"]},"cur_data":"3f58353a7712","attrs":{"3f58353a7712":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1,2,3,4,5],"y":[1,1,1,1,1],"z":[0.71726190476190499,0.79794973544973502,0.723161764705882,0.75288937809576195,0.64050558495002896],"type":"scatter3d","mode":"lines+markers","line":{"width":2,"color":"#E41A1C"},"marker":{"size":5,"color":"#E41A1C"},"name":"Semilla 27 AUC medio: 0.721","inherit":true},"3f58353a7712.1":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1,2,3,4,5],"y":[2,2,2,2,2],"z":[0.79534883720930205,0.75206384149697303,0.66639957264957295,0.811029411764706,0.72545561434450301],"type":"scatter3d","mode":"lines+markers","line":{"width":2,"color":"#377EB8"},"marker":{"size":5,"color":"#377EB8"},"name":"Semilla 3 AUC medio: 0.726","inherit":true},"3f58353a7712.2":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1,2,3,4,5],"y":[3,3,3,3,3],"z":[0.72916666666666696,0.64394463667820101,0.72687986171132202,0.73587933247753501,0.76948512045347195],"type":"scatter3d","mode":"lines+markers","line":{"width":2,"color":"#4DAF4A"},"marker":{"size":5,"color":"#4DAF4A"},"name":"Semilla 123 AUC medio: 0.75","inherit":true},"3f58353a7712.3":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1,2,3,4,5],"y":[4,4,4,4,4],"z":[0.76254180602006705,0.73602941176470604,0.75363756613756605,0.62954545454545496,0.71951219512195097],"type":"scatter3d","mode":"lines+markers","line":{"width":2,"color":"#984EA3"},"marker":{"size":5,"color":"#984EA3"},"name":"Semilla 50 AUC medio: 0.72","inherit":true},"3f58353a7712.4":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1,2,3,4,5],"y":[5,5,5,5,5],"z":[0.73005952380952399,0.68441558441558403,0.81976744186046502,0.58763227513227501,0.78780487804878097],"type":"scatter3d","mode":"lines+markers","line":{"width":2,"color":"#FF7F00"},"marker":{"size":5,"color":"#FF7F00"},"name":"Semilla 90 AUC medio: 0.722","inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"scene":{"xaxis":{"title":"Fold"},"yaxis":{"title":"Semilla"},"zaxis":{"title":"AUC"},"title":"Visualización 3D de Folds, Semillas y AUC"},"hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":[1,2,3,4,5],"y":[1,1,1,1,1],"z":[0.71726190476190499,0.79794973544973502,0.723161764705882,0.75288937809576195,0.64050558495002896],"type":"scatter3d","mode":"lines+markers","line":{"color":"#E41A1C","width":2},"marker":{"color":"#E41A1C","size":5,"line":{"color":"rgba(31,119,180,1)"}},"name":"Semilla 27 AUC medio: 0.721","error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"frame":null},{"x":[1,2,3,4,5],"y":[2,2,2,2,2],"z":[0.79534883720930205,0.75206384149697303,0.66639957264957295,0.811029411764706,0.72545561434450301],"type":"scatter3d","mode":"lines+markers","line":{"color":"#377EB8","width":2},"marker":{"color":"#377EB8","size":5,"line":{"color":"rgba(255,127,14,1)"}},"name":"Semilla 3 AUC medio: 0.726","error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"frame":null},{"x":[1,2,3,4,5],"y":[3,3,3,3,3],"z":[0.72916666666666696,0.64394463667820101,0.72687986171132202,0.73587933247753501,0.76948512045347195],"type":"scatter3d","mode":"lines+markers","line":{"color":"#4DAF4A","width":2},"marker":{"color":"#4DAF4A","size":5,"line":{"color":"rgba(44,160,44,1)"}},"name":"Semilla 123 AUC medio: 0.75","error_y":{"color":"rgba(44,160,44,1)"},"error_x":{"color":"rgba(44,160,44,1)"},"frame":null},{"x":[1,2,3,4,5],"y":[4,4,4,4,4],"z":[0.76254180602006705,0.73602941176470604,0.75363756613756605,0.62954545454545496,0.71951219512195097],"type":"scatter3d","mode":"lines+markers","line":{"color":"#984EA3","width":2},"marker":{"color":"#984EA3","size":5,"line":{"color":"rgba(214,39,40,1)"}},"name":"Semilla 50 AUC medio: 0.72","error_y":{"color":"rgba(214,39,40,1)"},"error_x":{"color":"rgba(214,39,40,1)"},"frame":null},{"x":[1,2,3,4,5],"y":[5,5,5,5,5],"z":[0.73005952380952399,0.68441558441558403,0.81976744186046502,0.58763227513227501,0.78780487804878097],"type":"scatter3d","mode":"lines+markers","line":{"color":"#FF7F00","width":2},"marker":{"color":"#FF7F00","size":5,"line":{"color":"rgba(148,103,189,1)"}},"name":"Semilla 90 AUC medio: 0.722","error_y":{"color":"rgba(148,103,189,1)"},"error_x":{"color":"rgba(148,103,189,1)"},"frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</div>
<div id="tabset-24-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-24-4-tab">
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb180"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb180-1"><a href="#cb180-1" aria-hidden="true" tabindex="-1"></a><span class="fu">generate_auc_per_seed_and_fold</span>(ANN_Lasso_Metrics<span class="sc">$</span>performance_metrics)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-7c3c4aad837921d4ab9a" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-7c3c4aad837921d4ab9a">{"x":{"visdat":{"3f584e94c19":["function () ","plotlyVisDat"]},"cur_data":"3f584e94c19","attrs":{"3f584e94c19":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1,2,3,4,5],"y":[1,1,1,1,1],"z":[0.74166666666666703,0.84689153439153397,0.73308823529411804,0.77050082553659904,0.68489124044679595],"type":"scatter3d","mode":"lines+markers","line":{"width":2,"color":"#E41A1C"},"marker":{"size":5,"color":"#E41A1C"},"name":"Semilla 27 AUC medio: 0.743","inherit":true},"3f584e94c19.1":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1,2,3,4,5],"y":[2,2,2,2,2],"z":[0.81395348837209303,0.74903687396807905,0.69230769230769196,0.80551470588235297,0.75161669606114001],"type":"scatter3d","mode":"lines+markers","line":{"width":2,"color":"#377EB8"},"marker":{"size":5,"color":"#377EB8"},"name":"Semilla 3 AUC medio: 0.755","inherit":true},"3f584e94c19.2":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1,2,3,4,5],"y":[3,3,3,3,3],"z":[0.73244047619047603,0.72076124567473998,0.71996542783059603,0.77471116816431296,0.76476145488899405],"type":"scatter3d","mode":"lines+markers","line":{"width":2,"color":"#4DAF4A"},"marker":{"size":5,"color":"#4DAF4A"},"name":"Semilla 123 AUC medio: 0.762","inherit":true},"3f584e94c19.3":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1,2,3,4,5],"y":[4,4,4,4,4],"z":[0.75222965440356704,0.79080882352941195,0.77116402116402105,0.69829545454545505,0.69390243902438997],"type":"scatter3d","mode":"lines+markers","line":{"width":2,"color":"#984EA3"},"marker":{"size":5,"color":"#984EA3"},"name":"Semilla 50 AUC medio: 0.741","inherit":true},"3f584e94c19.4":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1,2,3,4,5],"y":[5,5,5,5,5],"z":[0.78244047619047596,0.72779220779220799,0.75,0.61541005291005302,0.80945121951219501],"type":"scatter3d","mode":"lines+markers","line":{"width":2,"color":"#FF7F00"},"marker":{"size":5,"color":"#FF7F00"},"name":"Semilla 90 AUC medio: 0.737","inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"scene":{"xaxis":{"title":"Fold"},"yaxis":{"title":"Semilla"},"zaxis":{"title":"AUC"},"title":"Visualización 3D de Folds, Semillas y AUC"},"hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":[1,2,3,4,5],"y":[1,1,1,1,1],"z":[0.74166666666666703,0.84689153439153397,0.73308823529411804,0.77050082553659904,0.68489124044679595],"type":"scatter3d","mode":"lines+markers","line":{"color":"#E41A1C","width":2},"marker":{"color":"#E41A1C","size":5,"line":{"color":"rgba(31,119,180,1)"}},"name":"Semilla 27 AUC medio: 0.743","error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"frame":null},{"x":[1,2,3,4,5],"y":[2,2,2,2,2],"z":[0.81395348837209303,0.74903687396807905,0.69230769230769196,0.80551470588235297,0.75161669606114001],"type":"scatter3d","mode":"lines+markers","line":{"color":"#377EB8","width":2},"marker":{"color":"#377EB8","size":5,"line":{"color":"rgba(255,127,14,1)"}},"name":"Semilla 3 AUC medio: 0.755","error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"frame":null},{"x":[1,2,3,4,5],"y":[3,3,3,3,3],"z":[0.73244047619047603,0.72076124567473998,0.71996542783059603,0.77471116816431296,0.76476145488899405],"type":"scatter3d","mode":"lines+markers","line":{"color":"#4DAF4A","width":2},"marker":{"color":"#4DAF4A","size":5,"line":{"color":"rgba(44,160,44,1)"}},"name":"Semilla 123 AUC medio: 0.762","error_y":{"color":"rgba(44,160,44,1)"},"error_x":{"color":"rgba(44,160,44,1)"},"frame":null},{"x":[1,2,3,4,5],"y":[4,4,4,4,4],"z":[0.75222965440356704,0.79080882352941195,0.77116402116402105,0.69829545454545505,0.69390243902438997],"type":"scatter3d","mode":"lines+markers","line":{"color":"#984EA3","width":2},"marker":{"color":"#984EA3","size":5,"line":{"color":"rgba(214,39,40,1)"}},"name":"Semilla 50 AUC medio: 0.741","error_y":{"color":"rgba(214,39,40,1)"},"error_x":{"color":"rgba(214,39,40,1)"},"frame":null},{"x":[1,2,3,4,5],"y":[5,5,5,5,5],"z":[0.78244047619047596,0.72779220779220799,0.75,0.61541005291005302,0.80945121951219501],"type":"scatter3d","mode":"lines+markers","line":{"color":"#FF7F00","width":2},"marker":{"color":"#FF7F00","size":5,"line":{"color":"rgba(148,103,189,1)"}},"name":"Semilla 90 AUC medio: 0.737","error_y":{"color":"rgba(148,103,189,1)"},"error_x":{"color":"rgba(148,103,189,1)"},"frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="auc---conclusión" class="level3" data-number="4.2.8">
<h3 data-number="4.2.8" class="anchored" data-anchor-id="auc---conclusión"><span class="header-section-number">4.2.8</span> AUC - Conclusión</h3>
<p>Una vez realizada la exploración de las métricas específicas para cada modelo, prestando atención sobre todo a la dispersión del AUC dependiente del método de selección de variables usado, se va a proceder con una exploración global del AUC, dependiendo de cada método y modelo aplicado. Este análisis nos permitirá descartar los modelos menos estables, o con un AUC medio más bajo. Los modelos que pasen este filtro de selección, pasarán a la siguiente etapa de discusión, en la que se analizará la estabilidad de sus hiperparámetros, arrojando conclusiones importantes sobre la estabilidad del modelo frente a la aleatoriedad de los datos con los que ha sido entrado.</p>
<p>Se ha decidido que la primera etapa esté relacionada con la métrica del AUC ya que el rendimiento del modelo es la <em>carta de presentación del modelo frente a los profesionales de la salud interesados en usarlo</em>, por lo que es una métrica que debe mantenerse, tanto alta, como estable. Se realizaron entonces los siguientes análisis:</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-25-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-25-1" role="tab" aria-controls="tabset-25-1" aria-selected="true" href="">AUC Global por Modelo</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-25-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-25-2" role="tab" aria-controls="tabset-25-2" aria-selected="false" href="">AUC Global por Método</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-25-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-25-3" role="tab" aria-controls="tabset-25-3" aria-selected="false" href="">AUC Global por Variable y Método</a></li></ul>
<div class="tab-content">
<div id="tabset-25-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-25-1-tab">
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb181"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb181-1"><a href="#cb181-1" aria-hidden="true" tabindex="-1"></a>generate_auc_comparison_violin_plot <span class="ot">&lt;-</span> <span class="cf">function</span>(model_data_list) {</span>
<span id="cb181-2"><a href="#cb181-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Inicializar una lista para almacenar los datos combinados</span></span>
<span id="cb181-3"><a href="#cb181-3" aria-hidden="true" tabindex="-1"></a>  combined_data <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb181-4"><a href="#cb181-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb181-5"><a href="#cb181-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Recorrer cada modelo en el vector de listas</span></span>
<span id="cb181-6"><a href="#cb181-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (model_name <span class="cf">in</span> <span class="fu">names</span>(model_data_list)) {</span>
<span id="cb181-7"><a href="#cb181-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Obtener los 4 dataframes para el modelo actual</span></span>
<span id="cb181-8"><a href="#cb181-8" aria-hidden="true" tabindex="-1"></a>    model_data_frames <span class="ot">&lt;-</span> model_data_list[[model_name]]</span>
<span id="cb181-9"><a href="#cb181-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb181-10"><a href="#cb181-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Combinar los 4 dataframes en uno solo y agregar una columna para el nombre del modelo</span></span>
<span id="cb181-11"><a href="#cb181-11" aria-hidden="true" tabindex="-1"></a>    model_combined_data <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(model_data_frames) <span class="sc">%&gt;%</span></span>
<span id="cb181-12"><a href="#cb181-12" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">Model =</span> model_name)</span>
<span id="cb181-13"><a href="#cb181-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb181-14"><a href="#cb181-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Agregar los datos combinados a la lista general</span></span>
<span id="cb181-15"><a href="#cb181-15" aria-hidden="true" tabindex="-1"></a>    combined_data[[model_name]] <span class="ot">&lt;-</span> model_combined_data</span>
<span id="cb181-16"><a href="#cb181-16" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb181-17"><a href="#cb181-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb181-18"><a href="#cb181-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Combinar todos los datos en un solo dataframe</span></span>
<span id="cb181-19"><a href="#cb181-19" aria-hidden="true" tabindex="-1"></a>  final_data <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(combined_data)</span>
<span id="cb181-20"><a href="#cb181-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb181-21"><a href="#cb181-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Crear el gráfico de violín</span></span>
<span id="cb181-22"><a href="#cb181-22" aria-hidden="true" tabindex="-1"></a>  violin_plot <span class="ot">&lt;-</span> <span class="fu">plot_ly</span>(final_data, <span class="at">y =</span> <span class="sc">~</span>AUC, <span class="at">type =</span> <span class="st">'violin'</span>, </span>
<span id="cb181-23"><a href="#cb181-23" aria-hidden="true" tabindex="-1"></a>                         <span class="at">box =</span> <span class="fu">list</span>(<span class="at">visible =</span> <span class="cn">TRUE</span>), </span>
<span id="cb181-24"><a href="#cb181-24" aria-hidden="true" tabindex="-1"></a>                         <span class="at">meanline =</span> <span class="fu">list</span>(<span class="at">visible =</span> <span class="cn">TRUE</span>), </span>
<span id="cb181-25"><a href="#cb181-25" aria-hidden="true" tabindex="-1"></a>                         <span class="at">split =</span> <span class="sc">~</span>Model) <span class="sc">%&gt;%</span></span>
<span id="cb181-26"><a href="#cb181-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">layout</span>(</span>
<span id="cb181-27"><a href="#cb181-27" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="st">'Comparativa Global del AUC de Diferentes Modelos'</span>,</span>
<span id="cb181-28"><a href="#cb181-28" aria-hidden="true" tabindex="-1"></a>      <span class="at">yaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">'AUC'</span>),</span>
<span id="cb181-29"><a href="#cb181-29" aria-hidden="true" tabindex="-1"></a>      <span class="at">xaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">'Modelos'</span>)</span>
<span id="cb181-30"><a href="#cb181-30" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb181-31"><a href="#cb181-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb181-32"><a href="#cb181-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(violin_plot)</span>
<span id="cb181-33"><a href="#cb181-33" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb181-34"><a href="#cb181-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb181-35"><a href="#cb181-35" aria-hidden="true" tabindex="-1"></a>model_data_list <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb181-36"><a href="#cb181-36" aria-hidden="true" tabindex="-1"></a>  <span class="at">ANN =</span> <span class="fu">list</span>(</span>
<span id="cb181-37"><a href="#cb181-37" aria-hidden="true" tabindex="-1"></a>    ANN_TodasVariables_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb181-38"><a href="#cb181-38" aria-hidden="true" tabindex="-1"></a>    ANN_Asociacion_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb181-39"><a href="#cb181-39" aria-hidden="true" tabindex="-1"></a>    ANN_StepAUC_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb181-40"><a href="#cb181-40" aria-hidden="true" tabindex="-1"></a>    ANN_Lasso_Metrics<span class="sc">$</span>performance_metrics</span>
<span id="cb181-41"><a href="#cb181-41" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb181-42"><a href="#cb181-42" aria-hidden="true" tabindex="-1"></a>  <span class="at">SVM =</span> <span class="fu">list</span>(</span>
<span id="cb181-43"><a href="#cb181-43" aria-hidden="true" tabindex="-1"></a>    SVM_TodasVariables_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb181-44"><a href="#cb181-44" aria-hidden="true" tabindex="-1"></a>    SVM_Asociacion_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb181-45"><a href="#cb181-45" aria-hidden="true" tabindex="-1"></a>    SVM_StepAUC_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb181-46"><a href="#cb181-46" aria-hidden="true" tabindex="-1"></a>    SVM_Lasso_Metrics<span class="sc">$</span>performance_metrics</span>
<span id="cb181-47"><a href="#cb181-47" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb181-48"><a href="#cb181-48" aria-hidden="true" tabindex="-1"></a>  <span class="at">KNN =</span> <span class="fu">list</span>(</span>
<span id="cb181-49"><a href="#cb181-49" aria-hidden="true" tabindex="-1"></a>    KNN_TodasVariables_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb181-50"><a href="#cb181-50" aria-hidden="true" tabindex="-1"></a>    KNN_Asociacion_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb181-51"><a href="#cb181-51" aria-hidden="true" tabindex="-1"></a>    KNN_StepAUC_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb181-52"><a href="#cb181-52" aria-hidden="true" tabindex="-1"></a>    KNN_Lasso_Metrics<span class="sc">$</span>performance_metrics</span>
<span id="cb181-53"><a href="#cb181-53" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb181-54"><a href="#cb181-54" aria-hidden="true" tabindex="-1"></a>  <span class="at">RandomForest =</span> <span class="fu">list</span>(</span>
<span id="cb181-55"><a href="#cb181-55" aria-hidden="true" tabindex="-1"></a>    RandomForest_TodasVariables_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb181-56"><a href="#cb181-56" aria-hidden="true" tabindex="-1"></a>    RandomForest_Asociacion_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb181-57"><a href="#cb181-57" aria-hidden="true" tabindex="-1"></a>    RandomForest_StepAUC_Metrics<span class="sc">$</span>performance_metrics</span>
<span id="cb181-58"><a href="#cb181-58" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb181-59"><a href="#cb181-59" aria-hidden="true" tabindex="-1"></a>  <span class="at">NaiveBayes =</span> <span class="fu">list</span>(</span>
<span id="cb181-60"><a href="#cb181-60" aria-hidden="true" tabindex="-1"></a>    NaiveBayes_TodasVariables_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb181-61"><a href="#cb181-61" aria-hidden="true" tabindex="-1"></a>    NaiveBayes_Asociacion_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb181-62"><a href="#cb181-62" aria-hidden="true" tabindex="-1"></a>    NaiveBayes_StepAUC_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb181-63"><a href="#cb181-63" aria-hidden="true" tabindex="-1"></a>    NaiveBayes_Lasso_Metrics<span class="sc">$</span>performance_metrics</span>
<span id="cb181-64"><a href="#cb181-64" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb181-65"><a href="#cb181-65" aria-hidden="true" tabindex="-1"></a>  <span class="at">AdaBoost =</span> <span class="fu">list</span>(</span>
<span id="cb181-66"><a href="#cb181-66" aria-hidden="true" tabindex="-1"></a>    AdaBoost_TodasVariables_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb181-67"><a href="#cb181-67" aria-hidden="true" tabindex="-1"></a>    AdaBoost_Asociacion_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb181-68"><a href="#cb181-68" aria-hidden="true" tabindex="-1"></a>    AdaBoost_StepAUC_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb181-69"><a href="#cb181-69" aria-hidden="true" tabindex="-1"></a>    AdaBoost_Lasso_Metrics<span class="sc">$</span>performance_metrics</span>
<span id="cb181-70"><a href="#cb181-70" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb181-71"><a href="#cb181-71" aria-hidden="true" tabindex="-1"></a>  <span class="at">DecisionTree =</span> <span class="fu">list</span>(</span>
<span id="cb181-72"><a href="#cb181-72" aria-hidden="true" tabindex="-1"></a>    RPart_TodasVariables_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb181-73"><a href="#cb181-73" aria-hidden="true" tabindex="-1"></a>    RPart_Asociacion_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb181-74"><a href="#cb181-74" aria-hidden="true" tabindex="-1"></a>    RPart_StepAUC_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb181-75"><a href="#cb181-75" aria-hidden="true" tabindex="-1"></a>    RPart_Lasso_Metrics<span class="sc">$</span>performance_metrics</span>
<span id="cb181-76"><a href="#cb181-76" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb181-77"><a href="#cb181-77" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb181-78"><a href="#cb181-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb181-79"><a href="#cb181-79" aria-hidden="true" tabindex="-1"></a>violin_plot <span class="ot">&lt;-</span> <span class="fu">generate_auc_comparison_violin_plot</span>(model_data_list)</span>
<span id="cb181-80"><a href="#cb181-80" aria-hidden="true" tabindex="-1"></a>violin_plot</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-d7d5ebd2611c435434a2" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-d7d5ebd2611c435434a2">{"x":{"visdat":{"3f58329c70bf":["function () ","plotlyVisDat"]},"cur_data":"3f58329c70bf","attrs":{"3f58329c70bf":{"y":{},"box":{"visible":true},"meanline":{"visible":true},"split":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"violin"}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"Comparativa Global del AUC de Diferentes Modelos","yaxis":{"domain":[0,1],"automargin":true,"title":"AUC"},"xaxis":{"domain":[0,1],"automargin":true,"title":"Modelos"},"hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"fillcolor":"rgba(31,119,180,0.5)","y":[0.75714285714285712,0.78604497354497349,0.71323529411764708,0.75013758943313158,0.66255144032921809,0.84147286821705425,0.71684094661529996,0.70512820512820507,0.76213235294117643,0.71340388007054667,0.72261904761904761,0.71349480968858126,0.77614520311149526,0.74711168164313224,0.78767123287671237,0.72240802675585281,0.7904411764705882,0.79067460317460314,0.69289772727272725,0.68902439024390238,0.78363095238095237,0.74883116883116885,0.81666666666666665,0.63492063492063489,0.81554878048780488,0.73363095238095233,0.78141534391534395,0.74191176470588238,0.75591634562465604,0.63609641387419158,0.81279069767441858,0.74848651623555307,0.71153846153846156,0.77022058823529416,0.76043503821281599,0.72976190476190472,0.65986159169550174,0.75496974935177186,0.77118100128369704,0.77161076995748701,0.77229654403567449,0.77683823529411766,0.77843915343915349,0.68693181818181814,0.71981707317073174,0.75029761904761905,0.75740259740259741,0.80426356589147285,0.65310846560846558,0.81859756097560976,0.71726190476190499,0.79794973544973502,0.723161764705882,0.75288937809576195,0.64050558495002896,0.79534883720930205,0.75206384149697303,0.66639957264957295,0.811029411764706,0.72545561434450301,0.72916666666666696,0.64394463667820101,0.72687986171132202,0.73587933247753501,0.76948512045347195,0.76254180602006705,0.73602941176470604,0.75363756613756605,0.62954545454545496,0.71951219512195097,0.73005952380952399,0.68441558441558403,0.81976744186046502,0.58763227513227501,0.78780487804878097,0.74166666666666703,0.84689153439153397,0.73308823529411804,0.77050082553659904,0.68489124044679595,0.81395348837209303,0.74903687396807905,0.69230769230769196,0.80551470588235297,0.75161669606114001,0.73244047619047603,0.72076124567473998,0.71996542783059603,0.77471116816431296,0.76476145488899405,0.75222965440356704,0.79080882352941195,0.77116402116402105,0.69829545454545505,0.69390243902438997,0.78244047619047596,0.72779220779220799,0.75,0.61541005291005302,0.80945121951219501],"box":{"visible":true},"meanline":{"visible":true},"type":"violin","name":"ANN","marker":{"color":"rgba(31,119,180,1)","line":{"color":"rgba(31,119,180,1)"}},"line":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","frame":null},{"fillcolor":"rgba(255,127,14,0.5)","y":[0.70518292682926831,0.70057766367137353,0.73302469135802462,0.73506097560975614,0.78780487804878052,0.7910493827160493,0.73074454428754809,0.77591463414634143,0.676219512195122,0.71737804878048783,0.72677063027940214,0.6890243902439025,0.7347560975609756,0.72347560975609759,0.67164634146341462,0.75121951219512195,0.73684210526315785,0.68231707317073165,0.71707317073170729,0.70426829268292679,0.77469512195121948,0.81036585365853653,0.7432098765432098,0.69573170731707312,0.67458279845956348,0.70426829268292679,0.73331193838254172,0.71512345679012346,0.74176829268292677,0.7780487804878049,0.81111111111111112,0.7339537869062901,0.78231707317073174,0.66829268292682931,0.74146341463414633,0.66471734892787526,0.75731707317073171,0.67743902439024384,0.71036585365853655,0.69481707317073171,0.72408536585365857,0.7550357374918778,0.71676829268292686,0.72896341463414627,0.65670731707317076,0.76158536585365855,0.77591463414634143,0.74135802469135803,0.6786585365853659,0.77214377406931967,0.70152439024390201,0.71598202824133494,0.70987654320987603,0.73201219512195104,0.77317073170731698,0.79537037037036995,0.723042362002567,0.79939024390243896,0.70213414634146298,0.744207317073171,0.78232618583495805,0.74969512195121901,0.78262195121951195,0.70945121951219503,0.70548780487804896,0.77957317073170695,0.71669915529564698,0.70213414634146298,0.73628048780487798,0.65609756097561001,0.74603658536585404,0.79420731707317105,0.77129629629629604,0.64847560975609797,0.76636713735558404,0.66463414634146301,0.71726572528883203,0.76944444444444404,0.76951219512195101,0.798170731707317,0.77932098765432101,0.70282413350449302,0.77439024390243905,0.70213414634146298,0.76219512195121997,0.73196881091617905,0.73689024390243896,0.74664634146341502,0.73231707317073202,0.71097560975609797,0.79451219512195104,0.75211176088369103,0.71341463414634099,0.77317073170731698,0.68597560975609795,0.73658536585365897,0.81493902439024402,0.76882716049382704,0.65121951219512197,0.72528883183568704],"box":{"visible":true},"meanline":{"visible":true},"type":"violin","name":"AdaBoost","marker":{"color":"rgba(255,127,14,1)","line":{"color":"rgba(255,127,14,1)"}},"line":{"color":"rgba(255,127,14,1)"},"xaxis":"x","yaxis":"y","frame":null},{"fillcolor":"rgba(44,160,44,0.5)","y":[0.69115853658536586,0.65436456996148906,0.53240740740740733,0.72652439024390247,0.73628048780487798,0.77654320987654313,0.68709884467265725,0.801219512195122,0.53262195121951228,0.7667682926829269,0.66374269005847952,0.71890243902439022,0.5,0.68048780487804883,0.63567073170731703,0.76219512195121952,0.71247563352826515,0.72225609756097564,0.67347560975609755,0.65975609756097564,0.7740853658536585,0.76798780487804874,0.7231481481481481,0.60365853658536583,0.71052631578947356,0.66219512195121943,0.70827984595635429,0.5,0.71250000000000002,0.5,0.78518518518518521,0.69833119383825415,0.74176829268292688,0.61524390243902438,0.68445121951219512,0.6871345029239766,0.77987804878048772,0.66707317073170735,0.61402439024390243,0.69207317073170727,0.761280487804878,0.7586094866796621,0.73353658536585364,0.68414634146341458,0.5753048780487805,0.72957317073170735,0.5,0.65987654320987654,0.67408536585365852,0.5,0.5,0.65917843388960196,0.64259259259259205,0.65182926829268295,0.67926829268292699,0.75987654320987696,0.69929396662387699,0.67500000000000004,0.59451219512195097,0.741463414634146,0.70532813515269699,0.72560975609756095,0.5,0.64237804878048799,0.67134146341463397,0.5,0.71442495126705696,0.70914634146341504,0.70945121951219503,0.56768292682926802,0.58353658536585395,0.72073170731707303,0.71111111111111103,0.60670731707317105,0.678754813863928,0.69821428571428601,0.67195767195767198,0.73419117647058796,0.70638414969730301,0.5,0.76007751937984502,0.5,0.5,0.77095588235294099,0.70928865373309802,0.68482142857142803,0.5,0.57994814174589404,0.75224646983311905,0.70358998582900301,0.5,0.71544117647058803,0.75264550264550301,0.5,0.66219512195121999,0.73601190476190503,0.5,0.68294573643410905,0.60615079365079405,0.75823170731707301],"box":{"visible":true},"meanline":{"visible":true},"type":"violin","name":"DecisionTree","marker":{"color":"rgba(44,160,44,1)","line":{"color":"rgba(44,160,44,1)"}},"line":{"color":"rgba(44,160,44,1)"},"xaxis":"x","yaxis":"y","frame":null},{"fillcolor":"rgba(214,39,40,0.5)","y":[0.73109756097560974,0.60141206675224645,0.69228395061728398,0.62012195121951219,0.79054878048780486,0.68271604938271602,0.64441591784338892,0.698780487804878,0.58841463414634143,0.76737804878048776,0.72514619883040932,0.673170731707317,0.76371951219512191,0.6963414634146341,0.70457317073170733,0.65701219512195119,0.71052631578947367,0.60731707317073169,0.65701219512195119,0.7908536585365854,0.74207317073170731,0.72317073170731705,0.69475308641975309,0.67530487804878048,0.69993581514762515,0.72621951219512193,0.70988446726572529,0.78179012345679011,0.74542682926829262,0.76951219512195124,0.79907407407407405,0.72946084724005134,0.78018292682926826,0.67560975609756102,0.73048780487804876,0.75990903183885639,0.78170731707317076,0.69786585365853659,0.71219512195121948,0.75335365853658531,0.8213414634146341,0.75243664717348924,0.74695121951219512,0.69695121951219507,0.71829268292682924,0.69969512195121952,0.81219512195121946,0.75679012345679009,0.73079268292682931,0.75577663671373552,0.72103658536585402,0.72560975609756095,0.65895061728395099,0.62957317073170704,0.73079268292682897,0.79320987654320996,0.71084724005134803,0.79207317073170702,0.68841463414634096,0.70396341463414602,0.67803768680961696,0.72256097560975596,0.69268292682926802,0.73506097560975603,0.76859756097561005,0.66859756097560996,0.76543209876543195,0.72408536585365901,0.70152439024390201,0.73231707317073202,0.70884146341463405,0.755792682926829,0.77283950617283903,0.68567073170731696,0.70025673940949895,0.73124999999999996,0.77777777777777801,0.78965517241379302,0.75175438596491195,0.57746913580246895,0.79411764705882304,0.61454545454545495,0.65100154083204897,0.884533898305085,0.76865671641791,0.64473684210526305,0.61666666666666703,0.870056497175141,0.640625,0.83437499999999998,0.80142857142857105,0.83999999999999997,0.63788487282463202,0.67708333333333304,0.50816993464052296,0.75628930817610096,0.75721153846153899,0.54500000000000004,0.72619047619047605,0.74243421052631597],"box":{"visible":true},"meanline":{"visible":true},"type":"violin","name":"KNN","marker":{"color":"rgba(214,39,40,1)","line":{"color":"rgba(214,39,40,1)"}},"line":{"color":"rgba(214,39,40,1)"},"xaxis":"x","yaxis":"y","frame":null},{"fillcolor":"rgba(148,103,189,0.5)","y":[0.72774390243902443,0.70635430038510916,0.76975308641975304,0.72408536585365857,0.78262195121951217,0.7944444444444444,0.74133504492939672,0.77713414634146338,0.70884146341463417,0.70884146341463417,0.7657569850552306,0.77195121951219514,0.73414634146341462,0.72317073170731705,0.71920731707317076,0.7475609756097561,0.7300194931773879,0.69268292682926824,0.78597560975609759,0.70853658536585362,0.74207317073170731,0.81280487804878054,0.74783950617283945,0.69085365853658542,0.7853016688061617,0.72652439024390236,0.68709884467265725,0.76265432098765429,0.73780487804878048,0.78140243902439022,0.80679012345679013,0.73202824133504496,0.77042682926829265,0.70487804878048788,0.70609756097560972,0.75113710201429496,0.76981707317073167,0.7115853658536585,0.72256097560975607,0.73262195121951224,0.73414634146341462,0.74528914879792063,0.6875,0.79542682926829267,0.69573170731707323,0.72774390243902443,0.7972560975609756,0.72592592592592597,0.67500000000000004,0.78754813863928108,0.72743902439024399,0.71405648267009003,0.78858024691357997,0.70518292682926798,0.76615853658536603,0.79598765432098795,0.751604621309371,0.78506097560975596,0.65884146341463401,0.730182926829268,0.78784925276153295,0.75914634146341498,0.76463414634146298,0.72134146341463401,0.71707317073170695,0.75121951219512195,0.72449642625081201,0.64176829268292701,0.78079268292682902,0.69908536585365899,0.73475609756097604,0.80548780487804905,0.75493827160493798,0.676219512195122,0.80102695763799703,0.68323170731707294,0.70282413350449302,0.79691358024691406,0.72286585365853695,0.71951219512195097,0.77932098765432101,0.70186136071886995,0.78810975609756095,0.60731707317073202,0.76463414634146298,0.73976608187134496,0.71737804878048805,0.74085365853658502,0.73689024390243896,0.73140243902438995,0.75060975609756098,0.72807017543859598,0.69725609756097595,0.76524390243902396,0.74329268292682904,0.75731707317073205,0.83384146341463405,0.74228395061728403,0.70121951219512202,0.75288831835686798],"box":{"visible":true},"meanline":{"visible":true},"type":"violin","name":"NaiveBayes","marker":{"color":"rgba(148,103,189,1)","line":{"color":"rgba(148,103,189,1)"}},"line":{"color":"rgba(148,103,189,1)"},"xaxis":"x","yaxis":"y","frame":null},{"fillcolor":"rgba(140,86,75,0.5)","y":[0.69268292682926824,0.63735558408215665,0.63796296296296295,0.70396341463414636,0.64237804878048776,0.72746913580246908,0.71790757381258019,0.72530487804878052,0.65701219512195119,0.73445121951219505,0.71442495126705652,0.67042682926829267,0.69786585365853659,0.65701219512195119,0.62317073170731707,0.69481707317073171,0.70890188434048074,0.613719512195122,0.6914634146341464,0.69359756097560976,0.69969512195121952,0.71646341463414631,0.71759259259259256,0.60579268292682931,0.66688061617458283,0.63292682926829269,0.67843388960205397,0.61111111111111116,0.72652439024390247,0.64512195121951221,0.67037037037037028,0.69576379974326052,0.69329268292682922,0.64237804878048776,0.63750000000000007,0.67381416504223512,0.69054878048780488,0.61615853658536579,0.5649390243902439,0.68323170731707317,0.71189024390243905,0.65464587394411955,0.613719512195122,0.61128048780487798,0.61676829268292677,0.64085365853658538,0.67164634146341462,0.63240740740740742,0.58841463414634143,0.65308087291399231,0.5,0.594993581514762,0.63734567901234596,0.71067073170731698,0.72225609756097597,0.71388888888888902,0.71694480102695801,0.69054878048780499,0.63658536585365899,0.55945121951219501,0.772579597141001,0.70060975609756104,0.70121951219512202,0.63292682926829302,0.68323170731707294,0.76524390243902396,0.76218323586744596,0.63506097560975605,0.77317073170731698,0.6875,0.66859756097560996,0.698780487804878,0.67469135802469105,0.63536585365853704,0.65404364569961504],"box":{"visible":true},"meanline":{"visible":true},"type":"violin","name":"RandomForest","marker":{"color":"rgba(140,86,75,1)","line":{"color":"rgba(140,86,75,1)"}},"line":{"color":"rgba(140,86,75,1)"},"xaxis":"x","yaxis":"y","frame":null},{"fillcolor":"rgba(227,119,194,0.5)","y":[0.72225609756097564,0.6241976893453145,0.61049382716049383,0.57286585365853659,0.61006097560975614,0.59753086419753088,0.70154043645699615,0.67774390243902438,0.63567073170731703,0.58689024390243905,0.75536062378167634,0.64573170731707319,0.56402439024390238,0.63170731707317074,0.54115853658536583,0.50060975609756098,0.4993502274204028,0.55060975609756091,0.61036585365853657,0.70457317073170733,0.74390243902439024,0.65792682926829271,0.50771604938271608,0.52743902439024393,0.63896020539152765,0.61859756097560981,0.56578947368421051,0.75648148148148142,0.65426829268292686,0.6722560975609756,0.67592592592592593,0.66720154043645696,0.61310975609756102,0.53475609756097564,0.68414634146341469,0.61403508771929827,0.56432926829268293,0.66219512195121955,0.56128048780487805,0.68384146341463414,0.66097560975609759,0.54645873944119561,0.58689024390243905,0.72225609756097564,0.48109756097560974,0.46250000000000002,0.58079268292682928,0.59876543209876543,0.6634146341463415,0.75609756097560976,0.52256097560975601,0.51347881899871595,0.67469135802469105,0.70304878048780495,0.68536585365853697,0.65833333333333299,0.52182284980744498,0.65792682926829305,0.69207317073170704,0.66006097560975596,0.61078622482131295,0.59512195121951195,0.59634146341463401,0.55487804878048796,0.684756097560976,0.51890243902439004,0.73001949317738801,0.65975609756097597,0.52073170731707297,0.54085365853658496,0.58292682926829298,0.62865853658536597,0.61296296296296304,0.66219512195121999,0.65853658536585402,0.60701219512195104,0.57028241335044905,0.70308641975308594,0.64725609756097602,0.74786585365853697,0.78580246913580198,0.55905006418485204,0.65396341463414598,0.63871951219512202,0.68963414634146303,0.70142949967511403,0.73506097560975603,0.67713414634146296,0.673170731707317,0.59329268292682902,0.508536585365854,0.59096816114359996,0.53475609756097597,0.72042682926829305,0.55274390243902405,0.67926829268292699,0.61707317073170698,0.72469135802469098,0.51676829268292701,0.563222079589217],"box":{"visible":true},"meanline":{"visible":true},"type":"violin","name":"SVM","marker":{"color":"rgba(227,119,194,1)","line":{"color":"rgba(227,119,194,1)"}},"line":{"color":"rgba(227,119,194,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>Como se puede observar en el gráfico comparativo de violín superior, hay variaciones significativas en cuanto a la dispersión, media, y mediana del AUC dependiendo del modelo. Los modelos que exhiben un peor rendimiento son el SVM, DecisionTree, y RandomForest, estos muestran una varianza del AUC muy alta, desviándose hacia valores bajos, haciendo que la media disminuya notablemente, en algunos casos, llegando a hacer que el rendimiento esté por debajo de un clasificador aleatorio (<code>AUC&lt;.5</code>).</p>
<p>Por otra parte, los modelos restastes exhiben un AUC promedio elevado. El KNN un AUC medio de 0.7176, y una media de 0.7213, sin embargo, también exhibe una dispersión moderada comparada con el resto de modelos, cuantificada por el rango del modelo, <span class="math inline">Rango = Max-Min=0.15</span>. Las ANN son el siguiente mejor modelo; este modelo exhibe un AUC medio global de 0.737, con una mediana en 0.742, su debilidad es la misma que el KNN, el rango de sus datos, que refleja la dispersión, es algo elevado, siendo este de 0.3, el doble que el KNN.</p>
<p>Los dos últimos modelos son muy similares en cuanto a sus estadísticos. El Adaboost muestra un AUC medio de 0.733, coincidiendo con su mediana, dato que recalta que la distribución de los valores de AUC con este modelo está muy equilibrada y poco dispersa; el rango del modelo es de 0.17. Por otra parte, el algoritmo NaiveBayes, si bien muestra un AUC medio mayor que al Adaboost, de 0.74, con una mediana de 0.737, su rango es algo mayor (0.23), denotando que el modelo puede no ser tan robusto como Adaboost.</p>
<p>Se puede concluir entonces que, <strong>teniendo solo en cuenta el AUC medio global, y su dispersión</strong>, el modelo Adaboost, seguido por NaiveBayes y las ANN, son los que tienen un rendimiento más óptimo. Por lo que son los principales candidatos para pasar a la siguiente fase de evaluación.</p>
</div>
<div id="tabset-25-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-25-2-tab">
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb182"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb182-1"><a href="#cb182-1" aria-hidden="true" tabindex="-1"></a>generate_auc_feature_selection_violin_plot <span class="ot">&lt;-</span> <span class="cf">function</span>(selection_methods_data_list) {</span>
<span id="cb182-2"><a href="#cb182-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Inicializar una lista para almacenar los datos combinados</span></span>
<span id="cb182-3"><a href="#cb182-3" aria-hidden="true" tabindex="-1"></a>  combined_data <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb182-4"><a href="#cb182-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb182-5"><a href="#cb182-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Recorrer cada método de selección en el vector de listas</span></span>
<span id="cb182-6"><a href="#cb182-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (method_name <span class="cf">in</span> <span class="fu">names</span>(selection_methods_data_list)) {</span>
<span id="cb182-7"><a href="#cb182-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Obtener los dataframes para el método de selección actual</span></span>
<span id="cb182-8"><a href="#cb182-8" aria-hidden="true" tabindex="-1"></a>    method_data_frames <span class="ot">&lt;-</span> selection_methods_data_list[[method_name]]</span>
<span id="cb182-9"><a href="#cb182-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb182-10"><a href="#cb182-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Combinar los dataframes en uno solo y agregar una columna para el nombre del método</span></span>
<span id="cb182-11"><a href="#cb182-11" aria-hidden="true" tabindex="-1"></a>    method_combined_data <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(method_data_frames) <span class="sc">%&gt;%</span></span>
<span id="cb182-12"><a href="#cb182-12" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">Method =</span> method_name)</span>
<span id="cb182-13"><a href="#cb182-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb182-14"><a href="#cb182-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Agregar los datos combinados a la lista general</span></span>
<span id="cb182-15"><a href="#cb182-15" aria-hidden="true" tabindex="-1"></a>    combined_data[[method_name]] <span class="ot">&lt;-</span> method_combined_data</span>
<span id="cb182-16"><a href="#cb182-16" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb182-17"><a href="#cb182-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb182-18"><a href="#cb182-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Combinar todos los datos en un solo dataframe</span></span>
<span id="cb182-19"><a href="#cb182-19" aria-hidden="true" tabindex="-1"></a>  final_data <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(combined_data)</span>
<span id="cb182-20"><a href="#cb182-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb182-21"><a href="#cb182-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Crear el gráfico de violín</span></span>
<span id="cb182-22"><a href="#cb182-22" aria-hidden="true" tabindex="-1"></a>  violin_plot <span class="ot">&lt;-</span> <span class="fu">plot_ly</span>(final_data, <span class="at">y =</span> <span class="sc">~</span>AUC, <span class="at">type =</span> <span class="st">'violin'</span>, <span class="at">box =</span> <span class="fu">list</span>(<span class="at">visible =</span> <span class="cn">TRUE</span>), <span class="at">meanline =</span> <span class="fu">list</span>(<span class="at">visible =</span> <span class="cn">TRUE</span>), <span class="at">split =</span> <span class="sc">~</span>Method) <span class="sc">%&gt;%</span></span>
<span id="cb182-23"><a href="#cb182-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">layout</span>(</span>
<span id="cb182-24"><a href="#cb182-24" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="st">'Comparativa Global del AUC por Método de Selección de Características'</span>,</span>
<span id="cb182-25"><a href="#cb182-25" aria-hidden="true" tabindex="-1"></a>      <span class="at">yaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">'AUC'</span>),</span>
<span id="cb182-26"><a href="#cb182-26" aria-hidden="true" tabindex="-1"></a>      <span class="at">xaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">'Métodos de Selección de Características'</span>)</span>
<span id="cb182-27"><a href="#cb182-27" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb182-28"><a href="#cb182-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb182-29"><a href="#cb182-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(violin_plot)</span>
<span id="cb182-30"><a href="#cb182-30" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb182-31"><a href="#cb182-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-32"><a href="#cb182-32" aria-hidden="true" tabindex="-1"></a>selection_methods_data_list <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb182-33"><a href="#cb182-33" aria-hidden="true" tabindex="-1"></a>  <span class="at">TodasVariables =</span> <span class="fu">list</span>(</span>
<span id="cb182-34"><a href="#cb182-34" aria-hidden="true" tabindex="-1"></a>    ANN_TodasVariables_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb182-35"><a href="#cb182-35" aria-hidden="true" tabindex="-1"></a>    SVM_TodasVariables_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb182-36"><a href="#cb182-36" aria-hidden="true" tabindex="-1"></a>    KNN_TodasVariables_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb182-37"><a href="#cb182-37" aria-hidden="true" tabindex="-1"></a>    RandomForest_TodasVariables_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb182-38"><a href="#cb182-38" aria-hidden="true" tabindex="-1"></a>    NaiveBayes_TodasVariables_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb182-39"><a href="#cb182-39" aria-hidden="true" tabindex="-1"></a>    AdaBoost_TodasVariables_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb182-40"><a href="#cb182-40" aria-hidden="true" tabindex="-1"></a>    RPart_TodasVariables_Metrics<span class="sc">$</span>performance_metrics</span>
<span id="cb182-41"><a href="#cb182-41" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb182-42"><a href="#cb182-42" aria-hidden="true" tabindex="-1"></a>  <span class="at">Asociacion =</span> <span class="fu">list</span>(</span>
<span id="cb182-43"><a href="#cb182-43" aria-hidden="true" tabindex="-1"></a>    ANN_Asociacion_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb182-44"><a href="#cb182-44" aria-hidden="true" tabindex="-1"></a>    SVM_Asociacion_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb182-45"><a href="#cb182-45" aria-hidden="true" tabindex="-1"></a>    KNN_Asociacion_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb182-46"><a href="#cb182-46" aria-hidden="true" tabindex="-1"></a>    RandomForest_Asociacion_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb182-47"><a href="#cb182-47" aria-hidden="true" tabindex="-1"></a>    NaiveBayes_Asociacion_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb182-48"><a href="#cb182-48" aria-hidden="true" tabindex="-1"></a>    AdaBoost_Asociacion_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb182-49"><a href="#cb182-49" aria-hidden="true" tabindex="-1"></a>    RPart_Asociacion_Metrics<span class="sc">$</span>performance_metrics</span>
<span id="cb182-50"><a href="#cb182-50" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb182-51"><a href="#cb182-51" aria-hidden="true" tabindex="-1"></a>  <span class="at">StepAUC =</span> <span class="fu">list</span>(</span>
<span id="cb182-52"><a href="#cb182-52" aria-hidden="true" tabindex="-1"></a>    ANN_StepAUC_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb182-53"><a href="#cb182-53" aria-hidden="true" tabindex="-1"></a>    SVM_StepAUC_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb182-54"><a href="#cb182-54" aria-hidden="true" tabindex="-1"></a>    KNN_StepAUC_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb182-55"><a href="#cb182-55" aria-hidden="true" tabindex="-1"></a>    RandomForest_StepAUC_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb182-56"><a href="#cb182-56" aria-hidden="true" tabindex="-1"></a>    NaiveBayes_StepAUC_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb182-57"><a href="#cb182-57" aria-hidden="true" tabindex="-1"></a>    AdaBoost_StepAUC_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb182-58"><a href="#cb182-58" aria-hidden="true" tabindex="-1"></a>    RPart_StepAUC_Metrics<span class="sc">$</span>performance_metrics</span>
<span id="cb182-59"><a href="#cb182-59" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb182-60"><a href="#cb182-60" aria-hidden="true" tabindex="-1"></a>  <span class="at">Lasso =</span> <span class="fu">list</span>(</span>
<span id="cb182-61"><a href="#cb182-61" aria-hidden="true" tabindex="-1"></a>    ANN_Lasso_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb182-62"><a href="#cb182-62" aria-hidden="true" tabindex="-1"></a>    SVM_Lasso_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb182-63"><a href="#cb182-63" aria-hidden="true" tabindex="-1"></a>    KNN_Lasso_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb182-64"><a href="#cb182-64" aria-hidden="true" tabindex="-1"></a>    NaiveBayes_Lasso_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb182-65"><a href="#cb182-65" aria-hidden="true" tabindex="-1"></a>    AdaBoost_Lasso_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb182-66"><a href="#cb182-66" aria-hidden="true" tabindex="-1"></a>    RPart_Lasso_Metrics<span class="sc">$</span>performance_metrics</span>
<span id="cb182-67"><a href="#cb182-67" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb182-68"><a href="#cb182-68" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb182-69"><a href="#cb182-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-70"><a href="#cb182-70" aria-hidden="true" tabindex="-1"></a>violin_plot <span class="ot">&lt;-</span> <span class="fu">generate_auc_feature_selection_violin_plot</span>(selection_methods_data_list)</span>
<span id="cb182-71"><a href="#cb182-71" aria-hidden="true" tabindex="-1"></a>violin_plot</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-4384c319d8f4065d1b4d" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-4384c319d8f4065d1b4d">{"x":{"visdat":{"3f58345960c0":["function () ","plotlyVisDat"]},"cur_data":"3f58345960c0","attrs":{"3f58345960c0":{"y":{},"box":{"visible":true},"meanline":{"visible":true},"split":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"violin"}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"Comparativa Global del AUC por Método de Selección de Características","yaxis":{"domain":[0,1],"automargin":true,"title":"AUC"},"xaxis":{"domain":[0,1],"automargin":true,"title":"Métodos de Selección de Características"},"hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"fillcolor":"rgba(31,119,180,0.5)","y":[0.73363095238095233,0.78141534391534395,0.74191176470588238,0.75591634562465604,0.63609641387419158,0.81279069767441858,0.74848651623555307,0.71153846153846156,0.77022058823529416,0.76043503821281599,0.72976190476190472,0.65986159169550174,0.75496974935177186,0.77118100128369704,0.77161076995748701,0.77229654403567449,0.77683823529411766,0.77843915343915349,0.68693181818181814,0.71981707317073174,0.75029761904761905,0.75740259740259741,0.80426356589147285,0.65310846560846558,0.81859756097560976,0.61859756097560981,0.56578947368421051,0.75648148148148142,0.65426829268292686,0.6722560975609756,0.67592592592592593,0.66720154043645696,0.61310975609756102,0.53475609756097564,0.68414634146341469,0.61403508771929827,0.56432926829268293,0.66219512195121955,0.56128048780487805,0.68384146341463414,0.66097560975609759,0.54645873944119561,0.58689024390243905,0.72225609756097564,0.48109756097560974,0.46250000000000002,0.58079268292682928,0.59876543209876543,0.6634146341463415,0.75609756097560976,0.72621951219512193,0.70988446726572529,0.78179012345679011,0.74542682926829262,0.76951219512195124,0.79907407407407405,0.72946084724005134,0.78018292682926826,0.67560975609756102,0.73048780487804876,0.75990903183885639,0.78170731707317076,0.69786585365853659,0.71219512195121948,0.75335365853658531,0.8213414634146341,0.75243664717348924,0.74695121951219512,0.69695121951219507,0.71829268292682924,0.69969512195121952,0.81219512195121946,0.75679012345679009,0.73079268292682931,0.75577663671373552,0.63292682926829269,0.67843388960205397,0.61111111111111116,0.72652439024390247,0.64512195121951221,0.67037037037037028,0.69576379974326052,0.69329268292682922,0.64237804878048776,0.63750000000000007,0.67381416504223512,0.69054878048780488,0.61615853658536579,0.5649390243902439,0.68323170731707317,0.71189024390243905,0.65464587394411955,0.613719512195122,0.61128048780487798,0.61676829268292677,0.64085365853658538,0.67164634146341462,0.63240740740740742,0.58841463414634143,0.65308087291399231,0.72652439024390236,0.68709884467265725,0.76265432098765429,0.73780487804878048,0.78140243902439022,0.80679012345679013,0.73202824133504496,0.77042682926829265,0.70487804878048788,0.70609756097560972,0.75113710201429496,0.76981707317073167,0.7115853658536585,0.72256097560975607,0.73262195121951224,0.73414634146341462,0.74528914879792063,0.6875,0.79542682926829267,0.69573170731707323,0.72774390243902443,0.7972560975609756,0.72592592592592597,0.67500000000000004,0.78754813863928108,0.70426829268292679,0.73331193838254172,0.71512345679012346,0.74176829268292677,0.7780487804878049,0.81111111111111112,0.7339537869062901,0.78231707317073174,0.66829268292682931,0.74146341463414633,0.66471734892787526,0.75731707317073171,0.67743902439024384,0.71036585365853655,0.69481707317073171,0.72408536585365857,0.7550357374918778,0.71676829268292686,0.72896341463414627,0.65670731707317076,0.76158536585365855,0.77591463414634143,0.74135802469135803,0.6786585365853659,0.77214377406931967,0.66219512195121943,0.70827984595635429,0.5,0.71250000000000002,0.5,0.78518518518518521,0.69833119383825415,0.74176829268292688,0.61524390243902438,0.68445121951219512,0.6871345029239766,0.77987804878048772,0.66707317073170735,0.61402439024390243,0.69207317073170727,0.761280487804878,0.7586094866796621,0.73353658536585364,0.68414634146341458,0.5753048780487805,0.72957317073170735,0.5,0.65987654320987654,0.67408536585365852,0.5],"box":{"visible":true},"meanline":{"visible":true},"type":"violin","name":"Asociacion","marker":{"color":"rgba(31,119,180,1)","line":{"color":"rgba(31,119,180,1)"}},"line":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","frame":null},{"fillcolor":"rgba(255,127,14,0.5)","y":[0.74166666666666703,0.84689153439153397,0.73308823529411804,0.77050082553659904,0.68489124044679595,0.81395348837209303,0.74903687396807905,0.69230769230769196,0.80551470588235297,0.75161669606114001,0.73244047619047603,0.72076124567473998,0.71996542783059603,0.77471116816431296,0.76476145488899405,0.75222965440356704,0.79080882352941195,0.77116402116402105,0.69829545454545505,0.69390243902438997,0.78244047619047596,0.72779220779220799,0.75,0.61541005291005302,0.80945121951219501,0.60701219512195104,0.57028241335044905,0.70308641975308594,0.64725609756097602,0.74786585365853697,0.78580246913580198,0.55905006418485204,0.65396341463414598,0.63871951219512202,0.68963414634146303,0.70142949967511403,0.73506097560975603,0.67713414634146296,0.673170731707317,0.59329268292682902,0.508536585365854,0.59096816114359996,0.53475609756097597,0.72042682926829305,0.55274390243902405,0.67926829268292699,0.61707317073170698,0.72469135802469098,0.51676829268292701,0.563222079589217,0.73124999999999996,0.77777777777777801,0.78965517241379302,0.75175438596491195,0.57746913580246895,0.79411764705882304,0.61454545454545495,0.65100154083204897,0.884533898305085,0.76865671641791,0.64473684210526305,0.61666666666666703,0.870056497175141,0.640625,0.83437499999999998,0.80142857142857105,0.83999999999999997,0.63788487282463202,0.67708333333333304,0.50816993464052296,0.75628930817610096,0.75721153846153899,0.54500000000000004,0.72619047619047605,0.74243421052631597,0.68323170731707294,0.70282413350449302,0.79691358024691406,0.72286585365853695,0.71951219512195097,0.77932098765432101,0.70186136071886995,0.78810975609756095,0.60731707317073202,0.76463414634146298,0.73976608187134496,0.71737804878048805,0.74085365853658502,0.73689024390243896,0.73140243902438995,0.75060975609756098,0.72807017543859598,0.69725609756097595,0.76524390243902396,0.74329268292682904,0.75731707317073205,0.83384146341463405,0.74228395061728403,0.70121951219512202,0.75288831835686798,0.66463414634146301,0.71726572528883203,0.76944444444444404,0.76951219512195101,0.798170731707317,0.77932098765432101,0.70282413350449302,0.77439024390243905,0.70213414634146298,0.76219512195121997,0.73196881091617905,0.73689024390243896,0.74664634146341502,0.73231707317073202,0.71097560975609797,0.79451219512195104,0.75211176088369103,0.71341463414634099,0.77317073170731698,0.68597560975609795,0.73658536585365897,0.81493902439024402,0.76882716049382704,0.65121951219512197,0.72528883183568704,0.69821428571428601,0.67195767195767198,0.73419117647058796,0.70638414969730301,0.5,0.76007751937984502,0.5,0.5,0.77095588235294099,0.70928865373309802,0.68482142857142803,0.5,0.57994814174589404,0.75224646983311905,0.70358998582900301,0.5,0.71544117647058803,0.75264550264550301,0.5,0.66219512195121999,0.73601190476190503,0.5,0.68294573643410905,0.60615079365079405,0.75823170731707301],"box":{"visible":true},"meanline":{"visible":true},"type":"violin","name":"Lasso","marker":{"color":"rgba(255,127,14,1)","line":{"color":"rgba(255,127,14,1)"}},"line":{"color":"rgba(255,127,14,1)"},"xaxis":"x","yaxis":"y","frame":null},{"fillcolor":"rgba(44,160,44,0.5)","y":[0.71726190476190499,0.79794973544973502,0.723161764705882,0.75288937809576195,0.64050558495002896,0.79534883720930205,0.75206384149697303,0.66639957264957295,0.811029411764706,0.72545561434450301,0.72916666666666696,0.64394463667820101,0.72687986171132202,0.73587933247753501,0.76948512045347195,0.76254180602006705,0.73602941176470604,0.75363756613756605,0.62954545454545496,0.71951219512195097,0.73005952380952399,0.68441558441558403,0.81976744186046502,0.58763227513227501,0.78780487804878097,0.52256097560975601,0.51347881899871595,0.67469135802469105,0.70304878048780495,0.68536585365853697,0.65833333333333299,0.52182284980744498,0.65792682926829305,0.69207317073170704,0.66006097560975596,0.61078622482131295,0.59512195121951195,0.59634146341463401,0.55487804878048796,0.684756097560976,0.51890243902439004,0.73001949317738801,0.65975609756097597,0.52073170731707297,0.54085365853658496,0.58292682926829298,0.62865853658536597,0.61296296296296304,0.66219512195121999,0.65853658536585402,0.72103658536585402,0.72560975609756095,0.65895061728395099,0.62957317073170704,0.73079268292682897,0.79320987654320996,0.71084724005134803,0.79207317073170702,0.68841463414634096,0.70396341463414602,0.67803768680961696,0.72256097560975596,0.69268292682926802,0.73506097560975603,0.76859756097561005,0.66859756097560996,0.76543209876543195,0.72408536585365901,0.70152439024390201,0.73231707317073202,0.70884146341463405,0.755792682926829,0.77283950617283903,0.68567073170731696,0.70025673940949895,0.5,0.594993581514762,0.63734567901234596,0.71067073170731698,0.72225609756097597,0.71388888888888902,0.71694480102695801,0.69054878048780499,0.63658536585365899,0.55945121951219501,0.772579597141001,0.70060975609756104,0.70121951219512202,0.63292682926829302,0.68323170731707294,0.76524390243902396,0.76218323586744596,0.63506097560975605,0.77317073170731698,0.6875,0.66859756097560996,0.698780487804878,0.67469135802469105,0.63536585365853704,0.65404364569961504,0.72743902439024399,0.71405648267009003,0.78858024691357997,0.70518292682926798,0.76615853658536603,0.79598765432098795,0.751604621309371,0.78506097560975596,0.65884146341463401,0.730182926829268,0.78784925276153295,0.75914634146341498,0.76463414634146298,0.72134146341463401,0.71707317073170695,0.75121951219512195,0.72449642625081201,0.64176829268292701,0.78079268292682902,0.69908536585365899,0.73475609756097604,0.80548780487804905,0.75493827160493798,0.676219512195122,0.80102695763799703,0.70152439024390201,0.71598202824133494,0.70987654320987603,0.73201219512195104,0.77317073170731698,0.79537037037036995,0.723042362002567,0.79939024390243896,0.70213414634146298,0.744207317073171,0.78232618583495805,0.74969512195121901,0.78262195121951195,0.70945121951219503,0.70548780487804896,0.77957317073170695,0.71669915529564698,0.70213414634146298,0.73628048780487798,0.65609756097561001,0.74603658536585404,0.79420731707317105,0.77129629629629604,0.64847560975609797,0.76636713735558404,0.5,0.65917843388960196,0.64259259259259205,0.65182926829268295,0.67926829268292699,0.75987654320987696,0.69929396662387699,0.67500000000000004,0.59451219512195097,0.741463414634146,0.70532813515269699,0.72560975609756095,0.5,0.64237804878048799,0.67134146341463397,0.5,0.71442495126705696,0.70914634146341504,0.70945121951219503,0.56768292682926802,0.58353658536585395,0.72073170731707303,0.71111111111111103,0.60670731707317105,0.678754813863928],"box":{"visible":true},"meanline":{"visible":true},"type":"violin","name":"StepAUC","marker":{"color":"rgba(44,160,44,1)","line":{"color":"rgba(44,160,44,1)"}},"line":{"color":"rgba(44,160,44,1)"},"xaxis":"x","yaxis":"y","frame":null},{"fillcolor":"rgba(214,39,40,0.5)","y":[0.75714285714285712,0.78604497354497349,0.71323529411764708,0.75013758943313158,0.66255144032921809,0.84147286821705425,0.71684094661529996,0.70512820512820507,0.76213235294117643,0.71340388007054667,0.72261904761904761,0.71349480968858126,0.77614520311149526,0.74711168164313224,0.78767123287671237,0.72240802675585281,0.7904411764705882,0.79067460317460314,0.69289772727272725,0.68902439024390238,0.78363095238095237,0.74883116883116885,0.81666666666666665,0.63492063492063489,0.81554878048780488,0.72225609756097564,0.6241976893453145,0.61049382716049383,0.57286585365853659,0.61006097560975614,0.59753086419753088,0.70154043645699615,0.67774390243902438,0.63567073170731703,0.58689024390243905,0.75536062378167634,0.64573170731707319,0.56402439024390238,0.63170731707317074,0.54115853658536583,0.50060975609756098,0.4993502274204028,0.55060975609756091,0.61036585365853657,0.70457317073170733,0.74390243902439024,0.65792682926829271,0.50771604938271608,0.52743902439024393,0.63896020539152765,0.73109756097560974,0.60141206675224645,0.69228395061728398,0.62012195121951219,0.79054878048780486,0.68271604938271602,0.64441591784338892,0.698780487804878,0.58841463414634143,0.76737804878048776,0.72514619883040932,0.673170731707317,0.76371951219512191,0.6963414634146341,0.70457317073170733,0.65701219512195119,0.71052631578947367,0.60731707317073169,0.65701219512195119,0.7908536585365854,0.74207317073170731,0.72317073170731705,0.69475308641975309,0.67530487804878048,0.69993581514762515,0.69268292682926824,0.63735558408215665,0.63796296296296295,0.70396341463414636,0.64237804878048776,0.72746913580246908,0.71790757381258019,0.72530487804878052,0.65701219512195119,0.73445121951219505,0.71442495126705652,0.67042682926829267,0.69786585365853659,0.65701219512195119,0.62317073170731707,0.69481707317073171,0.70890188434048074,0.613719512195122,0.6914634146341464,0.69359756097560976,0.69969512195121952,0.71646341463414631,0.71759259259259256,0.60579268292682931,0.66688061617458283,0.72774390243902443,0.70635430038510916,0.76975308641975304,0.72408536585365857,0.78262195121951217,0.7944444444444444,0.74133504492939672,0.77713414634146338,0.70884146341463417,0.70884146341463417,0.7657569850552306,0.77195121951219514,0.73414634146341462,0.72317073170731705,0.71920731707317076,0.7475609756097561,0.7300194931773879,0.69268292682926824,0.78597560975609759,0.70853658536585362,0.74207317073170731,0.81280487804878054,0.74783950617283945,0.69085365853658542,0.7853016688061617,0.70518292682926831,0.70057766367137353,0.73302469135802462,0.73506097560975614,0.78780487804878052,0.7910493827160493,0.73074454428754809,0.77591463414634143,0.676219512195122,0.71737804878048783,0.72677063027940214,0.6890243902439025,0.7347560975609756,0.72347560975609759,0.67164634146341462,0.75121951219512195,0.73684210526315785,0.68231707317073165,0.71707317073170729,0.70426829268292679,0.77469512195121948,0.81036585365853653,0.7432098765432098,0.69573170731707312,0.67458279845956348,0.69115853658536586,0.65436456996148906,0.53240740740740733,0.72652439024390247,0.73628048780487798,0.77654320987654313,0.68709884467265725,0.801219512195122,0.53262195121951228,0.7667682926829269,0.66374269005847952,0.71890243902439022,0.5,0.68048780487804883,0.63567073170731703,0.76219512195121952,0.71247563352826515,0.72225609756097564,0.67347560975609755,0.65975609756097564,0.7740853658536585,0.76798780487804874,0.7231481481481481,0.60365853658536583,0.71052631578947356],"box":{"visible":true},"meanline":{"visible":true},"type":"violin","name":"TodasVariables","marker":{"color":"rgba(214,39,40,1)","line":{"color":"rgba(214,39,40,1)"}},"line":{"color":"rgba(214,39,40,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>Como se puede observar, todos los métodos de selección de variables exhiben un comportamiento similar, esto se puede concluir al observar la dispersión, media, y mediana del AUC a través de todo ellos. Sin embargo, se debe destacar el método de selección de variables Lasso, ya que todos los modelos que lo han empleado han obtenido de media un AUC de 0.703, y muestra una dispersión de los datos menor que el resto de métodos de selección, con un rango de 0.34, justificando que este método de selección de variables aporta una mayor estabilidad al método que lo acompaña.</p>
</div>
<div id="tabset-25-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-25-3-tab">
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb183"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb183-1"><a href="#cb183-1" aria-hidden="true" tabindex="-1"></a>generate_auc_heatmap <span class="ot">&lt;-</span> <span class="cf">function</span>(model_data_list, selection_methods) {</span>
<span id="cb183-2"><a href="#cb183-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Inicializar una lista para almacenar los datos combinados</span></span>
<span id="cb183-3"><a href="#cb183-3" aria-hidden="true" tabindex="-1"></a>  combined_data <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb183-4"><a href="#cb183-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb183-5"><a href="#cb183-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Recorrer cada modelo en el vector de listas</span></span>
<span id="cb183-6"><a href="#cb183-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (model_name <span class="cf">in</span> <span class="fu">names</span>(model_data_list)) {</span>
<span id="cb183-7"><a href="#cb183-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Obtener los dataframes para cada método de selección de características</span></span>
<span id="cb183-8"><a href="#cb183-8" aria-hidden="true" tabindex="-1"></a>    model_methods <span class="ot">&lt;-</span> model_data_list[[model_name]]</span>
<span id="cb183-9"><a href="#cb183-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb183-10"><a href="#cb183-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (method_name <span class="cf">in</span> <span class="fu">names</span>(model_methods)) {</span>
<span id="cb183-11"><a href="#cb183-11" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Obtener el dataframe del método actual</span></span>
<span id="cb183-12"><a href="#cb183-12" aria-hidden="true" tabindex="-1"></a>      method_data <span class="ot">&lt;-</span> model_methods[[method_name]]</span>
<span id="cb183-13"><a href="#cb183-13" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb183-14"><a href="#cb183-14" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Combinar los dataframes y agregar columnas para el nombre del modelo y el método</span></span>
<span id="cb183-15"><a href="#cb183-15" aria-hidden="true" tabindex="-1"></a>      combined_data[[<span class="fu">paste</span>(model_name, method_name, <span class="at">sep =</span> <span class="st">"_"</span>)]] <span class="ot">&lt;-</span> method_data <span class="sc">%&gt;%</span></span>
<span id="cb183-16"><a href="#cb183-16" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">Model =</span> model_name, <span class="at">Method =</span> method_name)</span>
<span id="cb183-17"><a href="#cb183-17" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb183-18"><a href="#cb183-18" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb183-19"><a href="#cb183-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb183-20"><a href="#cb183-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Combinar todos los datos en un solo dataframe</span></span>
<span id="cb183-21"><a href="#cb183-21" aria-hidden="true" tabindex="-1"></a>  final_data <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(combined_data)</span>
<span id="cb183-22"><a href="#cb183-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb183-23"><a href="#cb183-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calcular el AUC promedio para cada combinación de modelo y método</span></span>
<span id="cb183-24"><a href="#cb183-24" aria-hidden="true" tabindex="-1"></a>  auc_summary <span class="ot">&lt;-</span> final_data <span class="sc">%&gt;%</span></span>
<span id="cb183-25"><a href="#cb183-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(Model, Method) <span class="sc">%&gt;%</span></span>
<span id="cb183-26"><a href="#cb183-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">AUC_Mean =</span> <span class="fu">mean</span>(AUC, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb183-27"><a href="#cb183-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>()</span>
<span id="cb183-28"><a href="#cb183-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb183-29"><a href="#cb183-29" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Crear el mapa de calor</span></span>
<span id="cb183-30"><a href="#cb183-30" aria-hidden="true" tabindex="-1"></a>  heatmap_plot <span class="ot">&lt;-</span> <span class="fu">plot_ly</span>(</span>
<span id="cb183-31"><a href="#cb183-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> auc_summary,</span>
<span id="cb183-32"><a href="#cb183-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="sc">~</span>Model,</span>
<span id="cb183-33"><a href="#cb183-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="sc">~</span>Method,</span>
<span id="cb183-34"><a href="#cb183-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">z =</span> <span class="sc">~</span>AUC_Mean,</span>
<span id="cb183-35"><a href="#cb183-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">type =</span> <span class="st">'heatmap'</span>,</span>
<span id="cb183-36"><a href="#cb183-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">colorscale =</span> <span class="st">'Viridis'</span>,</span>
<span id="cb183-37"><a href="#cb183-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">colorbar =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">'AUC Promedio'</span>)</span>
<span id="cb183-38"><a href="#cb183-38" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb183-39"><a href="#cb183-39" aria-hidden="true" tabindex="-1"></a>    <span class="fu">layout</span>(</span>
<span id="cb183-40"><a href="#cb183-40" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="st">'Mapa de Calor de AUC Promedio por Modelo y Método de Selección de Características'</span>,</span>
<span id="cb183-41"><a href="#cb183-41" aria-hidden="true" tabindex="-1"></a>      <span class="at">xaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">'Modelos'</span>),</span>
<span id="cb183-42"><a href="#cb183-42" aria-hidden="true" tabindex="-1"></a>      <span class="at">yaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">'Métodos de Selección de Características'</span>)</span>
<span id="cb183-43"><a href="#cb183-43" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb183-44"><a href="#cb183-44" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb183-45"><a href="#cb183-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(heatmap_plot)</span>
<span id="cb183-46"><a href="#cb183-46" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb183-47"><a href="#cb183-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-48"><a href="#cb183-48" aria-hidden="true" tabindex="-1"></a><span class="co"># Ejemplo de uso</span></span>
<span id="cb183-49"><a href="#cb183-49" aria-hidden="true" tabindex="-1"></a><span class="co"># Preparación de los datos con los mismos dataframes que antes</span></span>
<span id="cb183-50"><a href="#cb183-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-51"><a href="#cb183-51" aria-hidden="true" tabindex="-1"></a>model_data_list <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb183-52"><a href="#cb183-52" aria-hidden="true" tabindex="-1"></a>  <span class="at">ANN =</span> <span class="fu">list</span>(</span>
<span id="cb183-53"><a href="#cb183-53" aria-hidden="true" tabindex="-1"></a>    <span class="at">TodasVariables =</span> ANN_TodasVariables_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb183-54"><a href="#cb183-54" aria-hidden="true" tabindex="-1"></a>    <span class="at">Asociacion =</span> ANN_Asociacion_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb183-55"><a href="#cb183-55" aria-hidden="true" tabindex="-1"></a>    <span class="at">StepAUC =</span> ANN_StepAUC_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb183-56"><a href="#cb183-56" aria-hidden="true" tabindex="-1"></a>    <span class="at">Lasso =</span> ANN_Lasso_Metrics<span class="sc">$</span>performance_metrics</span>
<span id="cb183-57"><a href="#cb183-57" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb183-58"><a href="#cb183-58" aria-hidden="true" tabindex="-1"></a>  <span class="at">SVM =</span> <span class="fu">list</span>(</span>
<span id="cb183-59"><a href="#cb183-59" aria-hidden="true" tabindex="-1"></a>    <span class="at">TodasVariables =</span> SVM_TodasVariables_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb183-60"><a href="#cb183-60" aria-hidden="true" tabindex="-1"></a>    <span class="at">Asociacion =</span> SVM_Asociacion_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb183-61"><a href="#cb183-61" aria-hidden="true" tabindex="-1"></a>    <span class="at">StepAUC =</span> SVM_StepAUC_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb183-62"><a href="#cb183-62" aria-hidden="true" tabindex="-1"></a>    <span class="at">Lasso =</span> SVM_Lasso_Metrics<span class="sc">$</span>performance_metrics</span>
<span id="cb183-63"><a href="#cb183-63" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb183-64"><a href="#cb183-64" aria-hidden="true" tabindex="-1"></a>  <span class="at">KNN =</span> <span class="fu">list</span>(</span>
<span id="cb183-65"><a href="#cb183-65" aria-hidden="true" tabindex="-1"></a>    <span class="at">TodasVariables =</span> KNN_TodasVariables_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb183-66"><a href="#cb183-66" aria-hidden="true" tabindex="-1"></a>    <span class="at">Asociacion =</span> KNN_Asociacion_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb183-67"><a href="#cb183-67" aria-hidden="true" tabindex="-1"></a>    <span class="at">StepAUC =</span> KNN_StepAUC_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb183-68"><a href="#cb183-68" aria-hidden="true" tabindex="-1"></a>    <span class="at">Lasso =</span> KNN_Lasso_Metrics<span class="sc">$</span>performance_metrics</span>
<span id="cb183-69"><a href="#cb183-69" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb183-70"><a href="#cb183-70" aria-hidden="true" tabindex="-1"></a>  <span class="at">RandomForest =</span> <span class="fu">list</span>(</span>
<span id="cb183-71"><a href="#cb183-71" aria-hidden="true" tabindex="-1"></a>    <span class="at">TodasVariables =</span> RandomForest_TodasVariables_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb183-72"><a href="#cb183-72" aria-hidden="true" tabindex="-1"></a>    <span class="at">Asociacion =</span> RandomForest_Asociacion_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb183-73"><a href="#cb183-73" aria-hidden="true" tabindex="-1"></a>    <span class="at">StepAUC =</span> RandomForest_StepAUC_Metrics<span class="sc">$</span>performance_metrics</span>
<span id="cb183-74"><a href="#cb183-74" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Lasso = No hay datos para este caso</span></span>
<span id="cb183-75"><a href="#cb183-75" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb183-76"><a href="#cb183-76" aria-hidden="true" tabindex="-1"></a>  <span class="at">NaiveBayes =</span> <span class="fu">list</span>(</span>
<span id="cb183-77"><a href="#cb183-77" aria-hidden="true" tabindex="-1"></a>    <span class="at">TodasVariables =</span> NaiveBayes_TodasVariables_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb183-78"><a href="#cb183-78" aria-hidden="true" tabindex="-1"></a>    <span class="at">Asociacion =</span> NaiveBayes_Asociacion_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb183-79"><a href="#cb183-79" aria-hidden="true" tabindex="-1"></a>    <span class="at">StepAUC =</span> NaiveBayes_StepAUC_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb183-80"><a href="#cb183-80" aria-hidden="true" tabindex="-1"></a>    <span class="at">Lasso =</span> NaiveBayes_Lasso_Metrics<span class="sc">$</span>performance_metrics</span>
<span id="cb183-81"><a href="#cb183-81" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb183-82"><a href="#cb183-82" aria-hidden="true" tabindex="-1"></a>  <span class="at">AdaBoost =</span> <span class="fu">list</span>(</span>
<span id="cb183-83"><a href="#cb183-83" aria-hidden="true" tabindex="-1"></a>    <span class="at">TodasVariables =</span> AdaBoost_TodasVariables_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb183-84"><a href="#cb183-84" aria-hidden="true" tabindex="-1"></a>    <span class="at">Asociacion =</span> AdaBoost_Asociacion_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb183-85"><a href="#cb183-85" aria-hidden="true" tabindex="-1"></a>    <span class="at">StepAUC =</span> AdaBoost_StepAUC_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb183-86"><a href="#cb183-86" aria-hidden="true" tabindex="-1"></a>    <span class="at">Lasso =</span> AdaBoost_Lasso_Metrics<span class="sc">$</span>performance_metrics</span>
<span id="cb183-87"><a href="#cb183-87" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb183-88"><a href="#cb183-88" aria-hidden="true" tabindex="-1"></a>  <span class="at">RPart =</span> <span class="fu">list</span>(</span>
<span id="cb183-89"><a href="#cb183-89" aria-hidden="true" tabindex="-1"></a>    <span class="at">TodasVariables =</span> RPart_TodasVariables_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb183-90"><a href="#cb183-90" aria-hidden="true" tabindex="-1"></a>    <span class="at">Asociacion =</span> RPart_Asociacion_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb183-91"><a href="#cb183-91" aria-hidden="true" tabindex="-1"></a>    <span class="at">StepAUC =</span> RPart_StepAUC_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb183-92"><a href="#cb183-92" aria-hidden="true" tabindex="-1"></a>    <span class="at">Lasso =</span> RPart_Lasso_Metrics<span class="sc">$</span>performance_metrics</span>
<span id="cb183-93"><a href="#cb183-93" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb183-94"><a href="#cb183-94" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb183-95"><a href="#cb183-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-96"><a href="#cb183-96" aria-hidden="true" tabindex="-1"></a><span class="co"># Generar y mostrar el mapa de calor</span></span>
<span id="cb183-97"><a href="#cb183-97" aria-hidden="true" tabindex="-1"></a>heatmap_plot <span class="ot">&lt;-</span> <span class="fu">generate_auc_heatmap</span>(model_data_list, <span class="fu">c</span>(<span class="st">"TodasVariables"</span>, <span class="st">"Asociacion"</span>, <span class="st">"StepAUC"</span>, <span class="st">"Lasso"</span>))</span>
<span id="cb183-98"><a href="#cb183-98" aria-hidden="true" tabindex="-1"></a>heatmap_plot</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-c71918601c44cee585be" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-c71918601c44cee585be">{"x":{"visdat":{"3f58513e1992":["function () ","plotlyVisDat"]},"cur_data":"3f58513e1992","attrs":{"3f58513e1992":{"x":{},"y":{},"z":{},"colorscale":"Viridis","colorbar":{"title":"AUC Promedio"},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"heatmap"}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"Mapa de Calor de AUC Promedio por Modelo y Método de Selección de Características","xaxis":{"domain":[0,1],"automargin":true,"title":"Modelos","type":"category","categoryorder":"array","categoryarray":["AdaBoost","ANN","KNN","NaiveBayes","RandomForest","RPart","SVM"]},"yaxis":{"domain":[0,1],"automargin":true,"title":"Métodos de Selección de Características","type":"category","categoryorder":"array","categoryarray":["Asociacion","Lasso","StepAUC","TodasVariables"]},"scene":{"zaxis":{"title":"AUC_Mean"}},"hovermode":"closest","showlegend":false,"legend":{"yanchor":"top","y":0.5}},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"colorbar":{"title":"AUC Promedio","ticklen":2,"len":0.5,"lenmode":"fraction","y":1,"yanchor":"top"},"colorscale":"Viridis","showscale":true,"x":["ANN","ANN","ANN","ANN","AdaBoost","AdaBoost","AdaBoost","AdaBoost","KNN","KNN","KNN","KNN","NaiveBayes","NaiveBayes","NaiveBayes","NaiveBayes","RPart","RPart","RPart","RPart","RandomForest","RandomForest","RandomForest","SVM","SVM","SVM","SVM"],"y":["Asociacion","Lasso","StepAUC","TodasVariables","Asociacion","Lasso","StepAUC","TodasVariables","Asociacion","Lasso","StepAUC","TodasVariables","Asociacion","Lasso","StepAUC","TodasVariables","Asociacion","Lasso","StepAUC","TodasVariables","Asociacion","StepAUC","TodasVariables","Asociacion","Lasso","StepAUC","TodasVariables"],"z":[0.74631279089980773,0.7477440832299187,0.72793469601087768,0.74560706038735924,0.72902142664701497,0.74058939127402967,0.73773840314426531,0.7275574335567917,0.74575609756097561,0.71755655922587347,0.71867075547948456,0.69352318578741345,0.73899984944293884,0.73619616792659148,0.74171720629486992,0.7439614494682959,0.66498203616539087,0.64741189234065477,0.65396876337184429,0.68853422399721076,0.65027290448343078,0.67711561197483328,0.6819324949682245,0.62349850235344462,0.63964861566744313,0.61787160652308282,0.61674746034010053],"type":"heatmap","xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>Como se puede obserbar en el mapa de calor superior, las conclusiones finales de los dos estudios anteriores parecen justificarse con esta visualización. Los métodos NaiveBayes, con todas las variables del problema, Adaboost, con el método de selección Lasso, ANN, con Lasso también, y KNN, con asociación, muestran los AUC promedio globales más altos de todos.</p>
</div>
</div>
</div>
<p>Se concluye que los modelos que pasarán a la siguiente etapa de inspección serán:</p>
<ol type="1">
<li><strong>Naive Bayes con TodasVariables</strong>, con un AUC promedio de 0.7439, y un comportamiento estable.</li>
<li><strong>AdaBoost con Lasso</strong>, con un AUC promedio de 0.74, y un comportamiento estable.</li>
<li><strong>ANN con Lasso</strong>, con un AUC promedio de 0.747, y un comportamiento estable.</li>
<li><strong>KNN con Asociacion</strong>, con un AUC promedio de 0.745, y un comportamiento algo inestable.</li>
</ol>
</section>
</section>
<section id="estabilidad-para-hiperparámetros" class="level2" data-number="4.3">
<h2 data-number="4.3" class="anchored" data-anchor-id="estabilidad-para-hiperparámetros"><span class="header-section-number">4.3</span> Estabilidad para Hiperparámetros</h2>
<p>La estabilidad de los hiperparámetros merece ser explorada durante esta evaluación de modelos de ML. Una inspección detallada de estos parámetros permite entender mejor cómo influyen en el rendimiento del modelo y garantiza que las configuraciones seleccionadas no sean producto del azar. En este apartado, se analizarán los hiperparámetros de los modelos seleccionados anteriormente, utilizando dos funciones de visualización diferentes: una para modelos con dos hiperparámetros y otra para Adaboost, que tiene un único hiperparámetro.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-26-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-26-1" role="tab" aria-controls="tabset-26-1" aria-selected="true" href="">Mapa de Calor para Modelos con 2 hiperparámetros</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-26-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-26-2" role="tab" aria-controls="tabset-26-2" aria-selected="false" href="">Gráfico de Barras para modelos con 1 hiperparámetro</a></li></ul>
<div class="tab-content">
<div id="tabset-26-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-26-1-tab">
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb184"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb184-1"><a href="#cb184-1" aria-hidden="true" tabindex="-1"></a>generate_combined_hyperparameter_stability_analysis <span class="ot">&lt;-</span> <span class="cf">function</span>(df1, df2, df3, df4, hyperparameters) {</span>
<span id="cb184-2"><a href="#cb184-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Combinamos los data.frames en uno solo</span></span>
<span id="cb184-3"><a href="#cb184-3" aria-hidden="true" tabindex="-1"></a>  combined_df <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(df1, df2, df3, df4)</span>
<span id="cb184-4"><a href="#cb184-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb184-5"><a href="#cb184-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Reemplazamos los NaN por 0 en las columnas de hiperparámetros</span></span>
<span id="cb184-6"><a href="#cb184-6" aria-hidden="true" tabindex="-1"></a>  param1 <span class="ot">&lt;-</span> <span class="fu">names</span>(hyperparameters)[<span class="dv">1</span>]</span>
<span id="cb184-7"><a href="#cb184-7" aria-hidden="true" tabindex="-1"></a>  param2 <span class="ot">&lt;-</span> <span class="fu">names</span>(hyperparameters)[<span class="dv">2</span>]</span>
<span id="cb184-8"><a href="#cb184-8" aria-hidden="true" tabindex="-1"></a>  combined_df[<span class="fu">is.na</span>(combined_df[[param1]]), param1] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb184-9"><a href="#cb184-9" aria-hidden="true" tabindex="-1"></a>  combined_df[<span class="fu">is.na</span>(combined_df[[param2]]), param2] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb184-10"><a href="#cb184-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb184-11"><a href="#cb184-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Contamos las frecuencias de cada combinación de hiperparámetros</span></span>
<span id="cb184-12"><a href="#cb184-12" aria-hidden="true" tabindex="-1"></a>  freq_table <span class="ot">&lt;-</span> combined_df <span class="sc">%&gt;%</span></span>
<span id="cb184-13"><a href="#cb184-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">count</span>(<span class="sc">!!</span><span class="fu">sym</span>(param1), <span class="sc">!!</span><span class="fu">sym</span>(param2)) <span class="sc">%&gt;%</span></span>
<span id="cb184-14"><a href="#cb184-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">Frequency =</span> n)</span>
<span id="cb184-15"><a href="#cb184-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb184-16"><a href="#cb184-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Aseguramos que todas las combinaciones posibles están presentes</span></span>
<span id="cb184-17"><a href="#cb184-17" aria-hidden="true" tabindex="-1"></a>  all_combinations <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(hyperparameters[[param1]], hyperparameters[[param2]])</span>
<span id="cb184-18"><a href="#cb184-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(all_combinations) <span class="ot">&lt;-</span> <span class="fu">c</span>(param1, param2)</span>
<span id="cb184-19"><a href="#cb184-19" aria-hidden="true" tabindex="-1"></a>  freq_table <span class="ot">&lt;-</span> <span class="fu">right_join</span>(all_combinations, freq_table, <span class="at">by =</span> <span class="fu">c</span>(param1, param2))</span>
<span id="cb184-20"><a href="#cb184-20" aria-hidden="true" tabindex="-1"></a>  freq_table[<span class="fu">is.na</span>(freq_table)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb184-21"><a href="#cb184-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb184-22"><a href="#cb184-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Creación del mapa de calor</span></span>
<span id="cb184-23"><a href="#cb184-23" aria-hidden="true" tabindex="-1"></a>  heatmap_plot <span class="ot">&lt;-</span> <span class="fu">plot_ly</span>(</span>
<span id="cb184-24"><a href="#cb184-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> freq_table,</span>
<span id="cb184-25"><a href="#cb184-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="sc">~</span><span class="fu">get</span>(param1),</span>
<span id="cb184-26"><a href="#cb184-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="sc">~</span><span class="fu">get</span>(param2),</span>
<span id="cb184-27"><a href="#cb184-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">z =</span> <span class="sc">~</span>Frequency,</span>
<span id="cb184-28"><a href="#cb184-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">type =</span> <span class="st">"heatmap"</span>,</span>
<span id="cb184-29"><a href="#cb184-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">colorscale =</span> <span class="st">"Viridis"</span></span>
<span id="cb184-30"><a href="#cb184-30" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb184-31"><a href="#cb184-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">layout</span>(</span>
<span id="cb184-32"><a href="#cb184-32" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="fu">paste</span>(<span class="st">"Heatmap of"</span>, param1, <span class="st">"and"</span>, param2, <span class="st">"Frequency"</span>),</span>
<span id="cb184-33"><a href="#cb184-33" aria-hidden="true" tabindex="-1"></a>      <span class="at">xaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> param1),</span>
<span id="cb184-34"><a href="#cb184-34" aria-hidden="true" tabindex="-1"></a>      <span class="at">yaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> param2)</span>
<span id="cb184-35"><a href="#cb184-35" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb184-36"><a href="#cb184-36" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb184-37"><a href="#cb184-37" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Devolvemos el mapa de calor</span></span>
<span id="cb184-38"><a href="#cb184-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(heatmap_plot)</span>
<span id="cb184-39"><a href="#cb184-39" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Esta función combina los resultados de múltiples data.frames y crea un mapa de calor que muestra la frecuencia de las combinaciones de dos hiperparámetros. Se reemplazan los valores faltantes por ceros, se asegura de que todas las combinaciones posibles de hiperparámetros estén presentes y, finalmente, se utiliza <code>plot_ly</code> para generar el mapa de calor.</p>
</div>
<div id="tabset-26-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-26-2-tab">
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb185"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb185-1"><a href="#cb185-1" aria-hidden="true" tabindex="-1"></a>generate_adaboost_hyperparameter_analysis <span class="ot">&lt;-</span> <span class="cf">function</span>(df1, df2, df3, df4, hyperparameters) {</span>
<span id="cb185-2"><a href="#cb185-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Combinamos los data.frames en uno solo</span></span>
<span id="cb185-3"><a href="#cb185-3" aria-hidden="true" tabindex="-1"></a>  combined_df <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(df1, df2, df3, df4)</span>
<span id="cb185-4"><a href="#cb185-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb185-5"><a href="#cb185-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Obtenemos el nombre del hiperparámetro</span></span>
<span id="cb185-6"><a href="#cb185-6" aria-hidden="true" tabindex="-1"></a>  param <span class="ot">&lt;-</span> <span class="fu">names</span>(hyperparameters)[<span class="dv">1</span>]</span>
<span id="cb185-7"><a href="#cb185-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb185-8"><a href="#cb185-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Reemplazamos los NaN por 0 en la columna del hiperparámetro</span></span>
<span id="cb185-9"><a href="#cb185-9" aria-hidden="true" tabindex="-1"></a>  combined_df[<span class="fu">is.na</span>(combined_df[[param]]), param] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb185-10"><a href="#cb185-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb185-11"><a href="#cb185-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Contamos las frecuencias de cada valor del hiperparámetro</span></span>
<span id="cb185-12"><a href="#cb185-12" aria-hidden="true" tabindex="-1"></a>  freq_table <span class="ot">&lt;-</span> combined_df <span class="sc">%&gt;%</span></span>
<span id="cb185-13"><a href="#cb185-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">count</span>(<span class="sc">!!</span><span class="fu">sym</span>(param)) <span class="sc">%&gt;%</span></span>
<span id="cb185-14"><a href="#cb185-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">Frequency =</span> n)</span>
<span id="cb185-15"><a href="#cb185-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb185-16"><a href="#cb185-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Creación del gráfico de barras</span></span>
<span id="cb185-17"><a href="#cb185-17" aria-hidden="true" tabindex="-1"></a>  bar_plot <span class="ot">&lt;-</span> <span class="fu">plot_ly</span>(</span>
<span id="cb185-18"><a href="#cb185-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> freq_table,</span>
<span id="cb185-19"><a href="#cb185-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="sc">~</span><span class="fu">get</span>(param),</span>
<span id="cb185-20"><a href="#cb185-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="sc">~</span>Frequency,</span>
<span id="cb185-21"><a href="#cb185-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">type =</span> <span class="st">'bar'</span></span>
<span id="cb185-22"><a href="#cb185-22" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb185-23"><a href="#cb185-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">layout</span>(</span>
<span id="cb185-24"><a href="#cb185-24" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="fu">paste</span>(<span class="st">"Bar Plot of"</span>, param, <span class="st">"Frequency"</span>),</span>
<span id="cb185-25"><a href="#cb185-25" aria-hidden="true" tabindex="-1"></a>      <span class="at">xaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> param),</span>
<span id="cb185-26"><a href="#cb185-26" aria-hidden="true" tabindex="-1"></a>      <span class="at">yaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">"Frequency"</span>)</span>
<span id="cb185-27"><a href="#cb185-27" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb185-28"><a href="#cb185-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb185-29"><a href="#cb185-29" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Devolvemos el gráfico de barras</span></span>
<span id="cb185-30"><a href="#cb185-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(bar_plot)</span>
<span id="cb185-31"><a href="#cb185-31" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Esta función se enfoca en modelos con un único hiperparámetro, como Adaboost. Esta función combina varios data.frames y crea un gráfico de barras que muestra la frecuencia de los valores de este hiperparámetro. Similarmente, los valores faltantes se reemplazan por ceros y se cuenta la frecuencia de cada valor del hiperparámetro.</p>
</div>
</div>
</div>
<p>Se incluye la discusión:</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-27-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-27-1" role="tab" aria-controls="tabset-27-1" aria-selected="true" href="">KNN</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-27-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-27-2" role="tab" aria-controls="tabset-27-2" aria-selected="false" href="">ANN</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-27-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-27-3" role="tab" aria-controls="tabset-27-3" aria-selected="false" href="">AdaBoost</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-27-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-27-4" role="tab" aria-controls="tabset-27-4" aria-selected="false" href="">Naive Bayes</a></li></ul>
<div class="tab-content">
<div id="tabset-27-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-27-1-tab">
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb186"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb186-1"><a href="#cb186-1" aria-hidden="true" tabindex="-1"></a>hyperparameters <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb186-2"><a href="#cb186-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">Best_k =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">16</span>, <span class="dv">20</span>, <span class="dv">25</span>, <span class="dv">30</span>, <span class="dv">32</span>),</span>
<span id="cb186-3"><a href="#cb186-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">Best_l =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>)</span>
<span id="cb186-4"><a href="#cb186-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb186-5"><a href="#cb186-5" aria-hidden="true" tabindex="-1"></a>result_knn <span class="ot">&lt;-</span> <span class="fu">generate_combined_hyperparameter_stability_analysis</span>(KNN_TodasVariables_Metrics<span class="sc">$</span>performance_metrics, </span>
<span id="cb186-6"><a href="#cb186-6" aria-hidden="true" tabindex="-1"></a>                                                              KNN_Asociacion_Metrics<span class="sc">$</span>performance_metrics, </span>
<span id="cb186-7"><a href="#cb186-7" aria-hidden="true" tabindex="-1"></a>                                                              KNN_StepAUC_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb186-8"><a href="#cb186-8" aria-hidden="true" tabindex="-1"></a>                                                              KNN_Lasso_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb186-9"><a href="#cb186-9" aria-hidden="true" tabindex="-1"></a>                                                              hyperparameters)</span>
<span id="cb186-10"><a href="#cb186-10" aria-hidden="true" tabindex="-1"></a>result_knn</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-83dea627b96ce935f046" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-83dea627b96ce935f046">{"x":{"visdat":{"3f583ba2483":["function () ","plotlyVisDat"]},"cur_data":"3f583ba2483","attrs":{"3f583ba2483":{"x":{},"y":{},"z":{},"colorscale":"Viridis","alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"heatmap"}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"Heatmap of Best_k and Best_l Frequency","xaxis":{"domain":[0,1],"automargin":true,"title":"Best_k"},"yaxis":{"domain":[0,1],"automargin":true,"title":"Best_l"},"scene":{"zaxis":{"title":"Frequency"}},"hovermode":"closest","showlegend":false,"legend":{"yanchor":"top","y":0.5}},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"colorbar":{"title":"Frequency","ticklen":2,"len":0.5,"lenmode":"fraction","y":1,"yanchor":"top"},"colorscale":"Viridis","showscale":true,"x":[5,10,16,20,25,30,32,5,10,16,20,25,30,32],"y":[1,1,1,1,1,1,1,2,2,2,2,2,2,2],"z":[12,18,10,4,14,8,12,4,3,4,5,4,1,1],"type":"heatmap","xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>Como se puede observar, en el mapa de calor de los hiperparámetros del KNN, hay una clara tendencia hacia la selección de la distancia de Minkowski (<code>l=1</code>), dejando a la distancia Euclidea (<code>l=2</code>) como una opción secundaria. Por otra parte, una vez fijamos nuestra atención en la distancia de Minkowski, se puede observar que la elección del número de vecinos que influencian la predicción sobre la muestra de test es bastante inestable. Si bien es verdad que <code>k=10</code> es el valor más elegido, con 18 apariciones, las elecciones <code>k={5,15,25,32}</code> han sido encontradas 12, 10, 14, y 12 veces, respectivamente. Esto es un claro indicativo de que, aunque el algoritmo KNN muestre un AUC alto, sería un riesgo poner un modelo en producción con esta inestabilidad, ya que no se tiene una idea clara sobre qué hiperparámetros son los que mejor encajan con este conjunto de datos. Es por esto que el modelo KNN queda descartado en análisis consecuentes.</p>
</div>
<div id="tabset-27-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-27-2-tab">
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb187"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb187-1"><a href="#cb187-1" aria-hidden="true" tabindex="-1"></a>hyperparameters <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb187-2"><a href="#cb187-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">Best_Size =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">15</span>, <span class="dv">20</span>, <span class="dv">25</span>, <span class="dv">30</span>),</span>
<span id="cb187-3"><a href="#cb187-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">Best_Decay =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.2</span>, <span class="fl">0.3</span>, <span class="fl">0.4</span>)</span>
<span id="cb187-4"><a href="#cb187-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb187-5"><a href="#cb187-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb187-6"><a href="#cb187-6" aria-hidden="true" tabindex="-1"></a>result_ann <span class="ot">&lt;-</span> <span class="fu">generate_combined_hyperparameter_stability_analysis</span>(ANN_StepAUC_Metrics<span class="sc">$</span>performance_metrics, </span>
<span id="cb187-7"><a href="#cb187-7" aria-hidden="true" tabindex="-1"></a>                                                              ANN_Lasso_Metrics<span class="sc">$</span>performance_metrics, </span>
<span id="cb187-8"><a href="#cb187-8" aria-hidden="true" tabindex="-1"></a>                                                              ANN_Asociacion_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb187-9"><a href="#cb187-9" aria-hidden="true" tabindex="-1"></a>                                                              ANN_TodasVariables_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb187-10"><a href="#cb187-10" aria-hidden="true" tabindex="-1"></a>                                                              hyperparameters)</span>
<span id="cb187-11"><a href="#cb187-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb187-12"><a href="#cb187-12" aria-hidden="true" tabindex="-1"></a>result_ann</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-528f0faba46d8b239949" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-528f0faba46d8b239949">{"x":{"visdat":{"3f586bd84f1b":["function () ","plotlyVisDat"]},"cur_data":"3f586bd84f1b","attrs":{"3f586bd84f1b":{"x":{},"y":{},"z":{},"colorscale":"Viridis","alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"heatmap"}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"Heatmap of Best_Size and Best_Decay Frequency","xaxis":{"domain":[0,1],"automargin":true,"title":"Best_Size"},"yaxis":{"domain":[0,1],"automargin":true,"title":"Best_Decay"},"scene":{"zaxis":{"title":"Frequency"}},"hovermode":"closest","showlegend":false,"legend":{"yanchor":"top","y":0.5}},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"colorbar":{"title":"Frequency","ticklen":2,"len":0.5,"lenmode":"fraction","y":1,"yanchor":"top"},"colorscale":"Viridis","showscale":true,"x":[5,10,15,20,25,30,5,10,15,5,10,15,20,25,30,5,10,15,20,25,30],"y":[0.10000000000000001,0.10000000000000001,0.10000000000000001,0.10000000000000001,0.10000000000000001,0.10000000000000001,0.20000000000000001,0.20000000000000001,0.20000000000000001,0.29999999999999999,0.29999999999999999,0.29999999999999999,0.29999999999999999,0.29999999999999999,0.29999999999999999,0.40000000000000002,0.40000000000000002,0.40000000000000002,0.40000000000000002,0.40000000000000002,0.40000000000000002],"z":[3,1,2,4,1,4,4,3,3,6,3,3,1,3,3,21,10,6,5,6,8],"type":"heatmap","xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>Como se puede observar en el mapa de calor de las redes neuronales, parece haber un claro consenso sobre los hiperparámetros óptimos del modelo, siendo la combinación <code>Size=5; Decay=0.4</code> la encontrada 21 veces, con bastante diferencia. Este tamaño de red neuronal reducido podría sugerir que el problema es fácilmente modelable con una baja cantidad de neuronas, esto tendría sentido, ya que el conjunto de datos con el que se está trabajando no tiene demasiadas variables, por lo que las relaciones intrínsecas entre las muestras y la variable objetivo podrían no ser demasiado complejas. Por otra parte, también se puede explicar un valor de decay tan alto, ya que, al estar el conjunto de datos tan desbalanceado, se prima castigar el overfitting del modelo hacia la clase PCR-Negativa. El modelo ANN es muy consistente con sus hiperparámetros, indicando que una red de size 5-10 con un decay de 0.4 podría ser óptimo para modelar el problema con el objetivo de obtener el máximo AUC posible.</p>
</div>
<div id="tabset-27-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-27-3-tab">
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb188"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb188-1"><a href="#cb188-1" aria-hidden="true" tabindex="-1"></a>hyperparameters <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb188-2"><a href="#cb188-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">Best_Iteration =</span> <span class="fu">c</span>(<span class="dv">50</span>, <span class="dv">100</span>, <span class="dv">150</span>, <span class="dv">200</span>)</span>
<span id="cb188-3"><a href="#cb188-3" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb188-4"><a href="#cb188-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb188-5"><a href="#cb188-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb188-6"><a href="#cb188-6" aria-hidden="true" tabindex="-1"></a>result_ada <span class="ot">&lt;-</span> <span class="fu">generate_adaboost_hyperparameter_analysis</span>(AdaBoost_TodasVariables_Metrics<span class="sc">$</span>performance_metrics, </span>
<span id="cb188-7"><a href="#cb188-7" aria-hidden="true" tabindex="-1"></a>                                                              AdaBoost_Asociacion_Metrics<span class="sc">$</span>performance_metrics, </span>
<span id="cb188-8"><a href="#cb188-8" aria-hidden="true" tabindex="-1"></a>                                                              AdaBoost_StepAUC_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb188-9"><a href="#cb188-9" aria-hidden="true" tabindex="-1"></a>                                                              AdaBoost_Lasso_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb188-10"><a href="#cb188-10" aria-hidden="true" tabindex="-1"></a>                                                              hyperparameters)</span>
<span id="cb188-11"><a href="#cb188-11" aria-hidden="true" tabindex="-1"></a>result_ada</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-c9b66f3a3c9c92f2751a" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-c9b66f3a3c9c92f2751a">{"x":{"visdat":{"3f58138e6ebe":["function () ","plotlyVisDat"]},"cur_data":"3f58138e6ebe","attrs":{"3f58138e6ebe":{"x":{},"y":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"bar"}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"Bar Plot of Best_Iteration Frequency","xaxis":{"domain":[0,1],"automargin":true,"title":"Best_Iteration"},"yaxis":{"domain":[0,1],"automargin":true,"title":"Frequency"},"hovermode":"closest","showlegend":false},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":[50,100,150,200],"y":[56,20,12,12],"type":"bar","marker":{"color":"rgba(31,119,180,1)","line":{"color":"rgba(31,119,180,1)"}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>Como se puede observar en el gráfico de barras, el modelo Adaboost también ha convergido la búsqueda de hiperparámetros en la malla definida durante su entrenamiento en un valor específico de Best_Iteration, siendo este 50, con una cantidad de veces encontrado igual a 56. Debido a que el modelo ha concluído que esta cantidad de iteraciones son las óptimas más del 50% de las veces, se tomará este valor como referencia, concluyendo que Adaboost es consistente con respecto a su selección de hiperparámetros.</p>
</div>
<div id="tabset-27-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-27-4-tab">
<p>El modelo Naive Bayes no ha sido entranando con el ajuste de ningún hiperparámetro, esto supone una evidente sorpresa, ya que, al suponer la independencia de las probabilidades condicionales, debería de dar unos resultados pésimos. Sin embargo, viendo que no se ha necesitado un tamaño de red neuronal muy grande para modelar el problema, se puede concluir que el conjunto de datos no parece tener suficientes variables como para capturar la complejidad de la tarea de la predicción del estado PCR-Positivo de un paciente, permitiendo que algoritmos más sencillos como el Naive Bayes alcancen el AUC óptimo de este estudio sin ajustar ningún hiperparámetro.</p>
</div>
</div>
</div>
</section>
<section id="estabilidad-de-variables" class="level2" data-number="4.4">
<h2 data-number="4.4" class="anchored" data-anchor-id="estabilidad-de-variables"><span class="header-section-number">4.4</span> Estabilidad de Variables</h2>
<p>Se procederá con el análisis de la estabilidad de las variables seleccionadas. Este análisis permite evaluar la consistencia de las variables elegidas a través de diferentes métodos y modelos, proporcionando información valiosa sobre su importancia y relevancia. En este apartado, se emplearán funciones específicas para contar la frecuencia de selección de variables agrupadas y visualizar estos resultados mediante gráficos de barras. Esta inspección detallada facilita la identificación de variables clave que tienen un impacto significativo en el rendimiento del modelo y asegura que las elecciones realizadas no sean producto del azar o de la variabilidad inherente a los datos.</p>
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb189"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb189-1"><a href="#cb189-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Función para contar la frecuencia de selección de variables agrupadas</span></span>
<span id="cb189-2"><a href="#cb189-2" aria-hidden="true" tabindex="-1"></a>contar_seleccion_variables_agrupadas <span class="ot">&lt;-</span> <span class="cf">function</span>(df, variables_principales) {</span>
<span id="cb189-3"><a href="#cb189-3" aria-hidden="true" tabindex="-1"></a>  variable_counts <span class="ot">&lt;-</span> <span class="fu">setNames</span>(<span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">length</span>(variables_principales)), variables_principales)</span>
<span id="cb189-4"><a href="#cb189-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb189-5"><a href="#cb189-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (variables <span class="cf">in</span> df<span class="sc">$</span>Best_Variables) {</span>
<span id="cb189-6"><a href="#cb189-6" aria-hidden="true" tabindex="-1"></a>    var_list <span class="ot">&lt;-</span> <span class="fu">unlist</span>(<span class="fu">strsplit</span>(variables, <span class="st">","</span>))</span>
<span id="cb189-7"><a href="#cb189-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (principal <span class="cf">in</span> variables_principales) {</span>
<span id="cb189-8"><a href="#cb189-8" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="fu">any</span>(<span class="fu">grepl</span>(principal, var_list))) {</span>
<span id="cb189-9"><a href="#cb189-9" aria-hidden="true" tabindex="-1"></a>        variable_counts[principal] <span class="ot">&lt;-</span> variable_counts[principal] <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb189-10"><a href="#cb189-10" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb189-11"><a href="#cb189-11" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb189-12"><a href="#cb189-12" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb189-13"><a href="#cb189-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb189-14"><a href="#cb189-14" aria-hidden="true" tabindex="-1"></a>  result <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(variable_counts)</span>
<span id="cb189-15"><a href="#cb189-15" aria-hidden="true" tabindex="-1"></a>  result<span class="sc">$</span>Variable <span class="ot">&lt;-</span> <span class="fu">rownames</span>(result)</span>
<span id="cb189-16"><a href="#cb189-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames</span>(result) <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb189-17"><a href="#cb189-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(result) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Frecuencia"</span>, <span class="st">"Variable"</span>)</span>
<span id="cb189-18"><a href="#cb189-18" aria-hidden="true" tabindex="-1"></a>  result <span class="ot">&lt;-</span> result[<span class="fu">order</span>(<span class="sc">-</span>result<span class="sc">$</span>Frecuencia), ]</span>
<span id="cb189-19"><a href="#cb189-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(result)</span>
<span id="cb189-20"><a href="#cb189-20" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb189-21"><a href="#cb189-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-22"><a href="#cb189-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Función combinada</span></span>
<span id="cb189-23"><a href="#cb189-23" aria-hidden="true" tabindex="-1"></a>contar_seleccion_combined <span class="ot">&lt;-</span> <span class="cf">function</span>(df1, df2, variables_principales) {</span>
<span id="cb189-24"><a href="#cb189-24" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Contar frecuencias en el primer dataframe</span></span>
<span id="cb189-25"><a href="#cb189-25" aria-hidden="true" tabindex="-1"></a>  result_step_auc <span class="ot">&lt;-</span> <span class="fu">contar_seleccion_variables_agrupadas</span>(df1, variables_principales)</span>
<span id="cb189-26"><a href="#cb189-26" aria-hidden="true" tabindex="-1"></a>  result_step_auc<span class="sc">$</span>Metodo <span class="ot">&lt;-</span> <span class="st">"StepAUC"</span></span>
<span id="cb189-27"><a href="#cb189-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb189-28"><a href="#cb189-28" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Contar frecuencias en el segundo dataframe con variables agrupadas</span></span>
<span id="cb189-29"><a href="#cb189-29" aria-hidden="true" tabindex="-1"></a>  result_lasso <span class="ot">&lt;-</span> <span class="fu">contar_seleccion_variables_agrupadas</span>(df2, variables_principales)</span>
<span id="cb189-30"><a href="#cb189-30" aria-hidden="true" tabindex="-1"></a>  result_lasso<span class="sc">$</span>Metodo <span class="ot">&lt;-</span> <span class="st">"Lasso"</span></span>
<span id="cb189-31"><a href="#cb189-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb189-32"><a href="#cb189-32" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Combinar ambos resultados</span></span>
<span id="cb189-33"><a href="#cb189-33" aria-hidden="true" tabindex="-1"></a>  combined_result <span class="ot">&lt;-</span> <span class="fu">rbind</span>(result_step_auc, result_lasso)</span>
<span id="cb189-34"><a href="#cb189-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(combined_result)</span>
<span id="cb189-35"><a href="#cb189-35" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb189-36"><a href="#cb189-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-37"><a href="#cb189-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Función para combinar todos los dataframes y añadir la columna de Modelo</span></span>
<span id="cb189-38"><a href="#cb189-38" aria-hidden="true" tabindex="-1"></a>combinar_dataframes <span class="ot">&lt;-</span> <span class="cf">function</span>(dataframes, modelos) {</span>
<span id="cb189-39"><a href="#cb189-39" aria-hidden="true" tabindex="-1"></a>  combined_df <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, dataframes)</span>
<span id="cb189-40"><a href="#cb189-40" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb189-41"><a href="#cb189-41" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Asegurar que la longitud de los modelos coincida con la de los dataframes combinados</span></span>
<span id="cb189-42"><a href="#cb189-42" aria-hidden="true" tabindex="-1"></a>  combined_df<span class="sc">$</span>Modelo <span class="ot">&lt;-</span> <span class="fu">rep</span>(modelos, <span class="at">each =</span> <span class="fu">nrow</span>(dataframes[[<span class="dv">1</span>]]) <span class="sc">/</span> <span class="fu">length</span>(modelos))</span>
<span id="cb189-43"><a href="#cb189-43" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb189-44"><a href="#cb189-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(combined_df)</span>
<span id="cb189-45"><a href="#cb189-45" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb189-46"><a href="#cb189-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-47"><a href="#cb189-47" aria-hidden="true" tabindex="-1"></a>crear_visualizaciones <span class="ot">&lt;-</span> <span class="cf">function</span>(combined_df) {</span>
<span id="cb189-48"><a href="#cb189-48" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Métricas por Método de selección</span></span>
<span id="cb189-49"><a href="#cb189-49" aria-hidden="true" tabindex="-1"></a>  plot_metodo <span class="ot">&lt;-</span> <span class="fu">plot_ly</span>(</span>
<span id="cb189-50"><a href="#cb189-50" aria-hidden="true" tabindex="-1"></a>    combined_df, </span>
<span id="cb189-51"><a href="#cb189-51" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="sc">~</span>Variable, </span>
<span id="cb189-52"><a href="#cb189-52" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="sc">~</span>Frecuencia, </span>
<span id="cb189-53"><a href="#cb189-53" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="sc">~</span>Metodo, </span>
<span id="cb189-54"><a href="#cb189-54" aria-hidden="true" tabindex="-1"></a>    <span class="at">type =</span> <span class="st">'bar'</span></span>
<span id="cb189-55"><a href="#cb189-55" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> <span class="fu">layout</span>(</span>
<span id="cb189-56"><a href="#cb189-56" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">'Métricas por Método de Selección'</span>,</span>
<span id="cb189-57"><a href="#cb189-57" aria-hidden="true" tabindex="-1"></a>    <span class="at">xaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">'Variable'</span>),</span>
<span id="cb189-58"><a href="#cb189-58" aria-hidden="true" tabindex="-1"></a>    <span class="at">yaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">'Frecuencia'</span>)</span>
<span id="cb189-59"><a href="#cb189-59" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb189-60"><a href="#cb189-60" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb189-61"><a href="#cb189-61" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Métricas por Modelo</span></span>
<span id="cb189-62"><a href="#cb189-62" aria-hidden="true" tabindex="-1"></a>  plot_modelo <span class="ot">&lt;-</span> <span class="fu">plot_ly</span>(</span>
<span id="cb189-63"><a href="#cb189-63" aria-hidden="true" tabindex="-1"></a>    combined_df, </span>
<span id="cb189-64"><a href="#cb189-64" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="sc">~</span>Variable, </span>
<span id="cb189-65"><a href="#cb189-65" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="sc">~</span>Frecuencia, </span>
<span id="cb189-66"><a href="#cb189-66" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="sc">~</span>Modelo, </span>
<span id="cb189-67"><a href="#cb189-67" aria-hidden="true" tabindex="-1"></a>    <span class="at">type =</span> <span class="st">'bar'</span></span>
<span id="cb189-68"><a href="#cb189-68" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> <span class="fu">layout</span>(</span>
<span id="cb189-69"><a href="#cb189-69" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">'Métricas por Modelo de Machine Learning'</span>,</span>
<span id="cb189-70"><a href="#cb189-70" aria-hidden="true" tabindex="-1"></a>    <span class="at">xaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">'Variable'</span>),</span>
<span id="cb189-71"><a href="#cb189-71" aria-hidden="true" tabindex="-1"></a>    <span class="at">yaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">'Frecuencia'</span>)</span>
<span id="cb189-72"><a href="#cb189-72" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb189-73"><a href="#cb189-73" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb189-74"><a href="#cb189-74" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">plot_metodo =</span> plot_metodo, <span class="at">plot_modelo =</span> plot_modelo))</span>
<span id="cb189-75"><a href="#cb189-75" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb189-76"><a href="#cb189-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-77"><a href="#cb189-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-78"><a href="#cb189-78" aria-hidden="true" tabindex="-1"></a><span class="co"># Ejecución de la función</span></span>
<span id="cb189-79"><a href="#cb189-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-80"><a href="#cb189-80" aria-hidden="true" tabindex="-1"></a>variablesFactor <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Edad"</span>, <span class="st">"REst"</span>, <span class="st">"RPro"</span>, <span class="st">"Estadio"</span>, <span class="st">"Grado"</span>, <span class="st">"Fenotipo"</span>, <span class="st">"NodAfec"</span>)</span>
<span id="cb189-81"><a href="#cb189-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-82"><a href="#cb189-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-83"><a href="#cb189-83" aria-hidden="true" tabindex="-1"></a><span class="co"># ANN</span></span>
<span id="cb189-84"><a href="#cb189-84" aria-hidden="true" tabindex="-1"></a>ANN_Variables <span class="ot">&lt;-</span> <span class="fu">contar_seleccion_combined</span>(ANN_StepAUC_Metrics<span class="sc">$</span>performance_metrics, </span>
<span id="cb189-85"><a href="#cb189-85" aria-hidden="true" tabindex="-1"></a>                          ANN_Lasso_Metrics<span class="sc">$</span>performance_metrics, </span>
<span id="cb189-86"><a href="#cb189-86" aria-hidden="true" tabindex="-1"></a>                          variablesFactor)</span>
<span id="cb189-87"><a href="#cb189-87" aria-hidden="true" tabindex="-1"></a>ANN_Variables<span class="sc">$</span>Modelo <span class="ot">&lt;-</span> <span class="st">"ANN"</span></span>
<span id="cb189-88"><a href="#cb189-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-89"><a href="#cb189-89" aria-hidden="true" tabindex="-1"></a><span class="co"># SVM</span></span>
<span id="cb189-90"><a href="#cb189-90" aria-hidden="true" tabindex="-1"></a>SVM_Variables <span class="ot">&lt;-</span> <span class="fu">contar_seleccion_combined</span>(SVM_StepAUC_Metrics<span class="sc">$</span>performance_metrics, </span>
<span id="cb189-91"><a href="#cb189-91" aria-hidden="true" tabindex="-1"></a>                          SVM_Lasso_Metrics<span class="sc">$</span>performance_metrics, </span>
<span id="cb189-92"><a href="#cb189-92" aria-hidden="true" tabindex="-1"></a>                          variablesFactor)</span>
<span id="cb189-93"><a href="#cb189-93" aria-hidden="true" tabindex="-1"></a>SVM_Variables<span class="sc">$</span>Modelo <span class="ot">&lt;-</span> <span class="st">"SVM"</span></span>
<span id="cb189-94"><a href="#cb189-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-95"><a href="#cb189-95" aria-hidden="true" tabindex="-1"></a><span class="co"># DT</span></span>
<span id="cb189-96"><a href="#cb189-96" aria-hidden="true" tabindex="-1"></a>DT_Variables <span class="ot">&lt;-</span> <span class="fu">contar_seleccion_combined</span>(RPart_StepAUC_Metrics<span class="sc">$</span>performance_metrics, </span>
<span id="cb189-97"><a href="#cb189-97" aria-hidden="true" tabindex="-1"></a>                          RPart_Lasso_Metrics<span class="sc">$</span>performance_metrics, </span>
<span id="cb189-98"><a href="#cb189-98" aria-hidden="true" tabindex="-1"></a>                          variablesFactor)</span>
<span id="cb189-99"><a href="#cb189-99" aria-hidden="true" tabindex="-1"></a>DT_Variables<span class="sc">$</span>Modelo <span class="ot">&lt;-</span> <span class="st">"DT"</span></span>
<span id="cb189-100"><a href="#cb189-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-101"><a href="#cb189-101" aria-hidden="true" tabindex="-1"></a><span class="co"># ADA</span></span>
<span id="cb189-102"><a href="#cb189-102" aria-hidden="true" tabindex="-1"></a>ADA_Variables <span class="ot">&lt;-</span> <span class="fu">contar_seleccion_combined</span>(AdaBoost_StepAUC_Metrics<span class="sc">$</span>performance_metrics, </span>
<span id="cb189-103"><a href="#cb189-103" aria-hidden="true" tabindex="-1"></a>                          AdaBoost_Lasso_Metrics<span class="sc">$</span>performance_metrics, </span>
<span id="cb189-104"><a href="#cb189-104" aria-hidden="true" tabindex="-1"></a>                          variablesFactor)</span>
<span id="cb189-105"><a href="#cb189-105" aria-hidden="true" tabindex="-1"></a>ADA_Variables<span class="sc">$</span>Modelo <span class="ot">&lt;-</span> <span class="st">"ADA"</span></span>
<span id="cb189-106"><a href="#cb189-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-107"><a href="#cb189-107" aria-hidden="true" tabindex="-1"></a><span class="co"># NaiveBayes</span></span>
<span id="cb189-108"><a href="#cb189-108" aria-hidden="true" tabindex="-1"></a>Naive_Variables <span class="ot">&lt;-</span> <span class="fu">contar_seleccion_combined</span>(NaiveBayes_StepAUC_Metrics<span class="sc">$</span>performance_metrics, </span>
<span id="cb189-109"><a href="#cb189-109" aria-hidden="true" tabindex="-1"></a>                          NaiveBayes_Lasso_Metrics<span class="sc">$</span>performance_metrics, </span>
<span id="cb189-110"><a href="#cb189-110" aria-hidden="true" tabindex="-1"></a>                          variablesFactor)</span>
<span id="cb189-111"><a href="#cb189-111" aria-hidden="true" tabindex="-1"></a>Naive_Variables<span class="sc">$</span>Modelo <span class="ot">&lt;-</span> <span class="st">"Naive"</span></span>
<span id="cb189-112"><a href="#cb189-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-113"><a href="#cb189-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-114"><a href="#cb189-114" aria-hidden="true" tabindex="-1"></a>dataframes <span class="ot">&lt;-</span> <span class="fu">list</span>(Naive_Variables, ADA_Variables, DT_Variables, ANN_Variables, SVM_Variables)</span>
<span id="cb189-115"><a href="#cb189-115" aria-hidden="true" tabindex="-1"></a>modelos <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"NAIVE"</span>, <span class="st">"ADA"</span>, <span class="st">"DT"</span>, <span class="st">"ANN"</span>, <span class="st">"SVM"</span>)</span>
<span id="cb189-116"><a href="#cb189-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-117"><a href="#cb189-117" aria-hidden="true" tabindex="-1"></a>combined_df <span class="ot">&lt;-</span> <span class="fu">combinar_dataframes</span>(dataframes, modelos)</span>
<span id="cb189-118"><a href="#cb189-118" aria-hidden="true" tabindex="-1"></a>plots <span class="ot">&lt;-</span> <span class="fu">crear_visualizaciones</span>(combined_df)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-28-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-28-1" role="tab" aria-controls="tabset-28-1" aria-selected="true" href="">Variables según Método</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-28-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-28-2" role="tab" aria-controls="tabset-28-2" aria-selected="false" href="">Variables según Modelo</a></li></ul>
<div class="tab-content">
<div id="tabset-28-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-28-1-tab">
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb190"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb190-1"><a href="#cb190-1" aria-hidden="true" tabindex="-1"></a>plots<span class="sc">$</span>plot_metodo</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-1f0747cb24c036fa22ea" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-1f0747cb24c036fa22ea">{"x":{"visdat":{"3f584bf5847":["function () ","plotlyVisDat"]},"cur_data":"3f584bf5847","attrs":{"3f584bf5847":{"x":{},"y":{},"color":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"bar"}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"Métricas por Método de Selección","xaxis":{"domain":[0,1],"automargin":true,"title":"Variable","type":"category","categoryorder":"array","categoryarray":["Edad","Estadio","Fenotipo","Grado","NodAfec","REst","RPro"]},"yaxis":{"domain":[0,1],"automargin":true,"title":"Frecuencia"},"hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":["Grado","Fenotipo","REst","Edad","Estadio","NodAfec","RPro","Grado","Fenotipo","REst","Edad","Estadio","NodAfec","RPro","Grado","Edad","Fenotipo","REst","Estadio","NodAfec","RPro","Grado","Fenotipo","Edad","REst","Estadio","RPro","NodAfec","Grado","Fenotipo","Edad","REst","Estadio","NodAfec","RPro"],"y":[25,25,21,20,12,8,5,25,25,21,19,14,8,5,25,24,24,22,17,12,9,25,25,23,22,21,7,6,25,24,23,22,16,12,3],"type":"bar","name":"Lasso","marker":{"color":"rgba(102,194,165,1)","line":{"color":"rgba(102,194,165,1)"}},"textfont":{"color":"rgba(102,194,165,1)"},"error_y":{"color":"rgba(102,194,165,1)"},"error_x":{"color":"rgba(102,194,165,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":["Grado","Fenotipo","REst","Edad","Estadio","NodAfec","RPro","Grado","Fenotipo","REst","Edad","Estadio","RPro","NodAfec","Fenotipo","Grado","Edad","REst","RPro","Estadio","NodAfec","Grado","Fenotipo","REst","Edad","Estadio","RPro","NodAfec","Estadio","Grado","Fenotipo","NodAfec","RPro","REst","Edad"],"y":[25,24,21,14,13,4,1,24,24,17,15,15,9,6,19,18,17,17,16,15,13,24,21,17,13,11,6,6,25,25,25,25,23,22,21],"type":"bar","name":"StepAUC","marker":{"color":"rgba(141,160,203,1)","line":{"color":"rgba(141,160,203,1)"}},"textfont":{"color":"rgba(141,160,203,1)"},"error_y":{"color":"rgba(141,160,203,1)"},"error_x":{"color":"rgba(141,160,203,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>En el gráfico de barras superior se pueden observar las frecuencias de selección de cada variable por los dos principales métodos de selección de características empleados en este estudio. Un aspecto positivo que se puede remarcar es que, ambos métodos parecen coincidir en la importancia de una serie de variables, mostrando que <code>Estadio, Fenotipo, Grado,</code> y <code>REst</code> son variables importantes en el análisis, <code>NodAfec</code> es prescindible, y hay una ligera discrepancai en <code>Edad</code> y <code>RPro</code>, pero de manera general, se puede concluir que <code>Edad</code> sí tiene significancia sobre la variable objetivo, mientras que <code>RPro</code>, no.</p>
</div>
<div id="tabset-28-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-28-2-tab">
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb191"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb191-1"><a href="#cb191-1" aria-hidden="true" tabindex="-1"></a>plots<span class="sc">$</span>plot_modelo</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-cde1d9badd15bd7b942e" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-cde1d9badd15bd7b942e">{"x":{"visdat":{"3f5823f5130d":["function () ","plotlyVisDat"]},"cur_data":"3f5823f5130d","attrs":{"3f5823f5130d":{"x":{},"y":{},"color":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"bar"}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"Métricas por Modelo de Machine Learning","xaxis":{"domain":[0,1],"automargin":true,"title":"Variable","type":"category","categoryorder":"array","categoryarray":["Edad","Estadio","Fenotipo","Grado","NodAfec","REst","RPro"]},"yaxis":{"domain":[0,1],"automargin":true,"title":"Frecuencia"},"hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":["REst","Edad","NodAfec","RPro","Fenotipo","REst","RPro","Estadio","Grado","Fenotipo","REst","Estadio","Edad","Grado"],"y":[21,14,8,5,25,21,16,15,24,21,22,21,21,25],"type":"bar","name":"ADA","marker":{"color":"rgba(102,194,165,1)","line":{"color":"rgba(102,194,165,1)"}},"textfont":{"color":"rgba(102,194,165,1)"},"error_y":{"color":"rgba(102,194,165,1)"},"error_x":{"color":"rgba(102,194,165,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":["RPro","Grado","REst","Edad","NodAfec","RPro","Edad","Fenotipo","Estadio","RPro","Estadio","Grado","REst","Estadio"],"y":[1,25,17,15,8,5,24,24,11,6,25,25,22,16],"type":"bar","name":"ANN","marker":{"color":"rgba(252,141,98,1)","line":{"color":"rgba(252,141,98,1)"}},"textfont":{"color":"rgba(252,141,98,1)"},"error_y":{"color":"rgba(252,141,98,1)"},"error_x":{"color":"rgba(252,141,98,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":["Estadio","NodAfec","Grado","Fenotipo","Edad","Estadio","NodAfec","Grado","REst","Edad","RPro","NodAfec","Fenotipo","Edad"],"y":[13,4,24,24,19,14,13,25,17,13,7,6,24,23],"type":"bar","name":"DT","marker":{"color":"rgba(141,160,203,1)","line":{"color":"rgba(141,160,203,1)"}},"textfont":{"color":"rgba(141,160,203,1)"},"error_y":{"color":"rgba(141,160,203,1)"},"error_x":{"color":"rgba(141,160,203,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":["Grado","Fenotipo","Edad","Estadio","NodAfec","Grado","Edad","REst","NodAfec","RPro","Fenotipo","Edad","RPro","REst"],"y":[25,24,20,12,6,25,17,17,12,9,25,23,23,22],"type":"bar","name":"NAIVE","marker":{"color":"rgba(231,138,195,1)","line":{"color":"rgba(231,138,195,1)"}},"textfont":{"color":"rgba(231,138,195,1)"},"error_y":{"color":"rgba(231,138,195,1)"},"error_x":{"color":"rgba(231,138,195,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":["Fenotipo","REst","Estadio","RPro","Fenotipo","Grado","REst","Estadio","NodAfec","Grado","Fenotipo","NodAfec","NodAfec","RPro"],"y":[25,21,15,9,19,18,22,17,6,25,25,25,12,3],"type":"bar","name":"SVM","marker":{"color":"rgba(166,216,84,1)","line":{"color":"rgba(166,216,84,1)"}},"textfont":{"color":"rgba(166,216,84,1)"},"error_y":{"color":"rgba(166,216,84,1)"},"error_x":{"color":"rgba(166,216,84,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>Como se puede observar en el gráfico de barras superior (si se hace <em>click</em> en los modelos DT y SVM, se podrán observar solo los modelos de interés), las variables que mejor encajan con cada uno de nuestros modelos finalistas parecen coincidir con las variables seleccionadas por los métodos en gran medida.</p>
</div>
</div>
</div>
</section>
<section id="modelo-más-adecuado" class="level2" data-number="4.5">
<h2 data-number="4.5" class="anchored" data-anchor-id="modelo-más-adecuado"><span class="header-section-number">4.5</span> Modelo más Adecuado</h2>
<p>Con toda la información discutida anteriormente, se pretende tomar una decisión informada sobre la selección de un algoritmo de ML, con una serie de hiperparámetros fijos, y con unas variables elegidas del conjunto de datos. Esto se hará con la intención de poner el modelo en producción, permitiendo al usuario realizar predicciones reales sobre pacientes. Los datos recogidos hasta ahora son:</p>
<table class="table">
<colgroup>
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 23%">
<col style="width: 14%">
<col style="width: 36%">
</colgroup>
<thead>
<tr class="header">
<th>Modelo</th>
<th>AUC promedio</th>
<th>Hiperparámetros estables</th>
<th>Metodo</th>
<th>Variables</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ANN</td>
<td>0.747</td>
<td>(5, 0.4)</td>
<td>Lasso</td>
<td>Edad, Estadio, Fenotipo, Grado, REst</td>
</tr>
<tr class="even">
<td>NaiveBayes</td>
<td>0.7439</td>
<td>-</td>
<td>TodasVariables</td>
<td>Todas</td>
</tr>
<tr class="odd">
<td>ADA</td>
<td>0.74</td>
<td>50</td>
<td>Lasso</td>
<td>Edad, Estadio, Fenotipo, Grado, REst</td>
</tr>
</tbody>
</table>
<p>Tomando como referencia toda la discusión realizada anteriormente, se ha decidido que se va a usar un modelo de <strong>Redes Neuronales Artificiales con un tamaño de la capa oculta de 5 neuronas, y un valor de decay de 0.4, las variables utilizadas para este modelo serán las variables seleccionadas por el método Lasso sobre el conjunto de datos completo</strong>. La decisión de dejar fuera el modelo de Naive Bayes se basa en la incapacidad que podría tener el modelo para realizar una integración continua de datos, en la cual la variabilidad de muestras podría aumentar, rompiendo el estado actual del conjunto de datos con el que fue entrenado, y poniendo en evidencia la, <em>teóricamente</em>, pobre capacidad de predicción del modelo. Por otro lado, la decisión de dejar fuera el modelo Adaboost ha sido plenamente basada en que su rendimiento honesto es algo más bajo que el de las ANN, ya que, por el resto de características, es un modelo fiable, que se puede adaptar a nuevas muestras, y que ha empelado el mismo método de selección de variables que ANN.</p>
</section>
</section>
<section id="conclusión" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Conclusión</h1>
<p>A lo largo de este proyecto se ha realizado un estudio en profundidad sobre la capacidad de predicción del estado PCR de una serie de pacientes mediante el uso de algoritmos de aprendizaje computacional avanzados, los cuales han sido entrenados con un subconjunto de las variables de los datos originales definido por diferentes algoritmos de selección de características. Para cada algoritmo de aprendizaje computacional, se ha aplicado una estimación honesta de parámetros mediante la implementación de una doble validación cruzada 5x2, en la que los pliegues internos han sido utilizados para buscar la mejor combinación de hiperparámetros de una lista acotada dada, definida mediante diferentes pruebas realizadas sobre la estimación del rendimiento aparente del modelo. La selección de características también fue llevaba a cabo en el pliegue interno de la validación.</p>
<p>Una vez se han ejecutado todas las pruebas, se ha realizado una discusión de los resultados a modo de estudio comparativo con la finalidad de elegir el algoritmo que mejor se ajusta a la tarea de este proyecto. Para considerar un modelo como válido, se ha considerado la robustez y valor de su AUC global para diferentes semillas que generan particiones de datos aleatorias, la estabilidad de selección de hiperparámetros, y la estabilidad de selección de variables. Así, un modelo que sea considerado como adecuado para el estudio, será el que obtenga una calificación cualitativa correcta en estos tres criterios.</p>
<p>Finalmente, una vez llevabo a cabo el estudio, se ha concluído que, para este problema, las Redes de Neuronas Artificales, con un tamaño de 5 neuronas en la capa oculta, y con un valor de decay de 0.4, son la mejor opción para predecir el estado PCR (Metástasis) de un paciente, dada su Edad, Estadío, Fenotipo, Grado, y REst. Otros modelos han llegado a la etapa final de la evaluación, pero han sido descartados debido a su poca adaptabilidad a nuevos datos, o su rendimiento algo más pobre de AUC.</p>
<p>Las limitaciones de este proyecto tienen su origen sobre todo en el conjunto de datos. En ningún momento del proyecto se ha conseguido sobrepasar un rendimiento global de 0.8 para el AUC, se teoriza que esto puede ocurrir por varias razones. La primera, es la cantidad de muestras disponibles en este conjunto de datos, la segunda, es la poca cantidad de variables, y la tercera, que puede ser que las variables que existan en este conjunto de datos no sean lo suficientemente significativas con respecto a la característica diana, significando que no es posible modelar el problema con ningún algoritmo, ya que no se capturan bien las características subyacentes de la variable objetivo PCR con ninguna variable.</p>
<p>A pesar de todo, se considera que se han cumplido los objetivos de este proyecto, ya que, gracias al exitoso análisis en profundidad realizado, se ha tomado una decisión informada por el modelo final.</p>
</section>
<section id="anexo-a-aplicación-rshiny-y-despliegue-del-modelo" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> Anexo A: Aplicación RShiny y Despliegue del Modelo</h1>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-29-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-29-1" role="tab" aria-controls="tabset-29-1" aria-selected="true" href="">Código Interfaz de Usuario (UI)</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-29-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-29-2" role="tab" aria-controls="tabset-29-2" aria-selected="false" href="">Código del Servidor (Server)</a></li></ul>
<div class="tab-content">
<div id="tabset-29-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-29-1-tab">
<p>Se utiliza fluidPage para estructurar la interfaz de la aplicación, aplicando un tema visual flatly de shinytheme para darle un estilo atractivo. En el encabezado, se incluyen estilos CSS personalizados que definen la apariencia de elementos específicos como las predicciones y la tabla. Dentro de wellPanel, se muestra el título “Modelo de Red Neuronal Cáncer de Mama”.</p>
<p>Se estructura la interfaz principal en dos secciones: un sidebarLayout con un sidebarPanel y un mainPanel. El sidebarPanel contiene entradas de usuario para la edad, estadio, fenotipo, grado, REst, y un deslizador para seleccionar el umbral de predicción. También se incluyen elementos de texto para mostrar feedback en tiempo real sobre la entrada de edad y el umbral seleccionado. El mainPanel utiliza tabsetPanel para organizar el contenido en dos pestañas: “Predicción” e “Información”. La pestaña “Predicción” muestra un gráfico interactivo y una tabla resumen de las entradas y predicciones, mientras que la pestaña “Información” proporciona detalles sobre el proyecto, el alumno y un enlace al código fuente en GitHub.</p>
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb192"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb192-1"><a href="#cb192-1" aria-hidden="true" tabindex="-1"></a>ui <span class="ot">&lt;-</span> <span class="fu">fluidPage</span>(</span>
<span id="cb192-2"><a href="#cb192-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">theme =</span> <span class="fu">shinytheme</span>(<span class="st">"flatly"</span>),</span>
<span id="cb192-3"><a href="#cb192-3" aria-hidden="true" tabindex="-1"></a>  tags<span class="sc">$</span><span class="fu">head</span>(</span>
<span id="cb192-4"><a href="#cb192-4" aria-hidden="true" tabindex="-1"></a>    tags<span class="sc">$</span><span class="fu">style</span>(<span class="fu">HTML</span>(<span class="st">"</span></span>
<span id="cb192-5"><a href="#cb192-5" aria-hidden="true" tabindex="-1"></a><span class="st">      .prediccion-positivo {</span></span>
<span id="cb192-6"><a href="#cb192-6" aria-hidden="true" tabindex="-1"></a><span class="st">        font-size: 24px;</span></span>
<span id="cb192-7"><a href="#cb192-7" aria-hidden="true" tabindex="-1"></a><span class="st">        color: rgba(54, 162, 235, 0.6);</span></span>
<span id="cb192-8"><a href="#cb192-8" aria-hidden="true" tabindex="-1"></a><span class="st">        font-weight: bold;</span></span>
<span id="cb192-9"><a href="#cb192-9" aria-hidden="true" tabindex="-1"></a><span class="st">      }</span></span>
<span id="cb192-10"><a href="#cb192-10" aria-hidden="true" tabindex="-1"></a><span class="st">      .prediccion-negativo {</span></span>
<span id="cb192-11"><a href="#cb192-11" aria-hidden="true" tabindex="-1"></a><span class="st">        font-size: 24px;</span></span>
<span id="cb192-12"><a href="#cb192-12" aria-hidden="true" tabindex="-1"></a><span class="st">        color: rgba(255, 99, 132, 0.6);</span></span>
<span id="cb192-13"><a href="#cb192-13" aria-hidden="true" tabindex="-1"></a><span class="st">        font-weight: bold;</span></span>
<span id="cb192-14"><a href="#cb192-14" aria-hidden="true" tabindex="-1"></a><span class="st">      }</span></span>
<span id="cb192-15"><a href="#cb192-15" aria-hidden="true" tabindex="-1"></a><span class="st">      table th {</span></span>
<span id="cb192-16"><a href="#cb192-16" aria-hidden="true" tabindex="-1"></a><span class="st">        font-weight: bold;</span></span>
<span id="cb192-17"><a href="#cb192-17" aria-hidden="true" tabindex="-1"></a><span class="st">      }</span></span>
<span id="cb192-18"><a href="#cb192-18" aria-hidden="true" tabindex="-1"></a><span class="st">      .title-panel {</span></span>
<span id="cb192-19"><a href="#cb192-19" aria-hidden="true" tabindex="-1"></a><span class="st">        background-color: #f5f5f5;</span></span>
<span id="cb192-20"><a href="#cb192-20" aria-hidden="true" tabindex="-1"></a><span class="st">        padding: 20px;</span></span>
<span id="cb192-21"><a href="#cb192-21" aria-hidden="true" tabindex="-1"></a><span class="st">        border-radius: 10px;</span></span>
<span id="cb192-22"><a href="#cb192-22" aria-hidden="true" tabindex="-1"></a><span class="st">        text-align: center;</span></span>
<span id="cb192-23"><a href="#cb192-23" aria-hidden="true" tabindex="-1"></a><span class="st">      }</span></span>
<span id="cb192-24"><a href="#cb192-24" aria-hidden="true" tabindex="-1"></a><span class="st">      .subtitle {</span></span>
<span id="cb192-25"><a href="#cb192-25" aria-hidden="true" tabindex="-1"></a><span class="st">        font-size: 16px;</span></span>
<span id="cb192-26"><a href="#cb192-26" aria-hidden="true" tabindex="-1"></a><span class="st">        color: #333;</span></span>
<span id="cb192-27"><a href="#cb192-27" aria-hidden="true" tabindex="-1"></a><span class="st">      }</span></span>
<span id="cb192-28"><a href="#cb192-28" aria-hidden="true" tabindex="-1"></a><span class="st">    "</span>))</span>
<span id="cb192-29"><a href="#cb192-29" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb192-30"><a href="#cb192-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">wellPanel</span>(</span>
<span id="cb192-31"><a href="#cb192-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">class =</span> <span class="st">"title-panel"</span>,</span>
<span id="cb192-32"><a href="#cb192-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">h1</span>(<span class="st">"Modelo de Red Neuronal Cáncer de Mama"</span>),</span>
<span id="cb192-33"><a href="#cb192-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">div</span>(<span class="at">class =</span> <span class="st">"subtitle"</span>, <span class="st">"Mario Pascual González; Bioinformática 23-24"</span>)</span>
<span id="cb192-34"><a href="#cb192-34" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb192-35"><a href="#cb192-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sidebarLayout</span>(</span>
<span id="cb192-36"><a href="#cb192-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sidebarPanel</span>(</span>
<span id="cb192-37"><a href="#cb192-37" aria-hidden="true" tabindex="-1"></a>      <span class="fu">numericInput</span>(<span class="st">"edad"</span>, <span class="st">"Edad:"</span>, <span class="at">value =</span> <span class="dv">30</span>, <span class="at">min =</span> <span class="dv">0</span>, <span class="at">max =</span> <span class="dv">100</span>),</span>
<span id="cb192-38"><a href="#cb192-38" aria-hidden="true" tabindex="-1"></a>      <span class="fu">textOutput</span>(<span class="st">"edadFeedback"</span>),</span>
<span id="cb192-39"><a href="#cb192-39" aria-hidden="true" tabindex="-1"></a>      <span class="fu">selectInput</span>(<span class="st">"estadio"</span>, <span class="st">"Estadio:"</span>, <span class="at">choices =</span> <span class="fu">c</span>(<span class="st">"T0-T1"</span>, <span class="st">"T2"</span>, <span class="st">"T3"</span>, <span class="st">"T4"</span>)),</span>
<span id="cb192-40"><a href="#cb192-40" aria-hidden="true" tabindex="-1"></a>      <span class="fu">selectInput</span>(<span class="st">"fenotipo"</span>, <span class="st">"Fenotipo:"</span>, <span class="at">choices =</span> <span class="fu">c</span>(<span class="st">"Basal"</span>, <span class="st">"Her2"</span>, <span class="st">"LumA"</span>, <span class="st">"LumB"</span>, <span class="st">"Normal"</span>)),</span>
<span id="cb192-41"><a href="#cb192-41" aria-hidden="true" tabindex="-1"></a>      <span class="fu">selectInput</span>(<span class="st">"grado"</span>, <span class="st">"Grado:"</span>, <span class="at">choices =</span> <span class="fu">c</span>(<span class="st">"I"</span>, <span class="st">"II"</span>, <span class="st">"III"</span>)),</span>
<span id="cb192-42"><a href="#cb192-42" aria-hidden="true" tabindex="-1"></a>      <span class="fu">selectInput</span>(<span class="st">"rest"</span>, <span class="st">"REst:"</span>, <span class="at">choices =</span> <span class="fu">c</span>(<span class="st">"N"</span>, <span class="st">"P"</span>)),</span>
<span id="cb192-43"><a href="#cb192-43" aria-hidden="true" tabindex="-1"></a>      <span class="fu">sliderInput</span>(<span class="st">"threshold"</span>, <span class="st">"Threshold:"</span>, <span class="at">min =</span> <span class="fl">0.01</span>, <span class="at">max =</span> <span class="fl">0.99</span>, <span class="at">value =</span> <span class="fl">0.5</span>, <span class="at">step =</span> <span class="fl">0.01</span>),</span>
<span id="cb192-44"><a href="#cb192-44" aria-hidden="true" tabindex="-1"></a>      <span class="fu">textOutput</span>(<span class="st">"selectedThreshold"</span>),</span>
<span id="cb192-45"><a href="#cb192-45" aria-hidden="true" tabindex="-1"></a>      <span class="fu">actionButton</span>(<span class="st">"predict"</span>, <span class="st">"Predecir"</span>)</span>
<span id="cb192-46"><a href="#cb192-46" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb192-47"><a href="#cb192-47" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mainPanel</span>(</span>
<span id="cb192-48"><a href="#cb192-48" aria-hidden="true" tabindex="-1"></a>      <span class="fu">tabsetPanel</span>(</span>
<span id="cb192-49"><a href="#cb192-49" aria-hidden="true" tabindex="-1"></a>        <span class="fu">tabPanel</span>(<span class="st">"Predicción"</span>,</span>
<span id="cb192-50"><a href="#cb192-50" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">fluidRow</span>(</span>
<span id="cb192-51"><a href="#cb192-51" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">column</span>(<span class="dv">8</span>, <span class="fu">plotlyOutput</span>(<span class="st">"predictionPlot"</span>)),</span>
<span id="cb192-52"><a href="#cb192-52" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">column</span>(<span class="dv">4</span>,</span>
<span id="cb192-53"><a href="#cb192-53" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">h3</span>(<span class="st">"Resumen de la consulta y predicción"</span>),</span>
<span id="cb192-54"><a href="#cb192-54" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">tableOutput</span>(<span class="st">"inputValuesTable"</span>))</span>
<span id="cb192-55"><a href="#cb192-55" aria-hidden="true" tabindex="-1"></a>                 )</span>
<span id="cb192-56"><a href="#cb192-56" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb192-57"><a href="#cb192-57" aria-hidden="true" tabindex="-1"></a>        <span class="fu">tabPanel</span>(<span class="st">"Información"</span>,</span>
<span id="cb192-58"><a href="#cb192-58" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">h3</span>(<span class="st">"Información del Proyecto"</span>),</span>
<span id="cb192-59"><a href="#cb192-59" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">p</span>(<span class="st">"..."</span>),</span>
<span id="cb192-60"><a href="#cb192-60" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">a</span>(<span class="st">"..."</span>)</span>
<span id="cb192-61"><a href="#cb192-61" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb192-62"><a href="#cb192-62" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb192-63"><a href="#cb192-63" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb192-64"><a href="#cb192-64" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb192-65"><a href="#cb192-65" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<div id="tabset-29-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-29-2-tab">
<p>Se configura el código del servidor para manejar la lógica detrás de la aplicación, utilizando el paquete nnet para entrenar y predecir con un modelo de red neuronal. Se cargan los datos y se convierten las columnas a factores según sea necesario. La función observeEvent se utiliza para proporcionar feedback en tiempo real sobre la entrada de la edad, asegurando que se introduce un valor válido antes de permitir la predicción.</p>
<p>Cuando el usuario solicita una predicción, se procesan las entradas del formulario, se recodifican y se convierten en una matriz de datos adecuada para el modelo. Se entrena el modelo con los datos proporcionados y se realiza una predicción en bruto. Esta predicción se compara con el umbral seleccionado por el usuario para determinar si la predicción final es “PCR-Positivo” o “PCR-Negativo”. La predicción y las entradas se muestran en una tabla resumen, y se genera un gráfico interactivo que visualiza las probabilidades de predicción para cada clase. Este flujo asegura que el usuario reciba feedback inmediato y visual sobre las predicciones realizadas por el modelo.</p>
<p>Se admite que esta forma de trabajar en la que el modelo se entrena cada vez que se quiere realizar una predicción puede no ser muy eficiente. Sin embargo, el tiempo de entrenamiento con este conjunto de datos reducido es mínimo, y se ha decidido no desarrollar una plataforma de validación de predicciones para la integración de datos y entrenamiento continuo del modelo, por lo que el tamaño del conjunto no variará con el tiempo. Si se quisiera mejorar esta implementación, uno de los siguientes pasos sería separar el entrenamiento del modelo y la predicción, pero para el ámbito de este estudio, esta implementación es adecuada.</p>
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb193"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb193-1"><a href="#cb193-1" aria-hidden="true" tabindex="-1"></a>categorizar_edad <span class="ot">&lt;-</span> <span class="cf">function</span>(edad) {</span>
<span id="cb193-2"><a href="#cb193-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (edad <span class="sc">&gt;=</span> <span class="dv">24</span> <span class="sc">&amp;&amp;</span> edad <span class="sc">&lt;</span> <span class="fl">29.1</span>) {</span>
<span id="cb193-3"><a href="#cb193-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="st">"Grupo1"</span>)</span>
<span id="cb193-4"><a href="#cb193-4" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (edad <span class="sc">&gt;=</span> <span class="fl">29.1</span> <span class="sc">&amp;&amp;</span> edad <span class="sc">&lt;</span> <span class="fl">34.2</span>) {</span>
<span id="cb193-5"><a href="#cb193-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="st">"Grupo2"</span>)</span>
<span id="cb193-6"><a href="#cb193-6" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (edad <span class="sc">&gt;=</span> <span class="fl">34.2</span> <span class="sc">&amp;&amp;</span> edad <span class="sc">&lt;</span> <span class="fl">39.3</span>) {</span>
<span id="cb193-7"><a href="#cb193-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="st">"Grupo3"</span>)</span>
<span id="cb193-8"><a href="#cb193-8" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (edad <span class="sc">&gt;=</span> <span class="fl">39.3</span> <span class="sc">&amp;&amp;</span> edad <span class="sc">&lt;</span> <span class="fl">44.4</span>) {</span>
<span id="cb193-9"><a href="#cb193-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="st">"Grupo4"</span>)</span>
<span id="cb193-10"><a href="#cb193-10" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (edad <span class="sc">&gt;=</span> <span class="fl">44.4</span> <span class="sc">&amp;&amp;</span> edad <span class="sc">&lt;</span> <span class="fl">49.5</span>) {</span>
<span id="cb193-11"><a href="#cb193-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="st">"Grupo5"</span>)</span>
<span id="cb193-12"><a href="#cb193-12" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (edad <span class="sc">&gt;=</span> <span class="fl">49.5</span> <span class="sc">&amp;&amp;</span> edad <span class="sc">&lt;</span> <span class="fl">54.6</span>) {</span>
<span id="cb193-13"><a href="#cb193-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="st">"Grupo6"</span>)</span>
<span id="cb193-14"><a href="#cb193-14" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (edad <span class="sc">&gt;=</span> <span class="fl">54.6</span> <span class="sc">&amp;&amp;</span> edad <span class="sc">&lt;</span> <span class="fl">59.7</span>) {</span>
<span id="cb193-15"><a href="#cb193-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="st">"Grupo7"</span>)</span>
<span id="cb193-16"><a href="#cb193-16" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (edad <span class="sc">&gt;=</span> <span class="fl">59.7</span> <span class="sc">&amp;&amp;</span> edad <span class="sc">&lt;</span> <span class="fl">64.8</span>) {</span>
<span id="cb193-17"><a href="#cb193-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="st">"Grupo8"</span>)</span>
<span id="cb193-18"><a href="#cb193-18" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (edad <span class="sc">&gt;=</span> <span class="fl">64.8</span> <span class="sc">&amp;&amp;</span> edad <span class="sc">&lt;</span> <span class="fl">69.9</span>) {</span>
<span id="cb193-19"><a href="#cb193-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="st">"Grupo9"</span>)</span>
<span id="cb193-20"><a href="#cb193-20" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (edad <span class="sc">&gt;=</span> <span class="fl">69.9</span> <span class="sc">&amp;&amp;</span> edad <span class="sc">&lt;</span> <span class="dv">75</span>) {</span>
<span id="cb193-21"><a href="#cb193-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="st">"Grupo10"</span>)</span>
<span id="cb193-22"><a href="#cb193-22" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb193-23"><a href="#cb193-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="st">"Fuera de rango"</span>)</span>
<span id="cb193-24"><a href="#cb193-24" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb193-25"><a href="#cb193-25" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb193-26"><a href="#cb193-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb193-27"><a href="#cb193-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Cargar los datos</span></span>
<span id="cb193-28"><a href="#cb193-28" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data_factor.csv"</span>)</span>
<span id="cb193-29"><a href="#cb193-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Recodificar la variable PCR para que los valores sean 0 y 1</span></span>
<span id="cb193-30"><a href="#cb193-30" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>PCR <span class="ot">&lt;-</span> data<span class="sc">$</span>PCR <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb193-31"><a href="#cb193-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb193-32"><a href="#cb193-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb193-33"><a href="#cb193-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Define server logic required to draw a histogram</span></span>
<span id="cb193-34"><a href="#cb193-34" aria-hidden="true" tabindex="-1"></a>server <span class="ot">&lt;-</span> <span class="cf">function</span>(input, output, session) {</span>
<span id="cb193-35"><a href="#cb193-35" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Convertir las columnas de data a factores</span></span>
<span id="cb193-36"><a href="#cb193-36" aria-hidden="true" tabindex="-1"></a>  data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"./data_factor.csv"</span>)</span>
<span id="cb193-37"><a href="#cb193-37" aria-hidden="true" tabindex="-1"></a>  data<span class="sc">$</span>PCR <span class="ot">&lt;-</span> data<span class="sc">$</span>PCR <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb193-38"><a href="#cb193-38" aria-hidden="true" tabindex="-1"></a>  data<span class="sc">$</span>Edad <span class="ot">&lt;-</span> <span class="fu">factor</span>(data<span class="sc">$</span>Edad)</span>
<span id="cb193-39"><a href="#cb193-39" aria-hidden="true" tabindex="-1"></a>  data<span class="sc">$</span>Estadio <span class="ot">&lt;-</span> <span class="fu">factor</span>(data<span class="sc">$</span>Estadio)</span>
<span id="cb193-40"><a href="#cb193-40" aria-hidden="true" tabindex="-1"></a>  data<span class="sc">$</span>Fenotipo <span class="ot">&lt;-</span> <span class="fu">factor</span>(data<span class="sc">$</span>Fenotipo)</span>
<span id="cb193-41"><a href="#cb193-41" aria-hidden="true" tabindex="-1"></a>  data<span class="sc">$</span>Grado <span class="ot">&lt;-</span> <span class="fu">factor</span>(data<span class="sc">$</span>Grado)</span>
<span id="cb193-42"><a href="#cb193-42" aria-hidden="true" tabindex="-1"></a>  data<span class="sc">$</span>REst <span class="ot">&lt;-</span> <span class="fu">factor</span>(data<span class="sc">$</span>REst)</span>
<span id="cb193-43"><a href="#cb193-43" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb193-44"><a href="#cb193-44" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Feedback para la edad</span></span>
<span id="cb193-45"><a href="#cb193-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">observeEvent</span>(input<span class="sc">$</span>edad, {</span>
<span id="cb193-46"><a href="#cb193-46" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (input<span class="sc">$</span>edad <span class="sc">&lt;</span> <span class="fl">29.09</span> <span class="sc">||</span> input<span class="sc">$</span>edad <span class="sc">&gt;</span> <span class="dv">76</span>) {</span>
<span id="cb193-47"><a href="#cb193-47" aria-hidden="true" tabindex="-1"></a>      output<span class="sc">$</span>edadFeedback <span class="ot">&lt;-</span> <span class="fu">renderText</span>({</span>
<span id="cb193-48"><a href="#cb193-48" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Por favor, introduce una edad entre 29 y 75 años."</span></span>
<span id="cb193-49"><a href="#cb193-49" aria-hidden="true" tabindex="-1"></a>      })</span>
<span id="cb193-50"><a href="#cb193-50" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb193-51"><a href="#cb193-51" aria-hidden="true" tabindex="-1"></a>      output<span class="sc">$</span>edadFeedback <span class="ot">&lt;-</span> <span class="fu">renderText</span>({</span>
<span id="cb193-52"><a href="#cb193-52" aria-hidden="true" tabindex="-1"></a>        <span class="st">""</span></span>
<span id="cb193-53"><a href="#cb193-53" aria-hidden="true" tabindex="-1"></a>      })</span>
<span id="cb193-54"><a href="#cb193-54" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb193-55"><a href="#cb193-55" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb193-56"><a href="#cb193-56" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb193-57"><a href="#cb193-57" aria-hidden="true" tabindex="-1"></a>  output<span class="sc">$</span>selectedThreshold <span class="ot">&lt;-</span> <span class="fu">renderText</span>({</span>
<span id="cb193-58"><a href="#cb193-58" aria-hidden="true" tabindex="-1"></a>    <span class="fu">paste</span>(<span class="st">"Threshold seleccionado:"</span>, input<span class="sc">$</span>threshold)</span>
<span id="cb193-59"><a href="#cb193-59" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb193-60"><a href="#cb193-60" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb193-61"><a href="#cb193-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">observeEvent</span>(input<span class="sc">$</span>predict, {</span>
<span id="cb193-62"><a href="#cb193-62" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (input<span class="sc">$</span>edad <span class="sc">&lt;</span> <span class="fl">29.09</span> <span class="sc">||</span> input<span class="sc">$</span>edad <span class="sc">&gt;</span> <span class="dv">76</span>) {</span>
<span id="cb193-63"><a href="#cb193-63" aria-hidden="true" tabindex="-1"></a>      output<span class="sc">$</span>edadFeedback <span class="ot">&lt;-</span> <span class="fu">renderText</span>({</span>
<span id="cb193-64"><a href="#cb193-64" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Por favor, introduce una edad entre 29 y 75 años."</span></span>
<span id="cb193-65"><a href="#cb193-65" aria-hidden="true" tabindex="-1"></a>      })</span>
<span id="cb193-66"><a href="#cb193-66" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(<span class="cn">NULL</span>)</span>
<span id="cb193-67"><a href="#cb193-67" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb193-68"><a href="#cb193-68" aria-hidden="true" tabindex="-1"></a>      output<span class="sc">$</span>edadFeedback <span class="ot">&lt;-</span> <span class="fu">renderText</span>({</span>
<span id="cb193-69"><a href="#cb193-69" aria-hidden="true" tabindex="-1"></a>        <span class="st">""</span></span>
<span id="cb193-70"><a href="#cb193-70" aria-hidden="true" tabindex="-1"></a>      })</span>
<span id="cb193-71"><a href="#cb193-71" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb193-72"><a href="#cb193-72" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb193-73"><a href="#cb193-73" aria-hidden="true" tabindex="-1"></a>    grupo_edad <span class="ot">&lt;-</span> <span class="fu">categorizar_edad</span>(input<span class="sc">$</span>edad)</span>
<span id="cb193-74"><a href="#cb193-74" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb193-75"><a href="#cb193-75" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Guardar las entradas del usuario en un vector asegurando que cada factor tenga al menos dos niveles</span></span>
<span id="cb193-76"><a href="#cb193-76" aria-hidden="true" tabindex="-1"></a>    new_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb193-77"><a href="#cb193-77" aria-hidden="true" tabindex="-1"></a>      <span class="at">Edad =</span> <span class="fu">factor</span>(grupo_edad, <span class="at">levels =</span> <span class="fu">levels</span>(data<span class="sc">$</span>Edad)),</span>
<span id="cb193-78"><a href="#cb193-78" aria-hidden="true" tabindex="-1"></a>      <span class="at">Estadio =</span> <span class="fu">factor</span>(input<span class="sc">$</span>estadio, <span class="at">levels =</span> <span class="fu">levels</span>(data<span class="sc">$</span>Estadio)),</span>
<span id="cb193-79"><a href="#cb193-79" aria-hidden="true" tabindex="-1"></a>      <span class="at">Fenotipo =</span> <span class="fu">factor</span>(input<span class="sc">$</span>fenotipo, <span class="at">levels =</span> <span class="fu">levels</span>(data<span class="sc">$</span>Fenotipo)),</span>
<span id="cb193-80"><a href="#cb193-80" aria-hidden="true" tabindex="-1"></a>      <span class="at">Grado =</span> <span class="fu">factor</span>(input<span class="sc">$</span>grado, <span class="at">levels =</span> <span class="fu">levels</span>(data<span class="sc">$</span>Grado)),</span>
<span id="cb193-81"><a href="#cb193-81" aria-hidden="true" tabindex="-1"></a>      <span class="at">REst =</span> <span class="fu">factor</span>(input<span class="sc">$</span>rest, <span class="at">levels =</span> <span class="fu">levels</span>(data<span class="sc">$</span>REst)),</span>
<span id="cb193-82"><a href="#cb193-82" aria-hidden="true" tabindex="-1"></a>      <span class="at">stringsAsFactors =</span> <span class="cn">TRUE</span></span>
<span id="cb193-83"><a href="#cb193-83" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb193-84"><a href="#cb193-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb193-85"><a href="#cb193-85" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb193-86"><a href="#cb193-86" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Convertir los datos a one-hot encoding, incluyendo PCR en data_matrix</span></span>
<span id="cb193-87"><a href="#cb193-87" aria-hidden="true" tabindex="-1"></a>    data_matrix <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(PCR <span class="sc">~</span> Edad <span class="sc">+</span> Estadio <span class="sc">+</span> Fenotipo <span class="sc">+</span> Grado <span class="sc">+</span> REst, <span class="at">data =</span> data)</span>
<span id="cb193-88"><a href="#cb193-88" aria-hidden="true" tabindex="-1"></a>    data_matrix <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(data_matrix)</span>
<span id="cb193-89"><a href="#cb193-89" aria-hidden="true" tabindex="-1"></a>    data_matrix<span class="sc">$</span>PCR <span class="ot">&lt;-</span> data<span class="sc">$</span>PCR</span>
<span id="cb193-90"><a href="#cb193-90" aria-hidden="true" tabindex="-1"></a>    data_matrix<span class="sc">$</span><span class="st">`</span><span class="at">(Intercept)</span><span class="st">`</span> <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb193-91"><a href="#cb193-91" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb193-92"><a href="#cb193-92" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb193-93"><a href="#cb193-93" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Crear las mismas columnas en new_data_matrix que en data_matrix</span></span>
<span id="cb193-94"><a href="#cb193-94" aria-hidden="true" tabindex="-1"></a>    new_data_matrix <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(<span class="sc">~</span> Edad <span class="sc">+</span> Estadio <span class="sc">+</span> Fenotipo <span class="sc">+</span> Grado <span class="sc">+</span> REst, <span class="at">data =</span> new_data)</span>
<span id="cb193-95"><a href="#cb193-95" aria-hidden="true" tabindex="-1"></a>    new_data_matrix <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(new_data_matrix)</span>
<span id="cb193-96"><a href="#cb193-96" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb193-97"><a href="#cb193-97" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Asegurarse de que new_data_matrix tenga las mismas columnas que data_matrix</span></span>
<span id="cb193-98"><a href="#cb193-98" aria-hidden="true" tabindex="-1"></a>    missing_cols <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(<span class="fu">names</span>(data_matrix), <span class="fu">names</span>(new_data_matrix))</span>
<span id="cb193-99"><a href="#cb193-99" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (col <span class="cf">in</span> missing_cols) {</span>
<span id="cb193-100"><a href="#cb193-100" aria-hidden="true" tabindex="-1"></a>      new_data_matrix[[col]] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb193-101"><a href="#cb193-101" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb193-102"><a href="#cb193-102" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb193-103"><a href="#cb193-103" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Reordenar las columnas para que coincidan</span></span>
<span id="cb193-104"><a href="#cb193-104" aria-hidden="true" tabindex="-1"></a>    new_data_matrix <span class="ot">&lt;-</span> new_data_matrix[<span class="fu">names</span>(data_matrix)]</span>
<span id="cb193-105"><a href="#cb193-105" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb193-106"><a href="#cb193-106" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Entrenar el modelo con todos los datos</span></span>
<span id="cb193-107"><a href="#cb193-107" aria-hidden="true" tabindex="-1"></a>    model <span class="ot">&lt;-</span> <span class="fu">nnet</span>(PCR <span class="sc">~</span> ., <span class="at">data =</span> data_matrix, <span class="at">size =</span> <span class="dv">5</span>, <span class="at">decay =</span> <span class="fl">0.4</span>)</span>
<span id="cb193-108"><a href="#cb193-108" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb193-109"><a href="#cb193-109" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Hacer la predicción raw</span></span>
<span id="cb193-110"><a href="#cb193-110" aria-hidden="true" tabindex="-1"></a>    prediccion_raw <span class="ot">&lt;-</span> <span class="fu">predict</span>(model, <span class="at">newdata =</span> new_data_matrix, <span class="at">type =</span> <span class="st">"raw"</span>)</span>
<span id="cb193-111"><a href="#cb193-111" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb193-112"><a href="#cb193-112" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Aplicar el threshold para determinar la predicción final</span></span>
<span id="cb193-113"><a href="#cb193-113" aria-hidden="true" tabindex="-1"></a>    prediccion_final <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(prediccion_raw <span class="sc">&gt;</span> input<span class="sc">$</span>threshold, <span class="st">"PCR-Positivo"</span>, <span class="st">"PCR-Negativo"</span>)</span>
<span id="cb193-114"><a href="#cb193-114" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb193-115"><a href="#cb193-115" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Crear el gráfico de barras</span></span>
<span id="cb193-116"><a href="#cb193-116" aria-hidden="true" tabindex="-1"></a>    output<span class="sc">$</span>predictionPlot <span class="ot">&lt;-</span> <span class="fu">renderPlotly</span>({</span>
<span id="cb193-117"><a href="#cb193-117" aria-hidden="true" tabindex="-1"></a>      <span class="fu">plot_ly</span>(</span>
<span id="cb193-118"><a href="#cb193-118" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> <span class="fu">c</span>(<span class="st">"PCR0"</span>, <span class="st">"PCR1"</span>),</span>
<span id="cb193-119"><a href="#cb193-119" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> <span class="fu">c</span>((<span class="dv">1</span> <span class="sc">-</span> prediccion_raw) <span class="sc">*</span> <span class="dv">100</span>, prediccion_raw <span class="sc">*</span> <span class="dv">100</span>),</span>
<span id="cb193-120"><a href="#cb193-120" aria-hidden="true" tabindex="-1"></a>        <span class="at">type =</span> <span class="st">'bar'</span>,</span>
<span id="cb193-121"><a href="#cb193-121" aria-hidden="true" tabindex="-1"></a>        <span class="at">name =</span> <span class="st">'Predicción'</span>,</span>
<span id="cb193-122"><a href="#cb193-122" aria-hidden="true" tabindex="-1"></a>        <span class="at">marker =</span> <span class="fu">list</span>(<span class="at">color =</span> <span class="fu">c</span>(<span class="st">'rgba(255, 99, 132, 0.6)'</span>, <span class="st">'rgba(54, 162, 235, 0.6)'</span>))</span>
<span id="cb193-123"><a href="#cb193-123" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span> <span class="fu">layout</span>(</span>
<span id="cb193-124"><a href="#cb193-124" aria-hidden="true" tabindex="-1"></a>        <span class="at">title =</span> <span class="st">"Porcentaje de Predicción"</span>,</span>
<span id="cb193-125"><a href="#cb193-125" aria-hidden="true" tabindex="-1"></a>        <span class="at">xaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">""</span>),</span>
<span id="cb193-126"><a href="#cb193-126" aria-hidden="true" tabindex="-1"></a>        <span class="at">yaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">"Porcentaje (%)"</span>)</span>
<span id="cb193-127"><a href="#cb193-127" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb193-128"><a href="#cb193-128" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb193-129"><a href="#cb193-129" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb193-130"><a href="#cb193-130" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Crear la tabla de resumen incluyendo la predicción</span></span>
<span id="cb193-131"><a href="#cb193-131" aria-hidden="true" tabindex="-1"></a>    output<span class="sc">$</span>inputValuesTable <span class="ot">&lt;-</span> <span class="fu">renderTable</span>({</span>
<span id="cb193-132"><a href="#cb193-132" aria-hidden="true" tabindex="-1"></a>      <span class="fu">data.frame</span>(</span>
<span id="cb193-133"><a href="#cb193-133" aria-hidden="true" tabindex="-1"></a>        <span class="at">Variable =</span> <span class="fu">c</span>(<span class="st">"Edad"</span>, <span class="st">"Categoría de Edad"</span>, <span class="st">"Estadio"</span>, <span class="st">"Fenotipo"</span>, <span class="st">"Grado"</span>, <span class="st">"REst"</span>, <span class="st">"Predicción"</span>),</span>
<span id="cb193-134"><a href="#cb193-134" aria-hidden="true" tabindex="-1"></a>        <span class="at">Valor =</span> <span class="fu">c</span>(input<span class="sc">$</span>edad, grupo_edad, input<span class="sc">$</span>estadio, input<span class="sc">$</span>fenotipo, input<span class="sc">$</span>grado, input<span class="sc">$</span>rest, prediccion_final)</span>
<span id="cb193-135"><a href="#cb193-135" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb193-136"><a href="#cb193-136" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb193-137"><a href="#cb193-137" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb193-138"><a href="#cb193-138" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>

<iframe src="https://mario-pascual-rshiny-uma.shinyapps.io/ModeloCancerMamaProduccion/" width="100%" height="600px" style="border:none;"></iframe>

<!-- -->


</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">Referencias</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-nci2024deteccion" class="csl-entry" role="listitem">
<span>«Exámenes de detección del cáncer de seno (mama) (PDQ®)»</span>. s.&nbsp;f. <a href="https://www.cancer.gov/espanol/tipos/seno/pro/deteccion-seno-pdq" class="uri">https://www.cancer.gov/espanol/tipos/seno/pro/deteccion-seno-pdq</a>.
</div>
<div id="ref-gonzalez2024predictive" class="csl-entry" role="listitem">
González, Mario Pascual. 2024. <span>«Modelado Predictivo: C<span>á</span>ncer de Mama»</span>. <a href="https://rpubs.com/mariopascuma/informecancermamamineria">https://rpubs.com/mariopascuma/informecancermamamineria</a>.
</div>
</div></section></div></main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copiado");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copiado");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Ejecutar el código</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb194" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb194-1"><a href="#cb194-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb194-2"><a href="#cb194-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Algoritmos de Aprendizaje Computacional"</span></span>
<span id="cb194-3"><a href="#cb194-3" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> "Mario Pascual González"</span></span>
<span id="cb194-4"><a href="#cb194-4" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb194-5"><a href="#cb194-5" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb194-6"><a href="#cb194-6" aria-hidden="true" tabindex="-1"></a><span class="co">    theme:</span></span>
<span id="cb194-7"><a href="#cb194-7" aria-hidden="true" tabindex="-1"></a><span class="co">      light: flatly</span></span>
<span id="cb194-8"><a href="#cb194-8" aria-hidden="true" tabindex="-1"></a><span class="co">      dark: darkly</span></span>
<span id="cb194-9"><a href="#cb194-9" aria-hidden="true" tabindex="-1"></a><span class="co">    highlight-style: monokai</span></span>
<span id="cb194-10"><a href="#cb194-10" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb194-11"><a href="#cb194-11" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-depth: 3</span></span>
<span id="cb194-12"><a href="#cb194-12" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-title: Contenidos</span></span>
<span id="cb194-13"><a href="#cb194-13" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-float:</span></span>
<span id="cb194-14"><a href="#cb194-14" aria-hidden="true" tabindex="-1"></a><span class="co">      collapsed: false</span></span>
<span id="cb194-15"><a href="#cb194-15" aria-hidden="true" tabindex="-1"></a><span class="co">      smooth-scroll: true</span></span>
<span id="cb194-16"><a href="#cb194-16" aria-hidden="true" tabindex="-1"></a><span class="co">    toc_scroll: true</span></span>
<span id="cb194-17"><a href="#cb194-17" aria-hidden="true" tabindex="-1"></a><span class="co">    number-sections: true</span></span>
<span id="cb194-18"><a href="#cb194-18" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: true</span></span>
<span id="cb194-19"><a href="#cb194-19" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools:</span></span>
<span id="cb194-20"><a href="#cb194-20" aria-hidden="true" tabindex="-1"></a><span class="co">      source: true</span></span>
<span id="cb194-21"><a href="#cb194-21" aria-hidden="true" tabindex="-1"></a><span class="co">      toggle: true</span></span>
<span id="cb194-22"><a href="#cb194-22" aria-hidden="true" tabindex="-1"></a><span class="co">      caption: Expand Code</span></span>
<span id="cb194-23"><a href="#cb194-23" aria-hidden="true" tabindex="-1"></a><span class="co">    html-math-method: katex</span></span>
<span id="cb194-24"><a href="#cb194-24" aria-hidden="true" tabindex="-1"></a><span class="co">    bibliography: references.bib</span></span>
<span id="cb194-25"><a href="#cb194-25" aria-hidden="true" tabindex="-1"></a><span class="co">    lang: es</span></span>
<span id="cb194-26"><a href="#cb194-26" aria-hidden="true" tabindex="-1"></a><span class="co">    other-links:</span></span>
<span id="cb194-27"><a href="#cb194-27" aria-hidden="true" tabindex="-1"></a><span class="co">    - text: LinkedIn</span></span>
<span id="cb194-28"><a href="#cb194-28" aria-hidden="true" tabindex="-1"></a><span class="co">      icon: linkedin</span></span>
<span id="cb194-29"><a href="#cb194-29" aria-hidden="true" tabindex="-1"></a><span class="co">      href: "https://www.linkedin.com/in/mario-pascual-gonzalez/"</span></span>
<span id="cb194-30"><a href="#cb194-30" aria-hidden="true" tabindex="-1"></a><span class="co">    - text: Correo Electrónico</span></span>
<span id="cb194-31"><a href="#cb194-31" aria-hidden="true" tabindex="-1"></a><span class="co">      icon: envelope</span></span>
<span id="cb194-32"><a href="#cb194-32" aria-hidden="true" tabindex="-1"></a><span class="co">      href: mailto:mario.pg02@gmail.com?subject=Contacto desde el informe de Modelado</span></span>
<span id="cb194-33"><a href="#cb194-33" aria-hidden="true" tabindex="-1"></a><span class="co">        Predictivo</span></span>
<span id="cb194-34"><a href="#cb194-34" aria-hidden="true" tabindex="-1"></a><span class="co">    - text: Perfil de Github</span></span>
<span id="cb194-35"><a href="#cb194-35" aria-hidden="true" tabindex="-1"></a><span class="co">      icon: github</span></span>
<span id="cb194-36"><a href="#cb194-36" aria-hidden="true" tabindex="-1"></a><span class="co">      href: https://github.com/MarioPasc</span></span>
<span id="cb194-37"><a href="#cb194-37" aria-hidden="true" tabindex="-1"></a><span class="co">    code-links:</span></span>
<span id="cb194-38"><a href="#cb194-38" aria-hidden="true" tabindex="-1"></a><span class="co">    - text: Repositorio del Informe</span></span>
<span id="cb194-39"><a href="#cb194-39" aria-hidden="true" tabindex="-1"></a><span class="co">      icon: "file-code"</span></span>
<span id="cb194-40"><a href="#cb194-40" aria-hidden="true" tabindex="-1"></a><span class="co">      href: "https://github.com/MarioPasc/Algoritmos-de-Aprendizaje-Computacional-R"</span></span>
<span id="cb194-41"><a href="#cb194-41" aria-hidden="true" tabindex="-1"></a><span class="an">resource_files:</span></span>
<span id="cb194-42"><a href="#cb194-42" aria-hidden="true" tabindex="-1"></a><span class="co">- references.bib</span></span>
<span id="cb194-43"><a href="#cb194-43" aria-hidden="true" tabindex="-1"></a><span class="co">- Variables.png</span></span>
<span id="cb194-44"><a href="#cb194-44" aria-hidden="true" tabindex="-1"></a><span class="co">- cancermet.jpg</span></span>
<span id="cb194-45"><a href="#cb194-45" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb194-46"><a href="#cb194-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-47"><a href="#cb194-47" aria-hidden="true" tabindex="-1"></a><span class="in">```{r setup, echo=FALSE, message=FALSE, warning=FALSE}</span></span>
<span id="cb194-48"><a href="#cb194-48" aria-hidden="true" tabindex="-1"></a><span class="in">#| output: false</span></span>
<span id="cb194-49"><a href="#cb194-49" aria-hidden="true" tabindex="-1"></a><span class="in">#| echo: false</span></span>
<span id="cb194-50"><a href="#cb194-50" aria-hidden="true" tabindex="-1"></a><span class="in">#| warning: false</span></span>
<span id="cb194-51"><a href="#cb194-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-52"><a href="#cb194-52" aria-hidden="true" tabindex="-1"></a><span class="in">library(glmnet)</span></span>
<span id="cb194-53"><a href="#cb194-53" aria-hidden="true" tabindex="-1"></a><span class="in">library(caret)</span></span>
<span id="cb194-54"><a href="#cb194-54" aria-hidden="true" tabindex="-1"></a><span class="in">library(readxl)</span></span>
<span id="cb194-55"><a href="#cb194-55" aria-hidden="true" tabindex="-1"></a><span class="in">library(readr)</span></span>
<span id="cb194-56"><a href="#cb194-56" aria-hidden="true" tabindex="-1"></a><span class="in">library(ggplot2)</span></span>
<span id="cb194-57"><a href="#cb194-57" aria-hidden="true" tabindex="-1"></a><span class="in">library(dplyr)</span></span>
<span id="cb194-58"><a href="#cb194-58" aria-hidden="true" tabindex="-1"></a><span class="in">library(broom)</span></span>
<span id="cb194-59"><a href="#cb194-59" aria-hidden="true" tabindex="-1"></a><span class="in">library(DT)</span></span>
<span id="cb194-60"><a href="#cb194-60" aria-hidden="true" tabindex="-1"></a><span class="in">library(tidyverse)</span></span>
<span id="cb194-61"><a href="#cb194-61" aria-hidden="true" tabindex="-1"></a><span class="in">library(reshape2)</span></span>
<span id="cb194-62"><a href="#cb194-62" aria-hidden="true" tabindex="-1"></a><span class="in">library(MASS)</span></span>
<span id="cb194-63"><a href="#cb194-63" aria-hidden="true" tabindex="-1"></a><span class="in">library(pROC)</span></span>
<span id="cb194-64"><a href="#cb194-64" aria-hidden="true" tabindex="-1"></a><span class="in">library(e1071)</span></span>
<span id="cb194-65"><a href="#cb194-65" aria-hidden="true" tabindex="-1"></a><span class="in">library(nnet)</span></span>
<span id="cb194-66"><a href="#cb194-66" aria-hidden="true" tabindex="-1"></a><span class="in">library(rpart)</span></span>
<span id="cb194-67"><a href="#cb194-67" aria-hidden="true" tabindex="-1"></a><span class="in">library(class)</span></span>
<span id="cb194-68"><a href="#cb194-68" aria-hidden="true" tabindex="-1"></a><span class="in">library(mboost)</span></span>
<span id="cb194-69"><a href="#cb194-69" aria-hidden="true" tabindex="-1"></a><span class="in">library(plotly)</span></span>
<span id="cb194-70"><a href="#cb194-70" aria-hidden="true" tabindex="-1"></a><span class="in">library(RColorBrewer)</span></span>
<span id="cb194-71"><a href="#cb194-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-72"><a href="#cb194-72" aria-hidden="true" tabindex="-1"></a><span class="in">data_original &lt;- read.csv(file = "./data/datos_limpios.csv", sep = ",", dec=".")</span></span>
<span id="cb194-73"><a href="#cb194-73" aria-hidden="true" tabindex="-1"></a><span class="in">data_original["X"] &lt;- NULL</span></span>
<span id="cb194-74"><a href="#cb194-74" aria-hidden="true" tabindex="-1"></a><span class="in">nuevo_orden &lt;- c("Edad", "REst", "RPro", "Her2", "Estadio", "NodAfec", "Grado", "Fenotipo", "PCR")</span></span>
<span id="cb194-75"><a href="#cb194-75" aria-hidden="true" tabindex="-1"></a><span class="in">data_original &lt;- data_original[, nuevo_orden]</span></span>
<span id="cb194-76"><a href="#cb194-76" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-77"><a href="#cb194-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-78"><a href="#cb194-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-79"><a href="#cb194-79" aria-hidden="true" tabindex="-1"></a><span class="fu"># Introducción</span></span>
<span id="cb194-80"><a href="#cb194-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-81"><a href="#cb194-81" aria-hidden="true" tabindex="-1"></a>El cáncer de mama es el cáncer no cutáneo más común en las mujeres en los Estados Unidos, con una incidencia estimada de 310,720 casos de enfermedad invasiva y 42,250 defunciones durante 2024 <span class="co">[</span><span class="ot">@nci2024deteccion</span><span class="co">]</span>. Este problema de salud tiene una relevancia crítica debido a su impacto en la vida de las mujeres y en la sociedad en general (@fig-cancermama).</span>
<span id="cb194-82"><a href="#cb194-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-83"><a href="#cb194-83" aria-hidden="true" tabindex="-1"></a>La capacidad de anticipar la metástasis de un paciente de cáncer de mama es esencial, ya que permite una intervención temprana y potencialmente curativa. La acción rápida contra el cáncer, especialmente en sus etapas iniciales, es crucial para salvar vidas. De aquí surge la necesidad de desarrollar modelos predictivos basados en datos, los cuales pueden ofrecer una herramienta valiosa para identificar a los pacientes en riesgo de metástasis, permitiendo un diagnóstico y tratamiento tempranos.</span>
<span id="cb194-84"><a href="#cb194-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-85"><a href="#cb194-85" aria-hidden="true" tabindex="-1"></a>Para los clínicos, la implementación de un modelo predictivo para predecir el estado PCR de los pacientes con cáncer de mama puede mejorar la precisión del diagnóstico, reduciendo el sobrediagnóstico y el sobretratamiento, lo cual es particularmente relevante dado que la detección temprana del cáncer de mama puede conducir a un sobrediagnóstico, donde se detectan cánceres que no representan una amenaza para la vida del paciente <span class="co">[</span><span class="ot">@nci2024deteccion</span><span class="co">]</span>. Por otra parte, estos modelos pueden ayudar a optimizar el uso de recursos, al permitir una asignación más eficiente de los tratamientos y exámenes, basada en la probabilidad de que un paciente progrese a metástasis. Tercero, pueden mejorar la calidad de vida de los pacientes al permitir un enfoque más personalizado del tratamiento, basado en su riesgo individual de metástasis.</span>
<span id="cb194-86"><a href="#cb194-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-87"><a href="#cb194-87" aria-hidden="true" tabindex="-1"></a><span class="al">![Incidencias generales del cáncer de mama invasivo y cáncer de mama metastásico en mujeres de 40 o más años en 9 sitios del programa Surveillance, Epidemiology, and End Results (SEER) durante el período de 1975 a 2012.](cancermet.jpg)</span>{#fig-cancermama fig-align="center"}</span>
<span id="cb194-88"><a href="#cb194-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-89"><a href="#cb194-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-90"><a href="#cb194-90" aria-hidden="true" tabindex="-1"></a><span class="fu">## Objetivos</span></span>
<span id="cb194-91"><a href="#cb194-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-92"><a href="#cb194-92" aria-hidden="true" tabindex="-1"></a>El principal objetivo de este estudio es obtener un modelo ajustado al conjunto de datos de Metástasis de Cáncer de Mama para poder realizar predicciones efectivas sobre el estado PCR de un paciente dada una serie de variables o características sobre este. Consecuentemente, nace de manera natural un segundo objetivo principal, y es el de la determinación de las características más importantes para la determinación del estado del paciente, es decir, la realización de una *selección de características*. Todo esto se realizará con la finalidad de poner un modelo en producción, el cual pueda ser usado a través de la interfaz <span class="in">`RShiny`</span> para la predicción efectiva del estado PCR de un paciente de Cáncer de Mama.</span>
<span id="cb194-93"><a href="#cb194-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-94"><a href="#cb194-94" aria-hidden="true" tabindex="-1"></a>Objetivos secundarios de este proyecto incluyen el estudio de la estabilidad en la selección de características a lo largo de los diferentes métodos y modelos aplicados. Se realizará también una exploración de la estabilidad de los hiperparámetros de un mismo modelo a lo largo de diferentes semillas aleatorias establecidas.  </span>
<span id="cb194-95"><a href="#cb194-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-96"><a href="#cb194-96" aria-hidden="true" tabindex="-1"></a>| Objetivo                                                                                                                                                    | Tipo               |</span>
<span id="cb194-97"><a href="#cb194-97" aria-hidden="true" tabindex="-1"></a>|---------------------------------------------------------------------------------|--------------------|</span>
<span id="cb194-98"><a href="#cb194-98" aria-hidden="true" tabindex="-1"></a>| Obtener un modelo ajustado al conjunto de datos de Metástasis de Cáncer de Mama | Principal          |</span>
<span id="cb194-99"><a href="#cb194-99" aria-hidden="true" tabindex="-1"></a>| Determinación de características más importantes en la predicción del estado PCR del paciente  | Principal          |</span>
<span id="cb194-100"><a href="#cb194-100" aria-hidden="true" tabindex="-1"></a>| Poner un modelo en producción, accesible a través de la interfaz <span class="in">`RShiny`</span>       | Principal          |</span>
<span id="cb194-101"><a href="#cb194-101" aria-hidden="true" tabindex="-1"></a>| Estudiar la estabilidad en las características seleccionadas                    | Secundario         |</span>
<span id="cb194-102"><a href="#cb194-102" aria-hidden="true" tabindex="-1"></a>| Explorar la estabilidad de los hiperparámetros de un mismo modelo a lo largo de diferentes semillas aleatorias establecidas.                                 | Secundario         |</span>
<span id="cb194-103"><a href="#cb194-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-104"><a href="#cb194-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-105"><a href="#cb194-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-106"><a href="#cb194-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-107"><a href="#cb194-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-108"><a href="#cb194-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-109"><a href="#cb194-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-110"><a href="#cb194-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-111"><a href="#cb194-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-112"><a href="#cb194-112" aria-hidden="true" tabindex="-1"></a><span class="fu"># Metodología</span></span>
<span id="cb194-113"><a href="#cb194-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-114"><a href="#cb194-114" aria-hidden="true" tabindex="-1"></a>A lo largo del desarrollo de este proyecto se han utilizado una serie de datos y se han seguido unas directrices ordenadas. Todo esto queda redactado en este apartado.</span>
<span id="cb194-115"><a href="#cb194-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-116"><a href="#cb194-116" aria-hidden="true" tabindex="-1"></a><span class="fu">## Material</span></span>
<span id="cb194-117"><a href="#cb194-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-118"><a href="#cb194-118" aria-hidden="true" tabindex="-1"></a><span class="fu">### Conjunto de Datos Inicial</span></span>
<span id="cb194-119"><a href="#cb194-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-120"><a href="#cb194-120" aria-hidden="true" tabindex="-1"></a>Se nos ha proporcionado un fichero en formato *Comma-Separated Values* (<span class="in">`.csv`</span>) gracias al trabajo del Dr. José Manuel Jérez Aragonés. Las características de este dataset quedan descritas en la @fig-desccol.</span>
<span id="cb194-121"><a href="#cb194-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-122"><a href="#cb194-122" aria-hidden="true" tabindex="-1"></a><span class="al">![Variables Originales del Conjunto](Variables.png)</span>{#fig-desccol fig-align="center"}</span>
<span id="cb194-123"><a href="#cb194-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-124"><a href="#cb194-124" aria-hidden="true" tabindex="-1"></a>Se puede identificar la variable **PCR** como la variable *target* u objetivo de este estudio. Consecuentemente, se ha decidido eliminar la variable <span class="in">`Muestra`</span>, ya que no parece guardar una relevancia clínica, al ser un identificador único para cada paciente, compuesto por un código identificativo del estudio en el que fue obtenido el dato, y una serie de números únicos para cada persona.</span>
<span id="cb194-125"><a href="#cb194-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-126"><a href="#cb194-126" aria-hidden="true" tabindex="-1"></a><span class="fu">### Pre-Procesamiento</span></span>
<span id="cb194-127"><a href="#cb194-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-128"><a href="#cb194-128" aria-hidden="true" tabindex="-1"></a>El conjunto de datos del que se hará uso fue curado en un estudio anterior a este, habiéndose imputado los valores faltantes (<span class="in">`NA`</span>) por la mediana o la moda, si estos provenían de una característica numérica, o de tipo factor, respectivamente <span class="co">[</span><span class="ot">@gonzalez2024predictive</span><span class="co">]</span>. </span>
<span id="cb194-129"><a href="#cb194-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-130"><a href="#cb194-130" aria-hidden="true" tabindex="-1"></a>Por otra parte, para asegurar que se tiene total control sobre los datos con los que se introducen al modelo, se han creado dos versiones del conjunto de datos. La primera se trata de una versión en la que todas las variables son de tipo factor, y la variable edad ha sido estratificada en diferentes intervalos. Por otra parte, se ha generado un conjunto de datos numérico, el cual es el conjunto de datos de tipo factor codificado mediante técnicas como *One-Hot Encoder*, o manteniendo las variables con su mismo tipo, si estas eran numéricas originalmente. Se comentan a continuación las modificaciones específicas.</span>
<span id="cb194-131"><a href="#cb194-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-132"><a href="#cb194-132" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Conjunto de Datos Factor</span></span>
<span id="cb194-133"><a href="#cb194-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-134"><a href="#cb194-134" aria-hidden="true" tabindex="-1"></a>Este conjunto de datos existe para asegurar la interpretabilidad de los resultados de los modelos. La única variable que puede suponer un problema es la variable <span class="in">`Edad`</span>, ya que es una variable continua, sin embargo, este problema, como se ha comentado anteriormente, se resolverá estratificándola. La anchura de los bins se calculará siguiendo la regla de Sturges, en la que se toma el logaritmo en base 2 de la cantidad de muestras y el rango de la variable para poder computar la anchura más adecuada. </span>
<span id="cb194-135"><a href="#cb194-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-136"><a href="#cb194-136" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb194-137"><a href="#cb194-137" aria-hidden="true" tabindex="-1"></a>k = \frac{max(Edad) - min(Edad)}{\log_2(n) + 1}</span>
<span id="cb194-138"><a href="#cb194-138" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb194-139"><a href="#cb194-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-142"><a href="#cb194-142" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb194-143"><a href="#cb194-143" aria-hidden="true" tabindex="-1"></a><span class="co"># Convertir la variable 'Edad' a numérica</span></span>
<span id="cb194-144"><a href="#cb194-144" aria-hidden="true" tabindex="-1"></a>data_original<span class="sc">$</span>Edad <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(data_original<span class="sc">$</span>Edad)</span>
<span id="cb194-145"><a href="#cb194-145" aria-hidden="true" tabindex="-1"></a>data_factor <span class="ot">&lt;-</span> data_original</span>
<span id="cb194-146"><a href="#cb194-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-147"><a href="#cb194-147" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculando el número de bins con la regla de Sturges</span></span>
<span id="cb194-148"><a href="#cb194-148" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">nrow</span>(data_factor)</span>
<span id="cb194-149"><a href="#cb194-149" aria-hidden="true" tabindex="-1"></a>k <span class="ot">&lt;-</span> <span class="fu">ceiling</span>(<span class="fu">log2</span>(n) <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb194-150"><a href="#cb194-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-151"><a href="#cb194-151" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculando el rango y el tamaño de cada bin</span></span>
<span id="cb194-152"><a href="#cb194-152" aria-hidden="true" tabindex="-1"></a>minimo <span class="ot">&lt;-</span> <span class="fu">min</span>(data_factor<span class="sc">$</span>Edad)</span>
<span id="cb194-153"><a href="#cb194-153" aria-hidden="true" tabindex="-1"></a>maximo <span class="ot">&lt;-</span> <span class="fu">max</span>(data_factor<span class="sc">$</span>Edad)</span>
<span id="cb194-154"><a href="#cb194-154" aria-hidden="true" tabindex="-1"></a>ancho_bin <span class="ot">&lt;-</span> (maximo <span class="sc">-</span> minimo) <span class="sc">/</span> k</span>
<span id="cb194-155"><a href="#cb194-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-156"><a href="#cb194-156" aria-hidden="true" tabindex="-1"></a><span class="co"># Estratificar la variable 'Edad' en grupos</span></span>
<span id="cb194-157"><a href="#cb194-157" aria-hidden="true" tabindex="-1"></a>data_factor<span class="sc">$</span>Edad_estratificada <span class="ot">&lt;-</span> <span class="fu">cut</span>(data_factor<span class="sc">$</span>Edad, </span>
<span id="cb194-158"><a href="#cb194-158" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="fu">min</span>(data_factor<span class="sc">$</span>Edad), <span class="fu">max</span>(data_factor<span class="sc">$</span>Edad), <span class="at">by =</span> ancho_bin), </span>
<span id="cb194-159"><a href="#cb194-159" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">include.lowest =</span> <span class="cn">TRUE</span>, <span class="at">right =</span> <span class="cn">FALSE</span>)</span>
<span id="cb194-160"><a href="#cb194-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-161"><a href="#cb194-161" aria-hidden="true" tabindex="-1"></a><span class="co"># Asignar nombres de grupo a los niveles de Edad_estratificada</span></span>
<span id="cb194-162"><a href="#cb194-162" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(data_factor<span class="sc">$</span>Edad_estratificada) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"Grupo"</span>, <span class="fu">seq_along</span>(<span class="fu">levels</span>(data_factor<span class="sc">$</span>Edad_estratificada)))</span>
<span id="cb194-163"><a href="#cb194-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-164"><a href="#cb194-164" aria-hidden="true" tabindex="-1"></a><span class="co"># Convertir todas las variables del dataframe a factor, excepto 'Edad'</span></span>
<span id="cb194-165"><a href="#cb194-165" aria-hidden="true" tabindex="-1"></a>data_factor <span class="ot">&lt;-</span> data_factor <span class="sc">%&gt;%</span></span>
<span id="cb194-166"><a href="#cb194-166" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_at</span>(<span class="fu">vars</span>(<span class="sc">-</span>Edad), as.factor)</span>
<span id="cb194-167"><a href="#cb194-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-168"><a href="#cb194-168" aria-hidden="true" tabindex="-1"></a><span class="co"># Actualizar la variable Edad con los grupos</span></span>
<span id="cb194-169"><a href="#cb194-169" aria-hidden="true" tabindex="-1"></a>data_factor<span class="sc">$</span>Edad <span class="ot">&lt;-</span> data_factor<span class="sc">$</span>Edad_estratificada</span>
<span id="cb194-170"><a href="#cb194-170" aria-hidden="true" tabindex="-1"></a>data_factor<span class="sc">$</span>Edad_estratificada <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb194-171"><a href="#cb194-171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-172"><a href="#cb194-172" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="fu">head</span>(data_factor, <span class="dv">10</span>))</span>
<span id="cb194-173"><a href="#cb194-173" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-174"><a href="#cb194-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-175"><a href="#cb194-175" aria-hidden="true" tabindex="-1"></a>Esta estratificación se puede justificar con el hecho de que la interpretación de las predicciones del modelo puede ser más adecuada, ya que no estaríamos hablando de un valor concreto de edad que se repite a la hora de analizar los pacientes PCR-positivos, sino que tal vez se podría identificar una tendencia en los pacientes de un determinado rango de edad a sufrir una metástasis. </span>
<span id="cb194-176"><a href="#cb194-176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-177"><a href="#cb194-177" aria-hidden="true" tabindex="-1"></a>| Grupo   | Rango de Edad |</span>
<span id="cb194-178"><a href="#cb194-178" aria-hidden="true" tabindex="-1"></a>|---------|----------------|</span>
<span id="cb194-179"><a href="#cb194-179" aria-hidden="true" tabindex="-1"></a>| Grupo 1 | [24,29.1)      |</span>
<span id="cb194-180"><a href="#cb194-180" aria-hidden="true" tabindex="-1"></a>| Grupo 2 | [29.1,34.2)    |</span>
<span id="cb194-181"><a href="#cb194-181" aria-hidden="true" tabindex="-1"></a>| Grupo 3 | [34.2,39.3)    |</span>
<span id="cb194-182"><a href="#cb194-182" aria-hidden="true" tabindex="-1"></a>| Grupo 4 | [39.3,44.4)    |</span>
<span id="cb194-183"><a href="#cb194-183" aria-hidden="true" tabindex="-1"></a>| Grupo 5 | [44.4,49.5)    |</span>
<span id="cb194-184"><a href="#cb194-184" aria-hidden="true" tabindex="-1"></a>| Grupo 6 | [49.5,54.6)    |</span>
<span id="cb194-185"><a href="#cb194-185" aria-hidden="true" tabindex="-1"></a>| Grupo 7 | [54.6,59.7)    |</span>
<span id="cb194-186"><a href="#cb194-186" aria-hidden="true" tabindex="-1"></a>| Grupo 8 | [59.7,64.8)    |</span>
<span id="cb194-187"><a href="#cb194-187" aria-hidden="true" tabindex="-1"></a>| Grupo 9 | [64.8,69.9)    |</span>
<span id="cb194-188"><a href="#cb194-188" aria-hidden="true" tabindex="-1"></a>| Grupo 10| [69.9,75)      |</span>
<span id="cb194-189"><a href="#cb194-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-190"><a href="#cb194-190" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Conjunto de Datos Numérico</span></span>
<span id="cb194-191"><a href="#cb194-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-192"><a href="#cb194-192" aria-hidden="true" tabindex="-1"></a>El paradigma de este estudio engloba la búsqueda del algoritmo de aprendizaje computacional que mejor prediga el estado PCR de un paciente no visto, todo desde un punto de vista de la Ingeniería. Debido a esta falta de conocimiento clínico, se ha decidido no asumir un orden de las variables factor a la hora de encontrar su codificación numérica (por ejemplo, se ha decidido no asumir que un valor de <span class="in">`Grado: II`</span> es más importante o severo que un <span class="in">`Grado: I`</span>). Es port esto que se ha decidido usar la función <span class="in">`dummyVars`</span> para realizar una codificación *One-Hot* a las variables. Este conjunto de datos existe para poder tener siempre presente los datos numéricos que se pasan a los modelos de ML, así como para que se use en algunas implementaciones concretas, sin embargo, la regla será usar el conjunto <span class="in">`data_factor`</span> como entrada. </span>
<span id="cb194-193"><a href="#cb194-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-196"><a href="#cb194-196" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb194-197"><a href="#cb194-197" aria-hidden="true" tabindex="-1"></a><span class="co"># Generación del conjunto de datos numérico</span></span>
<span id="cb194-198"><a href="#cb194-198" aria-hidden="true" tabindex="-1"></a>encode_data <span class="ot">&lt;-</span> <span class="cf">function</span>(data, target_name) {</span>
<span id="cb194-199"><a href="#cb194-199" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Convertir variables categóricas sin orden en dummies</span></span>
<span id="cb194-200"><a href="#cb194-200" aria-hidden="true" tabindex="-1"></a>  data <span class="ot">&lt;-</span> <span class="fu">dummyVars</span>(<span class="sc">~</span> ., <span class="at">data =</span> data, <span class="at">fullRank =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> <span class="fu">predict</span>(data) <span class="sc">%&gt;%</span> <span class="fu">as.data.frame</span>()</span>
<span id="cb194-201"><a href="#cb194-201" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Asegurar que la variable objetivo esté al final</span></span>
<span id="cb194-202"><a href="#cb194-202" aria-hidden="true" tabindex="-1"></a>  target <span class="ot">&lt;-</span> data[[target_name]]</span>
<span id="cb194-203"><a href="#cb194-203" aria-hidden="true" tabindex="-1"></a>  data[[target_name]] <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb194-204"><a href="#cb194-204" aria-hidden="true" tabindex="-1"></a>  data[[target_name]] <span class="ot">&lt;-</span> target</span>
<span id="cb194-205"><a href="#cb194-205" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(data)</span>
<span id="cb194-206"><a href="#cb194-206" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb194-207"><a href="#cb194-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-208"><a href="#cb194-208" aria-hidden="true" tabindex="-1"></a>data_numeric <span class="ot">&lt;-</span> <span class="fu">encode_data</span>(data_original, <span class="st">"PCR"</span>)</span>
<span id="cb194-209"><a href="#cb194-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-210"><a href="#cb194-210" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="fu">head</span>(data_numeric, <span class="dv">10</span>))</span>
<span id="cb194-211"><a href="#cb194-211" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-212"><a href="#cb194-212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-213"><a href="#cb194-213" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Análisis Exploratorio</span></span>
<span id="cb194-214"><a href="#cb194-214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-215"><a href="#cb194-215" aria-hidden="true" tabindex="-1"></a>Se va a proceder a realizar un análisis de la distribución de los datos del conjunto <span class="in">`data_factor`</span>. Este análisis pretende dar conclusiones sobre el sesgo y la varianza de los datos con la finalidad de tomar decisiones sobre la inclusión o deleción de variables del conjunto de datos. </span>
<span id="cb194-216"><a href="#cb194-216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-219"><a href="#cb194-219" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb194-220"><a href="#cb194-220" aria-hidden="true" tabindex="-1"></a>blue <span class="ot">=</span> <span class="st">'#377eb8'</span></span>
<span id="cb194-221"><a href="#cb194-221" aria-hidden="true" tabindex="-1"></a>red <span class="ot">=</span> <span class="st">'#e41a1c'</span></span>
<span id="cb194-222"><a href="#cb194-222" aria-hidden="true" tabindex="-1"></a>plot_variable_distribution <span class="ot">&lt;-</span> <span class="cf">function</span>(data, variable_name, target_name) {</span>
<span id="cb194-223"><a href="#cb194-223" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Comprobar si las variables existen en el data.frame</span></span>
<span id="cb194-224"><a href="#cb194-224" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span>(variable_name <span class="sc">%in%</span> <span class="fu">names</span>(data) <span class="sc">&amp;&amp;</span> target_name <span class="sc">%in%</span> <span class="fu">names</span>(data))) {</span>
<span id="cb194-225"><a href="#cb194-225" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"Una o ambas variables especificadas no existen en el data.frame proporcionado."</span>)</span>
<span id="cb194-226"><a href="#cb194-226" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb194-227"><a href="#cb194-227" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb194-228"><a href="#cb194-228" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Extraer la variable y la variable target del data.frame</span></span>
<span id="cb194-229"><a href="#cb194-229" aria-hidden="true" tabindex="-1"></a>  variable <span class="ot">&lt;-</span> data[[variable_name]]</span>
<span id="cb194-230"><a href="#cb194-230" aria-hidden="true" tabindex="-1"></a>  target <span class="ot">&lt;-</span> data[[target_name]]</span>
<span id="cb194-231"><a href="#cb194-231" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb194-232"><a href="#cb194-232" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Asegurar que la variable target es factor</span></span>
<span id="cb194-233"><a href="#cb194-233" aria-hidden="true" tabindex="-1"></a>  data[[target_name]] <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(data[[target_name]])</span>
<span id="cb194-234"><a href="#cb194-234" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb194-235"><a href="#cb194-235" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Determinar si la variable principal es numérica o factor</span></span>
<span id="cb194-236"><a href="#cb194-236" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.numeric</span>(variable)) {</span>
<span id="cb194-237"><a href="#cb194-237" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Crear un histograma para variables numéricas</span></span>
<span id="cb194-238"><a href="#cb194-238" aria-hidden="true" tabindex="-1"></a>    p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(data, <span class="fu">aes_string</span>(<span class="at">x =</span> variable_name, <span class="at">fill =</span> target_name)) <span class="sc">+</span></span>
<span id="cb194-239"><a href="#cb194-239" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_histogram</span>(<span class="at">position =</span> <span class="st">"identity"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">bins =</span> <span class="dv">30</span>) <span class="sc">+</span></span>
<span id="cb194-240"><a href="#cb194-240" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"0"</span> <span class="ot">=</span> blue, <span class="st">"1"</span> <span class="ot">=</span> red)) <span class="sc">+</span></span>
<span id="cb194-241"><a href="#cb194-241" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ggtitle</span>(<span class="fu">paste</span>(<span class="st">"Distribución de"</span>, variable_name, <span class="st">"por"</span>, target_name)) <span class="sc">+</span></span>
<span id="cb194-242"><a href="#cb194-242" aria-hidden="true" tabindex="-1"></a>      <span class="fu">xlab</span>(variable_name) <span class="sc">+</span></span>
<span id="cb194-243"><a href="#cb194-243" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ylab</span>(<span class="st">"Frecuencia"</span>)</span>
<span id="cb194-244"><a href="#cb194-244" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (<span class="fu">is.factor</span>(variable)) {</span>
<span id="cb194-245"><a href="#cb194-245" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Crear un gráfico de barras para factores</span></span>
<span id="cb194-246"><a href="#cb194-246" aria-hidden="true" tabindex="-1"></a>    p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(data, <span class="fu">aes_string</span>(<span class="at">x =</span> variable_name, <span class="at">fill =</span> target_name)) <span class="sc">+</span></span>
<span id="cb194-247"><a href="#cb194-247" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_bar</span>(<span class="at">position =</span> <span class="st">"stack"</span>) <span class="sc">+</span></span>
<span id="cb194-248"><a href="#cb194-248" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"0"</span> <span class="ot">=</span> blue, <span class="st">"1"</span> <span class="ot">=</span> red)) <span class="sc">+</span></span>
<span id="cb194-249"><a href="#cb194-249" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ggtitle</span>(<span class="fu">paste</span>(<span class="st">"Distribución de"</span>, variable_name, <span class="st">"por"</span>, target_name)) <span class="sc">+</span></span>
<span id="cb194-250"><a href="#cb194-250" aria-hidden="true" tabindex="-1"></a>      <span class="fu">xlab</span>(variable_name) <span class="sc">+</span></span>
<span id="cb194-251"><a href="#cb194-251" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ylab</span>(<span class="st">"Frecuencia"</span>) <span class="sc">+</span></span>
<span id="cb194-252"><a href="#cb194-252" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"right"</span>)</span>
<span id="cb194-253"><a href="#cb194-253" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb194-254"><a href="#cb194-254" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"El tipo de la variable debe ser numérico o factor."</span>)</span>
<span id="cb194-255"><a href="#cb194-255" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb194-256"><a href="#cb194-256" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb194-257"><a href="#cb194-257" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Imprimir el gráfico</span></span>
<span id="cb194-258"><a href="#cb194-258" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(p)</span>
<span id="cb194-259"><a href="#cb194-259" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb194-260"><a href="#cb194-260" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-261"><a href="#cb194-261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-262"><a href="#cb194-262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-263"><a href="#cb194-263" aria-hidden="true" tabindex="-1"></a>::: {.panel-tabset}</span>
<span id="cb194-264"><a href="#cb194-264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-265"><a href="#cb194-265" aria-hidden="true" tabindex="-1"></a><span class="fu">## Edad</span></span>
<span id="cb194-266"><a href="#cb194-266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-267"><a href="#cb194-267" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message=FALSE, warning=FALSE}</span></span>
<span id="cb194-268"><a href="#cb194-268" aria-hidden="true" tabindex="-1"></a><span class="in">plot_variable_distribution(data_factor, "Edad", "PCR")</span></span>
<span id="cb194-269"><a href="#cb194-269" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-270"><a href="#cb194-270" aria-hidden="true" tabindex="-1"></a>Como se puede observar, la variable <span class="in">`Edad`</span> parece seguir una distribución normal o gaussiana, en la que la mayor cantidad de los datos se encuentran en los grupos centrales. La mayoría de los datos están clasificados por PCR-Positivos (<span class="in">`PCR=1`</span>), indicando un claro sesgo, sin embargo, se considera que hay suficientes datos en la variable como para mantenerla.   </span>
<span id="cb194-271"><a href="#cb194-271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-272"><a href="#cb194-272" aria-hidden="true" tabindex="-1"></a><span class="fu">## REst</span></span>
<span id="cb194-273"><a href="#cb194-273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-274"><a href="#cb194-274" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message=FALSE, warning=FALSE}</span></span>
<span id="cb194-275"><a href="#cb194-275" aria-hidden="true" tabindex="-1"></a><span class="in">plot_variable_distribution(data_factor, "REst", "PCR")</span></span>
<span id="cb194-276"><a href="#cb194-276" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-277"><a href="#cb194-277" aria-hidden="true" tabindex="-1"></a>La variable <span class="in">`REst`</span> muestra dos clases, para las cuales hay una diferencia de datos de, aproximadamente, 100 muestras. La clase <span class="in">`N`</span> muestra un mayor equilibrio en cuanto a la relación de pacientes PCR-Positivos y PCR-Negativos que el valor <span class="in">`P`</span>, para el cual, solo paroximadamente un sexto de los datos son PCR-Positivos.</span>
<span id="cb194-278"><a href="#cb194-278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-279"><a href="#cb194-279" aria-hidden="true" tabindex="-1"></a><span class="fu">## RPro</span></span>
<span id="cb194-280"><a href="#cb194-280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-281"><a href="#cb194-281" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message=FALSE, warning=FALSE}</span></span>
<span id="cb194-282"><a href="#cb194-282" aria-hidden="true" tabindex="-1"></a><span class="in">plot_variable_distribution(data_factor, "RPro", "PCR")</span></span>
<span id="cb194-283"><a href="#cb194-283" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-284"><a href="#cb194-284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-285"><a href="#cb194-285" aria-hidden="true" tabindex="-1"></a>La variable <span class="in">`RPro`</span> muestra dos clases (<span class="in">`N`</span> y <span class="in">`P`</span>). Ambas clases tienen una distribución similar en términos de número de muestras totales. La clase <span class="in">`N`</span> presenta una mayor proporción de pacientes PCR-Positivos (<span class="in">`PCR=1`</span>) en comparación con la clase <span class="in">`P`</span>.</span>
<span id="cb194-286"><a href="#cb194-286" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-287"><a href="#cb194-287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-288"><a href="#cb194-288" aria-hidden="true" tabindex="-1"></a><span class="fu">## Her2</span></span>
<span id="cb194-289"><a href="#cb194-289" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-290"><a href="#cb194-290" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message=FALSE, warning=FALSE}</span></span>
<span id="cb194-291"><a href="#cb194-291" aria-hidden="true" tabindex="-1"></a><span class="in">plot_variable_distribution(data_factor, "Her2", "PCR")</span></span>
<span id="cb194-292"><a href="#cb194-292" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-293"><a href="#cb194-293" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-294"><a href="#cb194-294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-295"><a href="#cb194-295" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-296"><a href="#cb194-296" aria-hidden="true" tabindex="-1"></a>La variable <span class="in">`Her2`</span> muestra dos clases (<span class="in">`N`</span> y <span class="in">`P`</span>). La clase <span class="in">`N`</span> tiene una distribución mucho mayor de muestras en comparación con la clase <span class="in">`P`</span>. En la clase <span class="in">`N`</span>, hay una cantidad significativa de pacientes PCR-Positivos (<span class="in">`PCR=1`</span>), mientras que en la clase <span class="in">`P`</span>, los datos son escasos, lo que puede dificultar análisis concluyentes, es por esto que se ha decidido **eliminar la variable `Her2` de los conjuntos de datos**. </span>
<span id="cb194-297"><a href="#cb194-297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-300"><a href="#cb194-300" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb194-301"><a href="#cb194-301" aria-hidden="true" tabindex="-1"></a>data_numeric<span class="sc">$</span>Her2P <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb194-302"><a href="#cb194-302" aria-hidden="true" tabindex="-1"></a>data_factor<span class="sc">$</span>Her2 <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb194-303"><a href="#cb194-303" aria-hidden="true" tabindex="-1"></a>data_original<span class="sc">$</span>Her2 <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb194-304"><a href="#cb194-304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-305"><a href="#cb194-305" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(data_factor, <span class="at">file=</span><span class="st">"./data_factor.csv"</span>, <span class="at">row.names=</span><span class="cn">FALSE</span>)</span>
<span id="cb194-306"><a href="#cb194-306" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-307"><a href="#cb194-307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-308"><a href="#cb194-308" aria-hidden="true" tabindex="-1"></a><span class="fu">## Estadio</span></span>
<span id="cb194-309"><a href="#cb194-309" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-310"><a href="#cb194-310" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message=FALSE, warning=FALSE}</span></span>
<span id="cb194-311"><a href="#cb194-311" aria-hidden="true" tabindex="-1"></a><span class="in">plot_variable_distribution(data_factor, "Estadio", "PCR")</span></span>
<span id="cb194-312"><a href="#cb194-312" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-313"><a href="#cb194-313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-314"><a href="#cb194-314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-315"><a href="#cb194-315" aria-hidden="true" tabindex="-1"></a>La variable <span class="in">`Estadio`</span> presenta varias categorías (<span class="in">`T0-T1`</span>, <span class="in">`T2`</span>, <span class="in">`T3`</span>, <span class="in">`T4`</span>). La mayoría de las muestras se encuentran en la categoría <span class="in">`T2`</span>, seguida de <span class="in">`T3`</span>. Las categorías <span class="in">`T0-T1`</span> y <span class="in">`T4`</span> tienen menos muestras. En todas las categorías, los pacientes PCR-Negativos (<span class="in">`PCR=0`</span>) son mayoría, pero la proporción de PCR-Positivos (<span class="in">`PCR=1`</span>) varía entre las categorías, siendo notablemente menor en <span class="in">`T4`</span>.</span>
<span id="cb194-316"><a href="#cb194-316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-317"><a href="#cb194-317" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-318"><a href="#cb194-318" aria-hidden="true" tabindex="-1"></a><span class="fu">## NodAfec</span></span>
<span id="cb194-319"><a href="#cb194-319" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-320"><a href="#cb194-320" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message=FALSE, warning=FALSE}</span></span>
<span id="cb194-321"><a href="#cb194-321" aria-hidden="true" tabindex="-1"></a><span class="in">plot_variable_distribution(data_factor, "NodAfec", "PCR")</span></span>
<span id="cb194-322"><a href="#cb194-322" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-323"><a href="#cb194-323" aria-hidden="true" tabindex="-1"></a>La variable <span class="in">`NodAfec`</span> muestra varias categorías (<span class="in">`N0`</span>, <span class="in">`N1`</span>, <span class="in">`N2`</span>, <span class="in">`N3`</span>). La categoría <span class="in">`N1`</span> tiene la mayor cantidad de muestras, seguida de <span class="in">`N0`</span>, con <span class="in">`N2`</span> y <span class="in">`N3`</span> teniendo menos muestras. En todas las categorías, los pacientes PCR-Negativos (<span class="in">`PCR=0`</span>) son mayoría. La proporción de PCR-Positivos (<span class="in">`PCR=1`</span>) es relativamente constante en todas las categorías, aunque menor en comparación con los PCR-Negativos.</span>
<span id="cb194-324"><a href="#cb194-324" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-325"><a href="#cb194-325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-326"><a href="#cb194-326" aria-hidden="true" tabindex="-1"></a><span class="fu">## Grado</span></span>
<span id="cb194-327"><a href="#cb194-327" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-328"><a href="#cb194-328" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message=FALSE, warning=FALSE}</span></span>
<span id="cb194-329"><a href="#cb194-329" aria-hidden="true" tabindex="-1"></a><span class="in">plot_variable_distribution(data_factor, "Grado", "PCR")</span></span>
<span id="cb194-330"><a href="#cb194-330" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-331"><a href="#cb194-331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-332"><a href="#cb194-332" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-333"><a href="#cb194-333" aria-hidden="true" tabindex="-1"></a>La variable <span class="in">`Grado`</span> tiene tres niveles (<span class="in">`I`</span>, <span class="in">`II`</span>, <span class="in">`III`</span>). El nivel <span class="in">`III`</span> tiene la mayor cantidad de muestras, seguido por <span class="in">`II`</span>. El nivel <span class="in">`I`</span> tiene significativamente menos muestras. En los niveles <span class="in">`II`</span> y <span class="in">`III`</span>, hay una proporción considerable de pacientes PCR-Positivos (<span class="in">`PCR=1`</span>), especialmente en <span class="in">`III`</span>.</span>
<span id="cb194-334"><a href="#cb194-334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-335"><a href="#cb194-335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-336"><a href="#cb194-336" aria-hidden="true" tabindex="-1"></a><span class="fu">## Fenotipo</span></span>
<span id="cb194-337"><a href="#cb194-337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-338"><a href="#cb194-338" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message=FALSE, warning=FALSE}</span></span>
<span id="cb194-339"><a href="#cb194-339" aria-hidden="true" tabindex="-1"></a><span class="in">plot_variable_distribution(data_factor, "Fenotipo", "PCR")</span></span>
<span id="cb194-340"><a href="#cb194-340" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-341"><a href="#cb194-341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-342"><a href="#cb194-342" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-343"><a href="#cb194-343" aria-hidden="true" tabindex="-1"></a>La variable <span class="in">`Fenotipo`</span> tiene varias categorías (<span class="in">`Basal`</span>, <span class="in">`Her2`</span>, <span class="in">`LumA`</span>, <span class="in">`LumB`</span>, <span class="in">`Normal`</span>). La categoría <span class="in">`Basal`</span> tiene la mayor cantidad de muestras, seguida de <span class="in">`LumA`</span>. Las categorías <span class="in">`Her2`</span>, <span class="in">`LumB`</span> y <span class="in">`Normal`</span> tienen menos muestras. En <span class="in">`Basal`</span>, hay una proporción significativa de pacientes PCR-Positivos (<span class="in">`PCR=1`</span>), mientras que en las otras categorías, la proporción es menor.</span>
<span id="cb194-344"><a href="#cb194-344" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-345"><a href="#cb194-345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-346"><a href="#cb194-346" aria-hidden="true" tabindex="-1"></a><span class="fu">## PCR</span></span>
<span id="cb194-347"><a href="#cb194-347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-348"><a href="#cb194-348" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message=FALSE, warning=FALSE}</span></span>
<span id="cb194-349"><a href="#cb194-349" aria-hidden="true" tabindex="-1"></a><span class="in">plot_variable_distribution(data_factor, "PCR", "PCR")</span></span>
<span id="cb194-350"><a href="#cb194-350" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-351"><a href="#cb194-351" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-352"><a href="#cb194-352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-353"><a href="#cb194-353" aria-hidden="true" tabindex="-1"></a>La variable <span class="in">`PCR`</span> muestra la distribución de los pacientes en las dos clases (<span class="in">`0`</span> y <span class="in">`1`</span>). La mayoría de las muestras son PCR-Negativos (<span class="in">`PCR=0`</span>), con una menor proporción de PCR-Positivos (<span class="in">`PCR=1`</span>). Esta distribución sugiere un sesgo hacia los resultados negativos, lo cual se tendrá en cuenta en los análisis posteriores.</span>
<span id="cb194-354"><a href="#cb194-354" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb194-355"><a href="#cb194-355" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-356"><a href="#cb194-356" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-357"><a href="#cb194-357" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-358"><a href="#cb194-358" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-359"><a href="#cb194-359" aria-hidden="true" tabindex="-1"></a><span class="fu">## Métodos</span></span>
<span id="cb194-360"><a href="#cb194-360" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-361"><a href="#cb194-361" aria-hidden="true" tabindex="-1"></a>Todos los objetivos de este proyecto quedarían anulados si no se sigue una metodología estricta, basada en la *estimación honesta de parámetros* y la rigurosidad para la evaluación del rendimiento de los modelos mediante la selección de una métrica que sea capaz de cuantificar la capacidad predictiva del modelo *independientemente del umbral* seleccionado para clasificar las muestras -ya que este depende de las necesidades específicas del equipo sanitario. Esta sección sirve como guía para mostrar cuál ha sido esta metodología adoptada, y así demostrar su eficacia y seguridad.</span>
<span id="cb194-362"><a href="#cb194-362" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-363"><a href="#cb194-363" aria-hidden="true" tabindex="-1"></a><span class="fu">### AUC y Rendimiento Aparente</span></span>
<span id="cb194-364"><a href="#cb194-364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-365"><a href="#cb194-365" aria-hidden="true" tabindex="-1"></a>Para poder estimar el rendimiento cualitativo de un modelo, se necesita tanto una métrica cuantificable que refleje efectivamente su capacidad predictiva, como un valor base (*ground truth*) con el que comparar. En este estudio se ha decidido utilizar el **AUC (Area Under the Curve)**  como métrica representativa del rendimiento de un modelo, porque es una medida independiente del umbral utilizado para clasificar probabilidades calculadas por el modelo, esto es una característica decisiva, ya que, como se comentó anteriormente, el umbral podrá ser decidido por el clínico cuando el modelo sea puesto en producción, para que se ajuste a sus necesidades. Al utilizar el AUC como medida, podremos dar una estimación independiente del umbral a los clínicos, indicando que, elijan el umbral que elijan, el modelo rendirá de una manera preestablecida. </span>
<span id="cb194-366"><a href="#cb194-366" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-367"><a href="#cb194-367" aria-hidden="true" tabindex="-1"></a>Por otra parte, se ha apostado por tomar el rendimiento aparente del modelo como la métrica base de comparación para un mismo modelo. El rendimiento aparente se calcula mediante el entrenamiento y evaluación del modelo con todo el conjunto de datos, obteniendo una estimación optimista de la capacidad predictiva del modelo, al ser evaluado con los datos que fue entrenado. Una característica que debe quedar clara es la de que esta métrica solo servirá para comparar diferentes métodos de selección de variables, búsqueda de hiperparámetros, o ajuste fino, de un **mismo modelo**, no entre modelos. Para realizar una comparación entre modelos se hará uso de la estimación honesta de parámetros, es decir, la *doble validación cruzada 5x2*.</span>
<span id="cb194-368"><a href="#cb194-368" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-369"><a href="#cb194-369" aria-hidden="true" tabindex="-1"></a><span class="fu">### Ajuste Fino: Doble Validación Cruzada 5x2</span></span>
<span id="cb194-370"><a href="#cb194-370" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-371"><a href="#cb194-371" aria-hidden="true" tabindex="-1"></a><span class="al">![Doble Validación Cruzada](2CV.png)</span></span>
<span id="cb194-372"><a href="#cb194-372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-373"><a href="#cb194-373" aria-hidden="true" tabindex="-1"></a>El método de doble validación cruzada 5x2 es una técnica robusta para la evaluación de modelos que busca obtener una estimación honesta del rendimiento predictivo de un modelo. Este método se basa en una estructura jerárquica de validación cruzada, compuesta por dos niveles conocidos como *inner loop* y *outer loop*.</span>
<span id="cb194-374"><a href="#cb194-374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-375"><a href="#cb194-375" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Outer Loop</span></span>
<span id="cb194-376"><a href="#cb194-376" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-377"><a href="#cb194-377" aria-hidden="true" tabindex="-1"></a>El *outer loop* se encarga de la evaluación externa del modelo y se basa en la división del conjunto de datos original en 5 pliegues. En cada iteración, uno de estos pliegues se reserva como conjunto de test, mientras que los cuatro pliegues restantes se utilizan para el entrenamiento del modelo. Este proceso se repite cinco veces, de manera que cada pliegue se utiliza una vez como conjunto de test. Es crucial destacar que en el *outer loop* no se permite ajustar parámetros ni realizar selección de variables utilizando el conjunto de test, garantizando así una evaluación imparcial y honesta del modelo.</span>
<span id="cb194-378"><a href="#cb194-378" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-379"><a href="#cb194-379" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Inner Loop</span></span>
<span id="cb194-380"><a href="#cb194-380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-381"><a href="#cb194-381" aria-hidden="true" tabindex="-1"></a>Dentro de cada iteración del *outer loop*, se implementa el *inner loop*, cuyo objetivo es el ajuste fino de los hiperparámetros del modelo y la selección de las variables más relevantes. El *inner loop* utiliza una nueva división del conjunto de entrenamiento en pliegues adicionales. Generalmente, se opta por una validación cruzada más sencilla dentro de este bucle interno. Aquí, uno de los pliegues del conjunto de entrenamiento actúa como validación, mientras que los restantes se utilizan para el ajuste del modelo. Este proceso se repite varias veces para identificar la **combinación óptima de hiperparámetros y características que maximicen el rendimiento predictivo en el conjunto de validación**.</span>
<span id="cb194-382"><a href="#cb194-382" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-383"><a href="#cb194-383" aria-hidden="true" tabindex="-1"></a>Para cada modelo, **se han acotado los valores de los hiperparámetros qu                                                                                                 e formarán parte de la malla mediante pruebas con la doble validación cruzada y todas las variables**. Este enfoque ha decidido adoptarse para reducir la cantidad de hiperparámetros a probar durante el bucle interno con la finalidad de reducir el tiempo de cómputo del estudio.  </span>
<span id="cb194-384"><a href="#cb194-384" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-385"><a href="#cb194-385" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Evaluación Final</span></span>
<span id="cb194-386"><a href="#cb194-386" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-387"><a href="#cb194-387" aria-hidden="true" tabindex="-1"></a>Una vez completado el ajuste en el *inner loop*, se evalúa el modelo ajustado en el conjunto de test reservado en el *outer loop*. Este enfoque jerárquico asegura que el ajuste de los hiperparámetros y la selección de variables no influyan en la evaluación final del rendimiento del modelo. El rendimiento se cuantifica mediante métricas como el AUC (Área Bajo la Curva), proporcionando una estimación promedio del rendimiento del modelo a lo largo de las iteraciones del *outer loop*. Este método de doble validación cruzada 5x2 ofrece una estimación más confiable y menos optimista del rendimiento del modelo, adecuada para su implementación en escenarios clínicos donde la precisión es crucial.</span>
<span id="cb194-388"><a href="#cb194-388" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-389"><a href="#cb194-389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-390"><a href="#cb194-390" aria-hidden="true" tabindex="-1"></a><span class="fu">### Selección de Características</span></span>
<span id="cb194-391"><a href="#cb194-391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-392"><a href="#cb194-392" aria-hidden="true" tabindex="-1"></a>La selección de características es un paso fundamental en la construcción de modelos predictivos, ya que permite identificar las variables más relevantes para el problema en cuestión. Este proceso no solo mejora la *interpretabilidad del modelo*, cosa que permite a los investigadores y clínicos entender mejor qué variables están influyendo en las predicciones del modelo, sino que también reduce significativamente el tiempo computacional y el riesgo de sobreajuste, proporcionando un modelo más eficiente y robusto.</span>
<span id="cb194-393"><a href="#cb194-393" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-394"><a href="#cb194-394" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Metodología de Selección de Características</span></span>
<span id="cb194-395"><a href="#cb194-395" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-396"><a href="#cb194-396" aria-hidden="true" tabindex="-1"></a>En este estudio, se han realizado cuatro esquemas de selección de características por cada ciclo de doble validación cruzada 5x2 (2CV 5X2). Estos esquemas incluyen tanto métodos de filtrado, como métodos *wrapped*, y métodos *embedded*, proporcionando una perspectiva completa sobre las variables más relevantes.</span>
<span id="cb194-397"><a href="#cb194-397" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-398"><a href="#cb194-398" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>**Todas las Variables del Conjunto**: En este enfoque, se entrena el modelo utilizando todas las variables disponibles en el conjunto de datos, sin realizar ningún tipo de selección previa. Esto sirve como una línea base para comparar la efectividad de los métodos de selección de características.</span>
<span id="cb194-399"><a href="#cb194-399" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-400"><a href="#cb194-400" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>**Métodos de Filtrado: Análisis de Asociación**: Este método de filtrado se basa en el análisis de asociación, donde se evalúa la relación individual de cada variable con la variable objetivo. Se seleccionan aquellas variables que muestran una fuerte asociación, lo que permite reducir el conjunto de características antes del entrenamiento del modelo. Para poder realizar este análisis de asociación se inspeccionará el mapa de calor proporcionado por la función <span class="in">`plot_p_valores`</span>. Como se puede observar, las variables seleccionadas son <span class="in">`Estadio`</span>, <span class="in">`Fenotipo`</span>, <span class="in">`Grado`</span>, <span class="in">`REst`</span> y <span class="in">`RPro`</span>. Por lo que estas variables constituirán el vector de características <span class="in">`asociacion`</span>, usado para la ejecución de los métodos de filtrado en los modelos.  </span>
<span id="cb194-401"><a href="#cb194-401" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-404"><a href="#cb194-404" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb194-405"><a href="#cb194-405" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"./aux_scripts/calculaPValor.R"</span>)</span>
<span id="cb194-406"><a href="#cb194-406" aria-hidden="true" tabindex="-1"></a>plot <span class="ot">&lt;-</span> <span class="fu">plot_p_valores</span>(data_factor)</span>
<span id="cb194-407"><a href="#cb194-407" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(plot)</span>
<span id="cb194-408"><a href="#cb194-408" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-409"><a href="#cb194-409" aria-hidden="true" tabindex="-1"></a><span class="co"># Se construye el vector de variables factor y numéricas asociación a partir de los resultados del análisis</span></span>
<span id="cb194-410"><a href="#cb194-410" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-411"><a href="#cb194-411" aria-hidden="true" tabindex="-1"></a>todas_variables_factor <span class="ot">&lt;-</span> <span class="fu">colnames</span>(data_factor)[<span class="sc">!</span><span class="fu">colnames</span>(data_factor) <span class="sc">%in%</span> <span class="st">"PCR"</span>]</span>
<span id="cb194-412"><a href="#cb194-412" aria-hidden="true" tabindex="-1"></a>todas_variables_numeric <span class="ot">&lt;-</span> <span class="fu">colnames</span>(data_numeric)[<span class="sc">!</span><span class="fu">colnames</span>(data_numeric) <span class="sc">%in%</span> <span class="st">"PCR"</span>]</span>
<span id="cb194-413"><a href="#cb194-413" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-414"><a href="#cb194-414" aria-hidden="true" tabindex="-1"></a>select_associated_variables <span class="ot">&lt;-</span> <span class="cf">function</span>(asociacion, total_variables_numeric) {</span>
<span id="cb194-415"><a href="#cb194-415" aria-hidden="true" tabindex="-1"></a>  selected_variables <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb194-416"><a href="#cb194-416" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb194-417"><a href="#cb194-417" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (assoc <span class="cf">in</span> asociacion) {</span>
<span id="cb194-418"><a href="#cb194-418" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Buscar variables que contengan el nombre en asociacion</span></span>
<span id="cb194-419"><a href="#cb194-419" aria-hidden="true" tabindex="-1"></a>    matching_vars <span class="ot">&lt;-</span> total_variables_numeric[<span class="fu">grepl</span>(assoc, total_variables_numeric)]</span>
<span id="cb194-420"><a href="#cb194-420" aria-hidden="true" tabindex="-1"></a>    selected_variables <span class="ot">&lt;-</span> <span class="fu">c</span>(selected_variables, matching_vars)</span>
<span id="cb194-421"><a href="#cb194-421" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb194-422"><a href="#cb194-422" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb194-423"><a href="#cb194-423" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(selected_variables)</span>
<span id="cb194-424"><a href="#cb194-424" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb194-425"><a href="#cb194-425" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-426"><a href="#cb194-426" aria-hidden="true" tabindex="-1"></a>asociacion <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Estadio"</span>, <span class="st">"Fenotipo"</span>, <span class="st">"Grado"</span>, <span class="st">"REst"</span>, <span class="st">"RPro"</span>)</span>
<span id="cb194-427"><a href="#cb194-427" aria-hidden="true" tabindex="-1"></a>asociacion_numeric <span class="ot">&lt;-</span> <span class="fu">select_associated_variables</span>(asociacion, todas_variables_numeric)</span>
<span id="cb194-428"><a href="#cb194-428" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-429"><a href="#cb194-429" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-430"><a href="#cb194-430" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-431"><a href="#cb194-431" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>**Métodos Wrapped: StepAUC Backwards**: En este método, se comienza con todas las variables incluidas en el modelo. Durante el proceso de entrenamiento en el *inner loop*, se prueban eliminando variables una por una. **En profundidad**, para cada iteración del proceso, se construyen múltiples modelos predictivos con diferentes combinaciones de variables. El objetivo es identificar el subconjunto de variables que maximiza el rendimiento del modelo según el AUC. En el método wrapper *backwards*, se comienza con el conjunto completo de variables y se eliminan iterativamente variables que no aportan significativamente al rendimiento del modelo. En cada iteración, se construyen múltiples modelos predictivos con diferentes combinaciones de variables, evaluando el impacto de eliminar cada variable en el rendimiento del modelo. El proceso de eliminación de variables funciona de la siguiente manera:</span>
<span id="cb194-432"><a href="#cb194-432" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-433"><a href="#cb194-433" aria-hidden="true" tabindex="-1"></a><span class="ss">    1. </span>Inicialización: Se comienza con todas las variables disponibles en el conjunto de datos.</span>
<span id="cb194-434"><a href="#cb194-434" aria-hidden="true" tabindex="-1"></a><span class="ss">    2. </span>Iteración: Para cada variable en el conjunto actual de variables, se elimina una variable a la vez y se entrena un modelo con las variables restantes.</span>
<span id="cb194-435"><a href="#cb194-435" aria-hidden="true" tabindex="-1"></a><span class="ss">    3. </span>Evaluación: Se evalúa el rendimiento del modelo utilizando una métrica predefinida, como el AUC (Área Bajo la Curva ROC), a través de validación cruzada interna.</span>
<span id="cb194-436"><a href="#cb194-436" aria-hidden="true" tabindex="-1"></a><span class="ss">    4. </span>Comparación: Si la eliminación de una variable mejora el rendimiento del modelo (es decir, el AUC aumenta), esta variable se elimina permanentemente del conjunto de variables.</span>
<span id="cb194-437"><a href="#cb194-437" aria-hidden="true" tabindex="-1"></a><span class="ss">    5. </span>Repetición: Este proceso se repite iterativamente, eliminando una variable a la vez y evaluando el impacto en el rendimiento del modelo, hasta que ya no se observen mejoras significativas en la métrica de rendimiento.</span>
<span id="cb194-438"><a href="#cb194-438" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-439"><a href="#cb194-439" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>**Métodos de Embedded: Modelo Lasso**: El modelo Lasso es un método de regularización que no solo ajusta el modelo, sino que también selecciona automáticamente las variables más importantes. **En profundidad**, el algoritmo programado implementa un proceso de doble validación cruzada para la selección de hiperparámetros y variables en modelos predictivos. Durante la validación cruzada interna, se aplica la selección de variables mediante Lasso (*Least Absolute Shrinkage and Selection Operator*), que ayuda a identificar y eliminar variables menos relevantes, reduciendo así la dimensionalidad del modelo y mejorando potencialmente su rendimiento. Para cada combinación de hiperparámetros, Lasso selecciona un subconjunto óptimo de variables, y el modelo se entrena y evalúa con este subconjunto. Si una combinación particular de hiperparámetros y variables seleccionadas mejora la métrica de rendimiento (AUC), se guarda como la mejor configuración encontrada. Este proceso iterativo continúa hasta que no se encuentran mejoras adicionales. Finalmente, el mejor modelo y sus hiperparámetros seleccionados se evalúan en el conjunto de prueba reservado por el bucle externo, proporcionando una estimación robusta y honesta del rendimiento del modelo en datos no vistos.</span>
<span id="cb194-440"><a href="#cb194-440" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-441"><a href="#cb194-441" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-442"><a href="#cb194-442" aria-hidden="true" tabindex="-1"></a><span class="fu">### Modelos Aplicados</span></span>
<span id="cb194-443"><a href="#cb194-443" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-444"><a href="#cb194-444" aria-hidden="true" tabindex="-1"></a>Con el objetivo de conseguir un modelo ajustado para la predicción efectiva del estado PCR de un paciente en mente, se han seleccionado una serie de algoritmos de Aprendizaje Máquina (*Machine Learning*, ML) con varios parámetros de customización. Estos modelos se eligen por su capacidad de manejar diferentes tipos de datos y su rendimiento en tareas de clasificación, proporcionando así una evaluación completa y robusta para el problema en cuestión.</span>
<span id="cb194-445"><a href="#cb194-445" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-446"><a href="#cb194-446" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Naive Bayes</span></span>
<span id="cb194-447"><a href="#cb194-447" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-448"><a href="#cb194-448" aria-hidden="true" tabindex="-1"></a>Naive Bayes es un clasificador probabilístico basado en el teorema de Bayes, asumiendo una independencia condicional entre las características dadas la clase. En este estudio, se ha utilizado la implementación proporcionada en el paquete <span class="in">`e1071`</span>. Formalmente, el clasificador Naive Bayes asigna una clase $C_k$ a una instancia $x = (x_1, x_2, \ldots, x_n)$ maximizando la probabilidad posterior $P(C_k|x)$, que se calcula como:</span>
<span id="cb194-449"><a href="#cb194-449" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-450"><a href="#cb194-450" aria-hidden="true" tabindex="-1"></a>$$ P(C_k|x) = \frac{P(C_k) \cdot P(x|C_k)}{P(x)}$$</span>
<span id="cb194-451"><a href="#cb194-451" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-452"><a href="#cb194-452" aria-hidden="true" tabindex="-1"></a>Dado que $P(x)$ es constante para todas las clases, se simplifica a:</span>
<span id="cb194-453"><a href="#cb194-453" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-454"><a href="#cb194-454" aria-hidden="true" tabindex="-1"></a>$$ P(C_k|x) \propto P(C_k) \prod_{i=1}^{n} P(x_i|C_k) $$</span>
<span id="cb194-455"><a href="#cb194-455" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-456"><a href="#cb194-456" aria-hidden="true" tabindex="-1"></a>En resumen, el clasificador Naive Bayes es una opción eficiente y efectiva para problemas de clasificación, sin embargo, al **asumir la independencia de las probabilidades condicionales**, puede no dar resultados muy buenos, sin embargo, proporcionará una base sólida para predicciones iniciales, así como una base para la comparación entre modelos.</span>
<span id="cb194-457"><a href="#cb194-457" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-458"><a href="#cb194-458" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Adaboost</span></span>
<span id="cb194-459"><a href="#cb194-459" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-460"><a href="#cb194-460" aria-hidden="true" tabindex="-1"></a>Adaboost, o Adaptive Boosting, es un algoritmo de aprendizaje automático que combina múltiples clasificadores débiles para crear un clasificador fuerte. En este estudio, se ha utilizado el paquete <span class="in">`mboost`</span> de R con la configuración <span class="in">`family=Binomial()`</span>, adaptado para tareas de clasificación binaria. Adaboost trabaja iterativamente, ajustando los pesos de las muestras de entrenamiento para concentrarse en aquellas que fueron clasificadas incorrectamente en iteraciones anteriores.</span>
<span id="cb194-461"><a href="#cb194-461" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-462"><a href="#cb194-462" aria-hidden="true" tabindex="-1"></a>De esta forma, Adaboost asigna pesos a cada muestra y ajusta un clasificador débil $h_t(x)$ en cada iteración $t$. La salida final del clasificador se obtiene mediante una combinación ponderada de estos clasificadores débiles:</span>
<span id="cb194-463"><a href="#cb194-463" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-464"><a href="#cb194-464" aria-hidden="true" tabindex="-1"></a>$$ H(x) = \text{sign}\left( \sum_{t=1}^{T} \alpha_t h_t(x) \right) $$</span>
<span id="cb194-465"><a href="#cb194-465" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-466"><a href="#cb194-466" aria-hidden="true" tabindex="-1"></a>donde $\alpha_t$ es el peso asignado al clasificador $h_t(x)$ basado en su precisión. En cada iteración, el peso de las muestras mal clasificadas se incrementa, enfocando así el entrenamiento subsecuente en estas muestras.</span>
<span id="cb194-467"><a href="#cb194-467" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-468"><a href="#cb194-468" aria-hidden="true" tabindex="-1"></a>El principal hiperparámetro ajustado en este estudio ha sido el número de iteraciones $T$. Este parámetro determina cuántos clasificadores débiles se combinarán para formar el clasificador final. Aumentar el número de iteraciones puede mejorar la capacidad del modelo para corregir errores y, por ende, afinar la frontera de decisión, pero también aumenta el riesgo de sobreajuste si el modelo se vuelve demasiado complejo.</span>
<span id="cb194-469"><a href="#cb194-469" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-470"><a href="#cb194-470" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Árboles de Decisión</span></span>
<span id="cb194-471"><a href="#cb194-471" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-472"><a href="#cb194-472" aria-hidden="true" tabindex="-1"></a>Un árbol de decisión divide iterativamente el conjunto de datos en subconjuntos más pequeños utilizando una serie de reglas de decisión basadas en las características del conjunto de datos. Cada división se realiza en un nodo del árbol y produce ramas que representan los posibles valores de las características, conduciendo a hojas que representan las predicciones finales. El objetivo es crear un modelo que prediga el valor de la variable objetivo aprendiendo reglas de decisión simples inferidas de los datos. En este estudio, se ha implementado este algoritmo utilizando el paquete <span class="in">`rpart`</span> de R.</span>
<span id="cb194-473"><a href="#cb194-473" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-474"><a href="#cb194-474" aria-hidden="true" tabindex="-1"></a>Los principales hiperparámetros ajustados en este estudio han sido:</span>
<span id="cb194-475"><a href="#cb194-475" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-476"><a href="#cb194-476" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**`cp_values` (complexity parameter)**: Este parámetro controla la poda del árbol de decisión. La poda es un proceso que elimina ramas del árbol que tienen poca importancia, con el fin de reducir su complejidad y prevenir el sobreajuste. Un valor más alto de <span class="in">`cp`</span> resulta en una mayor poda, lo que produce un árbol más simple. Ajustar este parámetro afecta directamente la profundidad del árbol y su capacidad para capturar patrones en los datos. Seleccionar un <span class="in">`cp`</span> óptimo es esencial para equilibrar el sesgo (si <span class="in">`cp`</span> es muy alto) y la varianza (si <span class="in">`cp`</span> es muy bajo).</span>
<span id="cb194-477"><a href="#cb194-477" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-478"><a href="#cb194-478" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**`minsplit_values`**: Este parámetro define el número mínimo de observaciones que un nodo debe tener para ser considerado para una división. Valores más altos de <span class="in">`minsplit`</span> resultan en árboles más pequeños y menos detallados, ya que se requieren más observaciones para realizar una división. Por otro lado, valores más bajos permiten una mayor cantidad de divisiones, resultando en árboles más complejos. Ajustar <span class="in">`minsplit`</span> permite controlar la granularidad de las divisiones en el árbol, asegurando que el modelo capture los patrones relevantes sin sobreajustarse a los datos de entrenamiento.</span>
<span id="cb194-479"><a href="#cb194-479" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-480"><a href="#cb194-480" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Random Forest</span></span>
<span id="cb194-481"><a href="#cb194-481" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-482"><a href="#cb194-482" aria-hidden="true" tabindex="-1"></a>Random Forest opera creando una colección de árboles de decisión, cada uno entrenado con un subconjunto aleatorio del conjunto de datos y un subconjunto aleatorio de características. Este enfoque introduce dos tipos de aleatoriedad: aleatoriedad en las muestras y aleatoriedad en las características, lo que ayuda a reducir la varianza del modelo y mitigar el sobreajuste.En este estudio, se ha utilizado el paquete <span class="in">`randomForest`</span> de R.</span>
<span id="cb194-483"><a href="#cb194-483" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-484"><a href="#cb194-484" aria-hidden="true" tabindex="-1"></a>Los principales hiperparámetros ajustados en este estudio han sido:</span>
<span id="cb194-485"><a href="#cb194-485" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-486"><a href="#cb194-486" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**ntree_values**: Este parámetro define el número de árboles en el bosque. Un mayor número de árboles generalmente mejora la precisión del modelo, ya que la predicción final se basa en la agregación de un mayor número de árboles, reduciendo así la varianza. Sin embargo, un número muy alto de árboles puede aumentar el tiempo de entrenamiento sin proporcionar mejoras significativas en el rendimiento. Ajustar el valor de <span class="in">`ntree`</span> permite encontrar un equilibrio entre la precisión y la eficiencia computacional del modelo.</span>
<span id="cb194-487"><a href="#cb194-487" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-488"><a href="#cb194-488" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**mtry_values**: Este parámetro controla el número de características que se consideran para cada división en los árboles de decisión. Un valor más bajo de <span class="in">`mtry`</span> puede reducir el riesgo de sobreajuste, ya que introduce más variabilidad entre los árboles individuales. Un valor más alto permite que cada árbol considere más características en cada división, lo que puede mejorar la precisión del modelo si las características adicionales son informativas. Ajustar <span class="in">`mtry`</span> permite optimizar la capacidad del modelo para capturar las relaciones relevantes en los datos sin sobreajustarse.</span>
<span id="cb194-489"><a href="#cb194-489" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-490"><a href="#cb194-490" aria-hidden="true" tabindex="-1"></a>En resumen, Random Forest es un potente algoritmo de clasificación que combina las predicciones de múltiples árboles de decisión para mejorar la precisión y la robustez del modelo. La cuidadosa selección de los parámetros <span class="in">`ntree_values`</span> y <span class="in">`mtry_values`</span> asegura un modelo equilibrado que generaliza bien en nuevos datos, proporcionando predicciones fiables del estado PCR de los pacientes.</span>
<span id="cb194-491"><a href="#cb194-491" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-492"><a href="#cb194-492" aria-hidden="true" tabindex="-1"></a><span class="fu">#### K-Nearest Neighbours</span></span>
<span id="cb194-493"><a href="#cb194-493" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-494"><a href="#cb194-494" aria-hidden="true" tabindex="-1"></a>K-Nearest Neighbours (KNN) clasifica una muestra basada en las clases de sus $k$ vecinos más cercanos en el espacio de características. En este estudio, se ha utilizado el paquete <span class="in">`class`</span> de R para implementar KNN.</span>
<span id="cb194-495"><a href="#cb194-495" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-496"><a href="#cb194-496" aria-hidden="true" tabindex="-1"></a>KNN clasifica una muestra $x$ basándose en la mayoría de las clases de sus $k$ vecinos más cercanos, identificados utilizando una métrica de distancia. La distancia entre las muestras se calcula comúnmente usando la distancia euclidiana, pero se puede generalizar utilizando la distancia de Minkowski, definida como:</span>
<span id="cb194-497"><a href="#cb194-497" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-498"><a href="#cb194-498" aria-hidden="true" tabindex="-1"></a>$$ d(x_i, x_j) = \left( \sum_{m=1}^{M} |x_{im} - x_{jm}|^l \right)^{1/l} $$</span>
<span id="cb194-499"><a href="#cb194-499" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-500"><a href="#cb194-500" aria-hidden="true" tabindex="-1"></a>donde $l$ es el parámetro de distancia de Minkowski. Cuando $l = 2$, se corresponde con la distancia euclidiana, y cuando $l = 1$, se convierte en la distancia de Manhattan.</span>
<span id="cb194-501"><a href="#cb194-501" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-502"><a href="#cb194-502" aria-hidden="true" tabindex="-1"></a>Los principales hiperparámetros ajustados en este estudio son:</span>
<span id="cb194-503"><a href="#cb194-503" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-504"><a href="#cb194-504" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**$k$ (número de vecinos más cercanos)**: Este parámetro define el número de vecinos que se considerarán para determinar la clase de una nueva muestra. Valores pequeños de $k$ hacen que el modelo sea más sensible al ruido en los datos, mientras que valores grandes pueden hacer que el modelo sea demasiado general y pierda precisión en detalles locales. </span>
<span id="cb194-505"><a href="#cb194-505" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-506"><a href="#cb194-506" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**$l$ (parámetro de distancia de Minkowski)**: Este parámetro ajusta la métrica de distancia utilizada para identificar los vecinos más cercanos. Aunque el valor predeterminado es $l = 2$ (distancia euclidiana), ajustar $l$ permite al modelo adaptarse mejor a la geometría del espacio de características. Por ejemplo, un $l$ menor puede capturar mejor las relaciones lineales, mientras que un $l$ mayor puede ser más adecuado para relaciones más complejas y no lineales.</span>
<span id="cb194-507"><a href="#cb194-507" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-508"><a href="#cb194-508" aria-hidden="true" tabindex="-1"></a>Además, el parámetro <span class="in">`probes = TRUE`</span> se utiliza para devolver las probabilidades de las clases predichas, proporcionando una medida de confianza en las predicciones del modelo.</span>
<span id="cb194-509"><a href="#cb194-509" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-510"><a href="#cb194-510" aria-hidden="true" tabindex="-1"></a>En resumen, KNN es un algoritmo intuitivo y efectivo para la clasificación, especialmente adecuado para conjuntos de datos donde la estructura local de las muestras es crucial para la precisión de las predicciones. Ajustar los parámetros $k$ y $l$ permite optimizar el modelo para capturar las relaciones subyacentes en los datos, asegurando predicciones precisas y confiables del estado PCR de los pacientes. </span>
<span id="cb194-511"><a href="#cb194-511" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-512"><a href="#cb194-512" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-513"><a href="#cb194-513" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Support Vector Machine</span></span>
<span id="cb194-514"><a href="#cb194-514" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-515"><a href="#cb194-515" aria-hidden="true" tabindex="-1"></a>La Máquina de Vectores de Soporte, o, Support Vector Machine (SVM) es una técnica de clasificación que busca encontrar el hiperplano que mejor separa las clases en el espacio de características. En este estudio, se ha utilizado el paquete <span class="in">`e1071`</span> de R para implementar SVM.</span>
<span id="cb194-516"><a href="#cb194-516" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-517"><a href="#cb194-517" aria-hidden="true" tabindex="-1"></a>SVM funciona proyectando los datos a un espacio de mayor dimensión donde se puede encontrar un hiperplano que maximiza el margen de separación entre las clases. El hiperplano se define por:</span>
<span id="cb194-518"><a href="#cb194-518" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-519"><a href="#cb194-519" aria-hidden="true" tabindex="-1"></a>$$ \mathbf{w} \cdot \mathbf{x} + b = 0 $$</span>
<span id="cb194-520"><a href="#cb194-520" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-521"><a href="#cb194-521" aria-hidden="true" tabindex="-1"></a>donde $\mathbf{w}$ es el vector de pesos y $b$ es el sesgo. El objetivo es encontrar $\mathbf{w}$ y $b$ que maximicen el margen, sujetando a las restricciones de clasificación correcta de las muestras. Formalmente, los principales hiperparámetros ajustados en este estudio han sido:</span>
<span id="cb194-522"><a href="#cb194-522" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-523"><a href="#cb194-523" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Kernel**: Este parámetro define la función de transformación que se utiliza para proyectar los datos en un espacio de mayor dimensión. Los kernels disponibles incluyen:</span>
<span id="cb194-524"><a href="#cb194-524" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-525"><a href="#cb194-525" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>**Lineal**: $K(\mathbf{x_i}, \mathbf{x_j}) = \mathbf{x_i} \cdot \mathbf{x_j}$</span>
<span id="cb194-526"><a href="#cb194-526" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>**Sigmoid**: $K(\mathbf{x_i}, \mathbf{x_j}) = \tanh(\alpha \mathbf{x_i} \cdot \mathbf{x_j} + r)$</span>
<span id="cb194-527"><a href="#cb194-527" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>**Polinomial**: $K(\mathbf{x_i}, \mathbf{x_j}) = (\alpha \mathbf{x_i} \cdot \mathbf{x_j} + r)^d$</span>
<span id="cb194-528"><a href="#cb194-528" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>**RBF (Radial Basis Function)**: $K(\mathbf{x_i}, \mathbf{x_j}) = \exp(-\gamma ||\mathbf{x_i} - \mathbf{x_j}||^2)$</span>
<span id="cb194-529"><a href="#cb194-529" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-530"><a href="#cb194-530" aria-hidden="true" tabindex="-1"></a>  La elección del kernel afecta directamente la capacidad del SVM para capturar relaciones no lineales en los datos. Por ejemplo, un kernel lineal es adecuado para datos linealmente separables, mientras que un kernel RBF es más flexible y puede modelar relaciones complejas.</span>
<span id="cb194-531"><a href="#cb194-531" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-532"><a href="#cb194-532" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Coste (C)**: Este parámetro controla el margen de tolerancia a errores en la clasificación. Un valor alto de $C$ da como resultado un margen más estrecho y menos tolerancia a errores de clasificación, lo que puede llevar a un modelo que sobreajuste los datos de entrenamiento. Por otro lado, un valor bajo de $C$ permite un margen más amplio y más errores de clasificación, lo que puede resultar en un modelo más general. </span>
<span id="cb194-533"><a href="#cb194-533" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-534"><a href="#cb194-534" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-535"><a href="#cb194-535" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Artificial Neural Networks</span></span>
<span id="cb194-536"><a href="#cb194-536" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-537"><a href="#cb194-537" aria-hidden="true" tabindex="-1"></a>Las Redes Neuronales Artificiales (ANN) son modelos de aprendizaje automático inspirados en la estructura y funcionamiento del cerebro humano. En este estudio, se ha utilizado la función <span class="in">`nnet`</span> del paquete <span class="in">`nnet`</span> de R para implementar un modelo de red neuronal artificial.</span>
<span id="cb194-538"><a href="#cb194-538" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-539"><a href="#cb194-539" aria-hidden="true" tabindex="-1"></a>Las redes neuronales consisten en una capa de entrada, una o más capas ocultas, y una capa de salida. Cada neurona en estas capas realiza una operación lineal seguida de una función de activación no lineal. En este estudio, la arquitectura del modelo se definirá principalmente por el número de neuronas en la capa oculta (<span class="in">`size`</span>) y el método de regularización (<span class="in">`weight-decay`</span>).</span>
<span id="cb194-540"><a href="#cb194-540" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-541"><a href="#cb194-541" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Tamaño de la Capa Oculta (`size`)**: Este parámetro especifica el número de neuronas en la capa oculta de la red neuronal. Un mayor número de neuronas (<span class="in">`size`</span>) puede capturar patrones más complejos en los datos, pero también aumenta el riesgo de sobreajuste si el modelo se vuelve demasiado complejo. </span>
<span id="cb194-542"><a href="#cb194-542" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-543"><a href="#cb194-543" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Parámetro de Regularización (`decay`)**: El parámetro <span class="in">`weight-decay`</span> controla la magnitud de la penalización aplicada a los pesos del modelo durante el entrenamiento para prevenir el sobreajuste. Este método de regularización agrega un término a la función de pérdida que penaliza grandes valores de los pesos, manteniendo los pesos más pequeños y el modelo más sencillo. Ajustar el <span class="in">`decay`</span> afecta la capacidad del modelo para generalizar, ya que valores muy altos pueden resultar en un modelo subajustado, mientras que valores muy bajos pueden no ser suficientes para evitar el sobreajuste.</span>
<span id="cb194-544"><a href="#cb194-544" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-545"><a href="#cb194-545" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-546"><a href="#cb194-546" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-547"><a href="#cb194-547" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-548"><a href="#cb194-548" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-549"><a href="#cb194-549" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-550"><a href="#cb194-550" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-551"><a href="#cb194-551" aria-hidden="true" tabindex="-1"></a><span class="fu"># Resultados</span></span>
<span id="cb194-552"><a href="#cb194-552" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-553"><a href="#cb194-553" aria-hidden="true" tabindex="-1"></a><span class="fu">## Naive Bayes</span></span>
<span id="cb194-554"><a href="#cb194-554" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-555"><a href="#cb194-555" aria-hidden="true" tabindex="-1"></a><span class="fu">### Aparente</span></span>
<span id="cb194-556"><a href="#cb194-556" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-557"><a href="#cb194-557" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=FALSE}</span></span>
<span id="cb194-558"><a href="#cb194-558" aria-hidden="true" tabindex="-1"></a><span class="in">evaluate_aparent_performance_model_naiveBayes &lt;- function(data, target_var, model_func, vars = NULL, threshold, seed) {</span></span>
<span id="cb194-559"><a href="#cb194-559" aria-hidden="true" tabindex="-1"></a><span class="in">  if (is.null(vars)) {</span></span>
<span id="cb194-560"><a href="#cb194-560" aria-hidden="true" tabindex="-1"></a><span class="in">    vars &lt;- setdiff(names(data), target_var)</span></span>
<span id="cb194-561"><a href="#cb194-561" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb194-562"><a href="#cb194-562" aria-hidden="true" tabindex="-1"></a><span class="in">  set.seed(seed = seed)</span></span>
<span id="cb194-563"><a href="#cb194-563" aria-hidden="true" tabindex="-1"></a><span class="in">  data[[target_var]] &lt;- factor(data[[target_var]], levels = c(0, 1))</span></span>
<span id="cb194-564"><a href="#cb194-564" aria-hidden="true" tabindex="-1"></a><span class="in">  formula &lt;- as.formula(paste(target_var, "~", paste(vars, collapse = "+")))</span></span>
<span id="cb194-565"><a href="#cb194-565" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb194-566"><a href="#cb194-566" aria-hidden="true" tabindex="-1"></a><span class="in">  model &lt;- model_func(formula, data)</span></span>
<span id="cb194-567"><a href="#cb194-567" aria-hidden="true" tabindex="-1"></a><span class="in">  predictions &lt;- predict(model, newdata = data, type = "raw")[, 2]</span></span>
<span id="cb194-568"><a href="#cb194-568" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb194-569"><a href="#cb194-569" aria-hidden="true" tabindex="-1"></a><span class="in">  actual_classes &lt;- data[[target_var]]</span></span>
<span id="cb194-570"><a href="#cb194-570" aria-hidden="true" tabindex="-1"></a><span class="in">  predicted_classes &lt;- ifelse(predictions &gt; threshold, 1, 0)</span></span>
<span id="cb194-571"><a href="#cb194-571" aria-hidden="true" tabindex="-1"></a><span class="in">  confusion_matrix &lt;- table(predicted_classes, actual_classes)</span></span>
<span id="cb194-572"><a href="#cb194-572" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb194-573"><a href="#cb194-573" aria-hidden="true" tabindex="-1"></a><span class="in">  tp &lt;- ifelse("1" %in% rownames(confusion_matrix) &amp;&amp; "1" %in% colnames(confusion_matrix), confusion_matrix["1", "1"], 0)</span></span>
<span id="cb194-574"><a href="#cb194-574" aria-hidden="true" tabindex="-1"></a><span class="in">  tn &lt;- ifelse("0" %in% rownames(confusion_matrix) &amp;&amp; "0" %in% colnames(confusion_matrix), confusion_matrix["0", "0"], 0)</span></span>
<span id="cb194-575"><a href="#cb194-575" aria-hidden="true" tabindex="-1"></a><span class="in">  fp &lt;- ifelse("1" %in% rownames(confusion_matrix) &amp;&amp; "0" %in% colnames(confusion_matrix), confusion_matrix["1", "0"], 0)</span></span>
<span id="cb194-576"><a href="#cb194-576" aria-hidden="true" tabindex="-1"></a><span class="in">  fn &lt;- ifelse("0" %in% rownames(confusion_matrix) &amp;&amp; "1" %in% colnames(confusion_matrix), confusion_matrix["0", "1"], 0)</span></span>
<span id="cb194-577"><a href="#cb194-577" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb194-578"><a href="#cb194-578" aria-hidden="true" tabindex="-1"></a><span class="in">  accuracy &lt;- (tp + tn) / (tp + tn + fp + fn)</span></span>
<span id="cb194-579"><a href="#cb194-579" aria-hidden="true" tabindex="-1"></a><span class="in">  precision &lt;- ifelse(tp + fp &gt; 0, tp / (tp + fp), 0)</span></span>
<span id="cb194-580"><a href="#cb194-580" aria-hidden="true" tabindex="-1"></a><span class="in">  recall &lt;- ifelse(tp + fn &gt; 0, tp / (tp + fn), 0)</span></span>
<span id="cb194-581"><a href="#cb194-581" aria-hidden="true" tabindex="-1"></a><span class="in">  f1_score &lt;- ifelse(precision + recall &gt; 0, 2 * (precision * recall) / (precision + recall), 0)</span></span>
<span id="cb194-582"><a href="#cb194-582" aria-hidden="true" tabindex="-1"></a><span class="in">  roc_obj &lt;- pROC::roc(actual_classes, predictions)</span></span>
<span id="cb194-583"><a href="#cb194-583" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb194-584"><a href="#cb194-584" aria-hidden="true" tabindex="-1"></a><span class="in">  list(confusion_matrix = confusion_matrix, accuracy = accuracy, precision = precision, </span></span>
<span id="cb194-585"><a href="#cb194-585" aria-hidden="true" tabindex="-1"></a><span class="in">       recall = recall, f1_score = f1_score, roc_curve = roc_obj)</span></span>
<span id="cb194-586"><a href="#cb194-586" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb194-587"><a href="#cb194-587" aria-hidden="true" tabindex="-1"></a><span class="in">naiveBayes_model &lt;- function(formula, data) {</span></span>
<span id="cb194-588"><a href="#cb194-588" aria-hidden="true" tabindex="-1"></a><span class="in">  naiveBayes(formula = formula, data = data)</span></span>
<span id="cb194-589"><a href="#cb194-589" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb194-590"><a href="#cb194-590" aria-hidden="true" tabindex="-1"></a><span class="in">resultadosAparentesNaiveBayes &lt;- evaluate_aparent_performance_model_naiveBayes(data = data_factor, </span></span>
<span id="cb194-591"><a href="#cb194-591" aria-hidden="true" tabindex="-1"></a><span class="in">                                                                               target_var = "PCR",</span></span>
<span id="cb194-592"><a href="#cb194-592" aria-hidden="true" tabindex="-1"></a><span class="in">                                                                              model_func = naiveBayes_model,</span></span>
<span id="cb194-593"><a href="#cb194-593" aria-hidden="true" tabindex="-1"></a><span class="in">                                                                              vars = ".",</span></span>
<span id="cb194-594"><a href="#cb194-594" aria-hidden="true" tabindex="-1"></a><span class="in">                                                                              threshold = .35,</span></span>
<span id="cb194-595"><a href="#cb194-595" aria-hidden="true" tabindex="-1"></a><span class="in">                                                                              seed = 90)</span></span>
<span id="cb194-596"><a href="#cb194-596" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-597"><a href="#cb194-597" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-598"><a href="#cb194-598" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message=FALSE, warning=FALSE}</span></span>
<span id="cb194-599"><a href="#cb194-599" aria-hidden="true" tabindex="-1"></a><span class="in">load("RData_Files_Algorithms/NaiveBayes_Aparente.RData")</span></span>
<span id="cb194-600"><a href="#cb194-600" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-601"><a href="#cb194-601" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-602"><a href="#cb194-602" aria-hidden="true" tabindex="-1"></a><span class="fu">### Todas las Variables</span></span>
<span id="cb194-603"><a href="#cb194-603" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-604"><a href="#cb194-604" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=FALSE}</span></span>
<span id="cb194-605"><a href="#cb194-605" aria-hidden="true" tabindex="-1"></a><span class="in">double_cross_validation_naiveBayes &lt;- function(data, target_name, outer, inner, variables, threshold, seed) {</span></span>
<span id="cb194-606"><a href="#cb194-606" aria-hidden="true" tabindex="-1"></a><span class="in">  set.seed(seed)</span></span>
<span id="cb194-607"><a href="#cb194-607" aria-hidden="true" tabindex="-1"></a><span class="in">  performance_metrics &lt;- data.frame(Fold = integer(), TP = integer(), TN = integer(),</span></span>
<span id="cb194-608"><a href="#cb194-608" aria-hidden="true" tabindex="-1"></a><span class="in">                                    FP = integer(), FN = integer(), AUC = numeric(), stringsAsFactors = FALSE)</span></span>
<span id="cb194-609"><a href="#cb194-609" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb194-610"><a href="#cb194-610" aria-hidden="true" tabindex="-1"></a><span class="in">  data[[target_name]] &lt;- as.factor(data[[target_name]])</span></span>
<span id="cb194-611"><a href="#cb194-611" aria-hidden="true" tabindex="-1"></a><span class="in">  outer_folds &lt;- createFolds(data[[target_name]], k = outer, list = TRUE, returnTrain = FALSE)</span></span>
<span id="cb194-612"><a href="#cb194-612" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb194-613"><a href="#cb194-613" aria-hidden="true" tabindex="-1"></a><span class="in">  for (outer_index in seq_along(outer_folds)) {</span></span>
<span id="cb194-614"><a href="#cb194-614" aria-hidden="true" tabindex="-1"></a><span class="in">    outer_train_data &lt;- data[-outer_folds[[outer_index]], ]</span></span>
<span id="cb194-615"><a href="#cb194-615" aria-hidden="true" tabindex="-1"></a><span class="in">    outer_test_data &lt;- data[outer_folds[[outer_index]], ]</span></span>
<span id="cb194-616"><a href="#cb194-616" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-617"><a href="#cb194-617" aria-hidden="true" tabindex="-1"></a><span class="in">    cat(sprintf("Outer Fold %d\n", outer_index))</span></span>
<span id="cb194-618"><a href="#cb194-618" aria-hidden="true" tabindex="-1"></a><span class="in">    cat("Training Data - Class 0: ", sum(outer_train_data[[target_name]] == "0"), "\n")</span></span>
<span id="cb194-619"><a href="#cb194-619" aria-hidden="true" tabindex="-1"></a><span class="in">    cat("Training Data - Class 1: ", sum(outer_train_data[[target_name]] == "1"), "\n")</span></span>
<span id="cb194-620"><a href="#cb194-620" aria-hidden="true" tabindex="-1"></a><span class="in">    cat("Testing Data - Class 0: ", sum(outer_test_data[[target_name]] == "0"), "\n")</span></span>
<span id="cb194-621"><a href="#cb194-621" aria-hidden="true" tabindex="-1"></a><span class="in">    cat("Testing Data - Class 1: ", sum(outer_test_data[[target_name]] == "1"), "\n")</span></span>
<span id="cb194-622"><a href="#cb194-622" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-623"><a href="#cb194-623" aria-hidden="true" tabindex="-1"></a><span class="in">    if (sum(outer_train_data[[target_name]] == "0") == 0 || sum(outer_train_data[[target_name]] == "1") == 0) {</span></span>
<span id="cb194-624"><a href="#cb194-624" aria-hidden="true" tabindex="-1"></a><span class="in">      cat("Skipping outer fold due to lack of class diversity\n")</span></span>
<span id="cb194-625"><a href="#cb194-625" aria-hidden="true" tabindex="-1"></a><span class="in">      next</span></span>
<span id="cb194-626"><a href="#cb194-626" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb194-627"><a href="#cb194-627" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-628"><a href="#cb194-628" aria-hidden="true" tabindex="-1"></a><span class="in">    inner_folds &lt;- createFolds(outer_train_data[[target_name]], k = inner, list = TRUE, returnTrain = FALSE)</span></span>
<span id="cb194-629"><a href="#cb194-629" aria-hidden="true" tabindex="-1"></a><span class="in">    best_model &lt;- NULL</span></span>
<span id="cb194-630"><a href="#cb194-630" aria-hidden="true" tabindex="-1"></a><span class="in">    best_auc &lt;- 0</span></span>
<span id="cb194-631"><a href="#cb194-631" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-632"><a href="#cb194-632" aria-hidden="true" tabindex="-1"></a><span class="in">    formula &lt;- reformulate(variables, target_name)</span></span>
<span id="cb194-633"><a href="#cb194-633" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-634"><a href="#cb194-634" aria-hidden="true" tabindex="-1"></a><span class="in">    for (inner_index in seq_along(inner_folds)) {</span></span>
<span id="cb194-635"><a href="#cb194-635" aria-hidden="true" tabindex="-1"></a><span class="in">      inner_train_data &lt;- outer_train_data[-inner_folds[[inner_index]], ]</span></span>
<span id="cb194-636"><a href="#cb194-636" aria-hidden="true" tabindex="-1"></a><span class="in">      inner_test_data &lt;- outer_train_data[inner_folds[[inner_index]], ]</span></span>
<span id="cb194-637"><a href="#cb194-637" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-638"><a href="#cb194-638" aria-hidden="true" tabindex="-1"></a><span class="in">      if (sum(inner_train_data[[target_name]] == "0") == 0 || sum(inner_train_data[[target_name]] == "1") == 0) {</span></span>
<span id="cb194-639"><a href="#cb194-639" aria-hidden="true" tabindex="-1"></a><span class="in">        cat("Skipping inner fold due to lack of class diversity\n")</span></span>
<span id="cb194-640"><a href="#cb194-640" aria-hidden="true" tabindex="-1"></a><span class="in">        next</span></span>
<span id="cb194-641"><a href="#cb194-641" aria-hidden="true" tabindex="-1"></a><span class="in">      }</span></span>
<span id="cb194-642"><a href="#cb194-642" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-643"><a href="#cb194-643" aria-hidden="true" tabindex="-1"></a><span class="in">      inner_auc &lt;- numeric()</span></span>
<span id="cb194-644"><a href="#cb194-644" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-645"><a href="#cb194-645" aria-hidden="true" tabindex="-1"></a><span class="in">      result &lt;- tryCatch({</span></span>
<span id="cb194-646"><a href="#cb194-646" aria-hidden="true" tabindex="-1"></a><span class="in">        model &lt;- naiveBayes(formula, data = inner_train_data)</span></span>
<span id="cb194-647"><a href="#cb194-647" aria-hidden="true" tabindex="-1"></a><span class="in">        predictions &lt;- predict(model, inner_test_data, type = "raw")[, 2]</span></span>
<span id="cb194-648"><a href="#cb194-648" aria-hidden="true" tabindex="-1"></a><span class="in">        roc_curve &lt;- roc(inner_test_data[[target_name]], predictions)</span></span>
<span id="cb194-649"><a href="#cb194-649" aria-hidden="true" tabindex="-1"></a><span class="in">        inner_auc[inner_index] &lt;- roc_curve$auc</span></span>
<span id="cb194-650"><a href="#cb194-650" aria-hidden="true" tabindex="-1"></a><span class="in">      }, error = function(e) {</span></span>
<span id="cb194-651"><a href="#cb194-651" aria-hidden="true" tabindex="-1"></a><span class="in">        cat("Error in inner fold ", inner_index, "\n")</span></span>
<span id="cb194-652"><a href="#cb194-652" aria-hidden="true" tabindex="-1"></a><span class="in">        cat("Error message: ", e$message, "\n")</span></span>
<span id="cb194-653"><a href="#cb194-653" aria-hidden="true" tabindex="-1"></a><span class="in">        inner_auc[inner_index] &lt;- 0</span></span>
<span id="cb194-654"><a href="#cb194-654" aria-hidden="true" tabindex="-1"></a><span class="in">      })</span></span>
<span id="cb194-655"><a href="#cb194-655" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-656"><a href="#cb194-656" aria-hidden="true" tabindex="-1"></a><span class="in">      if (mean(inner_auc, na.rm = TRUE) &gt; best_auc) {</span></span>
<span id="cb194-657"><a href="#cb194-657" aria-hidden="true" tabindex="-1"></a><span class="in">        best_auc &lt;- mean(inner_auc, na.rm = TRUE)</span></span>
<span id="cb194-658"><a href="#cb194-658" aria-hidden="true" tabindex="-1"></a><span class="in">        best_model &lt;- model</span></span>
<span id="cb194-659"><a href="#cb194-659" aria-hidden="true" tabindex="-1"></a><span class="in">      }</span></span>
<span id="cb194-660"><a href="#cb194-660" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb194-661"><a href="#cb194-661" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-662"><a href="#cb194-662" aria-hidden="true" tabindex="-1"></a><span class="in">    if (is.null(best_model)) {</span></span>
<span id="cb194-663"><a href="#cb194-663" aria-hidden="true" tabindex="-1"></a><span class="in">      cat("No valid model found for outer fold ", outer_index, "\n")</span></span>
<span id="cb194-664"><a href="#cb194-664" aria-hidden="true" tabindex="-1"></a><span class="in">      next</span></span>
<span id="cb194-665"><a href="#cb194-665" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb194-666"><a href="#cb194-666" aria-hidden="true" tabindex="-1"></a><span class="in">    best_model &lt;- naiveBayes(formula, data = outer_train_data)</span></span>
<span id="cb194-667"><a href="#cb194-667" aria-hidden="true" tabindex="-1"></a><span class="in">    predictions &lt;- predict(best_model, outer_test_data, type = "raw")[, 2]</span></span>
<span id="cb194-668"><a href="#cb194-668" aria-hidden="true" tabindex="-1"></a><span class="in">    pred_class &lt;- ifelse(predictions &gt; threshold, "1", "0")</span></span>
<span id="cb194-669"><a href="#cb194-669" aria-hidden="true" tabindex="-1"></a><span class="in">    confusion &lt;- table(Actual = outer_test_data[[target_name]], Predicted = pred_class)</span></span>
<span id="cb194-670"><a href="#cb194-670" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-671"><a href="#cb194-671" aria-hidden="true" tabindex="-1"></a><span class="in">    if (nrow(confusion) &lt; 2 || ncol(confusion) &lt; 2) {</span></span>
<span id="cb194-672"><a href="#cb194-672" aria-hidden="true" tabindex="-1"></a><span class="in">      TP &lt;- ifelse(nrow(confusion) &gt;= 2 &amp;&amp; ncol(confusion) &gt;= 2, confusion[2, 2], 0)</span></span>
<span id="cb194-673"><a href="#cb194-673" aria-hidden="true" tabindex="-1"></a><span class="in">      TN &lt;- ifelse(nrow(confusion) &gt;= 1 &amp;&amp; ncol(confusion) &gt;= 1, confusion[1, 1], 0)</span></span>
<span id="cb194-674"><a href="#cb194-674" aria-hidden="true" tabindex="-1"></a><span class="in">      FP &lt;- ifelse(nrow(confusion) &gt;= 1 &amp;&amp; ncol(confusion) &gt;= 2, confusion[1, 2], 0)</span></span>
<span id="cb194-675"><a href="#cb194-675" aria-hidden="true" tabindex="-1"></a><span class="in">      FN &lt;- ifelse(nrow(confusion) &gt;= 2 &amp;&amp; ncol(confusion) &gt;= 1, confusion[2, 1], 0)</span></span>
<span id="cb194-676"><a href="#cb194-676" aria-hidden="true" tabindex="-1"></a><span class="in">    } else {</span></span>
<span id="cb194-677"><a href="#cb194-677" aria-hidden="true" tabindex="-1"></a><span class="in">      TP &lt;- confusion[2, 2]</span></span>
<span id="cb194-678"><a href="#cb194-678" aria-hidden="true" tabindex="-1"></a><span class="in">      TN &lt;- confusion[1, 1]</span></span>
<span id="cb194-679"><a href="#cb194-679" aria-hidden="true" tabindex="-1"></a><span class="in">      FP &lt;- confusion[1, 2]</span></span>
<span id="cb194-680"><a href="#cb194-680" aria-hidden="true" tabindex="-1"></a><span class="in">      FN &lt;- confusion[2, 1]</span></span>
<span id="cb194-681"><a href="#cb194-681" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb194-682"><a href="#cb194-682" aria-hidden="true" tabindex="-1"></a><span class="in">    auc &lt;- roc(outer_test_data[[target_name]], predictions)$auc</span></span>
<span id="cb194-683"><a href="#cb194-683" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-684"><a href="#cb194-684" aria-hidden="true" tabindex="-1"></a><span class="in">    metrics &lt;- setNames(c(outer_index, TP, TN, FP, FN, auc), names(performance_metrics))</span></span>
<span id="cb194-685"><a href="#cb194-685" aria-hidden="true" tabindex="-1"></a><span class="in">    performance_metrics &lt;- rbind(performance_metrics, as.data.frame(t(metrics)))</span></span>
<span id="cb194-686"><a href="#cb194-686" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb194-687"><a href="#cb194-687" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-688"><a href="#cb194-688" aria-hidden="true" tabindex="-1"></a><span class="in">  return(performance_metrics)</span></span>
<span id="cb194-689"><a href="#cb194-689" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb194-690"><a href="#cb194-690" aria-hidden="true" tabindex="-1"></a><span class="in">evaluate_with_seeds_NaiveBayes_Asociacion_Todas &lt;- </span></span>
<span id="cb194-691"><a href="#cb194-691" aria-hidden="true" tabindex="-1"></a><span class="in">  function(evaluation_function, data, target_var, vars, threshold, seeds, outer, inner) {</span></span>
<span id="cb194-692"><a href="#cb194-692" aria-hidden="true" tabindex="-1"></a><span class="in">  results_list &lt;- list()</span></span>
<span id="cb194-693"><a href="#cb194-693" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-694"><a href="#cb194-694" aria-hidden="true" tabindex="-1"></a><span class="in">  for (seed in seeds) {</span></span>
<span id="cb194-695"><a href="#cb194-695" aria-hidden="true" tabindex="-1"></a><span class="in">    set.seed(seed)</span></span>
<span id="cb194-696"><a href="#cb194-696" aria-hidden="true" tabindex="-1"></a><span class="in">    cat("Evaluating with seed:", seed, "\n")</span></span>
<span id="cb194-697"><a href="#cb194-697" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-698"><a href="#cb194-698" aria-hidden="true" tabindex="-1"></a><span class="in">    results &lt;- evaluation_function(data = data, </span></span>
<span id="cb194-699"><a href="#cb194-699" aria-hidden="true" tabindex="-1"></a><span class="in">                                   target_name = target_var, </span></span>
<span id="cb194-700"><a href="#cb194-700" aria-hidden="true" tabindex="-1"></a><span class="in">                                   variables = vars, </span></span>
<span id="cb194-701"><a href="#cb194-701" aria-hidden="true" tabindex="-1"></a><span class="in">                                   threshold = threshold, </span></span>
<span id="cb194-702"><a href="#cb194-702" aria-hidden="true" tabindex="-1"></a><span class="in">                                   outer = outer, </span></span>
<span id="cb194-703"><a href="#cb194-703" aria-hidden="true" tabindex="-1"></a><span class="in">                                   inner = inner, </span></span>
<span id="cb194-704"><a href="#cb194-704" aria-hidden="true" tabindex="-1"></a><span class="in">                                   seed = seed)</span></span>
<span id="cb194-705"><a href="#cb194-705" aria-hidden="true" tabindex="-1"></a><span class="in">    results_list[[paste0("seed_", seed)]] &lt;- results</span></span>
<span id="cb194-706"><a href="#cb194-706" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb194-707"><a href="#cb194-707" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-708"><a href="#cb194-708" aria-hidden="true" tabindex="-1"></a><span class="in">  return(results_list)</span></span>
<span id="cb194-709"><a href="#cb194-709" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb194-710"><a href="#cb194-710" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-711"><a href="#cb194-711" aria-hidden="true" tabindex="-1"></a><span class="in">performance_naiveBayes_todasVariables &lt;- evaluate_with_seeds_NaiveBayes_Asociacion_Todas(</span></span>
<span id="cb194-712"><a href="#cb194-712" aria-hidden="true" tabindex="-1"></a><span class="in">  evaluation_function = double_cross_validation_naiveBayes,</span></span>
<span id="cb194-713"><a href="#cb194-713" aria-hidden="true" tabindex="-1"></a><span class="in">  data = data_factor,</span></span>
<span id="cb194-714"><a href="#cb194-714" aria-hidden="true" tabindex="-1"></a><span class="in">  outer = 5,</span></span>
<span id="cb194-715"><a href="#cb194-715" aria-hidden="true" tabindex="-1"></a><span class="in">  inner = 2,</span></span>
<span id="cb194-716"><a href="#cb194-716" aria-hidden="true" tabindex="-1"></a><span class="in">  target_var = "PCR",</span></span>
<span id="cb194-717"><a href="#cb194-717" aria-hidden="true" tabindex="-1"></a><span class="in">  vars = todas_variables_factor,</span></span>
<span id="cb194-718"><a href="#cb194-718" aria-hidden="true" tabindex="-1"></a><span class="in">  threshold = .35,</span></span>
<span id="cb194-719"><a href="#cb194-719" aria-hidden="true" tabindex="-1"></a><span class="in">  seeds = seeds)</span></span>
<span id="cb194-720"><a href="#cb194-720" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-721"><a href="#cb194-721" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-722"><a href="#cb194-722" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-723"><a href="#cb194-723" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message=FALSE, warning=FALSE}</span></span>
<span id="cb194-724"><a href="#cb194-724" aria-hidden="true" tabindex="-1"></a><span class="in">load("RData_Files_Algorithms/NaiveBayes_TodasVariables.RData")</span></span>
<span id="cb194-725"><a href="#cb194-725" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-726"><a href="#cb194-726" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-727"><a href="#cb194-727" aria-hidden="true" tabindex="-1"></a><span class="fu">### Filtrado (Asociación)</span></span>
<span id="cb194-728"><a href="#cb194-728" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-729"><a href="#cb194-729" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=FALSE}</span></span>
<span id="cb194-730"><a href="#cb194-730" aria-hidden="true" tabindex="-1"></a><span class="in">performance_naiveBayes_Asociacion &lt;- evaluate_with_seeds_NaiveBayes_Asociacion_Todas(</span></span>
<span id="cb194-731"><a href="#cb194-731" aria-hidden="true" tabindex="-1"></a><span class="in">  evaluation_function = double_cross_validation_naiveBayes,</span></span>
<span id="cb194-732"><a href="#cb194-732" aria-hidden="true" tabindex="-1"></a><span class="in">  data = data_factor,</span></span>
<span id="cb194-733"><a href="#cb194-733" aria-hidden="true" tabindex="-1"></a><span class="in">  outer = 5,</span></span>
<span id="cb194-734"><a href="#cb194-734" aria-hidden="true" tabindex="-1"></a><span class="in">  inner = 2,</span></span>
<span id="cb194-735"><a href="#cb194-735" aria-hidden="true" tabindex="-1"></a><span class="in">  target_var = "PCR",</span></span>
<span id="cb194-736"><a href="#cb194-736" aria-hidden="true" tabindex="-1"></a><span class="in">  vars = todas_variables_factor,</span></span>
<span id="cb194-737"><a href="#cb194-737" aria-hidden="true" tabindex="-1"></a><span class="in">  threshold = .35,</span></span>
<span id="cb194-738"><a href="#cb194-738" aria-hidden="true" tabindex="-1"></a><span class="in">  seeds = seeds)</span></span>
<span id="cb194-739"><a href="#cb194-739" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-740"><a href="#cb194-740" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-741"><a href="#cb194-741" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message=FALSE, warning=FALSE}</span></span>
<span id="cb194-742"><a href="#cb194-742" aria-hidden="true" tabindex="-1"></a><span class="in">load("RData_Files_Algorithms/NaiveBayes_Asociacion.RData")</span></span>
<span id="cb194-743"><a href="#cb194-743" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-744"><a href="#cb194-744" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-745"><a href="#cb194-745" aria-hidden="true" tabindex="-1"></a><span class="fu">### Wrapped (StepAUC)</span></span>
<span id="cb194-746"><a href="#cb194-746" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-747"><a href="#cb194-747" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=FALSE}</span></span>
<span id="cb194-748"><a href="#cb194-748" aria-hidden="true" tabindex="-1"></a><span class="in">double_cross_validation_naiveBayes_stepAUC &lt;- function(data, target_name, outer, inner, variables, threshold, seed) {</span></span>
<span id="cb194-749"><a href="#cb194-749" aria-hidden="true" tabindex="-1"></a><span class="in">  set.seed(seed)</span></span>
<span id="cb194-750"><a href="#cb194-750" aria-hidden="true" tabindex="-1"></a><span class="in">  performance_metrics &lt;- data.frame(Fold = integer(), TP = integer(), TN = integer(),</span></span>
<span id="cb194-751"><a href="#cb194-751" aria-hidden="true" tabindex="-1"></a><span class="in">                                    FP = integer(), FN = integer(), AUC = numeric(),</span></span>
<span id="cb194-752"><a href="#cb194-752" aria-hidden="true" tabindex="-1"></a><span class="in">                                    Best_Variables = character(), stringsAsFactors = FALSE)</span></span>
<span id="cb194-753"><a href="#cb194-753" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb194-754"><a href="#cb194-754" aria-hidden="true" tabindex="-1"></a><span class="in">  inner_fold_metrics &lt;- data.frame(Fold = integer(), Inner_Fold = integer(), </span></span>
<span id="cb194-755"><a href="#cb194-755" aria-hidden="true" tabindex="-1"></a><span class="in">                                   TP = integer(), TN = integer(), FP = integer(), </span></span>
<span id="cb194-756"><a href="#cb194-756" aria-hidden="true" tabindex="-1"></a><span class="in">                                   FN = integer(), AUC = numeric(), stringsAsFactors = FALSE)</span></span>
<span id="cb194-757"><a href="#cb194-757" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb194-758"><a href="#cb194-758" aria-hidden="true" tabindex="-1"></a><span class="in">  data[[target_name]] &lt;- as.factor(data[[target_name]])</span></span>
<span id="cb194-759"><a href="#cb194-759" aria-hidden="true" tabindex="-1"></a><span class="in">  outer_folds &lt;- createFolds(data[[target_name]], k = outer, list = TRUE, returnTrain = FALSE)</span></span>
<span id="cb194-760"><a href="#cb194-760" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb194-761"><a href="#cb194-761" aria-hidden="true" tabindex="-1"></a><span class="in">  for (outer_index in seq_along(outer_folds)) {</span></span>
<span id="cb194-762"><a href="#cb194-762" aria-hidden="true" tabindex="-1"></a><span class="in">    outer_train_data &lt;- data[-outer_folds[[outer_index]], ]</span></span>
<span id="cb194-763"><a href="#cb194-763" aria-hidden="true" tabindex="-1"></a><span class="in">    outer_test_data &lt;- data[outer_folds[[outer_index]], ]</span></span>
<span id="cb194-764"><a href="#cb194-764" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-765"><a href="#cb194-765" aria-hidden="true" tabindex="-1"></a><span class="in">    cat(sprintf("Outer Fold %d\n", outer_index))</span></span>
<span id="cb194-766"><a href="#cb194-766" aria-hidden="true" tabindex="-1"></a><span class="in">    cat("Training Data - Class 0: ", sum(outer_train_data[[target_name]] == "0"), "\n")</span></span>
<span id="cb194-767"><a href="#cb194-767" aria-hidden="true" tabindex="-1"></a><span class="in">    cat("Training Data - Class 1: ", sum(outer_train_data[[target_name]] == "1"), "\n")</span></span>
<span id="cb194-768"><a href="#cb194-768" aria-hidden="true" tabindex="-1"></a><span class="in">    cat("Testing Data - Class 0: ", sum(outer_test_data[[target_name]] == "0"), "\n")</span></span>
<span id="cb194-769"><a href="#cb194-769" aria-hidden="true" tabindex="-1"></a><span class="in">    cat("Testing Data - Class 1: ", sum(outer_test_data[[target_name]] == "1"), "\n")</span></span>
<span id="cb194-770"><a href="#cb194-770" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-771"><a href="#cb194-771" aria-hidden="true" tabindex="-1"></a><span class="in">    inner_folds &lt;- createFolds(outer_train_data[[target_name]], k = inner, list = TRUE, returnTrain = FALSE)</span></span>
<span id="cb194-772"><a href="#cb194-772" aria-hidden="true" tabindex="-1"></a><span class="in">    best_model &lt;- NULL</span></span>
<span id="cb194-773"><a href="#cb194-773" aria-hidden="true" tabindex="-1"></a><span class="in">    best_auc &lt;- 0</span></span>
<span id="cb194-774"><a href="#cb194-774" aria-hidden="true" tabindex="-1"></a><span class="in">    best_vars &lt;- variables</span></span>
<span id="cb194-775"><a href="#cb194-775" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-776"><a href="#cb194-776" aria-hidden="true" tabindex="-1"></a><span class="in">    stepAUC &lt;- function(vars, outer_train_data, target_name, inner_folds) {</span></span>
<span id="cb194-777"><a href="#cb194-777" aria-hidden="true" tabindex="-1"></a><span class="in">      current_vars &lt;- vars</span></span>
<span id="cb194-778"><a href="#cb194-778" aria-hidden="true" tabindex="-1"></a><span class="in">      best_inner_auc &lt;- 0</span></span>
<span id="cb194-779"><a href="#cb194-779" aria-hidden="true" tabindex="-1"></a><span class="in">      best_inner_model &lt;- NULL</span></span>
<span id="cb194-780"><a href="#cb194-780" aria-hidden="true" tabindex="-1"></a><span class="in">      best_inner_vars &lt;- current_vars</span></span>
<span id="cb194-781"><a href="#cb194-781" aria-hidden="true" tabindex="-1"></a><span class="in">      improved &lt;- TRUE</span></span>
<span id="cb194-782"><a href="#cb194-782" aria-hidden="true" tabindex="-1"></a><span class="in">      </span></span>
<span id="cb194-783"><a href="#cb194-783" aria-hidden="true" tabindex="-1"></a><span class="in">      while (improved &amp;&amp; length(current_vars) &gt; 1) {</span></span>
<span id="cb194-784"><a href="#cb194-784" aria-hidden="true" tabindex="-1"></a><span class="in">        improved &lt;- FALSE</span></span>
<span id="cb194-785"><a href="#cb194-785" aria-hidden="true" tabindex="-1"></a><span class="in">        best_auc_in_step &lt;- best_inner_auc</span></span>
<span id="cb194-786"><a href="#cb194-786" aria-hidden="true" tabindex="-1"></a><span class="in">        </span></span>
<span id="cb194-787"><a href="#cb194-787" aria-hidden="true" tabindex="-1"></a><span class="in">        for (var in current_vars) {</span></span>
<span id="cb194-788"><a href="#cb194-788" aria-hidden="true" tabindex="-1"></a><span class="in">          temp_vars &lt;- setdiff(current_vars, var)</span></span>
<span id="cb194-789"><a href="#cb194-789" aria-hidden="true" tabindex="-1"></a><span class="in">          inner_auc &lt;- numeric()</span></span>
<span id="cb194-790"><a href="#cb194-790" aria-hidden="true" tabindex="-1"></a><span class="in">          </span></span>
<span id="cb194-791"><a href="#cb194-791" aria-hidden="true" tabindex="-1"></a><span class="in">          for (inner_index in seq_along(inner_folds)) {</span></span>
<span id="cb194-792"><a href="#cb194-792" aria-hidden="true" tabindex="-1"></a><span class="in">            inner_train_data &lt;- outer_train_data[-inner_folds[[inner_index]], ]</span></span>
<span id="cb194-793"><a href="#cb194-793" aria-hidden="true" tabindex="-1"></a><span class="in">            inner_test_data &lt;- outer_train_data[inner_folds[[inner_index]], ]</span></span>
<span id="cb194-794"><a href="#cb194-794" aria-hidden="true" tabindex="-1"></a><span class="in">            </span></span>
<span id="cb194-795"><a href="#cb194-795" aria-hidden="true" tabindex="-1"></a><span class="in">            result &lt;- tryCatch({</span></span>
<span id="cb194-796"><a href="#cb194-796" aria-hidden="true" tabindex="-1"></a><span class="in">              model &lt;- naiveBayes(as.formula(paste(target_name, "~", paste(temp_vars, collapse = "+"))),</span></span>
<span id="cb194-797"><a href="#cb194-797" aria-hidden="true" tabindex="-1"></a><span class="in">                                  data = inner_train_data)</span></span>
<span id="cb194-798"><a href="#cb194-798" aria-hidden="true" tabindex="-1"></a><span class="in">              </span></span>
<span id="cb194-799"><a href="#cb194-799" aria-hidden="true" tabindex="-1"></a><span class="in">              predictions &lt;- predict(model, newdata = inner_test_data, type = "raw")[, 2]</span></span>
<span id="cb194-800"><a href="#cb194-800" aria-hidden="true" tabindex="-1"></a><span class="in">              roc_curve &lt;- roc(inner_test_data[[target_name]], predictions)</span></span>
<span id="cb194-801"><a href="#cb194-801" aria-hidden="true" tabindex="-1"></a><span class="in">              inner_auc[inner_index] &lt;- roc_curve$auc</span></span>
<span id="cb194-802"><a href="#cb194-802" aria-hidden="true" tabindex="-1"></a><span class="in">              </span></span>
<span id="cb194-803"><a href="#cb194-803" aria-hidden="true" tabindex="-1"></a><span class="in">            }, error = function(e) {</span></span>
<span id="cb194-804"><a href="#cb194-804" aria-hidden="true" tabindex="-1"></a><span class="in">              cat("Error with variables:", paste(temp_vars, collapse = ", "), "\n")</span></span>
<span id="cb194-805"><a href="#cb194-805" aria-hidden="true" tabindex="-1"></a><span class="in">              inner_auc[inner_index] &lt;- NA  # Set to NA or some other indicator of failure</span></span>
<span id="cb194-806"><a href="#cb194-806" aria-hidden="true" tabindex="-1"></a><span class="in">            })</span></span>
<span id="cb194-807"><a href="#cb194-807" aria-hidden="true" tabindex="-1"></a><span class="in">          }</span></span>
<span id="cb194-808"><a href="#cb194-808" aria-hidden="true" tabindex="-1"></a><span class="in">          </span></span>
<span id="cb194-809"><a href="#cb194-809" aria-hidden="true" tabindex="-1"></a><span class="in">          mean_inner_auc &lt;- mean(inner_auc, na.rm = TRUE)</span></span>
<span id="cb194-810"><a href="#cb194-810" aria-hidden="true" tabindex="-1"></a><span class="in">          if (!is.na(mean_inner_auc) &amp;&amp; mean_inner_auc &gt; best_auc_in_step) {</span></span>
<span id="cb194-811"><a href="#cb194-811" aria-hidden="true" tabindex="-1"></a><span class="in">            best_auc_in_step &lt;- mean_inner_auc</span></span>
<span id="cb194-812"><a href="#cb194-812" aria-hidden="true" tabindex="-1"></a><span class="in">            best_inner_model &lt;- model</span></span>
<span id="cb194-813"><a href="#cb194-813" aria-hidden="true" tabindex="-1"></a><span class="in">            best_inner_vars &lt;- temp_vars</span></span>
<span id="cb194-814"><a href="#cb194-814" aria-hidden="true" tabindex="-1"></a><span class="in">            improved &lt;- TRUE</span></span>
<span id="cb194-815"><a href="#cb194-815" aria-hidden="true" tabindex="-1"></a><span class="in">          }</span></span>
<span id="cb194-816"><a href="#cb194-816" aria-hidden="true" tabindex="-1"></a><span class="in">        }</span></span>
<span id="cb194-817"><a href="#cb194-817" aria-hidden="true" tabindex="-1"></a><span class="in">        </span></span>
<span id="cb194-818"><a href="#cb194-818" aria-hidden="true" tabindex="-1"></a><span class="in">        if (improved) {</span></span>
<span id="cb194-819"><a href="#cb194-819" aria-hidden="true" tabindex="-1"></a><span class="in">          current_vars &lt;- best_inner_vars</span></span>
<span id="cb194-820"><a href="#cb194-820" aria-hidden="true" tabindex="-1"></a><span class="in">          best_inner_auc &lt;- best_auc_in_step</span></span>
<span id="cb194-821"><a href="#cb194-821" aria-hidden="true" tabindex="-1"></a><span class="in">          cat("Vars improved: ", paste(current_vars, collapse=", "), "\n")</span></span>
<span id="cb194-822"><a href="#cb194-822" aria-hidden="true" tabindex="-1"></a><span class="in">          cat("AUC: ", paste(best_inner_auc), "\n")</span></span>
<span id="cb194-823"><a href="#cb194-823" aria-hidden="true" tabindex="-1"></a><span class="in">        }</span></span>
<span id="cb194-824"><a href="#cb194-824" aria-hidden="true" tabindex="-1"></a><span class="in">      }</span></span>
<span id="cb194-825"><a href="#cb194-825" aria-hidden="true" tabindex="-1"></a><span class="in">      </span></span>
<span id="cb194-826"><a href="#cb194-826" aria-hidden="true" tabindex="-1"></a><span class="in">      list(model = best_inner_model, auc = best_inner_auc, vars = best_inner_vars)</span></span>
<span id="cb194-827"><a href="#cb194-827" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb194-828"><a href="#cb194-828" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-829"><a href="#cb194-829" aria-hidden="true" tabindex="-1"></a><span class="in">    best_result &lt;- stepAUC(variables, outer_train_data, target_name, inner_folds)</span></span>
<span id="cb194-830"><a href="#cb194-830" aria-hidden="true" tabindex="-1"></a><span class="in">    best_model &lt;- best_result$model</span></span>
<span id="cb194-831"><a href="#cb194-831" aria-hidden="true" tabindex="-1"></a><span class="in">    best_auc &lt;- best_result$auc</span></span>
<span id="cb194-832"><a href="#cb194-832" aria-hidden="true" tabindex="-1"></a><span class="in">    best_vars &lt;- best_result$vars</span></span>
<span id="cb194-833"><a href="#cb194-833" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-834"><a href="#cb194-834" aria-hidden="true" tabindex="-1"></a><span class="in">    if (is.null(best_model)) {</span></span>
<span id="cb194-835"><a href="#cb194-835" aria-hidden="true" tabindex="-1"></a><span class="in">      cat("Error: No valid model found for outer fold ", outer_index, "\n")</span></span>
<span id="cb194-836"><a href="#cb194-836" aria-hidden="true" tabindex="-1"></a><span class="in">      next</span></span>
<span id="cb194-837"><a href="#cb194-837" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb194-838"><a href="#cb194-838" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-839"><a href="#cb194-839" aria-hidden="true" tabindex="-1"></a><span class="in">    # Evaluar el mejor modelo en el validation split del inner loop</span></span>
<span id="cb194-840"><a href="#cb194-840" aria-hidden="true" tabindex="-1"></a><span class="in">    inner_auc_vals &lt;- numeric()</span></span>
<span id="cb194-841"><a href="#cb194-841" aria-hidden="true" tabindex="-1"></a><span class="in">    for (inner_index in seq_along(inner_folds)) {</span></span>
<span id="cb194-842"><a href="#cb194-842" aria-hidden="true" tabindex="-1"></a><span class="in">      inner_train_data &lt;- outer_train_data[-inner_folds[[inner_index]], ]</span></span>
<span id="cb194-843"><a href="#cb194-843" aria-hidden="true" tabindex="-1"></a><span class="in">      inner_test_data &lt;- outer_train_data[inner_folds[[inner_index]], ]</span></span>
<span id="cb194-844"><a href="#cb194-844" aria-hidden="true" tabindex="-1"></a><span class="in">      </span></span>
<span id="cb194-845"><a href="#cb194-845" aria-hidden="true" tabindex="-1"></a><span class="in">      predictions &lt;- predict(best_model, newdata = inner_test_data, type = "raw")[, 2]</span></span>
<span id="cb194-846"><a href="#cb194-846" aria-hidden="true" tabindex="-1"></a><span class="in">      roc_curve &lt;- roc(inner_test_data[[target_name]], predictions)</span></span>
<span id="cb194-847"><a href="#cb194-847" aria-hidden="true" tabindex="-1"></a><span class="in">      inner_auc_vals[inner_index] &lt;- roc_curve$auc</span></span>
<span id="cb194-848"><a href="#cb194-848" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-849"><a href="#cb194-849" aria-hidden="true" tabindex="-1"></a><span class="in">      pred_class &lt;- ifelse(predictions &gt; threshold, "1", "0")</span></span>
<span id="cb194-850"><a href="#cb194-850" aria-hidden="true" tabindex="-1"></a><span class="in">      confusion &lt;- table(Actual = inner_test_data[[target_name]], Predicted = pred_class)</span></span>
<span id="cb194-851"><a href="#cb194-851" aria-hidden="true" tabindex="-1"></a><span class="in">      TP &lt;- ifelse(nrow(confusion) &gt;= 2 &amp;&amp; ncol(confusion) &gt;= 2, confusion[2, 2], 0)</span></span>
<span id="cb194-852"><a href="#cb194-852" aria-hidden="true" tabindex="-1"></a><span class="in">      TN &lt;- ifelse(nrow(confusion) &gt;= 1 &amp;&amp; ncol(confusion) &gt;= 1, confusion[1, 1], 0)</span></span>
<span id="cb194-853"><a href="#cb194-853" aria-hidden="true" tabindex="-1"></a><span class="in">      FP &lt;- ifelse(nrow(confusion) &gt;= 1 &amp;&amp; ncol(confusion) &gt;= 2, confusion[1, 2], 0)</span></span>
<span id="cb194-854"><a href="#cb194-854" aria-hidden="true" tabindex="-1"></a><span class="in">      FN &lt;- ifelse(nrow(confusion) &gt;= 2 &amp;&amp; ncol(confusion) &gt;= 1, confusion[2, 1], 0)</span></span>
<span id="cb194-855"><a href="#cb194-855" aria-hidden="true" tabindex="-1"></a><span class="in">      auc &lt;- roc_curve$auc</span></span>
<span id="cb194-856"><a href="#cb194-856" aria-hidden="true" tabindex="-1"></a><span class="in">      </span></span>
<span id="cb194-857"><a href="#cb194-857" aria-hidden="true" tabindex="-1"></a><span class="in">      inner_metrics &lt;- setNames(c(outer_index, inner_index, TP, TN, FP, FN, auc), names(inner_fold_metrics))</span></span>
<span id="cb194-858"><a href="#cb194-858" aria-hidden="true" tabindex="-1"></a><span class="in">      inner_fold_metrics &lt;- rbind(inner_fold_metrics, as.data.frame(t(inner_metrics)))</span></span>
<span id="cb194-859"><a href="#cb194-859" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb194-860"><a href="#cb194-860" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-861"><a href="#cb194-861" aria-hidden="true" tabindex="-1"></a><span class="in">    best_inner_auc &lt;- mean(inner_auc_vals, na.rm = TRUE)</span></span>
<span id="cb194-862"><a href="#cb194-862" aria-hidden="true" tabindex="-1"></a><span class="in">    best_model &lt;- naiveBayes(as.formula(paste(target_name, "~", paste(best_vars, collapse = "+"))),</span></span>
<span id="cb194-863"><a href="#cb194-863" aria-hidden="true" tabindex="-1"></a><span class="in">                         data = outer_train_data)</span></span>
<span id="cb194-864"><a href="#cb194-864" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-865"><a href="#cb194-865" aria-hidden="true" tabindex="-1"></a><span class="in">    predictions &lt;- predict(best_model, outer_test_data, type = "raw")[, 2]</span></span>
<span id="cb194-866"><a href="#cb194-866" aria-hidden="true" tabindex="-1"></a><span class="in">    pred_class &lt;- ifelse(predictions &gt; threshold, "1", "0")</span></span>
<span id="cb194-867"><a href="#cb194-867" aria-hidden="true" tabindex="-1"></a><span class="in">    confusion &lt;- table(Actual = outer_test_data[[target_name]], Predicted = pred_class)</span></span>
<span id="cb194-868"><a href="#cb194-868" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-869"><a href="#cb194-869" aria-hidden="true" tabindex="-1"></a><span class="in">    if (nrow(confusion) &lt; 2 || ncol(confusion) &lt; 2) {</span></span>
<span id="cb194-870"><a href="#cb194-870" aria-hidden="true" tabindex="-1"></a><span class="in">      TP &lt;- ifelse(nrow(confusion) &gt;= 2 &amp;&amp; ncol(confusion) &gt;= 2, confusion[2, 2], 0)</span></span>
<span id="cb194-871"><a href="#cb194-871" aria-hidden="true" tabindex="-1"></a><span class="in">      TN &lt;- ifelse(nrow(confusion) &gt;= 1 &amp;&amp; ncol(confusion) &gt;= 1, confusion[1, 1], 0)</span></span>
<span id="cb194-872"><a href="#cb194-872" aria-hidden="true" tabindex="-1"></a><span class="in">      FP &lt;- ifelse(nrow(confusion) &gt;= 1 &amp;&amp; ncol(confusion) &gt;= 2, confusion[1, 2], 0)</span></span>
<span id="cb194-873"><a href="#cb194-873" aria-hidden="true" tabindex="-1"></a><span class="in">      FN &lt;- ifelse(nrow(confusion) &gt;= 2 &amp;&amp; ncol(confusion) &gt;= 1, confusion[2, 1], 0)</span></span>
<span id="cb194-874"><a href="#cb194-874" aria-hidden="true" tabindex="-1"></a><span class="in">    } else {</span></span>
<span id="cb194-875"><a href="#cb194-875" aria-hidden="true" tabindex="-1"></a><span class="in">      TP &lt;- confusion[2, 2]</span></span>
<span id="cb194-876"><a href="#cb194-876" aria-hidden="true" tabindex="-1"></a><span class="in">      TN &lt;- confusion[1, 1]</span></span>
<span id="cb194-877"><a href="#cb194-877" aria-hidden="true" tabindex="-1"></a><span class="in">      FP &lt;- confusion[1, 2]</span></span>
<span id="cb194-878"><a href="#cb194-878" aria-hidden="true" tabindex="-1"></a><span class="in">      FN &lt;- confusion[2, 1]</span></span>
<span id="cb194-879"><a href="#cb194-879" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb194-880"><a href="#cb194-880" aria-hidden="true" tabindex="-1"></a><span class="in">    auc &lt;- roc(outer_test_data[[target_name]], predictions)$auc</span></span>
<span id="cb194-881"><a href="#cb194-881" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-882"><a href="#cb194-882" aria-hidden="true" tabindex="-1"></a><span class="in">    metrics &lt;- setNames(c(outer_index, TP, TN, FP, FN, auc, </span></span>
<span id="cb194-883"><a href="#cb194-883" aria-hidden="true" tabindex="-1"></a><span class="in">                          paste(best_vars, collapse = ",")), </span></span>
<span id="cb194-884"><a href="#cb194-884" aria-hidden="true" tabindex="-1"></a><span class="in">                        names(performance_metrics))</span></span>
<span id="cb194-885"><a href="#cb194-885" aria-hidden="true" tabindex="-1"></a><span class="in">    performance_metrics &lt;- rbind(performance_metrics, as.data.frame(t(metrics)))</span></span>
<span id="cb194-886"><a href="#cb194-886" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-887"><a href="#cb194-887" aria-hidden="true" tabindex="-1"></a><span class="in">    cat("Performance:", paste(performance_metrics))</span></span>
<span id="cb194-888"><a href="#cb194-888" aria-hidden="true" tabindex="-1"></a><span class="in">    cat(sprintf("Confusion Matrix for Fold %d:\n", outer_index))</span></span>
<span id="cb194-889"><a href="#cb194-889" aria-hidden="true" tabindex="-1"></a><span class="in">    print(confusion)</span></span>
<span id="cb194-890"><a href="#cb194-890" aria-hidden="true" tabindex="-1"></a><span class="in">    cat(sprintf("Metrics for Fold %d:\n", outer_index))</span></span>
<span id="cb194-891"><a href="#cb194-891" aria-hidden="true" tabindex="-1"></a><span class="in">    cat(sprintf("TP: %d, TN: %d, FP: %d, FN: %d, AUC: %f, Best Variables: %s\n",</span></span>
<span id="cb194-892"><a href="#cb194-892" aria-hidden="true" tabindex="-1"></a><span class="in">                TP, TN, FP, FN, auc, paste(best_vars, collapse = ",")))</span></span>
<span id="cb194-893"><a href="#cb194-893" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb194-894"><a href="#cb194-894" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb194-895"><a href="#cb194-895" aria-hidden="true" tabindex="-1"></a><span class="in">  list(performance_metrics = performance_metrics, inner_fold_metrics = inner_fold_metrics)</span></span>
<span id="cb194-896"><a href="#cb194-896" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb194-897"><a href="#cb194-897" aria-hidden="true" tabindex="-1"></a><span class="in">evaluate_with_seeds_NaiveBayes_stepAUC &lt;- </span></span>
<span id="cb194-898"><a href="#cb194-898" aria-hidden="true" tabindex="-1"></a><span class="in">  function(evaluation_function, data, target_var, vars, threshold, seeds, outer, inner) {</span></span>
<span id="cb194-899"><a href="#cb194-899" aria-hidden="true" tabindex="-1"></a><span class="in">  results_list &lt;- list()</span></span>
<span id="cb194-900"><a href="#cb194-900" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-901"><a href="#cb194-901" aria-hidden="true" tabindex="-1"></a><span class="in">  for (seed in seeds) {</span></span>
<span id="cb194-902"><a href="#cb194-902" aria-hidden="true" tabindex="-1"></a><span class="in">    set.seed(seed)</span></span>
<span id="cb194-903"><a href="#cb194-903" aria-hidden="true" tabindex="-1"></a><span class="in">    cat("Evaluating with seed:", seed, "\n")</span></span>
<span id="cb194-904"><a href="#cb194-904" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-905"><a href="#cb194-905" aria-hidden="true" tabindex="-1"></a><span class="in">    results &lt;- evaluation_function(data = data, </span></span>
<span id="cb194-906"><a href="#cb194-906" aria-hidden="true" tabindex="-1"></a><span class="in">                                   target_name = target_var, </span></span>
<span id="cb194-907"><a href="#cb194-907" aria-hidden="true" tabindex="-1"></a><span class="in">                                   variables = vars, </span></span>
<span id="cb194-908"><a href="#cb194-908" aria-hidden="true" tabindex="-1"></a><span class="in">                                   threshold = threshold, </span></span>
<span id="cb194-909"><a href="#cb194-909" aria-hidden="true" tabindex="-1"></a><span class="in">                                   outer = outer, </span></span>
<span id="cb194-910"><a href="#cb194-910" aria-hidden="true" tabindex="-1"></a><span class="in">                                   inner = inner, </span></span>
<span id="cb194-911"><a href="#cb194-911" aria-hidden="true" tabindex="-1"></a><span class="in">                                   seed = seed)</span></span>
<span id="cb194-912"><a href="#cb194-912" aria-hidden="true" tabindex="-1"></a><span class="in">    results_list[[paste0("seed_", seed)]] &lt;- results</span></span>
<span id="cb194-913"><a href="#cb194-913" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb194-914"><a href="#cb194-914" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-915"><a href="#cb194-915" aria-hidden="true" tabindex="-1"></a><span class="in">  return(results_list)</span></span>
<span id="cb194-916"><a href="#cb194-916" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb194-917"><a href="#cb194-917" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-918"><a href="#cb194-918" aria-hidden="true" tabindex="-1"></a><span class="in">performance_naiveBayes_stepAUC &lt;- evaluate_with_seeds_NaiveBayes_stepAUC(</span></span>
<span id="cb194-919"><a href="#cb194-919" aria-hidden="true" tabindex="-1"></a><span class="in">  evaluation_function = double_cross_validation_naiveBayes_stepAUC,</span></span>
<span id="cb194-920"><a href="#cb194-920" aria-hidden="true" tabindex="-1"></a><span class="in">  data = data_factor,</span></span>
<span id="cb194-921"><a href="#cb194-921" aria-hidden="true" tabindex="-1"></a><span class="in">  outer = 5,</span></span>
<span id="cb194-922"><a href="#cb194-922" aria-hidden="true" tabindex="-1"></a><span class="in">  inner = 2,</span></span>
<span id="cb194-923"><a href="#cb194-923" aria-hidden="true" tabindex="-1"></a><span class="in">  vars = todas_variables_factor,</span></span>
<span id="cb194-924"><a href="#cb194-924" aria-hidden="true" tabindex="-1"></a><span class="in">  target_var = "PCR",</span></span>
<span id="cb194-925"><a href="#cb194-925" aria-hidden="true" tabindex="-1"></a><span class="in">  threshold = .35,</span></span>
<span id="cb194-926"><a href="#cb194-926" aria-hidden="true" tabindex="-1"></a><span class="in">  seeds = seeds</span></span>
<span id="cb194-927"><a href="#cb194-927" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb194-928"><a href="#cb194-928" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-929"><a href="#cb194-929" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-930"><a href="#cb194-930" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message=FALSE, warning=FALSE}</span></span>
<span id="cb194-931"><a href="#cb194-931" aria-hidden="true" tabindex="-1"></a><span class="in">load("RData_Files_Algorithms/NaiveBayes_StepAUC.RData")</span></span>
<span id="cb194-932"><a href="#cb194-932" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-933"><a href="#cb194-933" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-934"><a href="#cb194-934" aria-hidden="true" tabindex="-1"></a><span class="fu">### Embedded (Lasso)</span></span>
<span id="cb194-935"><a href="#cb194-935" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-936"><a href="#cb194-936" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=FALSE}</span></span>
<span id="cb194-937"><a href="#cb194-937" aria-hidden="true" tabindex="-1"></a><span class="in">double_cross_validation_naiveBayes_lasso &lt;- function(data, target_name, outer, inner, variables, threshold, seed) {</span></span>
<span id="cb194-938"><a href="#cb194-938" aria-hidden="true" tabindex="-1"></a><span class="in">  set.seed(seed)</span></span>
<span id="cb194-939"><a href="#cb194-939" aria-hidden="true" tabindex="-1"></a><span class="in">  performance_metrics &lt;- data.frame(Fold = integer(), TP = integer(), TN = integer(),</span></span>
<span id="cb194-940"><a href="#cb194-940" aria-hidden="true" tabindex="-1"></a><span class="in">                                    FP = integer(), FN = integer(), AUC = numeric(),</span></span>
<span id="cb194-941"><a href="#cb194-941" aria-hidden="true" tabindex="-1"></a><span class="in">                                    Best_Variables = character(), stringsAsFactors = FALSE)</span></span>
<span id="cb194-942"><a href="#cb194-942" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb194-943"><a href="#cb194-943" aria-hidden="true" tabindex="-1"></a><span class="in">  inner_fold_metrics &lt;- data.frame(Fold = integer(), Inner_Fold = integer(), </span></span>
<span id="cb194-944"><a href="#cb194-944" aria-hidden="true" tabindex="-1"></a><span class="in">                                   TP = integer(), TN = integer(), FP = integer(), </span></span>
<span id="cb194-945"><a href="#cb194-945" aria-hidden="true" tabindex="-1"></a><span class="in">                                   FN = integer(), AUC = numeric(), stringsAsFactors = FALSE)</span></span>
<span id="cb194-946"><a href="#cb194-946" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb194-947"><a href="#cb194-947" aria-hidden="true" tabindex="-1"></a><span class="in">  # Convertir las variables del dataset con model.matrix</span></span>
<span id="cb194-948"><a href="#cb194-948" aria-hidden="true" tabindex="-1"></a><span class="in">  target &lt;- as.factor(data[[target_name]])  # Aseguramos que la variable de respuesta sea factor</span></span>
<span id="cb194-949"><a href="#cb194-949" aria-hidden="true" tabindex="-1"></a><span class="in">  features &lt;- data[, setdiff(names(data), target_name)]</span></span>
<span id="cb194-950"><a href="#cb194-950" aria-hidden="true" tabindex="-1"></a><span class="in">  data_matrix &lt;- as.data.frame(model.matrix(~ ., data=features)[,-1])  # Eliminar el intercepto</span></span>
<span id="cb194-951"><a href="#cb194-951" aria-hidden="true" tabindex="-1"></a><span class="in">  data_matrix[[target_name]] &lt;- target</span></span>
<span id="cb194-952"><a href="#cb194-952" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb194-953"><a href="#cb194-953" aria-hidden="true" tabindex="-1"></a><span class="in">  outer_folds &lt;- createFolds(data_matrix[[target_name]], k = outer)</span></span>
<span id="cb194-954"><a href="#cb194-954" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb194-955"><a href="#cb194-955" aria-hidden="true" tabindex="-1"></a><span class="in">  for (outer_index in seq_along(outer_folds)) {</span></span>
<span id="cb194-956"><a href="#cb194-956" aria-hidden="true" tabindex="-1"></a><span class="in">    outer_train_data &lt;- data_matrix[-outer_folds[[outer_index]], ]</span></span>
<span id="cb194-957"><a href="#cb194-957" aria-hidden="true" tabindex="-1"></a><span class="in">    outer_test_data &lt;- data_matrix[outer_folds[[outer_index]], ]</span></span>
<span id="cb194-958"><a href="#cb194-958" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-959"><a href="#cb194-959" aria-hidden="true" tabindex="-1"></a><span class="in">    cat(sprintf("Outer Fold %d\n", outer_index))</span></span>
<span id="cb194-960"><a href="#cb194-960" aria-hidden="true" tabindex="-1"></a><span class="in">    cat("Training Data - Class 0: ", sum(outer_train_data[[target_name]] == 0), "\n")</span></span>
<span id="cb194-961"><a href="#cb194-961" aria-hidden="true" tabindex="-1"></a><span class="in">    cat("Training Data - Class 1: ", sum(outer_train_data[[target_name]] == 1), "\n")</span></span>
<span id="cb194-962"><a href="#cb194-962" aria-hidden="true" tabindex="-1"></a><span class="in">    cat("Testing Data - Class 0: ", sum(outer_test_data[[target_name]] == 0), "\n")</span></span>
<span id="cb194-963"><a href="#cb194-963" aria-hidden="true" tabindex="-1"></a><span class="in">    cat("Testing Data - Class 1: ", sum(outer_test_data[[target_name]] == 1), "\n")</span></span>
<span id="cb194-964"><a href="#cb194-964" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-965"><a href="#cb194-965" aria-hidden="true" tabindex="-1"></a><span class="in">    inner_folds &lt;- createFolds(outer_train_data[[target_name]], k = inner)</span></span>
<span id="cb194-966"><a href="#cb194-966" aria-hidden="true" tabindex="-1"></a><span class="in">    best_model &lt;- NULL</span></span>
<span id="cb194-967"><a href="#cb194-967" aria-hidden="true" tabindex="-1"></a><span class="in">    best_auc &lt;- 0</span></span>
<span id="cb194-968"><a href="#cb194-968" aria-hidden="true" tabindex="-1"></a><span class="in">    best_vars &lt;- colnames(outer_train_data)[!colnames(outer_train_data) %in% target_name]</span></span>
<span id="cb194-969"><a href="#cb194-969" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-970"><a href="#cb194-970" aria-hidden="true" tabindex="-1"></a><span class="in">    select_vars_lasso &lt;- function(data, target_name) {</span></span>
<span id="cb194-971"><a href="#cb194-971" aria-hidden="true" tabindex="-1"></a><span class="in">      target &lt;- as.numeric(data[[target_name]]) - 1  # Convertimos a numérico para Lasso</span></span>
<span id="cb194-972"><a href="#cb194-972" aria-hidden="true" tabindex="-1"></a><span class="in">      features &lt;- data[, setdiff(names(data), target_name)]</span></span>
<span id="cb194-973"><a href="#cb194-973" aria-hidden="true" tabindex="-1"></a><span class="in">      X &lt;- model.matrix(~ ., data=features)[,-1]  # Eliminamos el intercepto</span></span>
<span id="cb194-974"><a href="#cb194-974" aria-hidden="true" tabindex="-1"></a><span class="in">      y &lt;- target</span></span>
<span id="cb194-975"><a href="#cb194-975" aria-hidden="true" tabindex="-1"></a><span class="in">      </span></span>
<span id="cb194-976"><a href="#cb194-976" aria-hidden="true" tabindex="-1"></a><span class="in">      # Ajustamos el modelo Lasso</span></span>
<span id="cb194-977"><a href="#cb194-977" aria-hidden="true" tabindex="-1"></a><span class="in">      lasso_model &lt;- cv.glmnet(X, y, alpha=1)</span></span>
<span id="cb194-978"><a href="#cb194-978" aria-hidden="true" tabindex="-1"></a><span class="in">      lasso_coef &lt;- coef(lasso_model, s = "lambda.min")</span></span>
<span id="cb194-979"><a href="#cb194-979" aria-hidden="true" tabindex="-1"></a><span class="in">      </span></span>
<span id="cb194-980"><a href="#cb194-980" aria-hidden="true" tabindex="-1"></a><span class="in">      # Seleccionamos las variables no nulas</span></span>
<span id="cb194-981"><a href="#cb194-981" aria-hidden="true" tabindex="-1"></a><span class="in">      selected_vars &lt;- rownames(lasso_coef)[lasso_coef[, 1] != 0]</span></span>
<span id="cb194-982"><a href="#cb194-982" aria-hidden="true" tabindex="-1"></a><span class="in">      selected_vars &lt;- setdiff(selected_vars, "(Intercept)")</span></span>
<span id="cb194-983"><a href="#cb194-983" aria-hidden="true" tabindex="-1"></a><span class="in">      cat("Selected variables by Lasso: ", paste(selected_vars, collapse=", "), "\n")</span></span>
<span id="cb194-984"><a href="#cb194-984" aria-hidden="true" tabindex="-1"></a><span class="in">      return(selected_vars)</span></span>
<span id="cb194-985"><a href="#cb194-985" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb194-986"><a href="#cb194-986" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-987"><a href="#cb194-987" aria-hidden="true" tabindex="-1"></a><span class="in">    stepAUC &lt;- function(vars, data, target_name, inner_folds) {</span></span>
<span id="cb194-988"><a href="#cb194-988" aria-hidden="true" tabindex="-1"></a><span class="in">      best_inner_auc &lt;- 0</span></span>
<span id="cb194-989"><a href="#cb194-989" aria-hidden="true" tabindex="-1"></a><span class="in">      best_inner_model &lt;- NULL</span></span>
<span id="cb194-990"><a href="#cb194-990" aria-hidden="true" tabindex="-1"></a><span class="in">      best_inner_vars &lt;- vars</span></span>
<span id="cb194-991"><a href="#cb194-991" aria-hidden="true" tabindex="-1"></a><span class="in">      improved &lt;- TRUE</span></span>
<span id="cb194-992"><a href="#cb194-992" aria-hidden="true" tabindex="-1"></a><span class="in">      </span></span>
<span id="cb194-993"><a href="#cb194-993" aria-hidden="true" tabindex="-1"></a><span class="in">      while (improved &amp;&amp; length(vars) &gt; 1) {</span></span>
<span id="cb194-994"><a href="#cb194-994" aria-hidden="true" tabindex="-1"></a><span class="in">        improved &lt;- FALSE</span></span>
<span id="cb194-995"><a href="#cb194-995" aria-hidden="true" tabindex="-1"></a><span class="in">        best_auc_in_step &lt;- best_inner_auc</span></span>
<span id="cb194-996"><a href="#cb194-996" aria-hidden="true" tabindex="-1"></a><span class="in">        </span></span>
<span id="cb194-997"><a href="#cb194-997" aria-hidden="true" tabindex="-1"></a><span class="in">        auc_vals &lt;- numeric()</span></span>
<span id="cb194-998"><a href="#cb194-998" aria-hidden="true" tabindex="-1"></a><span class="in">        </span></span>
<span id="cb194-999"><a href="#cb194-999" aria-hidden="true" tabindex="-1"></a><span class="in">        for (inner_index in seq_along(inner_folds)) {</span></span>
<span id="cb194-1000"><a href="#cb194-1000" aria-hidden="true" tabindex="-1"></a><span class="in">          inner_train_data &lt;- outer_train_data[-inner_folds[[inner_index]], ]</span></span>
<span id="cb194-1001"><a href="#cb194-1001" aria-hidden="true" tabindex="-1"></a><span class="in">          inner_test_data &lt;- outer_train_data[inner_folds[[inner_index]], ]</span></span>
<span id="cb194-1002"><a href="#cb194-1002" aria-hidden="true" tabindex="-1"></a><span class="in">          </span></span>
<span id="cb194-1003"><a href="#cb194-1003" aria-hidden="true" tabindex="-1"></a><span class="in">          selected_vars &lt;- select_vars_lasso(inner_train_data, target_name)</span></span>
<span id="cb194-1004"><a href="#cb194-1004" aria-hidden="true" tabindex="-1"></a><span class="in">          formula &lt;- as.formula(paste(target_name, "~", paste(selected_vars, collapse = "+")))</span></span>
<span id="cb194-1005"><a href="#cb194-1005" aria-hidden="true" tabindex="-1"></a><span class="in">          cat("Testing with formula: ", deparse(formula), "\n")</span></span>
<span id="cb194-1006"><a href="#cb194-1006" aria-hidden="true" tabindex="-1"></a><span class="in">          </span></span>
<span id="cb194-1007"><a href="#cb194-1007" aria-hidden="true" tabindex="-1"></a><span class="in">          result &lt;- tryCatch({</span></span>
<span id="cb194-1008"><a href="#cb194-1008" aria-hidden="true" tabindex="-1"></a><span class="in">            model &lt;- naiveBayes(formula, data = inner_train_data)</span></span>
<span id="cb194-1009"><a href="#cb194-1009" aria-hidden="true" tabindex="-1"></a><span class="in">            </span></span>
<span id="cb194-1010"><a href="#cb194-1010" aria-hidden="true" tabindex="-1"></a><span class="in">            predictions &lt;- predict(model, inner_test_data, type = "raw")[,2]</span></span>
<span id="cb194-1011"><a href="#cb194-1011" aria-hidden="true" tabindex="-1"></a><span class="in">            roc_curve &lt;- roc(inner_test_data[[target_name]], predictions)</span></span>
<span id="cb194-1012"><a href="#cb194-1012" aria-hidden="true" tabindex="-1"></a><span class="in">            auc_vals[inner_index] &lt;- roc_curve$auc</span></span>
<span id="cb194-1013"><a href="#cb194-1013" aria-hidden="true" tabindex="-1"></a><span class="in">            cat("AUC for inner fold ", inner_index, ": ", roc_curve$auc, "\n")</span></span>
<span id="cb194-1014"><a href="#cb194-1014" aria-hidden="true" tabindex="-1"></a><span class="in">            </span></span>
<span id="cb194-1015"><a href="#cb194-1015" aria-hidden="true" tabindex="-1"></a><span class="in">          }, error = function(e) {</span></span>
<span id="cb194-1016"><a href="#cb194-1016" aria-hidden="true" tabindex="-1"></a><span class="in">            cat("Error with variables: ", paste(selected_vars, collapse = ", "), "\n")</span></span>
<span id="cb194-1017"><a href="#cb194-1017" aria-hidden="true" tabindex="-1"></a><span class="in">            cat("Error message: ", e$message, "\n")</span></span>
<span id="cb194-1018"><a href="#cb194-1018" aria-hidden="true" tabindex="-1"></a><span class="in">            auc_vals[inner_index] &lt;- NA  # Set to NA or some other indicator of failure</span></span>
<span id="cb194-1019"><a href="#cb194-1019" aria-hidden="true" tabindex="-1"></a><span class="in">          })</span></span>
<span id="cb194-1020"><a href="#cb194-1020" aria-hidden="true" tabindex="-1"></a><span class="in">        }</span></span>
<span id="cb194-1021"><a href="#cb194-1021" aria-hidden="true" tabindex="-1"></a><span class="in">        </span></span>
<span id="cb194-1022"><a href="#cb194-1022" aria-hidden="true" tabindex="-1"></a><span class="in">        mean_auc &lt;- mean(auc_vals, na.rm = TRUE)</span></span>
<span id="cb194-1023"><a href="#cb194-1023" aria-hidden="true" tabindex="-1"></a><span class="in">        cat("Mean AUC: ", mean_auc, "\n")</span></span>
<span id="cb194-1024"><a href="#cb194-1024" aria-hidden="true" tabindex="-1"></a><span class="in">        if (!is.na(mean_auc) &amp;&amp; mean_auc &gt; best_auc_in_step) {</span></span>
<span id="cb194-1025"><a href="#cb194-1025" aria-hidden="true" tabindex="-1"></a><span class="in">          best_auc_in_step &lt;- mean_auc</span></span>
<span id="cb194-1026"><a href="#cb194-1026" aria-hidden="true" tabindex="-1"></a><span class="in">          best_inner_model &lt;- model</span></span>
<span id="cb194-1027"><a href="#cb194-1027" aria-hidden="true" tabindex="-1"></a><span class="in">          best_inner_vars &lt;- selected_vars</span></span>
<span id="cb194-1028"><a href="#cb194-1028" aria-hidden="true" tabindex="-1"></a><span class="in">          improved &lt;- TRUE</span></span>
<span id="cb194-1029"><a href="#cb194-1029" aria-hidden="true" tabindex="-1"></a><span class="in">        }</span></span>
<span id="cb194-1030"><a href="#cb194-1030" aria-hidden="true" tabindex="-1"></a><span class="in">        </span></span>
<span id="cb194-1031"><a href="#cb194-1031" aria-hidden="true" tabindex="-1"></a><span class="in">        if (improved) {</span></span>
<span id="cb194-1032"><a href="#cb194-1032" aria-hidden="true" tabindex="-1"></a><span class="in">          vars &lt;- best_inner_vars</span></span>
<span id="cb194-1033"><a href="#cb194-1033" aria-hidden="true" tabindex="-1"></a><span class="in">          best_inner_auc &lt;- best_auc_in_step</span></span>
<span id="cb194-1034"><a href="#cb194-1034" aria-hidden="true" tabindex="-1"></a><span class="in">          cat("Vars improved: ", paste(vars, collapse=", "), "\n")</span></span>
<span id="cb194-1035"><a href="#cb194-1035" aria-hidden="true" tabindex="-1"></a><span class="in">          cat("AUC: ", best_inner_auc, "\n")</span></span>
<span id="cb194-1036"><a href="#cb194-1036" aria-hidden="true" tabindex="-1"></a><span class="in">        }</span></span>
<span id="cb194-1037"><a href="#cb194-1037" aria-hidden="true" tabindex="-1"></a><span class="in">      }</span></span>
<span id="cb194-1038"><a href="#cb194-1038" aria-hidden="true" tabindex="-1"></a><span class="in">      </span></span>
<span id="cb194-1039"><a href="#cb194-1039" aria-hidden="true" tabindex="-1"></a><span class="in">      list(model = best_inner_model, auc = best_inner_auc, vars = best_inner_vars)</span></span>
<span id="cb194-1040"><a href="#cb194-1040" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb194-1041"><a href="#cb194-1041" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-1042"><a href="#cb194-1042" aria-hidden="true" tabindex="-1"></a><span class="in">    best_result &lt;- stepAUC(best_vars, outer_train_data, target_name, inner_folds)</span></span>
<span id="cb194-1043"><a href="#cb194-1043" aria-hidden="true" tabindex="-1"></a><span class="in">    best_model &lt;- best_result$model</span></span>
<span id="cb194-1044"><a href="#cb194-1044" aria-hidden="true" tabindex="-1"></a><span class="in">    best_auc &lt;- best_result$auc</span></span>
<span id="cb194-1045"><a href="#cb194-1045" aria-hidden="true" tabindex="-1"></a><span class="in">    best_vars &lt;- best_result$vars</span></span>
<span id="cb194-1046"><a href="#cb194-1046" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-1047"><a href="#cb194-1047" aria-hidden="true" tabindex="-1"></a><span class="in">    if (is.null(best_model)) {</span></span>
<span id="cb194-1048"><a href="#cb194-1048" aria-hidden="true" tabindex="-1"></a><span class="in">      cat("Error: No valid model found for outer fold ", outer_index, "\n")</span></span>
<span id="cb194-1049"><a href="#cb194-1049" aria-hidden="true" tabindex="-1"></a><span class="in">      next</span></span>
<span id="cb194-1050"><a href="#cb194-1050" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb194-1051"><a href="#cb194-1051" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-1052"><a href="#cb194-1052" aria-hidden="true" tabindex="-1"></a><span class="in">    # Evaluar el mejor modelo en el validation split del inner loop</span></span>
<span id="cb194-1053"><a href="#cb194-1053" aria-hidden="true" tabindex="-1"></a><span class="in">    inner_auc_vals &lt;- numeric()</span></span>
<span id="cb194-1054"><a href="#cb194-1054" aria-hidden="true" tabindex="-1"></a><span class="in">    for (inner_index in seq_along(inner_folds)) {</span></span>
<span id="cb194-1055"><a href="#cb194-1055" aria-hidden="true" tabindex="-1"></a><span class="in">      inner_train_data &lt;- outer_train_data[-inner_folds[[inner_index]], ]</span></span>
<span id="cb194-1056"><a href="#cb194-1056" aria-hidden="true" tabindex="-1"></a><span class="in">      inner_test_data &lt;- outer_train_data[inner_folds[[inner_index]], ]</span></span>
<span id="cb194-1057"><a href="#cb194-1057" aria-hidden="true" tabindex="-1"></a><span class="in">      </span></span>
<span id="cb194-1058"><a href="#cb194-1058" aria-hidden="true" tabindex="-1"></a><span class="in">      predictions &lt;- predict(best_model, inner_test_data, type = "raw")[,2]</span></span>
<span id="cb194-1059"><a href="#cb194-1059" aria-hidden="true" tabindex="-1"></a><span class="in">      roc_curve &lt;- roc(inner_test_data[[target_name]], predictions)</span></span>
<span id="cb194-1060"><a href="#cb194-1060" aria-hidden="true" tabindex="-1"></a><span class="in">      inner_auc_vals[inner_index] &lt;- roc_curve$auc</span></span>
<span id="cb194-1061"><a href="#cb194-1061" aria-hidden="true" tabindex="-1"></a><span class="in">      cat("Inner fold ", inner_index, " AUC: ", roc_curve$auc, "\n")</span></span>
<span id="cb194-1062"><a href="#cb194-1062" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-1063"><a href="#cb194-1063" aria-hidden="true" tabindex="-1"></a><span class="in">      pred_class &lt;- ifelse(predictions &gt; threshold, 1, 0)</span></span>
<span id="cb194-1064"><a href="#cb194-1064" aria-hidden="true" tabindex="-1"></a><span class="in">      confusion &lt;- table(Actual = inner_test_data[[target_name]], Predicted = pred_class)</span></span>
<span id="cb194-1065"><a href="#cb194-1065" aria-hidden="true" tabindex="-1"></a><span class="in">      TP &lt;- ifelse(nrow(confusion) &gt;= 2 &amp;&amp; ncol(confusion) &gt;= 2, confusion[2, 2], 0)</span></span>
<span id="cb194-1066"><a href="#cb194-1066" aria-hidden="true" tabindex="-1"></a><span class="in">      TN &lt;- ifelse(nrow(confusion) &gt;= 1 &amp;&amp; ncol(confusion) &gt;= 1, confusion[1, 1], 0)</span></span>
<span id="cb194-1067"><a href="#cb194-1067" aria-hidden="true" tabindex="-1"></a><span class="in">      FP &lt;- ifelse(nrow(confusion) &gt;= 1 &amp;&amp; ncol(confusion) &gt;= 2, confusion[1, 2], 0)</span></span>
<span id="cb194-1068"><a href="#cb194-1068" aria-hidden="true" tabindex="-1"></a><span class="in">      FN &lt;- ifelse(nrow(confusion) &gt;= 2 &amp;&amp; ncol(confusion) &gt;= 1, confusion[2, 1], 0)</span></span>
<span id="cb194-1069"><a href="#cb194-1069" aria-hidden="true" tabindex="-1"></a><span class="in">      auc &lt;- roc_curve$auc</span></span>
<span id="cb194-1070"><a href="#cb194-1070" aria-hidden="true" tabindex="-1"></a><span class="in">      </span></span>
<span id="cb194-1071"><a href="#cb194-1071" aria-hidden="true" tabindex="-1"></a><span class="in">      inner_metrics &lt;- setNames(c(outer_index, inner_index, TP, TN, FP, FN, auc), names(inner_fold_metrics))</span></span>
<span id="cb194-1072"><a href="#cb194-1072" aria-hidden="true" tabindex="-1"></a><span class="in">      inner_fold_metrics &lt;- rbind(inner_fold_metrics, as.data.frame(t(inner_metrics)))</span></span>
<span id="cb194-1073"><a href="#cb194-1073" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb194-1074"><a href="#cb194-1074" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-1075"><a href="#cb194-1075" aria-hidden="true" tabindex="-1"></a><span class="in">    best_inner_auc &lt;- mean(inner_auc_vals, na.rm = TRUE)</span></span>
<span id="cb194-1076"><a href="#cb194-1076" aria-hidden="true" tabindex="-1"></a><span class="in">    cat("Best inner AUC: ", best_inner_auc, "\n")</span></span>
<span id="cb194-1077"><a href="#cb194-1077" aria-hidden="true" tabindex="-1"></a><span class="in">    best_model &lt;- naiveBayes(as.formula(paste(target_name, "~", paste(best_vars, collapse = "+"))), data = outer_train_data)</span></span>
<span id="cb194-1078"><a href="#cb194-1078" aria-hidden="true" tabindex="-1"></a><span class="in">    predictions &lt;- predict(best_model, outer_test_data, type = "raw")[,2]</span></span>
<span id="cb194-1079"><a href="#cb194-1079" aria-hidden="true" tabindex="-1"></a><span class="in">    pred_class &lt;- ifelse(predictions &gt; threshold, 1, 0)  # Asignar clases basadas en umbral</span></span>
<span id="cb194-1080"><a href="#cb194-1080" aria-hidden="true" tabindex="-1"></a><span class="in">    confusion &lt;- table(Actual = outer_test_data[[target_name]], Predicted = pred_class)</span></span>
<span id="cb194-1081"><a href="#cb194-1081" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-1082"><a href="#cb194-1082" aria-hidden="true" tabindex="-1"></a><span class="in">    if (nrow(confusion) &lt; 2 || ncol(confusion) &lt; 2) {</span></span>
<span id="cb194-1083"><a href="#cb194-1083" aria-hidden="true" tabindex="-1"></a><span class="in">      TP &lt;- ifelse(nrow(confusion) &gt;= 2 &amp;&amp; ncol(confusion) &gt;= 2, confusion[2, 2], 0)</span></span>
<span id="cb194-1084"><a href="#cb194-1084" aria-hidden="true" tabindex="-1"></a><span class="in">      TN &lt;- ifelse(nrow(confusion) &gt;= 1 &amp;&amp; ncol(confusion) &gt;= 1, confusion[1, 1], 0)</span></span>
<span id="cb194-1085"><a href="#cb194-1085" aria-hidden="true" tabindex="-1"></a><span class="in">      FP &lt;- ifelse(nrow(confusion) &gt;= 1 &amp;&amp; ncol(confusion) &gt;= 2, confusion[1, 2], 0)</span></span>
<span id="cb194-1086"><a href="#cb194-1086" aria-hidden="true" tabindex="-1"></a><span class="in">      FN &lt;- ifelse(nrow(confusion) &gt;= 2 &amp;&amp; ncol(confusion) &gt;= 1, confusion[2, 1], 0)</span></span>
<span id="cb194-1087"><a href="#cb194-1087" aria-hidden="true" tabindex="-1"></a><span class="in">    } else {</span></span>
<span id="cb194-1088"><a href="#cb194-1088" aria-hidden="true" tabindex="-1"></a><span class="in">      TP &lt;- confusion[2, 2]</span></span>
<span id="cb194-1089"><a href="#cb194-1089" aria-hidden="true" tabindex="-1"></a><span class="in">      TN &lt;- confusion[1, 1]</span></span>
<span id="cb194-1090"><a href="#cb194-1090" aria-hidden="true" tabindex="-1"></a><span class="in">      FP &lt;- confusion[1, 2]</span></span>
<span id="cb194-1091"><a href="#cb194-1091" aria-hidden="true" tabindex="-1"></a><span class="in">      FN &lt;- confusion[2, 1]</span></span>
<span id="cb194-1092"><a href="#cb194-1092" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb194-1093"><a href="#cb194-1093" aria-hidden="true" tabindex="-1"></a><span class="in">    auc &lt;- roc(outer_test_data[[target_name]], predictions)$auc</span></span>
<span id="cb194-1094"><a href="#cb194-1094" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-1095"><a href="#cb194-1095" aria-hidden="true" tabindex="-1"></a><span class="in">    metrics &lt;- setNames(c(outer_index, TP, TN, FP, FN, auc, </span></span>
<span id="cb194-1096"><a href="#cb194-1096" aria-hidden="true" tabindex="-1"></a><span class="in">                          paste(best_vars, collapse = ",")), </span></span>
<span id="cb194-1097"><a href="#cb194-1097" aria-hidden="true" tabindex="-1"></a><span class="in">                        names(performance_metrics))</span></span>
<span id="cb194-1098"><a href="#cb194-1098" aria-hidden="true" tabindex="-1"></a><span class="in">    performance_metrics &lt;- rbind(performance_metrics, as.data.frame(t(metrics)))</span></span>
<span id="cb194-1099"><a href="#cb194-1099" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-1100"><a href="#cb194-1100" aria-hidden="true" tabindex="-1"></a><span class="in">    cat("Performance:\n", paste(performance_metrics), "\n")</span></span>
<span id="cb194-1101"><a href="#cb194-1101" aria-hidden="true" tabindex="-1"></a><span class="in">    cat(sprintf("Confusion Matrix for Fold %d:\n", outer_index))</span></span>
<span id="cb194-1102"><a href="#cb194-1102" aria-hidden="true" tabindex="-1"></a><span class="in">    print(confusion)</span></span>
<span id="cb194-1103"><a href="#cb194-1103" aria-hidden="true" tabindex="-1"></a><span class="in">    cat(sprintf("Metrics for Fold %d:\n", outer_index))</span></span>
<span id="cb194-1104"><a href="#cb194-1104" aria-hidden="true" tabindex="-1"></a><span class="in">    cat(sprintf("TP: %d, TN: %d, FP: %d, FN: %d, AUC: %f, Best Variables: %s\n",</span></span>
<span id="cb194-1105"><a href="#cb194-1105" aria-hidden="true" tabindex="-1"></a><span class="in">                TP, TN, FP, FN, auc, paste(best_vars, collapse = ",")))</span></span>
<span id="cb194-1106"><a href="#cb194-1106" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb194-1107"><a href="#cb194-1107" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb194-1108"><a href="#cb194-1108" aria-hidden="true" tabindex="-1"></a><span class="in">  list(performance_metrics = performance_metrics, inner_fold_metrics = inner_fold_metrics)</span></span>
<span id="cb194-1109"><a href="#cb194-1109" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb194-1110"><a href="#cb194-1110" aria-hidden="true" tabindex="-1"></a><span class="in">evaluate_with_seeds_NaiveBayes_Lasso &lt;- </span></span>
<span id="cb194-1111"><a href="#cb194-1111" aria-hidden="true" tabindex="-1"></a><span class="in">  function(evaluation_function, data, target_var, vars, threshold, seeds, outer, inner) {</span></span>
<span id="cb194-1112"><a href="#cb194-1112" aria-hidden="true" tabindex="-1"></a><span class="in">  results_list &lt;- list()</span></span>
<span id="cb194-1113"><a href="#cb194-1113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-1114"><a href="#cb194-1114" aria-hidden="true" tabindex="-1"></a><span class="in">  for (seed in seeds) {</span></span>
<span id="cb194-1115"><a href="#cb194-1115" aria-hidden="true" tabindex="-1"></a><span class="in">    set.seed(seed)</span></span>
<span id="cb194-1116"><a href="#cb194-1116" aria-hidden="true" tabindex="-1"></a><span class="in">    cat("Evaluating with seed:", seed, "\n")</span></span>
<span id="cb194-1117"><a href="#cb194-1117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-1118"><a href="#cb194-1118" aria-hidden="true" tabindex="-1"></a><span class="in">    results &lt;- evaluation_function(data = data, </span></span>
<span id="cb194-1119"><a href="#cb194-1119" aria-hidden="true" tabindex="-1"></a><span class="in">                                   target_name = target_var, </span></span>
<span id="cb194-1120"><a href="#cb194-1120" aria-hidden="true" tabindex="-1"></a><span class="in">                                   variables = vars, </span></span>
<span id="cb194-1121"><a href="#cb194-1121" aria-hidden="true" tabindex="-1"></a><span class="in">                                   threshold = threshold, </span></span>
<span id="cb194-1122"><a href="#cb194-1122" aria-hidden="true" tabindex="-1"></a><span class="in">                                   outer = outer, </span></span>
<span id="cb194-1123"><a href="#cb194-1123" aria-hidden="true" tabindex="-1"></a><span class="in">                                   inner = inner, </span></span>
<span id="cb194-1124"><a href="#cb194-1124" aria-hidden="true" tabindex="-1"></a><span class="in">                                   seed = seed)</span></span>
<span id="cb194-1125"><a href="#cb194-1125" aria-hidden="true" tabindex="-1"></a><span class="in">    results_list[[paste0("seed_", seed)]] &lt;- results</span></span>
<span id="cb194-1126"><a href="#cb194-1126" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb194-1127"><a href="#cb194-1127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-1128"><a href="#cb194-1128" aria-hidden="true" tabindex="-1"></a><span class="in">  return(results_list)</span></span>
<span id="cb194-1129"><a href="#cb194-1129" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb194-1130"><a href="#cb194-1130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-1131"><a href="#cb194-1131" aria-hidden="true" tabindex="-1"></a><span class="in">performance_naiveBayes_lasso &lt;- evaluate_with_seeds_NaiveBayes_Lasso(</span></span>
<span id="cb194-1132"><a href="#cb194-1132" aria-hidden="true" tabindex="-1"></a><span class="in">  evaluation_function = double_cross_validation_naiveBayes_lasso,</span></span>
<span id="cb194-1133"><a href="#cb194-1133" aria-hidden="true" tabindex="-1"></a><span class="in">  data = data_factor,</span></span>
<span id="cb194-1134"><a href="#cb194-1134" aria-hidden="true" tabindex="-1"></a><span class="in">  outer = 5,</span></span>
<span id="cb194-1135"><a href="#cb194-1135" aria-hidden="true" tabindex="-1"></a><span class="in">  inner = 2,</span></span>
<span id="cb194-1136"><a href="#cb194-1136" aria-hidden="true" tabindex="-1"></a><span class="in">  vars = todas_variables_factor,</span></span>
<span id="cb194-1137"><a href="#cb194-1137" aria-hidden="true" tabindex="-1"></a><span class="in">  target_var = "PCR",</span></span>
<span id="cb194-1138"><a href="#cb194-1138" aria-hidden="true" tabindex="-1"></a><span class="in">  threshold = .35,</span></span>
<span id="cb194-1139"><a href="#cb194-1139" aria-hidden="true" tabindex="-1"></a><span class="in">  seeds = seeds</span></span>
<span id="cb194-1140"><a href="#cb194-1140" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb194-1141"><a href="#cb194-1141" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-1142"><a href="#cb194-1142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-1143"><a href="#cb194-1143" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message=FALSE, warning=FALSE}</span></span>
<span id="cb194-1144"><a href="#cb194-1144" aria-hidden="true" tabindex="-1"></a><span class="in">load("RData_Files_Algorithms/NaiveBayes_Lasso.RData")</span></span>
<span id="cb194-1145"><a href="#cb194-1145" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-1146"><a href="#cb194-1146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-1147"><a href="#cb194-1147" aria-hidden="true" tabindex="-1"></a><span class="fu">## Adaboost</span></span>
<span id="cb194-1148"><a href="#cb194-1148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-1149"><a href="#cb194-1149" aria-hidden="true" tabindex="-1"></a><span class="fu">### Aparente</span></span>
<span id="cb194-1150"><a href="#cb194-1150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-1151"><a href="#cb194-1151" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=FALSE}</span></span>
<span id="cb194-1152"><a href="#cb194-1152" aria-hidden="true" tabindex="-1"></a><span class="in">evaluate_aparent_performance_model_adaboost &lt;- function(data, target_var, model_func, vars = NULL, iterations = 100, threshold) {</span></span>
<span id="cb194-1153"><a href="#cb194-1153" aria-hidden="true" tabindex="-1"></a><span class="in">  if (is.null(vars)) {</span></span>
<span id="cb194-1154"><a href="#cb194-1154" aria-hidden="true" tabindex="-1"></a><span class="in">    vars &lt;- setdiff(names(data), target_var)</span></span>
<span id="cb194-1155"><a href="#cb194-1155" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb194-1156"><a href="#cb194-1156" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb194-1157"><a href="#cb194-1157" aria-hidden="true" tabindex="-1"></a><span class="in">  data[[target_var]] &lt;- factor(data[[target_var]], levels = c(0, 1))</span></span>
<span id="cb194-1158"><a href="#cb194-1158" aria-hidden="true" tabindex="-1"></a><span class="in">  formula &lt;- as.formula(paste(target_var, "~", paste(vars, collapse = "+")))</span></span>
<span id="cb194-1159"><a href="#cb194-1159" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb194-1160"><a href="#cb194-1160" aria-hidden="true" tabindex="-1"></a><span class="in">  model &lt;- model_func(formula, data, iterations)</span></span>
<span id="cb194-1161"><a href="#cb194-1161" aria-hidden="true" tabindex="-1"></a><span class="in">  predictions &lt;- predict(model, newdata = data, type = "response")</span></span>
<span id="cb194-1162"><a href="#cb194-1162" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb194-1163"><a href="#cb194-1163" aria-hidden="true" tabindex="-1"></a><span class="in">  actual_classes &lt;- data[[target_var]]</span></span>
<span id="cb194-1164"><a href="#cb194-1164" aria-hidden="true" tabindex="-1"></a><span class="in">  predicted_classes &lt;- ifelse(predictions &gt; threshold, 1, 0)</span></span>
<span id="cb194-1165"><a href="#cb194-1165" aria-hidden="true" tabindex="-1"></a><span class="in">  confusion_matrix &lt;- table(Predicted = predicted_classes, Actual = actual_classes)</span></span>
<span id="cb194-1166"><a href="#cb194-1166" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb194-1167"><a href="#cb194-1167" aria-hidden="true" tabindex="-1"></a><span class="in">  tp &lt;- ifelse("1" %in% rownames(confusion_matrix) &amp;&amp; "1" %in% colnames(confusion_matrix), confusion_matrix["1", "1"], 0)</span></span>
<span id="cb194-1168"><a href="#cb194-1168" aria-hidden="true" tabindex="-1"></a><span class="in">  tn &lt;- ifelse("0" %in% rownames(confusion_matrix) &amp;&amp; "0" %in% colnames(confusion_matrix), confusion_matrix["0", "0"], 0)</span></span>
<span id="cb194-1169"><a href="#cb194-1169" aria-hidden="true" tabindex="-1"></a><span class="in">  fp &lt;- ifelse("1" %in% rownames(confusion_matrix) &amp;&amp; "0" %in% colnames(confusion_matrix), confusion_matrix["1", "0"], 0)</span></span>
<span id="cb194-1170"><a href="#cb194-1170" aria-hidden="true" tabindex="-1"></a><span class="in">  fn &lt;- ifelse("0" %in% rownames(confusion_matrix) &amp;&amp; "1" %in% colnames(confusion_matrix), confusion_matrix["0", "1"], 0)</span></span>
<span id="cb194-1171"><a href="#cb194-1171" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb194-1172"><a href="#cb194-1172" aria-hidden="true" tabindex="-1"></a><span class="in">  accuracy &lt;- (tp + tn) / (tp + tn + fp + fn)</span></span>
<span id="cb194-1173"><a href="#cb194-1173" aria-hidden="true" tabindex="-1"></a><span class="in">  precision &lt;- ifelse(tp + fp &gt; 0, tp / (tp + fp), 0)</span></span>
<span id="cb194-1174"><a href="#cb194-1174" aria-hidden="true" tabindex="-1"></a><span class="in">  recall &lt;- ifelse(tp + fn &gt; 0, tp / (tp + fn), 0)</span></span>
<span id="cb194-1175"><a href="#cb194-1175" aria-hidden="true" tabindex="-1"></a><span class="in">  f1_score &lt;- ifelse(precision + recall &gt; 0, 2 * (precision * recall) / (precision + recall), 0)</span></span>
<span id="cb194-1176"><a href="#cb194-1176" aria-hidden="true" tabindex="-1"></a><span class="in">  roc_obj &lt;- pROC::roc(actual_classes, predictions)</span></span>
<span id="cb194-1177"><a href="#cb194-1177" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb194-1178"><a href="#cb194-1178" aria-hidden="true" tabindex="-1"></a><span class="in">  list(confusion_matrix = confusion_matrix, accuracy = accuracy, precision = precision, </span></span>
<span id="cb194-1179"><a href="#cb194-1179" aria-hidden="true" tabindex="-1"></a><span class="in">       recall = recall, f1_score = f1_score, roc_curve = roc_obj)</span></span>
<span id="cb194-1180"><a href="#cb194-1180" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb194-1181"><a href="#cb194-1181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-1182"><a href="#cb194-1182" aria-hidden="true" tabindex="-1"></a><span class="in">adaboost_model &lt;- function(formula, data, iterations) {</span></span>
<span id="cb194-1183"><a href="#cb194-1183" aria-hidden="true" tabindex="-1"></a><span class="in">  model &lt;- glmboost(formula, data = data, family = Binomial(), control = boost_control(mstop = iterations))</span></span>
<span id="cb194-1184"><a href="#cb194-1184" aria-hidden="true" tabindex="-1"></a><span class="in">  model</span></span>
<span id="cb194-1185"><a href="#cb194-1185" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb194-1186"><a href="#cb194-1186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-1187"><a href="#cb194-1187" aria-hidden="true" tabindex="-1"></a><span class="in">resultadosAparentesAdaBoost &lt;- evaluate_aparent_performance_model_adaboost(data = data_numeric, target_var = "PCR",</span></span>
<span id="cb194-1188"><a href="#cb194-1188" aria-hidden="true" tabindex="-1"></a><span class="in">                                                                           model_func = adaboost_model,</span></span>
<span id="cb194-1189"><a href="#cb194-1189" aria-hidden="true" tabindex="-1"></a><span class="in">                                                                           vars = ".",</span></span>
<span id="cb194-1190"><a href="#cb194-1190" aria-hidden="true" tabindex="-1"></a><span class="in">                                                                           iterations = 100,</span></span>
<span id="cb194-1191"><a href="#cb194-1191" aria-hidden="true" tabindex="-1"></a><span class="in">                                                                           threshold = 0.35)</span></span>
<span id="cb194-1192"><a href="#cb194-1192" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-1193"><a href="#cb194-1193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-1194"><a href="#cb194-1194" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message=FALSE, warning=FALSE}</span></span>
<span id="cb194-1195"><a href="#cb194-1195" aria-hidden="true" tabindex="-1"></a><span class="in">load("RData_Files_Algorithms/AdaBoost_Aparente.RData")</span></span>
<span id="cb194-1196"><a href="#cb194-1196" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-1197"><a href="#cb194-1197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-1198"><a href="#cb194-1198" aria-hidden="true" tabindex="-1"></a><span class="fu">### Todas las Variables</span></span>
<span id="cb194-1199"><a href="#cb194-1199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-1200"><a href="#cb194-1200" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=FALSE}</span></span>
<span id="cb194-1201"><a href="#cb194-1201" aria-hidden="true" tabindex="-1"></a><span class="in">double_cross_validation_adaboost &lt;- function(data, target_name, outer, inner, iterations, variables, threshold, seed) {</span></span>
<span id="cb194-1202"><a href="#cb194-1202" aria-hidden="true" tabindex="-1"></a><span class="in">  set.seed(seed)</span></span>
<span id="cb194-1203"><a href="#cb194-1203" aria-hidden="true" tabindex="-1"></a><span class="in">  performance_metrics &lt;- data.frame(Fold = integer(), TP = integer(), TN = integer(),</span></span>
<span id="cb194-1204"><a href="#cb194-1204" aria-hidden="true" tabindex="-1"></a><span class="in">                                    FP = integer(), FN = integer(), AUC = numeric(), </span></span>
<span id="cb194-1205"><a href="#cb194-1205" aria-hidden="true" tabindex="-1"></a><span class="in">                                    Best_Iteration = integer(), stringsAsFactors = FALSE)</span></span>
<span id="cb194-1206"><a href="#cb194-1206" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb194-1207"><a href="#cb194-1207" aria-hidden="true" tabindex="-1"></a><span class="in">  data[[target_name]] &lt;- as.factor(data[[target_name]])</span></span>
<span id="cb194-1208"><a href="#cb194-1208" aria-hidden="true" tabindex="-1"></a><span class="in">  outer_folds &lt;- createFolds(data[[target_name]], k = outer, list = TRUE, returnTrain = FALSE)</span></span>
<span id="cb194-1209"><a href="#cb194-1209" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb194-1210"><a href="#cb194-1210" aria-hidden="true" tabindex="-1"></a><span class="in">  for (outer_index in seq_along(outer_folds)) {</span></span>
<span id="cb194-1211"><a href="#cb194-1211" aria-hidden="true" tabindex="-1"></a><span class="in">    outer_train_data &lt;- data[-outer_folds[[outer_index]], ]</span></span>
<span id="cb194-1212"><a href="#cb194-1212" aria-hidden="true" tabindex="-1"></a><span class="in">    outer_test_data &lt;- data[outer_folds[[outer_index]], ]</span></span>
<span id="cb194-1213"><a href="#cb194-1213" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-1214"><a href="#cb194-1214" aria-hidden="true" tabindex="-1"></a><span class="in">    cat(sprintf("Outer Fold %d\n", outer_index))</span></span>
<span id="cb194-1215"><a href="#cb194-1215" aria-hidden="true" tabindex="-1"></a><span class="in">    cat("Training Data - Class 0: ", sum(outer_train_data[[target_name]] == "0"), "\n")</span></span>
<span id="cb194-1216"><a href="#cb194-1216" aria-hidden="true" tabindex="-1"></a><span class="in">    cat("Training Data - Class 1: ", sum(outer_train_data[[target_name]] == "1"), "\n")</span></span>
<span id="cb194-1217"><a href="#cb194-1217" aria-hidden="true" tabindex="-1"></a><span class="in">    cat("Testing Data - Class 0: ", sum(outer_test_data[[target_name]] == "0"), "\n")</span></span>
<span id="cb194-1218"><a href="#cb194-1218" aria-hidden="true" tabindex="-1"></a><span class="in">    cat("Testing Data - Class 1: ", sum(outer_test_data[[target_name]] == "1"), "\n")</span></span>
<span id="cb194-1219"><a href="#cb194-1219" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-1220"><a href="#cb194-1220" aria-hidden="true" tabindex="-1"></a><span class="in">    if (sum(outer_train_data[[target_name]] == "0") == 0 || sum(outer_train_data[[target_name]] == "1") == 0) {</span></span>
<span id="cb194-1221"><a href="#cb194-1221" aria-hidden="true" tabindex="-1"></a><span class="in">      cat("Skipping outer fold due to lack of class diversity\n")</span></span>
<span id="cb194-1222"><a href="#cb194-1222" aria-hidden="true" tabindex="-1"></a><span class="in">      next</span></span>
<span id="cb194-1223"><a href="#cb194-1223" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb194-1224"><a href="#cb194-1224" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-1225"><a href="#cb194-1225" aria-hidden="true" tabindex="-1"></a><span class="in">    inner_folds &lt;- createFolds(outer_train_data[[target_name]], k = inner, list = TRUE, returnTrain = FALSE)</span></span>
<span id="cb194-1226"><a href="#cb194-1226" aria-hidden="true" tabindex="-1"></a><span class="in">    best_model &lt;- NULL</span></span>
<span id="cb194-1227"><a href="#cb194-1227" aria-hidden="true" tabindex="-1"></a><span class="in">    best_auc &lt;- 0</span></span>
<span id="cb194-1228"><a href="#cb194-1228" aria-hidden="true" tabindex="-1"></a><span class="in">    best_iteration &lt;- NULL</span></span>
<span id="cb194-1229"><a href="#cb194-1229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-1230"><a href="#cb194-1230" aria-hidden="true" tabindex="-1"></a><span class="in">    grid &lt;- expand.grid(iteration = iterations)</span></span>
<span id="cb194-1231"><a href="#cb194-1231" aria-hidden="true" tabindex="-1"></a><span class="in">    formula &lt;- reformulate(variables, target_name)</span></span>
<span id="cb194-1232"><a href="#cb194-1232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-1233"><a href="#cb194-1233" aria-hidden="true" tabindex="-1"></a><span class="in">    for (params in 1:nrow(grid)) {</span></span>
<span id="cb194-1234"><a href="#cb194-1234" aria-hidden="true" tabindex="-1"></a><span class="in">      inner_auc &lt;- numeric()</span></span>
<span id="cb194-1235"><a href="#cb194-1235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-1236"><a href="#cb194-1236" aria-hidden="true" tabindex="-1"></a><span class="in">      for (inner_index in seq_along(inner_folds)) {</span></span>
<span id="cb194-1237"><a href="#cb194-1237" aria-hidden="true" tabindex="-1"></a><span class="in">        inner_train_data &lt;- outer_train_data[-inner_folds[[inner_index]], ]</span></span>
<span id="cb194-1238"><a href="#cb194-1238" aria-hidden="true" tabindex="-1"></a><span class="in">        inner_test_data &lt;- outer_train_data[inner_folds[[inner_index]], ]</span></span>
<span id="cb194-1239"><a href="#cb194-1239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-1240"><a href="#cb194-1240" aria-hidden="true" tabindex="-1"></a><span class="in">        if (sum(inner_train_data[[target_name]] == "0") == 0 || sum(inner_train_data[[target_name]] == "1") == 0) {</span></span>
<span id="cb194-1241"><a href="#cb194-1241" aria-hidden="true" tabindex="-1"></a><span class="in">          cat("Skipping inner fold due to lack of class diversity\n")</span></span>
<span id="cb194-1242"><a href="#cb194-1242" aria-hidden="true" tabindex="-1"></a><span class="in">          next</span></span>
<span id="cb194-1243"><a href="#cb194-1243" aria-hidden="true" tabindex="-1"></a><span class="in">        }</span></span>
<span id="cb194-1244"><a href="#cb194-1244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-1245"><a href="#cb194-1245" aria-hidden="true" tabindex="-1"></a><span class="in">        result &lt;- tryCatch({</span></span>
<span id="cb194-1246"><a href="#cb194-1246" aria-hidden="true" tabindex="-1"></a><span class="in">          model &lt;- blackboost(formula, data = inner_train_data, family = Binomial(), control = boost_control(mstop = grid$iteration[params]))</span></span>
<span id="cb194-1247"><a href="#cb194-1247" aria-hidden="true" tabindex="-1"></a><span class="in">          </span></span>
<span id="cb194-1248"><a href="#cb194-1248" aria-hidden="true" tabindex="-1"></a><span class="in">          predictions &lt;- predict(model, inner_test_data, type = "response")</span></span>
<span id="cb194-1249"><a href="#cb194-1249" aria-hidden="true" tabindex="-1"></a><span class="in">          roc_curve &lt;- roc(inner_test_data[[target_name]], predictions)</span></span>
<span id="cb194-1250"><a href="#cb194-1250" aria-hidden="true" tabindex="-1"></a><span class="in">          inner_auc[inner_index] &lt;- roc_curve$auc</span></span>
<span id="cb194-1251"><a href="#cb194-1251" aria-hidden="true" tabindex="-1"></a><span class="in">        }, error = function(e) {</span></span>
<span id="cb194-1252"><a href="#cb194-1252" aria-hidden="true" tabindex="-1"></a><span class="in">          cat("Error with parameters: iteration =", grid$iteration[params], "\n")</span></span>
<span id="cb194-1253"><a href="#cb194-1253" aria-hidden="true" tabindex="-1"></a><span class="in">          cat("Error message: ", e$message, "\n")</span></span>
<span id="cb194-1254"><a href="#cb194-1254" aria-hidden="true" tabindex="-1"></a><span class="in">          inner_auc[inner_index] &lt;- 0</span></span>
<span id="cb194-1255"><a href="#cb194-1255" aria-hidden="true" tabindex="-1"></a><span class="in">        })</span></span>
<span id="cb194-1256"><a href="#cb194-1256" aria-hidden="true" tabindex="-1"></a><span class="in">      }</span></span>
<span id="cb194-1257"><a href="#cb194-1257" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-1258"><a href="#cb194-1258" aria-hidden="true" tabindex="-1"></a><span class="in">      if (mean(inner_auc, na.rm = TRUE) &gt; best_auc) {</span></span>
<span id="cb194-1259"><a href="#cb194-1259" aria-hidden="true" tabindex="-1"></a><span class="in">        best_auc &lt;- mean(inner_auc, na.rm = TRUE)</span></span>
<span id="cb194-1260"><a href="#cb194-1260" aria-hidden="true" tabindex="-1"></a><span class="in">        best_model &lt;- model</span></span>
<span id="cb194-1261"><a href="#cb194-1261" aria-hidden="true" tabindex="-1"></a><span class="in">        best_iteration &lt;- grid$iteration[params]</span></span>
<span id="cb194-1262"><a href="#cb194-1262" aria-hidden="true" tabindex="-1"></a><span class="in">      }</span></span>
<span id="cb194-1263"><a href="#cb194-1263" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb194-1264"><a href="#cb194-1264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-1265"><a href="#cb194-1265" aria-hidden="true" tabindex="-1"></a><span class="in">    if (is.null(best_model)) {</span></span>
<span id="cb194-1266"><a href="#cb194-1266" aria-hidden="true" tabindex="-1"></a><span class="in">      cat("No valid model found for outer fold ", outer_index, "\n")</span></span>
<span id="cb194-1267"><a href="#cb194-1267" aria-hidden="true" tabindex="-1"></a><span class="in">      next</span></span>
<span id="cb194-1268"><a href="#cb194-1268" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb194-1269"><a href="#cb194-1269" aria-hidden="true" tabindex="-1"></a><span class="in">    # Reentrenar el mejor modelo con todos los datos de outer_train_data</span></span>
<span id="cb194-1270"><a href="#cb194-1270" aria-hidden="true" tabindex="-1"></a><span class="in">    best_model &lt;- blackboost(formula, data = outer_train_data, family = Binomial(), control = boost_control(mstop = best_iteration))</span></span>
<span id="cb194-1271"><a href="#cb194-1271" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-1272"><a href="#cb194-1272" aria-hidden="true" tabindex="-1"></a><span class="in">    predictions &lt;- predict(best_model, outer_test_data, type = "response")</span></span>
<span id="cb194-1273"><a href="#cb194-1273" aria-hidden="true" tabindex="-1"></a><span class="in">    pred_class &lt;- ifelse(predictions &gt; threshold, "1", "0")</span></span>
<span id="cb194-1274"><a href="#cb194-1274" aria-hidden="true" tabindex="-1"></a><span class="in">    confusion &lt;- table(Actual = outer_test_data[[target_name]], Predicted = pred_class)</span></span>
<span id="cb194-1275"><a href="#cb194-1275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-1276"><a href="#cb194-1276" aria-hidden="true" tabindex="-1"></a><span class="in">    if (nrow(confusion) &lt; 2 || ncol(confusion) &lt; 2) {</span></span>
<span id="cb194-1277"><a href="#cb194-1277" aria-hidden="true" tabindex="-1"></a><span class="in">      TP &lt;- ifelse(nrow(confusion) &gt;= 2 &amp;&amp; ncol(confusion) &gt;= 2, confusion[2, 2], 0)</span></span>
<span id="cb194-1278"><a href="#cb194-1278" aria-hidden="true" tabindex="-1"></a><span class="in">      TN &lt;- ifelse(nrow(confusion) &gt;= 1 &amp;&amp; ncol(confusion) &gt;= 1, confusion[1, 1], 0)</span></span>
<span id="cb194-1279"><a href="#cb194-1279" aria-hidden="true" tabindex="-1"></a><span class="in">      FP &lt;- ifelse(nrow(confusion) &gt;= 1 &amp;&amp; ncol(confusion) &gt;= 2, confusion[1, 2], 0)</span></span>
<span id="cb194-1280"><a href="#cb194-1280" aria-hidden="true" tabindex="-1"></a><span class="in">      FN &lt;- ifelse(nrow(confusion) &gt;= 2 &amp;&amp; ncol(confusion) &gt;= 1, confusion[2, 1], 0)</span></span>
<span id="cb194-1281"><a href="#cb194-1281" aria-hidden="true" tabindex="-1"></a><span class="in">    } else {</span></span>
<span id="cb194-1282"><a href="#cb194-1282" aria-hidden="true" tabindex="-1"></a><span class="in">      TP &lt;- confusion[2, 2]</span></span>
<span id="cb194-1283"><a href="#cb194-1283" aria-hidden="true" tabindex="-1"></a><span class="in">      TN &lt;- confusion[1, 1]</span></span>
<span id="cb194-1284"><a href="#cb194-1284" aria-hidden="true" tabindex="-1"></a><span class="in">      FP &lt;- confusion[1, 2]</span></span>
<span id="cb194-1285"><a href="#cb194-1285" aria-hidden="true" tabindex="-1"></a><span class="in">      FN &lt;- confusion[2, 1]</span></span>
<span id="cb194-1286"><a href="#cb194-1286" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb194-1287"><a href="#cb194-1287" aria-hidden="true" tabindex="-1"></a><span class="in">    auc &lt;- roc(outer_test_data[[target_name]], predictions)$auc</span></span>
<span id="cb194-1288"><a href="#cb194-1288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-1289"><a href="#cb194-1289" aria-hidden="true" tabindex="-1"></a><span class="in">    metrics &lt;- setNames(c(outer_index, TP, TN, FP, FN, auc, best_iteration), names(performance_metrics))</span></span>
<span id="cb194-1290"><a href="#cb194-1290" aria-hidden="true" tabindex="-1"></a><span class="in">    performance_metrics &lt;- rbind(performance_metrics, as.data.frame(t(metrics)))</span></span>
<span id="cb194-1291"><a href="#cb194-1291" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb194-1292"><a href="#cb194-1292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-1293"><a href="#cb194-1293" aria-hidden="true" tabindex="-1"></a><span class="in">  return(performance_metrics)</span></span>
<span id="cb194-1294"><a href="#cb194-1294" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb194-1295"><a href="#cb194-1295" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-1296"><a href="#cb194-1296" aria-hidden="true" tabindex="-1"></a><span class="in">evaluate_with_seeds_AdaBoost_Asociacion_Todas &lt;- </span></span>
<span id="cb194-1297"><a href="#cb194-1297" aria-hidden="true" tabindex="-1"></a><span class="in">  function(evaluation_function, data, target_var, vars, threshold, seeds, outer, inner, iterations) {</span></span>
<span id="cb194-1298"><a href="#cb194-1298" aria-hidden="true" tabindex="-1"></a><span class="in">  results_list &lt;- list()</span></span>
<span id="cb194-1299"><a href="#cb194-1299" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-1300"><a href="#cb194-1300" aria-hidden="true" tabindex="-1"></a><span class="in">  for (seed in seeds) {</span></span>
<span id="cb194-1301"><a href="#cb194-1301" aria-hidden="true" tabindex="-1"></a><span class="in">    set.seed(seed)</span></span>
<span id="cb194-1302"><a href="#cb194-1302" aria-hidden="true" tabindex="-1"></a><span class="in">    cat("Evaluating with seed:", seed, "\n")</span></span>
<span id="cb194-1303"><a href="#cb194-1303" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-1304"><a href="#cb194-1304" aria-hidden="true" tabindex="-1"></a><span class="in">    results &lt;- evaluation_function(data = data, </span></span>
<span id="cb194-1305"><a href="#cb194-1305" aria-hidden="true" tabindex="-1"></a><span class="in">                                   target_name = target_var, </span></span>
<span id="cb194-1306"><a href="#cb194-1306" aria-hidden="true" tabindex="-1"></a><span class="in">                                   variables = vars, </span></span>
<span id="cb194-1307"><a href="#cb194-1307" aria-hidden="true" tabindex="-1"></a><span class="in">                                   threshold = threshold, </span></span>
<span id="cb194-1308"><a href="#cb194-1308" aria-hidden="true" tabindex="-1"></a><span class="in">                                   outer = outer, </span></span>
<span id="cb194-1309"><a href="#cb194-1309" aria-hidden="true" tabindex="-1"></a><span class="in">                                   inner = inner,</span></span>
<span id="cb194-1310"><a href="#cb194-1310" aria-hidden="true" tabindex="-1"></a><span class="in">                                   iterations, </span></span>
<span id="cb194-1311"><a href="#cb194-1311" aria-hidden="true" tabindex="-1"></a><span class="in">                                   seed = seed)</span></span>
<span id="cb194-1312"><a href="#cb194-1312" aria-hidden="true" tabindex="-1"></a><span class="in">    results_list[[paste0("seed_", seed)]] &lt;- results</span></span>
<span id="cb194-1313"><a href="#cb194-1313" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb194-1314"><a href="#cb194-1314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-1315"><a href="#cb194-1315" aria-hidden="true" tabindex="-1"></a><span class="in">  return(results_list)</span></span>
<span id="cb194-1316"><a href="#cb194-1316" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb194-1317"><a href="#cb194-1317" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-1318"><a href="#cb194-1318" aria-hidden="true" tabindex="-1"></a><span class="in">performance_adaboost_todasvariables &lt;- evaluate_with_seeds_AdaBoost_Asociacion_Todas(</span></span>
<span id="cb194-1319"><a href="#cb194-1319" aria-hidden="true" tabindex="-1"></a><span class="in">  evaluation_function = double_cross_validation_adaboost,</span></span>
<span id="cb194-1320"><a href="#cb194-1320" aria-hidden="true" tabindex="-1"></a><span class="in">  data = data_factor,</span></span>
<span id="cb194-1321"><a href="#cb194-1321" aria-hidden="true" tabindex="-1"></a><span class="in">  outer = 5,</span></span>
<span id="cb194-1322"><a href="#cb194-1322" aria-hidden="true" tabindex="-1"></a><span class="in">  inner = 2,</span></span>
<span id="cb194-1323"><a href="#cb194-1323" aria-hidden="true" tabindex="-1"></a><span class="in">  target_var = "PCR",</span></span>
<span id="cb194-1324"><a href="#cb194-1324" aria-hidden="true" tabindex="-1"></a><span class="in">  vars = todas_variables_factor,</span></span>
<span id="cb194-1325"><a href="#cb194-1325" aria-hidden="true" tabindex="-1"></a><span class="in">  threshold = .35,</span></span>
<span id="cb194-1326"><a href="#cb194-1326" aria-hidden="true" tabindex="-1"></a><span class="in">  seeds = seeds,</span></span>
<span id="cb194-1327"><a href="#cb194-1327" aria-hidden="true" tabindex="-1"></a><span class="in">  iterations = c(50, 100, 150, 200)</span></span>
<span id="cb194-1328"><a href="#cb194-1328" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb194-1329"><a href="#cb194-1329" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-1330"><a href="#cb194-1330" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-1331"><a href="#cb194-1331" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-1332"><a href="#cb194-1332" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-1333"><a href="#cb194-1333" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message=FALSE, warning=FALSE}</span></span>
<span id="cb194-1334"><a href="#cb194-1334" aria-hidden="true" tabindex="-1"></a><span class="in">load("RData_Files_Algorithms/AdaBoost_TodasVariables.RData")</span></span>
<span id="cb194-1335"><a href="#cb194-1335" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-1336"><a href="#cb194-1336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-1337"><a href="#cb194-1337" aria-hidden="true" tabindex="-1"></a><span class="fu">### Filtrado (Asociación)</span></span>
<span id="cb194-1338"><a href="#cb194-1338" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-1339"><a href="#cb194-1339" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=FALSE}</span></span>
<span id="cb194-1340"><a href="#cb194-1340" aria-hidden="true" tabindex="-1"></a><span class="in">performance_adaboost_Asociacion &lt;- evaluate_with_seeds_AdaBoost_Asociacion_Todas(</span></span>
<span id="cb194-1341"><a href="#cb194-1341" aria-hidden="true" tabindex="-1"></a><span class="in">  evaluation_function = double_cross_validation_adaboost,</span></span>
<span id="cb194-1342"><a href="#cb194-1342" aria-hidden="true" tabindex="-1"></a><span class="in">  data = data_factor,</span></span>
<span id="cb194-1343"><a href="#cb194-1343" aria-hidden="true" tabindex="-1"></a><span class="in">  outer = 5,</span></span>
<span id="cb194-1344"><a href="#cb194-1344" aria-hidden="true" tabindex="-1"></a><span class="in">  inner = 2,</span></span>
<span id="cb194-1345"><a href="#cb194-1345" aria-hidden="true" tabindex="-1"></a><span class="in">  target_var = "PCR",</span></span>
<span id="cb194-1346"><a href="#cb194-1346" aria-hidden="true" tabindex="-1"></a><span class="in">  vars = asociacion,</span></span>
<span id="cb194-1347"><a href="#cb194-1347" aria-hidden="true" tabindex="-1"></a><span class="in">  threshold = .35,</span></span>
<span id="cb194-1348"><a href="#cb194-1348" aria-hidden="true" tabindex="-1"></a><span class="in">  seeds = seeds,</span></span>
<span id="cb194-1349"><a href="#cb194-1349" aria-hidden="true" tabindex="-1"></a><span class="in">  iterations = c(50, 100, 150, 200)</span></span>
<span id="cb194-1350"><a href="#cb194-1350" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb194-1351"><a href="#cb194-1351" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-1352"><a href="#cb194-1352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-1353"><a href="#cb194-1353" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message=FALSE, warning=FALSE}</span></span>
<span id="cb194-1354"><a href="#cb194-1354" aria-hidden="true" tabindex="-1"></a><span class="in">load("RData_Files_Algorithms/AdaBoost_Asociacion.RData")</span></span>
<span id="cb194-1355"><a href="#cb194-1355" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-1356"><a href="#cb194-1356" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-1357"><a href="#cb194-1357" aria-hidden="true" tabindex="-1"></a><span class="fu">### Wrapped (StepAUC)</span></span>
<span id="cb194-1358"><a href="#cb194-1358" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-1359"><a href="#cb194-1359" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=FALSE}</span></span>
<span id="cb194-1360"><a href="#cb194-1360" aria-hidden="true" tabindex="-1"></a><span class="in">double_cross_validation_adaboost_stepAUC &lt;- function(data, target_name, outer, inner, iterations, variables, threshold, seed) {</span></span>
<span id="cb194-1361"><a href="#cb194-1361" aria-hidden="true" tabindex="-1"></a><span class="in">  set.seed(seed)</span></span>
<span id="cb194-1362"><a href="#cb194-1362" aria-hidden="true" tabindex="-1"></a><span class="in">  performance_metrics &lt;- data.frame(Fold = integer(), TP = integer(), TN = integer(),</span></span>
<span id="cb194-1363"><a href="#cb194-1363" aria-hidden="true" tabindex="-1"></a><span class="in">                                    FP = integer(), FN = integer(), AUC = numeric(),</span></span>
<span id="cb194-1364"><a href="#cb194-1364" aria-hidden="true" tabindex="-1"></a><span class="in">                                    Best_Iterations = integer(), Best_Variables = character(), stringsAsFactors = FALSE)</span></span>
<span id="cb194-1365"><a href="#cb194-1365" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb194-1366"><a href="#cb194-1366" aria-hidden="true" tabindex="-1"></a><span class="in">  inner_fold_metrics &lt;- data.frame(Fold = integer(), Inner_Fold = integer(), </span></span>
<span id="cb194-1367"><a href="#cb194-1367" aria-hidden="true" tabindex="-1"></a><span class="in">                                   TP = integer(), TN = integer(), FP = integer(), </span></span>
<span id="cb194-1368"><a href="#cb194-1368" aria-hidden="true" tabindex="-1"></a><span class="in">                                   FN = integer(), AUC = numeric(), stringsAsFactors = FALSE)</span></span>
<span id="cb194-1369"><a href="#cb194-1369" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb194-1370"><a href="#cb194-1370" aria-hidden="true" tabindex="-1"></a><span class="in">  data[[target_name]] &lt;- as.factor(data[[target_name]])</span></span>
<span id="cb194-1371"><a href="#cb194-1371" aria-hidden="true" tabindex="-1"></a><span class="in">  outer_folds &lt;- createFolds(data[[target_name]], k = outer, list = TRUE, returnTrain = FALSE)</span></span>
<span id="cb194-1372"><a href="#cb194-1372" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb194-1373"><a href="#cb194-1373" aria-hidden="true" tabindex="-1"></a><span class="in">  for (outer_index in seq_along(outer_folds)) {</span></span>
<span id="cb194-1374"><a href="#cb194-1374" aria-hidden="true" tabindex="-1"></a><span class="in">    outer_train_data &lt;- data[-outer_folds[[outer_index]], ]</span></span>
<span id="cb194-1375"><a href="#cb194-1375" aria-hidden="true" tabindex="-1"></a><span class="in">    outer_test_data &lt;- data[outer_folds[[outer_index]], ]</span></span>
<span id="cb194-1376"><a href="#cb194-1376" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-1377"><a href="#cb194-1377" aria-hidden="true" tabindex="-1"></a><span class="in">    cat(sprintf("Outer Fold %d\n", outer_index))</span></span>
<span id="cb194-1378"><a href="#cb194-1378" aria-hidden="true" tabindex="-1"></a><span class="in">    cat("Training Data - Class 0: ", sum(outer_train_data[[target_name]] == "0"), "\n")</span></span>
<span id="cb194-1379"><a href="#cb194-1379" aria-hidden="true" tabindex="-1"></a><span class="in">    cat("Training Data - Class 1: ", sum(outer_train_data[[target_name]] == "1"), "\n")</span></span>
<span id="cb194-1380"><a href="#cb194-1380" aria-hidden="true" tabindex="-1"></a><span class="in">    cat("Testing Data - Class 0: ", sum(outer_test_data[[target_name]] == "0"), "\n")</span></span>
<span id="cb194-1381"><a href="#cb194-1381" aria-hidden="true" tabindex="-1"></a><span class="in">    cat("Testing Data - Class 1: ", sum(outer_test_data[[target_name]] == "1"), "\n")</span></span>
<span id="cb194-1382"><a href="#cb194-1382" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-1383"><a href="#cb194-1383" aria-hidden="true" tabindex="-1"></a><span class="in">    inner_folds &lt;- createFolds(outer_train_data[[target_name]], k = inner, list = TRUE, returnTrain = FALSE)</span></span>
<span id="cb194-1384"><a href="#cb194-1384" aria-hidden="true" tabindex="-1"></a><span class="in">    best_model &lt;- NULL</span></span>
<span id="cb194-1385"><a href="#cb194-1385" aria-hidden="true" tabindex="-1"></a><span class="in">    best_auc &lt;- 0</span></span>
<span id="cb194-1386"><a href="#cb194-1386" aria-hidden="true" tabindex="-1"></a><span class="in">    best_iterations &lt;- NULL</span></span>
<span id="cb194-1387"><a href="#cb194-1387" aria-hidden="true" tabindex="-1"></a><span class="in">    best_vars &lt;- variables</span></span>
<span id="cb194-1388"><a href="#cb194-1388" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-1389"><a href="#cb194-1389" aria-hidden="true" tabindex="-1"></a><span class="in">    stepAUC &lt;- function(vars, outer_train_data, target_name, iterations, inner_folds) {</span></span>
<span id="cb194-1390"><a href="#cb194-1390" aria-hidden="true" tabindex="-1"></a><span class="in">      current_vars &lt;- vars</span></span>
<span id="cb194-1391"><a href="#cb194-1391" aria-hidden="true" tabindex="-1"></a><span class="in">      best_inner_auc &lt;- 0</span></span>
<span id="cb194-1392"><a href="#cb194-1392" aria-hidden="true" tabindex="-1"></a><span class="in">      best_inner_model &lt;- NULL</span></span>
<span id="cb194-1393"><a href="#cb194-1393" aria-hidden="true" tabindex="-1"></a><span class="in">      best_inner_iterations &lt;- NULL</span></span>
<span id="cb194-1394"><a href="#cb194-1394" aria-hidden="true" tabindex="-1"></a><span class="in">      best_inner_vars &lt;- current_vars</span></span>
<span id="cb194-1395"><a href="#cb194-1395" aria-hidden="true" tabindex="-1"></a><span class="in">      improved &lt;- TRUE</span></span>
<span id="cb194-1396"><a href="#cb194-1396" aria-hidden="true" tabindex="-1"></a><span class="in">      </span></span>
<span id="cb194-1397"><a href="#cb194-1397" aria-hidden="true" tabindex="-1"></a><span class="in">      while (improved &amp;&amp; length(current_vars) &gt; 1) {</span></span>
<span id="cb194-1398"><a href="#cb194-1398" aria-hidden="true" tabindex="-1"></a><span class="in">        improved &lt;- FALSE</span></span>
<span id="cb194-1399"><a href="#cb194-1399" aria-hidden="true" tabindex="-1"></a><span class="in">        best_auc_in_step &lt;- best_inner_auc</span></span>
<span id="cb194-1400"><a href="#cb194-1400" aria-hidden="true" tabindex="-1"></a><span class="in">        </span></span>
<span id="cb194-1401"><a href="#cb194-1401" aria-hidden="true" tabindex="-1"></a><span class="in">        for (var in current_vars) {</span></span>
<span id="cb194-1402"><a href="#cb194-1402" aria-hidden="true" tabindex="-1"></a><span class="in">          temp_vars &lt;- setdiff(current_vars, var)</span></span>
<span id="cb194-1403"><a href="#cb194-1403" aria-hidden="true" tabindex="-1"></a><span class="in">          inner_auc &lt;- numeric()</span></span>
<span id="cb194-1404"><a href="#cb194-1404" aria-hidden="true" tabindex="-1"></a><span class="in">          </span></span>
<span id="cb194-1405"><a href="#cb194-1405" aria-hidden="true" tabindex="-1"></a><span class="in">          for (iter in iterations) {</span></span>
<span id="cb194-1406"><a href="#cb194-1406" aria-hidden="true" tabindex="-1"></a><span class="in">            auc_vals &lt;- numeric()</span></span>
<span id="cb194-1407"><a href="#cb194-1407" aria-hidden="true" tabindex="-1"></a><span class="in">            </span></span>
<span id="cb194-1408"><a href="#cb194-1408" aria-hidden="true" tabindex="-1"></a><span class="in">            for (inner_index in seq_along(inner_folds)) {</span></span>
<span id="cb194-1409"><a href="#cb194-1409" aria-hidden="true" tabindex="-1"></a><span class="in">              inner_train_data &lt;- outer_train_data[-inner_folds[[inner_index]], ]</span></span>
<span id="cb194-1410"><a href="#cb194-1410" aria-hidden="true" tabindex="-1"></a><span class="in">              inner_test_data &lt;- outer_train_data[inner_folds[[inner_index]], ]</span></span>
<span id="cb194-1411"><a href="#cb194-1411" aria-hidden="true" tabindex="-1"></a><span class="in">              </span></span>
<span id="cb194-1412"><a href="#cb194-1412" aria-hidden="true" tabindex="-1"></a><span class="in">              result &lt;- tryCatch({</span></span>
<span id="cb194-1413"><a href="#cb194-1413" aria-hidden="true" tabindex="-1"></a><span class="in">                model &lt;- glmboost(as.formula(paste(target_name, "~", paste(temp_vars, collapse = "+"))),</span></span>
<span id="cb194-1414"><a href="#cb194-1414" aria-hidden="true" tabindex="-1"></a><span class="in">                                  data = inner_train_data, family = Binomial(),</span></span>
<span id="cb194-1415"><a href="#cb194-1415" aria-hidden="true" tabindex="-1"></a><span class="in">                                  control = boost_control(mstop = iter))</span></span>
<span id="cb194-1416"><a href="#cb194-1416" aria-hidden="true" tabindex="-1"></a><span class="in">                </span></span>
<span id="cb194-1417"><a href="#cb194-1417" aria-hidden="true" tabindex="-1"></a><span class="in">                predictions &lt;- predict(model, newdata = inner_test_data, type = "response")</span></span>
<span id="cb194-1418"><a href="#cb194-1418" aria-hidden="true" tabindex="-1"></a><span class="in">                roc_curve &lt;- roc(inner_test_data[[target_name]], predictions)</span></span>
<span id="cb194-1419"><a href="#cb194-1419" aria-hidden="true" tabindex="-1"></a><span class="in">                auc_vals[inner_index] &lt;- roc_curve$auc</span></span>
<span id="cb194-1420"><a href="#cb194-1420" aria-hidden="true" tabindex="-1"></a><span class="in">                </span></span>
<span id="cb194-1421"><a href="#cb194-1421" aria-hidden="true" tabindex="-1"></a><span class="in">              }, error = function(e) {</span></span>
<span id="cb194-1422"><a href="#cb194-1422" aria-hidden="true" tabindex="-1"></a><span class="in">                cat("Error with variables:", paste(temp_vars, collapse = ", "), "\n")</span></span>
<span id="cb194-1423"><a href="#cb194-1423" aria-hidden="true" tabindex="-1"></a><span class="in">                auc_vals[inner_index] &lt;- 0</span></span>
<span id="cb194-1424"><a href="#cb194-1424" aria-hidden="true" tabindex="-1"></a><span class="in">              })</span></span>
<span id="cb194-1425"><a href="#cb194-1425" aria-hidden="true" tabindex="-1"></a><span class="in">            }</span></span>
<span id="cb194-1426"><a href="#cb194-1426" aria-hidden="true" tabindex="-1"></a><span class="in">            </span></span>
<span id="cb194-1427"><a href="#cb194-1427" aria-hidden="true" tabindex="-1"></a><span class="in">            if (mean(auc_vals, na.rm = TRUE) &gt; best_auc_in_step) {</span></span>
<span id="cb194-1428"><a href="#cb194-1428" aria-hidden="true" tabindex="-1"></a><span class="in">              best_auc_in_step &lt;- mean(auc_vals, na.rm = TRUE)</span></span>
<span id="cb194-1429"><a href="#cb194-1429" aria-hidden="true" tabindex="-1"></a><span class="in">              best_inner_model &lt;- model</span></span>
<span id="cb194-1430"><a href="#cb194-1430" aria-hidden="true" tabindex="-1"></a><span class="in">              best_inner_iterations &lt;- iter</span></span>
<span id="cb194-1431"><a href="#cb194-1431" aria-hidden="true" tabindex="-1"></a><span class="in">              best_inner_vars &lt;- temp_vars</span></span>
<span id="cb194-1432"><a href="#cb194-1432" aria-hidden="true" tabindex="-1"></a><span class="in">              improved &lt;- TRUE</span></span>
<span id="cb194-1433"><a href="#cb194-1433" aria-hidden="true" tabindex="-1"></a><span class="in">            }</span></span>
<span id="cb194-1434"><a href="#cb194-1434" aria-hidden="true" tabindex="-1"></a><span class="in">          }</span></span>
<span id="cb194-1435"><a href="#cb194-1435" aria-hidden="true" tabindex="-1"></a><span class="in">        }</span></span>
<span id="cb194-1436"><a href="#cb194-1436" aria-hidden="true" tabindex="-1"></a><span class="in">        </span></span>
<span id="cb194-1437"><a href="#cb194-1437" aria-hidden="true" tabindex="-1"></a><span class="in">        if (improved) {</span></span>
<span id="cb194-1438"><a href="#cb194-1438" aria-hidden="true" tabindex="-1"></a><span class="in">          current_vars &lt;- best_inner_vars</span></span>
<span id="cb194-1439"><a href="#cb194-1439" aria-hidden="true" tabindex="-1"></a><span class="in">          best_inner_auc &lt;- best_auc_in_step</span></span>
<span id="cb194-1440"><a href="#cb194-1440" aria-hidden="true" tabindex="-1"></a><span class="in">          cat("Vars improved: ", paste(current_vars, collapse=", "), "\n")</span></span>
<span id="cb194-1441"><a href="#cb194-1441" aria-hidden="true" tabindex="-1"></a><span class="in">          cat("AUC: ", paste(best_inner_auc), "\n")</span></span>
<span id="cb194-1442"><a href="#cb194-1442" aria-hidden="true" tabindex="-1"></a><span class="in">        }</span></span>
<span id="cb194-1443"><a href="#cb194-1443" aria-hidden="true" tabindex="-1"></a><span class="in">      }</span></span>
<span id="cb194-1444"><a href="#cb194-1444" aria-hidden="true" tabindex="-1"></a><span class="in">      </span></span>
<span id="cb194-1445"><a href="#cb194-1445" aria-hidden="true" tabindex="-1"></a><span class="in">      list(model = best_inner_model, auc = best_inner_auc, </span></span>
<span id="cb194-1446"><a href="#cb194-1446" aria-hidden="true" tabindex="-1"></a><span class="in">           iterations = best_inner_iterations, </span></span>
<span id="cb194-1447"><a href="#cb194-1447" aria-hidden="true" tabindex="-1"></a><span class="in">           vars = best_inner_vars)</span></span>
<span id="cb194-1448"><a href="#cb194-1448" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb194-1449"><a href="#cb194-1449" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-1450"><a href="#cb194-1450" aria-hidden="true" tabindex="-1"></a><span class="in">    best_result &lt;- stepAUC(variables, outer_train_data, target_name, iterations, inner_folds)</span></span>
<span id="cb194-1451"><a href="#cb194-1451" aria-hidden="true" tabindex="-1"></a><span class="in">    best_model &lt;- best_result$model</span></span>
<span id="cb194-1452"><a href="#cb194-1452" aria-hidden="true" tabindex="-1"></a><span class="in">    best_auc &lt;- best_result$auc</span></span>
<span id="cb194-1453"><a href="#cb194-1453" aria-hidden="true" tabindex="-1"></a><span class="in">    best_iterations &lt;- best_result$iterations</span></span>
<span id="cb194-1454"><a href="#cb194-1454" aria-hidden="true" tabindex="-1"></a><span class="in">    best_vars &lt;- best_result$vars</span></span>
<span id="cb194-1455"><a href="#cb194-1455" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-1456"><a href="#cb194-1456" aria-hidden="true" tabindex="-1"></a><span class="in">    # Evaluar el mejor modelo en el validation split del inner loop</span></span>
<span id="cb194-1457"><a href="#cb194-1457" aria-hidden="true" tabindex="-1"></a><span class="in">    inner_auc_vals &lt;- numeric()</span></span>
<span id="cb194-1458"><a href="#cb194-1458" aria-hidden="true" tabindex="-1"></a><span class="in">    for (inner_index in seq_along(inner_folds)) {</span></span>
<span id="cb194-1459"><a href="#cb194-1459" aria-hidden="true" tabindex="-1"></a><span class="in">      inner_train_data &lt;- outer_train_data[-inner_folds[[inner_index]], ]</span></span>
<span id="cb194-1460"><a href="#cb194-1460" aria-hidden="true" tabindex="-1"></a><span class="in">      inner_test_data &lt;- outer_train_data[inner_folds[[inner_index]], ]</span></span>
<span id="cb194-1461"><a href="#cb194-1461" aria-hidden="true" tabindex="-1"></a><span class="in">      </span></span>
<span id="cb194-1462"><a href="#cb194-1462" aria-hidden="true" tabindex="-1"></a><span class="in">      predictions &lt;- predict(best_model, newdata = inner_test_data, type = "response")</span></span>
<span id="cb194-1463"><a href="#cb194-1463" aria-hidden="true" tabindex="-1"></a><span class="in">      roc_curve &lt;- roc(inner_test_data[[target_name]], predictions)</span></span>
<span id="cb194-1464"><a href="#cb194-1464" aria-hidden="true" tabindex="-1"></a><span class="in">      inner_auc_vals[inner_index] &lt;- roc_curve$auc</span></span>
<span id="cb194-1465"><a href="#cb194-1465" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-1466"><a href="#cb194-1466" aria-hidden="true" tabindex="-1"></a><span class="in">      pred_class &lt;- ifelse(predictions &gt; threshold, "1", "0")</span></span>
<span id="cb194-1467"><a href="#cb194-1467" aria-hidden="true" tabindex="-1"></a><span class="in">      confusion &lt;- table(Actual = inner_test_data[[target_name]], Predicted = pred_class)</span></span>
<span id="cb194-1468"><a href="#cb194-1468" aria-hidden="true" tabindex="-1"></a><span class="in">      TP &lt;- ifelse(nrow(confusion) &gt;= 2 &amp;&amp; ncol(confusion) &gt;= 2, confusion[2, 2], 0)</span></span>
<span id="cb194-1469"><a href="#cb194-1469" aria-hidden="true" tabindex="-1"></a><span class="in">      TN &lt;- ifelse(nrow(confusion) &gt;= 1 &amp;&amp; ncol(confusion) &gt;= 1, confusion[1, 1], 0)</span></span>
<span id="cb194-1470"><a href="#cb194-1470" aria-hidden="true" tabindex="-1"></a><span class="in">      FP &lt;- ifelse(nrow(confusion) &gt;= 1 &amp;&amp; ncol(confusion) &gt;= 2, confusion[1, 2], 0)</span></span>
<span id="cb194-1471"><a href="#cb194-1471" aria-hidden="true" tabindex="-1"></a><span class="in">      FN &lt;- ifelse(nrow(confusion) &gt;= 2 &amp;&amp; ncol(confusion) &gt;= 1, confusion[2, 1], 0)</span></span>
<span id="cb194-1472"><a href="#cb194-1472" aria-hidden="true" tabindex="-1"></a><span class="in">      auc &lt;- roc_curve$auc</span></span>
<span id="cb194-1473"><a href="#cb194-1473" aria-hidden="true" tabindex="-1"></a><span class="in">      </span></span>
<span id="cb194-1474"><a href="#cb194-1474" aria-hidden="true" tabindex="-1"></a><span class="in">      inner_metrics &lt;- setNames(c(outer_index, inner_index, TP, TN, FP, FN, auc), names(inner_fold_metrics))</span></span>
<span id="cb194-1475"><a href="#cb194-1475" aria-hidden="true" tabindex="-1"></a><span class="in">      inner_fold_metrics &lt;- rbind(inner_fold_metrics, as.data.frame(t(inner_metrics)))</span></span>
<span id="cb194-1476"><a href="#cb194-1476" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb194-1477"><a href="#cb194-1477" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-1478"><a href="#cb194-1478" aria-hidden="true" tabindex="-1"></a><span class="in">    best_inner_auc &lt;- mean(inner_auc_vals, na.rm = TRUE)</span></span>
<span id="cb194-1479"><a href="#cb194-1479" aria-hidden="true" tabindex="-1"></a><span class="in">    # Reentrenar el mejor modelo con todos los datos de outer_train_data</span></span>
<span id="cb194-1480"><a href="#cb194-1480" aria-hidden="true" tabindex="-1"></a><span class="in">    best_model &lt;- glmboost(as.formula(paste(target_name, "~", paste(best_vars, collapse = "+"))),</span></span>
<span id="cb194-1481"><a href="#cb194-1481" aria-hidden="true" tabindex="-1"></a><span class="in">                           data = outer_train_data, family = Binomial(),</span></span>
<span id="cb194-1482"><a href="#cb194-1482" aria-hidden="true" tabindex="-1"></a><span class="in">                           control = boost_control(mstop = best_iterations))</span></span>
<span id="cb194-1483"><a href="#cb194-1483" aria-hidden="true" tabindex="-1"></a><span class="in">    predictions &lt;- predict(best_model, outer_test_data, type = "response")</span></span>
<span id="cb194-1484"><a href="#cb194-1484" aria-hidden="true" tabindex="-1"></a><span class="in">    pred_class &lt;- ifelse(predictions &gt; threshold, "1", "0")</span></span>
<span id="cb194-1485"><a href="#cb194-1485" aria-hidden="true" tabindex="-1"></a><span class="in">    confusion &lt;- table(Actual = outer_test_data[[target_name]], Predicted = pred_class)</span></span>
<span id="cb194-1486"><a href="#cb194-1486" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-1487"><a href="#cb194-1487" aria-hidden="true" tabindex="-1"></a><span class="in">    if (nrow(confusion) &lt; 2 || ncol(confusion) &lt; 2) {</span></span>
<span id="cb194-1488"><a href="#cb194-1488" aria-hidden="true" tabindex="-1"></a><span class="in">      TP &lt;- ifelse(nrow(confusion) &gt;= 2 &amp;&amp; ncol(confusion) &gt;= 2, confusion[2, 2], 0)</span></span>
<span id="cb194-1489"><a href="#cb194-1489" aria-hidden="true" tabindex="-1"></a><span class="in">      TN &lt;- ifelse(nrow(confusion) &gt;= 1 &amp;&amp; ncol(confusion) &gt;= 1, confusion[1, 1], 0)</span></span>
<span id="cb194-1490"><a href="#cb194-1490" aria-hidden="true" tabindex="-1"></a><span class="in">      FP &lt;- ifelse(nrow(confusion) &gt;= 1 &amp;&amp; ncol(confusion) &gt;= 2, confusion[1, 2], 0)</span></span>
<span id="cb194-1491"><a href="#cb194-1491" aria-hidden="true" tabindex="-1"></a><span class="in">      FN &lt;- ifelse(nrow(confusion) &gt;= 2 &amp;&amp; ncol(confusion) &gt;= 1, confusion[2, 1], 0)</span></span>
<span id="cb194-1492"><a href="#cb194-1492" aria-hidden="true" tabindex="-1"></a><span class="in">    } else {</span></span>
<span id="cb194-1493"><a href="#cb194-1493" aria-hidden="true" tabindex="-1"></a><span class="in">      TP &lt;- confusion[2, 2]</span></span>
<span id="cb194-1494"><a href="#cb194-1494" aria-hidden="true" tabindex="-1"></a><span class="in">      TN &lt;- confusion[1, 1]</span></span>
<span id="cb194-1495"><a href="#cb194-1495" aria-hidden="true" tabindex="-1"></a><span class="in">      FP &lt;- confusion[1, 2]</span></span>
<span id="cb194-1496"><a href="#cb194-1496" aria-hidden="true" tabindex="-1"></a><span class="in">      FN &lt;- confusion[2, 1]</span></span>
<span id="cb194-1497"><a href="#cb194-1497" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb194-1498"><a href="#cb194-1498" aria-hidden="true" tabindex="-1"></a><span class="in">    auc &lt;- roc(outer_test_data[[target_name]], predictions)$auc</span></span>
<span id="cb194-1499"><a href="#cb194-1499" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-1500"><a href="#cb194-1500" aria-hidden="true" tabindex="-1"></a><span class="in">    metrics &lt;- setNames(c(outer_index, TP, TN, FP, FN, auc, </span></span>
<span id="cb194-1501"><a href="#cb194-1501" aria-hidden="true" tabindex="-1"></a><span class="in">                          best_iterations, paste(best_vars, collapse = ",")), </span></span>
<span id="cb194-1502"><a href="#cb194-1502" aria-hidden="true" tabindex="-1"></a><span class="in">                        names(performance_metrics))</span></span>
<span id="cb194-1503"><a href="#cb194-1503" aria-hidden="true" tabindex="-1"></a><span class="in">    performance_metrics &lt;- rbind(performance_metrics, as.data.frame(t(metrics)))</span></span>
<span id="cb194-1504"><a href="#cb194-1504" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-1505"><a href="#cb194-1505" aria-hidden="true" tabindex="-1"></a><span class="in">    cat("Performance:", paste(performance_metrics))</span></span>
<span id="cb194-1506"><a href="#cb194-1506" aria-hidden="true" tabindex="-1"></a><span class="in">    cat(sprintf("Confusion Matrix for Fold %d:\n", outer_index))</span></span>
<span id="cb194-1507"><a href="#cb194-1507" aria-hidden="true" tabindex="-1"></a><span class="in">    print(confusion)</span></span>
<span id="cb194-1508"><a href="#cb194-1508" aria-hidden="true" tabindex="-1"></a><span class="in">    cat(sprintf("Metrics for Fold %d:\n", outer_index))</span></span>
<span id="cb194-1509"><a href="#cb194-1509" aria-hidden="true" tabindex="-1"></a><span class="in">    cat(sprintf("TP: %d, TN: %d, FP: %d, FN: %d, AUC: %f, Best Iterations: %d, Best Variables: %s\n",</span></span>
<span id="cb194-1510"><a href="#cb194-1510" aria-hidden="true" tabindex="-1"></a><span class="in">                TP, TN, FP, FN, auc, best_iterations, paste(best_vars, collapse = ",")))</span></span>
<span id="cb194-1511"><a href="#cb194-1511" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb194-1512"><a href="#cb194-1512" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb194-1513"><a href="#cb194-1513" aria-hidden="true" tabindex="-1"></a><span class="in">  list(performance_metrics = performance_metrics, inner_fold_metrics = inner_fold_metrics)</span></span>
<span id="cb194-1514"><a href="#cb194-1514" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb194-1515"><a href="#cb194-1515" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-1516"><a href="#cb194-1516" aria-hidden="true" tabindex="-1"></a><span class="in">evaluate_with_seeds_AdaBoost_stepAUC &lt;- </span></span>
<span id="cb194-1517"><a href="#cb194-1517" aria-hidden="true" tabindex="-1"></a><span class="in">  function(evaluation_function, data, target_var, vars, threshold, seeds, outer, inner, iterations) {</span></span>
<span id="cb194-1518"><a href="#cb194-1518" aria-hidden="true" tabindex="-1"></a><span class="in">  results_list &lt;- list()</span></span>
<span id="cb194-1519"><a href="#cb194-1519" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-1520"><a href="#cb194-1520" aria-hidden="true" tabindex="-1"></a><span class="in">  for (seed in seeds) {</span></span>
<span id="cb194-1521"><a href="#cb194-1521" aria-hidden="true" tabindex="-1"></a><span class="in">    set.seed(seed)</span></span>
<span id="cb194-1522"><a href="#cb194-1522" aria-hidden="true" tabindex="-1"></a><span class="in">    cat("Evaluating with seed:", seed, "\n")</span></span>
<span id="cb194-1523"><a href="#cb194-1523" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-1524"><a href="#cb194-1524" aria-hidden="true" tabindex="-1"></a><span class="in">    results &lt;- evaluation_function(data = data, </span></span>
<span id="cb194-1525"><a href="#cb194-1525" aria-hidden="true" tabindex="-1"></a><span class="in">                                   target_name = target_var, </span></span>
<span id="cb194-1526"><a href="#cb194-1526" aria-hidden="true" tabindex="-1"></a><span class="in">                                   variables = vars, </span></span>
<span id="cb194-1527"><a href="#cb194-1527" aria-hidden="true" tabindex="-1"></a><span class="in">                                   threshold = threshold, </span></span>
<span id="cb194-1528"><a href="#cb194-1528" aria-hidden="true" tabindex="-1"></a><span class="in">                                   outer = outer, </span></span>
<span id="cb194-1529"><a href="#cb194-1529" aria-hidden="true" tabindex="-1"></a><span class="in">                                   inner = inner, </span></span>
<span id="cb194-1530"><a href="#cb194-1530" aria-hidden="true" tabindex="-1"></a><span class="in">                                   seed = seed,</span></span>
<span id="cb194-1531"><a href="#cb194-1531" aria-hidden="true" tabindex="-1"></a><span class="in">                                   iterations = iterations)</span></span>
<span id="cb194-1532"><a href="#cb194-1532" aria-hidden="true" tabindex="-1"></a><span class="in">    results_list[[paste0("seed_", seed)]] &lt;- results</span></span>
<span id="cb194-1533"><a href="#cb194-1533" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb194-1534"><a href="#cb194-1534" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-1535"><a href="#cb194-1535" aria-hidden="true" tabindex="-1"></a><span class="in">  return(results_list)</span></span>
<span id="cb194-1536"><a href="#cb194-1536" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb194-1537"><a href="#cb194-1537" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-1538"><a href="#cb194-1538" aria-hidden="true" tabindex="-1"></a><span class="in">performance_adaboost_stepAUC &lt;- evaluate_with_seeds_AdaBoost_stepAUC(</span></span>
<span id="cb194-1539"><a href="#cb194-1539" aria-hidden="true" tabindex="-1"></a><span class="in">  evaluation_function = double_cross_validation_adaboost_stepAUC,</span></span>
<span id="cb194-1540"><a href="#cb194-1540" aria-hidden="true" tabindex="-1"></a><span class="in">  data = data_factor,</span></span>
<span id="cb194-1541"><a href="#cb194-1541" aria-hidden="true" tabindex="-1"></a><span class="in">  outer = 5,</span></span>
<span id="cb194-1542"><a href="#cb194-1542" aria-hidden="true" tabindex="-1"></a><span class="in">  inner = 2,</span></span>
<span id="cb194-1543"><a href="#cb194-1543" aria-hidden="true" tabindex="-1"></a><span class="in">  target_var = "PCR",</span></span>
<span id="cb194-1544"><a href="#cb194-1544" aria-hidden="true" tabindex="-1"></a><span class="in">  vars = todas_variables_factor,</span></span>
<span id="cb194-1545"><a href="#cb194-1545" aria-hidden="true" tabindex="-1"></a><span class="in">  threshold = .35,</span></span>
<span id="cb194-1546"><a href="#cb194-1546" aria-hidden="true" tabindex="-1"></a><span class="in">  iterations = c(50, 100, 150, 200),</span></span>
<span id="cb194-1547"><a href="#cb194-1547" aria-hidden="true" tabindex="-1"></a><span class="in">  seeds = seeds</span></span>
<span id="cb194-1548"><a href="#cb194-1548" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb194-1549"><a href="#cb194-1549" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-1550"><a href="#cb194-1550" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-1551"><a href="#cb194-1551" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message=FALSE, warning=FALSE}</span></span>
<span id="cb194-1552"><a href="#cb194-1552" aria-hidden="true" tabindex="-1"></a><span class="in">load("RData_Files_Algorithms/AdaBoost_StepAUC.RData")</span></span>
<span id="cb194-1553"><a href="#cb194-1553" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-1554"><a href="#cb194-1554" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-1555"><a href="#cb194-1555" aria-hidden="true" tabindex="-1"></a><span class="fu">### Embedded (Lasso)</span></span>
<span id="cb194-1556"><a href="#cb194-1556" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-1557"><a href="#cb194-1557" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=FALSE}</span></span>
<span id="cb194-1558"><a href="#cb194-1558" aria-hidden="true" tabindex="-1"></a><span class="in">double_cross_validation_adaboost_lasso &lt;- function(data, target_name, outer, inner, iterations, variables, threshold, seed) {</span></span>
<span id="cb194-1559"><a href="#cb194-1559" aria-hidden="true" tabindex="-1"></a><span class="in">  set.seed(seed)</span></span>
<span id="cb194-1560"><a href="#cb194-1560" aria-hidden="true" tabindex="-1"></a><span class="in">  performance_metrics &lt;- data.frame(Fold = integer(), TP = integer(), TN = integer(),</span></span>
<span id="cb194-1561"><a href="#cb194-1561" aria-hidden="true" tabindex="-1"></a><span class="in">                                    FP = integer(), FN = integer(), AUC = numeric(),</span></span>
<span id="cb194-1562"><a href="#cb194-1562" aria-hidden="true" tabindex="-1"></a><span class="in">                                    Best_Iteration = integer(), </span></span>
<span id="cb194-1563"><a href="#cb194-1563" aria-hidden="true" tabindex="-1"></a><span class="in">                                    Best_Variables = character(), stringsAsFactors = FALSE)</span></span>
<span id="cb194-1564"><a href="#cb194-1564" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb194-1565"><a href="#cb194-1565" aria-hidden="true" tabindex="-1"></a><span class="in">  inner_fold_metrics &lt;- data.frame(Fold = integer(), Inner_Fold = integer(), </span></span>
<span id="cb194-1566"><a href="#cb194-1566" aria-hidden="true" tabindex="-1"></a><span class="in">                                   TP = integer(), TN = integer(), FP = integer(), </span></span>
<span id="cb194-1567"><a href="#cb194-1567" aria-hidden="true" tabindex="-1"></a><span class="in">                                   FN = integer(), AUC = numeric(), stringsAsFactors = FALSE)</span></span>
<span id="cb194-1568"><a href="#cb194-1568" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb194-1569"><a href="#cb194-1569" aria-hidden="true" tabindex="-1"></a><span class="in">  # Convertir las variables del dataset con model.matrix</span></span>
<span id="cb194-1570"><a href="#cb194-1570" aria-hidden="true" tabindex="-1"></a><span class="in">  target &lt;- as.factor(data[[target_name]])  # Aseguramos que la variable de respuesta sea factor</span></span>
<span id="cb194-1571"><a href="#cb194-1571" aria-hidden="true" tabindex="-1"></a><span class="in">  features &lt;- data[, setdiff(names(data), target_name)]</span></span>
<span id="cb194-1572"><a href="#cb194-1572" aria-hidden="true" tabindex="-1"></a><span class="in">  data_matrix &lt;- as.data.frame(model.matrix(~ ., data=features)[,-1])  # Eliminar el intercepto</span></span>
<span id="cb194-1573"><a href="#cb194-1573" aria-hidden="true" tabindex="-1"></a><span class="in">  data_matrix[[target_name]] &lt;- target</span></span>
<span id="cb194-1574"><a href="#cb194-1574" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb194-1575"><a href="#cb194-1575" aria-hidden="true" tabindex="-1"></a><span class="in">  outer_folds &lt;- createFolds(data_matrix[[target_name]], k = outer)</span></span>
<span id="cb194-1576"><a href="#cb194-1576" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb194-1577"><a href="#cb194-1577" aria-hidden="true" tabindex="-1"></a><span class="in">  for (outer_index in seq_along(outer_folds)) {</span></span>
<span id="cb194-1578"><a href="#cb194-1578" aria-hidden="true" tabindex="-1"></a><span class="in">    outer_train_data &lt;- data_matrix[-outer_folds[[outer_index]], ]</span></span>
<span id="cb194-1579"><a href="#cb194-1579" aria-hidden="true" tabindex="-1"></a><span class="in">    outer_test_data &lt;- data_matrix[outer_folds[[outer_index]], ]</span></span>
<span id="cb194-1580"><a href="#cb194-1580" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-1581"><a href="#cb194-1581" aria-hidden="true" tabindex="-1"></a><span class="in">    cat(sprintf("Outer Fold %d\n", outer_index))</span></span>
<span id="cb194-1582"><a href="#cb194-1582" aria-hidden="true" tabindex="-1"></a><span class="in">    cat("Training Data - Class 0: ", sum(outer_train_data[[target_name]] == 0), "\n")</span></span>
<span id="cb194-1583"><a href="#cb194-1583" aria-hidden="true" tabindex="-1"></a><span class="in">    cat("Training Data - Class 1: ", sum(outer_train_data[[target_name]] == 1), "\n")</span></span>
<span id="cb194-1584"><a href="#cb194-1584" aria-hidden="true" tabindex="-1"></a><span class="in">    cat("Testing Data - Class 0: ", sum(outer_test_data[[target_name]] == 0), "\n")</span></span>
<span id="cb194-1585"><a href="#cb194-1585" aria-hidden="true" tabindex="-1"></a><span class="in">    cat("Testing Data - Class 1: ", sum(outer_test_data[[target_name]] == 1), "\n")</span></span>
<span id="cb194-1586"><a href="#cb194-1586" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-1587"><a href="#cb194-1587" aria-hidden="true" tabindex="-1"></a><span class="in">    inner_folds &lt;- createFolds(outer_train_data[[target_name]], k = inner)</span></span>
<span id="cb194-1588"><a href="#cb194-1588" aria-hidden="true" tabindex="-1"></a><span class="in">    best_model &lt;- NULL</span></span>
<span id="cb194-1589"><a href="#cb194-1589" aria-hidden="true" tabindex="-1"></a><span class="in">    best_auc &lt;- 0</span></span>
<span id="cb194-1590"><a href="#cb194-1590" aria-hidden="true" tabindex="-1"></a><span class="in">    best_iteration &lt;- NULL</span></span>
<span id="cb194-1591"><a href="#cb194-1591" aria-hidden="true" tabindex="-1"></a><span class="in">    best_vars &lt;- colnames(outer_train_data)[!colnames(outer_train_data) %in% target_name]</span></span>
<span id="cb194-1592"><a href="#cb194-1592" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-1593"><a href="#cb194-1593" aria-hidden="true" tabindex="-1"></a><span class="in">    grid &lt;- expand.grid(iteration = iterations)</span></span>
<span id="cb194-1594"><a href="#cb194-1594" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-1595"><a href="#cb194-1595" aria-hidden="true" tabindex="-1"></a><span class="in">    select_vars_lasso &lt;- function(data, target_name) {</span></span>
<span id="cb194-1596"><a href="#cb194-1596" aria-hidden="true" tabindex="-1"></a><span class="in">      target &lt;- as.numeric(data[[target_name]]) - 1  # Convertimos a numérico para Lasso</span></span>
<span id="cb194-1597"><a href="#cb194-1597" aria-hidden="true" tabindex="-1"></a><span class="in">      features &lt;- data[, setdiff(names(data), target_name)]</span></span>
<span id="cb194-1598"><a href="#cb194-1598" aria-hidden="true" tabindex="-1"></a><span class="in">      X &lt;- model.matrix(~ ., data=features)[,-1]  # Eliminamos el intercepto</span></span>
<span id="cb194-1599"><a href="#cb194-1599" aria-hidden="true" tabindex="-1"></a><span class="in">      y &lt;- target</span></span>
<span id="cb194-1600"><a href="#cb194-1600" aria-hidden="true" tabindex="-1"></a><span class="in">      </span></span>
<span id="cb194-1601"><a href="#cb194-1601" aria-hidden="true" tabindex="-1"></a><span class="in">      # Ajustamos el modelo Lasso</span></span>
<span id="cb194-1602"><a href="#cb194-1602" aria-hidden="true" tabindex="-1"></a><span class="in">      lasso_model &lt;- cv.glmnet(X, y, alpha=1)</span></span>
<span id="cb194-1603"><a href="#cb194-1603" aria-hidden="true" tabindex="-1"></a><span class="in">      lasso_coef &lt;- coef(lasso_model, s = "lambda.min")</span></span>
<span id="cb194-1604"><a href="#cb194-1604" aria-hidden="true" tabindex="-1"></a><span class="in">      </span></span>
<span id="cb194-1605"><a href="#cb194-1605" aria-hidden="true" tabindex="-1"></a><span class="in">      # Seleccionamos las variables no nulas</span></span>
<span id="cb194-1606"><a href="#cb194-1606" aria-hidden="true" tabindex="-1"></a><span class="in">      selected_vars &lt;- rownames(lasso_coef)[lasso_coef[, 1] != 0]</span></span>
<span id="cb194-1607"><a href="#cb194-1607" aria-hidden="true" tabindex="-1"></a><span class="in">      selected_vars &lt;- setdiff(selected_vars, "(Intercept)")</span></span>
<span id="cb194-1608"><a href="#cb194-1608" aria-hidden="true" tabindex="-1"></a><span class="in">      #cat("Selected variables by Lasso: ", paste(selected_vars, collapse=", "), "\n")</span></span>
<span id="cb194-1609"><a href="#cb194-1609" aria-hidden="true" tabindex="-1"></a><span class="in">      return(selected_vars)</span></span>
<span id="cb194-1610"><a href="#cb194-1610" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb194-1611"><a href="#cb194-1611" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-1612"><a href="#cb194-1612" aria-hidden="true" tabindex="-1"></a><span class="in">    stepAUC &lt;- function(vars, data, target_name, grid, inner_folds) {</span></span>
<span id="cb194-1613"><a href="#cb194-1613" aria-hidden="true" tabindex="-1"></a><span class="in">      best_inner_auc &lt;- 0</span></span>
<span id="cb194-1614"><a href="#cb194-1614" aria-hidden="true" tabindex="-1"></a><span class="in">      best_inner_model &lt;- NULL</span></span>
<span id="cb194-1615"><a href="#cb194-1615" aria-hidden="true" tabindex="-1"></a><span class="in">      best_inner_iteration &lt;- NULL</span></span>
<span id="cb194-1616"><a href="#cb194-1616" aria-hidden="true" tabindex="-1"></a><span class="in">      best_inner_vars &lt;- vars</span></span>
<span id="cb194-1617"><a href="#cb194-1617" aria-hidden="true" tabindex="-1"></a><span class="in">      improved &lt;- TRUE</span></span>
<span id="cb194-1618"><a href="#cb194-1618" aria-hidden="true" tabindex="-1"></a><span class="in">      </span></span>
<span id="cb194-1619"><a href="#cb194-1619" aria-hidden="true" tabindex="-1"></a><span class="in">      while (improved &amp;&amp; length(vars) &gt; 1) {</span></span>
<span id="cb194-1620"><a href="#cb194-1620" aria-hidden="true" tabindex="-1"></a><span class="in">        improved &lt;- FALSE</span></span>
<span id="cb194-1621"><a href="#cb194-1621" aria-hidden="true" tabindex="-1"></a><span class="in">        best_auc_in_step &lt;- best_inner_auc</span></span>
<span id="cb194-1622"><a href="#cb194-1622" aria-hidden="true" tabindex="-1"></a><span class="in">        </span></span>
<span id="cb194-1623"><a href="#cb194-1623" aria-hidden="true" tabindex="-1"></a><span class="in">        for (params in 1:nrow(grid)) {</span></span>
<span id="cb194-1624"><a href="#cb194-1624" aria-hidden="true" tabindex="-1"></a><span class="in">          auc_vals &lt;- numeric()</span></span>
<span id="cb194-1625"><a href="#cb194-1625" aria-hidden="true" tabindex="-1"></a><span class="in">          </span></span>
<span id="cb194-1626"><a href="#cb194-1626" aria-hidden="true" tabindex="-1"></a><span class="in">          for (inner_index in seq_along(inner_folds)) {</span></span>
<span id="cb194-1627"><a href="#cb194-1627" aria-hidden="true" tabindex="-1"></a><span class="in">            inner_train_data &lt;- outer_train_data[-inner_folds[[inner_index]], ]</span></span>
<span id="cb194-1628"><a href="#cb194-1628" aria-hidden="true" tabindex="-1"></a><span class="in">            inner_test_data &lt;- outer_train_data[inner_folds[[inner_index]], ]</span></span>
<span id="cb194-1629"><a href="#cb194-1629" aria-hidden="true" tabindex="-1"></a><span class="in">            </span></span>
<span id="cb194-1630"><a href="#cb194-1630" aria-hidden="true" tabindex="-1"></a><span class="in">            selected_vars &lt;- select_vars_lasso(inner_train_data, target_name)</span></span>
<span id="cb194-1631"><a href="#cb194-1631" aria-hidden="true" tabindex="-1"></a><span class="in">            formula &lt;- as.formula(paste(target_name, "~", paste(selected_vars, collapse = "+")))</span></span>
<span id="cb194-1632"><a href="#cb194-1632" aria-hidden="true" tabindex="-1"></a><span class="in">            #cat("Testing with formula: ", deparse(formula), "\n")</span></span>
<span id="cb194-1633"><a href="#cb194-1633" aria-hidden="true" tabindex="-1"></a><span class="in">            #cat("Grid parameters - iteration: ", grid$iteration[params], "\n")</span></span>
<span id="cb194-1634"><a href="#cb194-1634" aria-hidden="true" tabindex="-1"></a><span class="in">            </span></span>
<span id="cb194-1635"><a href="#cb194-1635" aria-hidden="true" tabindex="-1"></a><span class="in">            result &lt;- tryCatch({</span></span>
<span id="cb194-1636"><a href="#cb194-1636" aria-hidden="true" tabindex="-1"></a><span class="in">              model &lt;- blackboost(formula, data = inner_train_data, family = Binomial(), </span></span>
<span id="cb194-1637"><a href="#cb194-1637" aria-hidden="true" tabindex="-1"></a><span class="in">                                  control = boost_control(mstop = grid$iteration[params]))</span></span>
<span id="cb194-1638"><a href="#cb194-1638" aria-hidden="true" tabindex="-1"></a><span class="in">              </span></span>
<span id="cb194-1639"><a href="#cb194-1639" aria-hidden="true" tabindex="-1"></a><span class="in">              predictions &lt;- predict(model, inner_test_data, type = "response")</span></span>
<span id="cb194-1640"><a href="#cb194-1640" aria-hidden="true" tabindex="-1"></a><span class="in">              roc_curve &lt;- roc(inner_test_data[[target_name]], predictions)</span></span>
<span id="cb194-1641"><a href="#cb194-1641" aria-hidden="true" tabindex="-1"></a><span class="in">              auc_vals[inner_index] &lt;- roc_curve$auc</span></span>
<span id="cb194-1642"><a href="#cb194-1642" aria-hidden="true" tabindex="-1"></a><span class="in">              #cat("AUC for inner fold ", inner_index, ": ", roc_curve$auc, "\n")</span></span>
<span id="cb194-1643"><a href="#cb194-1643" aria-hidden="true" tabindex="-1"></a><span class="in">              </span></span>
<span id="cb194-1644"><a href="#cb194-1644" aria-hidden="true" tabindex="-1"></a><span class="in">            }, error = function(e) {</span></span>
<span id="cb194-1645"><a href="#cb194-1645" aria-hidden="true" tabindex="-1"></a><span class="in">              cat("Error with variables: ", paste(selected_vars, collapse = ", "), "\n")</span></span>
<span id="cb194-1646"><a href="#cb194-1646" aria-hidden="true" tabindex="-1"></a><span class="in">              cat("Error message: ", e$message, "\n")</span></span>
<span id="cb194-1647"><a href="#cb194-1647" aria-hidden="true" tabindex="-1"></a><span class="in">              auc_vals[inner_index] &lt;- NA  # Set to NA or some other indicator of failure</span></span>
<span id="cb194-1648"><a href="#cb194-1648" aria-hidden="true" tabindex="-1"></a><span class="in">            })</span></span>
<span id="cb194-1649"><a href="#cb194-1649" aria-hidden="true" tabindex="-1"></a><span class="in">          }</span></span>
<span id="cb194-1650"><a href="#cb194-1650" aria-hidden="true" tabindex="-1"></a><span class="in">          </span></span>
<span id="cb194-1651"><a href="#cb194-1651" aria-hidden="true" tabindex="-1"></a><span class="in">          mean_auc &lt;- mean(auc_vals, na.rm = TRUE)</span></span>
<span id="cb194-1652"><a href="#cb194-1652" aria-hidden="true" tabindex="-1"></a><span class="in">          #cat("Mean AUC for params - iteration: ", grid$iteration[params], ": ", mean_auc, "\n")</span></span>
<span id="cb194-1653"><a href="#cb194-1653" aria-hidden="true" tabindex="-1"></a><span class="in">          if (!is.na(mean_auc) &amp;&amp; mean_auc &gt; best_auc_in_step) {</span></span>
<span id="cb194-1654"><a href="#cb194-1654" aria-hidden="true" tabindex="-1"></a><span class="in">            best_auc_in_step &lt;- mean_auc</span></span>
<span id="cb194-1655"><a href="#cb194-1655" aria-hidden="true" tabindex="-1"></a><span class="in">            best_inner_model &lt;- model</span></span>
<span id="cb194-1656"><a href="#cb194-1656" aria-hidden="true" tabindex="-1"></a><span class="in">            best_inner_iteration &lt;- grid$iteration[params]</span></span>
<span id="cb194-1657"><a href="#cb194-1657" aria-hidden="true" tabindex="-1"></a><span class="in">            best_inner_vars &lt;- selected_vars</span></span>
<span id="cb194-1658"><a href="#cb194-1658" aria-hidden="true" tabindex="-1"></a><span class="in">            improved &lt;- TRUE</span></span>
<span id="cb194-1659"><a href="#cb194-1659" aria-hidden="true" tabindex="-1"></a><span class="in">          }</span></span>
<span id="cb194-1660"><a href="#cb194-1660" aria-hidden="true" tabindex="-1"></a><span class="in">        }</span></span>
<span id="cb194-1661"><a href="#cb194-1661" aria-hidden="true" tabindex="-1"></a><span class="in">        </span></span>
<span id="cb194-1662"><a href="#cb194-1662" aria-hidden="true" tabindex="-1"></a><span class="in">        if (improved) {</span></span>
<span id="cb194-1663"><a href="#cb194-1663" aria-hidden="true" tabindex="-1"></a><span class="in">          vars &lt;- best_inner_vars</span></span>
<span id="cb194-1664"><a href="#cb194-1664" aria-hidden="true" tabindex="-1"></a><span class="in">          best_inner_auc &lt;- best_auc_in_step</span></span>
<span id="cb194-1665"><a href="#cb194-1665" aria-hidden="true" tabindex="-1"></a><span class="in">          cat("Vars improved: ", paste(vars, collapse=", "), "\n")</span></span>
<span id="cb194-1666"><a href="#cb194-1666" aria-hidden="true" tabindex="-1"></a><span class="in">          cat("AUC: ", best_inner_auc, "\n")</span></span>
<span id="cb194-1667"><a href="#cb194-1667" aria-hidden="true" tabindex="-1"></a><span class="in">        }</span></span>
<span id="cb194-1668"><a href="#cb194-1668" aria-hidden="true" tabindex="-1"></a><span class="in">      }</span></span>
<span id="cb194-1669"><a href="#cb194-1669" aria-hidden="true" tabindex="-1"></a><span class="in">      </span></span>
<span id="cb194-1670"><a href="#cb194-1670" aria-hidden="true" tabindex="-1"></a><span class="in">      list(model = best_inner_model, auc = best_inner_auc, </span></span>
<span id="cb194-1671"><a href="#cb194-1671" aria-hidden="true" tabindex="-1"></a><span class="in">           iteration = best_inner_iteration, vars = best_inner_vars)</span></span>
<span id="cb194-1672"><a href="#cb194-1672" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb194-1673"><a href="#cb194-1673" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-1674"><a href="#cb194-1674" aria-hidden="true" tabindex="-1"></a><span class="in">    best_result &lt;- stepAUC(best_vars, outer_train_data, target_name, grid, inner_folds)</span></span>
<span id="cb194-1675"><a href="#cb194-1675" aria-hidden="true" tabindex="-1"></a><span class="in">    best_model &lt;- best_result$model</span></span>
<span id="cb194-1676"><a href="#cb194-1676" aria-hidden="true" tabindex="-1"></a><span class="in">    best_auc &lt;- best_result$auc</span></span>
<span id="cb194-1677"><a href="#cb194-1677" aria-hidden="true" tabindex="-1"></a><span class="in">    best_iteration &lt;- best_result$iteration</span></span>
<span id="cb194-1678"><a href="#cb194-1678" aria-hidden="true" tabindex="-1"></a><span class="in">    best_vars &lt;- best_result$vars</span></span>
<span id="cb194-1679"><a href="#cb194-1679" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-1680"><a href="#cb194-1680" aria-hidden="true" tabindex="-1"></a><span class="in">    if (is.null(best_model)) {</span></span>
<span id="cb194-1681"><a href="#cb194-1681" aria-hidden="true" tabindex="-1"></a><span class="in">      cat("Error: No valid model found for outer fold ", outer_index, "\n")</span></span>
<span id="cb194-1682"><a href="#cb194-1682" aria-hidden="true" tabindex="-1"></a><span class="in">      next</span></span>
<span id="cb194-1683"><a href="#cb194-1683" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb194-1684"><a href="#cb194-1684" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-1685"><a href="#cb194-1685" aria-hidden="true" tabindex="-1"></a><span class="in">    # Evaluar el mejor modelo en el validation split del inner loop</span></span>
<span id="cb194-1686"><a href="#cb194-1686" aria-hidden="true" tabindex="-1"></a><span class="in">    inner_auc_vals &lt;- numeric()</span></span>
<span id="cb194-1687"><a href="#cb194-1687" aria-hidden="true" tabindex="-1"></a><span class="in">    for (inner_index in seq_along(inner_folds)) {</span></span>
<span id="cb194-1688"><a href="#cb194-1688" aria-hidden="true" tabindex="-1"></a><span class="in">      inner_train_data &lt;- outer_train_data[-inner_folds[[inner_index]], ]</span></span>
<span id="cb194-1689"><a href="#cb194-1689" aria-hidden="true" tabindex="-1"></a><span class="in">      inner_test_data &lt;- outer_train_data[inner_folds[[inner_index]], ]</span></span>
<span id="cb194-1690"><a href="#cb194-1690" aria-hidden="true" tabindex="-1"></a><span class="in">      </span></span>
<span id="cb194-1691"><a href="#cb194-1691" aria-hidden="true" tabindex="-1"></a><span class="in">      predictions &lt;- predict(best_model, inner_test_data, type = "response")</span></span>
<span id="cb194-1692"><a href="#cb194-1692" aria-hidden="true" tabindex="-1"></a><span class="in">      roc_curve &lt;- roc(inner_test_data[[target_name]], predictions)</span></span>
<span id="cb194-1693"><a href="#cb194-1693" aria-hidden="true" tabindex="-1"></a><span class="in">      inner_auc_vals[inner_index] &lt;- roc_curve$auc</span></span>
<span id="cb194-1694"><a href="#cb194-1694" aria-hidden="true" tabindex="-1"></a><span class="in">      cat("Inner fold ", inner_index, " AUC: ", roc_curve$auc, "\n")</span></span>
<span id="cb194-1695"><a href="#cb194-1695" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-1696"><a href="#cb194-1696" aria-hidden="true" tabindex="-1"></a><span class="in">      pred_class &lt;- ifelse(predictions &gt; threshold, 1, 0)</span></span>
<span id="cb194-1697"><a href="#cb194-1697" aria-hidden="true" tabindex="-1"></a><span class="in">      confusion &lt;- table(Actual = inner_test_data[[target_name]], Predicted = pred_class)</span></span>
<span id="cb194-1698"><a href="#cb194-1698" aria-hidden="true" tabindex="-1"></a><span class="in">      TP &lt;- ifelse(nrow(confusion) &gt;= 2 &amp;&amp; ncol(confusion) &gt;= 2, confusion[2, 2], 0)</span></span>
<span id="cb194-1699"><a href="#cb194-1699" aria-hidden="true" tabindex="-1"></a><span class="in">      TN &lt;- ifelse(nrow(confusion) &gt;= 1 &amp;&amp; ncol(confusion) &gt;= 1, confusion[1, 1], 0)</span></span>
<span id="cb194-1700"><a href="#cb194-1700" aria-hidden="true" tabindex="-1"></a><span class="in">      FP &lt;- ifelse(nrow(confusion) &gt;= 1 &amp;&amp; ncol(confusion) &gt;= 2, confusion[1, 2], 0)</span></span>
<span id="cb194-1701"><a href="#cb194-1701" aria-hidden="true" tabindex="-1"></a><span class="in">      FN &lt;- ifelse(nrow(confusion) &gt;= 2 &amp;&amp; ncol(confusion) &gt;= 1, confusion[2, 1], 0)</span></span>
<span id="cb194-1702"><a href="#cb194-1702" aria-hidden="true" tabindex="-1"></a><span class="in">      auc &lt;- roc_curve$auc</span></span>
<span id="cb194-1703"><a href="#cb194-1703" aria-hidden="true" tabindex="-1"></a><span class="in">      </span></span>
<span id="cb194-1704"><a href="#cb194-1704" aria-hidden="true" tabindex="-1"></a><span class="in">      inner_metrics &lt;- setNames(c(outer_index, inner_index, TP, TN, FP, FN, auc), names(inner_fold_metrics))</span></span>
<span id="cb194-1705"><a href="#cb194-1705" aria-hidden="true" tabindex="-1"></a><span class="in">      inner_fold_metrics &lt;- rbind(inner_fold_metrics, as.data.frame(t(inner_metrics)))</span></span>
<span id="cb194-1706"><a href="#cb194-1706" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb194-1707"><a href="#cb194-1707" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-1708"><a href="#cb194-1708" aria-hidden="true" tabindex="-1"></a><span class="in">    best_inner_auc &lt;- mean(inner_auc_vals, na.rm = TRUE)</span></span>
<span id="cb194-1709"><a href="#cb194-1709" aria-hidden="true" tabindex="-1"></a><span class="in">    cat("Best inner AUC: ", best_inner_auc, "\n")</span></span>
<span id="cb194-1710"><a href="#cb194-1710" aria-hidden="true" tabindex="-1"></a><span class="in">    # Reentrenar el mejor modelo con todos los datos de outer_train_data</span></span>
<span id="cb194-1711"><a href="#cb194-1711" aria-hidden="true" tabindex="-1"></a><span class="in">    best_model &lt;- glmboost(as.formula(paste(target_name, "~", paste(best_vars, collapse = "+"))),</span></span>
<span id="cb194-1712"><a href="#cb194-1712" aria-hidden="true" tabindex="-1"></a><span class="in">                           data = outer_train_data, family = Binomial(),</span></span>
<span id="cb194-1713"><a href="#cb194-1713" aria-hidden="true" tabindex="-1"></a><span class="in">                           control = boost_control(mstop = best_iteration))</span></span>
<span id="cb194-1714"><a href="#cb194-1714" aria-hidden="true" tabindex="-1"></a><span class="in">    predictions &lt;- predict(best_model, outer_test_data, type = "response")</span></span>
<span id="cb194-1715"><a href="#cb194-1715" aria-hidden="true" tabindex="-1"></a><span class="in">    pred_class &lt;- ifelse(predictions &gt; threshold, 1, 0)  # Asignar clases basadas en umbral</span></span>
<span id="cb194-1716"><a href="#cb194-1716" aria-hidden="true" tabindex="-1"></a><span class="in">    confusion &lt;- table(Actual = outer_test_data[[target_name]], Predicted = pred_class)</span></span>
<span id="cb194-1717"><a href="#cb194-1717" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-1718"><a href="#cb194-1718" aria-hidden="true" tabindex="-1"></a><span class="in">    if (nrow(confusion) &lt; 2 || ncol(confusion) &lt; 2) {</span></span>
<span id="cb194-1719"><a href="#cb194-1719" aria-hidden="true" tabindex="-1"></a><span class="in">      TP &lt;- ifelse(nrow(confusion) &gt;= 2 &amp;&amp; ncol(confusion) &gt;= 2, confusion[2, 2], 0)</span></span>
<span id="cb194-1720"><a href="#cb194-1720" aria-hidden="true" tabindex="-1"></a><span class="in">      TN &lt;- ifelse(nrow(confusion) &gt;= 1 &amp;&amp; ncol(confusion) &gt;= 1, confusion[1, 1], 0)</span></span>
<span id="cb194-1721"><a href="#cb194-1721" aria-hidden="true" tabindex="-1"></a><span class="in">      FP &lt;- ifelse(nrow(confusion) &gt;= 1 &amp;&amp; ncol(confusion) &gt;= 2, confusion[1, 2], 0)</span></span>
<span id="cb194-1722"><a href="#cb194-1722" aria-hidden="true" tabindex="-1"></a><span class="in">      FN &lt;- ifelse(nrow(confusion) &gt;= 2 &amp;&amp; ncol(confusion) &gt;= 1, confusion[2, 1], 0)</span></span>
<span id="cb194-1723"><a href="#cb194-1723" aria-hidden="true" tabindex="-1"></a><span class="in">    } else {</span></span>
<span id="cb194-1724"><a href="#cb194-1724" aria-hidden="true" tabindex="-1"></a><span class="in">      TP &lt;- confusion[2, 2]</span></span>
<span id="cb194-1725"><a href="#cb194-1725" aria-hidden="true" tabindex="-1"></a><span class="in">      TN &lt;- confusion[1, 1]</span></span>
<span id="cb194-1726"><a href="#cb194-1726" aria-hidden="true" tabindex="-1"></a><span class="in">      FP &lt;- confusion[1, 2]</span></span>
<span id="cb194-1727"><a href="#cb194-1727" aria-hidden="true" tabindex="-1"></a><span class="in">      FN &lt;- confusion[2, 1]</span></span>
<span id="cb194-1728"><a href="#cb194-1728" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb194-1729"><a href="#cb194-1729" aria-hidden="true" tabindex="-1"></a><span class="in">    auc &lt;- roc(outer_test_data[[target_name]], predictions)$auc</span></span>
<span id="cb194-1730"><a href="#cb194-1730" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-1731"><a href="#cb194-1731" aria-hidden="true" tabindex="-1"></a><span class="in">    metrics &lt;- setNames(c(outer_index, TP, TN, FP, FN, auc, </span></span>
<span id="cb194-1732"><a href="#cb194-1732" aria-hidden="true" tabindex="-1"></a><span class="in">                          best_iteration, paste(best_vars, collapse = ",")), </span></span>
<span id="cb194-1733"><a href="#cb194-1733" aria-hidden="true" tabindex="-1"></a><span class="in">                        names(performance_metrics))</span></span>
<span id="cb194-1734"><a href="#cb194-1734" aria-hidden="true" tabindex="-1"></a><span class="in">    performance_metrics &lt;- rbind(performance_metrics, as.data.frame(t(metrics)))</span></span>
<span id="cb194-1735"><a href="#cb194-1735" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-1736"><a href="#cb194-1736" aria-hidden="true" tabindex="-1"></a><span class="in">    cat("Performance:\n", paste(performance_metrics), "\n")</span></span>
<span id="cb194-1737"><a href="#cb194-1737" aria-hidden="true" tabindex="-1"></a><span class="in">    cat(sprintf("Confusion Matrix for Fold %d:\n", outer_index))</span></span>
<span id="cb194-1738"><a href="#cb194-1738" aria-hidden="true" tabindex="-1"></a><span class="in">    print(confusion)</span></span>
<span id="cb194-1739"><a href="#cb194-1739" aria-hidden="true" tabindex="-1"></a><span class="in">    cat(sprintf("Metrics for Fold %d:\n", outer_index))</span></span>
<span id="cb194-1740"><a href="#cb194-1740" aria-hidden="true" tabindex="-1"></a><span class="in">    cat(sprintf("TP: %d, TN: %d, FP: %d, FN: %d, AUC: %f, Best Iteration: %d, Best Variables: %s\n",</span></span>
<span id="cb194-1741"><a href="#cb194-1741" aria-hidden="true" tabindex="-1"></a><span class="in">                TP, TN, FP, FN, auc, best_iteration, paste(best_vars, collapse = ",")))</span></span>
<span id="cb194-1742"><a href="#cb194-1742" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb194-1743"><a href="#cb194-1743" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb194-1744"><a href="#cb194-1744" aria-hidden="true" tabindex="-1"></a><span class="in">  list(performance_metrics = performance_metrics, inner_fold_metrics = inner_fold_metrics)</span></span>
<span id="cb194-1745"><a href="#cb194-1745" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb194-1746"><a href="#cb194-1746" aria-hidden="true" tabindex="-1"></a><span class="in">evaluate_with_seeds_AdaBoost_Lasso &lt;- </span></span>
<span id="cb194-1747"><a href="#cb194-1747" aria-hidden="true" tabindex="-1"></a><span class="in">  function(evaluation_function, data, target_var, vars, threshold, seeds, outer, inner, iterations) {</span></span>
<span id="cb194-1748"><a href="#cb194-1748" aria-hidden="true" tabindex="-1"></a><span class="in">  results_list &lt;- list()</span></span>
<span id="cb194-1749"><a href="#cb194-1749" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-1750"><a href="#cb194-1750" aria-hidden="true" tabindex="-1"></a><span class="in">  for (seed in seeds) {</span></span>
<span id="cb194-1751"><a href="#cb194-1751" aria-hidden="true" tabindex="-1"></a><span class="in">    set.seed(seed)</span></span>
<span id="cb194-1752"><a href="#cb194-1752" aria-hidden="true" tabindex="-1"></a><span class="in">    cat("Evaluating with seed:", seed, "\n")</span></span>
<span id="cb194-1753"><a href="#cb194-1753" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-1754"><a href="#cb194-1754" aria-hidden="true" tabindex="-1"></a><span class="in">    results &lt;- evaluation_function(data = data, </span></span>
<span id="cb194-1755"><a href="#cb194-1755" aria-hidden="true" tabindex="-1"></a><span class="in">                                   target_name = target_var, </span></span>
<span id="cb194-1756"><a href="#cb194-1756" aria-hidden="true" tabindex="-1"></a><span class="in">                                   variables = vars, </span></span>
<span id="cb194-1757"><a href="#cb194-1757" aria-hidden="true" tabindex="-1"></a><span class="in">                                   threshold = threshold, </span></span>
<span id="cb194-1758"><a href="#cb194-1758" aria-hidden="true" tabindex="-1"></a><span class="in">                                   outer = outer, </span></span>
<span id="cb194-1759"><a href="#cb194-1759" aria-hidden="true" tabindex="-1"></a><span class="in">                                   inner = inner, </span></span>
<span id="cb194-1760"><a href="#cb194-1760" aria-hidden="true" tabindex="-1"></a><span class="in">                                   seed = seed,</span></span>
<span id="cb194-1761"><a href="#cb194-1761" aria-hidden="true" tabindex="-1"></a><span class="in">                                   iterations = iterations)</span></span>
<span id="cb194-1762"><a href="#cb194-1762" aria-hidden="true" tabindex="-1"></a><span class="in">    results_list[[paste0("seed_", seed)]] &lt;- results</span></span>
<span id="cb194-1763"><a href="#cb194-1763" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb194-1764"><a href="#cb194-1764" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-1765"><a href="#cb194-1765" aria-hidden="true" tabindex="-1"></a><span class="in">  return(results_list)</span></span>
<span id="cb194-1766"><a href="#cb194-1766" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb194-1767"><a href="#cb194-1767" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-1768"><a href="#cb194-1768" aria-hidden="true" tabindex="-1"></a><span class="in">performance_adaboost_lasso &lt;- evaluate_with_seeds_AdaBoost_stepAUC(</span></span>
<span id="cb194-1769"><a href="#cb194-1769" aria-hidden="true" tabindex="-1"></a><span class="in">  evaluation_function = double_cross_validation_adaboost_lasso,</span></span>
<span id="cb194-1770"><a href="#cb194-1770" aria-hidden="true" tabindex="-1"></a><span class="in">  data = data_factor,</span></span>
<span id="cb194-1771"><a href="#cb194-1771" aria-hidden="true" tabindex="-1"></a><span class="in">  outer = 5,</span></span>
<span id="cb194-1772"><a href="#cb194-1772" aria-hidden="true" tabindex="-1"></a><span class="in">  inner = 2,</span></span>
<span id="cb194-1773"><a href="#cb194-1773" aria-hidden="true" tabindex="-1"></a><span class="in">  target_var = "PCR",</span></span>
<span id="cb194-1774"><a href="#cb194-1774" aria-hidden="true" tabindex="-1"></a><span class="in">  vars = todas_variables_factor,</span></span>
<span id="cb194-1775"><a href="#cb194-1775" aria-hidden="true" tabindex="-1"></a><span class="in">  threshold = .35,</span></span>
<span id="cb194-1776"><a href="#cb194-1776" aria-hidden="true" tabindex="-1"></a><span class="in">  iterations = c(50, 100, 150, 200),</span></span>
<span id="cb194-1777"><a href="#cb194-1777" aria-hidden="true" tabindex="-1"></a><span class="in">  seeds = seeds</span></span>
<span id="cb194-1778"><a href="#cb194-1778" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb194-1779"><a href="#cb194-1779" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-1780"><a href="#cb194-1780" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-1781"><a href="#cb194-1781" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message=FALSE, warning=FALSE}</span></span>
<span id="cb194-1782"><a href="#cb194-1782" aria-hidden="true" tabindex="-1"></a><span class="in">load("RData_Files_Algorithms/AdaBoost_Lasso.RData")</span></span>
<span id="cb194-1783"><a href="#cb194-1783" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-1784"><a href="#cb194-1784" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-1785"><a href="#cb194-1785" aria-hidden="true" tabindex="-1"></a><span class="fu">## Random Forest</span></span>
<span id="cb194-1786"><a href="#cb194-1786" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-1787"><a href="#cb194-1787" aria-hidden="true" tabindex="-1"></a><span class="fu">### Aparente</span></span>
<span id="cb194-1788"><a href="#cb194-1788" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-1789"><a href="#cb194-1789" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=FALSE}</span></span>
<span id="cb194-1790"><a href="#cb194-1790" aria-hidden="true" tabindex="-1"></a><span class="in">evaluate_apparent_performance_model_randomForest &lt;- function(data, target_var, model_func, vars = NULL, threshold = 0.5) {</span></span>
<span id="cb194-1791"><a href="#cb194-1791" aria-hidden="true" tabindex="-1"></a><span class="in">  if (is.null(vars)) {</span></span>
<span id="cb194-1792"><a href="#cb194-1792" aria-hidden="true" tabindex="-1"></a><span class="in">    vars &lt;- setdiff(names(data), target_var)</span></span>
<span id="cb194-1793"><a href="#cb194-1793" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb194-1794"><a href="#cb194-1794" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb194-1795"><a href="#cb194-1795" aria-hidden="true" tabindex="-1"></a><span class="in">  data[[target_var]] &lt;- factor(data[[target_var]], levels = c(0, 1))</span></span>
<span id="cb194-1796"><a href="#cb194-1796" aria-hidden="true" tabindex="-1"></a><span class="in">  formula &lt;- as.formula(paste(target_var, "~", paste(vars, collapse = "+")))</span></span>
<span id="cb194-1797"><a href="#cb194-1797" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb194-1798"><a href="#cb194-1798" aria-hidden="true" tabindex="-1"></a><span class="in">  model &lt;- model_func(formula, data)</span></span>
<span id="cb194-1799"><a href="#cb194-1799" aria-hidden="true" tabindex="-1"></a><span class="in">  predictions &lt;- predict(model, newdata = data, type = "prob")[, 2]</span></span>
<span id="cb194-1800"><a href="#cb194-1800" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb194-1801"><a href="#cb194-1801" aria-hidden="true" tabindex="-1"></a><span class="in">  actual_classes &lt;- data[[target_var]]</span></span>
<span id="cb194-1802"><a href="#cb194-1802" aria-hidden="true" tabindex="-1"></a><span class="in">  predicted_classes &lt;- ifelse(predictions &gt; threshold, 1, 0)</span></span>
<span id="cb194-1803"><a href="#cb194-1803" aria-hidden="true" tabindex="-1"></a><span class="in">  confusion_matrix &lt;- table(predicted_classes, actual_classes)</span></span>
<span id="cb194-1804"><a href="#cb194-1804" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb194-1805"><a href="#cb194-1805" aria-hidden="true" tabindex="-1"></a><span class="in">  tp &lt;- ifelse("1" %in% rownames(confusion_matrix) &amp;&amp; "1" %in% colnames(confusion_matrix), confusion_matrix["1", "1"], 0)</span></span>
<span id="cb194-1806"><a href="#cb194-1806" aria-hidden="true" tabindex="-1"></a><span class="in">  tn &lt;- ifelse("0" %in% rownames(confusion_matrix) &amp;&amp; "0" %in% colnames(confusion_matrix), confusion_matrix["0", "0"], 0)</span></span>
<span id="cb194-1807"><a href="#cb194-1807" aria-hidden="true" tabindex="-1"></a><span class="in">  fp &lt;- ifelse("1" %in% rownames(confusion_matrix) &amp;&amp; "0" %in% colnames(confusion_matrix), confusion_matrix["1", "0"], 0)</span></span>
<span id="cb194-1808"><a href="#cb194-1808" aria-hidden="true" tabindex="-1"></a><span class="in">  fn &lt;- ifelse("0" %in% rownames(confusion_matrix) &amp;&amp; "1" %in% colnames(confusion_matrix), confusion_matrix["0", "1"], 0)</span></span>
<span id="cb194-1809"><a href="#cb194-1809" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb194-1810"><a href="#cb194-1810" aria-hidden="true" tabindex="-1"></a><span class="in">  accuracy &lt;- (tp + tn) / (tp + tn + fp + fn)</span></span>
<span id="cb194-1811"><a href="#cb194-1811" aria-hidden="true" tabindex="-1"></a><span class="in">  precision &lt;- ifelse(tp + fp &gt; 0, tp / (tp + fp), 0)</span></span>
<span id="cb194-1812"><a href="#cb194-1812" aria-hidden="true" tabindex="-1"></a><span class="in">  recall &lt;- ifelse(tp + fn &gt; 0, tp / (tp + fn), 0)</span></span>
<span id="cb194-1813"><a href="#cb194-1813" aria-hidden="true" tabindex="-1"></a><span class="in">  f1_score &lt;- ifelse(precision + recall &gt; 0, 2 * (precision * recall) / (precision + recall), 0)</span></span>
<span id="cb194-1814"><a href="#cb194-1814" aria-hidden="true" tabindex="-1"></a><span class="in">  roc_obj &lt;- pROC::roc(actual_classes, predictions)</span></span>
<span id="cb194-1815"><a href="#cb194-1815" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb194-1816"><a href="#cb194-1816" aria-hidden="true" tabindex="-1"></a><span class="in">  list(confusion_matrix = confusion_matrix, accuracy = accuracy, precision = precision, </span></span>
<span id="cb194-1817"><a href="#cb194-1817" aria-hidden="true" tabindex="-1"></a><span class="in">       recall = recall, f1_score = f1_score, roc_curve = roc_obj)</span></span>
<span id="cb194-1818"><a href="#cb194-1818" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb194-1819"><a href="#cb194-1819" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-1820"><a href="#cb194-1820" aria-hidden="true" tabindex="-1"></a><span class="in">rf_model &lt;- function(formula, data) {</span></span>
<span id="cb194-1821"><a href="#cb194-1821" aria-hidden="true" tabindex="-1"></a><span class="in">  set.seed(90)</span></span>
<span id="cb194-1822"><a href="#cb194-1822" aria-hidden="true" tabindex="-1"></a><span class="in">  randomForest(formula = formula, data = data, ntree = 100, mtry = 2)</span></span>
<span id="cb194-1823"><a href="#cb194-1823" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb194-1824"><a href="#cb194-1824" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-1825"><a href="#cb194-1825" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-1826"><a href="#cb194-1826" aria-hidden="true" tabindex="-1"></a><span class="in">resultadosAparentesRF &lt;- evaluate_apparent_performance_model_randomForest(data = data_factor, target_var = "PCR",</span></span>
<span id="cb194-1827"><a href="#cb194-1827" aria-hidden="true" tabindex="-1"></a><span class="in">                                                             model_func = rf_model,</span></span>
<span id="cb194-1828"><a href="#cb194-1828" aria-hidden="true" tabindex="-1"></a><span class="in">                                                             vars = ".",</span></span>
<span id="cb194-1829"><a href="#cb194-1829" aria-hidden="true" tabindex="-1"></a><span class="in">                                                             threshold = .35)</span></span>
<span id="cb194-1830"><a href="#cb194-1830" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-1831"><a href="#cb194-1831" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-1832"><a href="#cb194-1832" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message=FALSE, warning=FALSE}</span></span>
<span id="cb194-1833"><a href="#cb194-1833" aria-hidden="true" tabindex="-1"></a><span class="in">load("RData_Files_Algorithms/RandomForest_Aparente.RData")</span></span>
<span id="cb194-1834"><a href="#cb194-1834" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-1835"><a href="#cb194-1835" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-1836"><a href="#cb194-1836" aria-hidden="true" tabindex="-1"></a><span class="fu">### Todas las Variables</span></span>
<span id="cb194-1837"><a href="#cb194-1837" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-1838"><a href="#cb194-1838" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=FALSE}</span></span>
<span id="cb194-1839"><a href="#cb194-1839" aria-hidden="true" tabindex="-1"></a><span class="in">double_cross_validation_randomforest &lt;- function(data, target_name, outer, inner, ntree_values, mtry_values, variables, threshold, seed) {</span></span>
<span id="cb194-1840"><a href="#cb194-1840" aria-hidden="true" tabindex="-1"></a><span class="in">  set.seed(seed)</span></span>
<span id="cb194-1841"><a href="#cb194-1841" aria-hidden="true" tabindex="-1"></a><span class="in">  performance_metrics &lt;- data.frame(Fold = integer(), TP = integer(), TN = integer(),</span></span>
<span id="cb194-1842"><a href="#cb194-1842" aria-hidden="true" tabindex="-1"></a><span class="in">                                    FP = integer(), FN = integer(), AUC = numeric(), </span></span>
<span id="cb194-1843"><a href="#cb194-1843" aria-hidden="true" tabindex="-1"></a><span class="in">                                    Best_ntree = integer(), Best_mtry = integer(), stringsAsFactors = FALSE)</span></span>
<span id="cb194-1844"><a href="#cb194-1844" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb194-1845"><a href="#cb194-1845" aria-hidden="true" tabindex="-1"></a><span class="in">  inner_fold_metrics &lt;- data.frame(Fold = integer(), Inner_Fold = integer(), </span></span>
<span id="cb194-1846"><a href="#cb194-1846" aria-hidden="true" tabindex="-1"></a><span class="in">                                   TP = integer(), TN = integer(), FP = integer(), </span></span>
<span id="cb194-1847"><a href="#cb194-1847" aria-hidden="true" tabindex="-1"></a><span class="in">                                   FN = integer(), AUC = numeric(), stringsAsFactors = FALSE)</span></span>
<span id="cb194-1848"><a href="#cb194-1848" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb194-1849"><a href="#cb194-1849" aria-hidden="true" tabindex="-1"></a><span class="in">  data[[target_name]] &lt;- as.factor(data[[target_name]])</span></span>
<span id="cb194-1850"><a href="#cb194-1850" aria-hidden="true" tabindex="-1"></a><span class="in">  outer_folds &lt;- createFolds(data[[target_name]], k = outer, list = TRUE, returnTrain = FALSE)</span></span>
<span id="cb194-1851"><a href="#cb194-1851" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb194-1852"><a href="#cb194-1852" aria-hidden="true" tabindex="-1"></a><span class="in">  for (outer_index in seq_along(outer_folds)) {</span></span>
<span id="cb194-1853"><a href="#cb194-1853" aria-hidden="true" tabindex="-1"></a><span class="in">    outer_train_data &lt;- data[-outer_folds[[outer_index]], ]</span></span>
<span id="cb194-1854"><a href="#cb194-1854" aria-hidden="true" tabindex="-1"></a><span class="in">    outer_test_data &lt;- data[outer_folds[[outer_index]], ]</span></span>
<span id="cb194-1855"><a href="#cb194-1855" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-1856"><a href="#cb194-1856" aria-hidden="true" tabindex="-1"></a><span class="in">    cat(sprintf("Outer Fold %d\n", outer_index))</span></span>
<span id="cb194-1857"><a href="#cb194-1857" aria-hidden="true" tabindex="-1"></a><span class="in">    cat("Training Data - Class 0: ", sum(outer_train_data[[target_name]] == "0"), "\n")</span></span>
<span id="cb194-1858"><a href="#cb194-1858" aria-hidden="true" tabindex="-1"></a><span class="in">    cat("Training Data - Class 1: ", sum(outer_train_data[[target_name]] == "1"), "\n")</span></span>
<span id="cb194-1859"><a href="#cb194-1859" aria-hidden="true" tabindex="-1"></a><span class="in">    cat("Testing Data - Class 0: ", sum(outer_test_data[[target_name]] == "0"), "\n")</span></span>
<span id="cb194-1860"><a href="#cb194-1860" aria-hidden="true" tabindex="-1"></a><span class="in">    cat("Testing Data - Class 1: ", sum(outer_test_data[[target_name]] == "1"), "\n")</span></span>
<span id="cb194-1861"><a href="#cb194-1861" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-1862"><a href="#cb194-1862" aria-hidden="true" tabindex="-1"></a><span class="in">    if (sum(outer_train_data[[target_name]] == "0") == 0 || sum(outer_train_data[[target_name]] == "1") == 0) {</span></span>
<span id="cb194-1863"><a href="#cb194-1863" aria-hidden="true" tabindex="-1"></a><span class="in">      cat("Skipping outer fold due to lack of class diversity\n")</span></span>
<span id="cb194-1864"><a href="#cb194-1864" aria-hidden="true" tabindex="-1"></a><span class="in">      next</span></span>
<span id="cb194-1865"><a href="#cb194-1865" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb194-1866"><a href="#cb194-1866" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-1867"><a href="#cb194-1867" aria-hidden="true" tabindex="-1"></a><span class="in">    inner_folds &lt;- createFolds(outer_train_data[[target_name]], k = inner, list = TRUE, returnTrain = FALSE)</span></span>
<span id="cb194-1868"><a href="#cb194-1868" aria-hidden="true" tabindex="-1"></a><span class="in">    best_model &lt;- NULL</span></span>
<span id="cb194-1869"><a href="#cb194-1869" aria-hidden="true" tabindex="-1"></a><span class="in">    best_auc &lt;- 0</span></span>
<span id="cb194-1870"><a href="#cb194-1870" aria-hidden="true" tabindex="-1"></a><span class="in">    best_ntree &lt;- NULL</span></span>
<span id="cb194-1871"><a href="#cb194-1871" aria-hidden="true" tabindex="-1"></a><span class="in">    best_mtry &lt;- NULL</span></span>
<span id="cb194-1872"><a href="#cb194-1872" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-1873"><a href="#cb194-1873" aria-hidden="true" tabindex="-1"></a><span class="in">    grid &lt;- expand.grid(ntree = ntree_values, mtry = mtry_values)</span></span>
<span id="cb194-1874"><a href="#cb194-1874" aria-hidden="true" tabindex="-1"></a><span class="in">    formula &lt;- reformulate(variables, target_name)</span></span>
<span id="cb194-1875"><a href="#cb194-1875" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-1876"><a href="#cb194-1876" aria-hidden="true" tabindex="-1"></a><span class="in">    for (params in 1:nrow(grid)) {</span></span>
<span id="cb194-1877"><a href="#cb194-1877" aria-hidden="true" tabindex="-1"></a><span class="in">      inner_auc &lt;- numeric()</span></span>
<span id="cb194-1878"><a href="#cb194-1878" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-1879"><a href="#cb194-1879" aria-hidden="true" tabindex="-1"></a><span class="in">      for (inner_index in seq_along(inner_folds)) {</span></span>
<span id="cb194-1880"><a href="#cb194-1880" aria-hidden="true" tabindex="-1"></a><span class="in">        inner_train_data &lt;- outer_train_data[-inner_folds[[inner_index]], ]</span></span>
<span id="cb194-1881"><a href="#cb194-1881" aria-hidden="true" tabindex="-1"></a><span class="in">        inner_test_data &lt;- outer_train_data[inner_folds[[inner_index]], ]</span></span>
<span id="cb194-1882"><a href="#cb194-1882" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-1883"><a href="#cb194-1883" aria-hidden="true" tabindex="-1"></a><span class="in">        if (sum(inner_train_data[[target_name]] == "0") == 0 || sum(inner_train_data[[target_name]] == "1") == 0) {</span></span>
<span id="cb194-1884"><a href="#cb194-1884" aria-hidden="true" tabindex="-1"></a><span class="in">          cat("Skipping inner fold due to lack of class diversity\n")</span></span>
<span id="cb194-1885"><a href="#cb194-1885" aria-hidden="true" tabindex="-1"></a><span class="in">          next</span></span>
<span id="cb194-1886"><a href="#cb194-1886" aria-hidden="true" tabindex="-1"></a><span class="in">        }</span></span>
<span id="cb194-1887"><a href="#cb194-1887" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-1888"><a href="#cb194-1888" aria-hidden="true" tabindex="-1"></a><span class="in">        result &lt;- tryCatch({</span></span>
<span id="cb194-1889"><a href="#cb194-1889" aria-hidden="true" tabindex="-1"></a><span class="in">          model &lt;- randomForest(formula, data = inner_train_data, ntree = grid$ntree[params], mtry = grid$mtry[params])</span></span>
<span id="cb194-1890"><a href="#cb194-1890" aria-hidden="true" tabindex="-1"></a><span class="in">          </span></span>
<span id="cb194-1891"><a href="#cb194-1891" aria-hidden="true" tabindex="-1"></a><span class="in">          predictions &lt;- predict(model, inner_test_data, type = "prob")[, 2]</span></span>
<span id="cb194-1892"><a href="#cb194-1892" aria-hidden="true" tabindex="-1"></a><span class="in">          roc_curve &lt;- roc(inner_test_data[[target_name]], predictions)</span></span>
<span id="cb194-1893"><a href="#cb194-1893" aria-hidden="true" tabindex="-1"></a><span class="in">          inner_auc[inner_index] &lt;- roc_curve$auc</span></span>
<span id="cb194-1894"><a href="#cb194-1894" aria-hidden="true" tabindex="-1"></a><span class="in">        }, error = function(e) {</span></span>
<span id="cb194-1895"><a href="#cb194-1895" aria-hidden="true" tabindex="-1"></a><span class="in">          cat("Error with parameters: ntree =", grid$ntree[params], ", mtry =", grid$mtry[params], "\n")</span></span>
<span id="cb194-1896"><a href="#cb194-1896" aria-hidden="true" tabindex="-1"></a><span class="in">          cat("Error message: ", e$message, "\n")</span></span>
<span id="cb194-1897"><a href="#cb194-1897" aria-hidden="true" tabindex="-1"></a><span class="in">          inner_auc[inner_index] &lt;- 0</span></span>
<span id="cb194-1898"><a href="#cb194-1898" aria-hidden="true" tabindex="-1"></a><span class="in">        })</span></span>
<span id="cb194-1899"><a href="#cb194-1899" aria-hidden="true" tabindex="-1"></a><span class="in">      }</span></span>
<span id="cb194-1900"><a href="#cb194-1900" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-1901"><a href="#cb194-1901" aria-hidden="true" tabindex="-1"></a><span class="in">      if (mean(inner_auc, na.rm = TRUE) &gt; best_auc) {</span></span>
<span id="cb194-1902"><a href="#cb194-1902" aria-hidden="true" tabindex="-1"></a><span class="in">        best_auc &lt;- mean(inner_auc, na.rm = TRUE)</span></span>
<span id="cb194-1903"><a href="#cb194-1903" aria-hidden="true" tabindex="-1"></a><span class="in">        best_model &lt;- model</span></span>
<span id="cb194-1904"><a href="#cb194-1904" aria-hidden="true" tabindex="-1"></a><span class="in">        best_ntree &lt;- grid$ntree[params]</span></span>
<span id="cb194-1905"><a href="#cb194-1905" aria-hidden="true" tabindex="-1"></a><span class="in">        best_mtry &lt;- grid$mtry[params]</span></span>
<span id="cb194-1906"><a href="#cb194-1906" aria-hidden="true" tabindex="-1"></a><span class="in">      }</span></span>
<span id="cb194-1907"><a href="#cb194-1907" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb194-1908"><a href="#cb194-1908" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-1909"><a href="#cb194-1909" aria-hidden="true" tabindex="-1"></a><span class="in">    if (is.null(best_model)) {</span></span>
<span id="cb194-1910"><a href="#cb194-1910" aria-hidden="true" tabindex="-1"></a><span class="in">      cat("No valid model found for outer fold ", outer_index, "\n")</span></span>
<span id="cb194-1911"><a href="#cb194-1911" aria-hidden="true" tabindex="-1"></a><span class="in">      next</span></span>
<span id="cb194-1912"><a href="#cb194-1912" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb194-1913"><a href="#cb194-1913" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-1914"><a href="#cb194-1914" aria-hidden="true" tabindex="-1"></a><span class="in">    # Evaluar el mejor modelo en el validation split del inner loop </span></span>
<span id="cb194-1915"><a href="#cb194-1915" aria-hidden="true" tabindex="-1"></a><span class="in">    inner_auc_vals &lt;- numeric()</span></span>
<span id="cb194-1916"><a href="#cb194-1916" aria-hidden="true" tabindex="-1"></a><span class="in">    for (inner_index in seq_along(inner_folds)) {</span></span>
<span id="cb194-1917"><a href="#cb194-1917" aria-hidden="true" tabindex="-1"></a><span class="in">      inner_train_data &lt;- outer_train_data[-inner_folds[[inner_index]], ]</span></span>
<span id="cb194-1918"><a href="#cb194-1918" aria-hidden="true" tabindex="-1"></a><span class="in">      inner_test_data &lt;- outer_train_data[inner_folds[[inner_index]], ]</span></span>
<span id="cb194-1919"><a href="#cb194-1919" aria-hidden="true" tabindex="-1"></a><span class="in">      </span></span>
<span id="cb194-1920"><a href="#cb194-1920" aria-hidden="true" tabindex="-1"></a><span class="in">      predictions &lt;- predict(best_model, inner_test_data, type = "prob")[, 2]</span></span>
<span id="cb194-1921"><a href="#cb194-1921" aria-hidden="true" tabindex="-1"></a><span class="in">      roc_curve &lt;- roc(inner_test_data[[target_name]], predictions)</span></span>
<span id="cb194-1922"><a href="#cb194-1922" aria-hidden="true" tabindex="-1"></a><span class="in">      inner_auc_vals[inner_index] &lt;- roc_curve$auc</span></span>
<span id="cb194-1923"><a href="#cb194-1923" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-1924"><a href="#cb194-1924" aria-hidden="true" tabindex="-1"></a><span class="in">      pred_class &lt;- ifelse(predictions &gt; threshold, "1", "0")</span></span>
<span id="cb194-1925"><a href="#cb194-1925" aria-hidden="true" tabindex="-1"></a><span class="in">      confusion &lt;- table(Actual = inner_test_data[[target_name]], Predicted = pred_class)</span></span>
<span id="cb194-1926"><a href="#cb194-1926" aria-hidden="true" tabindex="-1"></a><span class="in">      TP &lt;- ifelse(nrow(confusion) &gt;= 2 &amp;&amp; ncol(confusion) &gt;= 2, confusion[2, 2], 0)</span></span>
<span id="cb194-1927"><a href="#cb194-1927" aria-hidden="true" tabindex="-1"></a><span class="in">      TN &lt;- ifelse(nrow(confusion) &gt;= 1 &amp;&amp; ncol(confusion) &gt;= 1, confusion[1, 1], 0)</span></span>
<span id="cb194-1928"><a href="#cb194-1928" aria-hidden="true" tabindex="-1"></a><span class="in">      FP &lt;- ifelse(nrow(confusion) &gt;= 1 &amp;&amp; ncol(confusion) &gt;= 2, confusion[1, 2], 0)</span></span>
<span id="cb194-1929"><a href="#cb194-1929" aria-hidden="true" tabindex="-1"></a><span class="in">      FN &lt;- ifelse(nrow(confusion) &gt;= 2 &amp;&amp; ncol(confusion) &gt;= 1, confusion[2, 1], 0)</span></span>
<span id="cb194-1930"><a href="#cb194-1930" aria-hidden="true" tabindex="-1"></a><span class="in">      auc &lt;- roc_curve$auc</span></span>
<span id="cb194-1931"><a href="#cb194-1931" aria-hidden="true" tabindex="-1"></a><span class="in">      </span></span>
<span id="cb194-1932"><a href="#cb194-1932" aria-hidden="true" tabindex="-1"></a><span class="in">      inner_metrics &lt;- setNames(c(outer_index, inner_index, TP, TN, FP, FN, auc), names(inner_fold_metrics))</span></span>
<span id="cb194-1933"><a href="#cb194-1933" aria-hidden="true" tabindex="-1"></a><span class="in">      inner_fold_metrics &lt;- rbind(inner_fold_metrics, as.data.frame(t(inner_metrics)))</span></span>
<span id="cb194-1934"><a href="#cb194-1934" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb194-1935"><a href="#cb194-1935" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-1936"><a href="#cb194-1936" aria-hidden="true" tabindex="-1"></a><span class="in">    best_model &lt;- randomForest(formula, data = outer_train_data, ntree = best_ntree, mtry = best_mtry)</span></span>
<span id="cb194-1937"><a href="#cb194-1937" aria-hidden="true" tabindex="-1"></a><span class="in">    predictions &lt;- predict(best_model, outer_test_data, type = "prob")[, 2]</span></span>
<span id="cb194-1938"><a href="#cb194-1938" aria-hidden="true" tabindex="-1"></a><span class="in">    pred_class &lt;- ifelse(predictions &gt; threshold, "1", "0")</span></span>
<span id="cb194-1939"><a href="#cb194-1939" aria-hidden="true" tabindex="-1"></a><span class="in">    confusion &lt;- table(Actual = outer_test_data[[target_name]], Predicted = pred_class)</span></span>
<span id="cb194-1940"><a href="#cb194-1940" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-1941"><a href="#cb194-1941" aria-hidden="true" tabindex="-1"></a><span class="in">    if (nrow(confusion) &lt; 2 || ncol(confusion) &lt; 2) {</span></span>
<span id="cb194-1942"><a href="#cb194-1942" aria-hidden="true" tabindex="-1"></a><span class="in">      TP &lt;- ifelse(nrow(confusion) &gt;= 2 &amp;&amp; ncol(confusion) &gt;= 2, confusion[2, 2], 0)</span></span>
<span id="cb194-1943"><a href="#cb194-1943" aria-hidden="true" tabindex="-1"></a><span class="in">      TN &lt;- ifelse(nrow(confusion) &gt;= 1 &amp;&amp; ncol(confusion) &gt;= 1, confusion[1, 1], 0)</span></span>
<span id="cb194-1944"><a href="#cb194-1944" aria-hidden="true" tabindex="-1"></a><span class="in">      FP &lt;- ifelse(nrow(confusion) &gt;= 1 &amp;&amp; ncol(confusion) &gt;= 2, confusion[1, 2], 0)</span></span>
<span id="cb194-1945"><a href="#cb194-1945" aria-hidden="true" tabindex="-1"></a><span class="in">      FN &lt;- ifelse(nrow(confusion) &gt;= 2 &amp;&amp; ncol(confusion) &gt;= 1, confusion[2, 1], 0)</span></span>
<span id="cb194-1946"><a href="#cb194-1946" aria-hidden="true" tabindex="-1"></a><span class="in">    } else {</span></span>
<span id="cb194-1947"><a href="#cb194-1947" aria-hidden="true" tabindex="-1"></a><span class="in">      TP &lt;- confusion[2, 2]</span></span>
<span id="cb194-1948"><a href="#cb194-1948" aria-hidden="true" tabindex="-1"></a><span class="in">      TN &lt;- confusion[1, 1]</span></span>
<span id="cb194-1949"><a href="#cb194-1949" aria-hidden="true" tabindex="-1"></a><span class="in">      FP &lt;- confusion[1, 2]</span></span>
<span id="cb194-1950"><a href="#cb194-1950" aria-hidden="true" tabindex="-1"></a><span class="in">      FN &lt;- confusion[2, 1]</span></span>
<span id="cb194-1951"><a href="#cb194-1951" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb194-1952"><a href="#cb194-1952" aria-hidden="true" tabindex="-1"></a><span class="in">    auc &lt;- roc(outer_test_data[[target_name]], predictions)$auc</span></span>
<span id="cb194-1953"><a href="#cb194-1953" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-1954"><a href="#cb194-1954" aria-hidden="true" tabindex="-1"></a><span class="in">    metrics &lt;- setNames(c(outer_index, TP, TN, FP, FN, auc, best_ntree, best_mtry), names(performance_metrics))</span></span>
<span id="cb194-1955"><a href="#cb194-1955" aria-hidden="true" tabindex="-1"></a><span class="in">    performance_metrics &lt;- rbind(performance_metrics, as.data.frame(t(metrics)))</span></span>
<span id="cb194-1956"><a href="#cb194-1956" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb194-1957"><a href="#cb194-1957" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-1958"><a href="#cb194-1958" aria-hidden="true" tabindex="-1"></a><span class="in">  return(list(performance_metrics = performance_metrics, inner_fold_metrics = inner_fold_metrics))</span></span>
<span id="cb194-1959"><a href="#cb194-1959" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb194-1960"><a href="#cb194-1960" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-1961"><a href="#cb194-1961" aria-hidden="true" tabindex="-1"></a><span class="in">evaluate_with_seeds_RandomForest_TodasVariables_Asociacion &lt;- </span></span>
<span id="cb194-1962"><a href="#cb194-1962" aria-hidden="true" tabindex="-1"></a><span class="in">  function(evaluation_function, data, target_var, vars, threshold, seeds, outer, inner, ntree_values , mtry_values) {</span></span>
<span id="cb194-1963"><a href="#cb194-1963" aria-hidden="true" tabindex="-1"></a><span class="in">  results_list &lt;- list()</span></span>
<span id="cb194-1964"><a href="#cb194-1964" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-1965"><a href="#cb194-1965" aria-hidden="true" tabindex="-1"></a><span class="in">  for (seed in seeds) {</span></span>
<span id="cb194-1966"><a href="#cb194-1966" aria-hidden="true" tabindex="-1"></a><span class="in">    set.seed(seed)</span></span>
<span id="cb194-1967"><a href="#cb194-1967" aria-hidden="true" tabindex="-1"></a><span class="in">    cat("Evaluating with seed:", seed, "\n")</span></span>
<span id="cb194-1968"><a href="#cb194-1968" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-1969"><a href="#cb194-1969" aria-hidden="true" tabindex="-1"></a><span class="in">    results &lt;- evaluation_function(data = data, </span></span>
<span id="cb194-1970"><a href="#cb194-1970" aria-hidden="true" tabindex="-1"></a><span class="in">                                   target_name = target_var, </span></span>
<span id="cb194-1971"><a href="#cb194-1971" aria-hidden="true" tabindex="-1"></a><span class="in">                                   variables = vars, </span></span>
<span id="cb194-1972"><a href="#cb194-1972" aria-hidden="true" tabindex="-1"></a><span class="in">                                   threshold = threshold, </span></span>
<span id="cb194-1973"><a href="#cb194-1973" aria-hidden="true" tabindex="-1"></a><span class="in">                                   outer = outer, </span></span>
<span id="cb194-1974"><a href="#cb194-1974" aria-hidden="true" tabindex="-1"></a><span class="in">                                   inner = inner, </span></span>
<span id="cb194-1975"><a href="#cb194-1975" aria-hidden="true" tabindex="-1"></a><span class="in">                                   seed = seed,</span></span>
<span id="cb194-1976"><a href="#cb194-1976" aria-hidden="true" tabindex="-1"></a><span class="in">                                   ntree_values = ntree_values,</span></span>
<span id="cb194-1977"><a href="#cb194-1977" aria-hidden="true" tabindex="-1"></a><span class="in">                                   mtry_values = mtry_values)</span></span>
<span id="cb194-1978"><a href="#cb194-1978" aria-hidden="true" tabindex="-1"></a><span class="in">    results_list[[paste0("seed_", seed)]] &lt;- results</span></span>
<span id="cb194-1979"><a href="#cb194-1979" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb194-1980"><a href="#cb194-1980" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-1981"><a href="#cb194-1981" aria-hidden="true" tabindex="-1"></a><span class="in">  return(results_list)</span></span>
<span id="cb194-1982"><a href="#cb194-1982" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb194-1983"><a href="#cb194-1983" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-1984"><a href="#cb194-1984" aria-hidden="true" tabindex="-1"></a><span class="in">performance_RandomForest_todasvariables &lt;- evaluate_with_seeds_RandomForest_TodasVariables_Asociacion(</span></span>
<span id="cb194-1985"><a href="#cb194-1985" aria-hidden="true" tabindex="-1"></a><span class="in">  evaluation_function = double_cross_validation_randomforest,</span></span>
<span id="cb194-1986"><a href="#cb194-1986" aria-hidden="true" tabindex="-1"></a><span class="in">  data = data_factor,</span></span>
<span id="cb194-1987"><a href="#cb194-1987" aria-hidden="true" tabindex="-1"></a><span class="in">  outer = 5,</span></span>
<span id="cb194-1988"><a href="#cb194-1988" aria-hidden="true" tabindex="-1"></a><span class="in">  inner = 2,</span></span>
<span id="cb194-1989"><a href="#cb194-1989" aria-hidden="true" tabindex="-1"></a><span class="in">  target_var = "PCR",</span></span>
<span id="cb194-1990"><a href="#cb194-1990" aria-hidden="true" tabindex="-1"></a><span class="in">  ntree_values = c(100, 200, 300, 400, 500),###</span></span>
<span id="cb194-1991"><a href="#cb194-1991" aria-hidden="true" tabindex="-1"></a><span class="in">  mtry_values  = c(floor(sqrt(length(todas_variables_factor))), </span></span>
<span id="cb194-1992"><a href="#cb194-1992" aria-hidden="true" tabindex="-1"></a><span class="in">                   floor(sqrt(length(todas_variables_factor))) - 1, </span></span>
<span id="cb194-1993"><a href="#cb194-1993" aria-hidden="true" tabindex="-1"></a><span class="in">                   floor(sqrt(length(todas_variables_factor))) + 1),</span></span>
<span id="cb194-1994"><a href="#cb194-1994" aria-hidden="true" tabindex="-1"></a><span class="in">  vars = todas_variables_factor,</span></span>
<span id="cb194-1995"><a href="#cb194-1995" aria-hidden="true" tabindex="-1"></a><span class="in">  threshold = .35,</span></span>
<span id="cb194-1996"><a href="#cb194-1996" aria-hidden="true" tabindex="-1"></a><span class="in">  seeds = seeds</span></span>
<span id="cb194-1997"><a href="#cb194-1997" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb194-1998"><a href="#cb194-1998" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-1999"><a href="#cb194-1999" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-2000"><a href="#cb194-2000" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message=FALSE, warning=FALSE}</span></span>
<span id="cb194-2001"><a href="#cb194-2001" aria-hidden="true" tabindex="-1"></a><span class="in">load("RData_Files_Algorithms/RandomForest_TodasVariables.RData")</span></span>
<span id="cb194-2002"><a href="#cb194-2002" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-2003"><a href="#cb194-2003" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-2004"><a href="#cb194-2004" aria-hidden="true" tabindex="-1"></a><span class="fu">### Filtrado (Asociación)</span></span>
<span id="cb194-2005"><a href="#cb194-2005" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-2006"><a href="#cb194-2006" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=FALSE}</span></span>
<span id="cb194-2007"><a href="#cb194-2007" aria-hidden="true" tabindex="-1"></a><span class="in">performance_RandomForest_Aparente &lt;- evaluate_with_seeds_RandomForest_TodasVariables_Asociacion(</span></span>
<span id="cb194-2008"><a href="#cb194-2008" aria-hidden="true" tabindex="-1"></a><span class="in">  evaluation_function = double_cross_validation_randomforest,</span></span>
<span id="cb194-2009"><a href="#cb194-2009" aria-hidden="true" tabindex="-1"></a><span class="in">  data = data_factor,</span></span>
<span id="cb194-2010"><a href="#cb194-2010" aria-hidden="true" tabindex="-1"></a><span class="in">  outer = 5,</span></span>
<span id="cb194-2011"><a href="#cb194-2011" aria-hidden="true" tabindex="-1"></a><span class="in">  inner = 2,</span></span>
<span id="cb194-2012"><a href="#cb194-2012" aria-hidden="true" tabindex="-1"></a><span class="in">  target_var = "PCR",</span></span>
<span id="cb194-2013"><a href="#cb194-2013" aria-hidden="true" tabindex="-1"></a><span class="in">  ntree_values = c(100, 200, 300, 400, 500),###</span></span>
<span id="cb194-2014"><a href="#cb194-2014" aria-hidden="true" tabindex="-1"></a><span class="in">  mtry_values  = c(floor(sqrt(length(asociacion))), </span></span>
<span id="cb194-2015"><a href="#cb194-2015" aria-hidden="true" tabindex="-1"></a><span class="in">                   floor(sqrt(length(asociacion))) - 1, </span></span>
<span id="cb194-2016"><a href="#cb194-2016" aria-hidden="true" tabindex="-1"></a><span class="in">                   floor(sqrt(length(asociacion))) + 1),</span></span>
<span id="cb194-2017"><a href="#cb194-2017" aria-hidden="true" tabindex="-1"></a><span class="in">  vars = asociacion,</span></span>
<span id="cb194-2018"><a href="#cb194-2018" aria-hidden="true" tabindex="-1"></a><span class="in">  threshold = .35,</span></span>
<span id="cb194-2019"><a href="#cb194-2019" aria-hidden="true" tabindex="-1"></a><span class="in">  seeds = seeds</span></span>
<span id="cb194-2020"><a href="#cb194-2020" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb194-2021"><a href="#cb194-2021" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-2022"><a href="#cb194-2022" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-2023"><a href="#cb194-2023" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message=FALSE, warning=FALSE}</span></span>
<span id="cb194-2024"><a href="#cb194-2024" aria-hidden="true" tabindex="-1"></a><span class="in">load("RData_Files_Algorithms/RandomForest_Asociacion.RData")</span></span>
<span id="cb194-2025"><a href="#cb194-2025" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-2026"><a href="#cb194-2026" aria-hidden="true" tabindex="-1"></a><span class="fu">### Wrapped (StepAUC)</span></span>
<span id="cb194-2027"><a href="#cb194-2027" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-2028"><a href="#cb194-2028" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=FALSE}</span></span>
<span id="cb194-2029"><a href="#cb194-2029" aria-hidden="true" tabindex="-1"></a><span class="in">double_cross_validation_randomforest_stepAUC &lt;- function(data, target_name, outer, inner, ntree_values, mtry_values, variables, threshold, seed) {</span></span>
<span id="cb194-2030"><a href="#cb194-2030" aria-hidden="true" tabindex="-1"></a><span class="in">  set.seed(seed)</span></span>
<span id="cb194-2031"><a href="#cb194-2031" aria-hidden="true" tabindex="-1"></a><span class="in">  performance_metrics &lt;- data.frame(Fold = integer(), TP = integer(), TN = integer(),</span></span>
<span id="cb194-2032"><a href="#cb194-2032" aria-hidden="true" tabindex="-1"></a><span class="in">                                    FP = integer(), FN = integer(), AUC = numeric(),</span></span>
<span id="cb194-2033"><a href="#cb194-2033" aria-hidden="true" tabindex="-1"></a><span class="in">                                    Best_Ntree = integer(), Best_Mtry = integer(), </span></span>
<span id="cb194-2034"><a href="#cb194-2034" aria-hidden="true" tabindex="-1"></a><span class="in">                                    Best_Variables = character(), stringsAsFactors = FALSE)</span></span>
<span id="cb194-2035"><a href="#cb194-2035" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb194-2036"><a href="#cb194-2036" aria-hidden="true" tabindex="-1"></a><span class="in">  inner_fold_metrics &lt;- data.frame(Fold = integer(), Inner_Fold = integer(), </span></span>
<span id="cb194-2037"><a href="#cb194-2037" aria-hidden="true" tabindex="-1"></a><span class="in">                                   TP = integer(), TN = integer(), FP = integer(), </span></span>
<span id="cb194-2038"><a href="#cb194-2038" aria-hidden="true" tabindex="-1"></a><span class="in">                                   FN = integer(), AUC = numeric(), stringsAsFactors = FALSE)</span></span>
<span id="cb194-2039"><a href="#cb194-2039" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb194-2040"><a href="#cb194-2040" aria-hidden="true" tabindex="-1"></a><span class="in">  data[[target_name]] &lt;- as.factor(data[[target_name]])</span></span>
<span id="cb194-2041"><a href="#cb194-2041" aria-hidden="true" tabindex="-1"></a><span class="in">  outer_folds &lt;- createFolds(data[[target_name]], k = outer)</span></span>
<span id="cb194-2042"><a href="#cb194-2042" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb194-2043"><a href="#cb194-2043" aria-hidden="true" tabindex="-1"></a><span class="in">  for (outer_index in seq_along(outer_folds)) {</span></span>
<span id="cb194-2044"><a href="#cb194-2044" aria-hidden="true" tabindex="-1"></a><span class="in">    outer_train_data &lt;- data[-outer_folds[[outer_index]], ]</span></span>
<span id="cb194-2045"><a href="#cb194-2045" aria-hidden="true" tabindex="-1"></a><span class="in">    outer_test_data &lt;- data[outer_folds[[outer_index]], ]</span></span>
<span id="cb194-2046"><a href="#cb194-2046" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-2047"><a href="#cb194-2047" aria-hidden="true" tabindex="-1"></a><span class="in">    cat(sprintf("Outer Fold %d\n", outer_index))</span></span>
<span id="cb194-2048"><a href="#cb194-2048" aria-hidden="true" tabindex="-1"></a><span class="in">    cat("Training Data - Class 0: ", sum(outer_train_data[[target_name]] == "0"), "\n")</span></span>
<span id="cb194-2049"><a href="#cb194-2049" aria-hidden="true" tabindex="-1"></a><span class="in">    cat("Training Data - Class 1: ", sum(outer_train_data[[target_name]] == "1"), "\n")</span></span>
<span id="cb194-2050"><a href="#cb194-2050" aria-hidden="true" tabindex="-1"></a><span class="in">    cat("Testing Data - Class 0: ", sum(outer_test_data[[target_name]] == "0"), "\n")</span></span>
<span id="cb194-2051"><a href="#cb194-2051" aria-hidden="true" tabindex="-1"></a><span class="in">    cat("Testing Data - Class 1: ", sum(outer_test_data[[target_name]] == "1"), "\n")</span></span>
<span id="cb194-2052"><a href="#cb194-2052" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-2053"><a href="#cb194-2053" aria-hidden="true" tabindex="-1"></a><span class="in">    inner_folds &lt;- createFolds(outer_train_data[[target_name]], k = inner)</span></span>
<span id="cb194-2054"><a href="#cb194-2054" aria-hidden="true" tabindex="-1"></a><span class="in">    best_model &lt;- NULL</span></span>
<span id="cb194-2055"><a href="#cb194-2055" aria-hidden="true" tabindex="-1"></a><span class="in">    best_auc &lt;- 0</span></span>
<span id="cb194-2056"><a href="#cb194-2056" aria-hidden="true" tabindex="-1"></a><span class="in">    best_ntree &lt;- NULL</span></span>
<span id="cb194-2057"><a href="#cb194-2057" aria-hidden="true" tabindex="-1"></a><span class="in">    best_mtry &lt;- NULL</span></span>
<span id="cb194-2058"><a href="#cb194-2058" aria-hidden="true" tabindex="-1"></a><span class="in">    best_vars &lt;- variables</span></span>
<span id="cb194-2059"><a href="#cb194-2059" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-2060"><a href="#cb194-2060" aria-hidden="true" tabindex="-1"></a><span class="in">    grid &lt;- expand.grid(ntree = ntree_values, mtry = mtry_values)</span></span>
<span id="cb194-2061"><a href="#cb194-2061" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-2062"><a href="#cb194-2062" aria-hidden="true" tabindex="-1"></a><span class="in">    stepAUC &lt;- function(vars, data, target_name, grid, inner_folds) {</span></span>
<span id="cb194-2063"><a href="#cb194-2063" aria-hidden="true" tabindex="-1"></a><span class="in">      current_vars &lt;- vars</span></span>
<span id="cb194-2064"><a href="#cb194-2064" aria-hidden="true" tabindex="-1"></a><span class="in">      best_inner_auc &lt;- 0</span></span>
<span id="cb194-2065"><a href="#cb194-2065" aria-hidden="true" tabindex="-1"></a><span class="in">      best_inner_model &lt;- NULL</span></span>
<span id="cb194-2066"><a href="#cb194-2066" aria-hidden="true" tabindex="-1"></a><span class="in">      best_inner_ntree &lt;- NULL</span></span>
<span id="cb194-2067"><a href="#cb194-2067" aria-hidden="true" tabindex="-1"></a><span class="in">      best_inner_mtry &lt;- NULL</span></span>
<span id="cb194-2068"><a href="#cb194-2068" aria-hidden="true" tabindex="-1"></a><span class="in">      best_inner_vars &lt;- current_vars</span></span>
<span id="cb194-2069"><a href="#cb194-2069" aria-hidden="true" tabindex="-1"></a><span class="in">      improved &lt;- TRUE</span></span>
<span id="cb194-2070"><a href="#cb194-2070" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-2071"><a href="#cb194-2071" aria-hidden="true" tabindex="-1"></a><span class="in">      while (improved &amp;&amp; length(current_vars) &gt; 1) {</span></span>
<span id="cb194-2072"><a href="#cb194-2072" aria-hidden="true" tabindex="-1"></a><span class="in">        improved &lt;- FALSE</span></span>
<span id="cb194-2073"><a href="#cb194-2073" aria-hidden="true" tabindex="-1"></a><span class="in">        best_auc_in_step &lt;- best_inner_auc</span></span>
<span id="cb194-2074"><a href="#cb194-2074" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-2075"><a href="#cb194-2075" aria-hidden="true" tabindex="-1"></a><span class="in">        for (var in current_vars) {</span></span>
<span id="cb194-2076"><a href="#cb194-2076" aria-hidden="true" tabindex="-1"></a><span class="in">          temp_vars &lt;- setdiff(current_vars, var)</span></span>
<span id="cb194-2077"><a href="#cb194-2077" aria-hidden="true" tabindex="-1"></a><span class="in">          inner_auc &lt;- numeric()</span></span>
<span id="cb194-2078"><a href="#cb194-2078" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-2079"><a href="#cb194-2079" aria-hidden="true" tabindex="-1"></a><span class="in">          for (params in 1:nrow(grid)) {</span></span>
<span id="cb194-2080"><a href="#cb194-2080" aria-hidden="true" tabindex="-1"></a><span class="in">            auc_vals &lt;- numeric()</span></span>
<span id="cb194-2081"><a href="#cb194-2081" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-2082"><a href="#cb194-2082" aria-hidden="true" tabindex="-1"></a><span class="in">            for (inner_index in seq_along(inner_folds)) {</span></span>
<span id="cb194-2083"><a href="#cb194-2083" aria-hidden="true" tabindex="-1"></a><span class="in">              inner_train_data &lt;- data[-inner_folds[[inner_index]], ]</span></span>
<span id="cb194-2084"><a href="#cb194-2084" aria-hidden="true" tabindex="-1"></a><span class="in">              inner_test_data &lt;- data[inner_folds[[inner_index]], ]</span></span>
<span id="cb194-2085"><a href="#cb194-2085" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-2086"><a href="#cb194-2086" aria-hidden="true" tabindex="-1"></a><span class="in">              result &lt;- tryCatch({</span></span>
<span id="cb194-2087"><a href="#cb194-2087" aria-hidden="true" tabindex="-1"></a><span class="in">                model &lt;- randomForest(as.formula(paste(target_name, "~", paste(temp_vars, collapse = "+"))),</span></span>
<span id="cb194-2088"><a href="#cb194-2088" aria-hidden="true" tabindex="-1"></a><span class="in">                                      data = inner_train_data, ntree = grid$ntree[params], mtry = grid$mtry[params])</span></span>
<span id="cb194-2089"><a href="#cb194-2089" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-2090"><a href="#cb194-2090" aria-hidden="true" tabindex="-1"></a><span class="in">                predictions &lt;- predict(model, inner_test_data, type = "prob")[, 2]</span></span>
<span id="cb194-2091"><a href="#cb194-2091" aria-hidden="true" tabindex="-1"></a><span class="in">                roc_curve &lt;- roc(inner_test_data[[target_name]], predictions)</span></span>
<span id="cb194-2092"><a href="#cb194-2092" aria-hidden="true" tabindex="-1"></a><span class="in">                auc_vals[inner_index] &lt;- roc_curve$auc</span></span>
<span id="cb194-2093"><a href="#cb194-2093" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-2094"><a href="#cb194-2094" aria-hidden="true" tabindex="-1"></a><span class="in">              }, error = function(e) {</span></span>
<span id="cb194-2095"><a href="#cb194-2095" aria-hidden="true" tabindex="-1"></a><span class="in">                cat("Error with variables:", paste(temp_vars, collapse = ", "), "\n")</span></span>
<span id="cb194-2096"><a href="#cb194-2096" aria-hidden="true" tabindex="-1"></a><span class="in">                auc_vals[inner_index] &lt;- 0</span></span>
<span id="cb194-2097"><a href="#cb194-2097" aria-hidden="true" tabindex="-1"></a><span class="in">              })</span></span>
<span id="cb194-2098"><a href="#cb194-2098" aria-hidden="true" tabindex="-1"></a><span class="in">            }</span></span>
<span id="cb194-2099"><a href="#cb194-2099" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-2100"><a href="#cb194-2100" aria-hidden="true" tabindex="-1"></a><span class="in">            if (mean(auc_vals, na.rm = TRUE) &gt; best_auc_in_step) {</span></span>
<span id="cb194-2101"><a href="#cb194-2101" aria-hidden="true" tabindex="-1"></a><span class="in">              best_auc_in_step &lt;- mean(auc_vals, na.rm = TRUE)</span></span>
<span id="cb194-2102"><a href="#cb194-2102" aria-hidden="true" tabindex="-1"></a><span class="in">              best_inner_model &lt;- model</span></span>
<span id="cb194-2103"><a href="#cb194-2103" aria-hidden="true" tabindex="-1"></a><span class="in">              best_inner_ntree &lt;- grid$ntree[params]</span></span>
<span id="cb194-2104"><a href="#cb194-2104" aria-hidden="true" tabindex="-1"></a><span class="in">              best_inner_mtry &lt;- grid$mtry[params]</span></span>
<span id="cb194-2105"><a href="#cb194-2105" aria-hidden="true" tabindex="-1"></a><span class="in">              best_inner_vars &lt;- temp_vars</span></span>
<span id="cb194-2106"><a href="#cb194-2106" aria-hidden="true" tabindex="-1"></a><span class="in">              improved &lt;- TRUE</span></span>
<span id="cb194-2107"><a href="#cb194-2107" aria-hidden="true" tabindex="-1"></a><span class="in">            }</span></span>
<span id="cb194-2108"><a href="#cb194-2108" aria-hidden="true" tabindex="-1"></a><span class="in">          }</span></span>
<span id="cb194-2109"><a href="#cb194-2109" aria-hidden="true" tabindex="-1"></a><span class="in">        }</span></span>
<span id="cb194-2110"><a href="#cb194-2110" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-2111"><a href="#cb194-2111" aria-hidden="true" tabindex="-1"></a><span class="in">        if (improved) {</span></span>
<span id="cb194-2112"><a href="#cb194-2112" aria-hidden="true" tabindex="-1"></a><span class="in">          current_vars &lt;- best_inner_vars</span></span>
<span id="cb194-2113"><a href="#cb194-2113" aria-hidden="true" tabindex="-1"></a><span class="in">          best_inner_auc &lt;- best_auc_in_step</span></span>
<span id="cb194-2114"><a href="#cb194-2114" aria-hidden="true" tabindex="-1"></a><span class="in">          cat("Vars improved: ", paste(current_vars, collapse=", "), "\n")</span></span>
<span id="cb194-2115"><a href="#cb194-2115" aria-hidden="true" tabindex="-1"></a><span class="in">          cat("AUC: ", paste(best_inner_auc), "\n")</span></span>
<span id="cb194-2116"><a href="#cb194-2116" aria-hidden="true" tabindex="-1"></a><span class="in">        }</span></span>
<span id="cb194-2117"><a href="#cb194-2117" aria-hidden="true" tabindex="-1"></a><span class="in">      }</span></span>
<span id="cb194-2118"><a href="#cb194-2118" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-2119"><a href="#cb194-2119" aria-hidden="true" tabindex="-1"></a><span class="in">      list(model = best_inner_model, auc = best_inner_auc, </span></span>
<span id="cb194-2120"><a href="#cb194-2120" aria-hidden="true" tabindex="-1"></a><span class="in">           ntree = best_inner_ntree, mtry = best_inner_mtry, </span></span>
<span id="cb194-2121"><a href="#cb194-2121" aria-hidden="true" tabindex="-1"></a><span class="in">           vars = best_inner_vars)</span></span>
<span id="cb194-2122"><a href="#cb194-2122" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb194-2123"><a href="#cb194-2123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-2124"><a href="#cb194-2124" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-2125"><a href="#cb194-2125" aria-hidden="true" tabindex="-1"></a><span class="in">    best_result &lt;- stepAUC(variables, outer_train_data, target_name, grid, inner_folds)</span></span>
<span id="cb194-2126"><a href="#cb194-2126" aria-hidden="true" tabindex="-1"></a><span class="in">    best_model &lt;- best_result$model</span></span>
<span id="cb194-2127"><a href="#cb194-2127" aria-hidden="true" tabindex="-1"></a><span class="in">    best_auc &lt;- best_result$auc</span></span>
<span id="cb194-2128"><a href="#cb194-2128" aria-hidden="true" tabindex="-1"></a><span class="in">    best_ntree &lt;- best_result$ntree</span></span>
<span id="cb194-2129"><a href="#cb194-2129" aria-hidden="true" tabindex="-1"></a><span class="in">    best_mtry &lt;- best_result$mtry</span></span>
<span id="cb194-2130"><a href="#cb194-2130" aria-hidden="true" tabindex="-1"></a><span class="in">    best_vars &lt;- best_result$vars</span></span>
<span id="cb194-2131"><a href="#cb194-2131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-2132"><a href="#cb194-2132" aria-hidden="true" tabindex="-1"></a><span class="in">    # Evaluar el mejor modelo en el validation split del inner loop</span></span>
<span id="cb194-2133"><a href="#cb194-2133" aria-hidden="true" tabindex="-1"></a><span class="in">    inner_auc_vals &lt;- numeric()</span></span>
<span id="cb194-2134"><a href="#cb194-2134" aria-hidden="true" tabindex="-1"></a><span class="in">    for (inner_index in seq_along(inner_folds)) {</span></span>
<span id="cb194-2135"><a href="#cb194-2135" aria-hidden="true" tabindex="-1"></a><span class="in">      inner_train_data &lt;- outer_train_data[-inner_folds[[inner_index]], ]</span></span>
<span id="cb194-2136"><a href="#cb194-2136" aria-hidden="true" tabindex="-1"></a><span class="in">      inner_test_data &lt;- outer_train_data[inner_folds[[inner_index]], ]</span></span>
<span id="cb194-2137"><a href="#cb194-2137" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-2138"><a href="#cb194-2138" aria-hidden="true" tabindex="-1"></a><span class="in">      predictions &lt;- predict(best_model, inner_test_data, type = "prob")[, 2]</span></span>
<span id="cb194-2139"><a href="#cb194-2139" aria-hidden="true" tabindex="-1"></a><span class="in">      roc_curve &lt;- roc(inner_test_data[[target_name]], predictions)</span></span>
<span id="cb194-2140"><a href="#cb194-2140" aria-hidden="true" tabindex="-1"></a><span class="in">      inner_auc_vals[inner_index] &lt;- roc_curve$auc</span></span>
<span id="cb194-2141"><a href="#cb194-2141" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-2142"><a href="#cb194-2142" aria-hidden="true" tabindex="-1"></a><span class="in">      pred_class &lt;- ifelse(predictions &gt; threshold, "1", "0")</span></span>
<span id="cb194-2143"><a href="#cb194-2143" aria-hidden="true" tabindex="-1"></a><span class="in">      confusion &lt;- table(Actual = inner_test_data[[target_name]], Predicted = pred_class)</span></span>
<span id="cb194-2144"><a href="#cb194-2144" aria-hidden="true" tabindex="-1"></a><span class="in">      TP &lt;- ifelse(nrow(confusion) &gt;= 2 &amp;&amp; ncol(confusion) &gt;= 2, confusion[2, 2], 0)</span></span>
<span id="cb194-2145"><a href="#cb194-2145" aria-hidden="true" tabindex="-1"></a><span class="in">      TN &lt;- ifelse(nrow(confusion) &gt;= 1 &amp;&amp; ncol(confusion) &gt;= 1, confusion[1, 1], 0)</span></span>
<span id="cb194-2146"><a href="#cb194-2146" aria-hidden="true" tabindex="-1"></a><span class="in">      FP &lt;- ifelse(nrow(confusion) &gt;= 1 &amp;&amp; ncol(confusion) &gt;= 2, confusion[1, 2], 0)</span></span>
<span id="cb194-2147"><a href="#cb194-2147" aria-hidden="true" tabindex="-1"></a><span class="in">      FN &lt;- ifelse(nrow(confusion) &gt;= 2 &amp;&amp; ncol(confusion) &gt;= 1, confusion[2, 1], 0)</span></span>
<span id="cb194-2148"><a href="#cb194-2148" aria-hidden="true" tabindex="-1"></a><span class="in">      auc &lt;- roc_curve$auc</span></span>
<span id="cb194-2149"><a href="#cb194-2149" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-2150"><a href="#cb194-2150" aria-hidden="true" tabindex="-1"></a><span class="in">      inner_metrics &lt;- setNames(c(outer_index, inner_index, TP, TN, FP, FN, auc), names(inner_fold_metrics))</span></span>
<span id="cb194-2151"><a href="#cb194-2151" aria-hidden="true" tabindex="-1"></a><span class="in">      inner_fold_metrics &lt;- rbind(inner_fold_metrics, as.data.frame(t(inner_metrics)))</span></span>
<span id="cb194-2152"><a href="#cb194-2152" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb194-2153"><a href="#cb194-2153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-2154"><a href="#cb194-2154" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-2155"><a href="#cb194-2155" aria-hidden="true" tabindex="-1"></a><span class="in">    best_inner_auc &lt;- mean(inner_auc_vals, na.rm = TRUE)</span></span>
<span id="cb194-2156"><a href="#cb194-2156" aria-hidden="true" tabindex="-1"></a><span class="in">    # Reentrenar el mejor modelo con todos los datos de outer_train_data</span></span>
<span id="cb194-2157"><a href="#cb194-2157" aria-hidden="true" tabindex="-1"></a><span class="in">    best_model &lt;- randomForest(as.formula(paste(target_name, "~", paste(best_vars, collapse = "+"))),</span></span>
<span id="cb194-2158"><a href="#cb194-2158" aria-hidden="true" tabindex="-1"></a><span class="in">                    data = outer_train_data, ntree = best_ntree, mtry = best_mtry)</span></span>
<span id="cb194-2159"><a href="#cb194-2159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-2160"><a href="#cb194-2160" aria-hidden="true" tabindex="-1"></a><span class="in">    predictions &lt;- predict(best_model, outer_test_data, type = "prob")[, 2]</span></span>
<span id="cb194-2161"><a href="#cb194-2161" aria-hidden="true" tabindex="-1"></a><span class="in">    pred_class &lt;- ifelse(predictions &gt; threshold, "1", "0")</span></span>
<span id="cb194-2162"><a href="#cb194-2162" aria-hidden="true" tabindex="-1"></a><span class="in">    confusion &lt;- table(Actual = outer_test_data[[target_name]], Predicted = pred_class)</span></span>
<span id="cb194-2163"><a href="#cb194-2163" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-2164"><a href="#cb194-2164" aria-hidden="true" tabindex="-1"></a><span class="in">    if (nrow(confusion) &lt; 2 || ncol(confusion) &lt; 2) {</span></span>
<span id="cb194-2165"><a href="#cb194-2165" aria-hidden="true" tabindex="-1"></a><span class="in">      TP &lt;- ifelse(nrow(confusion) &gt;= 2 &amp;&amp; ncol(confusion) &gt;= 2, confusion[2, 2], 0)</span></span>
<span id="cb194-2166"><a href="#cb194-2166" aria-hidden="true" tabindex="-1"></a><span class="in">      TN &lt;- ifelse(nrow(confusion) &gt;= 1 &amp;&amp; ncol(confusion) &gt;= 1, confusion[1, 1], 0)</span></span>
<span id="cb194-2167"><a href="#cb194-2167" aria-hidden="true" tabindex="-1"></a><span class="in">      FP &lt;- ifelse(nrow(confusion) &gt;= 1 &amp;&amp; ncol(confusion) &gt;= 2, confusion[1, 2], 0)</span></span>
<span id="cb194-2168"><a href="#cb194-2168" aria-hidden="true" tabindex="-1"></a><span class="in">      FN &lt;- ifelse(nrow(confusion) &gt;= 2 &amp;&amp; ncol(confusion) &gt;= 1, confusion[2, 1], 0)</span></span>
<span id="cb194-2169"><a href="#cb194-2169" aria-hidden="true" tabindex="-1"></a><span class="in">    } else {</span></span>
<span id="cb194-2170"><a href="#cb194-2170" aria-hidden="true" tabindex="-1"></a><span class="in">      TP &lt;- confusion[2, 2]</span></span>
<span id="cb194-2171"><a href="#cb194-2171" aria-hidden="true" tabindex="-1"></a><span class="in">      TN &lt;- confusion[1, 1]</span></span>
<span id="cb194-2172"><a href="#cb194-2172" aria-hidden="true" tabindex="-1"></a><span class="in">      FP &lt;- confusion[1, 2]</span></span>
<span id="cb194-2173"><a href="#cb194-2173" aria-hidden="true" tabindex="-1"></a><span class="in">      FN &lt;- confusion[2, 1]</span></span>
<span id="cb194-2174"><a href="#cb194-2174" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb194-2175"><a href="#cb194-2175" aria-hidden="true" tabindex="-1"></a><span class="in">    auc &lt;- roc(outer_test_data[[target_name]], predictions)$auc</span></span>
<span id="cb194-2176"><a href="#cb194-2176" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-2177"><a href="#cb194-2177" aria-hidden="true" tabindex="-1"></a><span class="in">    metrics &lt;- setNames(c(outer_index, TP, TN, FP, FN, auc, </span></span>
<span id="cb194-2178"><a href="#cb194-2178" aria-hidden="true" tabindex="-1"></a><span class="in">                          best_ntree, best_mtry, paste(best_vars, collapse = ",")), </span></span>
<span id="cb194-2179"><a href="#cb194-2179" aria-hidden="true" tabindex="-1"></a><span class="in">                        names(performance_metrics))</span></span>
<span id="cb194-2180"><a href="#cb194-2180" aria-hidden="true" tabindex="-1"></a><span class="in">    performance_metrics &lt;- rbind(performance_metrics, as.data.frame(t(metrics)))</span></span>
<span id="cb194-2181"><a href="#cb194-2181" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-2182"><a href="#cb194-2182" aria-hidden="true" tabindex="-1"></a><span class="in">    cat("Performance:", paste(performance_metrics))</span></span>
<span id="cb194-2183"><a href="#cb194-2183" aria-hidden="true" tabindex="-1"></a><span class="in">    cat(sprintf("Confusion Matrix for Fold %d:\n", outer_index))</span></span>
<span id="cb194-2184"><a href="#cb194-2184" aria-hidden="true" tabindex="-1"></a><span class="in">    print(confusion)</span></span>
<span id="cb194-2185"><a href="#cb194-2185" aria-hidden="true" tabindex="-1"></a><span class="in">    cat(sprintf("Metrics for Fold %d:\n", outer_index))</span></span>
<span id="cb194-2186"><a href="#cb194-2186" aria-hidden="true" tabindex="-1"></a><span class="in">    cat(sprintf("TP: %d, TN: %d, FP: %d, FN: %d, AUC: %f, Best Ntree: %d, Best Mtry: %d, Best Variables: %s\n",</span></span>
<span id="cb194-2187"><a href="#cb194-2187" aria-hidden="true" tabindex="-1"></a><span class="in">                TP, TN, FP, FN, auc, best_ntree, best_mtry, paste(best_vars, collapse = ",")))</span></span>
<span id="cb194-2188"><a href="#cb194-2188" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb194-2189"><a href="#cb194-2189" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb194-2190"><a href="#cb194-2190" aria-hidden="true" tabindex="-1"></a><span class="in">  return(list(performance_metrics = performance_metrics, inner_fold_metrics = inner_fold_metrics))</span></span>
<span id="cb194-2191"><a href="#cb194-2191" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb194-2192"><a href="#cb194-2192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-2193"><a href="#cb194-2193" aria-hidden="true" tabindex="-1"></a><span class="in">evaluate_with_seeds_RandomForest_StepAUC &lt;- </span></span>
<span id="cb194-2194"><a href="#cb194-2194" aria-hidden="true" tabindex="-1"></a><span class="in">  function(evaluation_function, data, target_var, vars, threshold, seeds, outer, inner, ntree_values, mtry_values) {</span></span>
<span id="cb194-2195"><a href="#cb194-2195" aria-hidden="true" tabindex="-1"></a><span class="in">  results_list &lt;- list()</span></span>
<span id="cb194-2196"><a href="#cb194-2196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-2197"><a href="#cb194-2197" aria-hidden="true" tabindex="-1"></a><span class="in">  for (seed in seeds) {</span></span>
<span id="cb194-2198"><a href="#cb194-2198" aria-hidden="true" tabindex="-1"></a><span class="in">    set.seed(seed)</span></span>
<span id="cb194-2199"><a href="#cb194-2199" aria-hidden="true" tabindex="-1"></a><span class="in">    cat("Evaluating with seed:", seed, "\n")</span></span>
<span id="cb194-2200"><a href="#cb194-2200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-2201"><a href="#cb194-2201" aria-hidden="true" tabindex="-1"></a><span class="in">    results &lt;- evaluation_function(data = data, </span></span>
<span id="cb194-2202"><a href="#cb194-2202" aria-hidden="true" tabindex="-1"></a><span class="in">                                   target_name = target_var, </span></span>
<span id="cb194-2203"><a href="#cb194-2203" aria-hidden="true" tabindex="-1"></a><span class="in">                                   variables = vars, </span></span>
<span id="cb194-2204"><a href="#cb194-2204" aria-hidden="true" tabindex="-1"></a><span class="in">                                   threshold = threshold, </span></span>
<span id="cb194-2205"><a href="#cb194-2205" aria-hidden="true" tabindex="-1"></a><span class="in">                                   outer = outer, </span></span>
<span id="cb194-2206"><a href="#cb194-2206" aria-hidden="true" tabindex="-1"></a><span class="in">                                   inner = inner, </span></span>
<span id="cb194-2207"><a href="#cb194-2207" aria-hidden="true" tabindex="-1"></a><span class="in">                                   seed = seed,</span></span>
<span id="cb194-2208"><a href="#cb194-2208" aria-hidden="true" tabindex="-1"></a><span class="in">                                   ntree_values = ntree_values,</span></span>
<span id="cb194-2209"><a href="#cb194-2209" aria-hidden="true" tabindex="-1"></a><span class="in">                                   mtry_values = mtry_values)</span></span>
<span id="cb194-2210"><a href="#cb194-2210" aria-hidden="true" tabindex="-1"></a><span class="in">    results_list[[paste0("seed_", seed)]] &lt;- results</span></span>
<span id="cb194-2211"><a href="#cb194-2211" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb194-2212"><a href="#cb194-2212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-2213"><a href="#cb194-2213" aria-hidden="true" tabindex="-1"></a><span class="in">  return(results_list)</span></span>
<span id="cb194-2214"><a href="#cb194-2214" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb194-2215"><a href="#cb194-2215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-2216"><a href="#cb194-2216" aria-hidden="true" tabindex="-1"></a><span class="in">performance_RandomForest_StepAUC &lt;- evaluate_with_seeds_RandomForest_StepAUC(</span></span>
<span id="cb194-2217"><a href="#cb194-2217" aria-hidden="true" tabindex="-1"></a><span class="in">  evaluation_function = double_cross_validation_randomforest_stepAUC,</span></span>
<span id="cb194-2218"><a href="#cb194-2218" aria-hidden="true" tabindex="-1"></a><span class="in">  data = data_factor,</span></span>
<span id="cb194-2219"><a href="#cb194-2219" aria-hidden="true" tabindex="-1"></a><span class="in">  outer = 5,</span></span>
<span id="cb194-2220"><a href="#cb194-2220" aria-hidden="true" tabindex="-1"></a><span class="in">  inner = 2,</span></span>
<span id="cb194-2221"><a href="#cb194-2221" aria-hidden="true" tabindex="-1"></a><span class="in">  target_var = "PCR",</span></span>
<span id="cb194-2222"><a href="#cb194-2222" aria-hidden="true" tabindex="-1"></a><span class="in">  ntree_values = c(100, 200, 300, 400, 500),</span></span>
<span id="cb194-2223"><a href="#cb194-2223" aria-hidden="true" tabindex="-1"></a><span class="in">  mtry_values  = c(floor(sqrt(length(todas_variables_factor))), </span></span>
<span id="cb194-2224"><a href="#cb194-2224" aria-hidden="true" tabindex="-1"></a><span class="in">                   floor(sqrt(length(todas_variables_factor))) - 1, </span></span>
<span id="cb194-2225"><a href="#cb194-2225" aria-hidden="true" tabindex="-1"></a><span class="in">                   floor(sqrt(length(todas_variables_factor))) + 1),</span></span>
<span id="cb194-2226"><a href="#cb194-2226" aria-hidden="true" tabindex="-1"></a><span class="in">  vars = todas_variables_factor,</span></span>
<span id="cb194-2227"><a href="#cb194-2227" aria-hidden="true" tabindex="-1"></a><span class="in">  threshold = .35,</span></span>
<span id="cb194-2228"><a href="#cb194-2228" aria-hidden="true" tabindex="-1"></a><span class="in">  seeds = seeds</span></span>
<span id="cb194-2229"><a href="#cb194-2229" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb194-2230"><a href="#cb194-2230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-2231"><a href="#cb194-2231" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-2232"><a href="#cb194-2232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-2233"><a href="#cb194-2233" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message=FALSE, warning=FALSE}</span></span>
<span id="cb194-2234"><a href="#cb194-2234" aria-hidden="true" tabindex="-1"></a><span class="in">load("RData_Files_Algorithms/RandomForest_StepAUC.RData")</span></span>
<span id="cb194-2235"><a href="#cb194-2235" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-2236"><a href="#cb194-2236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-2237"><a href="#cb194-2237" aria-hidden="true" tabindex="-1"></a><span class="fu">### Embedded (Lasso)</span></span>
<span id="cb194-2238"><a href="#cb194-2238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-2239"><a href="#cb194-2239" aria-hidden="true" tabindex="-1"></a>Debido a dificultades del código, no se han podido obtener resultados del método de selección de variables **embedded** con el algoritmo *Lasso* para al modelo de Árbol de Decisión (DT).  </span>
<span id="cb194-2240"><a href="#cb194-2240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-2241"><a href="#cb194-2241" aria-hidden="true" tabindex="-1"></a><span class="fu">## Decision Tree</span></span>
<span id="cb194-2242"><a href="#cb194-2242" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-2243"><a href="#cb194-2243" aria-hidden="true" tabindex="-1"></a><span class="fu">### Aparente</span></span>
<span id="cb194-2244"><a href="#cb194-2244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-2245"><a href="#cb194-2245" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=FALSE}</span></span>
<span id="cb194-2246"><a href="#cb194-2246" aria-hidden="true" tabindex="-1"></a><span class="in">evaluate_aparent_performance_model_rpart &lt;- function(data, target_var, model_func, vars = NULL, threshold = 0.5) {</span></span>
<span id="cb194-2247"><a href="#cb194-2247" aria-hidden="true" tabindex="-1"></a><span class="in">  if (is.null(vars)) {</span></span>
<span id="cb194-2248"><a href="#cb194-2248" aria-hidden="true" tabindex="-1"></a><span class="in">    vars &lt;- setdiff(names(data), target_var)</span></span>
<span id="cb194-2249"><a href="#cb194-2249" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb194-2250"><a href="#cb194-2250" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb194-2251"><a href="#cb194-2251" aria-hidden="true" tabindex="-1"></a><span class="in">  data[[target_var]] &lt;- factor(data[[target_var]], levels = c(0, 1))</span></span>
<span id="cb194-2252"><a href="#cb194-2252" aria-hidden="true" tabindex="-1"></a><span class="in">  formula &lt;- as.formula(paste(target_var, "~", paste(vars, collapse = "+")))</span></span>
<span id="cb194-2253"><a href="#cb194-2253" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb194-2254"><a href="#cb194-2254" aria-hidden="true" tabindex="-1"></a><span class="in">  model &lt;- model_func(formula, data)</span></span>
<span id="cb194-2255"><a href="#cb194-2255" aria-hidden="true" tabindex="-1"></a><span class="in">  predictions &lt;- predict(model, newdata = data, type = "prob")[, 2]</span></span>
<span id="cb194-2256"><a href="#cb194-2256" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb194-2257"><a href="#cb194-2257" aria-hidden="true" tabindex="-1"></a><span class="in">  actual_classes &lt;- data[[target_var]]</span></span>
<span id="cb194-2258"><a href="#cb194-2258" aria-hidden="true" tabindex="-1"></a><span class="in">  predicted_classes &lt;- ifelse(predictions &gt; threshold, 1, 0)</span></span>
<span id="cb194-2259"><a href="#cb194-2259" aria-hidden="true" tabindex="-1"></a><span class="in">  confusion_matrix &lt;- table(predicted_classes, actual_classes)</span></span>
<span id="cb194-2260"><a href="#cb194-2260" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb194-2261"><a href="#cb194-2261" aria-hidden="true" tabindex="-1"></a><span class="in">  tp &lt;- ifelse("1" %in% rownames(confusion_matrix) &amp;&amp; "1" %in% colnames(confusion_matrix), confusion_matrix["1", "1"], 0)</span></span>
<span id="cb194-2262"><a href="#cb194-2262" aria-hidden="true" tabindex="-1"></a><span class="in">  tn &lt;- ifelse("0" %in% rownames(confusion_matrix) &amp;&amp; "0" %in% colnames(confusion_matrix), confusion_matrix["0", "0"], 0)</span></span>
<span id="cb194-2263"><a href="#cb194-2263" aria-hidden="true" tabindex="-1"></a><span class="in">  fp &lt;- ifelse("1" %in% rownames(confusion_matrix) &amp;&amp; "0" %in% colnames(confusion_matrix), confusion_matrix["1", "0"], 0)</span></span>
<span id="cb194-2264"><a href="#cb194-2264" aria-hidden="true" tabindex="-1"></a><span class="in">  fn &lt;- ifelse("0" %in% rownames(confusion_matrix) &amp;&amp; "1" %in% colnames(confusion_matrix), confusion_matrix["0", "1"], 0)</span></span>
<span id="cb194-2265"><a href="#cb194-2265" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb194-2266"><a href="#cb194-2266" aria-hidden="true" tabindex="-1"></a><span class="in">  accuracy &lt;- (tp + tn) / (tp + tn + fp + fn)</span></span>
<span id="cb194-2267"><a href="#cb194-2267" aria-hidden="true" tabindex="-1"></a><span class="in">  precision &lt;- ifelse(tp + fp &gt; 0, tp / (tp + fp), 0)</span></span>
<span id="cb194-2268"><a href="#cb194-2268" aria-hidden="true" tabindex="-1"></a><span class="in">  recall &lt;- ifelse(tp + fn &gt; 0, tp / (tp + fn), 0)</span></span>
<span id="cb194-2269"><a href="#cb194-2269" aria-hidden="true" tabindex="-1"></a><span class="in">  f1_score &lt;- ifelse(precision + recall &gt; 0, 2 * (precision * recall) / (precision + recall), 0)</span></span>
<span id="cb194-2270"><a href="#cb194-2270" aria-hidden="true" tabindex="-1"></a><span class="in">  roc_obj &lt;- pROC::roc(actual_classes, predictions)</span></span>
<span id="cb194-2271"><a href="#cb194-2271" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb194-2272"><a href="#cb194-2272" aria-hidden="true" tabindex="-1"></a><span class="in">  list(confusion_matrix = confusion_matrix, accuracy = accuracy, precision = precision, </span></span>
<span id="cb194-2273"><a href="#cb194-2273" aria-hidden="true" tabindex="-1"></a><span class="in">       recall = recall, f1_score = f1_score, roc_curve = roc_obj)</span></span>
<span id="cb194-2274"><a href="#cb194-2274" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb194-2275"><a href="#cb194-2275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-2276"><a href="#cb194-2276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-2277"><a href="#cb194-2277" aria-hidden="true" tabindex="-1"></a><span class="in">dt_model &lt;- function(formula, data) {</span></span>
<span id="cb194-2278"><a href="#cb194-2278" aria-hidden="true" tabindex="-1"></a><span class="in">  set.seed(90)</span></span>
<span id="cb194-2279"><a href="#cb194-2279" aria-hidden="true" tabindex="-1"></a><span class="in">  rpart(formula = formula, data = data, method = "class", control = rpart.control(minsplit = 2, cp = 0))</span></span>
<span id="cb194-2280"><a href="#cb194-2280" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb194-2281"><a href="#cb194-2281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-2282"><a href="#cb194-2282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-2283"><a href="#cb194-2283" aria-hidden="true" tabindex="-1"></a><span class="in">resultadosAparentesDT &lt;- evaluate_aparent_performance_model_rpart(data = data_factor, target_var = "PCR",</span></span>
<span id="cb194-2284"><a href="#cb194-2284" aria-hidden="true" tabindex="-1"></a><span class="in">                                                             model_func = dt_model,</span></span>
<span id="cb194-2285"><a href="#cb194-2285" aria-hidden="true" tabindex="-1"></a><span class="in">                                                             vars = ".",</span></span>
<span id="cb194-2286"><a href="#cb194-2286" aria-hidden="true" tabindex="-1"></a><span class="in">                                                             threshold = .35)</span></span>
<span id="cb194-2287"><a href="#cb194-2287" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-2288"><a href="#cb194-2288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-2289"><a href="#cb194-2289" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message=FALSE, warning=FALSE}</span></span>
<span id="cb194-2290"><a href="#cb194-2290" aria-hidden="true" tabindex="-1"></a><span class="in">load("RData_Files_Algorithms/DecisionTree_Aparente.RData")</span></span>
<span id="cb194-2291"><a href="#cb194-2291" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-2292"><a href="#cb194-2292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-2293"><a href="#cb194-2293" aria-hidden="true" tabindex="-1"></a><span class="fu">### Todas las Variables</span></span>
<span id="cb194-2294"><a href="#cb194-2294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-2295"><a href="#cb194-2295" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=FALSE}</span></span>
<span id="cb194-2296"><a href="#cb194-2296" aria-hidden="true" tabindex="-1"></a><span class="in">double_cross_validation_rpart &lt;- function(data, target_name, outer, inner, cp_values, minsplit_values, variables, threshold, seed) {</span></span>
<span id="cb194-2297"><a href="#cb194-2297" aria-hidden="true" tabindex="-1"></a><span class="in">  set.seed(seed)</span></span>
<span id="cb194-2298"><a href="#cb194-2298" aria-hidden="true" tabindex="-1"></a><span class="in">  performance_metrics &lt;- data.frame(Fold = integer(), TP = integer(), TN = integer(),</span></span>
<span id="cb194-2299"><a href="#cb194-2299" aria-hidden="true" tabindex="-1"></a><span class="in">                                    FP = integer(), FN = integer(), AUC = numeric(),</span></span>
<span id="cb194-2300"><a href="#cb194-2300" aria-hidden="true" tabindex="-1"></a><span class="in">                                    Best_cp = numeric(), Best_minsplit = integer(), stringsAsFactors = FALSE)</span></span>
<span id="cb194-2301"><a href="#cb194-2301" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb194-2302"><a href="#cb194-2302" aria-hidden="true" tabindex="-1"></a><span class="in">  inner_fold_metrics &lt;- data.frame(Fold = integer(), Inner_Fold = integer(), </span></span>
<span id="cb194-2303"><a href="#cb194-2303" aria-hidden="true" tabindex="-1"></a><span class="in">                                   TP = integer(), TN = integer(), FP = integer(), </span></span>
<span id="cb194-2304"><a href="#cb194-2304" aria-hidden="true" tabindex="-1"></a><span class="in">                                   FN = integer(), AUC = numeric(), stringsAsFactors = FALSE)</span></span>
<span id="cb194-2305"><a href="#cb194-2305" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb194-2306"><a href="#cb194-2306" aria-hidden="true" tabindex="-1"></a><span class="in">  data[[target_name]] &lt;- as.factor(data[[target_name]])</span></span>
<span id="cb194-2307"><a href="#cb194-2307" aria-hidden="true" tabindex="-1"></a><span class="in">  outer_folds &lt;- createFolds(data[[target_name]], k = outer)</span></span>
<span id="cb194-2308"><a href="#cb194-2308" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb194-2309"><a href="#cb194-2309" aria-hidden="true" tabindex="-1"></a><span class="in">  for (outer_index in seq_along(outer_folds)) {</span></span>
<span id="cb194-2310"><a href="#cb194-2310" aria-hidden="true" tabindex="-1"></a><span class="in">    outer_train_data &lt;- data[-outer_folds[[outer_index]], ]</span></span>
<span id="cb194-2311"><a href="#cb194-2311" aria-hidden="true" tabindex="-1"></a><span class="in">    outer_test_data &lt;- data[outer_folds[[outer_index]], ]</span></span>
<span id="cb194-2312"><a href="#cb194-2312" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-2313"><a href="#cb194-2313" aria-hidden="true" tabindex="-1"></a><span class="in">    # Imprime la cantidad de instancias de cada clase en el outer train y test set</span></span>
<span id="cb194-2314"><a href="#cb194-2314" aria-hidden="true" tabindex="-1"></a><span class="in">    cat(sprintf("Outer Fold %d\n", outer_index))</span></span>
<span id="cb194-2315"><a href="#cb194-2315" aria-hidden="true" tabindex="-1"></a><span class="in">    cat("Training Data - Class 0: ", sum(outer_train_data[[target_name]] == 0), "\n")</span></span>
<span id="cb194-2316"><a href="#cb194-2316" aria-hidden="true" tabindex="-1"></a><span class="in">    cat("Training Data - Class 1: ", sum(outer_train_data[[target_name]] == 1), "\n")</span></span>
<span id="cb194-2317"><a href="#cb194-2317" aria-hidden="true" tabindex="-1"></a><span class="in">    cat("Testing Data - Class 0: ", sum(outer_test_data[[target_name]] == 0), "\n")</span></span>
<span id="cb194-2318"><a href="#cb194-2318" aria-hidden="true" tabindex="-1"></a><span class="in">    cat("Testing Data - Class 1: ", sum(outer_test_data[[target_name]] == 1), "\n")</span></span>
<span id="cb194-2319"><a href="#cb194-2319" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-2320"><a href="#cb194-2320" aria-hidden="true" tabindex="-1"></a><span class="in">    inner_folds &lt;- createFolds(outer_train_data[[target_name]], k = inner)</span></span>
<span id="cb194-2321"><a href="#cb194-2321" aria-hidden="true" tabindex="-1"></a><span class="in">    best_model &lt;- NULL</span></span>
<span id="cb194-2322"><a href="#cb194-2322" aria-hidden="true" tabindex="-1"></a><span class="in">    best_auc &lt;- 0</span></span>
<span id="cb194-2323"><a href="#cb194-2323" aria-hidden="true" tabindex="-1"></a><span class="in">    best_cp &lt;- NULL</span></span>
<span id="cb194-2324"><a href="#cb194-2324" aria-hidden="true" tabindex="-1"></a><span class="in">    best_minsplit &lt;- NULL</span></span>
<span id="cb194-2325"><a href="#cb194-2325" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-2326"><a href="#cb194-2326" aria-hidden="true" tabindex="-1"></a><span class="in">    grid &lt;- expand.grid(cp = cp_values, minsplit = minsplit_values)</span></span>
<span id="cb194-2327"><a href="#cb194-2327" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-2328"><a href="#cb194-2328" aria-hidden="true" tabindex="-1"></a><span class="in">    for (params in 1:nrow(grid)) {</span></span>
<span id="cb194-2329"><a href="#cb194-2329" aria-hidden="true" tabindex="-1"></a><span class="in">      inner_auc &lt;- numeric()</span></span>
<span id="cb194-2330"><a href="#cb194-2330" aria-hidden="true" tabindex="-1"></a><span class="in">      </span></span>
<span id="cb194-2331"><a href="#cb194-2331" aria-hidden="true" tabindex="-1"></a><span class="in">      for (inner_index in seq_along(inner_folds)) {</span></span>
<span id="cb194-2332"><a href="#cb194-2332" aria-hidden="true" tabindex="-1"></a><span class="in">        inner_train_data &lt;- outer_train_data[-inner_folds[[inner_index]], ]</span></span>
<span id="cb194-2333"><a href="#cb194-2333" aria-hidden="true" tabindex="-1"></a><span class="in">        inner_test_data &lt;- outer_train_data[inner_folds[[inner_index]], ]</span></span>
<span id="cb194-2334"><a href="#cb194-2334" aria-hidden="true" tabindex="-1"></a><span class="in">        </span></span>
<span id="cb194-2335"><a href="#cb194-2335" aria-hidden="true" tabindex="-1"></a><span class="in">        model &lt;- rpart(formula = as.formula(paste(target_name, "~", paste(variables, collapse = "+"))),</span></span>
<span id="cb194-2336"><a href="#cb194-2336" aria-hidden="true" tabindex="-1"></a><span class="in">                       data = inner_train_data, control = rpart.control(cp = grid$cp[params], minsplit = grid$minsplit[params]))</span></span>
<span id="cb194-2337"><a href="#cb194-2337" aria-hidden="true" tabindex="-1"></a><span class="in">        </span></span>
<span id="cb194-2338"><a href="#cb194-2338" aria-hidden="true" tabindex="-1"></a><span class="in">        predictions &lt;- predict(model, inner_test_data, type = "prob")[, 2]</span></span>
<span id="cb194-2339"><a href="#cb194-2339" aria-hidden="true" tabindex="-1"></a><span class="in">        roc_curve &lt;- roc(inner_test_data[[target_name]], predictions)</span></span>
<span id="cb194-2340"><a href="#cb194-2340" aria-hidden="true" tabindex="-1"></a><span class="in">        inner_auc[inner_index] &lt;- roc_curve$auc</span></span>
<span id="cb194-2341"><a href="#cb194-2341" aria-hidden="true" tabindex="-1"></a><span class="in">      }</span></span>
<span id="cb194-2342"><a href="#cb194-2342" aria-hidden="true" tabindex="-1"></a><span class="in">      </span></span>
<span id="cb194-2343"><a href="#cb194-2343" aria-hidden="true" tabindex="-1"></a><span class="in">      if (mean(inner_auc) &gt; best_auc) {</span></span>
<span id="cb194-2344"><a href="#cb194-2344" aria-hidden="true" tabindex="-1"></a><span class="in">        best_auc = mean(inner_auc)</span></span>
<span id="cb194-2345"><a href="#cb194-2345" aria-hidden="true" tabindex="-1"></a><span class="in">        best_model = model</span></span>
<span id="cb194-2346"><a href="#cb194-2346" aria-hidden="true" tabindex="-1"></a><span class="in">        best_cp = grid$cp[params]</span></span>
<span id="cb194-2347"><a href="#cb194-2347" aria-hidden="true" tabindex="-1"></a><span class="in">        best_minsplit = grid$minsplit[params]</span></span>
<span id="cb194-2348"><a href="#cb194-2348" aria-hidden="true" tabindex="-1"></a><span class="in">      }</span></span>
<span id="cb194-2349"><a href="#cb194-2349" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb194-2350"><a href="#cb194-2350" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-2351"><a href="#cb194-2351" aria-hidden="true" tabindex="-1"></a><span class="in">    # Evaluar el mejor modelo en el validation split del inner loop </span></span>
<span id="cb194-2352"><a href="#cb194-2352" aria-hidden="true" tabindex="-1"></a><span class="in">    inner_auc_vals &lt;- numeric()</span></span>
<span id="cb194-2353"><a href="#cb194-2353" aria-hidden="true" tabindex="-1"></a><span class="in">    for (inner_index in seq_along(inner_folds)) {</span></span>
<span id="cb194-2354"><a href="#cb194-2354" aria-hidden="true" tabindex="-1"></a><span class="in">      inner_train_data &lt;- outer_train_data[-inner_folds[[inner_index]], ]</span></span>
<span id="cb194-2355"><a href="#cb194-2355" aria-hidden="true" tabindex="-1"></a><span class="in">      inner_test_data &lt;- outer_train_data[inner_folds[[inner_index]], ]</span></span>
<span id="cb194-2356"><a href="#cb194-2356" aria-hidden="true" tabindex="-1"></a><span class="in">      </span></span>
<span id="cb194-2357"><a href="#cb194-2357" aria-hidden="true" tabindex="-1"></a><span class="in">      predictions &lt;- predict(best_model, inner_test_data, type = "prob")[, 2]</span></span>
<span id="cb194-2358"><a href="#cb194-2358" aria-hidden="true" tabindex="-1"></a><span class="in">      roc_curve &lt;- roc(inner_test_data[[target_name]], predictions)</span></span>
<span id="cb194-2359"><a href="#cb194-2359" aria-hidden="true" tabindex="-1"></a><span class="in">      inner_auc_vals[inner_index] &lt;- roc_curve$auc</span></span>
<span id="cb194-2360"><a href="#cb194-2360" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-2361"><a href="#cb194-2361" aria-hidden="true" tabindex="-1"></a><span class="in">      pred_class &lt;- ifelse(predictions &gt; threshold, 1, 0)</span></span>
<span id="cb194-2362"><a href="#cb194-2362" aria-hidden="true" tabindex="-1"></a><span class="in">      confusion &lt;- table(Actual = inner_test_data[[target_name]], Predicted = pred_class)</span></span>
<span id="cb194-2363"><a href="#cb194-2363" aria-hidden="true" tabindex="-1"></a><span class="in">      TP &lt;- ifelse(nrow(confusion) &gt;= 2 &amp;&amp; ncol(confusion) &gt;= 2, confusion[2, 2], 0)</span></span>
<span id="cb194-2364"><a href="#cb194-2364" aria-hidden="true" tabindex="-1"></a><span class="in">      TN &lt;- ifelse(nrow(confusion) &gt;= 1 &amp;&amp; ncol(confusion) &gt;= 1, confusion[1, 1], 0)</span></span>
<span id="cb194-2365"><a href="#cb194-2365" aria-hidden="true" tabindex="-1"></a><span class="in">      FP &lt;- ifelse(nrow(confusion) &gt;= 1 &amp;&amp; ncol(confusion) &gt;= 2, confusion[1, 2], 0)</span></span>
<span id="cb194-2366"><a href="#cb194-2366" aria-hidden="true" tabindex="-1"></a><span class="in">      FN &lt;- ifelse(nrow(confusion) &gt;= 2 &amp;&amp; ncol(confusion) &gt;= 1, confusion[2, 1], 0)</span></span>
<span id="cb194-2367"><a href="#cb194-2367" aria-hidden="true" tabindex="-1"></a><span class="in">      auc &lt;- roc_curve$auc</span></span>
<span id="cb194-2368"><a href="#cb194-2368" aria-hidden="true" tabindex="-1"></a><span class="in">      </span></span>
<span id="cb194-2369"><a href="#cb194-2369" aria-hidden="true" tabindex="-1"></a><span class="in">      inner_metrics &lt;- setNames(c(outer_index, inner_index, TP, TN, FP, FN, auc), names(inner_fold_metrics))</span></span>
<span id="cb194-2370"><a href="#cb194-2370" aria-hidden="true" tabindex="-1"></a><span class="in">      inner_fold_metrics &lt;- rbind(inner_fold_metrics, as.data.frame(t(inner_metrics)))</span></span>
<span id="cb194-2371"><a href="#cb194-2371" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb194-2372"><a href="#cb194-2372" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-2373"><a href="#cb194-2373" aria-hidden="true" tabindex="-1"></a><span class="in">    best_model &lt;- rpart(formula = as.formula(paste(target_name, "~", paste(variables, collapse = "+"))),</span></span>
<span id="cb194-2374"><a href="#cb194-2374" aria-hidden="true" tabindex="-1"></a><span class="in">                       data = outer_train_data, control = rpart.control(cp = best_cp, minsplit = best_minsplit))</span></span>
<span id="cb194-2375"><a href="#cb194-2375" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-2376"><a href="#cb194-2376" aria-hidden="true" tabindex="-1"></a><span class="in">    predictions &lt;- predict(best_model, outer_test_data, type = "prob")[, 2]</span></span>
<span id="cb194-2377"><a href="#cb194-2377" aria-hidden="true" tabindex="-1"></a><span class="in">    pred_class &lt;- ifelse(predictions &gt; threshold, 1, 0)  # Asignar clases basadas en umbral</span></span>
<span id="cb194-2378"><a href="#cb194-2378" aria-hidden="true" tabindex="-1"></a><span class="in">    confusion &lt;- table(Actual = outer_test_data[[target_name]], Predicted = pred_class)</span></span>
<span id="cb194-2379"><a href="#cb194-2379" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-2380"><a href="#cb194-2380" aria-hidden="true" tabindex="-1"></a><span class="in">    if (nrow(confusion) &lt; 2 || ncol(confusion) &lt; 2) {</span></span>
<span id="cb194-2381"><a href="#cb194-2381" aria-hidden="true" tabindex="-1"></a><span class="in">      TP &lt;- ifelse(nrow(confusion) &gt;= 2 &amp;&amp; ncol(confusion) &gt;= 2, confusion[2, 2], 0)</span></span>
<span id="cb194-2382"><a href="#cb194-2382" aria-hidden="true" tabindex="-1"></a><span class="in">      TN &lt;- ifelse(nrow(confusion) &gt;= 1 &amp;&amp; ncol(confusion) &gt;= 1, confusion[1, 1], 0)</span></span>
<span id="cb194-2383"><a href="#cb194-2383" aria-hidden="true" tabindex="-1"></a><span class="in">      FP &lt;- ifelse(nrow(confusion) &gt;= 1 &amp;&amp; ncol(confusion) &gt;= 2, confusion[1, 2], 0)</span></span>
<span id="cb194-2384"><a href="#cb194-2384" aria-hidden="true" tabindex="-1"></a><span class="in">      FN &lt;- ifelse(nrow(confusion) &gt;= 2 &amp;&amp; ncol(confusion) &gt;= 1, confusion[2, 1], 0)</span></span>
<span id="cb194-2385"><a href="#cb194-2385" aria-hidden="true" tabindex="-1"></a><span class="in">    } else {</span></span>
<span id="cb194-2386"><a href="#cb194-2386" aria-hidden="true" tabindex="-1"></a><span class="in">      TP &lt;- confusion[2, 2]</span></span>
<span id="cb194-2387"><a href="#cb194-2387" aria-hidden="true" tabindex="-1"></a><span class="in">      TN &lt;- confusion[1, 1]</span></span>
<span id="cb194-2388"><a href="#cb194-2388" aria-hidden="true" tabindex="-1"></a><span class="in">      FP &lt;- confusion[1, 2]</span></span>
<span id="cb194-2389"><a href="#cb194-2389" aria-hidden="true" tabindex="-1"></a><span class="in">      FN &lt;- confusion[2, 1]</span></span>
<span id="cb194-2390"><a href="#cb194-2390" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb194-2391"><a href="#cb194-2391" aria-hidden="true" tabindex="-1"></a><span class="in">    auc = roc(outer_test_data[[target_name]], predictions)$auc</span></span>
<span id="cb194-2392"><a href="#cb194-2392" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-2393"><a href="#cb194-2393" aria-hidden="true" tabindex="-1"></a><span class="in">    metrics &lt;- setNames(c(outer_index, TP, TN, FP, FN, auc, best_cp, best_minsplit), names(performance_metrics))</span></span>
<span id="cb194-2394"><a href="#cb194-2394" aria-hidden="true" tabindex="-1"></a><span class="in">    performance_metrics &lt;- rbind(performance_metrics, as.data.frame(t(metrics)))</span></span>
<span id="cb194-2395"><a href="#cb194-2395" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb194-2396"><a href="#cb194-2396" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb194-2397"><a href="#cb194-2397" aria-hidden="true" tabindex="-1"></a><span class="in">  return(list(performance_metrics = performance_metrics, inner_fold_metrics = inner_fold_metrics))</span></span>
<span id="cb194-2398"><a href="#cb194-2398" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb194-2399"><a href="#cb194-2399" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-2400"><a href="#cb194-2400" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-2401"><a href="#cb194-2401" aria-hidden="true" tabindex="-1"></a><span class="in">evaluate_with_seeds_DecisionTree_TodasVariables_Asociacion &lt;- </span></span>
<span id="cb194-2402"><a href="#cb194-2402" aria-hidden="true" tabindex="-1"></a><span class="in">  function(evaluation_function, data, target_var, vars, threshold, seeds, outer, inner, cp_values, minsplit_values) {</span></span>
<span id="cb194-2403"><a href="#cb194-2403" aria-hidden="true" tabindex="-1"></a><span class="in">  results_list &lt;- list()</span></span>
<span id="cb194-2404"><a href="#cb194-2404" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-2405"><a href="#cb194-2405" aria-hidden="true" tabindex="-1"></a><span class="in">  for (seed in seeds) {</span></span>
<span id="cb194-2406"><a href="#cb194-2406" aria-hidden="true" tabindex="-1"></a><span class="in">    set.seed(seed)</span></span>
<span id="cb194-2407"><a href="#cb194-2407" aria-hidden="true" tabindex="-1"></a><span class="in">    cat("Evaluating with seed:", seed, "\n")</span></span>
<span id="cb194-2408"><a href="#cb194-2408" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-2409"><a href="#cb194-2409" aria-hidden="true" tabindex="-1"></a><span class="in">    results &lt;- evaluation_function(data = data, </span></span>
<span id="cb194-2410"><a href="#cb194-2410" aria-hidden="true" tabindex="-1"></a><span class="in">                                   target_name = target_var, </span></span>
<span id="cb194-2411"><a href="#cb194-2411" aria-hidden="true" tabindex="-1"></a><span class="in">                                   variables = vars, </span></span>
<span id="cb194-2412"><a href="#cb194-2412" aria-hidden="true" tabindex="-1"></a><span class="in">                                   threshold = threshold, </span></span>
<span id="cb194-2413"><a href="#cb194-2413" aria-hidden="true" tabindex="-1"></a><span class="in">                                   outer = outer, </span></span>
<span id="cb194-2414"><a href="#cb194-2414" aria-hidden="true" tabindex="-1"></a><span class="in">                                   inner = inner, </span></span>
<span id="cb194-2415"><a href="#cb194-2415" aria-hidden="true" tabindex="-1"></a><span class="in">                                   seed = seed,</span></span>
<span id="cb194-2416"><a href="#cb194-2416" aria-hidden="true" tabindex="-1"></a><span class="in">                                   cp_values = cp_values,</span></span>
<span id="cb194-2417"><a href="#cb194-2417" aria-hidden="true" tabindex="-1"></a><span class="in">                                   minsplit_values = minsplit_values)</span></span>
<span id="cb194-2418"><a href="#cb194-2418" aria-hidden="true" tabindex="-1"></a><span class="in">    results_list[[paste0("seed_", seed)]] &lt;- results</span></span>
<span id="cb194-2419"><a href="#cb194-2419" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb194-2420"><a href="#cb194-2420" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-2421"><a href="#cb194-2421" aria-hidden="true" tabindex="-1"></a><span class="in">  return(results_list)</span></span>
<span id="cb194-2422"><a href="#cb194-2422" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb194-2423"><a href="#cb194-2423" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-2424"><a href="#cb194-2424" aria-hidden="true" tabindex="-1"></a><span class="in">performance_rpart_todasvariables &lt;- evaluate_with_seeds_DecisionTree_TodasVariables_Asociacion(</span></span>
<span id="cb194-2425"><a href="#cb194-2425" aria-hidden="true" tabindex="-1"></a><span class="in">  evaluation_function = double_cross_validation_rpart,</span></span>
<span id="cb194-2426"><a href="#cb194-2426" aria-hidden="true" tabindex="-1"></a><span class="in">  data = data_factor,</span></span>
<span id="cb194-2427"><a href="#cb194-2427" aria-hidden="true" tabindex="-1"></a><span class="in">  outer = 5,</span></span>
<span id="cb194-2428"><a href="#cb194-2428" aria-hidden="true" tabindex="-1"></a><span class="in">  inner = 2,</span></span>
<span id="cb194-2429"><a href="#cb194-2429" aria-hidden="true" tabindex="-1"></a><span class="in">  target_var = "PCR",</span></span>
<span id="cb194-2430"><a href="#cb194-2430" aria-hidden="true" tabindex="-1"></a><span class="in">  cp_values = c(0.001, 0.01, 0.1),</span></span>
<span id="cb194-2431"><a href="#cb194-2431" aria-hidden="true" tabindex="-1"></a><span class="in">  minsplit_values = c(2, 5, 10, 15, 20),</span></span>
<span id="cb194-2432"><a href="#cb194-2432" aria-hidden="true" tabindex="-1"></a><span class="in">  vars = todas_variables_factor,</span></span>
<span id="cb194-2433"><a href="#cb194-2433" aria-hidden="true" tabindex="-1"></a><span class="in">  threshold = .35,</span></span>
<span id="cb194-2434"><a href="#cb194-2434" aria-hidden="true" tabindex="-1"></a><span class="in">  seeds = seeds</span></span>
<span id="cb194-2435"><a href="#cb194-2435" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb194-2436"><a href="#cb194-2436" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-2437"><a href="#cb194-2437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-2438"><a href="#cb194-2438" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message=FALSE, warning=FALSE}</span></span>
<span id="cb194-2439"><a href="#cb194-2439" aria-hidden="true" tabindex="-1"></a><span class="in">load("RData_Files_Algorithms/DecisionTree_TodasVariables.RData")</span></span>
<span id="cb194-2440"><a href="#cb194-2440" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-2441"><a href="#cb194-2441" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-2442"><a href="#cb194-2442" aria-hidden="true" tabindex="-1"></a><span class="fu">### Filtrado (Asociación)</span></span>
<span id="cb194-2443"><a href="#cb194-2443" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-2444"><a href="#cb194-2444" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=FALSE}</span></span>
<span id="cb194-2445"><a href="#cb194-2445" aria-hidden="true" tabindex="-1"></a><span class="in">performance_rpart_Asociacion &lt;- evaluate_with_seeds_DecisionTree_TodasVariables_Asociacion(</span></span>
<span id="cb194-2446"><a href="#cb194-2446" aria-hidden="true" tabindex="-1"></a><span class="in">  evaluation_function = double_cross_validation_rpart,</span></span>
<span id="cb194-2447"><a href="#cb194-2447" aria-hidden="true" tabindex="-1"></a><span class="in">  data = data_factor,</span></span>
<span id="cb194-2448"><a href="#cb194-2448" aria-hidden="true" tabindex="-1"></a><span class="in">  outer = 5,</span></span>
<span id="cb194-2449"><a href="#cb194-2449" aria-hidden="true" tabindex="-1"></a><span class="in">  inner = 2,</span></span>
<span id="cb194-2450"><a href="#cb194-2450" aria-hidden="true" tabindex="-1"></a><span class="in">  target_var = "PCR",</span></span>
<span id="cb194-2451"><a href="#cb194-2451" aria-hidden="true" tabindex="-1"></a><span class="in">  cp_values = c(0.001, 0.01, 0.1),</span></span>
<span id="cb194-2452"><a href="#cb194-2452" aria-hidden="true" tabindex="-1"></a><span class="in">  minsplit_values = c(2, 5, 10, 15, 20),</span></span>
<span id="cb194-2453"><a href="#cb194-2453" aria-hidden="true" tabindex="-1"></a><span class="in">  vars = asociacion,</span></span>
<span id="cb194-2454"><a href="#cb194-2454" aria-hidden="true" tabindex="-1"></a><span class="in">  threshold = .35,</span></span>
<span id="cb194-2455"><a href="#cb194-2455" aria-hidden="true" tabindex="-1"></a><span class="in">  seeds = seeds</span></span>
<span id="cb194-2456"><a href="#cb194-2456" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb194-2457"><a href="#cb194-2457" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-2458"><a href="#cb194-2458" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-2459"><a href="#cb194-2459" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message=FALSE, warning=FALSE}</span></span>
<span id="cb194-2460"><a href="#cb194-2460" aria-hidden="true" tabindex="-1"></a><span class="in">load("RData_Files_Algorithms/DecisionTree_Asociacion.RData")</span></span>
<span id="cb194-2461"><a href="#cb194-2461" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-2462"><a href="#cb194-2462" aria-hidden="true" tabindex="-1"></a><span class="fu">### Wrapped (StepAUC)</span></span>
<span id="cb194-2463"><a href="#cb194-2463" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-2464"><a href="#cb194-2464" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=FALSE}</span></span>
<span id="cb194-2465"><a href="#cb194-2465" aria-hidden="true" tabindex="-1"></a><span class="in">double_cross_validation_rpart_stepAUC &lt;- function(data, target_name, outer, inner, cps, minsplits, variables, threshold, seed) {</span></span>
<span id="cb194-2466"><a href="#cb194-2466" aria-hidden="true" tabindex="-1"></a><span class="in">  set.seed(seed)</span></span>
<span id="cb194-2467"><a href="#cb194-2467" aria-hidden="true" tabindex="-1"></a><span class="in">  performance_metrics &lt;- data.frame(Fold = integer(), TP = integer(), TN = integer(),</span></span>
<span id="cb194-2468"><a href="#cb194-2468" aria-hidden="true" tabindex="-1"></a><span class="in">                                    FP = integer(), FN = integer(), AUC = numeric(),</span></span>
<span id="cb194-2469"><a href="#cb194-2469" aria-hidden="true" tabindex="-1"></a><span class="in">                                    Best_CP = numeric(), Best_Minsplit = integer(), </span></span>
<span id="cb194-2470"><a href="#cb194-2470" aria-hidden="true" tabindex="-1"></a><span class="in">                                    Best_Variables = character(), stringsAsFactors = FALSE)</span></span>
<span id="cb194-2471"><a href="#cb194-2471" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb194-2472"><a href="#cb194-2472" aria-hidden="true" tabindex="-1"></a><span class="in">  inner_fold_metrics &lt;- data.frame(Fold = integer(), Inner_Fold = integer(), </span></span>
<span id="cb194-2473"><a href="#cb194-2473" aria-hidden="true" tabindex="-1"></a><span class="in">                                   TP = integer(), TN = integer(), FP = integer(), </span></span>
<span id="cb194-2474"><a href="#cb194-2474" aria-hidden="true" tabindex="-1"></a><span class="in">                                   FN = integer(), AUC = numeric(), stringsAsFactors = FALSE)</span></span>
<span id="cb194-2475"><a href="#cb194-2475" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb194-2476"><a href="#cb194-2476" aria-hidden="true" tabindex="-1"></a><span class="in">  data[[target_name]] &lt;- as.factor(data[[target_name]])</span></span>
<span id="cb194-2477"><a href="#cb194-2477" aria-hidden="true" tabindex="-1"></a><span class="in">  outer_folds &lt;- createFolds(data[[target_name]], k = outer)</span></span>
<span id="cb194-2478"><a href="#cb194-2478" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb194-2479"><a href="#cb194-2479" aria-hidden="true" tabindex="-1"></a><span class="in">  for (outer_index in seq_along(outer_folds)) {</span></span>
<span id="cb194-2480"><a href="#cb194-2480" aria-hidden="true" tabindex="-1"></a><span class="in">    outer_train_data &lt;- data[-outer_folds[[outer_index]], ]</span></span>
<span id="cb194-2481"><a href="#cb194-2481" aria-hidden="true" tabindex="-1"></a><span class="in">    outer_test_data &lt;- data[outer_folds[[outer_index]], ]</span></span>
<span id="cb194-2482"><a href="#cb194-2482" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-2483"><a href="#cb194-2483" aria-hidden="true" tabindex="-1"></a><span class="in">    cat(sprintf("Outer Fold %d\n", outer_index))</span></span>
<span id="cb194-2484"><a href="#cb194-2484" aria-hidden="true" tabindex="-1"></a><span class="in">    cat("Training Data - Class 0: ", sum(outer_train_data[[target_name]] == "0"), "\n")</span></span>
<span id="cb194-2485"><a href="#cb194-2485" aria-hidden="true" tabindex="-1"></a><span class="in">    cat("Training Data - Class 1: ", sum(outer_train_data[[target_name]] == "1"), "\n")</span></span>
<span id="cb194-2486"><a href="#cb194-2486" aria-hidden="true" tabindex="-1"></a><span class="in">    cat("Testing Data - Class 0: ", sum(outer_test_data[[target_name]] == "0"), "\n")</span></span>
<span id="cb194-2487"><a href="#cb194-2487" aria-hidden="true" tabindex="-1"></a><span class="in">    cat("Testing Data - Class 1: ", sum(outer_test_data[[target_name]] == "1"), "\n")</span></span>
<span id="cb194-2488"><a href="#cb194-2488" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-2489"><a href="#cb194-2489" aria-hidden="true" tabindex="-1"></a><span class="in">    inner_folds &lt;- createFolds(outer_train_data[[target_name]], k = inner)</span></span>
<span id="cb194-2490"><a href="#cb194-2490" aria-hidden="true" tabindex="-1"></a><span class="in">    best_model &lt;- NULL</span></span>
<span id="cb194-2491"><a href="#cb194-2491" aria-hidden="true" tabindex="-1"></a><span class="in">    best_auc &lt;- 0</span></span>
<span id="cb194-2492"><a href="#cb194-2492" aria-hidden="true" tabindex="-1"></a><span class="in">    best_cp &lt;- NULL</span></span>
<span id="cb194-2493"><a href="#cb194-2493" aria-hidden="true" tabindex="-1"></a><span class="in">    best_minsplit &lt;- NULL</span></span>
<span id="cb194-2494"><a href="#cb194-2494" aria-hidden="true" tabindex="-1"></a><span class="in">    best_vars &lt;- variables</span></span>
<span id="cb194-2495"><a href="#cb194-2495" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-2496"><a href="#cb194-2496" aria-hidden="true" tabindex="-1"></a><span class="in">    grid &lt;- expand.grid(cp = cps, minsplit = minsplits)</span></span>
<span id="cb194-2497"><a href="#cb194-2497" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-2498"><a href="#cb194-2498" aria-hidden="true" tabindex="-1"></a><span class="in">    stepAUC &lt;- function(vars, data, target_name, grid, inner_folds) {</span></span>
<span id="cb194-2499"><a href="#cb194-2499" aria-hidden="true" tabindex="-1"></a><span class="in">      current_vars &lt;- vars</span></span>
<span id="cb194-2500"><a href="#cb194-2500" aria-hidden="true" tabindex="-1"></a><span class="in">      best_inner_auc &lt;- 0</span></span>
<span id="cb194-2501"><a href="#cb194-2501" aria-hidden="true" tabindex="-1"></a><span class="in">      best_inner_model &lt;- NULL</span></span>
<span id="cb194-2502"><a href="#cb194-2502" aria-hidden="true" tabindex="-1"></a><span class="in">      best_inner_cp &lt;- NULL</span></span>
<span id="cb194-2503"><a href="#cb194-2503" aria-hidden="true" tabindex="-1"></a><span class="in">      best_inner_minsplit &lt;- NULL</span></span>
<span id="cb194-2504"><a href="#cb194-2504" aria-hidden="true" tabindex="-1"></a><span class="in">      best_inner_vars &lt;- current_vars</span></span>
<span id="cb194-2505"><a href="#cb194-2505" aria-hidden="true" tabindex="-1"></a><span class="in">      improved &lt;- TRUE</span></span>
<span id="cb194-2506"><a href="#cb194-2506" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-2507"><a href="#cb194-2507" aria-hidden="true" tabindex="-1"></a><span class="in">      while (improved &amp;&amp; length(current_vars) &gt; 1) {</span></span>
<span id="cb194-2508"><a href="#cb194-2508" aria-hidden="true" tabindex="-1"></a><span class="in">        improved &lt;- FALSE</span></span>
<span id="cb194-2509"><a href="#cb194-2509" aria-hidden="true" tabindex="-1"></a><span class="in">        best_auc_in_step &lt;- best_inner_auc</span></span>
<span id="cb194-2510"><a href="#cb194-2510" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-2511"><a href="#cb194-2511" aria-hidden="true" tabindex="-1"></a><span class="in">        for (var in current_vars) {</span></span>
<span id="cb194-2512"><a href="#cb194-2512" aria-hidden="true" tabindex="-1"></a><span class="in">          temp_vars &lt;- setdiff(current_vars, var)</span></span>
<span id="cb194-2513"><a href="#cb194-2513" aria-hidden="true" tabindex="-1"></a><span class="in">          inner_auc &lt;- numeric()</span></span>
<span id="cb194-2514"><a href="#cb194-2514" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-2515"><a href="#cb194-2515" aria-hidden="true" tabindex="-1"></a><span class="in">          for (params in 1:nrow(grid)) {</span></span>
<span id="cb194-2516"><a href="#cb194-2516" aria-hidden="true" tabindex="-1"></a><span class="in">            auc_vals &lt;- numeric()</span></span>
<span id="cb194-2517"><a href="#cb194-2517" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-2518"><a href="#cb194-2518" aria-hidden="true" tabindex="-1"></a><span class="in">            for (inner_index in seq_along(inner_folds)) {</span></span>
<span id="cb194-2519"><a href="#cb194-2519" aria-hidden="true" tabindex="-1"></a><span class="in">              inner_train_data &lt;- data[-inner_folds[[inner_index]], ]</span></span>
<span id="cb194-2520"><a href="#cb194-2520" aria-hidden="true" tabindex="-1"></a><span class="in">              inner_test_data &lt;- data[inner_folds[[inner_index]], ]</span></span>
<span id="cb194-2521"><a href="#cb194-2521" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-2522"><a href="#cb194-2522" aria-hidden="true" tabindex="-1"></a><span class="in">              result &lt;- tryCatch({</span></span>
<span id="cb194-2523"><a href="#cb194-2523" aria-hidden="true" tabindex="-1"></a><span class="in">                model &lt;- rpart(as.formula(paste(target_name, "~", paste(temp_vars, collapse = "+"))),</span></span>
<span id="cb194-2524"><a href="#cb194-2524" aria-hidden="true" tabindex="-1"></a><span class="in">                               data = inner_train_data, control = rpart.control(cp = grid$cp[params], minsplit = grid$minsplit[params]))</span></span>
<span id="cb194-2525"><a href="#cb194-2525" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-2526"><a href="#cb194-2526" aria-hidden="true" tabindex="-1"></a><span class="in">                predictions &lt;- predict(model, inner_test_data, type = "prob")[, 2]</span></span>
<span id="cb194-2527"><a href="#cb194-2527" aria-hidden="true" tabindex="-1"></a><span class="in">                roc_curve &lt;- roc(inner_test_data[[target_name]], predictions)</span></span>
<span id="cb194-2528"><a href="#cb194-2528" aria-hidden="true" tabindex="-1"></a><span class="in">                auc_vals[inner_index] &lt;- roc_curve$auc</span></span>
<span id="cb194-2529"><a href="#cb194-2529" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-2530"><a href="#cb194-2530" aria-hidden="true" tabindex="-1"></a><span class="in">              }, error = function(e) {</span></span>
<span id="cb194-2531"><a href="#cb194-2531" aria-hidden="true" tabindex="-1"></a><span class="in">                cat("Error with variables:", paste(temp_vars, collapse = ", "), "\n")</span></span>
<span id="cb194-2532"><a href="#cb194-2532" aria-hidden="true" tabindex="-1"></a><span class="in">                auc_vals[inner_index] &lt;- 0</span></span>
<span id="cb194-2533"><a href="#cb194-2533" aria-hidden="true" tabindex="-1"></a><span class="in">              })</span></span>
<span id="cb194-2534"><a href="#cb194-2534" aria-hidden="true" tabindex="-1"></a><span class="in">            }</span></span>
<span id="cb194-2535"><a href="#cb194-2535" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-2536"><a href="#cb194-2536" aria-hidden="true" tabindex="-1"></a><span class="in">            if (mean(auc_vals, na.rm = TRUE) &gt; best_auc_in_step) {</span></span>
<span id="cb194-2537"><a href="#cb194-2537" aria-hidden="true" tabindex="-1"></a><span class="in">              best_auc_in_step &lt;- mean(auc_vals, na.rm = TRUE)</span></span>
<span id="cb194-2538"><a href="#cb194-2538" aria-hidden="true" tabindex="-1"></a><span class="in">              best_inner_model &lt;- model</span></span>
<span id="cb194-2539"><a href="#cb194-2539" aria-hidden="true" tabindex="-1"></a><span class="in">              best_inner_cp &lt;- grid$cp[params]</span></span>
<span id="cb194-2540"><a href="#cb194-2540" aria-hidden="true" tabindex="-1"></a><span class="in">              best_inner_minsplit &lt;- grid$minsplit[params]</span></span>
<span id="cb194-2541"><a href="#cb194-2541" aria-hidden="true" tabindex="-1"></a><span class="in">              best_inner_vars &lt;- temp_vars</span></span>
<span id="cb194-2542"><a href="#cb194-2542" aria-hidden="true" tabindex="-1"></a><span class="in">              improved &lt;- TRUE</span></span>
<span id="cb194-2543"><a href="#cb194-2543" aria-hidden="true" tabindex="-1"></a><span class="in">            }</span></span>
<span id="cb194-2544"><a href="#cb194-2544" aria-hidden="true" tabindex="-1"></a><span class="in">          }</span></span>
<span id="cb194-2545"><a href="#cb194-2545" aria-hidden="true" tabindex="-1"></a><span class="in">        }</span></span>
<span id="cb194-2546"><a href="#cb194-2546" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-2547"><a href="#cb194-2547" aria-hidden="true" tabindex="-1"></a><span class="in">        if (improved) {</span></span>
<span id="cb194-2548"><a href="#cb194-2548" aria-hidden="true" tabindex="-1"></a><span class="in">          current_vars &lt;- best_inner_vars</span></span>
<span id="cb194-2549"><a href="#cb194-2549" aria-hidden="true" tabindex="-1"></a><span class="in">          best_inner_auc &lt;- best_auc_in_step</span></span>
<span id="cb194-2550"><a href="#cb194-2550" aria-hidden="true" tabindex="-1"></a><span class="in">          cat("Vars improved: ", paste(current_vars, collapse=", "), "\n")</span></span>
<span id="cb194-2551"><a href="#cb194-2551" aria-hidden="true" tabindex="-1"></a><span class="in">          cat("AUC: ", paste(best_inner_auc), "\n")</span></span>
<span id="cb194-2552"><a href="#cb194-2552" aria-hidden="true" tabindex="-1"></a><span class="in">        }</span></span>
<span id="cb194-2553"><a href="#cb194-2553" aria-hidden="true" tabindex="-1"></a><span class="in">      }</span></span>
<span id="cb194-2554"><a href="#cb194-2554" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-2555"><a href="#cb194-2555" aria-hidden="true" tabindex="-1"></a><span class="in">      list(model = best_inner_model, auc = best_inner_auc, </span></span>
<span id="cb194-2556"><a href="#cb194-2556" aria-hidden="true" tabindex="-1"></a><span class="in">           cp = best_inner_cp, minsplit = best_inner_minsplit, </span></span>
<span id="cb194-2557"><a href="#cb194-2557" aria-hidden="true" tabindex="-1"></a><span class="in">           vars = best_inner_vars)</span></span>
<span id="cb194-2558"><a href="#cb194-2558" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb194-2559"><a href="#cb194-2559" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-2560"><a href="#cb194-2560" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-2561"><a href="#cb194-2561" aria-hidden="true" tabindex="-1"></a><span class="in">    best_result &lt;- stepAUC(variables, outer_train_data, target_name, grid, inner_folds)</span></span>
<span id="cb194-2562"><a href="#cb194-2562" aria-hidden="true" tabindex="-1"></a><span class="in">    best_model &lt;- best_result$model</span></span>
<span id="cb194-2563"><a href="#cb194-2563" aria-hidden="true" tabindex="-1"></a><span class="in">    best_auc &lt;- best_result$auc</span></span>
<span id="cb194-2564"><a href="#cb194-2564" aria-hidden="true" tabindex="-1"></a><span class="in">    best_cp &lt;- best_result$cp</span></span>
<span id="cb194-2565"><a href="#cb194-2565" aria-hidden="true" tabindex="-1"></a><span class="in">    best_minsplit &lt;- best_result$minsplit</span></span>
<span id="cb194-2566"><a href="#cb194-2566" aria-hidden="true" tabindex="-1"></a><span class="in">    best_vars &lt;- best_result$vars</span></span>
<span id="cb194-2567"><a href="#cb194-2567" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-2568"><a href="#cb194-2568" aria-hidden="true" tabindex="-1"></a><span class="in">    # Evaluar el mejor modelo en el validation split del inner loop</span></span>
<span id="cb194-2569"><a href="#cb194-2569" aria-hidden="true" tabindex="-1"></a><span class="in">    inner_auc_vals &lt;- numeric()</span></span>
<span id="cb194-2570"><a href="#cb194-2570" aria-hidden="true" tabindex="-1"></a><span class="in">    for (inner_index in seq_along(inner_folds)) {</span></span>
<span id="cb194-2571"><a href="#cb194-2571" aria-hidden="true" tabindex="-1"></a><span class="in">      inner_train_data &lt;- outer_train_data[-inner_folds[[inner_index]], ]</span></span>
<span id="cb194-2572"><a href="#cb194-2572" aria-hidden="true" tabindex="-1"></a><span class="in">      inner_test_data &lt;- outer_train_data[inner_folds[[inner_index]], ]</span></span>
<span id="cb194-2573"><a href="#cb194-2573" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-2574"><a href="#cb194-2574" aria-hidden="true" tabindex="-1"></a><span class="in">      predictions &lt;- predict(best_model, inner_test_data, type = "prob")[, 2]</span></span>
<span id="cb194-2575"><a href="#cb194-2575" aria-hidden="true" tabindex="-1"></a><span class="in">      roc_curve &lt;- roc(inner_test_data[[target_name]], predictions)</span></span>
<span id="cb194-2576"><a href="#cb194-2576" aria-hidden="true" tabindex="-1"></a><span class="in">      inner_auc_vals[inner_index] &lt;- roc_curve$auc</span></span>
<span id="cb194-2577"><a href="#cb194-2577" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-2578"><a href="#cb194-2578" aria-hidden="true" tabindex="-1"></a><span class="in">      pred_class &lt;- ifelse(predictions &gt; threshold, "1", "0")</span></span>
<span id="cb194-2579"><a href="#cb194-2579" aria-hidden="true" tabindex="-1"></a><span class="in">      confusion &lt;- table(Actual = inner_test_data[[target_name]], Predicted = pred_class)</span></span>
<span id="cb194-2580"><a href="#cb194-2580" aria-hidden="true" tabindex="-1"></a><span class="in">      TP &lt;- ifelse(nrow(confusion) &gt;= 2 &amp;&amp; ncol(confusion) &gt;= 2, confusion[2, 2], 0)</span></span>
<span id="cb194-2581"><a href="#cb194-2581" aria-hidden="true" tabindex="-1"></a><span class="in">      TN &lt;- ifelse(nrow(confusion) &gt;= 1 &amp;&amp; ncol(confusion) &gt;= 1, confusion[1, 1], 0)</span></span>
<span id="cb194-2582"><a href="#cb194-2582" aria-hidden="true" tabindex="-1"></a><span class="in">      FP &lt;- ifelse(nrow(confusion) &gt;= 1 &amp;&amp; ncol(confusion) &gt;= 2, confusion[1, 2], 0)</span></span>
<span id="cb194-2583"><a href="#cb194-2583" aria-hidden="true" tabindex="-1"></a><span class="in">      FN &lt;- ifelse(nrow(confusion) &gt;= 2 &amp;&amp; ncol(confusion) &gt;= 1, confusion[2, 1], 0)</span></span>
<span id="cb194-2584"><a href="#cb194-2584" aria-hidden="true" tabindex="-1"></a><span class="in">      auc &lt;- roc_curve$auc</span></span>
<span id="cb194-2585"><a href="#cb194-2585" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-2586"><a href="#cb194-2586" aria-hidden="true" tabindex="-1"></a><span class="in">      inner_metrics &lt;- setNames(c(outer_index, inner_index, TP, TN, FP, FN, auc), names(inner_fold_metrics))</span></span>
<span id="cb194-2587"><a href="#cb194-2587" aria-hidden="true" tabindex="-1"></a><span class="in">      inner_fold_metrics &lt;- rbind(inner_fold_metrics, as.data.frame(t(inner_metrics)))</span></span>
<span id="cb194-2588"><a href="#cb194-2588" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb194-2589"><a href="#cb194-2589" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-2590"><a href="#cb194-2590" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-2591"><a href="#cb194-2591" aria-hidden="true" tabindex="-1"></a><span class="in">    best_inner_auc &lt;- mean(inner_auc_vals, na.rm = TRUE)</span></span>
<span id="cb194-2592"><a href="#cb194-2592" aria-hidden="true" tabindex="-1"></a><span class="in">    # Reentrenar el mejor modelo con todos los datos de outer_train_data</span></span>
<span id="cb194-2593"><a href="#cb194-2593" aria-hidden="true" tabindex="-1"></a><span class="in">    best_model &lt;- rpart(as.formula(paste(target_name, "~", paste(best_vars, collapse = "+"))),</span></span>
<span id="cb194-2594"><a href="#cb194-2594" aria-hidden="true" tabindex="-1"></a><span class="in">                    data = outer_train_data, control = rpart.control(cp = best_cp, minsplit = best_minsplit))</span></span>
<span id="cb194-2595"><a href="#cb194-2595" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-2596"><a href="#cb194-2596" aria-hidden="true" tabindex="-1"></a><span class="in">    predictions &lt;- predict(best_model, outer_test_data, type = "prob")[, 2]</span></span>
<span id="cb194-2597"><a href="#cb194-2597" aria-hidden="true" tabindex="-1"></a><span class="in">    pred_class &lt;- ifelse(predictions &gt; threshold, "1", "0")</span></span>
<span id="cb194-2598"><a href="#cb194-2598" aria-hidden="true" tabindex="-1"></a><span class="in">    confusion &lt;- table(Actual = outer_test_data[[target_name]], Predicted = pred_class)</span></span>
<span id="cb194-2599"><a href="#cb194-2599" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-2600"><a href="#cb194-2600" aria-hidden="true" tabindex="-1"></a><span class="in">    if (nrow(confusion) &lt; 2 || ncol(confusion) &lt; 2) {</span></span>
<span id="cb194-2601"><a href="#cb194-2601" aria-hidden="true" tabindex="-1"></a><span class="in">      TP &lt;- ifelse(nrow(confusion) &gt;= 2 &amp;&amp; ncol(confusion) &gt;= 2, confusion[2, 2], 0)</span></span>
<span id="cb194-2602"><a href="#cb194-2602" aria-hidden="true" tabindex="-1"></a><span class="in">      TN &lt;- ifelse(nrow(confusion) &gt;= 1 &amp;&amp; ncol(confusion) &gt;= 1, confusion[1, 1], 0)</span></span>
<span id="cb194-2603"><a href="#cb194-2603" aria-hidden="true" tabindex="-1"></a><span class="in">      FP &lt;- ifelse(nrow(confusion) &gt;= 1 &amp;&amp; ncol(confusion) &gt;= 2, confusion[1, 2], 0)</span></span>
<span id="cb194-2604"><a href="#cb194-2604" aria-hidden="true" tabindex="-1"></a><span class="in">      FN &lt;- ifelse(nrow(confusion) &gt;= 2 &amp;&amp; ncol(confusion) &gt;= 1, confusion[2, 1], 0)</span></span>
<span id="cb194-2605"><a href="#cb194-2605" aria-hidden="true" tabindex="-1"></a><span class="in">    } else {</span></span>
<span id="cb194-2606"><a href="#cb194-2606" aria-hidden="true" tabindex="-1"></a><span class="in">      TP &lt;- confusion[2, 2]</span></span>
<span id="cb194-2607"><a href="#cb194-2607" aria-hidden="true" tabindex="-1"></a><span class="in">      TN &lt;- confusion[1, 1]</span></span>
<span id="cb194-2608"><a href="#cb194-2608" aria-hidden="true" tabindex="-1"></a><span class="in">      FP &lt;- confusion[1, 2]</span></span>
<span id="cb194-2609"><a href="#cb194-2609" aria-hidden="true" tabindex="-1"></a><span class="in">      FN &lt;- confusion[2, 1]</span></span>
<span id="cb194-2610"><a href="#cb194-2610" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb194-2611"><a href="#cb194-2611" aria-hidden="true" tabindex="-1"></a><span class="in">    auc &lt;- roc(outer_test_data[[target_name]], predictions)$auc</span></span>
<span id="cb194-2612"><a href="#cb194-2612" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-2613"><a href="#cb194-2613" aria-hidden="true" tabindex="-1"></a><span class="in">    metrics &lt;- setNames(c(outer_index, TP, TN, FP, FN, auc, </span></span>
<span id="cb194-2614"><a href="#cb194-2614" aria-hidden="true" tabindex="-1"></a><span class="in">                          best_cp, best_minsplit, paste(best_vars, collapse = ",")), </span></span>
<span id="cb194-2615"><a href="#cb194-2615" aria-hidden="true" tabindex="-1"></a><span class="in">                        names(performance_metrics))</span></span>
<span id="cb194-2616"><a href="#cb194-2616" aria-hidden="true" tabindex="-1"></a><span class="in">    performance_metrics &lt;- rbind(performance_metrics, as.data.frame(t(metrics)))</span></span>
<span id="cb194-2617"><a href="#cb194-2617" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-2618"><a href="#cb194-2618" aria-hidden="true" tabindex="-1"></a><span class="in">    cat("Performance:", paste(performance_metrics))</span></span>
<span id="cb194-2619"><a href="#cb194-2619" aria-hidden="true" tabindex="-1"></a><span class="in">    cat(sprintf("Confusion Matrix for Fold %d:\n", outer_index))</span></span>
<span id="cb194-2620"><a href="#cb194-2620" aria-hidden="true" tabindex="-1"></a><span class="in">    print(confusion)</span></span>
<span id="cb194-2621"><a href="#cb194-2621" aria-hidden="true" tabindex="-1"></a><span class="in">    cat(sprintf("Metrics for Fold %d:\n", outer_index))</span></span>
<span id="cb194-2622"><a href="#cb194-2622" aria-hidden="true" tabindex="-1"></a><span class="in">    cat(sprintf("TP: %d, TN: %d, FP: %d, FN: %d, AUC: %f, Best CP: %f, Best Minsplit: %d, Best Variables: %s\n",</span></span>
<span id="cb194-2623"><a href="#cb194-2623" aria-hidden="true" tabindex="-1"></a><span class="in">                TP, TN, FP, FN, auc, best_cp, best_minsplit, paste(best_vars, collapse = ",")))</span></span>
<span id="cb194-2624"><a href="#cb194-2624" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb194-2625"><a href="#cb194-2625" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb194-2626"><a href="#cb194-2626" aria-hidden="true" tabindex="-1"></a><span class="in">  return(list(performance_metrics = performance_metrics, inner_fold_metrics = inner_fold_metrics))</span></span>
<span id="cb194-2627"><a href="#cb194-2627" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb194-2628"><a href="#cb194-2628" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-2629"><a href="#cb194-2629" aria-hidden="true" tabindex="-1"></a><span class="in">evaluate_with_seeds_DecisionTree_StepAUC &lt;- </span></span>
<span id="cb194-2630"><a href="#cb194-2630" aria-hidden="true" tabindex="-1"></a><span class="in">  function(evaluation_function, data, target_var, vars, threshold, seeds, outer, inner, cp_values, minsplit_values) {</span></span>
<span id="cb194-2631"><a href="#cb194-2631" aria-hidden="true" tabindex="-1"></a><span class="in">  results_list &lt;- list()</span></span>
<span id="cb194-2632"><a href="#cb194-2632" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-2633"><a href="#cb194-2633" aria-hidden="true" tabindex="-1"></a><span class="in">  for (seed in seeds) {</span></span>
<span id="cb194-2634"><a href="#cb194-2634" aria-hidden="true" tabindex="-1"></a><span class="in">    set.seed(seed)</span></span>
<span id="cb194-2635"><a href="#cb194-2635" aria-hidden="true" tabindex="-1"></a><span class="in">    cat("Evaluating with seed:", seed, "\n")</span></span>
<span id="cb194-2636"><a href="#cb194-2636" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-2637"><a href="#cb194-2637" aria-hidden="true" tabindex="-1"></a><span class="in">    results &lt;- evaluation_function(data = data, </span></span>
<span id="cb194-2638"><a href="#cb194-2638" aria-hidden="true" tabindex="-1"></a><span class="in">                                   target_name = target_var, </span></span>
<span id="cb194-2639"><a href="#cb194-2639" aria-hidden="true" tabindex="-1"></a><span class="in">                                   variables = vars, </span></span>
<span id="cb194-2640"><a href="#cb194-2640" aria-hidden="true" tabindex="-1"></a><span class="in">                                   threshold = threshold, </span></span>
<span id="cb194-2641"><a href="#cb194-2641" aria-hidden="true" tabindex="-1"></a><span class="in">                                   outer = outer, </span></span>
<span id="cb194-2642"><a href="#cb194-2642" aria-hidden="true" tabindex="-1"></a><span class="in">                                   inner = inner, </span></span>
<span id="cb194-2643"><a href="#cb194-2643" aria-hidden="true" tabindex="-1"></a><span class="in">                                   seed = seed,</span></span>
<span id="cb194-2644"><a href="#cb194-2644" aria-hidden="true" tabindex="-1"></a><span class="in">                                   cps = cp_values,</span></span>
<span id="cb194-2645"><a href="#cb194-2645" aria-hidden="true" tabindex="-1"></a><span class="in">                                   minsplits = minsplit_values)</span></span>
<span id="cb194-2646"><a href="#cb194-2646" aria-hidden="true" tabindex="-1"></a><span class="in">    results_list[[paste0("seed_", seed)]] &lt;- results</span></span>
<span id="cb194-2647"><a href="#cb194-2647" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb194-2648"><a href="#cb194-2648" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-2649"><a href="#cb194-2649" aria-hidden="true" tabindex="-1"></a><span class="in">  return(results_list)</span></span>
<span id="cb194-2650"><a href="#cb194-2650" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb194-2651"><a href="#cb194-2651" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-2652"><a href="#cb194-2652" aria-hidden="true" tabindex="-1"></a><span class="in">performance_rpart_StepAUC &lt;- evaluate_with_seeds_DecisionTree_StepAUC(</span></span>
<span id="cb194-2653"><a href="#cb194-2653" aria-hidden="true" tabindex="-1"></a><span class="in">  evaluation_function = double_cross_validation_rpart_stepAUC,</span></span>
<span id="cb194-2654"><a href="#cb194-2654" aria-hidden="true" tabindex="-1"></a><span class="in">  data = data_factor,</span></span>
<span id="cb194-2655"><a href="#cb194-2655" aria-hidden="true" tabindex="-1"></a><span class="in">  outer = 5,</span></span>
<span id="cb194-2656"><a href="#cb194-2656" aria-hidden="true" tabindex="-1"></a><span class="in">  inner = 2,</span></span>
<span id="cb194-2657"><a href="#cb194-2657" aria-hidden="true" tabindex="-1"></a><span class="in">  target_var = "PCR",</span></span>
<span id="cb194-2658"><a href="#cb194-2658" aria-hidden="true" tabindex="-1"></a><span class="in">  cp_values = c(0.001, 0.01, 0.1),</span></span>
<span id="cb194-2659"><a href="#cb194-2659" aria-hidden="true" tabindex="-1"></a><span class="in">  minsplit_values = c(2, 5, 10, 15, 20),</span></span>
<span id="cb194-2660"><a href="#cb194-2660" aria-hidden="true" tabindex="-1"></a><span class="in">  vars = todas_variables_factor,</span></span>
<span id="cb194-2661"><a href="#cb194-2661" aria-hidden="true" tabindex="-1"></a><span class="in">  threshold = .35,</span></span>
<span id="cb194-2662"><a href="#cb194-2662" aria-hidden="true" tabindex="-1"></a><span class="in">  seeds = seeds</span></span>
<span id="cb194-2663"><a href="#cb194-2663" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb194-2664"><a href="#cb194-2664" aria-hidden="true" tabindex="-1"></a><span class="in">performance_rpart_StepAUC</span></span>
<span id="cb194-2665"><a href="#cb194-2665" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-2666"><a href="#cb194-2666" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-2667"><a href="#cb194-2667" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message=FALSE, warning=FALSE}</span></span>
<span id="cb194-2668"><a href="#cb194-2668" aria-hidden="true" tabindex="-1"></a><span class="in">load("RData_Files_Algorithms/DecisionTree_StepAUC.RData")</span></span>
<span id="cb194-2669"><a href="#cb194-2669" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-2670"><a href="#cb194-2670" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-2671"><a href="#cb194-2671" aria-hidden="true" tabindex="-1"></a><span class="fu">### Embedded (Lasso)</span></span>
<span id="cb194-2672"><a href="#cb194-2672" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-2673"><a href="#cb194-2673" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=FALSE}</span></span>
<span id="cb194-2674"><a href="#cb194-2674" aria-hidden="true" tabindex="-1"></a><span class="in">double_cross_validation_rpart_Lasso &lt;- function(data, target_name, outer, inner, cps, minsplits, variables, threshold, seed) {</span></span>
<span id="cb194-2675"><a href="#cb194-2675" aria-hidden="true" tabindex="-1"></a><span class="in">  set.seed(seed)</span></span>
<span id="cb194-2676"><a href="#cb194-2676" aria-hidden="true" tabindex="-1"></a><span class="in">  performance_metrics &lt;- data.frame(Fold = integer(), TP = integer(), TN = integer(),</span></span>
<span id="cb194-2677"><a href="#cb194-2677" aria-hidden="true" tabindex="-1"></a><span class="in">                                    FP = integer(), FN = integer(), AUC = numeric(),</span></span>
<span id="cb194-2678"><a href="#cb194-2678" aria-hidden="true" tabindex="-1"></a><span class="in">                                    Best_cp = numeric(), Best_minsplit = numeric(), </span></span>
<span id="cb194-2679"><a href="#cb194-2679" aria-hidden="true" tabindex="-1"></a><span class="in">                                    Best_Variables = character(), stringsAsFactors = FALSE)</span></span>
<span id="cb194-2680"><a href="#cb194-2680" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb194-2681"><a href="#cb194-2681" aria-hidden="true" tabindex="-1"></a><span class="in">  inner_fold_metrics &lt;- data.frame(Fold = integer(), Inner_Fold = integer(), </span></span>
<span id="cb194-2682"><a href="#cb194-2682" aria-hidden="true" tabindex="-1"></a><span class="in">                                   TP = integer(), TN = integer(), FP = integer(), </span></span>
<span id="cb194-2683"><a href="#cb194-2683" aria-hidden="true" tabindex="-1"></a><span class="in">                                   FN = integer(), AUC = numeric(), stringsAsFactors = FALSE)</span></span>
<span id="cb194-2684"><a href="#cb194-2684" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb194-2685"><a href="#cb194-2685" aria-hidden="true" tabindex="-1"></a><span class="in">  # Convertir las variables del dataset con model.matrix</span></span>
<span id="cb194-2686"><a href="#cb194-2686" aria-hidden="true" tabindex="-1"></a><span class="in">  target &lt;- as.numeric(data[[target_name]]) - 1</span></span>
<span id="cb194-2687"><a href="#cb194-2687" aria-hidden="true" tabindex="-1"></a><span class="in">  features &lt;- data[, setdiff(names(data), target_name)]</span></span>
<span id="cb194-2688"><a href="#cb194-2688" aria-hidden="true" tabindex="-1"></a><span class="in">  data_matrix &lt;- as.data.frame(model.matrix(~ ., data=features)[,-1])  # Eliminar el intercepto</span></span>
<span id="cb194-2689"><a href="#cb194-2689" aria-hidden="true" tabindex="-1"></a><span class="in">  data_matrix[[target_name]] &lt;- target</span></span>
<span id="cb194-2690"><a href="#cb194-2690" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb194-2691"><a href="#cb194-2691" aria-hidden="true" tabindex="-1"></a><span class="in">  outer_folds &lt;- createFolds(data_matrix[[target_name]], k = outer)</span></span>
<span id="cb194-2692"><a href="#cb194-2692" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb194-2693"><a href="#cb194-2693" aria-hidden="true" tabindex="-1"></a><span class="in">  for (outer_index in seq_along(outer_folds)) {</span></span>
<span id="cb194-2694"><a href="#cb194-2694" aria-hidden="true" tabindex="-1"></a><span class="in">    outer_train_data &lt;- data_matrix[-outer_folds[[outer_index]], ]</span></span>
<span id="cb194-2695"><a href="#cb194-2695" aria-hidden="true" tabindex="-1"></a><span class="in">    outer_test_data &lt;- data_matrix[outer_folds[[outer_index]], ]</span></span>
<span id="cb194-2696"><a href="#cb194-2696" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-2697"><a href="#cb194-2697" aria-hidden="true" tabindex="-1"></a><span class="in">    cat(sprintf("Outer Fold %d\n", outer_index))</span></span>
<span id="cb194-2698"><a href="#cb194-2698" aria-hidden="true" tabindex="-1"></a><span class="in">    cat("Training Data - Class 0: ", sum(outer_train_data[[target_name]] == 0), "\n")</span></span>
<span id="cb194-2699"><a href="#cb194-2699" aria-hidden="true" tabindex="-1"></a><span class="in">    cat("Training Data - Class 1: ", sum(outer_train_data[[target_name]] == 1), "\n")</span></span>
<span id="cb194-2700"><a href="#cb194-2700" aria-hidden="true" tabindex="-1"></a><span class="in">    cat("Testing Data - Class 0: ", sum(outer_test_data[[target_name]] == 0), "\n")</span></span>
<span id="cb194-2701"><a href="#cb194-2701" aria-hidden="true" tabindex="-1"></a><span class="in">    cat("Testing Data - Class 1: ", sum(outer_test_data[[target_name]] == 1), "\n")</span></span>
<span id="cb194-2702"><a href="#cb194-2702" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-2703"><a href="#cb194-2703" aria-hidden="true" tabindex="-1"></a><span class="in">    inner_folds &lt;- createFolds(outer_train_data[[target_name]], k = inner)</span></span>
<span id="cb194-2704"><a href="#cb194-2704" aria-hidden="true" tabindex="-1"></a><span class="in">    best_model &lt;- NULL</span></span>
<span id="cb194-2705"><a href="#cb194-2705" aria-hidden="true" tabindex="-1"></a><span class="in">    best_auc &lt;- 0</span></span>
<span id="cb194-2706"><a href="#cb194-2706" aria-hidden="true" tabindex="-1"></a><span class="in">    best_cp &lt;- NULL</span></span>
<span id="cb194-2707"><a href="#cb194-2707" aria-hidden="true" tabindex="-1"></a><span class="in">    best_minsplit &lt;- NULL</span></span>
<span id="cb194-2708"><a href="#cb194-2708" aria-hidden="true" tabindex="-1"></a><span class="in">    best_vars &lt;- colnames(outer_train_data)[!colnames(outer_train_data) %in% target_name]</span></span>
<span id="cb194-2709"><a href="#cb194-2709" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-2710"><a href="#cb194-2710" aria-hidden="true" tabindex="-1"></a><span class="in">    grid &lt;- expand.grid(cp = cps, minsplit = minsplits)</span></span>
<span id="cb194-2711"><a href="#cb194-2711" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-2712"><a href="#cb194-2712" aria-hidden="true" tabindex="-1"></a><span class="in">    select_vars_lasso &lt;- function(data, target_name) {</span></span>
<span id="cb194-2713"><a href="#cb194-2713" aria-hidden="true" tabindex="-1"></a><span class="in">      target &lt;- as.numeric(data[[target_name]])</span></span>
<span id="cb194-2714"><a href="#cb194-2714" aria-hidden="true" tabindex="-1"></a><span class="in">      features &lt;- data[, setdiff(names(data), target_name)]</span></span>
<span id="cb194-2715"><a href="#cb194-2715" aria-hidden="true" tabindex="-1"></a><span class="in">      X &lt;- model.matrix(~ ., data=features)[,-1]  # Eliminamos el intercepto</span></span>
<span id="cb194-2716"><a href="#cb194-2716" aria-hidden="true" tabindex="-1"></a><span class="in">      y &lt;- target</span></span>
<span id="cb194-2717"><a href="#cb194-2717" aria-hidden="true" tabindex="-1"></a><span class="in">      </span></span>
<span id="cb194-2718"><a href="#cb194-2718" aria-hidden="true" tabindex="-1"></a><span class="in">      # Ajustamos el modelo Lasso</span></span>
<span id="cb194-2719"><a href="#cb194-2719" aria-hidden="true" tabindex="-1"></a><span class="in">      lasso_model &lt;- cv.glmnet(X, y, alpha=1)</span></span>
<span id="cb194-2720"><a href="#cb194-2720" aria-hidden="true" tabindex="-1"></a><span class="in">      lasso_coef &lt;- coef(lasso_model, s = "lambda.min")</span></span>
<span id="cb194-2721"><a href="#cb194-2721" aria-hidden="true" tabindex="-1"></a><span class="in">      </span></span>
<span id="cb194-2722"><a href="#cb194-2722" aria-hidden="true" tabindex="-1"></a><span class="in">      # Seleccionamos las variables no nulas</span></span>
<span id="cb194-2723"><a href="#cb194-2723" aria-hidden="true" tabindex="-1"></a><span class="in">      selected_vars &lt;- rownames(lasso_coef)[lasso_coef[, 1] != 0]</span></span>
<span id="cb194-2724"><a href="#cb194-2724" aria-hidden="true" tabindex="-1"></a><span class="in">      selected_vars &lt;- setdiff(selected_vars, "(Intercept)")</span></span>
<span id="cb194-2725"><a href="#cb194-2725" aria-hidden="true" tabindex="-1"></a><span class="in">      #cat("Selected variables by Lasso: ", paste(selected_vars, collapse=", "), "\n")</span></span>
<span id="cb194-2726"><a href="#cb194-2726" aria-hidden="true" tabindex="-1"></a><span class="in">      return(selected_vars)</span></span>
<span id="cb194-2727"><a href="#cb194-2727" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb194-2728"><a href="#cb194-2728" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-2729"><a href="#cb194-2729" aria-hidden="true" tabindex="-1"></a><span class="in">    stepAUC &lt;- function(vars, data, target_name, grid, inner_folds) {</span></span>
<span id="cb194-2730"><a href="#cb194-2730" aria-hidden="true" tabindex="-1"></a><span class="in">      best_inner_auc &lt;- 0</span></span>
<span id="cb194-2731"><a href="#cb194-2731" aria-hidden="true" tabindex="-1"></a><span class="in">      best_inner_model &lt;- NULL</span></span>
<span id="cb194-2732"><a href="#cb194-2732" aria-hidden="true" tabindex="-1"></a><span class="in">      best_inner_cp &lt;- NULL</span></span>
<span id="cb194-2733"><a href="#cb194-2733" aria-hidden="true" tabindex="-1"></a><span class="in">      best_inner_minsplit &lt;- NULL</span></span>
<span id="cb194-2734"><a href="#cb194-2734" aria-hidden="true" tabindex="-1"></a><span class="in">      best_inner_vars &lt;- vars</span></span>
<span id="cb194-2735"><a href="#cb194-2735" aria-hidden="true" tabindex="-1"></a><span class="in">      improved &lt;- TRUE</span></span>
<span id="cb194-2736"><a href="#cb194-2736" aria-hidden="true" tabindex="-1"></a><span class="in">      </span></span>
<span id="cb194-2737"><a href="#cb194-2737" aria-hidden="true" tabindex="-1"></a><span class="in">      while (improved &amp;&amp; length(vars) &gt; 1) {</span></span>
<span id="cb194-2738"><a href="#cb194-2738" aria-hidden="true" tabindex="-1"></a><span class="in">        improved &lt;- FALSE</span></span>
<span id="cb194-2739"><a href="#cb194-2739" aria-hidden="true" tabindex="-1"></a><span class="in">        best_auc_in_step &lt;- best_inner_auc</span></span>
<span id="cb194-2740"><a href="#cb194-2740" aria-hidden="true" tabindex="-1"></a><span class="in">        </span></span>
<span id="cb194-2741"><a href="#cb194-2741" aria-hidden="true" tabindex="-1"></a><span class="in">        for (params in 1:nrow(grid)) {</span></span>
<span id="cb194-2742"><a href="#cb194-2742" aria-hidden="true" tabindex="-1"></a><span class="in">          auc_vals &lt;- numeric()</span></span>
<span id="cb194-2743"><a href="#cb194-2743" aria-hidden="true" tabindex="-1"></a><span class="in">          </span></span>
<span id="cb194-2744"><a href="#cb194-2744" aria-hidden="true" tabindex="-1"></a><span class="in">          for (inner_index in seq_along(inner_folds)) {</span></span>
<span id="cb194-2745"><a href="#cb194-2745" aria-hidden="true" tabindex="-1"></a><span class="in">            inner_train_data &lt;- outer_train_data[-inner_folds[[inner_index]], ]</span></span>
<span id="cb194-2746"><a href="#cb194-2746" aria-hidden="true" tabindex="-1"></a><span class="in">            inner_test_data &lt;- outer_train_data[inner_folds[[inner_index]], ]</span></span>
<span id="cb194-2747"><a href="#cb194-2747" aria-hidden="true" tabindex="-1"></a><span class="in">            </span></span>
<span id="cb194-2748"><a href="#cb194-2748" aria-hidden="true" tabindex="-1"></a><span class="in">            selected_vars &lt;- select_vars_lasso(inner_train_data, target_name)</span></span>
<span id="cb194-2749"><a href="#cb194-2749" aria-hidden="true" tabindex="-1"></a><span class="in">            formula &lt;- as.formula(paste(target_name, "~", paste(selected_vars, collapse = "+")))</span></span>
<span id="cb194-2750"><a href="#cb194-2750" aria-hidden="true" tabindex="-1"></a><span class="in">            #cat("Testing with formula: ", deparse(formula), "\n")</span></span>
<span id="cb194-2751"><a href="#cb194-2751" aria-hidden="true" tabindex="-1"></a><span class="in">            #cat("Grid parameters - cp: ", grid$cp[params], ", minsplit: ", grid$minsplit[params], "\n")</span></span>
<span id="cb194-2752"><a href="#cb194-2752" aria-hidden="true" tabindex="-1"></a><span class="in">            </span></span>
<span id="cb194-2753"><a href="#cb194-2753" aria-hidden="true" tabindex="-1"></a><span class="in">            result &lt;- tryCatch({</span></span>
<span id="cb194-2754"><a href="#cb194-2754" aria-hidden="true" tabindex="-1"></a><span class="in">              model &lt;- rpart(formula, data = inner_train_data, method = "class", </span></span>
<span id="cb194-2755"><a href="#cb194-2755" aria-hidden="true" tabindex="-1"></a><span class="in">                             control = rpart.control(cp = grid$cp[params], minsplit = grid$minsplit[params]))</span></span>
<span id="cb194-2756"><a href="#cb194-2756" aria-hidden="true" tabindex="-1"></a><span class="in">              </span></span>
<span id="cb194-2757"><a href="#cb194-2757" aria-hidden="true" tabindex="-1"></a><span class="in">              predictions &lt;- predict(model, inner_test_data, type = "prob")[,2]</span></span>
<span id="cb194-2758"><a href="#cb194-2758" aria-hidden="true" tabindex="-1"></a><span class="in">              roc_curve &lt;- roc(inner_test_data[[target_name]], predictions)</span></span>
<span id="cb194-2759"><a href="#cb194-2759" aria-hidden="true" tabindex="-1"></a><span class="in">              auc_vals[inner_index] &lt;- roc_curve$auc</span></span>
<span id="cb194-2760"><a href="#cb194-2760" aria-hidden="true" tabindex="-1"></a><span class="in">              #cat("AUC for inner fold ", inner_index, ": ", roc_curve$auc, "\n")</span></span>
<span id="cb194-2761"><a href="#cb194-2761" aria-hidden="true" tabindex="-1"></a><span class="in">              </span></span>
<span id="cb194-2762"><a href="#cb194-2762" aria-hidden="true" tabindex="-1"></a><span class="in">            }, error = function(e) {</span></span>
<span id="cb194-2763"><a href="#cb194-2763" aria-hidden="true" tabindex="-1"></a><span class="in">              cat("Error with variables: ", paste(selected_vars, collapse = ", "), "\n")</span></span>
<span id="cb194-2764"><a href="#cb194-2764" aria-hidden="true" tabindex="-1"></a><span class="in">              cat("Error message: ", e$message, "\n")</span></span>
<span id="cb194-2765"><a href="#cb194-2765" aria-hidden="true" tabindex="-1"></a><span class="in">              auc_vals[inner_index] &lt;- NA  # Set to NA or some other indicator of failure</span></span>
<span id="cb194-2766"><a href="#cb194-2766" aria-hidden="true" tabindex="-1"></a><span class="in">            })</span></span>
<span id="cb194-2767"><a href="#cb194-2767" aria-hidden="true" tabindex="-1"></a><span class="in">          }</span></span>
<span id="cb194-2768"><a href="#cb194-2768" aria-hidden="true" tabindex="-1"></a><span class="in">          </span></span>
<span id="cb194-2769"><a href="#cb194-2769" aria-hidden="true" tabindex="-1"></a><span class="in">          mean_auc &lt;- mean(auc_vals, na.rm = TRUE)</span></span>
<span id="cb194-2770"><a href="#cb194-2770" aria-hidden="true" tabindex="-1"></a><span class="in">          #cat("Mean AUC for params - cp: ", grid$cp[params], ", minsplit: ", grid$minsplit[params], ": ", mean_auc, "\n")</span></span>
<span id="cb194-2771"><a href="#cb194-2771" aria-hidden="true" tabindex="-1"></a><span class="in">          if (!is.na(mean_auc) &amp;&amp; mean_auc &gt; best_auc_in_step) {</span></span>
<span id="cb194-2772"><a href="#cb194-2772" aria-hidden="true" tabindex="-1"></a><span class="in">            best_auc_in_step &lt;- mean_auc</span></span>
<span id="cb194-2773"><a href="#cb194-2773" aria-hidden="true" tabindex="-1"></a><span class="in">            best_inner_model &lt;- model</span></span>
<span id="cb194-2774"><a href="#cb194-2774" aria-hidden="true" tabindex="-1"></a><span class="in">            best_inner_cp &lt;- grid$cp[params]</span></span>
<span id="cb194-2775"><a href="#cb194-2775" aria-hidden="true" tabindex="-1"></a><span class="in">            best_inner_minsplit &lt;- grid$minsplit[params]</span></span>
<span id="cb194-2776"><a href="#cb194-2776" aria-hidden="true" tabindex="-1"></a><span class="in">            best_inner_vars &lt;- selected_vars</span></span>
<span id="cb194-2777"><a href="#cb194-2777" aria-hidden="true" tabindex="-1"></a><span class="in">            improved &lt;- TRUE</span></span>
<span id="cb194-2778"><a href="#cb194-2778" aria-hidden="true" tabindex="-1"></a><span class="in">          }</span></span>
<span id="cb194-2779"><a href="#cb194-2779" aria-hidden="true" tabindex="-1"></a><span class="in">        }</span></span>
<span id="cb194-2780"><a href="#cb194-2780" aria-hidden="true" tabindex="-1"></a><span class="in">        </span></span>
<span id="cb194-2781"><a href="#cb194-2781" aria-hidden="true" tabindex="-1"></a><span class="in">        if (improved) {</span></span>
<span id="cb194-2782"><a href="#cb194-2782" aria-hidden="true" tabindex="-1"></a><span class="in">          vars &lt;- best_inner_vars</span></span>
<span id="cb194-2783"><a href="#cb194-2783" aria-hidden="true" tabindex="-1"></a><span class="in">          best_inner_auc &lt;- best_auc_in_step</span></span>
<span id="cb194-2784"><a href="#cb194-2784" aria-hidden="true" tabindex="-1"></a><span class="in">          cat("Vars improved: ", paste(vars, collapse=", "), "\n")</span></span>
<span id="cb194-2785"><a href="#cb194-2785" aria-hidden="true" tabindex="-1"></a><span class="in">          cat("AUC: ", best_inner_auc, "\n")</span></span>
<span id="cb194-2786"><a href="#cb194-2786" aria-hidden="true" tabindex="-1"></a><span class="in">        }</span></span>
<span id="cb194-2787"><a href="#cb194-2787" aria-hidden="true" tabindex="-1"></a><span class="in">      }</span></span>
<span id="cb194-2788"><a href="#cb194-2788" aria-hidden="true" tabindex="-1"></a><span class="in">      </span></span>
<span id="cb194-2789"><a href="#cb194-2789" aria-hidden="true" tabindex="-1"></a><span class="in">      list(model = best_inner_model, auc = best_inner_auc, </span></span>
<span id="cb194-2790"><a href="#cb194-2790" aria-hidden="true" tabindex="-1"></a><span class="in">           cp = best_inner_cp, minsplit = best_inner_minsplit, </span></span>
<span id="cb194-2791"><a href="#cb194-2791" aria-hidden="true" tabindex="-1"></a><span class="in">           vars = best_inner_vars)</span></span>
<span id="cb194-2792"><a href="#cb194-2792" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb194-2793"><a href="#cb194-2793" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-2794"><a href="#cb194-2794" aria-hidden="true" tabindex="-1"></a><span class="in">    best_result &lt;- stepAUC(best_vars, outer_train_data, target_name, grid, inner_folds)</span></span>
<span id="cb194-2795"><a href="#cb194-2795" aria-hidden="true" tabindex="-1"></a><span class="in">    best_model &lt;- best_result$model</span></span>
<span id="cb194-2796"><a href="#cb194-2796" aria-hidden="true" tabindex="-1"></a><span class="in">    best_auc &lt;- best_result$auc</span></span>
<span id="cb194-2797"><a href="#cb194-2797" aria-hidden="true" tabindex="-1"></a><span class="in">    best_cp &lt;- best_result$cp</span></span>
<span id="cb194-2798"><a href="#cb194-2798" aria-hidden="true" tabindex="-1"></a><span class="in">    best_minsplit &lt;- best_result$minsplit</span></span>
<span id="cb194-2799"><a href="#cb194-2799" aria-hidden="true" tabindex="-1"></a><span class="in">    best_vars &lt;- best_result$vars</span></span>
<span id="cb194-2800"><a href="#cb194-2800" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-2801"><a href="#cb194-2801" aria-hidden="true" tabindex="-1"></a><span class="in">    if (is.null(best_model)) {</span></span>
<span id="cb194-2802"><a href="#cb194-2802" aria-hidden="true" tabindex="-1"></a><span class="in">      cat("Error: No valid model found for outer fold ", outer_index, "\n")</span></span>
<span id="cb194-2803"><a href="#cb194-2803" aria-hidden="true" tabindex="-1"></a><span class="in">      next</span></span>
<span id="cb194-2804"><a href="#cb194-2804" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb194-2805"><a href="#cb194-2805" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-2806"><a href="#cb194-2806" aria-hidden="true" tabindex="-1"></a><span class="in">    # Evaluar el mejor modelo en el validation split del inner loop</span></span>
<span id="cb194-2807"><a href="#cb194-2807" aria-hidden="true" tabindex="-1"></a><span class="in">    inner_auc_vals &lt;- numeric()</span></span>
<span id="cb194-2808"><a href="#cb194-2808" aria-hidden="true" tabindex="-1"></a><span class="in">    for (inner_index in seq_along(inner_folds)) {</span></span>
<span id="cb194-2809"><a href="#cb194-2809" aria-hidden="true" tabindex="-1"></a><span class="in">      inner_train_data &lt;- outer_train_data[-inner_folds[[inner_index]], ]</span></span>
<span id="cb194-2810"><a href="#cb194-2810" aria-hidden="true" tabindex="-1"></a><span class="in">      inner_test_data &lt;- outer_train_data[inner_folds[[inner_index]], ]</span></span>
<span id="cb194-2811"><a href="#cb194-2811" aria-hidden="true" tabindex="-1"></a><span class="in">      </span></span>
<span id="cb194-2812"><a href="#cb194-2812" aria-hidden="true" tabindex="-1"></a><span class="in">      predictions &lt;- predict(best_model, inner_test_data, type = "prob")[,2]</span></span>
<span id="cb194-2813"><a href="#cb194-2813" aria-hidden="true" tabindex="-1"></a><span class="in">      roc_curve &lt;- roc(inner_test_data[[target_name]], predictions)</span></span>
<span id="cb194-2814"><a href="#cb194-2814" aria-hidden="true" tabindex="-1"></a><span class="in">      inner_auc_vals[inner_index] &lt;- roc_curve$auc</span></span>
<span id="cb194-2815"><a href="#cb194-2815" aria-hidden="true" tabindex="-1"></a><span class="in">      #cat("Inner fold ", inner_index, " AUC: ", roc_curve$auc, "\n")</span></span>
<span id="cb194-2816"><a href="#cb194-2816" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-2817"><a href="#cb194-2817" aria-hidden="true" tabindex="-1"></a><span class="in">      pred_class &lt;- ifelse(predictions &gt; threshold, 1, 0)</span></span>
<span id="cb194-2818"><a href="#cb194-2818" aria-hidden="true" tabindex="-1"></a><span class="in">      confusion &lt;- table(Actual = inner_test_data[[target_name]], Predicted = pred_class)</span></span>
<span id="cb194-2819"><a href="#cb194-2819" aria-hidden="true" tabindex="-1"></a><span class="in">      TP &lt;- ifelse(nrow(confusion) &gt;= 2 &amp;&amp; ncol(confusion) &gt;= 2, confusion[2, 2], 0)</span></span>
<span id="cb194-2820"><a href="#cb194-2820" aria-hidden="true" tabindex="-1"></a><span class="in">      TN &lt;- ifelse(nrow(confusion) &gt;= 1 &amp;&amp; ncol(confusion) &gt;= 1, confusion[1, 1], 0)</span></span>
<span id="cb194-2821"><a href="#cb194-2821" aria-hidden="true" tabindex="-1"></a><span class="in">      FP &lt;- ifelse(nrow(confusion) &gt;= 1 &amp;&amp; ncol(confusion) &gt;= 2, confusion[1, 2], 0)</span></span>
<span id="cb194-2822"><a href="#cb194-2822" aria-hidden="true" tabindex="-1"></a><span class="in">      FN &lt;- ifelse(nrow(confusion) &gt;= 2 &amp;&amp; ncol(confusion) &gt;= 1, confusion[2, 1], 0)</span></span>
<span id="cb194-2823"><a href="#cb194-2823" aria-hidden="true" tabindex="-1"></a><span class="in">      auc &lt;- roc_curve$auc</span></span>
<span id="cb194-2824"><a href="#cb194-2824" aria-hidden="true" tabindex="-1"></a><span class="in">      </span></span>
<span id="cb194-2825"><a href="#cb194-2825" aria-hidden="true" tabindex="-1"></a><span class="in">      inner_metrics &lt;- setNames(c(outer_index, inner_index, TP, TN, FP, FN, auc), names(inner_fold_metrics))</span></span>
<span id="cb194-2826"><a href="#cb194-2826" aria-hidden="true" tabindex="-1"></a><span class="in">      inner_fold_metrics &lt;- rbind(inner_fold_metrics, as.data.frame(t(inner_metrics)))</span></span>
<span id="cb194-2827"><a href="#cb194-2827" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb194-2828"><a href="#cb194-2828" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-2829"><a href="#cb194-2829" aria-hidden="true" tabindex="-1"></a><span class="in">    best_inner_auc &lt;- mean(inner_auc_vals, na.rm = TRUE)</span></span>
<span id="cb194-2830"><a href="#cb194-2830" aria-hidden="true" tabindex="-1"></a><span class="in">    cat("Best inner AUC: ", best_inner_auc, "\n")</span></span>
<span id="cb194-2831"><a href="#cb194-2831" aria-hidden="true" tabindex="-1"></a><span class="in">    best_model &lt;- rpart(as.formula(paste(target_name, "~", paste(best_vars, collapse = "+"))),</span></span>
<span id="cb194-2832"><a href="#cb194-2832" aria-hidden="true" tabindex="-1"></a><span class="in">                        data = outer_train_data, method = "class", </span></span>
<span id="cb194-2833"><a href="#cb194-2833" aria-hidden="true" tabindex="-1"></a><span class="in">                        control = rpart.control(cp = best_cp, minsplit = best_minsplit))</span></span>
<span id="cb194-2834"><a href="#cb194-2834" aria-hidden="true" tabindex="-1"></a><span class="in">    predictions &lt;- predict(best_model, outer_test_data, type = "prob")[,2]</span></span>
<span id="cb194-2835"><a href="#cb194-2835" aria-hidden="true" tabindex="-1"></a><span class="in">    pred_class &lt;- ifelse(predictions &gt; threshold, 1, 0)  # Asignar clases basadas en umbral</span></span>
<span id="cb194-2836"><a href="#cb194-2836" aria-hidden="true" tabindex="-1"></a><span class="in">    confusion &lt;- table(Actual = outer_test_data[[target_name]], Predicted = pred_class)</span></span>
<span id="cb194-2837"><a href="#cb194-2837" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-2838"><a href="#cb194-2838" aria-hidden="true" tabindex="-1"></a><span class="in">    if (nrow(confusion) &lt; 2 || ncol(confusion) &lt; 2) {</span></span>
<span id="cb194-2839"><a href="#cb194-2839" aria-hidden="true" tabindex="-1"></a><span class="in">      TP &lt;- ifelse(nrow(confusion) &gt;= 2 &amp;&amp; ncol(confusion) &gt;= 2, confusion[2, 2], 0)</span></span>
<span id="cb194-2840"><a href="#cb194-2840" aria-hidden="true" tabindex="-1"></a><span class="in">      TN &lt;- ifelse(nrow(confusion) &gt;= 1 &amp;&amp; ncol(confusion) &gt;= 1, confusion[1, 1], 0)</span></span>
<span id="cb194-2841"><a href="#cb194-2841" aria-hidden="true" tabindex="-1"></a><span class="in">      FP &lt;- ifelse(nrow(confusion) &gt;= 1 &amp;&amp; ncol(confusion) &gt;= 2, confusion[1, 2], 0)</span></span>
<span id="cb194-2842"><a href="#cb194-2842" aria-hidden="true" tabindex="-1"></a><span class="in">      FN &lt;- ifelse(nrow(confusion) &gt;= 2 &amp;&amp; ncol(confusion) &gt;= 1, confusion[2, 1], 0)</span></span>
<span id="cb194-2843"><a href="#cb194-2843" aria-hidden="true" tabindex="-1"></a><span class="in">    } else {</span></span>
<span id="cb194-2844"><a href="#cb194-2844" aria-hidden="true" tabindex="-1"></a><span class="in">      TP &lt;- confusion[2, 2]</span></span>
<span id="cb194-2845"><a href="#cb194-2845" aria-hidden="true" tabindex="-1"></a><span class="in">      TN &lt;- confusion[1, 1]</span></span>
<span id="cb194-2846"><a href="#cb194-2846" aria-hidden="true" tabindex="-1"></a><span class="in">      FP &lt;- confusion[1, 2]</span></span>
<span id="cb194-2847"><a href="#cb194-2847" aria-hidden="true" tabindex="-1"></a><span class="in">      FN &lt;- confusion[2, 1]</span></span>
<span id="cb194-2848"><a href="#cb194-2848" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb194-2849"><a href="#cb194-2849" aria-hidden="true" tabindex="-1"></a><span class="in">    auc &lt;- roc(outer_test_data[[target_name]], predictions)$auc</span></span>
<span id="cb194-2850"><a href="#cb194-2850" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-2851"><a href="#cb194-2851" aria-hidden="true" tabindex="-1"></a><span class="in">    metrics &lt;- setNames(c(outer_index, TP, TN, FP, FN, auc, </span></span>
<span id="cb194-2852"><a href="#cb194-2852" aria-hidden="true" tabindex="-1"></a><span class="in">                          best_cp, best_minsplit, paste(best_vars, collapse = ",")), </span></span>
<span id="cb194-2853"><a href="#cb194-2853" aria-hidden="true" tabindex="-1"></a><span class="in">                        names(performance_metrics))</span></span>
<span id="cb194-2854"><a href="#cb194-2854" aria-hidden="true" tabindex="-1"></a><span class="in">    performance_metrics &lt;- rbind(performance_metrics, as.data.frame(t(metrics)))</span></span>
<span id="cb194-2855"><a href="#cb194-2855" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-2856"><a href="#cb194-2856" aria-hidden="true" tabindex="-1"></a><span class="in">    cat("Performance:\n", paste(performance_metrics), "\n")</span></span>
<span id="cb194-2857"><a href="#cb194-2857" aria-hidden="true" tabindex="-1"></a><span class="in">    cat(sprintf("Confusion Matrix for Fold %d:\n", outer_index))</span></span>
<span id="cb194-2858"><a href="#cb194-2858" aria-hidden="true" tabindex="-1"></a><span class="in">    print(confusion)</span></span>
<span id="cb194-2859"><a href="#cb194-2859" aria-hidden="true" tabindex="-1"></a><span class="in">    cat(sprintf("Metrics for Fold %d:\n", outer_index))</span></span>
<span id="cb194-2860"><a href="#cb194-2860" aria-hidden="true" tabindex="-1"></a><span class="in">    cat(sprintf("TP: %d, TN: %d, FP: %d, FN: %d, AUC: %f, Best cp: %f, Best minsplit: %d, Best Variables: %s\n",</span></span>
<span id="cb194-2861"><a href="#cb194-2861" aria-hidden="true" tabindex="-1"></a><span class="in">                TP, TN, FP, FN, auc, best_cp, best_minsplit, paste(best_vars, collapse = ",")))</span></span>
<span id="cb194-2862"><a href="#cb194-2862" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb194-2863"><a href="#cb194-2863" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb194-2864"><a href="#cb194-2864" aria-hidden="true" tabindex="-1"></a><span class="in">  list(performance_metrics = performance_metrics, inner_fold_metrics = inner_fold_metrics)</span></span>
<span id="cb194-2865"><a href="#cb194-2865" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb194-2866"><a href="#cb194-2866" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-2867"><a href="#cb194-2867" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-2868"><a href="#cb194-2868" aria-hidden="true" tabindex="-1"></a><span class="in">evaluate_with_seeds_DecisionTree_lasso &lt;- </span></span>
<span id="cb194-2869"><a href="#cb194-2869" aria-hidden="true" tabindex="-1"></a><span class="in">  function(evaluation_function, data, target_var, vars, threshold, seeds, outer, inner, cp_values, minsplit_values) {</span></span>
<span id="cb194-2870"><a href="#cb194-2870" aria-hidden="true" tabindex="-1"></a><span class="in">  results_list &lt;- list()</span></span>
<span id="cb194-2871"><a href="#cb194-2871" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-2872"><a href="#cb194-2872" aria-hidden="true" tabindex="-1"></a><span class="in">  for (seed in seeds) {</span></span>
<span id="cb194-2873"><a href="#cb194-2873" aria-hidden="true" tabindex="-1"></a><span class="in">    set.seed(seed)</span></span>
<span id="cb194-2874"><a href="#cb194-2874" aria-hidden="true" tabindex="-1"></a><span class="in">    cat("Evaluating with seed:", seed, "\n")</span></span>
<span id="cb194-2875"><a href="#cb194-2875" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-2876"><a href="#cb194-2876" aria-hidden="true" tabindex="-1"></a><span class="in">    results &lt;- evaluation_function(data = data, </span></span>
<span id="cb194-2877"><a href="#cb194-2877" aria-hidden="true" tabindex="-1"></a><span class="in">                                   target_name = target_var, </span></span>
<span id="cb194-2878"><a href="#cb194-2878" aria-hidden="true" tabindex="-1"></a><span class="in">                                   variables = vars, </span></span>
<span id="cb194-2879"><a href="#cb194-2879" aria-hidden="true" tabindex="-1"></a><span class="in">                                   threshold = threshold, </span></span>
<span id="cb194-2880"><a href="#cb194-2880" aria-hidden="true" tabindex="-1"></a><span class="in">                                   outer = outer, </span></span>
<span id="cb194-2881"><a href="#cb194-2881" aria-hidden="true" tabindex="-1"></a><span class="in">                                   inner = inner, </span></span>
<span id="cb194-2882"><a href="#cb194-2882" aria-hidden="true" tabindex="-1"></a><span class="in">                                   seed = seed,</span></span>
<span id="cb194-2883"><a href="#cb194-2883" aria-hidden="true" tabindex="-1"></a><span class="in">                                   cps = cp_values,</span></span>
<span id="cb194-2884"><a href="#cb194-2884" aria-hidden="true" tabindex="-1"></a><span class="in">                                   minsplits = minsplit_values)</span></span>
<span id="cb194-2885"><a href="#cb194-2885" aria-hidden="true" tabindex="-1"></a><span class="in">    results_list[[paste0("seed_", seed)]] &lt;- results</span></span>
<span id="cb194-2886"><a href="#cb194-2886" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb194-2887"><a href="#cb194-2887" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-2888"><a href="#cb194-2888" aria-hidden="true" tabindex="-1"></a><span class="in">  return(results_list)</span></span>
<span id="cb194-2889"><a href="#cb194-2889" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb194-2890"><a href="#cb194-2890" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-2891"><a href="#cb194-2891" aria-hidden="true" tabindex="-1"></a><span class="in">performance_rpart_lasso &lt;- evaluate_with_seeds_DecisionTree_lasso(</span></span>
<span id="cb194-2892"><a href="#cb194-2892" aria-hidden="true" tabindex="-1"></a><span class="in">  evaluation_function = double_cross_validation_rpart_Lasso,</span></span>
<span id="cb194-2893"><a href="#cb194-2893" aria-hidden="true" tabindex="-1"></a><span class="in">  data = data_factor,</span></span>
<span id="cb194-2894"><a href="#cb194-2894" aria-hidden="true" tabindex="-1"></a><span class="in">  outer = 5,</span></span>
<span id="cb194-2895"><a href="#cb194-2895" aria-hidden="true" tabindex="-1"></a><span class="in">  inner = 2,</span></span>
<span id="cb194-2896"><a href="#cb194-2896" aria-hidden="true" tabindex="-1"></a><span class="in">  target_var = "PCR",</span></span>
<span id="cb194-2897"><a href="#cb194-2897" aria-hidden="true" tabindex="-1"></a><span class="in">  cp_values = c(0.001, 0.01, 0.1),</span></span>
<span id="cb194-2898"><a href="#cb194-2898" aria-hidden="true" tabindex="-1"></a><span class="in">  minsplit_values = c(2, 5, 10, 15, 20),</span></span>
<span id="cb194-2899"><a href="#cb194-2899" aria-hidden="true" tabindex="-1"></a><span class="in">  vars = todas_variables_factor,</span></span>
<span id="cb194-2900"><a href="#cb194-2900" aria-hidden="true" tabindex="-1"></a><span class="in">  threshold = .35,</span></span>
<span id="cb194-2901"><a href="#cb194-2901" aria-hidden="true" tabindex="-1"></a><span class="in">  seeds = seeds</span></span>
<span id="cb194-2902"><a href="#cb194-2902" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb194-2903"><a href="#cb194-2903" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-2904"><a href="#cb194-2904" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-2905"><a href="#cb194-2905" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-2906"><a href="#cb194-2906" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message=FALSE, warning=FALSE}</span></span>
<span id="cb194-2907"><a href="#cb194-2907" aria-hidden="true" tabindex="-1"></a><span class="in">load("RData_Files_Algorithms/DecisionTree_Lasso.RData")</span></span>
<span id="cb194-2908"><a href="#cb194-2908" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-2909"><a href="#cb194-2909" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-2910"><a href="#cb194-2910" aria-hidden="true" tabindex="-1"></a><span class="fu">## K-Nearest Neighbours </span></span>
<span id="cb194-2911"><a href="#cb194-2911" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-2912"><a href="#cb194-2912" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-2913"><a href="#cb194-2913" aria-hidden="true" tabindex="-1"></a><span class="fu">### Aparente</span></span>
<span id="cb194-2914"><a href="#cb194-2914" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-2915"><a href="#cb194-2915" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=FALSE}</span></span>
<span id="cb194-2916"><a href="#cb194-2916" aria-hidden="true" tabindex="-1"></a><span class="in">evaluate_aparent_performance_model_knn &lt;- function(data, target_var, model_func, vars = NULL, threshold = 0.5) {</span></span>
<span id="cb194-2917"><a href="#cb194-2917" aria-hidden="true" tabindex="-1"></a><span class="in">  if (is.null(vars)) {</span></span>
<span id="cb194-2918"><a href="#cb194-2918" aria-hidden="true" tabindex="-1"></a><span class="in">    vars &lt;- setdiff(names(data), target_var)</span></span>
<span id="cb194-2919"><a href="#cb194-2919" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb194-2920"><a href="#cb194-2920" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb194-2921"><a href="#cb194-2921" aria-hidden="true" tabindex="-1"></a><span class="in">  data[[target_var]] &lt;- factor(data[[target_var]], levels = c(0, 1))</span></span>
<span id="cb194-2922"><a href="#cb194-2922" aria-hidden="true" tabindex="-1"></a><span class="in">  formula &lt;- as.formula(paste(target_var, "~", paste(vars, collapse = "+")))</span></span>
<span id="cb194-2923"><a href="#cb194-2923" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb194-2924"><a href="#cb194-2924" aria-hidden="true" tabindex="-1"></a><span class="in">  model &lt;- model_func(formula, data)</span></span>
<span id="cb194-2925"><a href="#cb194-2925" aria-hidden="true" tabindex="-1"></a><span class="in">  train_x &lt;- model$train_x</span></span>
<span id="cb194-2926"><a href="#cb194-2926" aria-hidden="true" tabindex="-1"></a><span class="in">  train_y &lt;- model$train_y</span></span>
<span id="cb194-2927"><a href="#cb194-2927" aria-hidden="true" tabindex="-1"></a><span class="in">  test_x &lt;- model.matrix(formula, data)[, -1]</span></span>
<span id="cb194-2928"><a href="#cb194-2928" aria-hidden="true" tabindex="-1"></a><span class="in">  predictions &lt;- knn(train = train_x, test = test_x, cl = train_y, k = model$k, prob = TRUE)</span></span>
<span id="cb194-2929"><a href="#cb194-2929" aria-hidden="true" tabindex="-1"></a><span class="in">  predictions &lt;- attr(predictions, "prob")</span></span>
<span id="cb194-2930"><a href="#cb194-2930" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb194-2931"><a href="#cb194-2931" aria-hidden="true" tabindex="-1"></a><span class="in">  actual_classes &lt;- data[[target_var]]</span></span>
<span id="cb194-2932"><a href="#cb194-2932" aria-hidden="true" tabindex="-1"></a><span class="in">  predicted_classes &lt;- ifelse(predictions &gt; threshold, 1, 0)</span></span>
<span id="cb194-2933"><a href="#cb194-2933" aria-hidden="true" tabindex="-1"></a><span class="in">  confusion_matrix &lt;- table(predicted_classes, actual_classes)</span></span>
<span id="cb194-2934"><a href="#cb194-2934" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb194-2935"><a href="#cb194-2935" aria-hidden="true" tabindex="-1"></a><span class="in">  tp &lt;- ifelse("1" %in% rownames(confusion_matrix) &amp;&amp; "1" %in% colnames(confusion_matrix), confusion_matrix["1", "1"], 0)</span></span>
<span id="cb194-2936"><a href="#cb194-2936" aria-hidden="true" tabindex="-1"></a><span class="in">  tn &lt;- ifelse("0" %in% rownames(confusion_matrix) &amp;&amp; "0" %in% colnames(confusion_matrix), confusion_matrix["0", "0"], 0)</span></span>
<span id="cb194-2937"><a href="#cb194-2937" aria-hidden="true" tabindex="-1"></a><span class="in">  fp &lt;- ifelse("1" %in% rownames(confusion_matrix) &amp;&amp; "0" %in% colnames(confusion_matrix), confusion_matrix["1", "0"], 0)</span></span>
<span id="cb194-2938"><a href="#cb194-2938" aria-hidden="true" tabindex="-1"></a><span class="in">  fn &lt;- ifelse("0" %in% rownames(confusion_matrix) &amp;&amp; "1" %in% colnames(confusion_matrix), confusion_matrix["0", "1"], 0)</span></span>
<span id="cb194-2939"><a href="#cb194-2939" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb194-2940"><a href="#cb194-2940" aria-hidden="true" tabindex="-1"></a><span class="in">  accuracy &lt;- (tp + tn) / (tp + tn + fp + fn)</span></span>
<span id="cb194-2941"><a href="#cb194-2941" aria-hidden="true" tabindex="-1"></a><span class="in">  precision &lt;- ifelse(tp + fp &gt; 0, tp / (tp + fp), 0)</span></span>
<span id="cb194-2942"><a href="#cb194-2942" aria-hidden="true" tabindex="-1"></a><span class="in">  recall &lt;- ifelse(tp + fn &gt; 0, tp / (tp + fn), 0)</span></span>
<span id="cb194-2943"><a href="#cb194-2943" aria-hidden="true" tabindex="-1"></a><span class="in">  f1_score &lt;- ifelse(precision + recall &gt; 0, 2 * (precision * recall) / (precision + recall), 0)</span></span>
<span id="cb194-2944"><a href="#cb194-2944" aria-hidden="true" tabindex="-1"></a><span class="in">  roc_obj &lt;- pROC::roc(actual_classes, predictions)</span></span>
<span id="cb194-2945"><a href="#cb194-2945" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb194-2946"><a href="#cb194-2946" aria-hidden="true" tabindex="-1"></a><span class="in">  list(confusion_matrix = confusion_matrix, accuracy = accuracy, precision = precision, </span></span>
<span id="cb194-2947"><a href="#cb194-2947" aria-hidden="true" tabindex="-1"></a><span class="in">       recall = recall, f1_score = f1_score, roc_curve = roc_obj)</span></span>
<span id="cb194-2948"><a href="#cb194-2948" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb194-2949"><a href="#cb194-2949" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-2950"><a href="#cb194-2950" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-2951"><a href="#cb194-2951" aria-hidden="true" tabindex="-1"></a><span class="in">knn_model &lt;- function(formula, data) {</span></span>
<span id="cb194-2952"><a href="#cb194-2952" aria-hidden="true" tabindex="-1"></a><span class="in">  train_x &lt;- model.matrix(formula, data)[, -1]</span></span>
<span id="cb194-2953"><a href="#cb194-2953" aria-hidden="true" tabindex="-1"></a><span class="in">  train_y &lt;- data[[all.vars(formula)[1]]]</span></span>
<span id="cb194-2954"><a href="#cb194-2954" aria-hidden="true" tabindex="-1"></a><span class="in">  list(train_x = train_x, train_y = train_y, k = 5)  </span></span>
<span id="cb194-2955"><a href="#cb194-2955" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb194-2956"><a href="#cb194-2956" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-2957"><a href="#cb194-2957" aria-hidden="true" tabindex="-1"></a><span class="in">resultadosAparentesKNN &lt;- evaluate_aparent_performance_model_knn(data = data_numeric, target_var = "PCR",</span></span>
<span id="cb194-2958"><a href="#cb194-2958" aria-hidden="true" tabindex="-1"></a><span class="in">                                                             model_func = knn_model,</span></span>
<span id="cb194-2959"><a href="#cb194-2959" aria-hidden="true" tabindex="-1"></a><span class="in">                                                             vars = ".",</span></span>
<span id="cb194-2960"><a href="#cb194-2960" aria-hidden="true" tabindex="-1"></a><span class="in">                                                             threshold = .35)</span></span>
<span id="cb194-2961"><a href="#cb194-2961" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-2962"><a href="#cb194-2962" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-2963"><a href="#cb194-2963" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message=FALSE, warning=FALSE}</span></span>
<span id="cb194-2964"><a href="#cb194-2964" aria-hidden="true" tabindex="-1"></a><span class="in">load("RData_Files_Algorithms/KNN_Aparente.RData")</span></span>
<span id="cb194-2965"><a href="#cb194-2965" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-2966"><a href="#cb194-2966" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-2967"><a href="#cb194-2967" aria-hidden="true" tabindex="-1"></a><span class="fu">### Todas las Variables</span></span>
<span id="cb194-2968"><a href="#cb194-2968" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-2969"><a href="#cb194-2969" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=FALSE}</span></span>
<span id="cb194-2970"><a href="#cb194-2970" aria-hidden="true" tabindex="-1"></a><span class="in">double_cross_validation_knn &lt;- function(data, target_name, outer, inner, ks, ls, variables, threshold, seed) {</span></span>
<span id="cb194-2971"><a href="#cb194-2971" aria-hidden="true" tabindex="-1"></a><span class="in">  set.seed(seed)</span></span>
<span id="cb194-2972"><a href="#cb194-2972" aria-hidden="true" tabindex="-1"></a><span class="in">  performance_metrics &lt;- data.frame(Fold = integer(), TP = integer(), TN = integer(),</span></span>
<span id="cb194-2973"><a href="#cb194-2973" aria-hidden="true" tabindex="-1"></a><span class="in">                                    FP = integer(), FN = integer(), AUC = numeric(),</span></span>
<span id="cb194-2974"><a href="#cb194-2974" aria-hidden="true" tabindex="-1"></a><span class="in">                                    Best_k = integer(), Best_l = numeric(), stringsAsFactors = FALSE)</span></span>
<span id="cb194-2975"><a href="#cb194-2975" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb194-2976"><a href="#cb194-2976" aria-hidden="true" tabindex="-1"></a><span class="in">  data[[target_name]] &lt;- as.factor(data[[target_name]])</span></span>
<span id="cb194-2977"><a href="#cb194-2977" aria-hidden="true" tabindex="-1"></a><span class="in">  outer_folds &lt;- createFolds(data[[target_name]], k = outer, list = TRUE, returnTrain = FALSE)</span></span>
<span id="cb194-2978"><a href="#cb194-2978" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb194-2979"><a href="#cb194-2979" aria-hidden="true" tabindex="-1"></a><span class="in">  for (outer_index in seq_along(outer_folds)) {</span></span>
<span id="cb194-2980"><a href="#cb194-2980" aria-hidden="true" tabindex="-1"></a><span class="in">    outer_train_data &lt;- data[-outer_folds[[outer_index]], ]</span></span>
<span id="cb194-2981"><a href="#cb194-2981" aria-hidden="true" tabindex="-1"></a><span class="in">    outer_test_data &lt;- data[outer_folds[[outer_index]], ]</span></span>
<span id="cb194-2982"><a href="#cb194-2982" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-2983"><a href="#cb194-2983" aria-hidden="true" tabindex="-1"></a><span class="in">    cat(sprintf("Outer Fold %d\n", outer_index))</span></span>
<span id="cb194-2984"><a href="#cb194-2984" aria-hidden="true" tabindex="-1"></a><span class="in">    cat("Training Data - Class 0: ", sum(outer_train_data[[target_name]] == "0"), "\n")</span></span>
<span id="cb194-2985"><a href="#cb194-2985" aria-hidden="true" tabindex="-1"></a><span class="in">    cat("Training Data - Class 1: ", sum(outer_train_data[[target_name]] == "1"), "\n")</span></span>
<span id="cb194-2986"><a href="#cb194-2986" aria-hidden="true" tabindex="-1"></a><span class="in">    cat("Testing Data - Class 0: ", sum(outer_test_data[[target_name]] == "0"), "\n")</span></span>
<span id="cb194-2987"><a href="#cb194-2987" aria-hidden="true" tabindex="-1"></a><span class="in">    cat("Testing Data - Class 1: ", sum(outer_test_data[[target_name]] == "1"), "\n")</span></span>
<span id="cb194-2988"><a href="#cb194-2988" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-2989"><a href="#cb194-2989" aria-hidden="true" tabindex="-1"></a><span class="in">    if (sum(outer_train_data[[target_name]] == "0") == 0 || sum(outer_train_data[[target_name]] == "1") == 0) {</span></span>
<span id="cb194-2990"><a href="#cb194-2990" aria-hidden="true" tabindex="-1"></a><span class="in">      cat("Skipping outer fold due to lack of class diversity\n")</span></span>
<span id="cb194-2991"><a href="#cb194-2991" aria-hidden="true" tabindex="-1"></a><span class="in">      next</span></span>
<span id="cb194-2992"><a href="#cb194-2992" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb194-2993"><a href="#cb194-2993" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-2994"><a href="#cb194-2994" aria-hidden="true" tabindex="-1"></a><span class="in">    inner_folds &lt;- createFolds(outer_train_data[[target_name]], k = inner, list = TRUE, returnTrain = FALSE)</span></span>
<span id="cb194-2995"><a href="#cb194-2995" aria-hidden="true" tabindex="-1"></a><span class="in">    best_model &lt;- NULL</span></span>
<span id="cb194-2996"><a href="#cb194-2996" aria-hidden="true" tabindex="-1"></a><span class="in">    best_auc &lt;- 0</span></span>
<span id="cb194-2997"><a href="#cb194-2997" aria-hidden="true" tabindex="-1"></a><span class="in">    best_k &lt;- NULL</span></span>
<span id="cb194-2998"><a href="#cb194-2998" aria-hidden="true" tabindex="-1"></a><span class="in">    best_l &lt;- NULL</span></span>
<span id="cb194-2999"><a href="#cb194-2999" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-3000"><a href="#cb194-3000" aria-hidden="true" tabindex="-1"></a><span class="in">    grid &lt;- expand.grid(k = ks, l = ls)</span></span>
<span id="cb194-3001"><a href="#cb194-3001" aria-hidden="true" tabindex="-1"></a><span class="in">    formula &lt;- reformulate(variables, target_name)</span></span>
<span id="cb194-3002"><a href="#cb194-3002" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-3003"><a href="#cb194-3003" aria-hidden="true" tabindex="-1"></a><span class="in">    for (params in 1:nrow(grid)) {</span></span>
<span id="cb194-3004"><a href="#cb194-3004" aria-hidden="true" tabindex="-1"></a><span class="in">      inner_auc &lt;- numeric()</span></span>
<span id="cb194-3005"><a href="#cb194-3005" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-3006"><a href="#cb194-3006" aria-hidden="true" tabindex="-1"></a><span class="in">      for (inner_index in seq_along(inner_folds)) {</span></span>
<span id="cb194-3007"><a href="#cb194-3007" aria-hidden="true" tabindex="-1"></a><span class="in">        inner_train_data &lt;- outer_train_data[-inner_folds[[inner_index]], ]</span></span>
<span id="cb194-3008"><a href="#cb194-3008" aria-hidden="true" tabindex="-1"></a><span class="in">        inner_test_data &lt;- outer_train_data[inner_folds[[inner_index]], ]</span></span>
<span id="cb194-3009"><a href="#cb194-3009" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-3010"><a href="#cb194-3010" aria-hidden="true" tabindex="-1"></a><span class="in">        if (sum(inner_train_data[[target_name]] == "0") == 0 || sum(inner_train_data[[target_name]] == "1") == 0) {</span></span>
<span id="cb194-3011"><a href="#cb194-3011" aria-hidden="true" tabindex="-1"></a><span class="in">          cat("Skipping inner fold due to lack of class diversity\n")</span></span>
<span id="cb194-3012"><a href="#cb194-3012" aria-hidden="true" tabindex="-1"></a><span class="in">          next</span></span>
<span id="cb194-3013"><a href="#cb194-3013" aria-hidden="true" tabindex="-1"></a><span class="in">        }</span></span>
<span id="cb194-3014"><a href="#cb194-3014" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-3015"><a href="#cb194-3015" aria-hidden="true" tabindex="-1"></a><span class="in">        train_x &lt;- inner_train_data[, variables, drop = FALSE]</span></span>
<span id="cb194-3016"><a href="#cb194-3016" aria-hidden="true" tabindex="-1"></a><span class="in">        test_x &lt;- inner_test_data[, variables, drop = FALSE]</span></span>
<span id="cb194-3017"><a href="#cb194-3017" aria-hidden="true" tabindex="-1"></a><span class="in">        train_y &lt;- inner_train_data[[target_name]]</span></span>
<span id="cb194-3018"><a href="#cb194-3018" aria-hidden="true" tabindex="-1"></a><span class="in">        test_y &lt;- inner_test_data[[target_name]]</span></span>
<span id="cb194-3019"><a href="#cb194-3019" aria-hidden="true" tabindex="-1"></a><span class="in">        </span></span>
<span id="cb194-3020"><a href="#cb194-3020" aria-hidden="true" tabindex="-1"></a><span class="in">        result &lt;- tryCatch({</span></span>
<span id="cb194-3021"><a href="#cb194-3021" aria-hidden="true" tabindex="-1"></a><span class="in">          predictions &lt;- knn(train = train_x, test = test_x, cl = train_y, k = grid$k[params], prob = TRUE)</span></span>
<span id="cb194-3022"><a href="#cb194-3022" aria-hidden="true" tabindex="-1"></a><span class="in">          probabilities &lt;- attr(predictions, "prob")</span></span>
<span id="cb194-3023"><a href="#cb194-3023" aria-hidden="true" tabindex="-1"></a><span class="in">          probabilities &lt;- ifelse(predictions == "1", probabilities, 1 - probabilities)</span></span>
<span id="cb194-3024"><a href="#cb194-3024" aria-hidden="true" tabindex="-1"></a><span class="in">          roc_curve &lt;- roc(as.numeric(as.character(test_y)), probabilities)</span></span>
<span id="cb194-3025"><a href="#cb194-3025" aria-hidden="true" tabindex="-1"></a><span class="in">          inner_auc[inner_index] &lt;- roc_curve$auc</span></span>
<span id="cb194-3026"><a href="#cb194-3026" aria-hidden="true" tabindex="-1"></a><span class="in">        }, error = function(e) {</span></span>
<span id="cb194-3027"><a href="#cb194-3027" aria-hidden="true" tabindex="-1"></a><span class="in">          cat("Error with parameters: k =", grid$k[params], ", l =", grid$l[params], "\n")</span></span>
<span id="cb194-3028"><a href="#cb194-3028" aria-hidden="true" tabindex="-1"></a><span class="in">          cat("Error message: ", e$message, "\n")</span></span>
<span id="cb194-3029"><a href="#cb194-3029" aria-hidden="true" tabindex="-1"></a><span class="in">          inner_auc[inner_index] &lt;- 0</span></span>
<span id="cb194-3030"><a href="#cb194-3030" aria-hidden="true" tabindex="-1"></a><span class="in">        })</span></span>
<span id="cb194-3031"><a href="#cb194-3031" aria-hidden="true" tabindex="-1"></a><span class="in">      }</span></span>
<span id="cb194-3032"><a href="#cb194-3032" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-3033"><a href="#cb194-3033" aria-hidden="true" tabindex="-1"></a><span class="in">      if (mean(inner_auc, na.rm = TRUE) &gt; best_auc) {</span></span>
<span id="cb194-3034"><a href="#cb194-3034" aria-hidden="true" tabindex="-1"></a><span class="in">        best_auc &lt;- mean(inner_auc, na.rm = TRUE)</span></span>
<span id="cb194-3035"><a href="#cb194-3035" aria-hidden="true" tabindex="-1"></a><span class="in">        best_model &lt;- list(train_x = train_x, train_y = train_y, k = grid$k[params], l = grid$l[params])</span></span>
<span id="cb194-3036"><a href="#cb194-3036" aria-hidden="true" tabindex="-1"></a><span class="in">        best_k &lt;- grid$k[params]</span></span>
<span id="cb194-3037"><a href="#cb194-3037" aria-hidden="true" tabindex="-1"></a><span class="in">        best_l &lt;- grid$l[params]</span></span>
<span id="cb194-3038"><a href="#cb194-3038" aria-hidden="true" tabindex="-1"></a><span class="in">      }</span></span>
<span id="cb194-3039"><a href="#cb194-3039" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb194-3040"><a href="#cb194-3040" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-3041"><a href="#cb194-3041" aria-hidden="true" tabindex="-1"></a><span class="in">    if (is.null(best_model)) {</span></span>
<span id="cb194-3042"><a href="#cb194-3042" aria-hidden="true" tabindex="-1"></a><span class="in">      cat("No valid model found for outer fold ", outer_index, "\n")</span></span>
<span id="cb194-3043"><a href="#cb194-3043" aria-hidden="true" tabindex="-1"></a><span class="in">      next</span></span>
<span id="cb194-3044"><a href="#cb194-3044" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb194-3045"><a href="#cb194-3045" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-3046"><a href="#cb194-3046" aria-hidden="true" tabindex="-1"></a><span class="in">    # Reentrenar el mejor modelo con todos los datos de outer_train_data</span></span>
<span id="cb194-3047"><a href="#cb194-3047" aria-hidden="true" tabindex="-1"></a><span class="in">    train_x &lt;- outer_train_data[, variables, drop = FALSE]</span></span>
<span id="cb194-3048"><a href="#cb194-3048" aria-hidden="true" tabindex="-1"></a><span class="in">    train_y &lt;- outer_train_data[[target_name]]</span></span>
<span id="cb194-3049"><a href="#cb194-3049" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-3050"><a href="#cb194-3050" aria-hidden="true" tabindex="-1"></a><span class="in">    # Evaluar el mejor modelo en el conjunto de prueba del outer fold</span></span>
<span id="cb194-3051"><a href="#cb194-3051" aria-hidden="true" tabindex="-1"></a><span class="in">    test_x &lt;- outer_test_data[, variables, drop = FALSE]</span></span>
<span id="cb194-3052"><a href="#cb194-3052" aria-hidden="true" tabindex="-1"></a><span class="in">    test_y &lt;- outer_test_data[[target_name]]</span></span>
<span id="cb194-3053"><a href="#cb194-3053" aria-hidden="true" tabindex="-1"></a><span class="in">    predictions &lt;- knn(train = train_x, test = test_x, cl = train_y, k = best_k, prob = TRUE)</span></span>
<span id="cb194-3054"><a href="#cb194-3054" aria-hidden="true" tabindex="-1"></a><span class="in">    probabilities &lt;- attr(predictions, "prob")</span></span>
<span id="cb194-3055"><a href="#cb194-3055" aria-hidden="true" tabindex="-1"></a><span class="in">    probabilities &lt;- ifelse(predictions == "1", probabilities, 1 - probabilities)</span></span>
<span id="cb194-3056"><a href="#cb194-3056" aria-hidden="true" tabindex="-1"></a><span class="in">    pred_class &lt;- ifelse(probabilities &gt; threshold, "1", "0")</span></span>
<span id="cb194-3057"><a href="#cb194-3057" aria-hidden="true" tabindex="-1"></a><span class="in">    confusion &lt;- table(Actual = test_y, Predicted = pred_class)</span></span>
<span id="cb194-3058"><a href="#cb194-3058" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-3059"><a href="#cb194-3059" aria-hidden="true" tabindex="-1"></a><span class="in">    if (nrow(confusion) &lt; 2 || ncol(confusion) &lt; 2) {</span></span>
<span id="cb194-3060"><a href="#cb194-3060" aria-hidden="true" tabindex="-1"></a><span class="in">      TP &lt;- ifelse(nrow(confusion) &gt;= 2 &amp;&amp; ncol(confusion) &gt;= 2, confusion[2, 2], 0)</span></span>
<span id="cb194-3061"><a href="#cb194-3061" aria-hidden="true" tabindex="-1"></a><span class="in">      TN &lt;- ifelse(nrow(confusion) &gt;= 1 &amp;&amp; ncol(confusion) &gt;= 1, confusion[1, 1], 0)</span></span>
<span id="cb194-3062"><a href="#cb194-3062" aria-hidden="true" tabindex="-1"></a><span class="in">      FP &lt;- ifelse(nrow(confusion) &gt;= 1 &amp;&amp; ncol(confusion) &gt;= 2, confusion[1, 2], 0)</span></span>
<span id="cb194-3063"><a href="#cb194-3063" aria-hidden="true" tabindex="-1"></a><span class="in">      FN &lt;- ifelse(nrow(confusion) &gt;= 2 &amp;&amp; ncol(confusion) &gt;= 1, confusion[2, 1], 0)</span></span>
<span id="cb194-3064"><a href="#cb194-3064" aria-hidden="true" tabindex="-1"></a><span class="in">    } else {</span></span>
<span id="cb194-3065"><a href="#cb194-3065" aria-hidden="true" tabindex="-1"></a><span class="in">      TP &lt;- confusion[2, 2]</span></span>
<span id="cb194-3066"><a href="#cb194-3066" aria-hidden="true" tabindex="-1"></a><span class="in">      TN &lt;- confusion[1, 1]</span></span>
<span id="cb194-3067"><a href="#cb194-3067" aria-hidden="true" tabindex="-1"></a><span class="in">      FP &lt;- confusion[1, 2]</span></span>
<span id="cb194-3068"><a href="#cb194-3068" aria-hidden="true" tabindex="-1"></a><span class="in">      FN &lt;- confusion[2, 1]</span></span>
<span id="cb194-3069"><a href="#cb194-3069" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb194-3070"><a href="#cb194-3070" aria-hidden="true" tabindex="-1"></a><span class="in">    auc &lt;- roc(test_y, probabilities)$auc</span></span>
<span id="cb194-3071"><a href="#cb194-3071" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-3072"><a href="#cb194-3072" aria-hidden="true" tabindex="-1"></a><span class="in">    metrics &lt;- setNames(c(outer_index, TP, TN, FP, FN, auc, best_k, best_l), names(performance_metrics))</span></span>
<span id="cb194-3073"><a href="#cb194-3073" aria-hidden="true" tabindex="-1"></a><span class="in">    performance_metrics &lt;- rbind(performance_metrics, as.data.frame(t(metrics)))</span></span>
<span id="cb194-3074"><a href="#cb194-3074" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-3075"><a href="#cb194-3075" aria-hidden="true" tabindex="-1"></a><span class="in">    cat("Performance:", paste(performance_metrics))</span></span>
<span id="cb194-3076"><a href="#cb194-3076" aria-hidden="true" tabindex="-1"></a><span class="in">    cat(sprintf("Confusion Matrix for Fold %d:\n", outer_index))</span></span>
<span id="cb194-3077"><a href="#cb194-3077" aria-hidden="true" tabindex="-1"></a><span class="in">    print(confusion)</span></span>
<span id="cb194-3078"><a href="#cb194-3078" aria-hidden="true" tabindex="-1"></a><span class="in">    cat(sprintf("Metrics for Fold %d:\n", outer_index))</span></span>
<span id="cb194-3079"><a href="#cb194-3079" aria-hidden="true" tabindex="-1"></a><span class="in">    cat(sprintf("TP: %d, TN: %d, FP: %d, FN: %d, AUC: %f, Best k: %d, Best l: %f\n",</span></span>
<span id="cb194-3080"><a href="#cb194-3080" aria-hidden="true" tabindex="-1"></a><span class="in">                TP, TN, FP, FN, auc, best_k, best_l))</span></span>
<span id="cb194-3081"><a href="#cb194-3081" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb194-3082"><a href="#cb194-3082" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb194-3083"><a href="#cb194-3083" aria-hidden="true" tabindex="-1"></a><span class="in">  return(performance_metrics)</span></span>
<span id="cb194-3084"><a href="#cb194-3084" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb194-3085"><a href="#cb194-3085" aria-hidden="true" tabindex="-1"></a><span class="in">evaluate_with_seeds_KNN_TodasVariables_Asociacion &lt;- </span></span>
<span id="cb194-3086"><a href="#cb194-3086" aria-hidden="true" tabindex="-1"></a><span class="in">  function(evaluation_function, data, target_var, vars, threshold, seeds, outer, inner, ks, ls) {</span></span>
<span id="cb194-3087"><a href="#cb194-3087" aria-hidden="true" tabindex="-1"></a><span class="in">  results_list &lt;- list()</span></span>
<span id="cb194-3088"><a href="#cb194-3088" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-3089"><a href="#cb194-3089" aria-hidden="true" tabindex="-1"></a><span class="in">  for (seed in seeds) {</span></span>
<span id="cb194-3090"><a href="#cb194-3090" aria-hidden="true" tabindex="-1"></a><span class="in">    set.seed(seed)</span></span>
<span id="cb194-3091"><a href="#cb194-3091" aria-hidden="true" tabindex="-1"></a><span class="in">    cat("Evaluating with seed:", seed, "\n")</span></span>
<span id="cb194-3092"><a href="#cb194-3092" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-3093"><a href="#cb194-3093" aria-hidden="true" tabindex="-1"></a><span class="in">    results &lt;- evaluation_function(data = data, </span></span>
<span id="cb194-3094"><a href="#cb194-3094" aria-hidden="true" tabindex="-1"></a><span class="in">                                   target_name = target_var, </span></span>
<span id="cb194-3095"><a href="#cb194-3095" aria-hidden="true" tabindex="-1"></a><span class="in">                                   variables = vars, </span></span>
<span id="cb194-3096"><a href="#cb194-3096" aria-hidden="true" tabindex="-1"></a><span class="in">                                   threshold = threshold, </span></span>
<span id="cb194-3097"><a href="#cb194-3097" aria-hidden="true" tabindex="-1"></a><span class="in">                                   outer = outer, </span></span>
<span id="cb194-3098"><a href="#cb194-3098" aria-hidden="true" tabindex="-1"></a><span class="in">                                   inner = inner, </span></span>
<span id="cb194-3099"><a href="#cb194-3099" aria-hidden="true" tabindex="-1"></a><span class="in">                                   seed = seed,</span></span>
<span id="cb194-3100"><a href="#cb194-3100" aria-hidden="true" tabindex="-1"></a><span class="in">                                   ks = ks,</span></span>
<span id="cb194-3101"><a href="#cb194-3101" aria-hidden="true" tabindex="-1"></a><span class="in">                                   ls = ls)</span></span>
<span id="cb194-3102"><a href="#cb194-3102" aria-hidden="true" tabindex="-1"></a><span class="in">    results_list[[paste0("seed_", seed)]] &lt;- results</span></span>
<span id="cb194-3103"><a href="#cb194-3103" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb194-3104"><a href="#cb194-3104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-3105"><a href="#cb194-3105" aria-hidden="true" tabindex="-1"></a><span class="in">  return(results_list)</span></span>
<span id="cb194-3106"><a href="#cb194-3106" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb194-3107"><a href="#cb194-3107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-3108"><a href="#cb194-3108" aria-hidden="true" tabindex="-1"></a><span class="in">performance_knn_todasvariables &lt;- evaluate_with_seeds_KNN_TodasVariables_Asociacion(</span></span>
<span id="cb194-3109"><a href="#cb194-3109" aria-hidden="true" tabindex="-1"></a><span class="in">  evaluation_function = double_cross_validation_knn,</span></span>
<span id="cb194-3110"><a href="#cb194-3110" aria-hidden="true" tabindex="-1"></a><span class="in">  data = data_numeric,</span></span>
<span id="cb194-3111"><a href="#cb194-3111" aria-hidden="true" tabindex="-1"></a><span class="in">  outer = 5,</span></span>
<span id="cb194-3112"><a href="#cb194-3112" aria-hidden="true" tabindex="-1"></a><span class="in">  inner = 2,</span></span>
<span id="cb194-3113"><a href="#cb194-3113" aria-hidden="true" tabindex="-1"></a><span class="in">  target_var = "PCR",</span></span>
<span id="cb194-3114"><a href="#cb194-3114" aria-hidden="true" tabindex="-1"></a><span class="in">  ks = c(10, 16, 20, 25, 30, 32),</span></span>
<span id="cb194-3115"><a href="#cb194-3115" aria-hidden="true" tabindex="-1"></a><span class="in">  ls = c(1, 2),</span></span>
<span id="cb194-3116"><a href="#cb194-3116" aria-hidden="true" tabindex="-1"></a><span class="in">  vars = todas_variables_numeric,</span></span>
<span id="cb194-3117"><a href="#cb194-3117" aria-hidden="true" tabindex="-1"></a><span class="in">  threshold = .35,</span></span>
<span id="cb194-3118"><a href="#cb194-3118" aria-hidden="true" tabindex="-1"></a><span class="in">  seeds = seeds</span></span>
<span id="cb194-3119"><a href="#cb194-3119" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb194-3120"><a href="#cb194-3120" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-3121"><a href="#cb194-3121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-3122"><a href="#cb194-3122" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message=FALSE, warning=FALSE}</span></span>
<span id="cb194-3123"><a href="#cb194-3123" aria-hidden="true" tabindex="-1"></a><span class="in">load("RData_Files_Algorithms/KNN_TodasVariables.RData")</span></span>
<span id="cb194-3124"><a href="#cb194-3124" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-3125"><a href="#cb194-3125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-3126"><a href="#cb194-3126" aria-hidden="true" tabindex="-1"></a><span class="fu">### Filtrado (Asociación)</span></span>
<span id="cb194-3127"><a href="#cb194-3127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-3128"><a href="#cb194-3128" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=FALSE}</span></span>
<span id="cb194-3129"><a href="#cb194-3129" aria-hidden="true" tabindex="-1"></a><span class="in">performance_knn_Asociacion &lt;- evaluate_with_seeds_KNN_TodasVariables_Asociacion(</span></span>
<span id="cb194-3130"><a href="#cb194-3130" aria-hidden="true" tabindex="-1"></a><span class="in">  evaluation_function = double_cross_validation_knn,</span></span>
<span id="cb194-3131"><a href="#cb194-3131" aria-hidden="true" tabindex="-1"></a><span class="in">  data = data_numeric,</span></span>
<span id="cb194-3132"><a href="#cb194-3132" aria-hidden="true" tabindex="-1"></a><span class="in">  outer = 5,</span></span>
<span id="cb194-3133"><a href="#cb194-3133" aria-hidden="true" tabindex="-1"></a><span class="in">  inner = 2,</span></span>
<span id="cb194-3134"><a href="#cb194-3134" aria-hidden="true" tabindex="-1"></a><span class="in">  target_var = "PCR",</span></span>
<span id="cb194-3135"><a href="#cb194-3135" aria-hidden="true" tabindex="-1"></a><span class="in">  ks = c(10, 16, 20, 25, 30, 32),</span></span>
<span id="cb194-3136"><a href="#cb194-3136" aria-hidden="true" tabindex="-1"></a><span class="in">  ls = c(1, 2),</span></span>
<span id="cb194-3137"><a href="#cb194-3137" aria-hidden="true" tabindex="-1"></a><span class="in">  vars = asociacion_numeric,</span></span>
<span id="cb194-3138"><a href="#cb194-3138" aria-hidden="true" tabindex="-1"></a><span class="in">  threshold = .35,</span></span>
<span id="cb194-3139"><a href="#cb194-3139" aria-hidden="true" tabindex="-1"></a><span class="in">  seeds = seeds</span></span>
<span id="cb194-3140"><a href="#cb194-3140" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb194-3141"><a href="#cb194-3141" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-3142"><a href="#cb194-3142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-3143"><a href="#cb194-3143" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message=FALSE, warning=FALSE}</span></span>
<span id="cb194-3144"><a href="#cb194-3144" aria-hidden="true" tabindex="-1"></a><span class="in">load("RData_Files_Algorithms/KNN_Asociacion.RData")</span></span>
<span id="cb194-3145"><a href="#cb194-3145" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-3146"><a href="#cb194-3146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-3147"><a href="#cb194-3147" aria-hidden="true" tabindex="-1"></a><span class="fu">### Wrapped (StepAUC)</span></span>
<span id="cb194-3148"><a href="#cb194-3148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-3149"><a href="#cb194-3149" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=FALSE}</span></span>
<span id="cb194-3150"><a href="#cb194-3150" aria-hidden="true" tabindex="-1"></a><span class="in">double_cross_validation_knn_stepAUC &lt;- function(data, target_name, outer, inner, ks, ls, variables, threshold, seed) {</span></span>
<span id="cb194-3151"><a href="#cb194-3151" aria-hidden="true" tabindex="-1"></a><span class="in">  set.seed(seed)</span></span>
<span id="cb194-3152"><a href="#cb194-3152" aria-hidden="true" tabindex="-1"></a><span class="in">  performance_metrics &lt;- data.frame(Fold = integer(), TP = integer(), TN = integer(),</span></span>
<span id="cb194-3153"><a href="#cb194-3153" aria-hidden="true" tabindex="-1"></a><span class="in">                                    FP = integer(), FN = integer(), AUC = numeric(),</span></span>
<span id="cb194-3154"><a href="#cb194-3154" aria-hidden="true" tabindex="-1"></a><span class="in">                                    Best_k = integer(), Best_l = numeric(), Best_Variables = character(), stringsAsFactors = FALSE)</span></span>
<span id="cb194-3155"><a href="#cb194-3155" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb194-3156"><a href="#cb194-3156" aria-hidden="true" tabindex="-1"></a><span class="in">  inner_fold_metrics &lt;- data.frame(Fold = integer(), Inner_Fold = integer(), </span></span>
<span id="cb194-3157"><a href="#cb194-3157" aria-hidden="true" tabindex="-1"></a><span class="in">                                   TP = integer(), TN = integer(), FP = integer(), </span></span>
<span id="cb194-3158"><a href="#cb194-3158" aria-hidden="true" tabindex="-1"></a><span class="in">                                   FN = integer(), AUC = numeric(), stringsAsFactors = FALSE)</span></span>
<span id="cb194-3159"><a href="#cb194-3159" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb194-3160"><a href="#cb194-3160" aria-hidden="true" tabindex="-1"></a><span class="in">  data[[target_name]] &lt;- as.factor(data[[target_name]])</span></span>
<span id="cb194-3161"><a href="#cb194-3161" aria-hidden="true" tabindex="-1"></a><span class="in">  outer_folds &lt;- createFolds(data[[target_name]], k = outer, list = TRUE, returnTrain = FALSE)</span></span>
<span id="cb194-3162"><a href="#cb194-3162" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb194-3163"><a href="#cb194-3163" aria-hidden="true" tabindex="-1"></a><span class="in">  for (outer_index in seq_along(outer_folds)) {</span></span>
<span id="cb194-3164"><a href="#cb194-3164" aria-hidden="true" tabindex="-1"></a><span class="in">    outer_train_data &lt;- data[-outer_folds[[outer_index]], ]</span></span>
<span id="cb194-3165"><a href="#cb194-3165" aria-hidden="true" tabindex="-1"></a><span class="in">    outer_test_data &lt;- data[outer_folds[[outer_index]], ]</span></span>
<span id="cb194-3166"><a href="#cb194-3166" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-3167"><a href="#cb194-3167" aria-hidden="true" tabindex="-1"></a><span class="in">    cat(sprintf("Outer Fold %d\n", outer_index))</span></span>
<span id="cb194-3168"><a href="#cb194-3168" aria-hidden="true" tabindex="-1"></a><span class="in">    cat("Training Data - Class 0: ", sum(outer_train_data[[target_name]] == "0"), "\n")</span></span>
<span id="cb194-3169"><a href="#cb194-3169" aria-hidden="true" tabindex="-1"></a><span class="in">    cat("Training Data - Class 1: ", sum(outer_train_data[[target_name]] == "1"), "\n")</span></span>
<span id="cb194-3170"><a href="#cb194-3170" aria-hidden="true" tabindex="-1"></a><span class="in">    cat("Testing Data - Class 0: ", sum(outer_test_data[[target_name]] == "0"), "\n")</span></span>
<span id="cb194-3171"><a href="#cb194-3171" aria-hidden="true" tabindex="-1"></a><span class="in">    cat("Testing Data - Class 1: ", sum(outer_test_data[[target_name]] == "1"), "\n")</span></span>
<span id="cb194-3172"><a href="#cb194-3172" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-3173"><a href="#cb194-3173" aria-hidden="true" tabindex="-1"></a><span class="in">    inner_folds &lt;- createFolds(outer_train_data[[target_name]], k = inner, list = TRUE, returnTrain = FALSE)</span></span>
<span id="cb194-3174"><a href="#cb194-3174" aria-hidden="true" tabindex="-1"></a><span class="in">    best_model &lt;- NULL</span></span>
<span id="cb194-3175"><a href="#cb194-3175" aria-hidden="true" tabindex="-1"></a><span class="in">    best_auc &lt;- 0</span></span>
<span id="cb194-3176"><a href="#cb194-3176" aria-hidden="true" tabindex="-1"></a><span class="in">    best_k &lt;- NULL</span></span>
<span id="cb194-3177"><a href="#cb194-3177" aria-hidden="true" tabindex="-1"></a><span class="in">    best_l &lt;- NULL</span></span>
<span id="cb194-3178"><a href="#cb194-3178" aria-hidden="true" tabindex="-1"></a><span class="in">    best_vars &lt;- variables</span></span>
<span id="cb194-3179"><a href="#cb194-3179" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-3180"><a href="#cb194-3180" aria-hidden="true" tabindex="-1"></a><span class="in">    grid &lt;- expand.grid(k = ks, l = ls)</span></span>
<span id="cb194-3181"><a href="#cb194-3181" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-3182"><a href="#cb194-3182" aria-hidden="true" tabindex="-1"></a><span class="in">    stepAUC &lt;- function(vars, outer_train_data, target_name, grid, inner_folds) {</span></span>
<span id="cb194-3183"><a href="#cb194-3183" aria-hidden="true" tabindex="-1"></a><span class="in">      current_vars &lt;- vars</span></span>
<span id="cb194-3184"><a href="#cb194-3184" aria-hidden="true" tabindex="-1"></a><span class="in">      best_inner_auc &lt;- 0</span></span>
<span id="cb194-3185"><a href="#cb194-3185" aria-hidden="true" tabindex="-1"></a><span class="in">      best_inner_model &lt;- NULL</span></span>
<span id="cb194-3186"><a href="#cb194-3186" aria-hidden="true" tabindex="-1"></a><span class="in">      best_inner_k &lt;- NULL</span></span>
<span id="cb194-3187"><a href="#cb194-3187" aria-hidden="true" tabindex="-1"></a><span class="in">      best_inner_l &lt;- NULL</span></span>
<span id="cb194-3188"><a href="#cb194-3188" aria-hidden="true" tabindex="-1"></a><span class="in">      best_inner_vars &lt;- current_vars</span></span>
<span id="cb194-3189"><a href="#cb194-3189" aria-hidden="true" tabindex="-1"></a><span class="in">      improved &lt;- TRUE</span></span>
<span id="cb194-3190"><a href="#cb194-3190" aria-hidden="true" tabindex="-1"></a><span class="in">      </span></span>
<span id="cb194-3191"><a href="#cb194-3191" aria-hidden="true" tabindex="-1"></a><span class="in">      while (improved &amp;&amp; length(current_vars) &gt; 1) {</span></span>
<span id="cb194-3192"><a href="#cb194-3192" aria-hidden="true" tabindex="-1"></a><span class="in">        improved &lt;- FALSE</span></span>
<span id="cb194-3193"><a href="#cb194-3193" aria-hidden="true" tabindex="-1"></a><span class="in">        best_auc_in_step &lt;- best_inner_auc</span></span>
<span id="cb194-3194"><a href="#cb194-3194" aria-hidden="true" tabindex="-1"></a><span class="in">        </span></span>
<span id="cb194-3195"><a href="#cb194-3195" aria-hidden="true" tabindex="-1"></a><span class="in">        for (var in current_vars) {</span></span>
<span id="cb194-3196"><a href="#cb194-3196" aria-hidden="true" tabindex="-1"></a><span class="in">          temp_vars &lt;- setdiff(current_vars, var)</span></span>
<span id="cb194-3197"><a href="#cb194-3197" aria-hidden="true" tabindex="-1"></a><span class="in">          inner_auc &lt;- numeric()</span></span>
<span id="cb194-3198"><a href="#cb194-3198" aria-hidden="true" tabindex="-1"></a><span class="in">          </span></span>
<span id="cb194-3199"><a href="#cb194-3199" aria-hidden="true" tabindex="-1"></a><span class="in">          for (params in 1:nrow(grid)) {</span></span>
<span id="cb194-3200"><a href="#cb194-3200" aria-hidden="true" tabindex="-1"></a><span class="in">            auc_vals &lt;- numeric()</span></span>
<span id="cb194-3201"><a href="#cb194-3201" aria-hidden="true" tabindex="-1"></a><span class="in">            </span></span>
<span id="cb194-3202"><a href="#cb194-3202" aria-hidden="true" tabindex="-1"></a><span class="in">            for (inner_index in seq_along(inner_folds)) {</span></span>
<span id="cb194-3203"><a href="#cb194-3203" aria-hidden="true" tabindex="-1"></a><span class="in">              inner_train_data &lt;- outer_train_data[-inner_folds[[inner_index]], ]</span></span>
<span id="cb194-3204"><a href="#cb194-3204" aria-hidden="true" tabindex="-1"></a><span class="in">              inner_test_data &lt;- outer_train_data[inner_folds[[inner_index]], ]</span></span>
<span id="cb194-3205"><a href="#cb194-3205" aria-hidden="true" tabindex="-1"></a><span class="in">              </span></span>
<span id="cb194-3206"><a href="#cb194-3206" aria-hidden="true" tabindex="-1"></a><span class="in">              train_x &lt;- inner_train_data[, temp_vars, drop = FALSE]</span></span>
<span id="cb194-3207"><a href="#cb194-3207" aria-hidden="true" tabindex="-1"></a><span class="in">              test_x &lt;- inner_test_data[, temp_vars, drop = FALSE]</span></span>
<span id="cb194-3208"><a href="#cb194-3208" aria-hidden="true" tabindex="-1"></a><span class="in">              train_y &lt;- inner_train_data[[target_name]]</span></span>
<span id="cb194-3209"><a href="#cb194-3209" aria-hidden="true" tabindex="-1"></a><span class="in">              test_y &lt;- inner_test_data[[target_name]]</span></span>
<span id="cb194-3210"><a href="#cb194-3210" aria-hidden="true" tabindex="-1"></a><span class="in">              </span></span>
<span id="cb194-3211"><a href="#cb194-3211" aria-hidden="true" tabindex="-1"></a><span class="in">              result &lt;- tryCatch({</span></span>
<span id="cb194-3212"><a href="#cb194-3212" aria-hidden="true" tabindex="-1"></a><span class="in">                predictions &lt;- knn(train = train_x, test = test_x, cl = train_y, k = grid$k[params], l = grid$l[params], prob = TRUE)</span></span>
<span id="cb194-3213"><a href="#cb194-3213" aria-hidden="true" tabindex="-1"></a><span class="in">                probabilities &lt;- attr(predictions, "prob")</span></span>
<span id="cb194-3214"><a href="#cb194-3214" aria-hidden="true" tabindex="-1"></a><span class="in">                roc_curve &lt;- roc(as.numeric(as.character(test_y)), probabilities)</span></span>
<span id="cb194-3215"><a href="#cb194-3215" aria-hidden="true" tabindex="-1"></a><span class="in">                auc_vals[inner_index] &lt;- roc_curve$auc</span></span>
<span id="cb194-3216"><a href="#cb194-3216" aria-hidden="true" tabindex="-1"></a><span class="in">                </span></span>
<span id="cb194-3217"><a href="#cb194-3217" aria-hidden="true" tabindex="-1"></a><span class="in">              }, error = function(e) {</span></span>
<span id="cb194-3218"><a href="#cb194-3218" aria-hidden="true" tabindex="-1"></a><span class="in">                cat("Error with variables:", paste(temp_vars, collapse = ", "), "\n")</span></span>
<span id="cb194-3219"><a href="#cb194-3219" aria-hidden="true" tabindex="-1"></a><span class="in">                cat("Error message: ", e$message, "\n")</span></span>
<span id="cb194-3220"><a href="#cb194-3220" aria-hidden="true" tabindex="-1"></a><span class="in">                auc_vals[inner_index] &lt;- 0  # Set to NA or some other indicator of failure</span></span>
<span id="cb194-3221"><a href="#cb194-3221" aria-hidden="true" tabindex="-1"></a><span class="in">              })</span></span>
<span id="cb194-3222"><a href="#cb194-3222" aria-hidden="true" tabindex="-1"></a><span class="in">            }</span></span>
<span id="cb194-3223"><a href="#cb194-3223" aria-hidden="true" tabindex="-1"></a><span class="in">            </span></span>
<span id="cb194-3224"><a href="#cb194-3224" aria-hidden="true" tabindex="-1"></a><span class="in">            if (mean(auc_vals, na.rm = TRUE) &gt; best_auc_in_step) {</span></span>
<span id="cb194-3225"><a href="#cb194-3225" aria-hidden="true" tabindex="-1"></a><span class="in">              best_auc_in_step &lt;- mean(auc_vals, na.rm = TRUE)</span></span>
<span id="cb194-3226"><a href="#cb194-3226" aria-hidden="true" tabindex="-1"></a><span class="in">              best_inner_model &lt;- list(train_x = train_x, train_y = train_y, k = grid$k[params], l = grid$l[params])</span></span>
<span id="cb194-3227"><a href="#cb194-3227" aria-hidden="true" tabindex="-1"></a><span class="in">              best_inner_k &lt;- grid$k[params]</span></span>
<span id="cb194-3228"><a href="#cb194-3228" aria-hidden="true" tabindex="-1"></a><span class="in">              best_inner_l &lt;- grid$l[params]</span></span>
<span id="cb194-3229"><a href="#cb194-3229" aria-hidden="true" tabindex="-1"></a><span class="in">              best_inner_vars &lt;- temp_vars</span></span>
<span id="cb194-3230"><a href="#cb194-3230" aria-hidden="true" tabindex="-1"></a><span class="in">              improved &lt;- TRUE</span></span>
<span id="cb194-3231"><a href="#cb194-3231" aria-hidden="true" tabindex="-1"></a><span class="in">            }</span></span>
<span id="cb194-3232"><a href="#cb194-3232" aria-hidden="true" tabindex="-1"></a><span class="in">          }</span></span>
<span id="cb194-3233"><a href="#cb194-3233" aria-hidden="true" tabindex="-1"></a><span class="in">        }</span></span>
<span id="cb194-3234"><a href="#cb194-3234" aria-hidden="true" tabindex="-1"></a><span class="in">        </span></span>
<span id="cb194-3235"><a href="#cb194-3235" aria-hidden="true" tabindex="-1"></a><span class="in">        if (improved) {</span></span>
<span id="cb194-3236"><a href="#cb194-3236" aria-hidden="true" tabindex="-1"></a><span class="in">          current_vars &lt;- best_inner_vars</span></span>
<span id="cb194-3237"><a href="#cb194-3237" aria-hidden="true" tabindex="-1"></a><span class="in">          best_inner_auc &lt;- best_auc_in_step</span></span>
<span id="cb194-3238"><a href="#cb194-3238" aria-hidden="true" tabindex="-1"></a><span class="in">          cat("Vars improved: ", paste(current_vars, collapse=", "), "\n")</span></span>
<span id="cb194-3239"><a href="#cb194-3239" aria-hidden="true" tabindex="-1"></a><span class="in">          cat("AUC: ", paste(best_inner_auc), "\n")</span></span>
<span id="cb194-3240"><a href="#cb194-3240" aria-hidden="true" tabindex="-1"></a><span class="in">        }</span></span>
<span id="cb194-3241"><a href="#cb194-3241" aria-hidden="true" tabindex="-1"></a><span class="in">      }</span></span>
<span id="cb194-3242"><a href="#cb194-3242" aria-hidden="true" tabindex="-1"></a><span class="in">      </span></span>
<span id="cb194-3243"><a href="#cb194-3243" aria-hidden="true" tabindex="-1"></a><span class="in">      list(model = best_inner_model, auc = best_inner_auc, </span></span>
<span id="cb194-3244"><a href="#cb194-3244" aria-hidden="true" tabindex="-1"></a><span class="in">           k = best_inner_k, l = best_inner_l, </span></span>
<span id="cb194-3245"><a href="#cb194-3245" aria-hidden="true" tabindex="-1"></a><span class="in">           vars = best_inner_vars)</span></span>
<span id="cb194-3246"><a href="#cb194-3246" aria-hidden="true" tabindex="-1"></a><span class="in">      </span></span>
<span id="cb194-3247"><a href="#cb194-3247" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb194-3248"><a href="#cb194-3248" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-3249"><a href="#cb194-3249" aria-hidden="true" tabindex="-1"></a><span class="in">    # Después de seleccionar el mejor modelo y parámetros en los inner folds</span></span>
<span id="cb194-3250"><a href="#cb194-3250" aria-hidden="true" tabindex="-1"></a><span class="in">    best_result &lt;- stepAUC(variables, outer_train_data, target_name, grid, inner_folds)</span></span>
<span id="cb194-3251"><a href="#cb194-3251" aria-hidden="true" tabindex="-1"></a><span class="in">    best_model &lt;- best_result$model</span></span>
<span id="cb194-3252"><a href="#cb194-3252" aria-hidden="true" tabindex="-1"></a><span class="in">    best_auc &lt;- best_result$auc</span></span>
<span id="cb194-3253"><a href="#cb194-3253" aria-hidden="true" tabindex="-1"></a><span class="in">    best_k &lt;- best_result$k</span></span>
<span id="cb194-3254"><a href="#cb194-3254" aria-hidden="true" tabindex="-1"></a><span class="in">    best_l &lt;- best_result$l</span></span>
<span id="cb194-3255"><a href="#cb194-3255" aria-hidden="true" tabindex="-1"></a><span class="in">    best_vars &lt;- best_result$vars</span></span>
<span id="cb194-3256"><a href="#cb194-3256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-3257"><a href="#cb194-3257" aria-hidden="true" tabindex="-1"></a><span class="in">    # Evaluar el mejor modelo en el validation split del inner loop</span></span>
<span id="cb194-3258"><a href="#cb194-3258" aria-hidden="true" tabindex="-1"></a><span class="in">    inner_auc_vals &lt;- numeric()</span></span>
<span id="cb194-3259"><a href="#cb194-3259" aria-hidden="true" tabindex="-1"></a><span class="in">    for (inner_index in seq_along(inner_folds)) {</span></span>
<span id="cb194-3260"><a href="#cb194-3260" aria-hidden="true" tabindex="-1"></a><span class="in">      inner_train_data &lt;- outer_train_data[-inner_folds[[inner_index]], ]</span></span>
<span id="cb194-3261"><a href="#cb194-3261" aria-hidden="true" tabindex="-1"></a><span class="in">      inner_test_data &lt;- outer_train_data[inner_folds[[inner_index]], ]</span></span>
<span id="cb194-3262"><a href="#cb194-3262" aria-hidden="true" tabindex="-1"></a><span class="in">      </span></span>
<span id="cb194-3263"><a href="#cb194-3263" aria-hidden="true" tabindex="-1"></a><span class="in">      train_x &lt;- best_model$train_x</span></span>
<span id="cb194-3264"><a href="#cb194-3264" aria-hidden="true" tabindex="-1"></a><span class="in">      test_x &lt;- inner_test_data[, best_vars, drop = FALSE]</span></span>
<span id="cb194-3265"><a href="#cb194-3265" aria-hidden="true" tabindex="-1"></a><span class="in">      train_y &lt;- best_model$train_y</span></span>
<span id="cb194-3266"><a href="#cb194-3266" aria-hidden="true" tabindex="-1"></a><span class="in">      test_y &lt;- inner_test_data[[target_name]]</span></span>
<span id="cb194-3267"><a href="#cb194-3267" aria-hidden="true" tabindex="-1"></a><span class="in">      </span></span>
<span id="cb194-3268"><a href="#cb194-3268" aria-hidden="true" tabindex="-1"></a><span class="in">      predictions &lt;- knn(train = train_x, test = test_x, cl = train_y, k = best_k, l = best_l, prob = TRUE)</span></span>
<span id="cb194-3269"><a href="#cb194-3269" aria-hidden="true" tabindex="-1"></a><span class="in">      probabilities &lt;- attr(predictions, "prob")</span></span>
<span id="cb194-3270"><a href="#cb194-3270" aria-hidden="true" tabindex="-1"></a><span class="in">      roc_curve &lt;- roc(as.numeric(as.character(test_y)), probabilities)</span></span>
<span id="cb194-3271"><a href="#cb194-3271" aria-hidden="true" tabindex="-1"></a><span class="in">      inner_auc_vals[inner_index] &lt;- roc_curve$auc</span></span>
<span id="cb194-3272"><a href="#cb194-3272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-3273"><a href="#cb194-3273" aria-hidden="true" tabindex="-1"></a><span class="in">      pred_class &lt;- ifelse(probabilities &gt; threshold, "1", "0")</span></span>
<span id="cb194-3274"><a href="#cb194-3274" aria-hidden="true" tabindex="-1"></a><span class="in">      confusion &lt;- table(Actual = test_y, Predicted = pred_class)</span></span>
<span id="cb194-3275"><a href="#cb194-3275" aria-hidden="true" tabindex="-1"></a><span class="in">      TP &lt;- ifelse(nrow(confusion) &gt;= 2 &amp;&amp; ncol(confusion) &gt;= 2, confusion[2, 2], 0)</span></span>
<span id="cb194-3276"><a href="#cb194-3276" aria-hidden="true" tabindex="-1"></a><span class="in">      TN &lt;- ifelse(nrow(confusion) &gt;= 1 &amp;&amp; ncol(confusion) &gt;= 1, confusion[1, 1], 0)</span></span>
<span id="cb194-3277"><a href="#cb194-3277" aria-hidden="true" tabindex="-1"></a><span class="in">      FP &lt;- ifelse(nrow(confusion) &gt;= 1 &amp;&amp; ncol(confusion) &gt;= 2, confusion[1, 2], 0)</span></span>
<span id="cb194-3278"><a href="#cb194-3278" aria-hidden="true" tabindex="-1"></a><span class="in">      FN &lt;- ifelse(nrow(confusion) &gt;= 2 &amp;&amp; ncol(confusion) &gt;= 1, confusion[2, 1], 0)</span></span>
<span id="cb194-3279"><a href="#cb194-3279" aria-hidden="true" tabindex="-1"></a><span class="in">      auc &lt;- roc_curve$auc</span></span>
<span id="cb194-3280"><a href="#cb194-3280" aria-hidden="true" tabindex="-1"></a><span class="in">      </span></span>
<span id="cb194-3281"><a href="#cb194-3281" aria-hidden="true" tabindex="-1"></a><span class="in">      inner_metrics &lt;- setNames(c(outer_index, inner_index, TP, TN, FP, FN, auc), names(inner_fold_metrics))</span></span>
<span id="cb194-3282"><a href="#cb194-3282" aria-hidden="true" tabindex="-1"></a><span class="in">      inner_fold_metrics &lt;- rbind(inner_fold_metrics, as.data.frame(t(inner_metrics)))</span></span>
<span id="cb194-3283"><a href="#cb194-3283" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb194-3284"><a href="#cb194-3284" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-3285"><a href="#cb194-3285" aria-hidden="true" tabindex="-1"></a><span class="in">    best_inner_auc &lt;- mean(inner_auc_vals, na.rm = TRUE)</span></span>
<span id="cb194-3286"><a href="#cb194-3286" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-3287"><a href="#cb194-3287" aria-hidden="true" tabindex="-1"></a><span class="in">    # Reentrenar el mejor modelo con todos los datos de outer_train_data</span></span>
<span id="cb194-3288"><a href="#cb194-3288" aria-hidden="true" tabindex="-1"></a><span class="in">    train_x &lt;- outer_train_data[, best_vars, drop = FALSE]</span></span>
<span id="cb194-3289"><a href="#cb194-3289" aria-hidden="true" tabindex="-1"></a><span class="in">    train_y &lt;- outer_train_data[[target_name]]</span></span>
<span id="cb194-3290"><a href="#cb194-3290" aria-hidden="true" tabindex="-1"></a><span class="in">    best_model &lt;- list(train_x = train_x, train_y = train_y, k = best_k, l = best_l)</span></span>
<span id="cb194-3291"><a href="#cb194-3291" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-3292"><a href="#cb194-3292" aria-hidden="true" tabindex="-1"></a><span class="in">    # Evaluar el mejor modelo en el conjunto de prueba del outer fold</span></span>
<span id="cb194-3293"><a href="#cb194-3293" aria-hidden="true" tabindex="-1"></a><span class="in">    test_x &lt;- outer_test_data[, best_vars, drop = FALSE]</span></span>
<span id="cb194-3294"><a href="#cb194-3294" aria-hidden="true" tabindex="-1"></a><span class="in">    test_y &lt;- outer_test_data[[target_name]]</span></span>
<span id="cb194-3295"><a href="#cb194-3295" aria-hidden="true" tabindex="-1"></a><span class="in">    predictions &lt;- knn(train = best_model$train_x, test = test_x, cl = best_model$train_y, k = best_k, l = best_l, prob = TRUE)</span></span>
<span id="cb194-3296"><a href="#cb194-3296" aria-hidden="true" tabindex="-1"></a><span class="in">    probabilities &lt;- attr(predictions, "prob")</span></span>
<span id="cb194-3297"><a href="#cb194-3297" aria-hidden="true" tabindex="-1"></a><span class="in">    pred_class &lt;- ifelse(probabilities &gt; threshold, "1", "0")</span></span>
<span id="cb194-3298"><a href="#cb194-3298" aria-hidden="true" tabindex="-1"></a><span class="in">    confusion &lt;- table(Actual = test_y, Predicted = pred_class)</span></span>
<span id="cb194-3299"><a href="#cb194-3299" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-3300"><a href="#cb194-3300" aria-hidden="true" tabindex="-1"></a><span class="in">    if (nrow(confusion) &lt; 2 || ncol(confusion) &lt; 2) {</span></span>
<span id="cb194-3301"><a href="#cb194-3301" aria-hidden="true" tabindex="-1"></a><span class="in">      TP &lt;- ifelse(nrow(confusion) &gt;= 2 &amp;&amp; ncol(confusion) &gt;= 2, confusion[2, 2], 0)</span></span>
<span id="cb194-3302"><a href="#cb194-3302" aria-hidden="true" tabindex="-1"></a><span class="in">      TN &lt;- ifelse(nrow(confusion) &gt;= 1 &amp;&amp; ncol(confusion) &gt;= 1, confusion[1, 1], 0)</span></span>
<span id="cb194-3303"><a href="#cb194-3303" aria-hidden="true" tabindex="-1"></a><span class="in">      FP &lt;- ifelse(nrow(confusion) &gt;= 1 &amp;&amp; ncol(confusion) &gt;= 2, confusion[1, 2], 0)</span></span>
<span id="cb194-3304"><a href="#cb194-3304" aria-hidden="true" tabindex="-1"></a><span class="in">      FN &lt;- ifelse(nrow(confusion) &gt;= 2 &amp;&amp; ncol(confusion) &gt;= 1, confusion[2, 1], 0)</span></span>
<span id="cb194-3305"><a href="#cb194-3305" aria-hidden="true" tabindex="-1"></a><span class="in">    } else {</span></span>
<span id="cb194-3306"><a href="#cb194-3306" aria-hidden="true" tabindex="-1"></a><span class="in">      TP &lt;- confusion[2, 2]</span></span>
<span id="cb194-3307"><a href="#cb194-3307" aria-hidden="true" tabindex="-1"></a><span class="in">      TN &lt;- confusion[1, 1]</span></span>
<span id="cb194-3308"><a href="#cb194-3308" aria-hidden="true" tabindex="-1"></a><span class="in">      FP &lt;- confusion[1, 2]</span></span>
<span id="cb194-3309"><a href="#cb194-3309" aria-hidden="true" tabindex="-1"></a><span class="in">      FN &lt;- confusion[2, 1]</span></span>
<span id="cb194-3310"><a href="#cb194-3310" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb194-3311"><a href="#cb194-3311" aria-hidden="true" tabindex="-1"></a><span class="in">    auc &lt;- roc(test_y, probabilities)$auc</span></span>
<span id="cb194-3312"><a href="#cb194-3312" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-3313"><a href="#cb194-3313" aria-hidden="true" tabindex="-1"></a><span class="in">    metrics &lt;- setNames(c(outer_index, TP, TN, FP, FN, auc, </span></span>
<span id="cb194-3314"><a href="#cb194-3314" aria-hidden="true" tabindex="-1"></a><span class="in">                          best_k, best_l, paste(best_vars, collapse = ",")), </span></span>
<span id="cb194-3315"><a href="#cb194-3315" aria-hidden="true" tabindex="-1"></a><span class="in">                        names(performance_metrics))</span></span>
<span id="cb194-3316"><a href="#cb194-3316" aria-hidden="true" tabindex="-1"></a><span class="in">    performance_metrics &lt;- rbind(performance_metrics, as.data.frame(t(metrics)))</span></span>
<span id="cb194-3317"><a href="#cb194-3317" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-3318"><a href="#cb194-3318" aria-hidden="true" tabindex="-1"></a><span class="in">    cat("Performance:", paste(performance_metrics))</span></span>
<span id="cb194-3319"><a href="#cb194-3319" aria-hidden="true" tabindex="-1"></a><span class="in">    cat(sprintf("Confusion Matrix for Fold %d:\n", outer_index))</span></span>
<span id="cb194-3320"><a href="#cb194-3320" aria-hidden="true" tabindex="-1"></a><span class="in">    print(confusion)</span></span>
<span id="cb194-3321"><a href="#cb194-3321" aria-hidden="true" tabindex="-1"></a><span class="in">    cat(sprintf("Metrics for Fold %d:\n", outer_index))</span></span>
<span id="cb194-3322"><a href="#cb194-3322" aria-hidden="true" tabindex="-1"></a><span class="in">    cat(sprintf("TP: %d, TN: %d, FP: %d, FN: %d, AUC: %f, Best k: %d, Best l: %f, Best Variables: %s\n",</span></span>
<span id="cb194-3323"><a href="#cb194-3323" aria-hidden="true" tabindex="-1"></a><span class="in">                TP, TN, FP, FN, auc, best_k, best_l, paste(best_vars, collapse = ",")))</span></span>
<span id="cb194-3324"><a href="#cb194-3324" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb194-3325"><a href="#cb194-3325" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb194-3326"><a href="#cb194-3326" aria-hidden="true" tabindex="-1"></a><span class="in">  list(performance_metrics = performance_metrics, inner_fold_metrics = inner_fold_metrics)</span></span>
<span id="cb194-3327"><a href="#cb194-3327" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb194-3328"><a href="#cb194-3328" aria-hidden="true" tabindex="-1"></a><span class="in">evaluate_with_seeds_KNN_stepAUC &lt;- </span></span>
<span id="cb194-3329"><a href="#cb194-3329" aria-hidden="true" tabindex="-1"></a><span class="in">  function(evaluation_function, data, target_var, vars, threshold, seeds, outer, inner, ks, ls) {</span></span>
<span id="cb194-3330"><a href="#cb194-3330" aria-hidden="true" tabindex="-1"></a><span class="in">  results_list &lt;- list()</span></span>
<span id="cb194-3331"><a href="#cb194-3331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-3332"><a href="#cb194-3332" aria-hidden="true" tabindex="-1"></a><span class="in">  for (seed in seeds) {</span></span>
<span id="cb194-3333"><a href="#cb194-3333" aria-hidden="true" tabindex="-1"></a><span class="in">    set.seed(seed)</span></span>
<span id="cb194-3334"><a href="#cb194-3334" aria-hidden="true" tabindex="-1"></a><span class="in">    cat("Evaluating with seed:", seed, "\n")</span></span>
<span id="cb194-3335"><a href="#cb194-3335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-3336"><a href="#cb194-3336" aria-hidden="true" tabindex="-1"></a><span class="in">    results &lt;- evaluation_function(data = data, </span></span>
<span id="cb194-3337"><a href="#cb194-3337" aria-hidden="true" tabindex="-1"></a><span class="in">                                   target_name = target_var, </span></span>
<span id="cb194-3338"><a href="#cb194-3338" aria-hidden="true" tabindex="-1"></a><span class="in">                                   variables = vars, </span></span>
<span id="cb194-3339"><a href="#cb194-3339" aria-hidden="true" tabindex="-1"></a><span class="in">                                   threshold = threshold, </span></span>
<span id="cb194-3340"><a href="#cb194-3340" aria-hidden="true" tabindex="-1"></a><span class="in">                                   outer = outer, </span></span>
<span id="cb194-3341"><a href="#cb194-3341" aria-hidden="true" tabindex="-1"></a><span class="in">                                   inner = inner, </span></span>
<span id="cb194-3342"><a href="#cb194-3342" aria-hidden="true" tabindex="-1"></a><span class="in">                                   seed = seed,</span></span>
<span id="cb194-3343"><a href="#cb194-3343" aria-hidden="true" tabindex="-1"></a><span class="in">                                   ks = ks,</span></span>
<span id="cb194-3344"><a href="#cb194-3344" aria-hidden="true" tabindex="-1"></a><span class="in">                                   ls = ls)</span></span>
<span id="cb194-3345"><a href="#cb194-3345" aria-hidden="true" tabindex="-1"></a><span class="in">    results_list[[paste0("seed_", seed)]] &lt;- results</span></span>
<span id="cb194-3346"><a href="#cb194-3346" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb194-3347"><a href="#cb194-3347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-3348"><a href="#cb194-3348" aria-hidden="true" tabindex="-1"></a><span class="in">  return(results_list)</span></span>
<span id="cb194-3349"><a href="#cb194-3349" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb194-3350"><a href="#cb194-3350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-3351"><a href="#cb194-3351" aria-hidden="true" tabindex="-1"></a><span class="in">performance_knn_stepauc &lt;- evaluate_with_seeds_KNN_stepAUC(</span></span>
<span id="cb194-3352"><a href="#cb194-3352" aria-hidden="true" tabindex="-1"></a><span class="in">  evaluation_function = double_cross_validation_knn_stepAUC,</span></span>
<span id="cb194-3353"><a href="#cb194-3353" aria-hidden="true" tabindex="-1"></a><span class="in">  data = data_numeric,</span></span>
<span id="cb194-3354"><a href="#cb194-3354" aria-hidden="true" tabindex="-1"></a><span class="in">  outer = 5,</span></span>
<span id="cb194-3355"><a href="#cb194-3355" aria-hidden="true" tabindex="-1"></a><span class="in">  inner = 2,</span></span>
<span id="cb194-3356"><a href="#cb194-3356" aria-hidden="true" tabindex="-1"></a><span class="in">  target_var = "PCR",</span></span>
<span id="cb194-3357"><a href="#cb194-3357" aria-hidden="true" tabindex="-1"></a><span class="in">  ks = c(10, 16, 20, 25, 30, 32),</span></span>
<span id="cb194-3358"><a href="#cb194-3358" aria-hidden="true" tabindex="-1"></a><span class="in">  ls = c(1, 2),</span></span>
<span id="cb194-3359"><a href="#cb194-3359" aria-hidden="true" tabindex="-1"></a><span class="in">  vars = todas_variables_numeric,</span></span>
<span id="cb194-3360"><a href="#cb194-3360" aria-hidden="true" tabindex="-1"></a><span class="in">  threshold = .35,</span></span>
<span id="cb194-3361"><a href="#cb194-3361" aria-hidden="true" tabindex="-1"></a><span class="in">  seeds = seeds</span></span>
<span id="cb194-3362"><a href="#cb194-3362" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb194-3363"><a href="#cb194-3363" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-3364"><a href="#cb194-3364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-3365"><a href="#cb194-3365" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message=FALSE, warning=FALSE}</span></span>
<span id="cb194-3366"><a href="#cb194-3366" aria-hidden="true" tabindex="-1"></a><span class="in">load("RData_Files_Algorithms/KNN_StepAUC.RData")</span></span>
<span id="cb194-3367"><a href="#cb194-3367" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-3368"><a href="#cb194-3368" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-3369"><a href="#cb194-3369" aria-hidden="true" tabindex="-1"></a><span class="fu">### Embedded (Lasso)</span></span>
<span id="cb194-3370"><a href="#cb194-3370" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-3371"><a href="#cb194-3371" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=FALSE}</span></span>
<span id="cb194-3372"><a href="#cb194-3372" aria-hidden="true" tabindex="-1"></a><span class="in">double_cross_validation_knn_lasso &lt;- function(data, target_name, outer, inner, ks, ls, variables, threshold, seed) {</span></span>
<span id="cb194-3373"><a href="#cb194-3373" aria-hidden="true" tabindex="-1"></a><span class="in">  set.seed(seed)</span></span>
<span id="cb194-3374"><a href="#cb194-3374" aria-hidden="true" tabindex="-1"></a><span class="in">  performance_metrics &lt;- data.frame(Fold = integer(), TP = integer(), TN = integer(),</span></span>
<span id="cb194-3375"><a href="#cb194-3375" aria-hidden="true" tabindex="-1"></a><span class="in">                                    FP = integer(), FN = integer(), AUC = numeric(),</span></span>
<span id="cb194-3376"><a href="#cb194-3376" aria-hidden="true" tabindex="-1"></a><span class="in">                                    Best_k = integer(), Best_l = integer(), </span></span>
<span id="cb194-3377"><a href="#cb194-3377" aria-hidden="true" tabindex="-1"></a><span class="in">                                    Best_Variables = character(), stringsAsFactors = FALSE)</span></span>
<span id="cb194-3378"><a href="#cb194-3378" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb194-3379"><a href="#cb194-3379" aria-hidden="true" tabindex="-1"></a><span class="in">  inner_fold_metrics &lt;- data.frame(Fold = integer(), Inner_Fold = integer(), </span></span>
<span id="cb194-3380"><a href="#cb194-3380" aria-hidden="true" tabindex="-1"></a><span class="in">                                   TP = integer(), TN = integer(), FP = integer(), </span></span>
<span id="cb194-3381"><a href="#cb194-3381" aria-hidden="true" tabindex="-1"></a><span class="in">                                   FN = integer(), AUC = numeric(), stringsAsFactors = FALSE)</span></span>
<span id="cb194-3382"><a href="#cb194-3382" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb194-3383"><a href="#cb194-3383" aria-hidden="true" tabindex="-1"></a><span class="in">  # Convertir las variables del dataset con model.matrix</span></span>
<span id="cb194-3384"><a href="#cb194-3384" aria-hidden="true" tabindex="-1"></a><span class="in">  target &lt;- as.numeric(data[[target_name]]) - 1</span></span>
<span id="cb194-3385"><a href="#cb194-3385" aria-hidden="true" tabindex="-1"></a><span class="in">  features &lt;- data[, setdiff(names(data), target_name)]</span></span>
<span id="cb194-3386"><a href="#cb194-3386" aria-hidden="true" tabindex="-1"></a><span class="in">  data_matrix &lt;- as.data.frame(model.matrix(~ ., data=features)[,-1])  # Eliminar el intercepto</span></span>
<span id="cb194-3387"><a href="#cb194-3387" aria-hidden="true" tabindex="-1"></a><span class="in">  data_matrix[[target_name]] &lt;- target</span></span>
<span id="cb194-3388"><a href="#cb194-3388" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb194-3389"><a href="#cb194-3389" aria-hidden="true" tabindex="-1"></a><span class="in">  outer_folds &lt;- createFolds(data_matrix[[target_name]], k = outer)</span></span>
<span id="cb194-3390"><a href="#cb194-3390" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb194-3391"><a href="#cb194-3391" aria-hidden="true" tabindex="-1"></a><span class="in">  for (outer_index in seq_along(outer_folds)) {</span></span>
<span id="cb194-3392"><a href="#cb194-3392" aria-hidden="true" tabindex="-1"></a><span class="in">    outer_train_data &lt;- data_matrix[-outer_folds[[outer_index]], ]</span></span>
<span id="cb194-3393"><a href="#cb194-3393" aria-hidden="true" tabindex="-1"></a><span class="in">    outer_test_data &lt;- data_matrix[outer_folds[[outer_index]], ]</span></span>
<span id="cb194-3394"><a href="#cb194-3394" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-3395"><a href="#cb194-3395" aria-hidden="true" tabindex="-1"></a><span class="in">    cat(sprintf("Outer Fold %d\n", outer_index))</span></span>
<span id="cb194-3396"><a href="#cb194-3396" aria-hidden="true" tabindex="-1"></a><span class="in">    cat("Training Data - Class 0: ", sum(outer_train_data[[target_name]] == 0), "\n")</span></span>
<span id="cb194-3397"><a href="#cb194-3397" aria-hidden="true" tabindex="-1"></a><span class="in">    cat("Training Data - Class 1: ", sum(outer_train_data[[target_name]] == 1), "\n")</span></span>
<span id="cb194-3398"><a href="#cb194-3398" aria-hidden="true" tabindex="-1"></a><span class="in">    cat("Testing Data - Class 0: ", sum(outer_test_data[[target_name]] == 0), "\n")</span></span>
<span id="cb194-3399"><a href="#cb194-3399" aria-hidden="true" tabindex="-1"></a><span class="in">    cat("Testing Data - Class 1: ", sum(outer_test_data[[target_name]] == 1), "\n")</span></span>
<span id="cb194-3400"><a href="#cb194-3400" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-3401"><a href="#cb194-3401" aria-hidden="true" tabindex="-1"></a><span class="in">    inner_folds &lt;- createFolds(outer_train_data[[target_name]], k = inner)</span></span>
<span id="cb194-3402"><a href="#cb194-3402" aria-hidden="true" tabindex="-1"></a><span class="in">    best_model &lt;- NULL</span></span>
<span id="cb194-3403"><a href="#cb194-3403" aria-hidden="true" tabindex="-1"></a><span class="in">    best_auc &lt;- 0</span></span>
<span id="cb194-3404"><a href="#cb194-3404" aria-hidden="true" tabindex="-1"></a><span class="in">    best_k &lt;- NULL</span></span>
<span id="cb194-3405"><a href="#cb194-3405" aria-hidden="true" tabindex="-1"></a><span class="in">    best_l &lt;- NULL</span></span>
<span id="cb194-3406"><a href="#cb194-3406" aria-hidden="true" tabindex="-1"></a><span class="in">    best_vars &lt;- colnames(outer_train_data)[!colnames(outer_train_data) %in% target_name]</span></span>
<span id="cb194-3407"><a href="#cb194-3407" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-3408"><a href="#cb194-3408" aria-hidden="true" tabindex="-1"></a><span class="in">    grid &lt;- expand.grid(k = ks, l = ls)</span></span>
<span id="cb194-3409"><a href="#cb194-3409" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-3410"><a href="#cb194-3410" aria-hidden="true" tabindex="-1"></a><span class="in">    select_vars_lasso &lt;- function(data, target_name) {</span></span>
<span id="cb194-3411"><a href="#cb194-3411" aria-hidden="true" tabindex="-1"></a><span class="in">      target &lt;- as.numeric(data[[target_name]])</span></span>
<span id="cb194-3412"><a href="#cb194-3412" aria-hidden="true" tabindex="-1"></a><span class="in">      features &lt;- data[, setdiff(names(data), target_name)]</span></span>
<span id="cb194-3413"><a href="#cb194-3413" aria-hidden="true" tabindex="-1"></a><span class="in">      X &lt;- model.matrix(~ ., data=features)[,-1]  # Eliminamos el intercepto</span></span>
<span id="cb194-3414"><a href="#cb194-3414" aria-hidden="true" tabindex="-1"></a><span class="in">      y &lt;- target</span></span>
<span id="cb194-3415"><a href="#cb194-3415" aria-hidden="true" tabindex="-1"></a><span class="in">      </span></span>
<span id="cb194-3416"><a href="#cb194-3416" aria-hidden="true" tabindex="-1"></a><span class="in">      # Ajustamos el modelo Lasso</span></span>
<span id="cb194-3417"><a href="#cb194-3417" aria-hidden="true" tabindex="-1"></a><span class="in">      lasso_model &lt;- cv.glmnet(X, y, alpha=1)</span></span>
<span id="cb194-3418"><a href="#cb194-3418" aria-hidden="true" tabindex="-1"></a><span class="in">      lasso_coef &lt;- coef(lasso_model, s = "lambda.min")</span></span>
<span id="cb194-3419"><a href="#cb194-3419" aria-hidden="true" tabindex="-1"></a><span class="in">      </span></span>
<span id="cb194-3420"><a href="#cb194-3420" aria-hidden="true" tabindex="-1"></a><span class="in">      # Seleccionamos las variables no nulas</span></span>
<span id="cb194-3421"><a href="#cb194-3421" aria-hidden="true" tabindex="-1"></a><span class="in">      selected_vars &lt;- rownames(lasso_coef)[lasso_coef[, 1] != 0]</span></span>
<span id="cb194-3422"><a href="#cb194-3422" aria-hidden="true" tabindex="-1"></a><span class="in">      selected_vars &lt;- setdiff(selected_vars, "(Intercept)")</span></span>
<span id="cb194-3423"><a href="#cb194-3423" aria-hidden="true" tabindex="-1"></a><span class="in">      #cat("Selected variables by Lasso: ", paste(selected_vars, collapse=", "), "\n")</span></span>
<span id="cb194-3424"><a href="#cb194-3424" aria-hidden="true" tabindex="-1"></a><span class="in">      return(selected_vars)</span></span>
<span id="cb194-3425"><a href="#cb194-3425" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb194-3426"><a href="#cb194-3426" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-3427"><a href="#cb194-3427" aria-hidden="true" tabindex="-1"></a><span class="in">    stepAUC &lt;- function(vars, data, target_name, grid, inner_folds) {</span></span>
<span id="cb194-3428"><a href="#cb194-3428" aria-hidden="true" tabindex="-1"></a><span class="in">      best_inner_auc &lt;- 0</span></span>
<span id="cb194-3429"><a href="#cb194-3429" aria-hidden="true" tabindex="-1"></a><span class="in">      best_inner_model &lt;- NULL</span></span>
<span id="cb194-3430"><a href="#cb194-3430" aria-hidden="true" tabindex="-1"></a><span class="in">      best_inner_k &lt;- NULL</span></span>
<span id="cb194-3431"><a href="#cb194-3431" aria-hidden="true" tabindex="-1"></a><span class="in">      best_inner_l &lt;- NULL</span></span>
<span id="cb194-3432"><a href="#cb194-3432" aria-hidden="true" tabindex="-1"></a><span class="in">      best_inner_vars &lt;- vars</span></span>
<span id="cb194-3433"><a href="#cb194-3433" aria-hidden="true" tabindex="-1"></a><span class="in">      improved &lt;- TRUE</span></span>
<span id="cb194-3434"><a href="#cb194-3434" aria-hidden="true" tabindex="-1"></a><span class="in">      </span></span>
<span id="cb194-3435"><a href="#cb194-3435" aria-hidden="true" tabindex="-1"></a><span class="in">      while (improved &amp;&amp; length(vars) &gt; 1) {</span></span>
<span id="cb194-3436"><a href="#cb194-3436" aria-hidden="true" tabindex="-1"></a><span class="in">        improved &lt;- FALSE</span></span>
<span id="cb194-3437"><a href="#cb194-3437" aria-hidden="true" tabindex="-1"></a><span class="in">        best_auc_in_step &lt;- best_inner_auc</span></span>
<span id="cb194-3438"><a href="#cb194-3438" aria-hidden="true" tabindex="-1"></a><span class="in">        </span></span>
<span id="cb194-3439"><a href="#cb194-3439" aria-hidden="true" tabindex="-1"></a><span class="in">        for (params in 1:nrow(grid)) {</span></span>
<span id="cb194-3440"><a href="#cb194-3440" aria-hidden="true" tabindex="-1"></a><span class="in">          auc_vals &lt;- numeric()</span></span>
<span id="cb194-3441"><a href="#cb194-3441" aria-hidden="true" tabindex="-1"></a><span class="in">          </span></span>
<span id="cb194-3442"><a href="#cb194-3442" aria-hidden="true" tabindex="-1"></a><span class="in">          for (inner_index in seq_along(inner_folds)) {</span></span>
<span id="cb194-3443"><a href="#cb194-3443" aria-hidden="true" tabindex="-1"></a><span class="in">            inner_train_data &lt;- outer_train_data[-inner_folds[[inner_index]], ]</span></span>
<span id="cb194-3444"><a href="#cb194-3444" aria-hidden="true" tabindex="-1"></a><span class="in">            inner_test_data &lt;- outer_train_data[inner_folds[[inner_index]], ]</span></span>
<span id="cb194-3445"><a href="#cb194-3445" aria-hidden="true" tabindex="-1"></a><span class="in">            </span></span>
<span id="cb194-3446"><a href="#cb194-3446" aria-hidden="true" tabindex="-1"></a><span class="in">            selected_vars &lt;- select_vars_lasso(inner_train_data, target_name)</span></span>
<span id="cb194-3447"><a href="#cb194-3447" aria-hidden="true" tabindex="-1"></a><span class="in">            formula &lt;- as.formula(paste(target_name, "~", paste(selected_vars, collapse = "+")))</span></span>
<span id="cb194-3448"><a href="#cb194-3448" aria-hidden="true" tabindex="-1"></a><span class="in">            #cat("Testing with formula: ", deparse(formula), "\n")</span></span>
<span id="cb194-3449"><a href="#cb194-3449" aria-hidden="true" tabindex="-1"></a><span class="in">            #cat("Grid parameters - k: ", grid$k[params], ", l: ", grid$l[params], "\n")</span></span>
<span id="cb194-3450"><a href="#cb194-3450" aria-hidden="true" tabindex="-1"></a><span class="in">            </span></span>
<span id="cb194-3451"><a href="#cb194-3451" aria-hidden="true" tabindex="-1"></a><span class="in">            result &lt;- tryCatch({</span></span>
<span id="cb194-3452"><a href="#cb194-3452" aria-hidden="true" tabindex="-1"></a><span class="in">              train_x &lt;- inner_train_data[, selected_vars, drop = FALSE]</span></span>
<span id="cb194-3453"><a href="#cb194-3453" aria-hidden="true" tabindex="-1"></a><span class="in">              test_x &lt;- inner_test_data[, selected_vars, drop = FALSE]</span></span>
<span id="cb194-3454"><a href="#cb194-3454" aria-hidden="true" tabindex="-1"></a><span class="in">              train_y &lt;- inner_train_data[[target_name]]</span></span>
<span id="cb194-3455"><a href="#cb194-3455" aria-hidden="true" tabindex="-1"></a><span class="in">              test_y &lt;- inner_test_data[[target_name]]</span></span>
<span id="cb194-3456"><a href="#cb194-3456" aria-hidden="true" tabindex="-1"></a><span class="in">              </span></span>
<span id="cb194-3457"><a href="#cb194-3457" aria-hidden="true" tabindex="-1"></a><span class="in">              predictions &lt;- knn(train_x, test_x, train_y, k = grid$k[params], l = grid$l[params], prob = TRUE)</span></span>
<span id="cb194-3458"><a href="#cb194-3458" aria-hidden="true" tabindex="-1"></a><span class="in">              prob_predictions &lt;- attr(predictions, "prob")</span></span>
<span id="cb194-3459"><a href="#cb194-3459" aria-hidden="true" tabindex="-1"></a><span class="in">              prob_predictions &lt;- ifelse(predictions == "1", prob_predictions, 1 - prob_predictions)</span></span>
<span id="cb194-3460"><a href="#cb194-3460" aria-hidden="true" tabindex="-1"></a><span class="in">              roc_curve &lt;- roc(inner_test_data[[target_name]], prob_predictions)</span></span>
<span id="cb194-3461"><a href="#cb194-3461" aria-hidden="true" tabindex="-1"></a><span class="in">              auc_vals[inner_index] &lt;- roc_curve$auc</span></span>
<span id="cb194-3462"><a href="#cb194-3462" aria-hidden="true" tabindex="-1"></a><span class="in">              #cat("AUC for inner fold ", inner_index, ": ", roc_curve$auc, "\n")</span></span>
<span id="cb194-3463"><a href="#cb194-3463" aria-hidden="true" tabindex="-1"></a><span class="in">              </span></span>
<span id="cb194-3464"><a href="#cb194-3464" aria-hidden="true" tabindex="-1"></a><span class="in">            }, error = function(e) {</span></span>
<span id="cb194-3465"><a href="#cb194-3465" aria-hidden="true" tabindex="-1"></a><span class="in">              cat("Error with variables: ", paste(selected_vars, collapse = ", "), "\n")</span></span>
<span id="cb194-3466"><a href="#cb194-3466" aria-hidden="true" tabindex="-1"></a><span class="in">              cat("Error message: ", e$message, "\n")</span></span>
<span id="cb194-3467"><a href="#cb194-3467" aria-hidden="true" tabindex="-1"></a><span class="in">              auc_vals[inner_index] &lt;- NA  # Set to NA or some other indicator of failure</span></span>
<span id="cb194-3468"><a href="#cb194-3468" aria-hidden="true" tabindex="-1"></a><span class="in">            })</span></span>
<span id="cb194-3469"><a href="#cb194-3469" aria-hidden="true" tabindex="-1"></a><span class="in">          }</span></span>
<span id="cb194-3470"><a href="#cb194-3470" aria-hidden="true" tabindex="-1"></a><span class="in">          </span></span>
<span id="cb194-3471"><a href="#cb194-3471" aria-hidden="true" tabindex="-1"></a><span class="in">          mean_auc &lt;- mean(auc_vals, na.rm = TRUE)</span></span>
<span id="cb194-3472"><a href="#cb194-3472" aria-hidden="true" tabindex="-1"></a><span class="in">          #cat("Mean AUC for params - k: ", grid$k[params], ", l: ", grid$l[params], ": ", mean_auc, "\n")</span></span>
<span id="cb194-3473"><a href="#cb194-3473" aria-hidden="true" tabindex="-1"></a><span class="in">          if (!is.na(mean_auc) &amp;&amp; mean_auc &gt; best_auc_in_step) {</span></span>
<span id="cb194-3474"><a href="#cb194-3474" aria-hidden="true" tabindex="-1"></a><span class="in">            best_auc_in_step &lt;- mean_auc</span></span>
<span id="cb194-3475"><a href="#cb194-3475" aria-hidden="true" tabindex="-1"></a><span class="in">            best_inner_model &lt;- list(k = grid$k[params], l = grid$l[params])</span></span>
<span id="cb194-3476"><a href="#cb194-3476" aria-hidden="true" tabindex="-1"></a><span class="in">            best_inner_k &lt;- grid$k[params]</span></span>
<span id="cb194-3477"><a href="#cb194-3477" aria-hidden="true" tabindex="-1"></a><span class="in">            best_inner_l &lt;- grid$l[params]</span></span>
<span id="cb194-3478"><a href="#cb194-3478" aria-hidden="true" tabindex="-1"></a><span class="in">            best_inner_vars &lt;- selected_vars</span></span>
<span id="cb194-3479"><a href="#cb194-3479" aria-hidden="true" tabindex="-1"></a><span class="in">            improved &lt;- TRUE</span></span>
<span id="cb194-3480"><a href="#cb194-3480" aria-hidden="true" tabindex="-1"></a><span class="in">          }</span></span>
<span id="cb194-3481"><a href="#cb194-3481" aria-hidden="true" tabindex="-1"></a><span class="in">        }</span></span>
<span id="cb194-3482"><a href="#cb194-3482" aria-hidden="true" tabindex="-1"></a><span class="in">        </span></span>
<span id="cb194-3483"><a href="#cb194-3483" aria-hidden="true" tabindex="-1"></a><span class="in">        if (improved) {</span></span>
<span id="cb194-3484"><a href="#cb194-3484" aria-hidden="true" tabindex="-1"></a><span class="in">          vars &lt;- best_inner_vars</span></span>
<span id="cb194-3485"><a href="#cb194-3485" aria-hidden="true" tabindex="-1"></a><span class="in">          best_inner_auc &lt;- best_auc_in_step</span></span>
<span id="cb194-3486"><a href="#cb194-3486" aria-hidden="true" tabindex="-1"></a><span class="in">          cat("Vars improved: ", paste(vars, collapse=", "), "\n")</span></span>
<span id="cb194-3487"><a href="#cb194-3487" aria-hidden="true" tabindex="-1"></a><span class="in">          cat("AUC: ", best_inner_auc, "\n")</span></span>
<span id="cb194-3488"><a href="#cb194-3488" aria-hidden="true" tabindex="-1"></a><span class="in">        }</span></span>
<span id="cb194-3489"><a href="#cb194-3489" aria-hidden="true" tabindex="-1"></a><span class="in">      }</span></span>
<span id="cb194-3490"><a href="#cb194-3490" aria-hidden="true" tabindex="-1"></a><span class="in">      </span></span>
<span id="cb194-3491"><a href="#cb194-3491" aria-hidden="true" tabindex="-1"></a><span class="in">      list(model = best_inner_model, auc = best_inner_auc, </span></span>
<span id="cb194-3492"><a href="#cb194-3492" aria-hidden="true" tabindex="-1"></a><span class="in">           k = best_inner_k, l = best_inner_l, </span></span>
<span id="cb194-3493"><a href="#cb194-3493" aria-hidden="true" tabindex="-1"></a><span class="in">           vars = best_inner_vars)</span></span>
<span id="cb194-3494"><a href="#cb194-3494" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb194-3495"><a href="#cb194-3495" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-3496"><a href="#cb194-3496" aria-hidden="true" tabindex="-1"></a><span class="in">    best_result &lt;- stepAUC(best_vars, outer_train_data, target_name, grid, inner_folds)</span></span>
<span id="cb194-3497"><a href="#cb194-3497" aria-hidden="true" tabindex="-1"></a><span class="in">    best_model &lt;- best_result$model</span></span>
<span id="cb194-3498"><a href="#cb194-3498" aria-hidden="true" tabindex="-1"></a><span class="in">    best_auc &lt;- best_result$auc</span></span>
<span id="cb194-3499"><a href="#cb194-3499" aria-hidden="true" tabindex="-1"></a><span class="in">    best_k &lt;- best_result$k</span></span>
<span id="cb194-3500"><a href="#cb194-3500" aria-hidden="true" tabindex="-1"></a><span class="in">    best_l &lt;- best_result$l</span></span>
<span id="cb194-3501"><a href="#cb194-3501" aria-hidden="true" tabindex="-1"></a><span class="in">    best_vars &lt;- best_result$vars</span></span>
<span id="cb194-3502"><a href="#cb194-3502" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-3503"><a href="#cb194-3503" aria-hidden="true" tabindex="-1"></a><span class="in">    if (is.null(best_model)) {</span></span>
<span id="cb194-3504"><a href="#cb194-3504" aria-hidden="true" tabindex="-1"></a><span class="in">      cat("Error: No valid model found for outer fold ", outer_index, "\n")</span></span>
<span id="cb194-3505"><a href="#cb194-3505" aria-hidden="true" tabindex="-1"></a><span class="in">      next</span></span>
<span id="cb194-3506"><a href="#cb194-3506" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb194-3507"><a href="#cb194-3507" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-3508"><a href="#cb194-3508" aria-hidden="true" tabindex="-1"></a><span class="in">    # Evaluar el mejor modelo en el validation split del inner loop</span></span>
<span id="cb194-3509"><a href="#cb194-3509" aria-hidden="true" tabindex="-1"></a><span class="in">    inner_auc_vals &lt;- numeric()</span></span>
<span id="cb194-3510"><a href="#cb194-3510" aria-hidden="true" tabindex="-1"></a><span class="in">    for (inner_index in seq_along(inner_folds)) {</span></span>
<span id="cb194-3511"><a href="#cb194-3511" aria-hidden="true" tabindex="-1"></a><span class="in">      inner_train_data &lt;- outer_train_data[-inner_folds[[inner_index]], ]</span></span>
<span id="cb194-3512"><a href="#cb194-3512" aria-hidden="true" tabindex="-1"></a><span class="in">      inner_test_data &lt;- outer_train_data[inner_folds[[inner_index]], ]</span></span>
<span id="cb194-3513"><a href="#cb194-3513" aria-hidden="true" tabindex="-1"></a><span class="in">      </span></span>
<span id="cb194-3514"><a href="#cb194-3514" aria-hidden="true" tabindex="-1"></a><span class="in">      train_x &lt;- inner_train_data[, best_vars, drop = FALSE]</span></span>
<span id="cb194-3515"><a href="#cb194-3515" aria-hidden="true" tabindex="-1"></a><span class="in">      test_x &lt;- inner_test_data[, best_vars, drop = FALSE]</span></span>
<span id="cb194-3516"><a href="#cb194-3516" aria-hidden="true" tabindex="-1"></a><span class="in">      train_y &lt;- inner_train_data[[target_name]]</span></span>
<span id="cb194-3517"><a href="#cb194-3517" aria-hidden="true" tabindex="-1"></a><span class="in">      test_y &lt;- inner_test_data[[target_name]]</span></span>
<span id="cb194-3518"><a href="#cb194-3518" aria-hidden="true" tabindex="-1"></a><span class="in">      </span></span>
<span id="cb194-3519"><a href="#cb194-3519" aria-hidden="true" tabindex="-1"></a><span class="in">      predictions &lt;- knn(train_x, test_x, train_y, k = best_k, l = best_l, prob = TRUE)</span></span>
<span id="cb194-3520"><a href="#cb194-3520" aria-hidden="true" tabindex="-1"></a><span class="in">      prob_predictions &lt;- attr(predictions, "prob")</span></span>
<span id="cb194-3521"><a href="#cb194-3521" aria-hidden="true" tabindex="-1"></a><span class="in">      prob_predictions &lt;- ifelse(predictions == "1", prob_predictions, 1 - prob_predictions)</span></span>
<span id="cb194-3522"><a href="#cb194-3522" aria-hidden="true" tabindex="-1"></a><span class="in">      roc_curve &lt;- roc(inner_test_data[[target_name]], prob_predictions)</span></span>
<span id="cb194-3523"><a href="#cb194-3523" aria-hidden="true" tabindex="-1"></a><span class="in">      inner_auc_vals[inner_index] &lt;- roc_curve$auc</span></span>
<span id="cb194-3524"><a href="#cb194-3524" aria-hidden="true" tabindex="-1"></a><span class="in">      cat("Inner fold ", inner_index, " AUC: ", roc_curve$auc, "\n")</span></span>
<span id="cb194-3525"><a href="#cb194-3525" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-3526"><a href="#cb194-3526" aria-hidden="true" tabindex="-1"></a><span class="in">      pred_class &lt;- ifelse(prob_predictions &gt; threshold, 1, 0)</span></span>
<span id="cb194-3527"><a href="#cb194-3527" aria-hidden="true" tabindex="-1"></a><span class="in">      confusion &lt;- table(Actual = inner_test_data[[target_name]], Predicted = pred_class)</span></span>
<span id="cb194-3528"><a href="#cb194-3528" aria-hidden="true" tabindex="-1"></a><span class="in">      TP &lt;- ifelse(nrow(confusion) &gt;= 2 &amp;&amp; ncol(confusion) &gt;= 2, confusion[2, 2], 0)</span></span>
<span id="cb194-3529"><a href="#cb194-3529" aria-hidden="true" tabindex="-1"></a><span class="in">      TN &lt;- ifelse(nrow(confusion) &gt;= 1 &amp;&amp; ncol(confusion) &gt;= 1, confusion[1, 1], 0)</span></span>
<span id="cb194-3530"><a href="#cb194-3530" aria-hidden="true" tabindex="-1"></a><span class="in">      FP &lt;- ifelse(nrow(confusion) &gt;= 1 &amp;&amp; ncol(confusion) &gt;= 2, confusion[1, 2], 0)</span></span>
<span id="cb194-3531"><a href="#cb194-3531" aria-hidden="true" tabindex="-1"></a><span class="in">      FN &lt;- ifelse(nrow(confusion) &gt;= 2 &amp;&amp; ncol(confusion) &gt;= 1, confusion[2, 1], 0)</span></span>
<span id="cb194-3532"><a href="#cb194-3532" aria-hidden="true" tabindex="-1"></a><span class="in">      auc &lt;- roc_curve$auc</span></span>
<span id="cb194-3533"><a href="#cb194-3533" aria-hidden="true" tabindex="-1"></a><span class="in">      </span></span>
<span id="cb194-3534"><a href="#cb194-3534" aria-hidden="true" tabindex="-1"></a><span class="in">      inner_metrics &lt;- setNames(c(outer_index, inner_index, TP, TN, FP, FN, auc), names(inner_fold_metrics))</span></span>
<span id="cb194-3535"><a href="#cb194-3535" aria-hidden="true" tabindex="-1"></a><span class="in">      inner_fold_metrics &lt;- rbind(inner_fold_metrics, as.data.frame(t(inner_metrics)))</span></span>
<span id="cb194-3536"><a href="#cb194-3536" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb194-3537"><a href="#cb194-3537" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-3538"><a href="#cb194-3538" aria-hidden="true" tabindex="-1"></a><span class="in">    best_inner_auc &lt;- mean(inner_auc_vals, na.rm = TRUE)</span></span>
<span id="cb194-3539"><a href="#cb194-3539" aria-hidden="true" tabindex="-1"></a><span class="in">    cat("Best inner AUC: ", best_inner_auc, "\n")</span></span>
<span id="cb194-3540"><a href="#cb194-3540" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-3541"><a href="#cb194-3541" aria-hidden="true" tabindex="-1"></a><span class="in">    # Reentrenar el mejor modelo con todos los datos de outer_train_data</span></span>
<span id="cb194-3542"><a href="#cb194-3542" aria-hidden="true" tabindex="-1"></a><span class="in">    train_x &lt;- outer_train_data[, best_vars, drop = FALSE]</span></span>
<span id="cb194-3543"><a href="#cb194-3543" aria-hidden="true" tabindex="-1"></a><span class="in">    train_y &lt;- outer_train_data[[target_name]]</span></span>
<span id="cb194-3544"><a href="#cb194-3544" aria-hidden="true" tabindex="-1"></a><span class="in">    best_model &lt;- list(train_x = train_x, train_y = train_y, k = best_k, l = best_l)</span></span>
<span id="cb194-3545"><a href="#cb194-3545" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-3546"><a href="#cb194-3546" aria-hidden="true" tabindex="-1"></a><span class="in">    # Evaluar el mejor modelo en el conjunto de prueba del outer fold</span></span>
<span id="cb194-3547"><a href="#cb194-3547" aria-hidden="true" tabindex="-1"></a><span class="in">    test_x &lt;- outer_test_data[, best_vars, drop = FALSE]</span></span>
<span id="cb194-3548"><a href="#cb194-3548" aria-hidden="true" tabindex="-1"></a><span class="in">    test_y &lt;- outer_test_data[[target_name]]</span></span>
<span id="cb194-3549"><a href="#cb194-3549" aria-hidden="true" tabindex="-1"></a><span class="in">    predictions &lt;- knn(train = best_model$train_x, test = test_x, cl = best_model$train_y, k = best_k, l = best_l, prob = TRUE)</span></span>
<span id="cb194-3550"><a href="#cb194-3550" aria-hidden="true" tabindex="-1"></a><span class="in">    prob_predictions &lt;- attr(predictions, "prob")</span></span>
<span id="cb194-3551"><a href="#cb194-3551" aria-hidden="true" tabindex="-1"></a><span class="in">    prob_predictions &lt;- ifelse(predictions == "1", prob_predictions, 1 - prob_predictions)</span></span>
<span id="cb194-3552"><a href="#cb194-3552" aria-hidden="true" tabindex="-1"></a><span class="in">    pred_class &lt;- ifelse(prob_predictions &gt; threshold, 1, 0)</span></span>
<span id="cb194-3553"><a href="#cb194-3553" aria-hidden="true" tabindex="-1"></a><span class="in">    confusion &lt;- table(Actual = test_y, Predicted = pred_class)</span></span>
<span id="cb194-3554"><a href="#cb194-3554" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-3555"><a href="#cb194-3555" aria-hidden="true" tabindex="-1"></a><span class="in">    if (nrow(confusion) &lt; 2 || ncol(confusion) &lt; 2) {</span></span>
<span id="cb194-3556"><a href="#cb194-3556" aria-hidden="true" tabindex="-1"></a><span class="in">      TP &lt;- ifelse(nrow(confusion) &gt;= 2 &amp;&amp; ncol(confusion) &gt;= 2, confusion[2, 2], 0)</span></span>
<span id="cb194-3557"><a href="#cb194-3557" aria-hidden="true" tabindex="-1"></a><span class="in">      TN &lt;- ifelse(nrow(confusion) &gt;= 1 &amp;&amp; ncol(confusion) &gt;= 1, confusion[1, 1], 0)</span></span>
<span id="cb194-3558"><a href="#cb194-3558" aria-hidden="true" tabindex="-1"></a><span class="in">      FP &lt;- ifelse(nrow(confusion) &gt;= 1 &amp;&amp; ncol(confusion) &gt;= 2, confusion[1, 2], 0)</span></span>
<span id="cb194-3559"><a href="#cb194-3559" aria-hidden="true" tabindex="-1"></a><span class="in">      FN &lt;- ifelse(nrow(confusion) &gt;= 2 &amp;&amp; ncol(confusion) &gt;= 1, confusion[2, 1], 0)</span></span>
<span id="cb194-3560"><a href="#cb194-3560" aria-hidden="true" tabindex="-1"></a><span class="in">    } else {</span></span>
<span id="cb194-3561"><a href="#cb194-3561" aria-hidden="true" tabindex="-1"></a><span class="in">      TP &lt;- confusion[2, 2]</span></span>
<span id="cb194-3562"><a href="#cb194-3562" aria-hidden="true" tabindex="-1"></a><span class="in">      TN &lt;- confusion[1, 1]</span></span>
<span id="cb194-3563"><a href="#cb194-3563" aria-hidden="true" tabindex="-1"></a><span class="in">      FP &lt;- confusion[1, 2]</span></span>
<span id="cb194-3564"><a href="#cb194-3564" aria-hidden="true" tabindex="-1"></a><span class="in">      FN &lt;- confusion[2, 1]</span></span>
<span id="cb194-3565"><a href="#cb194-3565" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb194-3566"><a href="#cb194-3566" aria-hidden="true" tabindex="-1"></a><span class="in">    auc &lt;- roc(outer_test_data[[target_name]], prob_predictions)$auc</span></span>
<span id="cb194-3567"><a href="#cb194-3567" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-3568"><a href="#cb194-3568" aria-hidden="true" tabindex="-1"></a><span class="in">    metrics &lt;- setNames(c(outer_index, TP, TN, FP, FN, auc, </span></span>
<span id="cb194-3569"><a href="#cb194-3569" aria-hidden="true" tabindex="-1"></a><span class="in">                          best_k, best_l, paste(best_vars, collapse = ",")), </span></span>
<span id="cb194-3570"><a href="#cb194-3570" aria-hidden="true" tabindex="-1"></a><span class="in">                        names(performance_metrics))</span></span>
<span id="cb194-3571"><a href="#cb194-3571" aria-hidden="true" tabindex="-1"></a><span class="in">    performance_metrics &lt;- rbind(performance_metrics, as.data.frame(t(metrics)))</span></span>
<span id="cb194-3572"><a href="#cb194-3572" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-3573"><a href="#cb194-3573" aria-hidden="true" tabindex="-1"></a><span class="in">    cat("Performance:\n", paste(performance_metrics), "\n")</span></span>
<span id="cb194-3574"><a href="#cb194-3574" aria-hidden="true" tabindex="-1"></a><span class="in">    cat(sprintf("Confusion Matrix for Fold %d:\n", outer_index))</span></span>
<span id="cb194-3575"><a href="#cb194-3575" aria-hidden="true" tabindex="-1"></a><span class="in">    print(confusion)</span></span>
<span id="cb194-3576"><a href="#cb194-3576" aria-hidden="true" tabindex="-1"></a><span class="in">    cat(sprintf("Metrics for Fold %d:\n", outer_index))</span></span>
<span id="cb194-3577"><a href="#cb194-3577" aria-hidden="true" tabindex="-1"></a><span class="in">    cat(sprintf("TP: %d, TN: %d, FP: %d, FN: %d, AUC: %f, Best k: %d, Best l: %d, Best Variables: %s\n",</span></span>
<span id="cb194-3578"><a href="#cb194-3578" aria-hidden="true" tabindex="-1"></a><span class="in">                TP, TN, FP, FN, auc, best_k, best_l, paste(best_vars, collapse = ",")))</span></span>
<span id="cb194-3579"><a href="#cb194-3579" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb194-3580"><a href="#cb194-3580" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb194-3581"><a href="#cb194-3581" aria-hidden="true" tabindex="-1"></a><span class="in">  list(performance_metrics = performance_metrics, inner_fold_metrics = inner_fold_metrics)</span></span>
<span id="cb194-3582"><a href="#cb194-3582" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb194-3583"><a href="#cb194-3583" aria-hidden="true" tabindex="-1"></a><span class="in">evaluate_with_seeds_KNN_lasso &lt;- </span></span>
<span id="cb194-3584"><a href="#cb194-3584" aria-hidden="true" tabindex="-1"></a><span class="in">  function(evaluation_function, data, target_var, vars, threshold, seeds, outer, inner, ks, ls) {</span></span>
<span id="cb194-3585"><a href="#cb194-3585" aria-hidden="true" tabindex="-1"></a><span class="in">  results_list &lt;- list()</span></span>
<span id="cb194-3586"><a href="#cb194-3586" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-3587"><a href="#cb194-3587" aria-hidden="true" tabindex="-1"></a><span class="in">  for (seed in seeds) {</span></span>
<span id="cb194-3588"><a href="#cb194-3588" aria-hidden="true" tabindex="-1"></a><span class="in">    set.seed(seed)</span></span>
<span id="cb194-3589"><a href="#cb194-3589" aria-hidden="true" tabindex="-1"></a><span class="in">    cat("Evaluating with seed:", seed, "\n")</span></span>
<span id="cb194-3590"><a href="#cb194-3590" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-3591"><a href="#cb194-3591" aria-hidden="true" tabindex="-1"></a><span class="in">    results &lt;- evaluation_function(data = data, </span></span>
<span id="cb194-3592"><a href="#cb194-3592" aria-hidden="true" tabindex="-1"></a><span class="in">                                   target_name = target_var, </span></span>
<span id="cb194-3593"><a href="#cb194-3593" aria-hidden="true" tabindex="-1"></a><span class="in">                                   variables = vars, </span></span>
<span id="cb194-3594"><a href="#cb194-3594" aria-hidden="true" tabindex="-1"></a><span class="in">                                   threshold = threshold, </span></span>
<span id="cb194-3595"><a href="#cb194-3595" aria-hidden="true" tabindex="-1"></a><span class="in">                                   outer = outer, </span></span>
<span id="cb194-3596"><a href="#cb194-3596" aria-hidden="true" tabindex="-1"></a><span class="in">                                   inner = inner, </span></span>
<span id="cb194-3597"><a href="#cb194-3597" aria-hidden="true" tabindex="-1"></a><span class="in">                                   seed = seed,</span></span>
<span id="cb194-3598"><a href="#cb194-3598" aria-hidden="true" tabindex="-1"></a><span class="in">                                   ks = ks,</span></span>
<span id="cb194-3599"><a href="#cb194-3599" aria-hidden="true" tabindex="-1"></a><span class="in">                                   ls = ls)</span></span>
<span id="cb194-3600"><a href="#cb194-3600" aria-hidden="true" tabindex="-1"></a><span class="in">    results_list[[paste0("seed_", seed)]] &lt;- results</span></span>
<span id="cb194-3601"><a href="#cb194-3601" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb194-3602"><a href="#cb194-3602" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-3603"><a href="#cb194-3603" aria-hidden="true" tabindex="-1"></a><span class="in">  return(results_list)</span></span>
<span id="cb194-3604"><a href="#cb194-3604" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb194-3605"><a href="#cb194-3605" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-3606"><a href="#cb194-3606" aria-hidden="true" tabindex="-1"></a><span class="in">performance_knn_lasso &lt;- evaluate_with_seeds_KNN_lasso(</span></span>
<span id="cb194-3607"><a href="#cb194-3607" aria-hidden="true" tabindex="-1"></a><span class="in">  evaluation_function = double_cross_validation_knn_lasso,</span></span>
<span id="cb194-3608"><a href="#cb194-3608" aria-hidden="true" tabindex="-1"></a><span class="in">  data = data_numeric,</span></span>
<span id="cb194-3609"><a href="#cb194-3609" aria-hidden="true" tabindex="-1"></a><span class="in">  outer = 5,</span></span>
<span id="cb194-3610"><a href="#cb194-3610" aria-hidden="true" tabindex="-1"></a><span class="in">  inner = 2,</span></span>
<span id="cb194-3611"><a href="#cb194-3611" aria-hidden="true" tabindex="-1"></a><span class="in">  target_var = "PCR",</span></span>
<span id="cb194-3612"><a href="#cb194-3612" aria-hidden="true" tabindex="-1"></a><span class="in">  ks = c(10, 16, 20, 25, 30, 32),</span></span>
<span id="cb194-3613"><a href="#cb194-3613" aria-hidden="true" tabindex="-1"></a><span class="in">  ls = c(1, 2),</span></span>
<span id="cb194-3614"><a href="#cb194-3614" aria-hidden="true" tabindex="-1"></a><span class="in">  vars = todas_variables_numeric,</span></span>
<span id="cb194-3615"><a href="#cb194-3615" aria-hidden="true" tabindex="-1"></a><span class="in">  threshold = .35,</span></span>
<span id="cb194-3616"><a href="#cb194-3616" aria-hidden="true" tabindex="-1"></a><span class="in">  seeds = seeds</span></span>
<span id="cb194-3617"><a href="#cb194-3617" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb194-3618"><a href="#cb194-3618" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-3619"><a href="#cb194-3619" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-3620"><a href="#cb194-3620" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message=FALSE, warning=FALSE}</span></span>
<span id="cb194-3621"><a href="#cb194-3621" aria-hidden="true" tabindex="-1"></a><span class="in">load("RData_Files_Algorithms/KNN_Lasso.RData")</span></span>
<span id="cb194-3622"><a href="#cb194-3622" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-3623"><a href="#cb194-3623" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-3624"><a href="#cb194-3624" aria-hidden="true" tabindex="-1"></a><span class="fu">## Support Vector Machines</span></span>
<span id="cb194-3625"><a href="#cb194-3625" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-3626"><a href="#cb194-3626" aria-hidden="true" tabindex="-1"></a><span class="fu">### Aparente</span></span>
<span id="cb194-3627"><a href="#cb194-3627" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-3628"><a href="#cb194-3628" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=FALSE}</span></span>
<span id="cb194-3629"><a href="#cb194-3629" aria-hidden="true" tabindex="-1"></a><span class="in">evaluate_aparent_performance_model_svm &lt;- function(data, target_var, model_func, vars = NULL, threshold = 0.5) {</span></span>
<span id="cb194-3630"><a href="#cb194-3630" aria-hidden="true" tabindex="-1"></a><span class="in">  if (is.null(vars)) {</span></span>
<span id="cb194-3631"><a href="#cb194-3631" aria-hidden="true" tabindex="-1"></a><span class="in">    vars &lt;- setdiff(names(data), target_var)</span></span>
<span id="cb194-3632"><a href="#cb194-3632" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb194-3633"><a href="#cb194-3633" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb194-3634"><a href="#cb194-3634" aria-hidden="true" tabindex="-1"></a><span class="in">  data[[target_var]] &lt;- factor(data[[target_var]], levels = c(0, 1))</span></span>
<span id="cb194-3635"><a href="#cb194-3635" aria-hidden="true" tabindex="-1"></a><span class="in">  formula &lt;- as.formula(paste(target_var, "~", paste(vars, collapse = "+")))</span></span>
<span id="cb194-3636"><a href="#cb194-3636" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb194-3637"><a href="#cb194-3637" aria-hidden="true" tabindex="-1"></a><span class="in">  model &lt;- model_func(formula, data)</span></span>
<span id="cb194-3638"><a href="#cb194-3638" aria-hidden="true" tabindex="-1"></a><span class="in">  predictions &lt;- predict(model, newdata = data, probability = TRUE)</span></span>
<span id="cb194-3639"><a href="#cb194-3639" aria-hidden="true" tabindex="-1"></a><span class="in">  predictions &lt;- attr(predictions, "probabilities")[, 2]</span></span>
<span id="cb194-3640"><a href="#cb194-3640" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb194-3641"><a href="#cb194-3641" aria-hidden="true" tabindex="-1"></a><span class="in">  actual_classes &lt;- data[[target_var]]</span></span>
<span id="cb194-3642"><a href="#cb194-3642" aria-hidden="true" tabindex="-1"></a><span class="in">  predicted_classes &lt;- ifelse(predictions &gt; threshold, 1, 0)</span></span>
<span id="cb194-3643"><a href="#cb194-3643" aria-hidden="true" tabindex="-1"></a><span class="in">  confusion_matrix &lt;- table(predicted_classes, actual_classes)</span></span>
<span id="cb194-3644"><a href="#cb194-3644" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb194-3645"><a href="#cb194-3645" aria-hidden="true" tabindex="-1"></a><span class="in">  tp &lt;- ifelse("1" %in% rownames(confusion_matrix) &amp;&amp; "1" %in% colnames(confusion_matrix), confusion_matrix["1", "1"], 0)</span></span>
<span id="cb194-3646"><a href="#cb194-3646" aria-hidden="true" tabindex="-1"></a><span class="in">  tn &lt;- ifelse("0" %in% rownames(confusion_matrix) &amp;&amp; "0" %in% colnames(confusion_matrix), confusion_matrix["0", "0"], 0)</span></span>
<span id="cb194-3647"><a href="#cb194-3647" aria-hidden="true" tabindex="-1"></a><span class="in">  fp &lt;- ifelse("1" %in% rownames(confusion_matrix) &amp;&amp; "0" %in% colnames(confusion_matrix), confusion_matrix["1", "0"], 0)</span></span>
<span id="cb194-3648"><a href="#cb194-3648" aria-hidden="true" tabindex="-1"></a><span class="in">  fn &lt;- ifelse("0" %in% rownames(confusion_matrix) &amp;&amp; "1" %in% colnames(confusion_matrix), confusion_matrix["0", "1"], 0)</span></span>
<span id="cb194-3649"><a href="#cb194-3649" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb194-3650"><a href="#cb194-3650" aria-hidden="true" tabindex="-1"></a><span class="in">  accuracy &lt;- (tp + tn) / (tp + tn + fp + fn)</span></span>
<span id="cb194-3651"><a href="#cb194-3651" aria-hidden="true" tabindex="-1"></a><span class="in">  precision &lt;- ifelse(tp + fp &gt; 0, tp / (tp + fp), 0)</span></span>
<span id="cb194-3652"><a href="#cb194-3652" aria-hidden="true" tabindex="-1"></a><span class="in">  recall &lt;- ifelse(tp + fn &gt; 0, tp / (tp + fn), 0)</span></span>
<span id="cb194-3653"><a href="#cb194-3653" aria-hidden="true" tabindex="-1"></a><span class="in">  f1_score &lt;- ifelse(precision + recall &gt; 0, 2 * (precision * recall) / (precision + recall), 0)</span></span>
<span id="cb194-3654"><a href="#cb194-3654" aria-hidden="true" tabindex="-1"></a><span class="in">  roc_obj &lt;- pROC::roc(actual_classes, predictions)</span></span>
<span id="cb194-3655"><a href="#cb194-3655" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb194-3656"><a href="#cb194-3656" aria-hidden="true" tabindex="-1"></a><span class="in">  list(confusion_matrix = confusion_matrix, accuracy = accuracy, precision = precision, </span></span>
<span id="cb194-3657"><a href="#cb194-3657" aria-hidden="true" tabindex="-1"></a><span class="in">       recall = recall, f1_score = f1_score, roc_curve = roc_obj)</span></span>
<span id="cb194-3658"><a href="#cb194-3658" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb194-3659"><a href="#cb194-3659" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-3660"><a href="#cb194-3660" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-3661"><a href="#cb194-3661" aria-hidden="true" tabindex="-1"></a><span class="in">svm_model &lt;- function(formula, data) {</span></span>
<span id="cb194-3662"><a href="#cb194-3662" aria-hidden="true" tabindex="-1"></a><span class="in">  set.seed(90)</span></span>
<span id="cb194-3663"><a href="#cb194-3663" aria-hidden="true" tabindex="-1"></a><span class="in">  x &lt;- model.matrix(formula, data)</span></span>
<span id="cb194-3664"><a href="#cb194-3664" aria-hidden="true" tabindex="-1"></a><span class="in">  y &lt;- data[[all.vars(formula)[1]]]</span></span>
<span id="cb194-3665"><a href="#cb194-3665" aria-hidden="true" tabindex="-1"></a><span class="in">  y &lt;- factor(y, levels = c(0, 1))</span></span>
<span id="cb194-3666"><a href="#cb194-3666" aria-hidden="true" tabindex="-1"></a><span class="in">  svm(x = x, y = y, kernel = "linear", cost = 100, probability = TRUE, maxiter=300, random_state=90)</span></span>
<span id="cb194-3667"><a href="#cb194-3667" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb194-3668"><a href="#cb194-3668" aria-hidden="true" tabindex="-1"></a><span class="in"># svm(x = x, y = y, kernel = "poly", cost = 5, gamma = .5, probability = TRUE, maxiter=150)</span></span>
<span id="cb194-3669"><a href="#cb194-3669" aria-hidden="true" tabindex="-1"></a><span class="in"># svm(x = x, y = y, kernel = "linear", cost = 50, probability = TRUE, maxiter=300, random_state=90)</span></span>
<span id="cb194-3670"><a href="#cb194-3670" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-3671"><a href="#cb194-3671" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-3672"><a href="#cb194-3672" aria-hidden="true" tabindex="-1"></a><span class="in">resultadosAparentesSVM &lt;- evaluate_aparent_performance_model_svm(data = data_numeric, target_var = "PCR",</span></span>
<span id="cb194-3673"><a href="#cb194-3673" aria-hidden="true" tabindex="-1"></a><span class="in">                                                             model_func = svm_model,</span></span>
<span id="cb194-3674"><a href="#cb194-3674" aria-hidden="true" tabindex="-1"></a><span class="in">                                                             vars = ".",</span></span>
<span id="cb194-3675"><a href="#cb194-3675" aria-hidden="true" tabindex="-1"></a><span class="in">                                                             threshold = .35)</span></span>
<span id="cb194-3676"><a href="#cb194-3676" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-3677"><a href="#cb194-3677" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-3678"><a href="#cb194-3678" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message=FALSE, warning=FALSE}</span></span>
<span id="cb194-3679"><a href="#cb194-3679" aria-hidden="true" tabindex="-1"></a><span class="in">load("RData_Files_Algorithms/SVM_Aparente.RData")</span></span>
<span id="cb194-3680"><a href="#cb194-3680" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-3681"><a href="#cb194-3681" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-3682"><a href="#cb194-3682" aria-hidden="true" tabindex="-1"></a><span class="fu">### Todas las Variables</span></span>
<span id="cb194-3683"><a href="#cb194-3683" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-3684"><a href="#cb194-3684" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=FALSE}</span></span>
<span id="cb194-3685"><a href="#cb194-3685" aria-hidden="true" tabindex="-1"></a><span class="in">double_cross_validation_svm &lt;- function(data, target_name, outer, inner, kernels, costs, variables, threshold, seed) {</span></span>
<span id="cb194-3686"><a href="#cb194-3686" aria-hidden="true" tabindex="-1"></a><span class="in">  set.seed(seed)</span></span>
<span id="cb194-3687"><a href="#cb194-3687" aria-hidden="true" tabindex="-1"></a><span class="in">  performance_metrics &lt;- data.frame(Fold = integer(), TP = integer(), TN = integer(),</span></span>
<span id="cb194-3688"><a href="#cb194-3688" aria-hidden="true" tabindex="-1"></a><span class="in">                                    FP = integer(), FN = integer(), AUC = numeric(),</span></span>
<span id="cb194-3689"><a href="#cb194-3689" aria-hidden="true" tabindex="-1"></a><span class="in">                                    Best_Kernel = character(), Best_Cost = numeric(), stringsAsFactors = FALSE)</span></span>
<span id="cb194-3690"><a href="#cb194-3690" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-3691"><a href="#cb194-3691" aria-hidden="true" tabindex="-1"></a><span class="in">  data[[target_name]] &lt;- as.factor(data[[target_name]])</span></span>
<span id="cb194-3692"><a href="#cb194-3692" aria-hidden="true" tabindex="-1"></a><span class="in">  outer_folds &lt;- createFolds(data[[target_name]], k = outer, list = TRUE, returnTrain = FALSE)</span></span>
<span id="cb194-3693"><a href="#cb194-3693" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb194-3694"><a href="#cb194-3694" aria-hidden="true" tabindex="-1"></a><span class="in">  for (outer_index in seq_along(outer_folds)) {</span></span>
<span id="cb194-3695"><a href="#cb194-3695" aria-hidden="true" tabindex="-1"></a><span class="in">    outer_train_data &lt;- data[-outer_folds[[outer_index]], ]</span></span>
<span id="cb194-3696"><a href="#cb194-3696" aria-hidden="true" tabindex="-1"></a><span class="in">    outer_test_data &lt;- data[outer_folds[[outer_index]], ]</span></span>
<span id="cb194-3697"><a href="#cb194-3697" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-3698"><a href="#cb194-3698" aria-hidden="true" tabindex="-1"></a><span class="in">    cat(sprintf("Outer Fold %d\n", outer_index))</span></span>
<span id="cb194-3699"><a href="#cb194-3699" aria-hidden="true" tabindex="-1"></a><span class="in">    cat("Training Data - Class 0: ", sum(outer_train_data[[target_name]] == "0"), "\n")</span></span>
<span id="cb194-3700"><a href="#cb194-3700" aria-hidden="true" tabindex="-1"></a><span class="in">    cat("Training Data - Class 1: ", sum(outer_train_data[[target_name]] == "1"), "\n")</span></span>
<span id="cb194-3701"><a href="#cb194-3701" aria-hidden="true" tabindex="-1"></a><span class="in">    cat("Testing Data - Class 0: ", sum(outer_test_data[[target_name]] == "0"), "\n")</span></span>
<span id="cb194-3702"><a href="#cb194-3702" aria-hidden="true" tabindex="-1"></a><span class="in">    cat("Testing Data - Class 1: ", sum(outer_test_data[[target_name]] == "1"), "\n")</span></span>
<span id="cb194-3703"><a href="#cb194-3703" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-3704"><a href="#cb194-3704" aria-hidden="true" tabindex="-1"></a><span class="in">    if (sum(outer_train_data[[target_name]] == "0") == 0 || sum(outer_train_data[[target_name]] == "1") == 0) {</span></span>
<span id="cb194-3705"><a href="#cb194-3705" aria-hidden="true" tabindex="-1"></a><span class="in">      cat("Skipping outer fold due to lack of class diversity\n")</span></span>
<span id="cb194-3706"><a href="#cb194-3706" aria-hidden="true" tabindex="-1"></a><span class="in">      next</span></span>
<span id="cb194-3707"><a href="#cb194-3707" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb194-3708"><a href="#cb194-3708" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-3709"><a href="#cb194-3709" aria-hidden="true" tabindex="-1"></a><span class="in">    inner_folds &lt;- createFolds(outer_train_data[[target_name]], k = inner, list = TRUE, returnTrain = FALSE)</span></span>
<span id="cb194-3710"><a href="#cb194-3710" aria-hidden="true" tabindex="-1"></a><span class="in">    best_model &lt;- NULL</span></span>
<span id="cb194-3711"><a href="#cb194-3711" aria-hidden="true" tabindex="-1"></a><span class="in">    best_auc &lt;- 0</span></span>
<span id="cb194-3712"><a href="#cb194-3712" aria-hidden="true" tabindex="-1"></a><span class="in">    best_kernel &lt;- NULL</span></span>
<span id="cb194-3713"><a href="#cb194-3713" aria-hidden="true" tabindex="-1"></a><span class="in">    best_cost &lt;- NULL</span></span>
<span id="cb194-3714"><a href="#cb194-3714" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-3715"><a href="#cb194-3715" aria-hidden="true" tabindex="-1"></a><span class="in">    grid &lt;- expand.grid(kernel = kernels, cost = costs)</span></span>
<span id="cb194-3716"><a href="#cb194-3716" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-3717"><a href="#cb194-3717" aria-hidden="true" tabindex="-1"></a><span class="in">    for (params in 1:nrow(grid)) {</span></span>
<span id="cb194-3718"><a href="#cb194-3718" aria-hidden="true" tabindex="-1"></a><span class="in">      inner_auc &lt;- numeric()</span></span>
<span id="cb194-3719"><a href="#cb194-3719" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-3720"><a href="#cb194-3720" aria-hidden="true" tabindex="-1"></a><span class="in">      for (inner_index in seq_along(inner_folds)) {</span></span>
<span id="cb194-3721"><a href="#cb194-3721" aria-hidden="true" tabindex="-1"></a><span class="in">        inner_train_data &lt;- outer_train_data[-inner_folds[[inner_index]], ]</span></span>
<span id="cb194-3722"><a href="#cb194-3722" aria-hidden="true" tabindex="-1"></a><span class="in">        inner_test_data &lt;- outer_train_data[inner_folds[[inner_index]], ]</span></span>
<span id="cb194-3723"><a href="#cb194-3723" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-3724"><a href="#cb194-3724" aria-hidden="true" tabindex="-1"></a><span class="in">        if (sum(inner_train_data[[target_name]] == "0") == 0 || sum(inner_train_data[[target_name]] == "1") == 0) {</span></span>
<span id="cb194-3725"><a href="#cb194-3725" aria-hidden="true" tabindex="-1"></a><span class="in">          cat("Skipping inner fold due to lack of class diversity\n")</span></span>
<span id="cb194-3726"><a href="#cb194-3726" aria-hidden="true" tabindex="-1"></a><span class="in">          next</span></span>
<span id="cb194-3727"><a href="#cb194-3727" aria-hidden="true" tabindex="-1"></a><span class="in">        }</span></span>
<span id="cb194-3728"><a href="#cb194-3728" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-3729"><a href="#cb194-3729" aria-hidden="true" tabindex="-1"></a><span class="in">        result &lt;- tryCatch({</span></span>
<span id="cb194-3730"><a href="#cb194-3730" aria-hidden="true" tabindex="-1"></a><span class="in">          model &lt;- svm(reformulate(variables, target_name), </span></span>
<span id="cb194-3731"><a href="#cb194-3731" aria-hidden="true" tabindex="-1"></a><span class="in">                       data = inner_train_data, kernel = grid$kernel[params], cost = grid$cost[params], </span></span>
<span id="cb194-3732"><a href="#cb194-3732" aria-hidden="true" tabindex="-1"></a><span class="in">                       probability = TRUE)</span></span>
<span id="cb194-3733"><a href="#cb194-3733" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-3734"><a href="#cb194-3734" aria-hidden="true" tabindex="-1"></a><span class="in">          pred &lt;- predict(model, inner_test_data, probability = TRUE)</span></span>
<span id="cb194-3735"><a href="#cb194-3735" aria-hidden="true" tabindex="-1"></a><span class="in">          prob &lt;- attr(pred, "probabilities")[, 2]</span></span>
<span id="cb194-3736"><a href="#cb194-3736" aria-hidden="true" tabindex="-1"></a><span class="in">          roc_curve &lt;- pROC::roc(inner_test_data[[target_name]], prob)</span></span>
<span id="cb194-3737"><a href="#cb194-3737" aria-hidden="true" tabindex="-1"></a><span class="in">          inner_auc[inner_index] &lt;- roc_curve$auc</span></span>
<span id="cb194-3738"><a href="#cb194-3738" aria-hidden="true" tabindex="-1"></a><span class="in">        }, error = function(e) {</span></span>
<span id="cb194-3739"><a href="#cb194-3739" aria-hidden="true" tabindex="-1"></a><span class="in">          cat("Error with parameters: kernel =", grid$kernel[params], ", cost =", grid$cost[params], "\n")</span></span>
<span id="cb194-3740"><a href="#cb194-3740" aria-hidden="true" tabindex="-1"></a><span class="in">          cat("Error message: ", e$message, "\n")</span></span>
<span id="cb194-3741"><a href="#cb194-3741" aria-hidden="true" tabindex="-1"></a><span class="in">          inner_auc[inner_index] &lt;- 0</span></span>
<span id="cb194-3742"><a href="#cb194-3742" aria-hidden="true" tabindex="-1"></a><span class="in">        })</span></span>
<span id="cb194-3743"><a href="#cb194-3743" aria-hidden="true" tabindex="-1"></a><span class="in">      }</span></span>
<span id="cb194-3744"><a href="#cb194-3744" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-3745"><a href="#cb194-3745" aria-hidden="true" tabindex="-1"></a><span class="in">      if (mean(inner_auc, na.rm = TRUE) &gt; best_auc) {</span></span>
<span id="cb194-3746"><a href="#cb194-3746" aria-hidden="true" tabindex="-1"></a><span class="in">        best_auc &lt;- mean(inner_auc, na.rm = TRUE)</span></span>
<span id="cb194-3747"><a href="#cb194-3747" aria-hidden="true" tabindex="-1"></a><span class="in">        best_model &lt;- model</span></span>
<span id="cb194-3748"><a href="#cb194-3748" aria-hidden="true" tabindex="-1"></a><span class="in">        best_kernel &lt;- grid$kernel[params]</span></span>
<span id="cb194-3749"><a href="#cb194-3749" aria-hidden="true" tabindex="-1"></a><span class="in">        best_cost &lt;- grid$cost[params]</span></span>
<span id="cb194-3750"><a href="#cb194-3750" aria-hidden="true" tabindex="-1"></a><span class="in">      }</span></span>
<span id="cb194-3751"><a href="#cb194-3751" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb194-3752"><a href="#cb194-3752" aria-hidden="true" tabindex="-1"></a><span class="in">    best_model &lt;- svm(reformulate(variables, target_name), </span></span>
<span id="cb194-3753"><a href="#cb194-3753" aria-hidden="true" tabindex="-1"></a><span class="in">                      data = outer_train_data, kernel = best_kernel, cost = best_cost, </span></span>
<span id="cb194-3754"><a href="#cb194-3754" aria-hidden="true" tabindex="-1"></a><span class="in">                      probability = TRUE)</span></span>
<span id="cb194-3755"><a href="#cb194-3755" aria-hidden="true" tabindex="-1"></a><span class="in">    predictions &lt;- predict(best_model, outer_test_data, probability = TRUE)</span></span>
<span id="cb194-3756"><a href="#cb194-3756" aria-hidden="true" tabindex="-1"></a><span class="in">    prob &lt;- attr(predictions, "probabilities")[, 2]</span></span>
<span id="cb194-3757"><a href="#cb194-3757" aria-hidden="true" tabindex="-1"></a><span class="in">    pred_class &lt;- ifelse(prob &gt; threshold, 1, 0)  # Asignar clases basadas en umbral</span></span>
<span id="cb194-3758"><a href="#cb194-3758" aria-hidden="true" tabindex="-1"></a><span class="in">    confusion &lt;- table(outer_test_data[[target_name]], pred_class)</span></span>
<span id="cb194-3759"><a href="#cb194-3759" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-3760"><a href="#cb194-3760" aria-hidden="true" tabindex="-1"></a><span class="in">    if (nrow(confusion) &lt; 2 || ncol(confusion) &lt; 2) {</span></span>
<span id="cb194-3761"><a href="#cb194-3761" aria-hidden="true" tabindex="-1"></a><span class="in">      TP &lt;- ifelse(nrow(confusion) &gt;= 2 &amp;&amp; ncol(confusion) &gt;= 2, confusion[2, 2], 0)</span></span>
<span id="cb194-3762"><a href="#cb194-3762" aria-hidden="true" tabindex="-1"></a><span class="in">      TN &lt;- ifelse(nrow(confusion) &gt;= 1 &amp;&amp; ncol(confusion) &gt;= 1, confusion[1, 1], 0)</span></span>
<span id="cb194-3763"><a href="#cb194-3763" aria-hidden="true" tabindex="-1"></a><span class="in">      FP &lt;- ifelse(nrow(confusion) &gt;= 1 &amp;&amp; ncol(confusion) &gt;= 2, confusion[1, 2], 0)</span></span>
<span id="cb194-3764"><a href="#cb194-3764" aria-hidden="true" tabindex="-1"></a><span class="in">      FN &lt;- ifelse(nrow(confusion) &gt;= 2 &amp;&amp; ncol(confusion) &gt;= 1, confusion[2, 1], 0)</span></span>
<span id="cb194-3765"><a href="#cb194-3765" aria-hidden="true" tabindex="-1"></a><span class="in">    } else {</span></span>
<span id="cb194-3766"><a href="#cb194-3766" aria-hidden="true" tabindex="-1"></a><span class="in">      TP &lt;- confusion[2, 2]</span></span>
<span id="cb194-3767"><a href="#cb194-3767" aria-hidden="true" tabindex="-1"></a><span class="in">      TN &lt;- confusion[1, 1]</span></span>
<span id="cb194-3768"><a href="#cb194-3768" aria-hidden="true" tabindex="-1"></a><span class="in">      FP &lt;- confusion[1, 2]</span></span>
<span id="cb194-3769"><a href="#cb194-3769" aria-hidden="true" tabindex="-1"></a><span class="in">      FN &lt;- confusion[2, 1]</span></span>
<span id="cb194-3770"><a href="#cb194-3770" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb194-3771"><a href="#cb194-3771" aria-hidden="true" tabindex="-1"></a><span class="in">    auc &lt;- pROC::roc(outer_test_data[[target_name]], prob)$auc</span></span>
<span id="cb194-3772"><a href="#cb194-3772" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-3773"><a href="#cb194-3773" aria-hidden="true" tabindex="-1"></a><span class="in">    # Crear un vector con los nombres correctos y convertir a dataframe</span></span>
<span id="cb194-3774"><a href="#cb194-3774" aria-hidden="true" tabindex="-1"></a><span class="in">    metrics &lt;- setNames(c(outer_index, TP, TN, FP, FN, auc, best_kernel, best_cost), names(performance_metrics))</span></span>
<span id="cb194-3775"><a href="#cb194-3775" aria-hidden="true" tabindex="-1"></a><span class="in">    performance_metrics &lt;- rbind(performance_metrics, as.data.frame(t(metrics)))</span></span>
<span id="cb194-3776"><a href="#cb194-3776" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb194-3777"><a href="#cb194-3777" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb194-3778"><a href="#cb194-3778" aria-hidden="true" tabindex="-1"></a><span class="in">  return(performance_metrics)</span></span>
<span id="cb194-3779"><a href="#cb194-3779" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb194-3780"><a href="#cb194-3780" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-3781"><a href="#cb194-3781" aria-hidden="true" tabindex="-1"></a><span class="in">evaluate_with_seeds_SVM_TodasVariables_Asociacion &lt;- </span></span>
<span id="cb194-3782"><a href="#cb194-3782" aria-hidden="true" tabindex="-1"></a><span class="in">  function(evaluation_function, data, target_var, vars, threshold, seeds, outer, inner, kernels, costs) {</span></span>
<span id="cb194-3783"><a href="#cb194-3783" aria-hidden="true" tabindex="-1"></a><span class="in">  results_list &lt;- list()</span></span>
<span id="cb194-3784"><a href="#cb194-3784" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-3785"><a href="#cb194-3785" aria-hidden="true" tabindex="-1"></a><span class="in">  for (seed in seeds) {</span></span>
<span id="cb194-3786"><a href="#cb194-3786" aria-hidden="true" tabindex="-1"></a><span class="in">    set.seed(seed)</span></span>
<span id="cb194-3787"><a href="#cb194-3787" aria-hidden="true" tabindex="-1"></a><span class="in">    cat("Evaluating with seed:", seed, "\n")</span></span>
<span id="cb194-3788"><a href="#cb194-3788" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-3789"><a href="#cb194-3789" aria-hidden="true" tabindex="-1"></a><span class="in">    results &lt;- evaluation_function(data = data, </span></span>
<span id="cb194-3790"><a href="#cb194-3790" aria-hidden="true" tabindex="-1"></a><span class="in">                                   target_name = target_var, </span></span>
<span id="cb194-3791"><a href="#cb194-3791" aria-hidden="true" tabindex="-1"></a><span class="in">                                   variables = vars, </span></span>
<span id="cb194-3792"><a href="#cb194-3792" aria-hidden="true" tabindex="-1"></a><span class="in">                                   threshold = threshold, </span></span>
<span id="cb194-3793"><a href="#cb194-3793" aria-hidden="true" tabindex="-1"></a><span class="in">                                   outer = outer, </span></span>
<span id="cb194-3794"><a href="#cb194-3794" aria-hidden="true" tabindex="-1"></a><span class="in">                                   inner = inner, </span></span>
<span id="cb194-3795"><a href="#cb194-3795" aria-hidden="true" tabindex="-1"></a><span class="in">                                   seed = seed,</span></span>
<span id="cb194-3796"><a href="#cb194-3796" aria-hidden="true" tabindex="-1"></a><span class="in">                                   kernels = kernels,</span></span>
<span id="cb194-3797"><a href="#cb194-3797" aria-hidden="true" tabindex="-1"></a><span class="in">                                   costs = costs)</span></span>
<span id="cb194-3798"><a href="#cb194-3798" aria-hidden="true" tabindex="-1"></a><span class="in">    results_list[[paste0("seed_", seed)]] &lt;- results</span></span>
<span id="cb194-3799"><a href="#cb194-3799" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb194-3800"><a href="#cb194-3800" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-3801"><a href="#cb194-3801" aria-hidden="true" tabindex="-1"></a><span class="in">  return(results_list)</span></span>
<span id="cb194-3802"><a href="#cb194-3802" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb194-3803"><a href="#cb194-3803" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-3804"><a href="#cb194-3804" aria-hidden="true" tabindex="-1"></a><span class="in">performance_SVM_todasvariables &lt;- evaluate_with_seeds_SVM_TodasVariables_Asociacion(</span></span>
<span id="cb194-3805"><a href="#cb194-3805" aria-hidden="true" tabindex="-1"></a><span class="in">  evaluation_function = double_cross_validation_svm,</span></span>
<span id="cb194-3806"><a href="#cb194-3806" aria-hidden="true" tabindex="-1"></a><span class="in">  data = data_factor,</span></span>
<span id="cb194-3807"><a href="#cb194-3807" aria-hidden="true" tabindex="-1"></a><span class="in">  outer = 5,</span></span>
<span id="cb194-3808"><a href="#cb194-3808" aria-hidden="true" tabindex="-1"></a><span class="in">  inner = 2,</span></span>
<span id="cb194-3809"><a href="#cb194-3809" aria-hidden="true" tabindex="-1"></a><span class="in">  target_var = "PCR",</span></span>
<span id="cb194-3810"><a href="#cb194-3810" aria-hidden="true" tabindex="-1"></a><span class="in">  kernels = c("linear", "poly"),</span></span>
<span id="cb194-3811"><a href="#cb194-3811" aria-hidden="true" tabindex="-1"></a><span class="in">  costs = c(50, 100, 200),</span></span>
<span id="cb194-3812"><a href="#cb194-3812" aria-hidden="true" tabindex="-1"></a><span class="in">  vars = todas_variables_factor,</span></span>
<span id="cb194-3813"><a href="#cb194-3813" aria-hidden="true" tabindex="-1"></a><span class="in">  threshold = .35,</span></span>
<span id="cb194-3814"><a href="#cb194-3814" aria-hidden="true" tabindex="-1"></a><span class="in">  seeds = seeds</span></span>
<span id="cb194-3815"><a href="#cb194-3815" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb194-3816"><a href="#cb194-3816" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-3817"><a href="#cb194-3817" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-3818"><a href="#cb194-3818" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message=FALSE, warning=FALSE}</span></span>
<span id="cb194-3819"><a href="#cb194-3819" aria-hidden="true" tabindex="-1"></a><span class="in">load("RData_Files_Algorithms/SVM_TodasVariables.RData")</span></span>
<span id="cb194-3820"><a href="#cb194-3820" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-3821"><a href="#cb194-3821" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-3822"><a href="#cb194-3822" aria-hidden="true" tabindex="-1"></a><span class="fu">### Filtrado (Asociación)</span></span>
<span id="cb194-3823"><a href="#cb194-3823" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-3824"><a href="#cb194-3824" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=FALSE}</span></span>
<span id="cb194-3825"><a href="#cb194-3825" aria-hidden="true" tabindex="-1"></a><span class="in">performance_svm_asociacion &lt;- evaluate_with_seeds_SVM_TodasVariables_Asociacion(</span></span>
<span id="cb194-3826"><a href="#cb194-3826" aria-hidden="true" tabindex="-1"></a><span class="in">  evaluation_function = double_cross_validation_svm,</span></span>
<span id="cb194-3827"><a href="#cb194-3827" aria-hidden="true" tabindex="-1"></a><span class="in">  data = data_factor,</span></span>
<span id="cb194-3828"><a href="#cb194-3828" aria-hidden="true" tabindex="-1"></a><span class="in">  outer = 5,</span></span>
<span id="cb194-3829"><a href="#cb194-3829" aria-hidden="true" tabindex="-1"></a><span class="in">  inner = 2,</span></span>
<span id="cb194-3830"><a href="#cb194-3830" aria-hidden="true" tabindex="-1"></a><span class="in">  target_var = "PCR",</span></span>
<span id="cb194-3831"><a href="#cb194-3831" aria-hidden="true" tabindex="-1"></a><span class="in">  kernels = c("linear", "poly"),</span></span>
<span id="cb194-3832"><a href="#cb194-3832" aria-hidden="true" tabindex="-1"></a><span class="in">  costs = c(50, 100, 200),</span></span>
<span id="cb194-3833"><a href="#cb194-3833" aria-hidden="true" tabindex="-1"></a><span class="in">  vars = asociacion,</span></span>
<span id="cb194-3834"><a href="#cb194-3834" aria-hidden="true" tabindex="-1"></a><span class="in">  threshold = .35,</span></span>
<span id="cb194-3835"><a href="#cb194-3835" aria-hidden="true" tabindex="-1"></a><span class="in">  seeds = seeds</span></span>
<span id="cb194-3836"><a href="#cb194-3836" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb194-3837"><a href="#cb194-3837" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-3838"><a href="#cb194-3838" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-3839"><a href="#cb194-3839" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message=FALSE, warning=FALSE}</span></span>
<span id="cb194-3840"><a href="#cb194-3840" aria-hidden="true" tabindex="-1"></a><span class="in">load("RData_Files_Algorithms/SVM_Asociacion.RData")</span></span>
<span id="cb194-3841"><a href="#cb194-3841" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-3842"><a href="#cb194-3842" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-3843"><a href="#cb194-3843" aria-hidden="true" tabindex="-1"></a><span class="fu">### Wrapped (StepAUC)</span></span>
<span id="cb194-3844"><a href="#cb194-3844" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-3845"><a href="#cb194-3845" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=FALSE}</span></span>
<span id="cb194-3846"><a href="#cb194-3846" aria-hidden="true" tabindex="-1"></a><span class="in">double_cross_validation_svm_stepAUC &lt;- function(data, target_name, outer, inner, kernels, costs, variables, threshold, seed) {</span></span>
<span id="cb194-3847"><a href="#cb194-3847" aria-hidden="true" tabindex="-1"></a><span class="in">  set.seed(seed)</span></span>
<span id="cb194-3848"><a href="#cb194-3848" aria-hidden="true" tabindex="-1"></a><span class="in">  performance_metrics &lt;- data.frame(Fold = integer(), TP = integer(), TN = integer(),</span></span>
<span id="cb194-3849"><a href="#cb194-3849" aria-hidden="true" tabindex="-1"></a><span class="in">                                    FP = integer(), FN = integer(), AUC = numeric(),</span></span>
<span id="cb194-3850"><a href="#cb194-3850" aria-hidden="true" tabindex="-1"></a><span class="in">                                    Best_Kernel = character(), Best_Cost = numeric(), Best_Variables = character(), stringsAsFactors = FALSE)</span></span>
<span id="cb194-3851"><a href="#cb194-3851" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb194-3852"><a href="#cb194-3852" aria-hidden="true" tabindex="-1"></a><span class="in">  inner_fold_metrics &lt;- data.frame(Fold = integer(), Inner_Fold = integer(), </span></span>
<span id="cb194-3853"><a href="#cb194-3853" aria-hidden="true" tabindex="-1"></a><span class="in">                                   TP = integer(), TN = integer(), FP = integer(), </span></span>
<span id="cb194-3854"><a href="#cb194-3854" aria-hidden="true" tabindex="-1"></a><span class="in">                                   FN = integer(), AUC = numeric(), stringsAsFactors = FALSE)</span></span>
<span id="cb194-3855"><a href="#cb194-3855" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb194-3856"><a href="#cb194-3856" aria-hidden="true" tabindex="-1"></a><span class="in">  data[[target_name]] &lt;- as.factor(data[[target_name]])</span></span>
<span id="cb194-3857"><a href="#cb194-3857" aria-hidden="true" tabindex="-1"></a><span class="in">  outer_folds &lt;- createFolds(data[[target_name]], k = outer, list = TRUE, returnTrain = FALSE)</span></span>
<span id="cb194-3858"><a href="#cb194-3858" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb194-3859"><a href="#cb194-3859" aria-hidden="true" tabindex="-1"></a><span class="in">  for (outer_index in seq_along(outer_folds)) {</span></span>
<span id="cb194-3860"><a href="#cb194-3860" aria-hidden="true" tabindex="-1"></a><span class="in">    outer_train_data &lt;- data[-outer_folds[[outer_index]], ]</span></span>
<span id="cb194-3861"><a href="#cb194-3861" aria-hidden="true" tabindex="-1"></a><span class="in">    outer_test_data &lt;- data[outer_folds[[outer_index]], ]</span></span>
<span id="cb194-3862"><a href="#cb194-3862" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-3863"><a href="#cb194-3863" aria-hidden="true" tabindex="-1"></a><span class="in">    cat(sprintf("Outer Fold %d\n", outer_index))</span></span>
<span id="cb194-3864"><a href="#cb194-3864" aria-hidden="true" tabindex="-1"></a><span class="in">    cat("Training Data - Class 0: ", sum(outer_train_data[[target_name]] == 0), "\n")</span></span>
<span id="cb194-3865"><a href="#cb194-3865" aria-hidden="true" tabindex="-1"></a><span class="in">    cat("Training Data - Class 1: ", sum(outer_train_data[[target_name]] == 1), "\n")</span></span>
<span id="cb194-3866"><a href="#cb194-3866" aria-hidden="true" tabindex="-1"></a><span class="in">    cat("Training Data - Total: ", nrow(outer_train_data), "\n")</span></span>
<span id="cb194-3867"><a href="#cb194-3867" aria-hidden="true" tabindex="-1"></a><span class="in">    cat("Testing Data - Class 0: ", sum(outer_test_data[[target_name]] == 0), "\n")</span></span>
<span id="cb194-3868"><a href="#cb194-3868" aria-hidden="true" tabindex="-1"></a><span class="in">    cat("Testing Data - Class 1: ", sum(outer_test_data[[target_name]] == 1), "\n")</span></span>
<span id="cb194-3869"><a href="#cb194-3869" aria-hidden="true" tabindex="-1"></a><span class="in">    cat("Testing Data - Total: ", nrow(outer_test_data), "\n")</span></span>
<span id="cb194-3870"><a href="#cb194-3870" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-3871"><a href="#cb194-3871" aria-hidden="true" tabindex="-1"></a><span class="in">    inner_folds &lt;- createFolds(outer_train_data[[target_name]], k = inner, list = TRUE, returnTrain = FALSE)</span></span>
<span id="cb194-3872"><a href="#cb194-3872" aria-hidden="true" tabindex="-1"></a><span class="in">    best_model &lt;- NULL</span></span>
<span id="cb194-3873"><a href="#cb194-3873" aria-hidden="true" tabindex="-1"></a><span class="in">    best_auc &lt;- 0</span></span>
<span id="cb194-3874"><a href="#cb194-3874" aria-hidden="true" tabindex="-1"></a><span class="in">    best_kernel &lt;- NULL</span></span>
<span id="cb194-3875"><a href="#cb194-3875" aria-hidden="true" tabindex="-1"></a><span class="in">    best_cost &lt;- NULL</span></span>
<span id="cb194-3876"><a href="#cb194-3876" aria-hidden="true" tabindex="-1"></a><span class="in">    best_vars &lt;- variables</span></span>
<span id="cb194-3877"><a href="#cb194-3877" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-3878"><a href="#cb194-3878" aria-hidden="true" tabindex="-1"></a><span class="in">    grid &lt;- expand.grid(kernel = kernels, cost = costs)</span></span>
<span id="cb194-3879"><a href="#cb194-3879" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-3880"><a href="#cb194-3880" aria-hidden="true" tabindex="-1"></a><span class="in">    stepAUC &lt;- function(vars, outer_train_data, target_name, grid, inner_folds) {</span></span>
<span id="cb194-3881"><a href="#cb194-3881" aria-hidden="true" tabindex="-1"></a><span class="in">      current_vars &lt;- vars</span></span>
<span id="cb194-3882"><a href="#cb194-3882" aria-hidden="true" tabindex="-1"></a><span class="in">      best_inner_auc &lt;- 0</span></span>
<span id="cb194-3883"><a href="#cb194-3883" aria-hidden="true" tabindex="-1"></a><span class="in">      best_inner_model &lt;- NULL</span></span>
<span id="cb194-3884"><a href="#cb194-3884" aria-hidden="true" tabindex="-1"></a><span class="in">      best_inner_kernel &lt;- NULL</span></span>
<span id="cb194-3885"><a href="#cb194-3885" aria-hidden="true" tabindex="-1"></a><span class="in">      best_inner_cost &lt;- NULL</span></span>
<span id="cb194-3886"><a href="#cb194-3886" aria-hidden="true" tabindex="-1"></a><span class="in">      best_inner_vars &lt;- current_vars</span></span>
<span id="cb194-3887"><a href="#cb194-3887" aria-hidden="true" tabindex="-1"></a><span class="in">      improved &lt;- TRUE</span></span>
<span id="cb194-3888"><a href="#cb194-3888" aria-hidden="true" tabindex="-1"></a><span class="in">      </span></span>
<span id="cb194-3889"><a href="#cb194-3889" aria-hidden="true" tabindex="-1"></a><span class="in">      while (improved &amp;&amp; length(current_vars) &gt; 1) {</span></span>
<span id="cb194-3890"><a href="#cb194-3890" aria-hidden="true" tabindex="-1"></a><span class="in">        improved &lt;- FALSE</span></span>
<span id="cb194-3891"><a href="#cb194-3891" aria-hidden="true" tabindex="-1"></a><span class="in">        best_auc_in_step &lt;- best_inner_auc</span></span>
<span id="cb194-3892"><a href="#cb194-3892" aria-hidden="true" tabindex="-1"></a><span class="in">        </span></span>
<span id="cb194-3893"><a href="#cb194-3893" aria-hidden="true" tabindex="-1"></a><span class="in">        for (var in current_vars) {</span></span>
<span id="cb194-3894"><a href="#cb194-3894" aria-hidden="true" tabindex="-1"></a><span class="in">          temp_vars &lt;- setdiff(current_vars, var)</span></span>
<span id="cb194-3895"><a href="#cb194-3895" aria-hidden="true" tabindex="-1"></a><span class="in">          inner_auc &lt;- numeric()</span></span>
<span id="cb194-3896"><a href="#cb194-3896" aria-hidden="true" tabindex="-1"></a><span class="in">          </span></span>
<span id="cb194-3897"><a href="#cb194-3897" aria-hidden="true" tabindex="-1"></a><span class="in">          for (params in 1:nrow(grid)) {</span></span>
<span id="cb194-3898"><a href="#cb194-3898" aria-hidden="true" tabindex="-1"></a><span class="in">            auc_vals &lt;- numeric()</span></span>
<span id="cb194-3899"><a href="#cb194-3899" aria-hidden="true" tabindex="-1"></a><span class="in">            </span></span>
<span id="cb194-3900"><a href="#cb194-3900" aria-hidden="true" tabindex="-1"></a><span class="in">            for (inner_index in seq_along(inner_folds)) {</span></span>
<span id="cb194-3901"><a href="#cb194-3901" aria-hidden="true" tabindex="-1"></a><span class="in">              inner_train_data &lt;- outer_train_data[-inner_folds[[inner_index]], ]</span></span>
<span id="cb194-3902"><a href="#cb194-3902" aria-hidden="true" tabindex="-1"></a><span class="in">              inner_test_data &lt;- outer_train_data[inner_folds[[inner_index]], ]</span></span>
<span id="cb194-3903"><a href="#cb194-3903" aria-hidden="true" tabindex="-1"></a><span class="in">              </span></span>
<span id="cb194-3904"><a href="#cb194-3904" aria-hidden="true" tabindex="-1"></a><span class="in">              result &lt;- tryCatch({</span></span>
<span id="cb194-3905"><a href="#cb194-3905" aria-hidden="true" tabindex="-1"></a><span class="in">                model &lt;- svm(as.formula(paste(target_name, "~", paste(temp_vars, collapse = "+"))),</span></span>
<span id="cb194-3906"><a href="#cb194-3906" aria-hidden="true" tabindex="-1"></a><span class="in">                             data = inner_train_data, kernel = grid$kernel[params], cost = grid$cost[params], </span></span>
<span id="cb194-3907"><a href="#cb194-3907" aria-hidden="true" tabindex="-1"></a><span class="in">                             probability = TRUE)</span></span>
<span id="cb194-3908"><a href="#cb194-3908" aria-hidden="true" tabindex="-1"></a><span class="in">                </span></span>
<span id="cb194-3909"><a href="#cb194-3909" aria-hidden="true" tabindex="-1"></a><span class="in">                predictions &lt;- predict(model, newdata = inner_test_data, probability = TRUE)</span></span>
<span id="cb194-3910"><a href="#cb194-3910" aria-hidden="true" tabindex="-1"></a><span class="in">                predictions &lt;- attr(predictions, "probabilities")[, 2]</span></span>
<span id="cb194-3911"><a href="#cb194-3911" aria-hidden="true" tabindex="-1"></a><span class="in">                roc_curve &lt;- roc(inner_test_data[[target_name]], predictions)</span></span>
<span id="cb194-3912"><a href="#cb194-3912" aria-hidden="true" tabindex="-1"></a><span class="in">                auc_vals[inner_index] &lt;- roc_curve$auc</span></span>
<span id="cb194-3913"><a href="#cb194-3913" aria-hidden="true" tabindex="-1"></a><span class="in">                </span></span>
<span id="cb194-3914"><a href="#cb194-3914" aria-hidden="true" tabindex="-1"></a><span class="in">              }, error = function(e) {</span></span>
<span id="cb194-3915"><a href="#cb194-3915" aria-hidden="true" tabindex="-1"></a><span class="in">                cat("Error with variables:", paste(temp_vars, collapse = ", "), "\n")</span></span>
<span id="cb194-3916"><a href="#cb194-3916" aria-hidden="true" tabindex="-1"></a><span class="in">                cat("Error message: ", e$message, "\n")</span></span>
<span id="cb194-3917"><a href="#cb194-3917" aria-hidden="true" tabindex="-1"></a><span class="in">                auc_vals[inner_index] &lt;- 0  # Set to NA or some other indicator of failure</span></span>
<span id="cb194-3918"><a href="#cb194-3918" aria-hidden="true" tabindex="-1"></a><span class="in">              })</span></span>
<span id="cb194-3919"><a href="#cb194-3919" aria-hidden="true" tabindex="-1"></a><span class="in">            }</span></span>
<span id="cb194-3920"><a href="#cb194-3920" aria-hidden="true" tabindex="-1"></a><span class="in">            </span></span>
<span id="cb194-3921"><a href="#cb194-3921" aria-hidden="true" tabindex="-1"></a><span class="in">            if (mean(auc_vals, na.rm = TRUE) &gt; best_auc_in_step) {</span></span>
<span id="cb194-3922"><a href="#cb194-3922" aria-hidden="true" tabindex="-1"></a><span class="in">              best_auc_in_step &lt;- mean(auc_vals, na.rm = TRUE)</span></span>
<span id="cb194-3923"><a href="#cb194-3923" aria-hidden="true" tabindex="-1"></a><span class="in">              best_inner_model &lt;- model</span></span>
<span id="cb194-3924"><a href="#cb194-3924" aria-hidden="true" tabindex="-1"></a><span class="in">              best_inner_kernel &lt;- grid$kernel[params]</span></span>
<span id="cb194-3925"><a href="#cb194-3925" aria-hidden="true" tabindex="-1"></a><span class="in">              best_inner_cost &lt;- grid$cost[params]</span></span>
<span id="cb194-3926"><a href="#cb194-3926" aria-hidden="true" tabindex="-1"></a><span class="in">              best_inner_vars &lt;- temp_vars</span></span>
<span id="cb194-3927"><a href="#cb194-3927" aria-hidden="true" tabindex="-1"></a><span class="in">              improved &lt;- TRUE</span></span>
<span id="cb194-3928"><a href="#cb194-3928" aria-hidden="true" tabindex="-1"></a><span class="in">            }</span></span>
<span id="cb194-3929"><a href="#cb194-3929" aria-hidden="true" tabindex="-1"></a><span class="in">          }</span></span>
<span id="cb194-3930"><a href="#cb194-3930" aria-hidden="true" tabindex="-1"></a><span class="in">        }</span></span>
<span id="cb194-3931"><a href="#cb194-3931" aria-hidden="true" tabindex="-1"></a><span class="in">        </span></span>
<span id="cb194-3932"><a href="#cb194-3932" aria-hidden="true" tabindex="-1"></a><span class="in">        if (improved) {</span></span>
<span id="cb194-3933"><a href="#cb194-3933" aria-hidden="true" tabindex="-1"></a><span class="in">          current_vars &lt;- best_inner_vars</span></span>
<span id="cb194-3934"><a href="#cb194-3934" aria-hidden="true" tabindex="-1"></a><span class="in">          best_inner_auc &lt;- best_auc_in_step</span></span>
<span id="cb194-3935"><a href="#cb194-3935" aria-hidden="true" tabindex="-1"></a><span class="in">          cat("Vars improved: ", paste(current_vars, collapse=", "), "\n")</span></span>
<span id="cb194-3936"><a href="#cb194-3936" aria-hidden="true" tabindex="-1"></a><span class="in">          cat("AUC: ", paste(best_inner_auc), "\n")</span></span>
<span id="cb194-3937"><a href="#cb194-3937" aria-hidden="true" tabindex="-1"></a><span class="in">        }</span></span>
<span id="cb194-3938"><a href="#cb194-3938" aria-hidden="true" tabindex="-1"></a><span class="in">      }</span></span>
<span id="cb194-3939"><a href="#cb194-3939" aria-hidden="true" tabindex="-1"></a><span class="in">      </span></span>
<span id="cb194-3940"><a href="#cb194-3940" aria-hidden="true" tabindex="-1"></a><span class="in">      list(model = best_inner_model, auc = best_inner_auc, </span></span>
<span id="cb194-3941"><a href="#cb194-3941" aria-hidden="true" tabindex="-1"></a><span class="in">           kernel = best_inner_kernel, cost = best_inner_cost, </span></span>
<span id="cb194-3942"><a href="#cb194-3942" aria-hidden="true" tabindex="-1"></a><span class="in">           vars = best_inner_vars)</span></span>
<span id="cb194-3943"><a href="#cb194-3943" aria-hidden="true" tabindex="-1"></a><span class="in">      </span></span>
<span id="cb194-3944"><a href="#cb194-3944" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb194-3945"><a href="#cb194-3945" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-3946"><a href="#cb194-3946" aria-hidden="true" tabindex="-1"></a><span class="in">    best_result &lt;- stepAUC(variables, outer_train_data, target_name, grid, inner_folds)</span></span>
<span id="cb194-3947"><a href="#cb194-3947" aria-hidden="true" tabindex="-1"></a><span class="in">    best_model &lt;- best_result$model</span></span>
<span id="cb194-3948"><a href="#cb194-3948" aria-hidden="true" tabindex="-1"></a><span class="in">    best_auc &lt;- best_result$auc</span></span>
<span id="cb194-3949"><a href="#cb194-3949" aria-hidden="true" tabindex="-1"></a><span class="in">    best_kernel &lt;- best_result$kernel</span></span>
<span id="cb194-3950"><a href="#cb194-3950" aria-hidden="true" tabindex="-1"></a><span class="in">    best_cost &lt;- best_result$cost</span></span>
<span id="cb194-3951"><a href="#cb194-3951" aria-hidden="true" tabindex="-1"></a><span class="in">    best_vars &lt;- best_result$vars</span></span>
<span id="cb194-3952"><a href="#cb194-3952" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-3953"><a href="#cb194-3953" aria-hidden="true" tabindex="-1"></a><span class="in">    # Evaluar el mejor modelo en el validation split del inner loop </span></span>
<span id="cb194-3954"><a href="#cb194-3954" aria-hidden="true" tabindex="-1"></a><span class="in">    inner_auc_vals &lt;- numeric()</span></span>
<span id="cb194-3955"><a href="#cb194-3955" aria-hidden="true" tabindex="-1"></a><span class="in">    for (inner_index in seq_along(inner_folds)) {</span></span>
<span id="cb194-3956"><a href="#cb194-3956" aria-hidden="true" tabindex="-1"></a><span class="in">      inner_train_data &lt;- outer_train_data[-inner_folds[[inner_index]], ]</span></span>
<span id="cb194-3957"><a href="#cb194-3957" aria-hidden="true" tabindex="-1"></a><span class="in">      inner_test_data &lt;- outer_train_data[inner_folds[[inner_index]], ]</span></span>
<span id="cb194-3958"><a href="#cb194-3958" aria-hidden="true" tabindex="-1"></a><span class="in">      </span></span>
<span id="cb194-3959"><a href="#cb194-3959" aria-hidden="true" tabindex="-1"></a><span class="in">      predictions &lt;- predict(best_model, newdata = inner_test_data, probability = TRUE)</span></span>
<span id="cb194-3960"><a href="#cb194-3960" aria-hidden="true" tabindex="-1"></a><span class="in">      predictions &lt;- attr(predictions, "probabilities")[, 2]</span></span>
<span id="cb194-3961"><a href="#cb194-3961" aria-hidden="true" tabindex="-1"></a><span class="in">      roc_curve &lt;- roc(inner_test_data[[target_name]], predictions)</span></span>
<span id="cb194-3962"><a href="#cb194-3962" aria-hidden="true" tabindex="-1"></a><span class="in">      inner_auc_vals[inner_index] &lt;- roc_curve$auc</span></span>
<span id="cb194-3963"><a href="#cb194-3963" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-3964"><a href="#cb194-3964" aria-hidden="true" tabindex="-1"></a><span class="in">      pred_class &lt;- ifelse(predictions &gt; threshold, 1, 0)</span></span>
<span id="cb194-3965"><a href="#cb194-3965" aria-hidden="true" tabindex="-1"></a><span class="in">      confusion &lt;- table(Actual = inner_test_data[[target_name]], Predicted = pred_class)</span></span>
<span id="cb194-3966"><a href="#cb194-3966" aria-hidden="true" tabindex="-1"></a><span class="in">      TP &lt;- ifelse(nrow(confusion) &gt;= 2 &amp;&amp; ncol(confusion) &gt;= 2, confusion[2, 2], 0)</span></span>
<span id="cb194-3967"><a href="#cb194-3967" aria-hidden="true" tabindex="-1"></a><span class="in">      TN &lt;- ifelse(nrow(confusion) &gt;= 1 &amp;&amp; ncol(confusion) &gt;= 1, confusion[1, 1], 0)</span></span>
<span id="cb194-3968"><a href="#cb194-3968" aria-hidden="true" tabindex="-1"></a><span class="in">      FP &lt;- ifelse(nrow(confusion) &gt;= 1 &amp;&amp; ncol(confusion) &gt;= 2, confusion[1, 2], 0)</span></span>
<span id="cb194-3969"><a href="#cb194-3969" aria-hidden="true" tabindex="-1"></a><span class="in">      FN &lt;- ifelse(nrow(confusion) &gt;= 2 &amp;&amp; ncol(confusion) &gt;= 1, confusion[2, 1], 0)</span></span>
<span id="cb194-3970"><a href="#cb194-3970" aria-hidden="true" tabindex="-1"></a><span class="in">      auc &lt;- roc_curve$auc</span></span>
<span id="cb194-3971"><a href="#cb194-3971" aria-hidden="true" tabindex="-1"></a><span class="in">      </span></span>
<span id="cb194-3972"><a href="#cb194-3972" aria-hidden="true" tabindex="-1"></a><span class="in">      inner_metrics &lt;- setNames(c(outer_index, inner_index, TP, TN, FP, FN, auc), names(inner_fold_metrics))</span></span>
<span id="cb194-3973"><a href="#cb194-3973" aria-hidden="true" tabindex="-1"></a><span class="in">      inner_fold_metrics &lt;- rbind(inner_fold_metrics, as.data.frame(t(inner_metrics)))</span></span>
<span id="cb194-3974"><a href="#cb194-3974" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb194-3975"><a href="#cb194-3975" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-3976"><a href="#cb194-3976" aria-hidden="true" tabindex="-1"></a><span class="in">    best_inner_auc &lt;- mean(inner_auc_vals, na.rm = TRUE)</span></span>
<span id="cb194-3977"><a href="#cb194-3977" aria-hidden="true" tabindex="-1"></a><span class="in">    # Reentrenar el mejor modelo con todos los datos de outer_train_data</span></span>
<span id="cb194-3978"><a href="#cb194-3978" aria-hidden="true" tabindex="-1"></a><span class="in">    best_model &lt;- svm(as.formula(paste(target_name, "~", paste(best_vars, collapse = "+"))),</span></span>
<span id="cb194-3979"><a href="#cb194-3979" aria-hidden="true" tabindex="-1"></a><span class="in">                      data = outer_train_data, kernel = best_kernel, cost = best_cost, </span></span>
<span id="cb194-3980"><a href="#cb194-3980" aria-hidden="true" tabindex="-1"></a><span class="in">                      probability = TRUE)</span></span>
<span id="cb194-3981"><a href="#cb194-3981" aria-hidden="true" tabindex="-1"></a><span class="in">    predictions &lt;- predict(best_model, newdata = outer_test_data, probability = TRUE)</span></span>
<span id="cb194-3982"><a href="#cb194-3982" aria-hidden="true" tabindex="-1"></a><span class="in">    predictions &lt;- attr(predictions, "probabilities")[, 2]</span></span>
<span id="cb194-3983"><a href="#cb194-3983" aria-hidden="true" tabindex="-1"></a><span class="in">    pred_class &lt;- ifelse(predictions &gt; threshold, 1, 0)  # Asignar clases basadas en umbral</span></span>
<span id="cb194-3984"><a href="#cb194-3984" aria-hidden="true" tabindex="-1"></a><span class="in">    confusion &lt;- table(Actual = outer_test_data[[target_name]], Predicted = pred_class)</span></span>
<span id="cb194-3985"><a href="#cb194-3985" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-3986"><a href="#cb194-3986" aria-hidden="true" tabindex="-1"></a><span class="in">    if (nrow(confusion) &lt; 2 || ncol(confusion) &lt; 2) {</span></span>
<span id="cb194-3987"><a href="#cb194-3987" aria-hidden="true" tabindex="-1"></a><span class="in">      TP &lt;- ifelse(nrow(confusion) &gt;= 2 &amp;&amp; ncol(confusion) &gt;= 2, confusion[2, 2], 0)</span></span>
<span id="cb194-3988"><a href="#cb194-3988" aria-hidden="true" tabindex="-1"></a><span class="in">      TN &lt;- ifelse(nrow(confusion) &gt;= 1 &amp;&amp; ncol(confusion) &gt;= 1, confusion[1, 1], 0)</span></span>
<span id="cb194-3989"><a href="#cb194-3989" aria-hidden="true" tabindex="-1"></a><span class="in">      FP &lt;- ifelse(nrow(confusion) &gt;= 1 &amp;&amp; ncol(confusion) &gt;= 2, confusion[1, 2], 0)</span></span>
<span id="cb194-3990"><a href="#cb194-3990" aria-hidden="true" tabindex="-1"></a><span class="in">      FN &lt;- ifelse(nrow(confusion) &gt;= 2 &amp;&amp; ncol(confusion) &gt;= 1, confusion[2, 1], 0)</span></span>
<span id="cb194-3991"><a href="#cb194-3991" aria-hidden="true" tabindex="-1"></a><span class="in">    } else {</span></span>
<span id="cb194-3992"><a href="#cb194-3992" aria-hidden="true" tabindex="-1"></a><span class="in">      TP &lt;- confusion[2, 2]</span></span>
<span id="cb194-3993"><a href="#cb194-3993" aria-hidden="true" tabindex="-1"></a><span class="in">      TN &lt;- confusion[1, 1]</span></span>
<span id="cb194-3994"><a href="#cb194-3994" aria-hidden="true" tabindex="-1"></a><span class="in">      FP &lt;- confusion[1, 2]</span></span>
<span id="cb194-3995"><a href="#cb194-3995" aria-hidden="true" tabindex="-1"></a><span class="in">      FN &lt;- confusion[2, 1]</span></span>
<span id="cb194-3996"><a href="#cb194-3996" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb194-3997"><a href="#cb194-3997" aria-hidden="true" tabindex="-1"></a><span class="in">    auc &lt;- roc(outer_test_data[[target_name]], predictions)$auc</span></span>
<span id="cb194-3998"><a href="#cb194-3998" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-3999"><a href="#cb194-3999" aria-hidden="true" tabindex="-1"></a><span class="in">    metrics &lt;- setNames(c(outer_index, TP, TN, FP, FN, auc, </span></span>
<span id="cb194-4000"><a href="#cb194-4000" aria-hidden="true" tabindex="-1"></a><span class="in">                          best_kernel, best_cost, paste(best_vars, collapse = ",")), </span></span>
<span id="cb194-4001"><a href="#cb194-4001" aria-hidden="true" tabindex="-1"></a><span class="in">                        names(performance_metrics))</span></span>
<span id="cb194-4002"><a href="#cb194-4002" aria-hidden="true" tabindex="-1"></a><span class="in">    performance_metrics &lt;- rbind(performance_metrics, as.data.frame(t(metrics)))</span></span>
<span id="cb194-4003"><a href="#cb194-4003" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-4004"><a href="#cb194-4004" aria-hidden="true" tabindex="-1"></a><span class="in">    cat("Performance:", paste(performance_metrics))</span></span>
<span id="cb194-4005"><a href="#cb194-4005" aria-hidden="true" tabindex="-1"></a><span class="in">    cat(sprintf("Confusion Matrix for Fold %d:\n", outer_index))</span></span>
<span id="cb194-4006"><a href="#cb194-4006" aria-hidden="true" tabindex="-1"></a><span class="in">    print(confusion)</span></span>
<span id="cb194-4007"><a href="#cb194-4007" aria-hidden="true" tabindex="-1"></a><span class="in">    cat(sprintf("Metrics for Fold %d:\n", outer_index))</span></span>
<span id="cb194-4008"><a href="#cb194-4008" aria-hidden="true" tabindex="-1"></a><span class="in">    cat(sprintf("TP: %d, TN: %d, FP: %d, FN: %d, AUC: %f, Best Kernel: %s, Best Cost: %f, Best Variables: %s\n",</span></span>
<span id="cb194-4009"><a href="#cb194-4009" aria-hidden="true" tabindex="-1"></a><span class="in">                TP, TN, FP, FN, auc, best_kernel, best_cost, paste(best_vars, collapse = ",")))</span></span>
<span id="cb194-4010"><a href="#cb194-4010" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb194-4011"><a href="#cb194-4011" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb194-4012"><a href="#cb194-4012" aria-hidden="true" tabindex="-1"></a><span class="in">  list(performance_metrics = performance_metrics, inner_fold_metrics = inner_fold_metrics)</span></span>
<span id="cb194-4013"><a href="#cb194-4013" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb194-4014"><a href="#cb194-4014" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-4015"><a href="#cb194-4015" aria-hidden="true" tabindex="-1"></a><span class="in">evaluate_with_seeds_SVM_stepAUC &lt;- </span></span>
<span id="cb194-4016"><a href="#cb194-4016" aria-hidden="true" tabindex="-1"></a><span class="in">  function(evaluation_function, data, target_var, vars, threshold, seeds, outer, inner, kernels, costs) {</span></span>
<span id="cb194-4017"><a href="#cb194-4017" aria-hidden="true" tabindex="-1"></a><span class="in">  results_list &lt;- list()</span></span>
<span id="cb194-4018"><a href="#cb194-4018" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-4019"><a href="#cb194-4019" aria-hidden="true" tabindex="-1"></a><span class="in">  for (seed in seeds) {</span></span>
<span id="cb194-4020"><a href="#cb194-4020" aria-hidden="true" tabindex="-1"></a><span class="in">    set.seed(seed)</span></span>
<span id="cb194-4021"><a href="#cb194-4021" aria-hidden="true" tabindex="-1"></a><span class="in">    cat("Evaluating with seed:", seed, "\n")</span></span>
<span id="cb194-4022"><a href="#cb194-4022" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-4023"><a href="#cb194-4023" aria-hidden="true" tabindex="-1"></a><span class="in">    results &lt;- evaluation_function(data = data, </span></span>
<span id="cb194-4024"><a href="#cb194-4024" aria-hidden="true" tabindex="-1"></a><span class="in">                                   target_name = target_var, </span></span>
<span id="cb194-4025"><a href="#cb194-4025" aria-hidden="true" tabindex="-1"></a><span class="in">                                   variables = vars, </span></span>
<span id="cb194-4026"><a href="#cb194-4026" aria-hidden="true" tabindex="-1"></a><span class="in">                                   threshold = threshold, </span></span>
<span id="cb194-4027"><a href="#cb194-4027" aria-hidden="true" tabindex="-1"></a><span class="in">                                   outer = outer, </span></span>
<span id="cb194-4028"><a href="#cb194-4028" aria-hidden="true" tabindex="-1"></a><span class="in">                                   inner = inner, </span></span>
<span id="cb194-4029"><a href="#cb194-4029" aria-hidden="true" tabindex="-1"></a><span class="in">                                   seed = seed,</span></span>
<span id="cb194-4030"><a href="#cb194-4030" aria-hidden="true" tabindex="-1"></a><span class="in">                                   kernels = kernels,</span></span>
<span id="cb194-4031"><a href="#cb194-4031" aria-hidden="true" tabindex="-1"></a><span class="in">                                   costs = costs)</span></span>
<span id="cb194-4032"><a href="#cb194-4032" aria-hidden="true" tabindex="-1"></a><span class="in">    results_list[[paste0("seed_", seed)]] &lt;- results</span></span>
<span id="cb194-4033"><a href="#cb194-4033" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb194-4034"><a href="#cb194-4034" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-4035"><a href="#cb194-4035" aria-hidden="true" tabindex="-1"></a><span class="in">  return(results_list)</span></span>
<span id="cb194-4036"><a href="#cb194-4036" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb194-4037"><a href="#cb194-4037" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-4038"><a href="#cb194-4038" aria-hidden="true" tabindex="-1"></a><span class="in">performance_SVM_stepauc &lt;- evaluate_with_seeds_SVM_stepAUC(</span></span>
<span id="cb194-4039"><a href="#cb194-4039" aria-hidden="true" tabindex="-1"></a><span class="in">  evaluation_function = double_cross_validation_svm_stepAUC,</span></span>
<span id="cb194-4040"><a href="#cb194-4040" aria-hidden="true" tabindex="-1"></a><span class="in">  data = data_numeric,</span></span>
<span id="cb194-4041"><a href="#cb194-4041" aria-hidden="true" tabindex="-1"></a><span class="in">  outer = 5,</span></span>
<span id="cb194-4042"><a href="#cb194-4042" aria-hidden="true" tabindex="-1"></a><span class="in">  inner = 2,</span></span>
<span id="cb194-4043"><a href="#cb194-4043" aria-hidden="true" tabindex="-1"></a><span class="in">  target_var = "PCR",</span></span>
<span id="cb194-4044"><a href="#cb194-4044" aria-hidden="true" tabindex="-1"></a><span class="in">  kernels = c("linear", "poly"),</span></span>
<span id="cb194-4045"><a href="#cb194-4045" aria-hidden="true" tabindex="-1"></a><span class="in">  costs = c(50, 100, 200),</span></span>
<span id="cb194-4046"><a href="#cb194-4046" aria-hidden="true" tabindex="-1"></a><span class="in">  vars = todas_variables_numeric,</span></span>
<span id="cb194-4047"><a href="#cb194-4047" aria-hidden="true" tabindex="-1"></a><span class="in">  threshold = .35,</span></span>
<span id="cb194-4048"><a href="#cb194-4048" aria-hidden="true" tabindex="-1"></a><span class="in">  seeds = seeds</span></span>
<span id="cb194-4049"><a href="#cb194-4049" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb194-4050"><a href="#cb194-4050" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-4051"><a href="#cb194-4051" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-4052"><a href="#cb194-4052" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message=FALSE, warning=FALSE}</span></span>
<span id="cb194-4053"><a href="#cb194-4053" aria-hidden="true" tabindex="-1"></a><span class="in">load("RData_Files_Algorithms/SVM_StepAUC.RData")</span></span>
<span id="cb194-4054"><a href="#cb194-4054" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-4055"><a href="#cb194-4055" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-4056"><a href="#cb194-4056" aria-hidden="true" tabindex="-1"></a><span class="fu">### Embedded (Lasso)</span></span>
<span id="cb194-4057"><a href="#cb194-4057" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-4058"><a href="#cb194-4058" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=FALSE}</span></span>
<span id="cb194-4059"><a href="#cb194-4059" aria-hidden="true" tabindex="-1"></a><span class="in">double_cross_validation_svm_lasso &lt;- function(data, target_name, outer, inner, kernels, costs, variables, threshold, seed) {</span></span>
<span id="cb194-4060"><a href="#cb194-4060" aria-hidden="true" tabindex="-1"></a><span class="in">  set.seed(seed)</span></span>
<span id="cb194-4061"><a href="#cb194-4061" aria-hidden="true" tabindex="-1"></a><span class="in">  performance_metrics &lt;- data.frame(Fold = integer(), TP = integer(), TN = integer(),</span></span>
<span id="cb194-4062"><a href="#cb194-4062" aria-hidden="true" tabindex="-1"></a><span class="in">                                    FP = integer(), FN = integer(), AUC = numeric(),</span></span>
<span id="cb194-4063"><a href="#cb194-4063" aria-hidden="true" tabindex="-1"></a><span class="in">                                    Best_Kernel = character(), Best_Cost = numeric(),</span></span>
<span id="cb194-4064"><a href="#cb194-4064" aria-hidden="true" tabindex="-1"></a><span class="in">                                    Best_Variables = character(), stringsAsFactors = FALSE)</span></span>
<span id="cb194-4065"><a href="#cb194-4065" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb194-4066"><a href="#cb194-4066" aria-hidden="true" tabindex="-1"></a><span class="in">  inner_fold_metrics &lt;- data.frame(Fold = integer(), Inner_Fold = integer(), </span></span>
<span id="cb194-4067"><a href="#cb194-4067" aria-hidden="true" tabindex="-1"></a><span class="in">                                   TP = integer(), TN = integer(), FP = integer(), </span></span>
<span id="cb194-4068"><a href="#cb194-4068" aria-hidden="true" tabindex="-1"></a><span class="in">                                   FN = integer(), AUC = numeric(), stringsAsFactors = FALSE)</span></span>
<span id="cb194-4069"><a href="#cb194-4069" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb194-4070"><a href="#cb194-4070" aria-hidden="true" tabindex="-1"></a><span class="in">  # Convertir las variables del dataset con model.matrix</span></span>
<span id="cb194-4071"><a href="#cb194-4071" aria-hidden="true" tabindex="-1"></a><span class="in">  target &lt;- as.factor(data[[target_name]])  # Aseguramos que la variable de respuesta sea factor</span></span>
<span id="cb194-4072"><a href="#cb194-4072" aria-hidden="true" tabindex="-1"></a><span class="in">  features &lt;- data[, setdiff(names(data), target_name)]</span></span>
<span id="cb194-4073"><a href="#cb194-4073" aria-hidden="true" tabindex="-1"></a><span class="in">  data_matrix &lt;- as.data.frame(model.matrix(~ ., data=features)[,-1])  # Eliminar el intercepto</span></span>
<span id="cb194-4074"><a href="#cb194-4074" aria-hidden="true" tabindex="-1"></a><span class="in">  data_matrix[[target_name]] &lt;- target</span></span>
<span id="cb194-4075"><a href="#cb194-4075" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb194-4076"><a href="#cb194-4076" aria-hidden="true" tabindex="-1"></a><span class="in">  outer_folds &lt;- createFolds(data_matrix[[target_name]], k = outer)</span></span>
<span id="cb194-4077"><a href="#cb194-4077" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb194-4078"><a href="#cb194-4078" aria-hidden="true" tabindex="-1"></a><span class="in">  for (outer_index in seq_along(outer_folds)) {</span></span>
<span id="cb194-4079"><a href="#cb194-4079" aria-hidden="true" tabindex="-1"></a><span class="in">    outer_train_data &lt;- data_matrix[-outer_folds[[outer_index]], ]</span></span>
<span id="cb194-4080"><a href="#cb194-4080" aria-hidden="true" tabindex="-1"></a><span class="in">    outer_test_data &lt;- data_matrix[outer_folds[[outer_index]], ]</span></span>
<span id="cb194-4081"><a href="#cb194-4081" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-4082"><a href="#cb194-4082" aria-hidden="true" tabindex="-1"></a><span class="in">    cat(sprintf("Outer Fold %d\n", outer_index))</span></span>
<span id="cb194-4083"><a href="#cb194-4083" aria-hidden="true" tabindex="-1"></a><span class="in">    cat("Training Data - Class 0: ", sum(outer_train_data[[target_name]] == 0), "\n")</span></span>
<span id="cb194-4084"><a href="#cb194-4084" aria-hidden="true" tabindex="-1"></a><span class="in">    cat("Training Data - Class 1: ", sum(outer_train_data[[target_name]] == 1), "\n")</span></span>
<span id="cb194-4085"><a href="#cb194-4085" aria-hidden="true" tabindex="-1"></a><span class="in">    cat("Testing Data - Class 0: ", sum(outer_test_data[[target_name]] == 0), "\n")</span></span>
<span id="cb194-4086"><a href="#cb194-4086" aria-hidden="true" tabindex="-1"></a><span class="in">    cat("Testing Data - Class 1: ", sum(outer_test_data[[target_name]] == 1), "\n")</span></span>
<span id="cb194-4087"><a href="#cb194-4087" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-4088"><a href="#cb194-4088" aria-hidden="true" tabindex="-1"></a><span class="in">    inner_folds &lt;- createFolds(outer_train_data[[target_name]], k = inner)</span></span>
<span id="cb194-4089"><a href="#cb194-4089" aria-hidden="true" tabindex="-1"></a><span class="in">    best_model &lt;- NULL</span></span>
<span id="cb194-4090"><a href="#cb194-4090" aria-hidden="true" tabindex="-1"></a><span class="in">    best_auc &lt;- 0</span></span>
<span id="cb194-4091"><a href="#cb194-4091" aria-hidden="true" tabindex="-1"></a><span class="in">    best_kernel &lt;- NULL</span></span>
<span id="cb194-4092"><a href="#cb194-4092" aria-hidden="true" tabindex="-1"></a><span class="in">    best_cost &lt;- NULL</span></span>
<span id="cb194-4093"><a href="#cb194-4093" aria-hidden="true" tabindex="-1"></a><span class="in">    best_vars &lt;- colnames(outer_train_data)[!colnames(outer_train_data) %in% target_name]</span></span>
<span id="cb194-4094"><a href="#cb194-4094" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-4095"><a href="#cb194-4095" aria-hidden="true" tabindex="-1"></a><span class="in">    grid &lt;- expand.grid(kernel = kernels, cost = costs)</span></span>
<span id="cb194-4096"><a href="#cb194-4096" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-4097"><a href="#cb194-4097" aria-hidden="true" tabindex="-1"></a><span class="in">    select_vars_lasso &lt;- function(data, target_name) {</span></span>
<span id="cb194-4098"><a href="#cb194-4098" aria-hidden="true" tabindex="-1"></a><span class="in">      target &lt;- as.numeric(data[[target_name]]) - 1  # Convertimos a numérico para Lasso</span></span>
<span id="cb194-4099"><a href="#cb194-4099" aria-hidden="true" tabindex="-1"></a><span class="in">      features &lt;- data[, setdiff(names(data), target_name)]</span></span>
<span id="cb194-4100"><a href="#cb194-4100" aria-hidden="true" tabindex="-1"></a><span class="in">      X &lt;- model.matrix(~ ., data=features)[,-1]  # Eliminamos el intercepto</span></span>
<span id="cb194-4101"><a href="#cb194-4101" aria-hidden="true" tabindex="-1"></a><span class="in">      y &lt;- target</span></span>
<span id="cb194-4102"><a href="#cb194-4102" aria-hidden="true" tabindex="-1"></a><span class="in">      </span></span>
<span id="cb194-4103"><a href="#cb194-4103" aria-hidden="true" tabindex="-1"></a><span class="in">      # Ajustamos el modelo Lasso</span></span>
<span id="cb194-4104"><a href="#cb194-4104" aria-hidden="true" tabindex="-1"></a><span class="in">      lasso_model &lt;- cv.glmnet(X, y, alpha=1)</span></span>
<span id="cb194-4105"><a href="#cb194-4105" aria-hidden="true" tabindex="-1"></a><span class="in">      lasso_coef &lt;- coef(lasso_model, s = "lambda.min")</span></span>
<span id="cb194-4106"><a href="#cb194-4106" aria-hidden="true" tabindex="-1"></a><span class="in">      </span></span>
<span id="cb194-4107"><a href="#cb194-4107" aria-hidden="true" tabindex="-1"></a><span class="in">      # Seleccionamos las variables no nulas</span></span>
<span id="cb194-4108"><a href="#cb194-4108" aria-hidden="true" tabindex="-1"></a><span class="in">      selected_vars &lt;- rownames(lasso_coef)[lasso_coef[, 1] != 0]</span></span>
<span id="cb194-4109"><a href="#cb194-4109" aria-hidden="true" tabindex="-1"></a><span class="in">      selected_vars &lt;- setdiff(selected_vars, "(Intercept)")</span></span>
<span id="cb194-4110"><a href="#cb194-4110" aria-hidden="true" tabindex="-1"></a><span class="in">      cat("Selected variables by Lasso: ", paste(selected_vars, collapse=", "), "\n")</span></span>
<span id="cb194-4111"><a href="#cb194-4111" aria-hidden="true" tabindex="-1"></a><span class="in">      return(selected_vars)</span></span>
<span id="cb194-4112"><a href="#cb194-4112" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb194-4113"><a href="#cb194-4113" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-4114"><a href="#cb194-4114" aria-hidden="true" tabindex="-1"></a><span class="in">    stepAUC &lt;- function(vars, data, target_name, grid, inner_folds) {</span></span>
<span id="cb194-4115"><a href="#cb194-4115" aria-hidden="true" tabindex="-1"></a><span class="in">      best_inner_auc &lt;- 0</span></span>
<span id="cb194-4116"><a href="#cb194-4116" aria-hidden="true" tabindex="-1"></a><span class="in">      best_inner_model &lt;- NULL</span></span>
<span id="cb194-4117"><a href="#cb194-4117" aria-hidden="true" tabindex="-1"></a><span class="in">      best_inner_kernel &lt;- NULL</span></span>
<span id="cb194-4118"><a href="#cb194-4118" aria-hidden="true" tabindex="-1"></a><span class="in">      best_inner_cost &lt;- NULL</span></span>
<span id="cb194-4119"><a href="#cb194-4119" aria-hidden="true" tabindex="-1"></a><span class="in">      best_inner_vars &lt;- vars</span></span>
<span id="cb194-4120"><a href="#cb194-4120" aria-hidden="true" tabindex="-1"></a><span class="in">      improved &lt;- TRUE</span></span>
<span id="cb194-4121"><a href="#cb194-4121" aria-hidden="true" tabindex="-1"></a><span class="in">      </span></span>
<span id="cb194-4122"><a href="#cb194-4122" aria-hidden="true" tabindex="-1"></a><span class="in">      while (improved &amp;&amp; length(vars) &gt; 1) {</span></span>
<span id="cb194-4123"><a href="#cb194-4123" aria-hidden="true" tabindex="-1"></a><span class="in">        improved &lt;- FALSE</span></span>
<span id="cb194-4124"><a href="#cb194-4124" aria-hidden="true" tabindex="-1"></a><span class="in">        best_auc_in_step &lt;- best_inner_auc</span></span>
<span id="cb194-4125"><a href="#cb194-4125" aria-hidden="true" tabindex="-1"></a><span class="in">        </span></span>
<span id="cb194-4126"><a href="#cb194-4126" aria-hidden="true" tabindex="-1"></a><span class="in">        for (params in 1:nrow(grid)) {</span></span>
<span id="cb194-4127"><a href="#cb194-4127" aria-hidden="true" tabindex="-1"></a><span class="in">          auc_vals &lt;- numeric()</span></span>
<span id="cb194-4128"><a href="#cb194-4128" aria-hidden="true" tabindex="-1"></a><span class="in">          </span></span>
<span id="cb194-4129"><a href="#cb194-4129" aria-hidden="true" tabindex="-1"></a><span class="in">          for (inner_index in seq_along(inner_folds)) {</span></span>
<span id="cb194-4130"><a href="#cb194-4130" aria-hidden="true" tabindex="-1"></a><span class="in">            inner_train_data &lt;- outer_train_data[-inner_folds[[inner_index]], ]</span></span>
<span id="cb194-4131"><a href="#cb194-4131" aria-hidden="true" tabindex="-1"></a><span class="in">            inner_test_data &lt;- outer_train_data[inner_folds[[inner_index]], ]</span></span>
<span id="cb194-4132"><a href="#cb194-4132" aria-hidden="true" tabindex="-1"></a><span class="in">            </span></span>
<span id="cb194-4133"><a href="#cb194-4133" aria-hidden="true" tabindex="-1"></a><span class="in">            selected_vars &lt;- select_vars_lasso(inner_train_data, target_name)</span></span>
<span id="cb194-4134"><a href="#cb194-4134" aria-hidden="true" tabindex="-1"></a><span class="in">            formula &lt;- as.formula(paste(target_name, "~", paste(selected_vars, collapse = "+")))</span></span>
<span id="cb194-4135"><a href="#cb194-4135" aria-hidden="true" tabindex="-1"></a><span class="in">            cat("Testing with formula: ", deparse(formula), "\n")</span></span>
<span id="cb194-4136"><a href="#cb194-4136" aria-hidden="true" tabindex="-1"></a><span class="in">            cat("Grid parameters - kernel: ", grid$kernel[params], ", cost: ", grid$cost[params], "\n")</span></span>
<span id="cb194-4137"><a href="#cb194-4137" aria-hidden="true" tabindex="-1"></a><span class="in">            </span></span>
<span id="cb194-4138"><a href="#cb194-4138" aria-hidden="true" tabindex="-1"></a><span class="in">            result &lt;- tryCatch({</span></span>
<span id="cb194-4139"><a href="#cb194-4139" aria-hidden="true" tabindex="-1"></a><span class="in">              model &lt;- svm(formula, data = inner_train_data, kernel = grid$kernel[params], cost = grid$cost[params], probability = TRUE)</span></span>
<span id="cb194-4140"><a href="#cb194-4140" aria-hidden="true" tabindex="-1"></a><span class="in">              </span></span>
<span id="cb194-4141"><a href="#cb194-4141" aria-hidden="true" tabindex="-1"></a><span class="in">              predictions &lt;- predict(model, inner_test_data, probability = TRUE)</span></span>
<span id="cb194-4142"><a href="#cb194-4142" aria-hidden="true" tabindex="-1"></a><span class="in">              predictions_prob &lt;- attr(predictions, "probabilities")[, 2]</span></span>
<span id="cb194-4143"><a href="#cb194-4143" aria-hidden="true" tabindex="-1"></a><span class="in">              roc_curve &lt;- roc(inner_test_data[[target_name]], predictions_prob)</span></span>
<span id="cb194-4144"><a href="#cb194-4144" aria-hidden="true" tabindex="-1"></a><span class="in">              auc_vals[inner_index] &lt;- roc_curve$auc</span></span>
<span id="cb194-4145"><a href="#cb194-4145" aria-hidden="true" tabindex="-1"></a><span class="in">              cat("AUC for inner fold ", inner_index, ": ", roc_curve$auc, "\n")</span></span>
<span id="cb194-4146"><a href="#cb194-4146" aria-hidden="true" tabindex="-1"></a><span class="in">              </span></span>
<span id="cb194-4147"><a href="#cb194-4147" aria-hidden="true" tabindex="-1"></a><span class="in">            }, error = function(e) {</span></span>
<span id="cb194-4148"><a href="#cb194-4148" aria-hidden="true" tabindex="-1"></a><span class="in">              cat("Error with variables: ", paste(selected_vars, collapse = ", "), "\n")</span></span>
<span id="cb194-4149"><a href="#cb194-4149" aria-hidden="true" tabindex="-1"></a><span class="in">              cat("Error message: ", e$message, "\n")</span></span>
<span id="cb194-4150"><a href="#cb194-4150" aria-hidden="true" tabindex="-1"></a><span class="in">              auc_vals[inner_index] &lt;- NA  # Set to NA or some other indicator of failure</span></span>
<span id="cb194-4151"><a href="#cb194-4151" aria-hidden="true" tabindex="-1"></a><span class="in">            })</span></span>
<span id="cb194-4152"><a href="#cb194-4152" aria-hidden="true" tabindex="-1"></a><span class="in">          }</span></span>
<span id="cb194-4153"><a href="#cb194-4153" aria-hidden="true" tabindex="-1"></a><span class="in">          </span></span>
<span id="cb194-4154"><a href="#cb194-4154" aria-hidden="true" tabindex="-1"></a><span class="in">          mean_auc &lt;- mean(auc_vals, na.rm = TRUE)</span></span>
<span id="cb194-4155"><a href="#cb194-4155" aria-hidden="true" tabindex="-1"></a><span class="in">          cat("Mean AUC for params - kernel: ", grid$kernel[params], ", cost: ", grid$cost[params], ": ", mean_auc, "\n")</span></span>
<span id="cb194-4156"><a href="#cb194-4156" aria-hidden="true" tabindex="-1"></a><span class="in">          if (!is.na(mean_auc) &amp;&amp; mean_auc &gt; best_auc_in_step) {</span></span>
<span id="cb194-4157"><a href="#cb194-4157" aria-hidden="true" tabindex="-1"></a><span class="in">            best_auc_in_step &lt;- mean_auc</span></span>
<span id="cb194-4158"><a href="#cb194-4158" aria-hidden="true" tabindex="-1"></a><span class="in">            best_inner_model &lt;- model</span></span>
<span id="cb194-4159"><a href="#cb194-4159" aria-hidden="true" tabindex="-1"></a><span class="in">            best_inner_kernel &lt;- grid$kernel[params]</span></span>
<span id="cb194-4160"><a href="#cb194-4160" aria-hidden="true" tabindex="-1"></a><span class="in">            best_inner_cost &lt;- grid$cost[params]</span></span>
<span id="cb194-4161"><a href="#cb194-4161" aria-hidden="true" tabindex="-1"></a><span class="in">            best_inner_vars &lt;- selected_vars</span></span>
<span id="cb194-4162"><a href="#cb194-4162" aria-hidden="true" tabindex="-1"></a><span class="in">            improved &lt;- TRUE</span></span>
<span id="cb194-4163"><a href="#cb194-4163" aria-hidden="true" tabindex="-1"></a><span class="in">          }</span></span>
<span id="cb194-4164"><a href="#cb194-4164" aria-hidden="true" tabindex="-1"></a><span class="in">        }</span></span>
<span id="cb194-4165"><a href="#cb194-4165" aria-hidden="true" tabindex="-1"></a><span class="in">        </span></span>
<span id="cb194-4166"><a href="#cb194-4166" aria-hidden="true" tabindex="-1"></a><span class="in">        if (improved) {</span></span>
<span id="cb194-4167"><a href="#cb194-4167" aria-hidden="true" tabindex="-1"></a><span class="in">          vars &lt;- best_inner_vars</span></span>
<span id="cb194-4168"><a href="#cb194-4168" aria-hidden="true" tabindex="-1"></a><span class="in">          best_inner_auc &lt;- best_auc_in_step</span></span>
<span id="cb194-4169"><a href="#cb194-4169" aria-hidden="true" tabindex="-1"></a><span class="in">          cat("Vars improved: ", paste(vars, collapse=", "), "\n")</span></span>
<span id="cb194-4170"><a href="#cb194-4170" aria-hidden="true" tabindex="-1"></a><span class="in">          cat("AUC: ", best_inner_auc, "\n")</span></span>
<span id="cb194-4171"><a href="#cb194-4171" aria-hidden="true" tabindex="-1"></a><span class="in">        }</span></span>
<span id="cb194-4172"><a href="#cb194-4172" aria-hidden="true" tabindex="-1"></a><span class="in">      }</span></span>
<span id="cb194-4173"><a href="#cb194-4173" aria-hidden="true" tabindex="-1"></a><span class="in">      </span></span>
<span id="cb194-4174"><a href="#cb194-4174" aria-hidden="true" tabindex="-1"></a><span class="in">      list(model = best_inner_model, auc = best_inner_auc, </span></span>
<span id="cb194-4175"><a href="#cb194-4175" aria-hidden="true" tabindex="-1"></a><span class="in">           kernel = best_inner_kernel, cost = best_inner_cost, </span></span>
<span id="cb194-4176"><a href="#cb194-4176" aria-hidden="true" tabindex="-1"></a><span class="in">           vars = best_inner_vars)</span></span>
<span id="cb194-4177"><a href="#cb194-4177" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb194-4178"><a href="#cb194-4178" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-4179"><a href="#cb194-4179" aria-hidden="true" tabindex="-1"></a><span class="in">    best_result &lt;- stepAUC(best_vars, outer_train_data, target_name, grid, inner_folds)</span></span>
<span id="cb194-4180"><a href="#cb194-4180" aria-hidden="true" tabindex="-1"></a><span class="in">    best_model &lt;- best_result$model</span></span>
<span id="cb194-4181"><a href="#cb194-4181" aria-hidden="true" tabindex="-1"></a><span class="in">    best_auc &lt;- best_result$auc</span></span>
<span id="cb194-4182"><a href="#cb194-4182" aria-hidden="true" tabindex="-1"></a><span class="in">    best_kernel &lt;- best_result$kernel</span></span>
<span id="cb194-4183"><a href="#cb194-4183" aria-hidden="true" tabindex="-1"></a><span class="in">    best_cost &lt;- best_result$cost</span></span>
<span id="cb194-4184"><a href="#cb194-4184" aria-hidden="true" tabindex="-1"></a><span class="in">    best_vars &lt;- best_result$vars</span></span>
<span id="cb194-4185"><a href="#cb194-4185" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-4186"><a href="#cb194-4186" aria-hidden="true" tabindex="-1"></a><span class="in">    if (is.null(best_model)) {</span></span>
<span id="cb194-4187"><a href="#cb194-4187" aria-hidden="true" tabindex="-1"></a><span class="in">      cat("Error: No valid model found for outer fold ", outer_index, "\n")</span></span>
<span id="cb194-4188"><a href="#cb194-4188" aria-hidden="true" tabindex="-1"></a><span class="in">      next</span></span>
<span id="cb194-4189"><a href="#cb194-4189" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb194-4190"><a href="#cb194-4190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-4191"><a href="#cb194-4191" aria-hidden="true" tabindex="-1"></a><span class="in">    # Evaluar el mejor modelo en el validation split del inner loop</span></span>
<span id="cb194-4192"><a href="#cb194-4192" aria-hidden="true" tabindex="-1"></a><span class="in">    inner_auc_vals &lt;- numeric()</span></span>
<span id="cb194-4193"><a href="#cb194-4193" aria-hidden="true" tabindex="-1"></a><span class="in">    for (inner_index in seq_along(inner_folds)) {</span></span>
<span id="cb194-4194"><a href="#cb194-4194" aria-hidden="true" tabindex="-1"></a><span class="in">      inner_train_data &lt;- outer_train_data[-inner_folds[[inner_index]], ]</span></span>
<span id="cb194-4195"><a href="#cb194-4195" aria-hidden="true" tabindex="-1"></a><span class="in">      inner_test_data &lt;- outer_train_data[inner_folds[[inner_index]], ]</span></span>
<span id="cb194-4196"><a href="#cb194-4196" aria-hidden="true" tabindex="-1"></a><span class="in">      </span></span>
<span id="cb194-4197"><a href="#cb194-4197" aria-hidden="true" tabindex="-1"></a><span class="in">      predictions &lt;- predict(best_model, inner_test_data, probability = TRUE)</span></span>
<span id="cb194-4198"><a href="#cb194-4198" aria-hidden="true" tabindex="-1"></a><span class="in">      predictions_prob &lt;- attr(predictions, "probabilities")[, 2]</span></span>
<span id="cb194-4199"><a href="#cb194-4199" aria-hidden="true" tabindex="-1"></a><span class="in">      roc_curve &lt;- roc(inner_test_data[[target_name]], predictions_prob)</span></span>
<span id="cb194-4200"><a href="#cb194-4200" aria-hidden="true" tabindex="-1"></a><span class="in">      inner_auc_vals[inner_index] &lt;- roc_curve$auc</span></span>
<span id="cb194-4201"><a href="#cb194-4201" aria-hidden="true" tabindex="-1"></a><span class="in">      cat("Inner fold ", inner_index, " AUC: ", roc_curve$auc, "\n")</span></span>
<span id="cb194-4202"><a href="#cb194-4202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-4203"><a href="#cb194-4203" aria-hidden="true" tabindex="-1"></a><span class="in">      pred_class &lt;- ifelse(predictions_prob &gt; threshold, "1", "0")</span></span>
<span id="cb194-4204"><a href="#cb194-4204" aria-hidden="true" tabindex="-1"></a><span class="in">      confusion &lt;- table(Actual = inner_test_data[[target_name]], Predicted = pred_class)</span></span>
<span id="cb194-4205"><a href="#cb194-4205" aria-hidden="true" tabindex="-1"></a><span class="in">      TP &lt;- ifelse(nrow(confusion) &gt;= 2 &amp;&amp; ncol(confusion) &gt;= 2, confusion[2, 2], 0)</span></span>
<span id="cb194-4206"><a href="#cb194-4206" aria-hidden="true" tabindex="-1"></a><span class="in">      TN &lt;- ifelse(nrow(confusion) &gt;= 1 &amp;&amp; ncol(confusion) &gt;= 1, confusion[1, 1], 0)</span></span>
<span id="cb194-4207"><a href="#cb194-4207" aria-hidden="true" tabindex="-1"></a><span class="in">      FP &lt;- ifelse(nrow(confusion) &gt;= 1 &amp;&amp; ncol(confusion) &gt;= 2, confusion[1, 2], 0)</span></span>
<span id="cb194-4208"><a href="#cb194-4208" aria-hidden="true" tabindex="-1"></a><span class="in">      FN &lt;- ifelse(nrow(confusion) &gt;= 2 &amp;&amp; ncol(confusion) &gt;= 1, confusion[2, 1], 0)</span></span>
<span id="cb194-4209"><a href="#cb194-4209" aria-hidden="true" tabindex="-1"></a><span class="in">      auc &lt;- roc_curve$auc</span></span>
<span id="cb194-4210"><a href="#cb194-4210" aria-hidden="true" tabindex="-1"></a><span class="in">      </span></span>
<span id="cb194-4211"><a href="#cb194-4211" aria-hidden="true" tabindex="-1"></a><span class="in">      inner_metrics &lt;- setNames(c(outer_index, inner_index, TP, TN, FP, FN, auc), names(inner_fold_metrics))</span></span>
<span id="cb194-4212"><a href="#cb194-4212" aria-hidden="true" tabindex="-1"></a><span class="in">      inner_fold_metrics &lt;- rbind(inner_fold_metrics, as.data.frame(t(inner_metrics)))</span></span>
<span id="cb194-4213"><a href="#cb194-4213" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb194-4214"><a href="#cb194-4214" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-4215"><a href="#cb194-4215" aria-hidden="true" tabindex="-1"></a><span class="in">    best_inner_auc &lt;- mean(inner_auc_vals, na.rm = TRUE)</span></span>
<span id="cb194-4216"><a href="#cb194-4216" aria-hidden="true" tabindex="-1"></a><span class="in">    cat("Best inner AUC: ", best_inner_auc, "\n")</span></span>
<span id="cb194-4217"><a href="#cb194-4217" aria-hidden="true" tabindex="-1"></a><span class="in">    best_model &lt;- svm(as.formula(paste(target_name, "~", paste(best_vars, collapse = "+"))),</span></span>
<span id="cb194-4218"><a href="#cb194-4218" aria-hidden="true" tabindex="-1"></a><span class="in">                      data = outer_train_data, kernel = best_kernel, cost = best_cost, </span></span>
<span id="cb194-4219"><a href="#cb194-4219" aria-hidden="true" tabindex="-1"></a><span class="in">                      probability = TRUE)</span></span>
<span id="cb194-4220"><a href="#cb194-4220" aria-hidden="true" tabindex="-1"></a><span class="in">    predictions &lt;- predict(best_model, outer_test_data, probability = TRUE)</span></span>
<span id="cb194-4221"><a href="#cb194-4221" aria-hidden="true" tabindex="-1"></a><span class="in">    predictions_prob &lt;- attr(predictions, "probabilities")[, 2]</span></span>
<span id="cb194-4222"><a href="#cb194-4222" aria-hidden="true" tabindex="-1"></a><span class="in">    pred_class &lt;- ifelse(predictions_prob &gt; threshold, "1", "0")  # Asignar clases basadas en umbral</span></span>
<span id="cb194-4223"><a href="#cb194-4223" aria-hidden="true" tabindex="-1"></a><span class="in">    confusion &lt;- table(Actual = outer_test_data[[target_name]], Predicted = pred_class)</span></span>
<span id="cb194-4224"><a href="#cb194-4224" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-4225"><a href="#cb194-4225" aria-hidden="true" tabindex="-1"></a><span class="in">    if (nrow(confusion) &lt; 2 || ncol(confusion) &lt; 2) {</span></span>
<span id="cb194-4226"><a href="#cb194-4226" aria-hidden="true" tabindex="-1"></a><span class="in">      TP &lt;- ifelse(nrow(confusion) &gt;= 2 &amp;&amp; ncol(confusion) &gt;= 2, confusion[2, 2], 0)</span></span>
<span id="cb194-4227"><a href="#cb194-4227" aria-hidden="true" tabindex="-1"></a><span class="in">      TN &lt;- ifelse(nrow(confusion) &gt;= 1 &amp;&amp; ncol(confusion) &gt;= 1, confusion[1, 1], 0)</span></span>
<span id="cb194-4228"><a href="#cb194-4228" aria-hidden="true" tabindex="-1"></a><span class="in">      FP &lt;- ifelse(nrow(confusion) &gt;= 1 &amp;&amp; ncol(confusion) &gt;= 2, confusion[1, 2], 0)</span></span>
<span id="cb194-4229"><a href="#cb194-4229" aria-hidden="true" tabindex="-1"></a><span class="in">      FN &lt;- ifelse(nrow(confusion) &gt;= 2 &amp;&amp; ncol(confusion) &gt;= 1, confusion[2, 1], 0)</span></span>
<span id="cb194-4230"><a href="#cb194-4230" aria-hidden="true" tabindex="-1"></a><span class="in">    } else {</span></span>
<span id="cb194-4231"><a href="#cb194-4231" aria-hidden="true" tabindex="-1"></a><span class="in">      TP &lt;- confusion[2, 2]</span></span>
<span id="cb194-4232"><a href="#cb194-4232" aria-hidden="true" tabindex="-1"></a><span class="in">      TN &lt;- confusion[1, 1]</span></span>
<span id="cb194-4233"><a href="#cb194-4233" aria-hidden="true" tabindex="-1"></a><span class="in">      FP &lt;- confusion[1, 2]</span></span>
<span id="cb194-4234"><a href="#cb194-4234" aria-hidden="true" tabindex="-1"></a><span class="in">      FN &lt;- confusion[2, 1]</span></span>
<span id="cb194-4235"><a href="#cb194-4235" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb194-4236"><a href="#cb194-4236" aria-hidden="true" tabindex="-1"></a><span class="in">    auc &lt;- roc(outer_test_data[[target_name]], predictions_prob)$auc</span></span>
<span id="cb194-4237"><a href="#cb194-4237" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-4238"><a href="#cb194-4238" aria-hidden="true" tabindex="-1"></a><span class="in">    metrics &lt;- setNames(c(outer_index, TP, TN, FP, FN, auc, </span></span>
<span id="cb194-4239"><a href="#cb194-4239" aria-hidden="true" tabindex="-1"></a><span class="in">                          best_kernel, best_cost, paste(best_vars, collapse = ",")), </span></span>
<span id="cb194-4240"><a href="#cb194-4240" aria-hidden="true" tabindex="-1"></a><span class="in">                        names(performance_metrics))</span></span>
<span id="cb194-4241"><a href="#cb194-4241" aria-hidden="true" tabindex="-1"></a><span class="in">    performance_metrics &lt;- rbind(performance_metrics, as.data.frame(t(metrics)))</span></span>
<span id="cb194-4242"><a href="#cb194-4242" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-4243"><a href="#cb194-4243" aria-hidden="true" tabindex="-1"></a><span class="in">    cat("Performance:\n", paste(performance_metrics), "\n")</span></span>
<span id="cb194-4244"><a href="#cb194-4244" aria-hidden="true" tabindex="-1"></a><span class="in">    cat(sprintf("Confusion Matrix for Fold %d:\n", outer_index))</span></span>
<span id="cb194-4245"><a href="#cb194-4245" aria-hidden="true" tabindex="-1"></a><span class="in">    print(confusion)</span></span>
<span id="cb194-4246"><a href="#cb194-4246" aria-hidden="true" tabindex="-1"></a><span class="in">    cat(sprintf("Metrics for Fold %d:\n", outer_index))</span></span>
<span id="cb194-4247"><a href="#cb194-4247" aria-hidden="true" tabindex="-1"></a><span class="in">    cat(sprintf("TP: %d, TN: %d, FP: %d, FN: %d, AUC: %f, Best Kernel: %s, Best Cost: %f, Best Variables: %s\n",</span></span>
<span id="cb194-4248"><a href="#cb194-4248" aria-hidden="true" tabindex="-1"></a><span class="in">                TP, TN, FP, FN, auc, best_kernel, best_cost, paste(best_vars, collapse = ",")))</span></span>
<span id="cb194-4249"><a href="#cb194-4249" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb194-4250"><a href="#cb194-4250" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb194-4251"><a href="#cb194-4251" aria-hidden="true" tabindex="-1"></a><span class="in">  list(performance_metrics = performance_metrics, inner_fold_metrics = inner_fold_metrics)</span></span>
<span id="cb194-4252"><a href="#cb194-4252" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb194-4253"><a href="#cb194-4253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-4254"><a href="#cb194-4254" aria-hidden="true" tabindex="-1"></a><span class="in">evaluate_with_seeds_SVM_lasso &lt;- </span></span>
<span id="cb194-4255"><a href="#cb194-4255" aria-hidden="true" tabindex="-1"></a><span class="in">  function(evaluation_function, data, target_var, vars, threshold, seeds, outer, inner, kernels, costs) {</span></span>
<span id="cb194-4256"><a href="#cb194-4256" aria-hidden="true" tabindex="-1"></a><span class="in">  results_list &lt;- list()</span></span>
<span id="cb194-4257"><a href="#cb194-4257" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-4258"><a href="#cb194-4258" aria-hidden="true" tabindex="-1"></a><span class="in">  for (seed in seeds) {</span></span>
<span id="cb194-4259"><a href="#cb194-4259" aria-hidden="true" tabindex="-1"></a><span class="in">    set.seed(seed)</span></span>
<span id="cb194-4260"><a href="#cb194-4260" aria-hidden="true" tabindex="-1"></a><span class="in">    cat("Evaluating with seed:", seed, "\n")</span></span>
<span id="cb194-4261"><a href="#cb194-4261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-4262"><a href="#cb194-4262" aria-hidden="true" tabindex="-1"></a><span class="in">    results &lt;- evaluation_function(data = data, </span></span>
<span id="cb194-4263"><a href="#cb194-4263" aria-hidden="true" tabindex="-1"></a><span class="in">                                   target_name = target_var, </span></span>
<span id="cb194-4264"><a href="#cb194-4264" aria-hidden="true" tabindex="-1"></a><span class="in">                                   variables = vars, </span></span>
<span id="cb194-4265"><a href="#cb194-4265" aria-hidden="true" tabindex="-1"></a><span class="in">                                   threshold = threshold, </span></span>
<span id="cb194-4266"><a href="#cb194-4266" aria-hidden="true" tabindex="-1"></a><span class="in">                                   outer = outer, </span></span>
<span id="cb194-4267"><a href="#cb194-4267" aria-hidden="true" tabindex="-1"></a><span class="in">                                   inner = inner, </span></span>
<span id="cb194-4268"><a href="#cb194-4268" aria-hidden="true" tabindex="-1"></a><span class="in">                                   seed = seed,</span></span>
<span id="cb194-4269"><a href="#cb194-4269" aria-hidden="true" tabindex="-1"></a><span class="in">                                   kernels = kernels,</span></span>
<span id="cb194-4270"><a href="#cb194-4270" aria-hidden="true" tabindex="-1"></a><span class="in">                                   costs = costs)</span></span>
<span id="cb194-4271"><a href="#cb194-4271" aria-hidden="true" tabindex="-1"></a><span class="in">    results_list[[paste0("seed_", seed)]] &lt;- results</span></span>
<span id="cb194-4272"><a href="#cb194-4272" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb194-4273"><a href="#cb194-4273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-4274"><a href="#cb194-4274" aria-hidden="true" tabindex="-1"></a><span class="in">  return(results_list)</span></span>
<span id="cb194-4275"><a href="#cb194-4275" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb194-4276"><a href="#cb194-4276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-4277"><a href="#cb194-4277" aria-hidden="true" tabindex="-1"></a><span class="in">performance_SVM_lasso &lt;- evaluate_with_seeds_SVM_lasso(</span></span>
<span id="cb194-4278"><a href="#cb194-4278" aria-hidden="true" tabindex="-1"></a><span class="in">  evaluation_function = double_cross_validation_svm_lasso,</span></span>
<span id="cb194-4279"><a href="#cb194-4279" aria-hidden="true" tabindex="-1"></a><span class="in">  data = data_factor,</span></span>
<span id="cb194-4280"><a href="#cb194-4280" aria-hidden="true" tabindex="-1"></a><span class="in">  outer = 5,</span></span>
<span id="cb194-4281"><a href="#cb194-4281" aria-hidden="true" tabindex="-1"></a><span class="in">  inner = 2,</span></span>
<span id="cb194-4282"><a href="#cb194-4282" aria-hidden="true" tabindex="-1"></a><span class="in">  target_var = "PCR",</span></span>
<span id="cb194-4283"><a href="#cb194-4283" aria-hidden="true" tabindex="-1"></a><span class="in">  kernels = c("linear", "poly"),</span></span>
<span id="cb194-4284"><a href="#cb194-4284" aria-hidden="true" tabindex="-1"></a><span class="in">  costs = c(50, 100, 200),</span></span>
<span id="cb194-4285"><a href="#cb194-4285" aria-hidden="true" tabindex="-1"></a><span class="in">  vars = todas_variables_factor,</span></span>
<span id="cb194-4286"><a href="#cb194-4286" aria-hidden="true" tabindex="-1"></a><span class="in">  threshold = .35,</span></span>
<span id="cb194-4287"><a href="#cb194-4287" aria-hidden="true" tabindex="-1"></a><span class="in">  seeds = seeds</span></span>
<span id="cb194-4288"><a href="#cb194-4288" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb194-4289"><a href="#cb194-4289" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-4290"><a href="#cb194-4290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-4291"><a href="#cb194-4291" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message=FALSE, warning=FALSE}</span></span>
<span id="cb194-4292"><a href="#cb194-4292" aria-hidden="true" tabindex="-1"></a><span class="in">load("RData_Files_Algorithms/SVM_Lasso.RData")</span></span>
<span id="cb194-4293"><a href="#cb194-4293" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-4294"><a href="#cb194-4294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-4295"><a href="#cb194-4295" aria-hidden="true" tabindex="-1"></a><span class="fu">## Artificial Neural Networks</span></span>
<span id="cb194-4296"><a href="#cb194-4296" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-4297"><a href="#cb194-4297" aria-hidden="true" tabindex="-1"></a><span class="fu">### Aparente</span></span>
<span id="cb194-4298"><a href="#cb194-4298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-4299"><a href="#cb194-4299" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=FALSE}</span></span>
<span id="cb194-4300"><a href="#cb194-4300" aria-hidden="true" tabindex="-1"></a><span class="in">evaluate_aparent_performance_model_nnet &lt;- function(data, target_var, model_func, vars = NULL, threshold = 0.5) {</span></span>
<span id="cb194-4301"><a href="#cb194-4301" aria-hidden="true" tabindex="-1"></a><span class="in">  if (is.null(vars)) {</span></span>
<span id="cb194-4302"><a href="#cb194-4302" aria-hidden="true" tabindex="-1"></a><span class="in">    vars &lt;- setdiff(names(data), target_var)</span></span>
<span id="cb194-4303"><a href="#cb194-4303" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb194-4304"><a href="#cb194-4304" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb194-4305"><a href="#cb194-4305" aria-hidden="true" tabindex="-1"></a><span class="in">  data[[target_var]] &lt;- factor(data[[target_var]], levels = c(0, 1))</span></span>
<span id="cb194-4306"><a href="#cb194-4306" aria-hidden="true" tabindex="-1"></a><span class="in">  formula &lt;- as.formula(paste(target_var, "~", paste(vars, collapse = "+")))</span></span>
<span id="cb194-4307"><a href="#cb194-4307" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb194-4308"><a href="#cb194-4308" aria-hidden="true" tabindex="-1"></a><span class="in">  model &lt;- model_func(formula, data)</span></span>
<span id="cb194-4309"><a href="#cb194-4309" aria-hidden="true" tabindex="-1"></a><span class="in">  predictions &lt;- predict(model, newdata = data, type = "raw")</span></span>
<span id="cb194-4310"><a href="#cb194-4310" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb194-4311"><a href="#cb194-4311" aria-hidden="true" tabindex="-1"></a><span class="in">  actual_classes &lt;- data[[target_var]]</span></span>
<span id="cb194-4312"><a href="#cb194-4312" aria-hidden="true" tabindex="-1"></a><span class="in">  predicted_classes &lt;- ifelse(predictions &gt; threshold, 1, 0)</span></span>
<span id="cb194-4313"><a href="#cb194-4313" aria-hidden="true" tabindex="-1"></a><span class="in">  confusion_matrix &lt;- table(predicted_classes, actual_classes)</span></span>
<span id="cb194-4314"><a href="#cb194-4314" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb194-4315"><a href="#cb194-4315" aria-hidden="true" tabindex="-1"></a><span class="in">  tp &lt;- ifelse("1" %in% rownames(confusion_matrix) &amp;&amp; "1" %in% colnames(confusion_matrix), confusion_matrix["1", "1"], 0)</span></span>
<span id="cb194-4316"><a href="#cb194-4316" aria-hidden="true" tabindex="-1"></a><span class="in">  tn &lt;- ifelse("0" %in% rownames(confusion_matrix) &amp;&amp; "0" %in% colnames(confusion_matrix), confusion_matrix["0", "0"], 0)</span></span>
<span id="cb194-4317"><a href="#cb194-4317" aria-hidden="true" tabindex="-1"></a><span class="in">  fp &lt;- ifelse("1" %in% rownames(confusion_matrix) &amp;&amp; "0" %in% colnames(confusion_matrix), confusion_matrix["1", "0"], 0)</span></span>
<span id="cb194-4318"><a href="#cb194-4318" aria-hidden="true" tabindex="-1"></a><span class="in">  fn &lt;- ifelse("0" %in% rownames(confusion_matrix) &amp;&amp; "1" %in% colnames(confusion_matrix), confusion_matrix["0", "1"], 0)</span></span>
<span id="cb194-4319"><a href="#cb194-4319" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb194-4320"><a href="#cb194-4320" aria-hidden="true" tabindex="-1"></a><span class="in">  accuracy &lt;- (tp + tn) / (tp + tn + fp + fn)</span></span>
<span id="cb194-4321"><a href="#cb194-4321" aria-hidden="true" tabindex="-1"></a><span class="in">  precision &lt;- ifelse(tp + fp &gt; 0, tp / (tp + fp), 0)</span></span>
<span id="cb194-4322"><a href="#cb194-4322" aria-hidden="true" tabindex="-1"></a><span class="in">  recall &lt;- ifelse(tp + fn &gt; 0, tp / (tp + fn), 0)</span></span>
<span id="cb194-4323"><a href="#cb194-4323" aria-hidden="true" tabindex="-1"></a><span class="in">  f1_score &lt;- ifelse(precision + recall &gt; 0, 2 * (precision * recall) / (precision + recall), 0)</span></span>
<span id="cb194-4324"><a href="#cb194-4324" aria-hidden="true" tabindex="-1"></a><span class="in">  roc_obj &lt;- pROC::roc(actual_classes, predictions)</span></span>
<span id="cb194-4325"><a href="#cb194-4325" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb194-4326"><a href="#cb194-4326" aria-hidden="true" tabindex="-1"></a><span class="in">  list(confusion_matrix = confusion_matrix, accuracy = accuracy, precision = precision, </span></span>
<span id="cb194-4327"><a href="#cb194-4327" aria-hidden="true" tabindex="-1"></a><span class="in">       recall = recall, f1_score = f1_score, roc_curve = roc_obj)</span></span>
<span id="cb194-4328"><a href="#cb194-4328" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb194-4329"><a href="#cb194-4329" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-4330"><a href="#cb194-4330" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-4331"><a href="#cb194-4331" aria-hidden="true" tabindex="-1"></a><span class="in">nn_model &lt;- function(formula, data) {</span></span>
<span id="cb194-4332"><a href="#cb194-4332" aria-hidden="true" tabindex="-1"></a><span class="in">  set.seed(90)</span></span>
<span id="cb194-4333"><a href="#cb194-4333" aria-hidden="true" tabindex="-1"></a><span class="in">  nnet(formula = formula, data = data, size = 15, </span></span>
<span id="cb194-4334"><a href="#cb194-4334" aria-hidden="true" tabindex="-1"></a><span class="in">       decay = 0.1, maxit = 100, trace = FALSE, </span></span>
<span id="cb194-4335"><a href="#cb194-4335" aria-hidden="true" tabindex="-1"></a><span class="in">       linout = FALSE, random_state = 90)</span></span>
<span id="cb194-4336"><a href="#cb194-4336" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb194-4337"><a href="#cb194-4337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-4338"><a href="#cb194-4338" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-4339"><a href="#cb194-4339" aria-hidden="true" tabindex="-1"></a><span class="in">resultadosAparentesNN &lt;- evaluate_aparent_performance_model_nnet(data = data_factor, target_var = "PCR",</span></span>
<span id="cb194-4340"><a href="#cb194-4340" aria-hidden="true" tabindex="-1"></a><span class="in">                                                             model_func = nn_model,</span></span>
<span id="cb194-4341"><a href="#cb194-4341" aria-hidden="true" tabindex="-1"></a><span class="in">                                                             vars = ".",</span></span>
<span id="cb194-4342"><a href="#cb194-4342" aria-hidden="true" tabindex="-1"></a><span class="in">                                                             threshold = .35)</span></span>
<span id="cb194-4343"><a href="#cb194-4343" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-4344"><a href="#cb194-4344" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-4345"><a href="#cb194-4345" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message=FALSE, warning=FALSE}</span></span>
<span id="cb194-4346"><a href="#cb194-4346" aria-hidden="true" tabindex="-1"></a><span class="in">load("RData_Files_Algorithms/ANN_Aparente.RData")</span></span>
<span id="cb194-4347"><a href="#cb194-4347" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-4348"><a href="#cb194-4348" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-4349"><a href="#cb194-4349" aria-hidden="true" tabindex="-1"></a><span class="fu">### Todas las Variables</span></span>
<span id="cb194-4350"><a href="#cb194-4350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-4351"><a href="#cb194-4351" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=FALSE}</span></span>
<span id="cb194-4352"><a href="#cb194-4352" aria-hidden="true" tabindex="-1"></a><span class="in">double_cross_validation_nnet &lt;- function(data, target_name, outer, inner, sizes, decays, variables, threshold, seed) {</span></span>
<span id="cb194-4353"><a href="#cb194-4353" aria-hidden="true" tabindex="-1"></a><span class="in">  set.seed(seed)</span></span>
<span id="cb194-4354"><a href="#cb194-4354" aria-hidden="true" tabindex="-1"></a><span class="in">  performance_metrics &lt;- data.frame(Fold = integer(), TP = integer(), TN = integer(),</span></span>
<span id="cb194-4355"><a href="#cb194-4355" aria-hidden="true" tabindex="-1"></a><span class="in">                                    FP = integer(), FN = integer(), AUC = numeric(),</span></span>
<span id="cb194-4356"><a href="#cb194-4356" aria-hidden="true" tabindex="-1"></a><span class="in">                                    Best_Size = integer(), Best_Decay = numeric(), stringsAsFactors = FALSE)</span></span>
<span id="cb194-4357"><a href="#cb194-4357" aria-hidden="true" tabindex="-1"></a><span class="in">  data[[target_name]] &lt;- as.numeric(data[[target_name]]) - 1</span></span>
<span id="cb194-4358"><a href="#cb194-4358" aria-hidden="true" tabindex="-1"></a><span class="in">  outer_folds &lt;- createFolds(data[[target_name]], k = outer, list = TRUE, returnTrain = FALSE)</span></span>
<span id="cb194-4359"><a href="#cb194-4359" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-4360"><a href="#cb194-4360" aria-hidden="true" tabindex="-1"></a><span class="in">  for (outer_index in seq_along(outer_folds)) {</span></span>
<span id="cb194-4361"><a href="#cb194-4361" aria-hidden="true" tabindex="-1"></a><span class="in">    outer_train_data &lt;- data[-outer_folds[[outer_index]], ]</span></span>
<span id="cb194-4362"><a href="#cb194-4362" aria-hidden="true" tabindex="-1"></a><span class="in">    outer_test_data &lt;- data[outer_folds[[outer_index]], ]</span></span>
<span id="cb194-4363"><a href="#cb194-4363" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-4364"><a href="#cb194-4364" aria-hidden="true" tabindex="-1"></a><span class="in">    cat(sprintf("Outer Fold %d\n", outer_index))</span></span>
<span id="cb194-4365"><a href="#cb194-4365" aria-hidden="true" tabindex="-1"></a><span class="in">    cat("Training Data - Class 0: ", sum(outer_train_data[[target_name]] == 0), "\n")</span></span>
<span id="cb194-4366"><a href="#cb194-4366" aria-hidden="true" tabindex="-1"></a><span class="in">    cat("Training Data - Class 1: ", sum(outer_train_data[[target_name]] == 1), "\n")</span></span>
<span id="cb194-4367"><a href="#cb194-4367" aria-hidden="true" tabindex="-1"></a><span class="in">    cat("Training Data - Total: ", nrow(outer_train_data), "\n")</span></span>
<span id="cb194-4368"><a href="#cb194-4368" aria-hidden="true" tabindex="-1"></a><span class="in">    cat("Testing Data - Class 0: ", sum(outer_test_data[[target_name]] == 0), "\n")</span></span>
<span id="cb194-4369"><a href="#cb194-4369" aria-hidden="true" tabindex="-1"></a><span class="in">    cat("Testing Data - Class 1: ", sum(outer_test_data[[target_name]] == 1), "\n")</span></span>
<span id="cb194-4370"><a href="#cb194-4370" aria-hidden="true" tabindex="-1"></a><span class="in">    cat("Testing Data - Total: ", nrow(outer_test_data), "\n")</span></span>
<span id="cb194-4371"><a href="#cb194-4371" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-4372"><a href="#cb194-4372" aria-hidden="true" tabindex="-1"></a><span class="in">    if (sum(outer_train_data[[target_name]] == 0) == 0 || sum(outer_train_data[[target_name]] == 1) == 0) {</span></span>
<span id="cb194-4373"><a href="#cb194-4373" aria-hidden="true" tabindex="-1"></a><span class="in">      cat("Skipping outer fold due to lack of class diversity\n")</span></span>
<span id="cb194-4374"><a href="#cb194-4374" aria-hidden="true" tabindex="-1"></a><span class="in">      next</span></span>
<span id="cb194-4375"><a href="#cb194-4375" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb194-4376"><a href="#cb194-4376" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-4377"><a href="#cb194-4377" aria-hidden="true" tabindex="-1"></a><span class="in">    inner_folds &lt;- createFolds(outer_train_data[[target_name]], k = inner, list = TRUE, returnTrain = FALSE)</span></span>
<span id="cb194-4378"><a href="#cb194-4378" aria-hidden="true" tabindex="-1"></a><span class="in">    best_model &lt;- NULL</span></span>
<span id="cb194-4379"><a href="#cb194-4379" aria-hidden="true" tabindex="-1"></a><span class="in">    best_auc &lt;- 0</span></span>
<span id="cb194-4380"><a href="#cb194-4380" aria-hidden="true" tabindex="-1"></a><span class="in">    best_size &lt;- NULL</span></span>
<span id="cb194-4381"><a href="#cb194-4381" aria-hidden="true" tabindex="-1"></a><span class="in">    best_decay &lt;- NULL</span></span>
<span id="cb194-4382"><a href="#cb194-4382" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-4383"><a href="#cb194-4383" aria-hidden="true" tabindex="-1"></a><span class="in">    grid &lt;- expand.grid(size = sizes, decay = decays)</span></span>
<span id="cb194-4384"><a href="#cb194-4384" aria-hidden="true" tabindex="-1"></a><span class="in">    formula &lt;- reformulate(variables, target_name)</span></span>
<span id="cb194-4385"><a href="#cb194-4385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-4386"><a href="#cb194-4386" aria-hidden="true" tabindex="-1"></a><span class="in">    for (params in 1:nrow(grid)) {</span></span>
<span id="cb194-4387"><a href="#cb194-4387" aria-hidden="true" tabindex="-1"></a><span class="in">      inner_auc &lt;- numeric()</span></span>
<span id="cb194-4388"><a href="#cb194-4388" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-4389"><a href="#cb194-4389" aria-hidden="true" tabindex="-1"></a><span class="in">      for (inner_index in seq_along(inner_folds)) {</span></span>
<span id="cb194-4390"><a href="#cb194-4390" aria-hidden="true" tabindex="-1"></a><span class="in">        inner_train_data &lt;- outer_train_data[-inner_folds[[inner_index]], ]</span></span>
<span id="cb194-4391"><a href="#cb194-4391" aria-hidden="true" tabindex="-1"></a><span class="in">        inner_test_data &lt;- outer_train_data[inner_folds[[inner_index]], ]</span></span>
<span id="cb194-4392"><a href="#cb194-4392" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-4393"><a href="#cb194-4393" aria-hidden="true" tabindex="-1"></a><span class="in">        if (sum(inner_train_data[[target_name]] == 0) == 0 || sum(inner_train_data[[target_name]] == 1) == 0) {</span></span>
<span id="cb194-4394"><a href="#cb194-4394" aria-hidden="true" tabindex="-1"></a><span class="in">          cat("Skipping inner fold due to lack of class diversity\n")</span></span>
<span id="cb194-4395"><a href="#cb194-4395" aria-hidden="true" tabindex="-1"></a><span class="in">          next</span></span>
<span id="cb194-4396"><a href="#cb194-4396" aria-hidden="true" tabindex="-1"></a><span class="in">        }</span></span>
<span id="cb194-4397"><a href="#cb194-4397" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-4398"><a href="#cb194-4398" aria-hidden="true" tabindex="-1"></a><span class="in">        result &lt;- tryCatch({</span></span>
<span id="cb194-4399"><a href="#cb194-4399" aria-hidden="true" tabindex="-1"></a><span class="in">          model &lt;- nnet(formula, data = inner_train_data, size = grid$size[params], decay = grid$decay[params], linout = FALSE, maxit = 200)</span></span>
<span id="cb194-4400"><a href="#cb194-4400" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-4401"><a href="#cb194-4401" aria-hidden="true" tabindex="-1"></a><span class="in">          predictions &lt;- predict(model, inner_test_data, type = "raw")</span></span>
<span id="cb194-4402"><a href="#cb194-4402" aria-hidden="true" tabindex="-1"></a><span class="in">          roc_curve &lt;- pROC::roc(inner_test_data[[target_name]], predictions)</span></span>
<span id="cb194-4403"><a href="#cb194-4403" aria-hidden="true" tabindex="-1"></a><span class="in">          inner_auc[inner_index] &lt;- roc_curve$auc</span></span>
<span id="cb194-4404"><a href="#cb194-4404" aria-hidden="true" tabindex="-1"></a><span class="in">        }, error = function(e) {</span></span>
<span id="cb194-4405"><a href="#cb194-4405" aria-hidden="true" tabindex="-1"></a><span class="in">          cat("Error with parameters: size =", grid$size[params], ", decay =", grid$decay[params], "\n")</span></span>
<span id="cb194-4406"><a href="#cb194-4406" aria-hidden="true" tabindex="-1"></a><span class="in">          cat("Error message: ", e$message, "\n")</span></span>
<span id="cb194-4407"><a href="#cb194-4407" aria-hidden="true" tabindex="-1"></a><span class="in">          inner_auc[inner_index] &lt;- 0</span></span>
<span id="cb194-4408"><a href="#cb194-4408" aria-hidden="true" tabindex="-1"></a><span class="in">        })</span></span>
<span id="cb194-4409"><a href="#cb194-4409" aria-hidden="true" tabindex="-1"></a><span class="in">      }</span></span>
<span id="cb194-4410"><a href="#cb194-4410" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-4411"><a href="#cb194-4411" aria-hidden="true" tabindex="-1"></a><span class="in">      if (mean(inner_auc, na.rm = TRUE) &gt; best_auc) {</span></span>
<span id="cb194-4412"><a href="#cb194-4412" aria-hidden="true" tabindex="-1"></a><span class="in">        best_auc &lt;- mean(inner_auc, na.rm = TRUE)</span></span>
<span id="cb194-4413"><a href="#cb194-4413" aria-hidden="true" tabindex="-1"></a><span class="in">        best_model &lt;- model</span></span>
<span id="cb194-4414"><a href="#cb194-4414" aria-hidden="true" tabindex="-1"></a><span class="in">        best_size &lt;- grid$size[params]</span></span>
<span id="cb194-4415"><a href="#cb194-4415" aria-hidden="true" tabindex="-1"></a><span class="in">        best_decay &lt;- grid$decay[params]</span></span>
<span id="cb194-4416"><a href="#cb194-4416" aria-hidden="true" tabindex="-1"></a><span class="in">      }</span></span>
<span id="cb194-4417"><a href="#cb194-4417" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb194-4418"><a href="#cb194-4418" aria-hidden="true" tabindex="-1"></a><span class="in">    model &lt;- nnet(formula, data = outer_train_data, size = best_size, decay = best_decay, linout = FALSE, maxit = 200)</span></span>
<span id="cb194-4419"><a href="#cb194-4419" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-4420"><a href="#cb194-4420" aria-hidden="true" tabindex="-1"></a><span class="in">    predictions &lt;- predict(best_model, outer_test_data, type = "raw")</span></span>
<span id="cb194-4421"><a href="#cb194-4421" aria-hidden="true" tabindex="-1"></a><span class="in">    pred_class &lt;- ifelse(predictions &gt; threshold, 1, 0)  # Asignar clases basadas en umbral</span></span>
<span id="cb194-4422"><a href="#cb194-4422" aria-hidden="true" tabindex="-1"></a><span class="in">    confusion &lt;- table(Actual = outer_test_data[[target_name]], Predicted = pred_class)</span></span>
<span id="cb194-4423"><a href="#cb194-4423" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-4424"><a href="#cb194-4424" aria-hidden="true" tabindex="-1"></a><span class="in">    if (nrow(confusion) &lt; 2 || ncol(confusion) &lt; 2) {</span></span>
<span id="cb194-4425"><a href="#cb194-4425" aria-hidden="true" tabindex="-1"></a><span class="in">      TP &lt;- ifelse(nrow(confusion) &gt;= 2 &amp;&amp; ncol(confusion) &gt;= 2, confusion[2, 2], 0)</span></span>
<span id="cb194-4426"><a href="#cb194-4426" aria-hidden="true" tabindex="-1"></a><span class="in">      TN &lt;- ifelse(nrow(confusion) &gt;= 1 &amp;&amp; ncol(confusion) &gt;= 1, confusion[1, 1], 0)</span></span>
<span id="cb194-4427"><a href="#cb194-4427" aria-hidden="true" tabindex="-1"></a><span class="in">      FP &lt;- ifelse(nrow(confusion) &gt;= 1 &amp;&amp; ncol(confusion) &gt;= 2, confusion[1, 2], 0)</span></span>
<span id="cb194-4428"><a href="#cb194-4428" aria-hidden="true" tabindex="-1"></a><span class="in">      FN &lt;- ifelse(nrow(confusion) &gt;= 2 &amp;&amp; ncol(confusion) &gt;= 1, confusion[2, 1], 0)</span></span>
<span id="cb194-4429"><a href="#cb194-4429" aria-hidden="true" tabindex="-1"></a><span class="in">    } else {</span></span>
<span id="cb194-4430"><a href="#cb194-4430" aria-hidden="true" tabindex="-1"></a><span class="in">      TP &lt;- confusion[2, 2]</span></span>
<span id="cb194-4431"><a href="#cb194-4431" aria-hidden="true" tabindex="-1"></a><span class="in">      TN &lt;- confusion[1, 1]</span></span>
<span id="cb194-4432"><a href="#cb194-4432" aria-hidden="true" tabindex="-1"></a><span class="in">      FP &lt;- confusion[1, 2]</span></span>
<span id="cb194-4433"><a href="#cb194-4433" aria-hidden="true" tabindex="-1"></a><span class="in">      FN &lt;- confusion[2, 1]</span></span>
<span id="cb194-4434"><a href="#cb194-4434" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb194-4435"><a href="#cb194-4435" aria-hidden="true" tabindex="-1"></a><span class="in">    auc &lt;- pROC::roc(outer_test_data[[target_name]], predictions)$auc</span></span>
<span id="cb194-4436"><a href="#cb194-4436" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-4437"><a href="#cb194-4437" aria-hidden="true" tabindex="-1"></a><span class="in">    metrics &lt;- setNames(c(outer_index, TP, TN, FP, FN, auc, best_size, best_decay), names(performance_metrics))</span></span>
<span id="cb194-4438"><a href="#cb194-4438" aria-hidden="true" tabindex="-1"></a><span class="in">    performance_metrics &lt;- rbind(performance_metrics, as.data.frame(t(metrics)))</span></span>
<span id="cb194-4439"><a href="#cb194-4439" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb194-4440"><a href="#cb194-4440" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-4441"><a href="#cb194-4441" aria-hidden="true" tabindex="-1"></a><span class="in">  return(performance_metrics)</span></span>
<span id="cb194-4442"><a href="#cb194-4442" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb194-4443"><a href="#cb194-4443" aria-hidden="true" tabindex="-1"></a><span class="in">evaluate_with_seeds_ANN_TodasVariables_Asociacion &lt;- </span></span>
<span id="cb194-4444"><a href="#cb194-4444" aria-hidden="true" tabindex="-1"></a><span class="in">  function(evaluation_function, data, target_var, vars, threshold, seeds, outer, inner, sizes, decays) {</span></span>
<span id="cb194-4445"><a href="#cb194-4445" aria-hidden="true" tabindex="-1"></a><span class="in">  results_list &lt;- list()</span></span>
<span id="cb194-4446"><a href="#cb194-4446" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-4447"><a href="#cb194-4447" aria-hidden="true" tabindex="-1"></a><span class="in">  for (seed in seeds) {</span></span>
<span id="cb194-4448"><a href="#cb194-4448" aria-hidden="true" tabindex="-1"></a><span class="in">    set.seed(seed)</span></span>
<span id="cb194-4449"><a href="#cb194-4449" aria-hidden="true" tabindex="-1"></a><span class="in">    cat("Evaluating with seed:", seed, "\n")</span></span>
<span id="cb194-4450"><a href="#cb194-4450" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-4451"><a href="#cb194-4451" aria-hidden="true" tabindex="-1"></a><span class="in">    results &lt;- evaluation_function(data = data, </span></span>
<span id="cb194-4452"><a href="#cb194-4452" aria-hidden="true" tabindex="-1"></a><span class="in">                                   target_name = target_var, </span></span>
<span id="cb194-4453"><a href="#cb194-4453" aria-hidden="true" tabindex="-1"></a><span class="in">                                   variables = vars, </span></span>
<span id="cb194-4454"><a href="#cb194-4454" aria-hidden="true" tabindex="-1"></a><span class="in">                                   threshold = threshold, </span></span>
<span id="cb194-4455"><a href="#cb194-4455" aria-hidden="true" tabindex="-1"></a><span class="in">                                   outer = outer, </span></span>
<span id="cb194-4456"><a href="#cb194-4456" aria-hidden="true" tabindex="-1"></a><span class="in">                                   inner = inner, </span></span>
<span id="cb194-4457"><a href="#cb194-4457" aria-hidden="true" tabindex="-1"></a><span class="in">                                   seed = seed,</span></span>
<span id="cb194-4458"><a href="#cb194-4458" aria-hidden="true" tabindex="-1"></a><span class="in">                                   sizes = sizes,</span></span>
<span id="cb194-4459"><a href="#cb194-4459" aria-hidden="true" tabindex="-1"></a><span class="in">                                   decays = decays)</span></span>
<span id="cb194-4460"><a href="#cb194-4460" aria-hidden="true" tabindex="-1"></a><span class="in">    results_list[[paste0("seed_", seed)]] &lt;- results</span></span>
<span id="cb194-4461"><a href="#cb194-4461" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb194-4462"><a href="#cb194-4462" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-4463"><a href="#cb194-4463" aria-hidden="true" tabindex="-1"></a><span class="in">  return(results_list)</span></span>
<span id="cb194-4464"><a href="#cb194-4464" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb194-4465"><a href="#cb194-4465" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-4466"><a href="#cb194-4466" aria-hidden="true" tabindex="-1"></a><span class="in">performance_ANN_todasvariables &lt;- evaluate_with_seeds_ANN_TodasVariables_Asociacion(</span></span>
<span id="cb194-4467"><a href="#cb194-4467" aria-hidden="true" tabindex="-1"></a><span class="in">  evaluation_function = double_cross_validation_nnet,</span></span>
<span id="cb194-4468"><a href="#cb194-4468" aria-hidden="true" tabindex="-1"></a><span class="in">  data = data_factor,</span></span>
<span id="cb194-4469"><a href="#cb194-4469" aria-hidden="true" tabindex="-1"></a><span class="in">  outer = 5,</span></span>
<span id="cb194-4470"><a href="#cb194-4470" aria-hidden="true" tabindex="-1"></a><span class="in">  inner = 2,</span></span>
<span id="cb194-4471"><a href="#cb194-4471" aria-hidden="true" tabindex="-1"></a><span class="in">  target_var = "PCR",</span></span>
<span id="cb194-4472"><a href="#cb194-4472" aria-hidden="true" tabindex="-1"></a><span class="in">  sizes = c(5,10,15,20,25,30),</span></span>
<span id="cb194-4473"><a href="#cb194-4473" aria-hidden="true" tabindex="-1"></a><span class="in">  decays = c(0.1, 0.2, 0.3, 0.4),</span></span>
<span id="cb194-4474"><a href="#cb194-4474" aria-hidden="true" tabindex="-1"></a><span class="in">  vars = todas_variables_factor,</span></span>
<span id="cb194-4475"><a href="#cb194-4475" aria-hidden="true" tabindex="-1"></a><span class="in">  threshold = .35,</span></span>
<span id="cb194-4476"><a href="#cb194-4476" aria-hidden="true" tabindex="-1"></a><span class="in">  seeds = seeds</span></span>
<span id="cb194-4477"><a href="#cb194-4477" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb194-4478"><a href="#cb194-4478" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-4479"><a href="#cb194-4479" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-4480"><a href="#cb194-4480" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-4481"><a href="#cb194-4481" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message=FALSE, warning=FALSE}</span></span>
<span id="cb194-4482"><a href="#cb194-4482" aria-hidden="true" tabindex="-1"></a><span class="in">load("RData_Files_Algorithms/ANN_TodasVariables.RData")</span></span>
<span id="cb194-4483"><a href="#cb194-4483" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-4484"><a href="#cb194-4484" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-4485"><a href="#cb194-4485" aria-hidden="true" tabindex="-1"></a><span class="fu">### Filtrado (Asociación)</span></span>
<span id="cb194-4486"><a href="#cb194-4486" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-4487"><a href="#cb194-4487" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=FALSE}</span></span>
<span id="cb194-4488"><a href="#cb194-4488" aria-hidden="true" tabindex="-1"></a><span class="in">performance_ANN_asociacion &lt;- evaluate_with_seeds_ANN_TodasVariables_Asociacion(</span></span>
<span id="cb194-4489"><a href="#cb194-4489" aria-hidden="true" tabindex="-1"></a><span class="in">  evaluation_function = double_cross_validation_nnet,</span></span>
<span id="cb194-4490"><a href="#cb194-4490" aria-hidden="true" tabindex="-1"></a><span class="in">  data = data_factor,</span></span>
<span id="cb194-4491"><a href="#cb194-4491" aria-hidden="true" tabindex="-1"></a><span class="in">  outer = 5,</span></span>
<span id="cb194-4492"><a href="#cb194-4492" aria-hidden="true" tabindex="-1"></a><span class="in">  inner = 2,</span></span>
<span id="cb194-4493"><a href="#cb194-4493" aria-hidden="true" tabindex="-1"></a><span class="in">  target_var = "PCR",</span></span>
<span id="cb194-4494"><a href="#cb194-4494" aria-hidden="true" tabindex="-1"></a><span class="in">  sizes = c(5,10,15,20,25,30),</span></span>
<span id="cb194-4495"><a href="#cb194-4495" aria-hidden="true" tabindex="-1"></a><span class="in">  decays = c(0.1, 0.2, 0.3, 0.4),</span></span>
<span id="cb194-4496"><a href="#cb194-4496" aria-hidden="true" tabindex="-1"></a><span class="in">  vars = asociacion,</span></span>
<span id="cb194-4497"><a href="#cb194-4497" aria-hidden="true" tabindex="-1"></a><span class="in">  threshold = .35,</span></span>
<span id="cb194-4498"><a href="#cb194-4498" aria-hidden="true" tabindex="-1"></a><span class="in">  seeds = seeds</span></span>
<span id="cb194-4499"><a href="#cb194-4499" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb194-4500"><a href="#cb194-4500" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-4501"><a href="#cb194-4501" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-4502"><a href="#cb194-4502" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message=FALSE, warning=FALSE}</span></span>
<span id="cb194-4503"><a href="#cb194-4503" aria-hidden="true" tabindex="-1"></a><span class="in">load("RData_Files_Algorithms/ANN_Asociacion.RData")</span></span>
<span id="cb194-4504"><a href="#cb194-4504" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-4505"><a href="#cb194-4505" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-4506"><a href="#cb194-4506" aria-hidden="true" tabindex="-1"></a><span class="fu">### Wrapped (StepAUC)</span></span>
<span id="cb194-4507"><a href="#cb194-4507" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-4508"><a href="#cb194-4508" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=FALSE}</span></span>
<span id="cb194-4509"><a href="#cb194-4509" aria-hidden="true" tabindex="-1"></a><span class="in">double_cross_validation_nnet_stepAUC &lt;- function(data, target_name, outer, inner, sizes, decays, variables, threshold, seed) {</span></span>
<span id="cb194-4510"><a href="#cb194-4510" aria-hidden="true" tabindex="-1"></a><span class="in">  set.seed(seed)</span></span>
<span id="cb194-4511"><a href="#cb194-4511" aria-hidden="true" tabindex="-1"></a><span class="in">  performance_metrics &lt;- data.frame(Fold = integer(), TP = integer(), TN = integer(),</span></span>
<span id="cb194-4512"><a href="#cb194-4512" aria-hidden="true" tabindex="-1"></a><span class="in">                                    FP = integer(), FN = integer(), AUC = numeric(),</span></span>
<span id="cb194-4513"><a href="#cb194-4513" aria-hidden="true" tabindex="-1"></a><span class="in">                                    Best_Size = integer(), Best_Decay = numeric(), Best_Variables = character(), stringsAsFactors = FALSE)</span></span>
<span id="cb194-4514"><a href="#cb194-4514" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb194-4515"><a href="#cb194-4515" aria-hidden="true" tabindex="-1"></a><span class="in">  inner_fold_metrics &lt;- data.frame(Fold = integer(), Inner_Fold = integer(), </span></span>
<span id="cb194-4516"><a href="#cb194-4516" aria-hidden="true" tabindex="-1"></a><span class="in">                                   TP = integer(), TN = integer(), FP = integer(), </span></span>
<span id="cb194-4517"><a href="#cb194-4517" aria-hidden="true" tabindex="-1"></a><span class="in">                                   FN = integer(), AUC = numeric(), stringsAsFactors = FALSE)</span></span>
<span id="cb194-4518"><a href="#cb194-4518" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb194-4519"><a href="#cb194-4519" aria-hidden="true" tabindex="-1"></a><span class="in">  data[[target_name]] &lt;- as.numeric(data[[target_name]]) - 1</span></span>
<span id="cb194-4520"><a href="#cb194-4520" aria-hidden="true" tabindex="-1"></a><span class="in">  outer_folds &lt;- createFolds(data[[target_name]], k = outer)</span></span>
<span id="cb194-4521"><a href="#cb194-4521" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb194-4522"><a href="#cb194-4522" aria-hidden="true" tabindex="-1"></a><span class="in">  for (outer_index in seq_along(outer_folds)) {</span></span>
<span id="cb194-4523"><a href="#cb194-4523" aria-hidden="true" tabindex="-1"></a><span class="in">    outer_train_data &lt;- data[-outer_folds[[outer_index]], ]</span></span>
<span id="cb194-4524"><a href="#cb194-4524" aria-hidden="true" tabindex="-1"></a><span class="in">    outer_test_data &lt;- data[outer_folds[[outer_index]], ]</span></span>
<span id="cb194-4525"><a href="#cb194-4525" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-4526"><a href="#cb194-4526" aria-hidden="true" tabindex="-1"></a><span class="in">    cat(sprintf("Outer Fold %d\n", outer_index))</span></span>
<span id="cb194-4527"><a href="#cb194-4527" aria-hidden="true" tabindex="-1"></a><span class="in">    cat("Training Data - Class 0: ", sum(outer_train_data[[target_name]] == 0), "\n")</span></span>
<span id="cb194-4528"><a href="#cb194-4528" aria-hidden="true" tabindex="-1"></a><span class="in">    cat("Training Data - Class 1: ", sum(outer_train_data[[target_name]] == 1), "\n")</span></span>
<span id="cb194-4529"><a href="#cb194-4529" aria-hidden="true" tabindex="-1"></a><span class="in">    cat("Testing Data - Class 0: ", sum(outer_test_data[[target_name]] == 0), "\n")</span></span>
<span id="cb194-4530"><a href="#cb194-4530" aria-hidden="true" tabindex="-1"></a><span class="in">    cat("Testing Data - Class 1: ", sum(outer_test_data[[target_name]] == 1), "\n")</span></span>
<span id="cb194-4531"><a href="#cb194-4531" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-4532"><a href="#cb194-4532" aria-hidden="true" tabindex="-1"></a><span class="in">    inner_folds &lt;- createFolds(outer_train_data[[target_name]], k = inner)</span></span>
<span id="cb194-4533"><a href="#cb194-4533" aria-hidden="true" tabindex="-1"></a><span class="in">    best_model &lt;- NULL</span></span>
<span id="cb194-4534"><a href="#cb194-4534" aria-hidden="true" tabindex="-1"></a><span class="in">    best_auc &lt;- 0</span></span>
<span id="cb194-4535"><a href="#cb194-4535" aria-hidden="true" tabindex="-1"></a><span class="in">    best_size &lt;- NULL</span></span>
<span id="cb194-4536"><a href="#cb194-4536" aria-hidden="true" tabindex="-1"></a><span class="in">    best_decay &lt;- NULL</span></span>
<span id="cb194-4537"><a href="#cb194-4537" aria-hidden="true" tabindex="-1"></a><span class="in">    best_vars &lt;- variables</span></span>
<span id="cb194-4538"><a href="#cb194-4538" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-4539"><a href="#cb194-4539" aria-hidden="true" tabindex="-1"></a><span class="in">    grid &lt;- expand.grid(size = sizes, decay = decays)</span></span>
<span id="cb194-4540"><a href="#cb194-4540" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-4541"><a href="#cb194-4541" aria-hidden="true" tabindex="-1"></a><span class="in">    stepAUC &lt;- function(vars, data, target_name, grid, inner_folds) {</span></span>
<span id="cb194-4542"><a href="#cb194-4542" aria-hidden="true" tabindex="-1"></a><span class="in">      current_vars &lt;- vars</span></span>
<span id="cb194-4543"><a href="#cb194-4543" aria-hidden="true" tabindex="-1"></a><span class="in">      best_inner_auc &lt;- 0</span></span>
<span id="cb194-4544"><a href="#cb194-4544" aria-hidden="true" tabindex="-1"></a><span class="in">      best_inner_model &lt;- NULL</span></span>
<span id="cb194-4545"><a href="#cb194-4545" aria-hidden="true" tabindex="-1"></a><span class="in">      best_inner_size &lt;- NULL</span></span>
<span id="cb194-4546"><a href="#cb194-4546" aria-hidden="true" tabindex="-1"></a><span class="in">      best_inner_decay &lt;- NULL</span></span>
<span id="cb194-4547"><a href="#cb194-4547" aria-hidden="true" tabindex="-1"></a><span class="in">      best_inner_vars &lt;- current_vars</span></span>
<span id="cb194-4548"><a href="#cb194-4548" aria-hidden="true" tabindex="-1"></a><span class="in">      improved &lt;- TRUE</span></span>
<span id="cb194-4549"><a href="#cb194-4549" aria-hidden="true" tabindex="-1"></a><span class="in">      </span></span>
<span id="cb194-4550"><a href="#cb194-4550" aria-hidden="true" tabindex="-1"></a><span class="in">      while (improved &amp;&amp; length(current_vars) &gt; 1) {</span></span>
<span id="cb194-4551"><a href="#cb194-4551" aria-hidden="true" tabindex="-1"></a><span class="in">        improved &lt;- FALSE</span></span>
<span id="cb194-4552"><a href="#cb194-4552" aria-hidden="true" tabindex="-1"></a><span class="in">        best_auc_in_step &lt;- best_inner_auc</span></span>
<span id="cb194-4553"><a href="#cb194-4553" aria-hidden="true" tabindex="-1"></a><span class="in">        </span></span>
<span id="cb194-4554"><a href="#cb194-4554" aria-hidden="true" tabindex="-1"></a><span class="in">        for (var in current_vars) {</span></span>
<span id="cb194-4555"><a href="#cb194-4555" aria-hidden="true" tabindex="-1"></a><span class="in">          temp_vars &lt;- setdiff(current_vars, var)</span></span>
<span id="cb194-4556"><a href="#cb194-4556" aria-hidden="true" tabindex="-1"></a><span class="in">          inner_auc &lt;- numeric()</span></span>
<span id="cb194-4557"><a href="#cb194-4557" aria-hidden="true" tabindex="-1"></a><span class="in">          </span></span>
<span id="cb194-4558"><a href="#cb194-4558" aria-hidden="true" tabindex="-1"></a><span class="in">          for (params in 1:nrow(grid)) {</span></span>
<span id="cb194-4559"><a href="#cb194-4559" aria-hidden="true" tabindex="-1"></a><span class="in">            auc_vals &lt;- numeric()</span></span>
<span id="cb194-4560"><a href="#cb194-4560" aria-hidden="true" tabindex="-1"></a><span class="in">            </span></span>
<span id="cb194-4561"><a href="#cb194-4561" aria-hidden="true" tabindex="-1"></a><span class="in">            for (inner_index in seq_along(inner_folds)) {</span></span>
<span id="cb194-4562"><a href="#cb194-4562" aria-hidden="true" tabindex="-1"></a><span class="in">              inner_train_data &lt;- outer_train_data[-inner_folds[[inner_index]], ]</span></span>
<span id="cb194-4563"><a href="#cb194-4563" aria-hidden="true" tabindex="-1"></a><span class="in">              inner_test_data &lt;- outer_train_data[inner_folds[[inner_index]], ]</span></span>
<span id="cb194-4564"><a href="#cb194-4564" aria-hidden="true" tabindex="-1"></a><span class="in">              </span></span>
<span id="cb194-4565"><a href="#cb194-4565" aria-hidden="true" tabindex="-1"></a><span class="in">              result &lt;- tryCatch({</span></span>
<span id="cb194-4566"><a href="#cb194-4566" aria-hidden="true" tabindex="-1"></a><span class="in">                model &lt;- nnet(as.formula(paste(target_name, "~", paste(temp_vars, collapse = "+"))),</span></span>
<span id="cb194-4567"><a href="#cb194-4567" aria-hidden="true" tabindex="-1"></a><span class="in">                              data = inner_train_data, size = grid$size[params], decay = grid$decay[params], </span></span>
<span id="cb194-4568"><a href="#cb194-4568" aria-hidden="true" tabindex="-1"></a><span class="in">                              linout = FALSE, maxit = 200, trace = FALSE)</span></span>
<span id="cb194-4569"><a href="#cb194-4569" aria-hidden="true" tabindex="-1"></a><span class="in">                </span></span>
<span id="cb194-4570"><a href="#cb194-4570" aria-hidden="true" tabindex="-1"></a><span class="in">                predictions &lt;- predict(model, inner_test_data, type = "raw")</span></span>
<span id="cb194-4571"><a href="#cb194-4571" aria-hidden="true" tabindex="-1"></a><span class="in">                roc_curve &lt;- roc(inner_test_data[[target_name]], predictions)</span></span>
<span id="cb194-4572"><a href="#cb194-4572" aria-hidden="true" tabindex="-1"></a><span class="in">                auc_vals[inner_index] &lt;- roc_curve$auc</span></span>
<span id="cb194-4573"><a href="#cb194-4573" aria-hidden="true" tabindex="-1"></a><span class="in">                </span></span>
<span id="cb194-4574"><a href="#cb194-4574" aria-hidden="true" tabindex="-1"></a><span class="in">                # Guardar los datos del inner fold</span></span>
<span id="cb194-4575"><a href="#cb194-4575" aria-hidden="true" tabindex="-1"></a><span class="in">                pred_class &lt;- ifelse(predictions &gt; threshold, 1, 0)</span></span>
<span id="cb194-4576"><a href="#cb194-4576" aria-hidden="true" tabindex="-1"></a><span class="in">                confusion &lt;- table(Actual = inner_test_data[[target_name]], Predicted = pred_class)</span></span>
<span id="cb194-4577"><a href="#cb194-4577" aria-hidden="true" tabindex="-1"></a><span class="in">                TP &lt;- ifelse(nrow(confusion) &gt;= 2 &amp;&amp; ncol(confusion) &gt;= 2, confusion[2, 2], 0)</span></span>
<span id="cb194-4578"><a href="#cb194-4578" aria-hidden="true" tabindex="-1"></a><span class="in">                TN &lt;- ifelse(nrow(confusion) &gt;= 1 &amp;&amp; ncol(confusion) &gt;= 1, confusion[1, 1], 0)</span></span>
<span id="cb194-4579"><a href="#cb194-4579" aria-hidden="true" tabindex="-1"></a><span class="in">                FP &lt;- ifelse(nrow(confusion) &gt;= 1 &amp;&amp; ncol(confusion) &gt;= 2, confusion[1, 2], 0)</span></span>
<span id="cb194-4580"><a href="#cb194-4580" aria-hidden="true" tabindex="-1"></a><span class="in">                FN &lt;- ifelse(nrow(confusion) &gt;= 2 &amp;&amp; ncol(confusion) &gt;= 1, confusion[2, 1], 0)</span></span>
<span id="cb194-4581"><a href="#cb194-4581" aria-hidden="true" tabindex="-1"></a><span class="in">                auc &lt;- roc_curve$auc</span></span>
<span id="cb194-4582"><a href="#cb194-4582" aria-hidden="true" tabindex="-1"></a><span class="in">                inner_metrics &lt;- setNames(c(outer_index, inner_index, TP, TN, FP, FN, auc), names(inner_fold_metrics))</span></span>
<span id="cb194-4583"><a href="#cb194-4583" aria-hidden="true" tabindex="-1"></a><span class="in">                inner_fold_metrics &lt;&lt;- rbind(inner_fold_metrics, as.data.frame(t(inner_metrics)))</span></span>
<span id="cb194-4584"><a href="#cb194-4584" aria-hidden="true" tabindex="-1"></a><span class="in">              }, error = function(e) {</span></span>
<span id="cb194-4585"><a href="#cb194-4585" aria-hidden="true" tabindex="-1"></a><span class="in">                cat("Error with variables:", paste(temp_vars, collapse = ", "), "\n")</span></span>
<span id="cb194-4586"><a href="#cb194-4586" aria-hidden="true" tabindex="-1"></a><span class="in">                auc_vals[inner_index] &lt;- 0  # Set to NA or some other indicator of failure</span></span>
<span id="cb194-4587"><a href="#cb194-4587" aria-hidden="true" tabindex="-1"></a><span class="in">              })</span></span>
<span id="cb194-4588"><a href="#cb194-4588" aria-hidden="true" tabindex="-1"></a><span class="in">            }</span></span>
<span id="cb194-4589"><a href="#cb194-4589" aria-hidden="true" tabindex="-1"></a><span class="in">            </span></span>
<span id="cb194-4590"><a href="#cb194-4590" aria-hidden="true" tabindex="-1"></a><span class="in">            if (mean(auc_vals, na.rm = TRUE) &gt; best_auc_in_step) {</span></span>
<span id="cb194-4591"><a href="#cb194-4591" aria-hidden="true" tabindex="-1"></a><span class="in">              best_auc_in_step &lt;- mean(auc_vals, na.rm = TRUE)</span></span>
<span id="cb194-4592"><a href="#cb194-4592" aria-hidden="true" tabindex="-1"></a><span class="in">              best_inner_model &lt;- model</span></span>
<span id="cb194-4593"><a href="#cb194-4593" aria-hidden="true" tabindex="-1"></a><span class="in">              best_inner_size &lt;- grid$size[params]</span></span>
<span id="cb194-4594"><a href="#cb194-4594" aria-hidden="true" tabindex="-1"></a><span class="in">              best_inner_decay &lt;- grid$decay[params]</span></span>
<span id="cb194-4595"><a href="#cb194-4595" aria-hidden="true" tabindex="-1"></a><span class="in">              best_inner_vars &lt;- temp_vars</span></span>
<span id="cb194-4596"><a href="#cb194-4596" aria-hidden="true" tabindex="-1"></a><span class="in">              improved &lt;- TRUE</span></span>
<span id="cb194-4597"><a href="#cb194-4597" aria-hidden="true" tabindex="-1"></a><span class="in">            }</span></span>
<span id="cb194-4598"><a href="#cb194-4598" aria-hidden="true" tabindex="-1"></a><span class="in">          }</span></span>
<span id="cb194-4599"><a href="#cb194-4599" aria-hidden="true" tabindex="-1"></a><span class="in">        }</span></span>
<span id="cb194-4600"><a href="#cb194-4600" aria-hidden="true" tabindex="-1"></a><span class="in">        </span></span>
<span id="cb194-4601"><a href="#cb194-4601" aria-hidden="true" tabindex="-1"></a><span class="in">        if (improved) {</span></span>
<span id="cb194-4602"><a href="#cb194-4602" aria-hidden="true" tabindex="-1"></a><span class="in">          current_vars &lt;- best_inner_vars</span></span>
<span id="cb194-4603"><a href="#cb194-4603" aria-hidden="true" tabindex="-1"></a><span class="in">          best_inner_auc &lt;- best_auc_in_step</span></span>
<span id="cb194-4604"><a href="#cb194-4604" aria-hidden="true" tabindex="-1"></a><span class="in">          cat("Vars improved: ", paste(current_vars, collapse=", "), "\n")</span></span>
<span id="cb194-4605"><a href="#cb194-4605" aria-hidden="true" tabindex="-1"></a><span class="in">          cat("AUC: ", paste(best_inner_auc), "\n")</span></span>
<span id="cb194-4606"><a href="#cb194-4606" aria-hidden="true" tabindex="-1"></a><span class="in">        }</span></span>
<span id="cb194-4607"><a href="#cb194-4607" aria-hidden="true" tabindex="-1"></a><span class="in">      }</span></span>
<span id="cb194-4608"><a href="#cb194-4608" aria-hidden="true" tabindex="-1"></a><span class="in">      </span></span>
<span id="cb194-4609"><a href="#cb194-4609" aria-hidden="true" tabindex="-1"></a><span class="in">      list(model = best_inner_model, auc = best_inner_auc, </span></span>
<span id="cb194-4610"><a href="#cb194-4610" aria-hidden="true" tabindex="-1"></a><span class="in">           size = best_inner_size, decay = best_inner_decay, </span></span>
<span id="cb194-4611"><a href="#cb194-4611" aria-hidden="true" tabindex="-1"></a><span class="in">           vars = best_inner_vars)</span></span>
<span id="cb194-4612"><a href="#cb194-4612" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb194-4613"><a href="#cb194-4613" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-4614"><a href="#cb194-4614" aria-hidden="true" tabindex="-1"></a><span class="in">    best_result &lt;- stepAUC(variables, outer_train_data, target_name, grid, inner_folds)</span></span>
<span id="cb194-4615"><a href="#cb194-4615" aria-hidden="true" tabindex="-1"></a><span class="in">    best_auc &lt;- best_result$auc</span></span>
<span id="cb194-4616"><a href="#cb194-4616" aria-hidden="true" tabindex="-1"></a><span class="in">    best_size &lt;- best_result$size</span></span>
<span id="cb194-4617"><a href="#cb194-4617" aria-hidden="true" tabindex="-1"></a><span class="in">    best_decay &lt;- best_result$decay</span></span>
<span id="cb194-4618"><a href="#cb194-4618" aria-hidden="true" tabindex="-1"></a><span class="in">    best_vars &lt;- best_result$vars</span></span>
<span id="cb194-4619"><a href="#cb194-4619" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-4620"><a href="#cb194-4620" aria-hidden="true" tabindex="-1"></a><span class="in">    # Reentrenar el mejor modelo con todos los datos de outer_train_data</span></span>
<span id="cb194-4621"><a href="#cb194-4621" aria-hidden="true" tabindex="-1"></a><span class="in">    best_model &lt;- nnet(as.formula(paste(target_name, "~", paste(best_vars, collapse = "+"))),</span></span>
<span id="cb194-4622"><a href="#cb194-4622" aria-hidden="true" tabindex="-1"></a><span class="in">                       data = outer_train_data, size = best_size, decay = best_decay, </span></span>
<span id="cb194-4623"><a href="#cb194-4623" aria-hidden="true" tabindex="-1"></a><span class="in">                       linout = FALSE, maxit = 200, trace = FALSE)</span></span>
<span id="cb194-4624"><a href="#cb194-4624" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-4625"><a href="#cb194-4625" aria-hidden="true" tabindex="-1"></a><span class="in">    predictions &lt;- predict(best_model, outer_test_data, type = "raw")</span></span>
<span id="cb194-4626"><a href="#cb194-4626" aria-hidden="true" tabindex="-1"></a><span class="in">    pred_class &lt;- ifelse(predictions &gt; threshold, 1, 0)  # Asignar clases basadas en umbral</span></span>
<span id="cb194-4627"><a href="#cb194-4627" aria-hidden="true" tabindex="-1"></a><span class="in">    confusion &lt;- table(Actual = outer_test_data[[target_name]], Predicted = pred_class)</span></span>
<span id="cb194-4628"><a href="#cb194-4628" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-4629"><a href="#cb194-4629" aria-hidden="true" tabindex="-1"></a><span class="in">    if (nrow(confusion) &lt; 2 || ncol(confusion) &lt; 2) {</span></span>
<span id="cb194-4630"><a href="#cb194-4630" aria-hidden="true" tabindex="-1"></a><span class="in">      TP &lt;- ifelse(nrow(confusion) &gt;= 2 &amp;&amp; ncol(confusion) &gt;= 2, confusion[2, 2], 0)</span></span>
<span id="cb194-4631"><a href="#cb194-4631" aria-hidden="true" tabindex="-1"></a><span class="in">      TN &lt;- ifelse(nrow(confusion) &gt;= 1 &amp;&amp; ncol(confusion) &gt;= 1, confusion[1, 1], 0)</span></span>
<span id="cb194-4632"><a href="#cb194-4632" aria-hidden="true" tabindex="-1"></a><span class="in">      FP &lt;- ifelse(nrow(confusion) &gt;= 1 &amp;&amp; ncol(confusion) &gt;= 2, confusion[1, 2], 0)</span></span>
<span id="cb194-4633"><a href="#cb194-4633" aria-hidden="true" tabindex="-1"></a><span class="in">      FN &lt;- ifelse(nrow(confusion) &gt;= 2 &amp;&amp; ncol(confusion) &gt;= 1, confusion[2, 1], 0)</span></span>
<span id="cb194-4634"><a href="#cb194-4634" aria-hidden="true" tabindex="-1"></a><span class="in">    } else {</span></span>
<span id="cb194-4635"><a href="#cb194-4635" aria-hidden="true" tabindex="-1"></a><span class="in">      TP &lt;- confusion[2, 2]</span></span>
<span id="cb194-4636"><a href="#cb194-4636" aria-hidden="true" tabindex="-1"></a><span class="in">      TN &lt;- confusion[1, 1]</span></span>
<span id="cb194-4637"><a href="#cb194-4637" aria-hidden="true" tabindex="-1"></a><span class="in">      FP &lt;- confusion[1, 2]</span></span>
<span id="cb194-4638"><a href="#cb194-4638" aria-hidden="true" tabindex="-1"></a><span class="in">      FN &lt;- confusion[2, 1]</span></span>
<span id="cb194-4639"><a href="#cb194-4639" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb194-4640"><a href="#cb194-4640" aria-hidden="true" tabindex="-1"></a><span class="in">    auc = roc(outer_test_data[[target_name]], predictions)$auc</span></span>
<span id="cb194-4641"><a href="#cb194-4641" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-4642"><a href="#cb194-4642" aria-hidden="true" tabindex="-1"></a><span class="in">    metrics &lt;- setNames(c(outer_index, TP, TN, FP, FN, auc, </span></span>
<span id="cb194-4643"><a href="#cb194-4643" aria-hidden="true" tabindex="-1"></a><span class="in">                          best_size, best_decay, paste(best_vars, collapse = ",")), </span></span>
<span id="cb194-4644"><a href="#cb194-4644" aria-hidden="true" tabindex="-1"></a><span class="in">                        names(performance_metrics))</span></span>
<span id="cb194-4645"><a href="#cb194-4645" aria-hidden="true" tabindex="-1"></a><span class="in">    performance_metrics &lt;- rbind(performance_metrics, as.data.frame(t(metrics)))</span></span>
<span id="cb194-4646"><a href="#cb194-4646" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-4647"><a href="#cb194-4647" aria-hidden="true" tabindex="-1"></a><span class="in">    cat("Performance:", paste(performance_metrics))</span></span>
<span id="cb194-4648"><a href="#cb194-4648" aria-hidden="true" tabindex="-1"></a><span class="in">    cat(sprintf("Confusion Matrix for Fold %d:\n", outer_index))</span></span>
<span id="cb194-4649"><a href="#cb194-4649" aria-hidden="true" tabindex="-1"></a><span class="in">    print(confusion)</span></span>
<span id="cb194-4650"><a href="#cb194-4650" aria-hidden="true" tabindex="-1"></a><span class="in">    cat(sprintf("Metrics for Fold %d:\n", outer_index))</span></span>
<span id="cb194-4651"><a href="#cb194-4651" aria-hidden="true" tabindex="-1"></a><span class="in">    cat(sprintf("TP: %d, TN: %d, FP: %d, FN: %d, AUC: %f, Best Size: %d, Best Decay: %f, Best Variables: %s\n",</span></span>
<span id="cb194-4652"><a href="#cb194-4652" aria-hidden="true" tabindex="-1"></a><span class="in">                TP, TN, FP, FN, auc, best_size, best_decay, paste(best_vars, collapse = ",")))</span></span>
<span id="cb194-4653"><a href="#cb194-4653" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb194-4654"><a href="#cb194-4654" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb194-4655"><a href="#cb194-4655" aria-hidden="true" tabindex="-1"></a><span class="in">  list(performance_metrics = performance_metrics, inner_fold_metrics = inner_fold_metrics)</span></span>
<span id="cb194-4656"><a href="#cb194-4656" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb194-4657"><a href="#cb194-4657" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-4658"><a href="#cb194-4658" aria-hidden="true" tabindex="-1"></a><span class="in">evaluate_with_seeds_ANN_StepAUC &lt;- </span></span>
<span id="cb194-4659"><a href="#cb194-4659" aria-hidden="true" tabindex="-1"></a><span class="in">  function(evaluation_function, data, target_var, vars, threshold, seeds, outer, inner, sizes, decays) {</span></span>
<span id="cb194-4660"><a href="#cb194-4660" aria-hidden="true" tabindex="-1"></a><span class="in">  results_list &lt;- list()</span></span>
<span id="cb194-4661"><a href="#cb194-4661" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-4662"><a href="#cb194-4662" aria-hidden="true" tabindex="-1"></a><span class="in">  for (seed in seeds) {</span></span>
<span id="cb194-4663"><a href="#cb194-4663" aria-hidden="true" tabindex="-1"></a><span class="in">    set.seed(seed)</span></span>
<span id="cb194-4664"><a href="#cb194-4664" aria-hidden="true" tabindex="-1"></a><span class="in">    cat("Evaluating with seed:", seed, "\n")</span></span>
<span id="cb194-4665"><a href="#cb194-4665" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-4666"><a href="#cb194-4666" aria-hidden="true" tabindex="-1"></a><span class="in">    results &lt;- evaluation_function(data = data, </span></span>
<span id="cb194-4667"><a href="#cb194-4667" aria-hidden="true" tabindex="-1"></a><span class="in">                                   target_name = target_var, </span></span>
<span id="cb194-4668"><a href="#cb194-4668" aria-hidden="true" tabindex="-1"></a><span class="in">                                   variables = vars, </span></span>
<span id="cb194-4669"><a href="#cb194-4669" aria-hidden="true" tabindex="-1"></a><span class="in">                                   threshold = threshold, </span></span>
<span id="cb194-4670"><a href="#cb194-4670" aria-hidden="true" tabindex="-1"></a><span class="in">                                   outer = outer, </span></span>
<span id="cb194-4671"><a href="#cb194-4671" aria-hidden="true" tabindex="-1"></a><span class="in">                                   inner = inner, </span></span>
<span id="cb194-4672"><a href="#cb194-4672" aria-hidden="true" tabindex="-1"></a><span class="in">                                   seed = seed,</span></span>
<span id="cb194-4673"><a href="#cb194-4673" aria-hidden="true" tabindex="-1"></a><span class="in">                                   sizes = sizes,</span></span>
<span id="cb194-4674"><a href="#cb194-4674" aria-hidden="true" tabindex="-1"></a><span class="in">                                   decays = decays)</span></span>
<span id="cb194-4675"><a href="#cb194-4675" aria-hidden="true" tabindex="-1"></a><span class="in">    results_list[[paste0("seed_", seed)]] &lt;- results</span></span>
<span id="cb194-4676"><a href="#cb194-4676" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb194-4677"><a href="#cb194-4677" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-4678"><a href="#cb194-4678" aria-hidden="true" tabindex="-1"></a><span class="in">  return(results_list)</span></span>
<span id="cb194-4679"><a href="#cb194-4679" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb194-4680"><a href="#cb194-4680" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-4681"><a href="#cb194-4681" aria-hidden="true" tabindex="-1"></a><span class="in">performance_ANN_stepAUC &lt;- evaluate_with_seeds_ANN_StepAUC(</span></span>
<span id="cb194-4682"><a href="#cb194-4682" aria-hidden="true" tabindex="-1"></a><span class="in">  evaluation_function = double_cross_validation_nnet_stepAUC,</span></span>
<span id="cb194-4683"><a href="#cb194-4683" aria-hidden="true" tabindex="-1"></a><span class="in">  data = data_factor,</span></span>
<span id="cb194-4684"><a href="#cb194-4684" aria-hidden="true" tabindex="-1"></a><span class="in">  outer = 5,</span></span>
<span id="cb194-4685"><a href="#cb194-4685" aria-hidden="true" tabindex="-1"></a><span class="in">  inner = 2,</span></span>
<span id="cb194-4686"><a href="#cb194-4686" aria-hidden="true" tabindex="-1"></a><span class="in">  target_var = "PCR",</span></span>
<span id="cb194-4687"><a href="#cb194-4687" aria-hidden="true" tabindex="-1"></a><span class="in">  sizes = c(5,10,15,20,25,30),</span></span>
<span id="cb194-4688"><a href="#cb194-4688" aria-hidden="true" tabindex="-1"></a><span class="in">  decays = c(0.1, 0.2, 0.3, 0.4),</span></span>
<span id="cb194-4689"><a href="#cb194-4689" aria-hidden="true" tabindex="-1"></a><span class="in">  vars = todas_variables_factor,</span></span>
<span id="cb194-4690"><a href="#cb194-4690" aria-hidden="true" tabindex="-1"></a><span class="in">  threshold = .35,</span></span>
<span id="cb194-4691"><a href="#cb194-4691" aria-hidden="true" tabindex="-1"></a><span class="in">  seeds = seeds</span></span>
<span id="cb194-4692"><a href="#cb194-4692" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb194-4693"><a href="#cb194-4693" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-4694"><a href="#cb194-4694" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-4695"><a href="#cb194-4695" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message=FALSE, warning=FALSE}</span></span>
<span id="cb194-4696"><a href="#cb194-4696" aria-hidden="true" tabindex="-1"></a><span class="in">load("RData_Files_Algorithms/ANN_StepAUC.RData")</span></span>
<span id="cb194-4697"><a href="#cb194-4697" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-4698"><a href="#cb194-4698" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-4699"><a href="#cb194-4699" aria-hidden="true" tabindex="-1"></a><span class="fu">### Embedded (Lasso)</span></span>
<span id="cb194-4700"><a href="#cb194-4700" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-4701"><a href="#cb194-4701" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=FALSE}</span></span>
<span id="cb194-4702"><a href="#cb194-4702" aria-hidden="true" tabindex="-1"></a><span class="in">double_cross_validation_nnet_lasso &lt;- function(data, target_name, outer, inner, sizes, decays, threshold, seed) {</span></span>
<span id="cb194-4703"><a href="#cb194-4703" aria-hidden="true" tabindex="-1"></a><span class="in">  set.seed(seed)</span></span>
<span id="cb194-4704"><a href="#cb194-4704" aria-hidden="true" tabindex="-1"></a><span class="in">  performance_metrics &lt;- data.frame(Fold = integer(), TP = integer(), TN = integer(),</span></span>
<span id="cb194-4705"><a href="#cb194-4705" aria-hidden="true" tabindex="-1"></a><span class="in">                                    FP = integer(), FN = integer(), AUC = numeric(),</span></span>
<span id="cb194-4706"><a href="#cb194-4706" aria-hidden="true" tabindex="-1"></a><span class="in">                                    Best_Size = integer(), Best_Decay = numeric(), Best_Variables = character(), stringsAsFactors = FALSE)</span></span>
<span id="cb194-4707"><a href="#cb194-4707" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb194-4708"><a href="#cb194-4708" aria-hidden="true" tabindex="-1"></a><span class="in">  inner_fold_metrics &lt;- data.frame(Fold = integer(), Inner_Fold = integer(), </span></span>
<span id="cb194-4709"><a href="#cb194-4709" aria-hidden="true" tabindex="-1"></a><span class="in">                                   TP = integer(), TN = integer(), FP = integer(), </span></span>
<span id="cb194-4710"><a href="#cb194-4710" aria-hidden="true" tabindex="-1"></a><span class="in">                                   FN = integer(), AUC = numeric(), stringsAsFactors = FALSE)</span></span>
<span id="cb194-4711"><a href="#cb194-4711" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb194-4712"><a href="#cb194-4712" aria-hidden="true" tabindex="-1"></a><span class="in">  # Convertir las variables del dataset con model.matrix</span></span>
<span id="cb194-4713"><a href="#cb194-4713" aria-hidden="true" tabindex="-1"></a><span class="in">  target &lt;- as.numeric(data[[target_name]]) - 1</span></span>
<span id="cb194-4714"><a href="#cb194-4714" aria-hidden="true" tabindex="-1"></a><span class="in">  features &lt;- data[, setdiff(names(data), target_name)]</span></span>
<span id="cb194-4715"><a href="#cb194-4715" aria-hidden="true" tabindex="-1"></a><span class="in">  data_matrix &lt;- as.data.frame(model.matrix(~ ., data=features)[,-1])  # Eliminar el intercepto</span></span>
<span id="cb194-4716"><a href="#cb194-4716" aria-hidden="true" tabindex="-1"></a><span class="in">  data_matrix[[target_name]] &lt;- target</span></span>
<span id="cb194-4717"><a href="#cb194-4717" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb194-4718"><a href="#cb194-4718" aria-hidden="true" tabindex="-1"></a><span class="in">  outer_folds &lt;- createFolds(data_matrix[[target_name]], k = outer)</span></span>
<span id="cb194-4719"><a href="#cb194-4719" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb194-4720"><a href="#cb194-4720" aria-hidden="true" tabindex="-1"></a><span class="in">  for (outer_index in seq_along(outer_folds)) {</span></span>
<span id="cb194-4721"><a href="#cb194-4721" aria-hidden="true" tabindex="-1"></a><span class="in">    outer_train_data &lt;- data_matrix[-outer_folds[[outer_index]], ]</span></span>
<span id="cb194-4722"><a href="#cb194-4722" aria-hidden="true" tabindex="-1"></a><span class="in">    outer_test_data &lt;- data_matrix[outer_folds[[outer_index]], ]</span></span>
<span id="cb194-4723"><a href="#cb194-4723" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-4724"><a href="#cb194-4724" aria-hidden="true" tabindex="-1"></a><span class="in">    cat(sprintf("Outer Fold %d\n", outer_index))</span></span>
<span id="cb194-4725"><a href="#cb194-4725" aria-hidden="true" tabindex="-1"></a><span class="in">    cat("Training Data - Class 0: ", sum(outer_train_data[[target_name]] == 0), "\n")</span></span>
<span id="cb194-4726"><a href="#cb194-4726" aria-hidden="true" tabindex="-1"></a><span class="in">    cat("Training Data - Class 1: ", sum(outer_train_data[[target_name]] == 1), "\n")</span></span>
<span id="cb194-4727"><a href="#cb194-4727" aria-hidden="true" tabindex="-1"></a><span class="in">    cat("Testing Data - Class 0: ", sum(outer_test_data[[target_name]] == 0), "\n")</span></span>
<span id="cb194-4728"><a href="#cb194-4728" aria-hidden="true" tabindex="-1"></a><span class="in">    cat("Testing Data - Class 1: ", sum(outer_test_data[[target_name]] == 1), "\n")</span></span>
<span id="cb194-4729"><a href="#cb194-4729" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-4730"><a href="#cb194-4730" aria-hidden="true" tabindex="-1"></a><span class="in">    inner_folds &lt;- createFolds(outer_train_data[[target_name]], k = inner)</span></span>
<span id="cb194-4731"><a href="#cb194-4731" aria-hidden="true" tabindex="-1"></a><span class="in">    best_model &lt;- NULL</span></span>
<span id="cb194-4732"><a href="#cb194-4732" aria-hidden="true" tabindex="-1"></a><span class="in">    best_auc &lt;- 0</span></span>
<span id="cb194-4733"><a href="#cb194-4733" aria-hidden="true" tabindex="-1"></a><span class="in">    best_size &lt;- NULL</span></span>
<span id="cb194-4734"><a href="#cb194-4734" aria-hidden="true" tabindex="-1"></a><span class="in">    best_decay &lt;- NULL</span></span>
<span id="cb194-4735"><a href="#cb194-4735" aria-hidden="true" tabindex="-1"></a><span class="in">    best_vars &lt;- colnames(outer_train_data)[!colnames(outer_train_data) %in% target_name]</span></span>
<span id="cb194-4736"><a href="#cb194-4736" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-4737"><a href="#cb194-4737" aria-hidden="true" tabindex="-1"></a><span class="in">    grid &lt;- expand.grid(size = sizes, decay = decays)</span></span>
<span id="cb194-4738"><a href="#cb194-4738" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-4739"><a href="#cb194-4739" aria-hidden="true" tabindex="-1"></a><span class="in">    select_vars_lasso &lt;- function(data, target_name) {</span></span>
<span id="cb194-4740"><a href="#cb194-4740" aria-hidden="true" tabindex="-1"></a><span class="in">      target &lt;- as.numeric(data[[target_name]])</span></span>
<span id="cb194-4741"><a href="#cb194-4741" aria-hidden="true" tabindex="-1"></a><span class="in">      features &lt;- data[, setdiff(names(data), target_name)]</span></span>
<span id="cb194-4742"><a href="#cb194-4742" aria-hidden="true" tabindex="-1"></a><span class="in">      X &lt;- model.matrix(~ ., data=features)[,-1]  # Eliminamos el intercepto</span></span>
<span id="cb194-4743"><a href="#cb194-4743" aria-hidden="true" tabindex="-1"></a><span class="in">      y &lt;- target</span></span>
<span id="cb194-4744"><a href="#cb194-4744" aria-hidden="true" tabindex="-1"></a><span class="in">      </span></span>
<span id="cb194-4745"><a href="#cb194-4745" aria-hidden="true" tabindex="-1"></a><span class="in">      # Ajustamos el modelo Lasso</span></span>
<span id="cb194-4746"><a href="#cb194-4746" aria-hidden="true" tabindex="-1"></a><span class="in">      lasso_model &lt;- cv.glmnet(X, y, alpha=1)</span></span>
<span id="cb194-4747"><a href="#cb194-4747" aria-hidden="true" tabindex="-1"></a><span class="in">      lasso_coef &lt;- coef(lasso_model, s = "lambda.min")</span></span>
<span id="cb194-4748"><a href="#cb194-4748" aria-hidden="true" tabindex="-1"></a><span class="in">      </span></span>
<span id="cb194-4749"><a href="#cb194-4749" aria-hidden="true" tabindex="-1"></a><span class="in">      # Seleccionamos las variables no nulas</span></span>
<span id="cb194-4750"><a href="#cb194-4750" aria-hidden="true" tabindex="-1"></a><span class="in">      selected_vars &lt;- rownames(lasso_coef)[lasso_coef[, 1] != 0]</span></span>
<span id="cb194-4751"><a href="#cb194-4751" aria-hidden="true" tabindex="-1"></a><span class="in">      selected_vars &lt;- setdiff(selected_vars, "(Intercept)")</span></span>
<span id="cb194-4752"><a href="#cb194-4752" aria-hidden="true" tabindex="-1"></a><span class="in">      cat("Selected variables by Lasso: ", paste(selected_vars, collapse=", "), "\n")</span></span>
<span id="cb194-4753"><a href="#cb194-4753" aria-hidden="true" tabindex="-1"></a><span class="in">      return(selected_vars)</span></span>
<span id="cb194-4754"><a href="#cb194-4754" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb194-4755"><a href="#cb194-4755" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-4756"><a href="#cb194-4756" aria-hidden="true" tabindex="-1"></a><span class="in">    stepAUC &lt;- function(vars, data, target_name, grid, inner_folds) {</span></span>
<span id="cb194-4757"><a href="#cb194-4757" aria-hidden="true" tabindex="-1"></a><span class="in">      best_inner_auc &lt;- 0</span></span>
<span id="cb194-4758"><a href="#cb194-4758" aria-hidden="true" tabindex="-1"></a><span class="in">      best_inner_model &lt;- NULL</span></span>
<span id="cb194-4759"><a href="#cb194-4759" aria-hidden="true" tabindex="-1"></a><span class="in">      best_inner_size &lt;- NULL</span></span>
<span id="cb194-4760"><a href="#cb194-4760" aria-hidden="true" tabindex="-1"></a><span class="in">      best_inner_decay &lt;- NULL</span></span>
<span id="cb194-4761"><a href="#cb194-4761" aria-hidden="true" tabindex="-1"></a><span class="in">      best_inner_vars &lt;- vars</span></span>
<span id="cb194-4762"><a href="#cb194-4762" aria-hidden="true" tabindex="-1"></a><span class="in">      improved &lt;- TRUE</span></span>
<span id="cb194-4763"><a href="#cb194-4763" aria-hidden="true" tabindex="-1"></a><span class="in">      </span></span>
<span id="cb194-4764"><a href="#cb194-4764" aria-hidden="true" tabindex="-1"></a><span class="in">      while (improved &amp;&amp; length(vars) &gt; 1) {</span></span>
<span id="cb194-4765"><a href="#cb194-4765" aria-hidden="true" tabindex="-1"></a><span class="in">        improved &lt;- FALSE</span></span>
<span id="cb194-4766"><a href="#cb194-4766" aria-hidden="true" tabindex="-1"></a><span class="in">        best_auc_in_step &lt;- best_inner_auc</span></span>
<span id="cb194-4767"><a href="#cb194-4767" aria-hidden="true" tabindex="-1"></a><span class="in">        </span></span>
<span id="cb194-4768"><a href="#cb194-4768" aria-hidden="true" tabindex="-1"></a><span class="in">        for (params in 1:nrow(grid)) {</span></span>
<span id="cb194-4769"><a href="#cb194-4769" aria-hidden="true" tabindex="-1"></a><span class="in">          auc_vals &lt;- numeric()</span></span>
<span id="cb194-4770"><a href="#cb194-4770" aria-hidden="true" tabindex="-1"></a><span class="in">          </span></span>
<span id="cb194-4771"><a href="#cb194-4771" aria-hidden="true" tabindex="-1"></a><span class="in">          for (inner_index in seq_along(inner_folds)) {</span></span>
<span id="cb194-4772"><a href="#cb194-4772" aria-hidden="true" tabindex="-1"></a><span class="in">            inner_train_data &lt;- outer_train_data[-inner_folds[[inner_index]], ]</span></span>
<span id="cb194-4773"><a href="#cb194-4773" aria-hidden="true" tabindex="-1"></a><span class="in">            inner_test_data &lt;- outer_train_data[inner_folds[[inner_index]], ]</span></span>
<span id="cb194-4774"><a href="#cb194-4774" aria-hidden="true" tabindex="-1"></a><span class="in">            </span></span>
<span id="cb194-4775"><a href="#cb194-4775" aria-hidden="true" tabindex="-1"></a><span class="in">            selected_vars &lt;- select_vars_lasso(inner_train_data, target_name)</span></span>
<span id="cb194-4776"><a href="#cb194-4776" aria-hidden="true" tabindex="-1"></a><span class="in">            formula &lt;- as.formula(paste(target_name, "~", paste(selected_vars, collapse = "+")))</span></span>
<span id="cb194-4777"><a href="#cb194-4777" aria-hidden="true" tabindex="-1"></a><span class="in">            #cat("Testing with formula: ", deparse(formula), "\n")</span></span>
<span id="cb194-4778"><a href="#cb194-4778" aria-hidden="true" tabindex="-1"></a><span class="in">            #cat("Grid parameters - size: ", grid$size[params], ", decay: ", grid$decay[params], "\n")</span></span>
<span id="cb194-4779"><a href="#cb194-4779" aria-hidden="true" tabindex="-1"></a><span class="in">            </span></span>
<span id="cb194-4780"><a href="#cb194-4780" aria-hidden="true" tabindex="-1"></a><span class="in">            result &lt;- tryCatch({</span></span>
<span id="cb194-4781"><a href="#cb194-4781" aria-hidden="true" tabindex="-1"></a><span class="in">              model &lt;- nnet(formula, data = inner_train_data, size = grid$size[params], </span></span>
<span id="cb194-4782"><a href="#cb194-4782" aria-hidden="true" tabindex="-1"></a><span class="in">                            decay = grid$decay[params], linout = FALSE, maxit = 200, trace = FALSE)</span></span>
<span id="cb194-4783"><a href="#cb194-4783" aria-hidden="true" tabindex="-1"></a><span class="in">              </span></span>
<span id="cb194-4784"><a href="#cb194-4784" aria-hidden="true" tabindex="-1"></a><span class="in">              predictions &lt;- predict(model, inner_test_data, type = "raw")</span></span>
<span id="cb194-4785"><a href="#cb194-4785" aria-hidden="true" tabindex="-1"></a><span class="in">              roc_curve &lt;- roc(inner_test_data[[target_name]], predictions)</span></span>
<span id="cb194-4786"><a href="#cb194-4786" aria-hidden="true" tabindex="-1"></a><span class="in">              auc_vals[inner_index] &lt;- roc_curve$auc</span></span>
<span id="cb194-4787"><a href="#cb194-4787" aria-hidden="true" tabindex="-1"></a><span class="in">              #cat("AUC for inner fold ", inner_index, ": ", roc_curve$auc, "\n")</span></span>
<span id="cb194-4788"><a href="#cb194-4788" aria-hidden="true" tabindex="-1"></a><span class="in">              </span></span>
<span id="cb194-4789"><a href="#cb194-4789" aria-hidden="true" tabindex="-1"></a><span class="in">            }, error = function(e) {</span></span>
<span id="cb194-4790"><a href="#cb194-4790" aria-hidden="true" tabindex="-1"></a><span class="in">              cat("Error with variables: ", paste(selected_vars, collapse = ", "), "\n")</span></span>
<span id="cb194-4791"><a href="#cb194-4791" aria-hidden="true" tabindex="-1"></a><span class="in">              cat("Error message: ", e$message, "\n")</span></span>
<span id="cb194-4792"><a href="#cb194-4792" aria-hidden="true" tabindex="-1"></a><span class="in">              auc_vals[inner_index] &lt;- NA  # Set to NA or some other indicator of failure</span></span>
<span id="cb194-4793"><a href="#cb194-4793" aria-hidden="true" tabindex="-1"></a><span class="in">            })</span></span>
<span id="cb194-4794"><a href="#cb194-4794" aria-hidden="true" tabindex="-1"></a><span class="in">          }</span></span>
<span id="cb194-4795"><a href="#cb194-4795" aria-hidden="true" tabindex="-1"></a><span class="in">          </span></span>
<span id="cb194-4796"><a href="#cb194-4796" aria-hidden="true" tabindex="-1"></a><span class="in">          mean_auc &lt;- mean(auc_vals, na.rm = TRUE)</span></span>
<span id="cb194-4797"><a href="#cb194-4797" aria-hidden="true" tabindex="-1"></a><span class="in">          #cat("Mean AUC for params - size: ", grid$size[params], ", decay: ", grid$decay[params], ": ", mean_auc, "\n")</span></span>
<span id="cb194-4798"><a href="#cb194-4798" aria-hidden="true" tabindex="-1"></a><span class="in">          if (!is.na(mean_auc) &amp;&amp; mean_auc &gt; best_auc_in_step) {</span></span>
<span id="cb194-4799"><a href="#cb194-4799" aria-hidden="true" tabindex="-1"></a><span class="in">            best_auc_in_step &lt;- mean_auc</span></span>
<span id="cb194-4800"><a href="#cb194-4800" aria-hidden="true" tabindex="-1"></a><span class="in">            best_inner_model &lt;- model</span></span>
<span id="cb194-4801"><a href="#cb194-4801" aria-hidden="true" tabindex="-1"></a><span class="in">            best_inner_size &lt;- grid$size[params]</span></span>
<span id="cb194-4802"><a href="#cb194-4802" aria-hidden="true" tabindex="-1"></a><span class="in">            best_inner_decay &lt;- grid$decay[params]</span></span>
<span id="cb194-4803"><a href="#cb194-4803" aria-hidden="true" tabindex="-1"></a><span class="in">            best_inner_vars &lt;- selected_vars</span></span>
<span id="cb194-4804"><a href="#cb194-4804" aria-hidden="true" tabindex="-1"></a><span class="in">            improved &lt;- TRUE</span></span>
<span id="cb194-4805"><a href="#cb194-4805" aria-hidden="true" tabindex="-1"></a><span class="in">          }</span></span>
<span id="cb194-4806"><a href="#cb194-4806" aria-hidden="true" tabindex="-1"></a><span class="in">        }</span></span>
<span id="cb194-4807"><a href="#cb194-4807" aria-hidden="true" tabindex="-1"></a><span class="in">        </span></span>
<span id="cb194-4808"><a href="#cb194-4808" aria-hidden="true" tabindex="-1"></a><span class="in">        if (improved) {</span></span>
<span id="cb194-4809"><a href="#cb194-4809" aria-hidden="true" tabindex="-1"></a><span class="in">          vars &lt;- best_inner_vars</span></span>
<span id="cb194-4810"><a href="#cb194-4810" aria-hidden="true" tabindex="-1"></a><span class="in">          best_inner_auc &lt;- best_auc_in_step</span></span>
<span id="cb194-4811"><a href="#cb194-4811" aria-hidden="true" tabindex="-1"></a><span class="in">          cat("Vars improved: ", paste(vars, collapse=", "), "\n")</span></span>
<span id="cb194-4812"><a href="#cb194-4812" aria-hidden="true" tabindex="-1"></a><span class="in">          cat("AUC: ", best_inner_auc, "\n")</span></span>
<span id="cb194-4813"><a href="#cb194-4813" aria-hidden="true" tabindex="-1"></a><span class="in">        }</span></span>
<span id="cb194-4814"><a href="#cb194-4814" aria-hidden="true" tabindex="-1"></a><span class="in">      }</span></span>
<span id="cb194-4815"><a href="#cb194-4815" aria-hidden="true" tabindex="-1"></a><span class="in">      </span></span>
<span id="cb194-4816"><a href="#cb194-4816" aria-hidden="true" tabindex="-1"></a><span class="in">      list(model = best_inner_model, auc = best_inner_auc, </span></span>
<span id="cb194-4817"><a href="#cb194-4817" aria-hidden="true" tabindex="-1"></a><span class="in">           size = best_inner_size, decay = best_inner_decay, </span></span>
<span id="cb194-4818"><a href="#cb194-4818" aria-hidden="true" tabindex="-1"></a><span class="in">           vars = best_inner_vars)</span></span>
<span id="cb194-4819"><a href="#cb194-4819" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb194-4820"><a href="#cb194-4820" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-4821"><a href="#cb194-4821" aria-hidden="true" tabindex="-1"></a><span class="in">    best_result &lt;- stepAUC(best_vars, outer_train_data, target_name, grid, inner_folds)</span></span>
<span id="cb194-4822"><a href="#cb194-4822" aria-hidden="true" tabindex="-1"></a><span class="in">    best_model &lt;- best_result$model</span></span>
<span id="cb194-4823"><a href="#cb194-4823" aria-hidden="true" tabindex="-1"></a><span class="in">    best_auc &lt;- best_result$auc</span></span>
<span id="cb194-4824"><a href="#cb194-4824" aria-hidden="true" tabindex="-1"></a><span class="in">    best_size &lt;- best_result$size</span></span>
<span id="cb194-4825"><a href="#cb194-4825" aria-hidden="true" tabindex="-1"></a><span class="in">    best_decay &lt;- best_result$decay</span></span>
<span id="cb194-4826"><a href="#cb194-4826" aria-hidden="true" tabindex="-1"></a><span class="in">    best_vars &lt;- best_result$vars</span></span>
<span id="cb194-4827"><a href="#cb194-4827" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-4828"><a href="#cb194-4828" aria-hidden="true" tabindex="-1"></a><span class="in">    if (is.null(best_model)) {</span></span>
<span id="cb194-4829"><a href="#cb194-4829" aria-hidden="true" tabindex="-1"></a><span class="in">      cat("Error: No valid model found for outer fold ", outer_index, "\n")</span></span>
<span id="cb194-4830"><a href="#cb194-4830" aria-hidden="true" tabindex="-1"></a><span class="in">      next</span></span>
<span id="cb194-4831"><a href="#cb194-4831" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb194-4832"><a href="#cb194-4832" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-4833"><a href="#cb194-4833" aria-hidden="true" tabindex="-1"></a><span class="in">    # Evaluar el mejor modelo en el validation split del inner loop</span></span>
<span id="cb194-4834"><a href="#cb194-4834" aria-hidden="true" tabindex="-1"></a><span class="in">    inner_auc_vals &lt;- numeric()</span></span>
<span id="cb194-4835"><a href="#cb194-4835" aria-hidden="true" tabindex="-1"></a><span class="in">    for (inner_index in seq_along(inner_folds)) {</span></span>
<span id="cb194-4836"><a href="#cb194-4836" aria-hidden="true" tabindex="-1"></a><span class="in">      inner_train_data &lt;- outer_train_data[-inner_folds[[inner_index]], ]</span></span>
<span id="cb194-4837"><a href="#cb194-4837" aria-hidden="true" tabindex="-1"></a><span class="in">      inner_test_data &lt;- outer_train_data[inner_folds[[inner_index]], ]</span></span>
<span id="cb194-4838"><a href="#cb194-4838" aria-hidden="true" tabindex="-1"></a><span class="in">      </span></span>
<span id="cb194-4839"><a href="#cb194-4839" aria-hidden="true" tabindex="-1"></a><span class="in">      predictions &lt;- predict(best_model, inner_test_data, type = "raw")</span></span>
<span id="cb194-4840"><a href="#cb194-4840" aria-hidden="true" tabindex="-1"></a><span class="in">      roc_curve &lt;- roc(inner_test_data[[target_name]], predictions)</span></span>
<span id="cb194-4841"><a href="#cb194-4841" aria-hidden="true" tabindex="-1"></a><span class="in">      inner_auc_vals[inner_index] &lt;- roc_curve$auc</span></span>
<span id="cb194-4842"><a href="#cb194-4842" aria-hidden="true" tabindex="-1"></a><span class="in">      #cat("Inner fold ", inner_index, " AUC: ", roc_curve$auc, "\n")</span></span>
<span id="cb194-4843"><a href="#cb194-4843" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-4844"><a href="#cb194-4844" aria-hidden="true" tabindex="-1"></a><span class="in">      pred_class &lt;- ifelse(predictions &gt; threshold, 1, 0)</span></span>
<span id="cb194-4845"><a href="#cb194-4845" aria-hidden="true" tabindex="-1"></a><span class="in">      confusion &lt;- table(Actual = inner_test_data[[target_name]], Predicted = pred_class)</span></span>
<span id="cb194-4846"><a href="#cb194-4846" aria-hidden="true" tabindex="-1"></a><span class="in">      TP &lt;- ifelse(nrow(confusion) &gt;= 2 &amp;&amp; ncol(confusion) &gt;= 2, confusion[2, 2], 0)</span></span>
<span id="cb194-4847"><a href="#cb194-4847" aria-hidden="true" tabindex="-1"></a><span class="in">      TN &lt;- ifelse(nrow(confusion) &gt;= 1 &amp;&amp; ncol(confusion) &gt;= 1, confusion[1, 1], 0)</span></span>
<span id="cb194-4848"><a href="#cb194-4848" aria-hidden="true" tabindex="-1"></a><span class="in">      FP &lt;- ifelse(nrow(confusion) &gt;= 1 &amp;&amp; ncol(confusion) &gt;= 2, confusion[1, 2], 0)</span></span>
<span id="cb194-4849"><a href="#cb194-4849" aria-hidden="true" tabindex="-1"></a><span class="in">      FN &lt;- ifelse(nrow(confusion) &gt;= 2 &amp;&amp; ncol(confusion) &gt;= 1, confusion[2, 1], 0)</span></span>
<span id="cb194-4850"><a href="#cb194-4850" aria-hidden="true" tabindex="-1"></a><span class="in">      auc &lt;- roc_curve$auc</span></span>
<span id="cb194-4851"><a href="#cb194-4851" aria-hidden="true" tabindex="-1"></a><span class="in">      </span></span>
<span id="cb194-4852"><a href="#cb194-4852" aria-hidden="true" tabindex="-1"></a><span class="in">      inner_metrics &lt;- setNames(c(outer_index, inner_index, TP, TN, FP, FN, auc), names(inner_fold_metrics))</span></span>
<span id="cb194-4853"><a href="#cb194-4853" aria-hidden="true" tabindex="-1"></a><span class="in">      inner_fold_metrics &lt;- rbind(inner_fold_metrics, as.data.frame(t(inner_metrics)))</span></span>
<span id="cb194-4854"><a href="#cb194-4854" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb194-4855"><a href="#cb194-4855" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-4856"><a href="#cb194-4856" aria-hidden="true" tabindex="-1"></a><span class="in">    best_inner_auc &lt;- mean(inner_auc_vals, na.rm = TRUE)</span></span>
<span id="cb194-4857"><a href="#cb194-4857" aria-hidden="true" tabindex="-1"></a><span class="in">    #cat("Best inner AUC: ", best_inner_auc, "\n")</span></span>
<span id="cb194-4858"><a href="#cb194-4858" aria-hidden="true" tabindex="-1"></a><span class="in">    # Reentrenar el mejor modelo con todos los datos de outer_train_data</span></span>
<span id="cb194-4859"><a href="#cb194-4859" aria-hidden="true" tabindex="-1"></a><span class="in">    best_model &lt;- nnet(as.formula(paste(target_name, "~", paste(best_vars, collapse = "+"))),</span></span>
<span id="cb194-4860"><a href="#cb194-4860" aria-hidden="true" tabindex="-1"></a><span class="in">                       data = outer_train_data, size = best_size, decay = best_decay, </span></span>
<span id="cb194-4861"><a href="#cb194-4861" aria-hidden="true" tabindex="-1"></a><span class="in">                       linout = FALSE, maxit = 200, trace = FALSE)</span></span>
<span id="cb194-4862"><a href="#cb194-4862" aria-hidden="true" tabindex="-1"></a><span class="in">    predictions &lt;- predict(best_model, outer_test_data, type = "raw")</span></span>
<span id="cb194-4863"><a href="#cb194-4863" aria-hidden="true" tabindex="-1"></a><span class="in">    pred_class &lt;- ifelse(predictions &gt; threshold, 1, 0)  # Asignar clases basadas en umbral</span></span>
<span id="cb194-4864"><a href="#cb194-4864" aria-hidden="true" tabindex="-1"></a><span class="in">    confusion &lt;- table(Actual = outer_test_data[[target_name]], Predicted = pred_class)</span></span>
<span id="cb194-4865"><a href="#cb194-4865" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-4866"><a href="#cb194-4866" aria-hidden="true" tabindex="-1"></a><span class="in">    if (nrow(confusion) &lt; 2 || ncol(confusion) &lt; 2) {</span></span>
<span id="cb194-4867"><a href="#cb194-4867" aria-hidden="true" tabindex="-1"></a><span class="in">      TP &lt;- ifelse(nrow(confusion) &gt;= 2 &amp;&amp; ncol(confusion) &gt;= 2, confusion[2, 2], 0)</span></span>
<span id="cb194-4868"><a href="#cb194-4868" aria-hidden="true" tabindex="-1"></a><span class="in">      TN &lt;- ifelse(nrow(confusion) &gt;= 1 &amp;&amp; ncol(confusion) &gt;= 1, confusion[1, 1], 0)</span></span>
<span id="cb194-4869"><a href="#cb194-4869" aria-hidden="true" tabindex="-1"></a><span class="in">      FP &lt;- ifelse(nrow(confusion) &gt;= 1 &amp;&amp; ncol(confusion) &gt;= 2, confusion[1, 2], 0)</span></span>
<span id="cb194-4870"><a href="#cb194-4870" aria-hidden="true" tabindex="-1"></a><span class="in">      FN &lt;- ifelse(nrow(confusion) &gt;= 2 &amp;&amp; ncol(confusion) &gt;= 1, confusion[2, 1], 0)</span></span>
<span id="cb194-4871"><a href="#cb194-4871" aria-hidden="true" tabindex="-1"></a><span class="in">    } else {</span></span>
<span id="cb194-4872"><a href="#cb194-4872" aria-hidden="true" tabindex="-1"></a><span class="in">      TP &lt;- confusion[2, 2]</span></span>
<span id="cb194-4873"><a href="#cb194-4873" aria-hidden="true" tabindex="-1"></a><span class="in">      TN &lt;- confusion[1, 1]</span></span>
<span id="cb194-4874"><a href="#cb194-4874" aria-hidden="true" tabindex="-1"></a><span class="in">      FP &lt;- confusion[1, 2]</span></span>
<span id="cb194-4875"><a href="#cb194-4875" aria-hidden="true" tabindex="-1"></a><span class="in">      FN &lt;- confusion[2, 1]</span></span>
<span id="cb194-4876"><a href="#cb194-4876" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb194-4877"><a href="#cb194-4877" aria-hidden="true" tabindex="-1"></a><span class="in">    auc &lt;- roc(outer_test_data[[target_name]], predictions)$auc</span></span>
<span id="cb194-4878"><a href="#cb194-4878" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-4879"><a href="#cb194-4879" aria-hidden="true" tabindex="-1"></a><span class="in">    metrics &lt;- setNames(c(outer_index, TP, TN, FP, FN, auc, </span></span>
<span id="cb194-4880"><a href="#cb194-4880" aria-hidden="true" tabindex="-1"></a><span class="in">                          best_size, best_decay, paste(best_vars, collapse = ",")), </span></span>
<span id="cb194-4881"><a href="#cb194-4881" aria-hidden="true" tabindex="-1"></a><span class="in">                        names(performance_metrics))</span></span>
<span id="cb194-4882"><a href="#cb194-4882" aria-hidden="true" tabindex="-1"></a><span class="in">    performance_metrics &lt;- rbind(performance_metrics, as.data.frame(t(metrics)))</span></span>
<span id="cb194-4883"><a href="#cb194-4883" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-4884"><a href="#cb194-4884" aria-hidden="true" tabindex="-1"></a><span class="in">    cat("Performance:\n", paste(performance_metrics), "\n")</span></span>
<span id="cb194-4885"><a href="#cb194-4885" aria-hidden="true" tabindex="-1"></a><span class="in">    cat(sprintf("Confusion Matrix for Fold %d:\n", outer_index))</span></span>
<span id="cb194-4886"><a href="#cb194-4886" aria-hidden="true" tabindex="-1"></a><span class="in">    print(confusion)</span></span>
<span id="cb194-4887"><a href="#cb194-4887" aria-hidden="true" tabindex="-1"></a><span class="in">    cat(sprintf("Metrics for Fold %d:\n", outer_index))</span></span>
<span id="cb194-4888"><a href="#cb194-4888" aria-hidden="true" tabindex="-1"></a><span class="in">    cat(sprintf("TP: %d, TN: %d, FP: %d, FN: %d, AUC: %f, Best Size: %d, Best Decay: %f, Best Variables: %s\n",</span></span>
<span id="cb194-4889"><a href="#cb194-4889" aria-hidden="true" tabindex="-1"></a><span class="in">                TP, TN, FP, FN, auc, best_size, best_decay, paste(best_vars, collapse = ",")))</span></span>
<span id="cb194-4890"><a href="#cb194-4890" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb194-4891"><a href="#cb194-4891" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb194-4892"><a href="#cb194-4892" aria-hidden="true" tabindex="-1"></a><span class="in">  list(performance_metrics = performance_metrics, inner_fold_metrics = inner_fold_metrics)</span></span>
<span id="cb194-4893"><a href="#cb194-4893" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb194-4894"><a href="#cb194-4894" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-4895"><a href="#cb194-4895" aria-hidden="true" tabindex="-1"></a><span class="in">evaluate_with_seeds_ANN_lasso &lt;- </span></span>
<span id="cb194-4896"><a href="#cb194-4896" aria-hidden="true" tabindex="-1"></a><span class="in">  function(evaluation_function, data, target_var, vars, threshold, seeds, outer, inner, sizes, decays) {</span></span>
<span id="cb194-4897"><a href="#cb194-4897" aria-hidden="true" tabindex="-1"></a><span class="in">  results_list &lt;- list()</span></span>
<span id="cb194-4898"><a href="#cb194-4898" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-4899"><a href="#cb194-4899" aria-hidden="true" tabindex="-1"></a><span class="in">  for (seed in seeds) {</span></span>
<span id="cb194-4900"><a href="#cb194-4900" aria-hidden="true" tabindex="-1"></a><span class="in">    set.seed(seed)</span></span>
<span id="cb194-4901"><a href="#cb194-4901" aria-hidden="true" tabindex="-1"></a><span class="in">    cat("Evaluating with seed:", seed, "\n")</span></span>
<span id="cb194-4902"><a href="#cb194-4902" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-4903"><a href="#cb194-4903" aria-hidden="true" tabindex="-1"></a><span class="in">    results &lt;- evaluation_function(data = data, </span></span>
<span id="cb194-4904"><a href="#cb194-4904" aria-hidden="true" tabindex="-1"></a><span class="in">                                   target_name = target_var, </span></span>
<span id="cb194-4905"><a href="#cb194-4905" aria-hidden="true" tabindex="-1"></a><span class="in">                                   threshold = threshold, </span></span>
<span id="cb194-4906"><a href="#cb194-4906" aria-hidden="true" tabindex="-1"></a><span class="in">                                   outer = outer, </span></span>
<span id="cb194-4907"><a href="#cb194-4907" aria-hidden="true" tabindex="-1"></a><span class="in">                                   inner = inner, </span></span>
<span id="cb194-4908"><a href="#cb194-4908" aria-hidden="true" tabindex="-1"></a><span class="in">                                   seed = seed,</span></span>
<span id="cb194-4909"><a href="#cb194-4909" aria-hidden="true" tabindex="-1"></a><span class="in">                                   sizes = sizes,</span></span>
<span id="cb194-4910"><a href="#cb194-4910" aria-hidden="true" tabindex="-1"></a><span class="in">                                   decays = decays)</span></span>
<span id="cb194-4911"><a href="#cb194-4911" aria-hidden="true" tabindex="-1"></a><span class="in">    results_list[[paste0("seed_", seed)]] &lt;- results</span></span>
<span id="cb194-4912"><a href="#cb194-4912" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb194-4913"><a href="#cb194-4913" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-4914"><a href="#cb194-4914" aria-hidden="true" tabindex="-1"></a><span class="in">  return(results_list)</span></span>
<span id="cb194-4915"><a href="#cb194-4915" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb194-4916"><a href="#cb194-4916" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-4917"><a href="#cb194-4917" aria-hidden="true" tabindex="-1"></a><span class="in">performance_ANN_lasso &lt;- evaluate_with_seeds_ANN_lasso(</span></span>
<span id="cb194-4918"><a href="#cb194-4918" aria-hidden="true" tabindex="-1"></a><span class="in">  evaluation_function = double_cross_validation_nnet_lasso,</span></span>
<span id="cb194-4919"><a href="#cb194-4919" aria-hidden="true" tabindex="-1"></a><span class="in">  data = data_factor,</span></span>
<span id="cb194-4920"><a href="#cb194-4920" aria-hidden="true" tabindex="-1"></a><span class="in">  outer = 5,</span></span>
<span id="cb194-4921"><a href="#cb194-4921" aria-hidden="true" tabindex="-1"></a><span class="in">  inner = 2,</span></span>
<span id="cb194-4922"><a href="#cb194-4922" aria-hidden="true" tabindex="-1"></a><span class="in">  target_var = "PCR",</span></span>
<span id="cb194-4923"><a href="#cb194-4923" aria-hidden="true" tabindex="-1"></a><span class="in">  sizes = c(5,10,15,20,25,30),</span></span>
<span id="cb194-4924"><a href="#cb194-4924" aria-hidden="true" tabindex="-1"></a><span class="in">  decays = c(0.1, 0.2, 0.3, 0.4),</span></span>
<span id="cb194-4925"><a href="#cb194-4925" aria-hidden="true" tabindex="-1"></a><span class="in">  threshold = .35,</span></span>
<span id="cb194-4926"><a href="#cb194-4926" aria-hidden="true" tabindex="-1"></a><span class="in">  seeds = seeds</span></span>
<span id="cb194-4927"><a href="#cb194-4927" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb194-4928"><a href="#cb194-4928" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-4929"><a href="#cb194-4929" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-4930"><a href="#cb194-4930" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message=FALSE, warning=FALSE}</span></span>
<span id="cb194-4931"><a href="#cb194-4931" aria-hidden="true" tabindex="-1"></a><span class="in">load("RData_Files_Algorithms/ANN_Lasso.RData")</span></span>
<span id="cb194-4932"><a href="#cb194-4932" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-4933"><a href="#cb194-4933" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-4934"><a href="#cb194-4934" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-4935"><a href="#cb194-4935" aria-hidden="true" tabindex="-1"></a><span class="fu"># Discusión</span></span>
<span id="cb194-4936"><a href="#cb194-4936" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-4939"><a href="#cb194-4939" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb194-4940"><a href="#cb194-4940" aria-hidden="true" tabindex="-1"></a><span class="co">#  Función que combina los dataframes de métricas de rendimiento (performance_metrics) </span></span>
<span id="cb194-4941"><a href="#cb194-4941" aria-hidden="true" tabindex="-1"></a><span class="co"># e inner_fold_metrics de cada semilla en un solo dataframe, añadiendo una columna </span></span>
<span id="cb194-4942"><a href="#cb194-4942" aria-hidden="true" tabindex="-1"></a><span class="co"># "semilla" para diferenciar cada uno</span></span>
<span id="cb194-4943"><a href="#cb194-4943" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-4944"><a href="#cb194-4944" aria-hidden="true" tabindex="-1"></a>process_experiment_data <span class="ot">&lt;-</span> <span class="cf">function</span>(raw_data, hyperparameters) {</span>
<span id="cb194-4945"><a href="#cb194-4945" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Combinar performance_metrics en un solo dataframe</span></span>
<span id="cb194-4946"><a href="#cb194-4946" aria-hidden="true" tabindex="-1"></a>  performance_metrics <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb194-4947"><a href="#cb194-4947" aria-hidden="true" tabindex="-1"></a>    <span class="fu">lapply</span>(<span class="fu">names</span>(raw_data), <span class="cf">function</span>(seed) {</span>
<span id="cb194-4948"><a href="#cb194-4948" aria-hidden="true" tabindex="-1"></a>      df <span class="ot">&lt;-</span> raw_data[[seed]]<span class="sc">$</span>performance_metrics</span>
<span id="cb194-4949"><a href="#cb194-4949" aria-hidden="true" tabindex="-1"></a>      df<span class="sc">$</span>seed <span class="ot">&lt;-</span> seed</span>
<span id="cb194-4950"><a href="#cb194-4950" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(df)</span>
<span id="cb194-4951"><a href="#cb194-4951" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb194-4952"><a href="#cb194-4952" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb194-4953"><a href="#cb194-4953" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb194-4954"><a href="#cb194-4954" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Convertir las columnas relevantes a tipo numérico</span></span>
<span id="cb194-4955"><a href="#cb194-4955" aria-hidden="true" tabindex="-1"></a>  performance_metrics <span class="ot">&lt;-</span> performance_metrics <span class="sc">%&gt;%</span></span>
<span id="cb194-4956"><a href="#cb194-4956" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">AUC =</span> <span class="fu">as.numeric</span>(AUC),</span>
<span id="cb194-4957"><a href="#cb194-4957" aria-hidden="true" tabindex="-1"></a>           <span class="at">Fold =</span> <span class="fu">as.numeric</span>(Fold),</span>
<span id="cb194-4958"><a href="#cb194-4958" aria-hidden="true" tabindex="-1"></a>           <span class="at">TP =</span> <span class="fu">as.numeric</span>(TP),</span>
<span id="cb194-4959"><a href="#cb194-4959" aria-hidden="true" tabindex="-1"></a>           <span class="at">TN =</span> <span class="fu">as.numeric</span>(TN),</span>
<span id="cb194-4960"><a href="#cb194-4960" aria-hidden="true" tabindex="-1"></a>           <span class="at">FP =</span> <span class="fu">as.numeric</span>(FP),</span>
<span id="cb194-4961"><a href="#cb194-4961" aria-hidden="true" tabindex="-1"></a>           <span class="at">FN =</span> <span class="fu">as.numeric</span>(FN),</span>
<span id="cb194-4962"><a href="#cb194-4962" aria-hidden="true" tabindex="-1"></a>           <span class="at">Seed =</span> <span class="fu">as.factor</span>(seed))</span>
<span id="cb194-4963"><a href="#cb194-4963" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb194-4964"><a href="#cb194-4964" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Convertir los hiperparámetros relevantes a tipo numérico</span></span>
<span id="cb194-4965"><a href="#cb194-4965" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (param <span class="cf">in</span> hyperparameters) {</span>
<span id="cb194-4966"><a href="#cb194-4966" aria-hidden="true" tabindex="-1"></a>    performance_metrics[[param]] <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(performance_metrics[[param]])</span>
<span id="cb194-4967"><a href="#cb194-4967" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb194-4968"><a href="#cb194-4968" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb194-4969"><a href="#cb194-4969" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Combinar inner_fold_metrics en un solo dataframe</span></span>
<span id="cb194-4970"><a href="#cb194-4970" aria-hidden="true" tabindex="-1"></a>  inner_fold_metrics <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb194-4971"><a href="#cb194-4971" aria-hidden="true" tabindex="-1"></a>    <span class="fu">lapply</span>(<span class="fu">names</span>(raw_data), <span class="cf">function</span>(seed) {</span>
<span id="cb194-4972"><a href="#cb194-4972" aria-hidden="true" tabindex="-1"></a>      df <span class="ot">&lt;-</span> raw_data[[seed]]<span class="sc">$</span>inner_fold_metrics</span>
<span id="cb194-4973"><a href="#cb194-4973" aria-hidden="true" tabindex="-1"></a>      df<span class="sc">$</span>seed <span class="ot">&lt;-</span> seed</span>
<span id="cb194-4974"><a href="#cb194-4974" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(df)</span>
<span id="cb194-4975"><a href="#cb194-4975" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb194-4976"><a href="#cb194-4976" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb194-4977"><a href="#cb194-4977" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb194-4978"><a href="#cb194-4978" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Convertir las columnas relevantes a tipo numérico</span></span>
<span id="cb194-4979"><a href="#cb194-4979" aria-hidden="true" tabindex="-1"></a>  inner_fold_metrics <span class="ot">&lt;-</span> inner_fold_metrics <span class="sc">%&gt;%</span></span>
<span id="cb194-4980"><a href="#cb194-4980" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">AUC =</span> <span class="fu">as.numeric</span>(AUC),</span>
<span id="cb194-4981"><a href="#cb194-4981" aria-hidden="true" tabindex="-1"></a>           <span class="at">Fold =</span> <span class="fu">as.numeric</span>(Fold),</span>
<span id="cb194-4982"><a href="#cb194-4982" aria-hidden="true" tabindex="-1"></a>           <span class="at">Inner_Fold =</span> <span class="fu">as.numeric</span>(Inner_Fold),</span>
<span id="cb194-4983"><a href="#cb194-4983" aria-hidden="true" tabindex="-1"></a>           <span class="at">TP =</span> <span class="fu">as.numeric</span>(TP),</span>
<span id="cb194-4984"><a href="#cb194-4984" aria-hidden="true" tabindex="-1"></a>           <span class="at">TN =</span> <span class="fu">as.numeric</span>(TN),</span>
<span id="cb194-4985"><a href="#cb194-4985" aria-hidden="true" tabindex="-1"></a>           <span class="at">FP =</span> <span class="fu">as.numeric</span>(FP),</span>
<span id="cb194-4986"><a href="#cb194-4986" aria-hidden="true" tabindex="-1"></a>           <span class="at">FN =</span> <span class="fu">as.numeric</span>(FN),</span>
<span id="cb194-4987"><a href="#cb194-4987" aria-hidden="true" tabindex="-1"></a>           <span class="at">Seed =</span> <span class="fu">as.factor</span>(seed))</span>
<span id="cb194-4988"><a href="#cb194-4988" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb194-4989"><a href="#cb194-4989" aria-hidden="true" tabindex="-1"></a>  inner_fold_metrics<span class="sc">$</span>seed <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb194-4990"><a href="#cb194-4990" aria-hidden="true" tabindex="-1"></a>  performance_metrics<span class="sc">$</span>seed <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb194-4991"><a href="#cb194-4991" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb194-4992"><a href="#cb194-4992" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">performance_metrics =</span> performance_metrics, <span class="at">inner_fold_metrics =</span> inner_fold_metrics))</span>
<span id="cb194-4993"><a href="#cb194-4993" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb194-4994"><a href="#cb194-4994" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-4995"><a href="#cb194-4995" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-4996"><a href="#cb194-4996" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-4997"><a href="#cb194-4997" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-4998"><a href="#cb194-4998" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5001"><a href="#cb194-5001" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb194-5002"><a href="#cb194-5002" aria-hidden="true" tabindex="-1"></a><span class="co"># ANN</span></span>
<span id="cb194-5003"><a href="#cb194-5003" aria-hidden="true" tabindex="-1"></a>hyperparameters_ann <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Best_Size"</span>, <span class="st">"Best_Decay"</span>)</span>
<span id="cb194-5004"><a href="#cb194-5004" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5005"><a href="#cb194-5005" aria-hidden="true" tabindex="-1"></a>ANN_TodasVariables_Metrics <span class="ot">&lt;-</span> <span class="fu">process_experiment_data</span>(performance_ANN_todasvariables, hyperparameters_ann)</span>
<span id="cb194-5006"><a href="#cb194-5006" aria-hidden="true" tabindex="-1"></a>ANN_Asociacion_Metrics <span class="ot">&lt;-</span> <span class="fu">process_experiment_data</span>(performance_ANN_asociacion, hyperparameters_ann)</span>
<span id="cb194-5007"><a href="#cb194-5007" aria-hidden="true" tabindex="-1"></a>ANN_StepAUC_Metrics <span class="ot">&lt;-</span> <span class="fu">process_experiment_data</span>(performance_ANN_stepAUC, hyperparameters_ann)</span>
<span id="cb194-5008"><a href="#cb194-5008" aria-hidden="true" tabindex="-1"></a>ANN_Lasso_Metrics <span class="ot">&lt;-</span> <span class="fu">process_experiment_data</span>(performance_ANN_lasso, hyperparameters_ann)</span>
<span id="cb194-5009"><a href="#cb194-5009" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5010"><a href="#cb194-5010" aria-hidden="true" tabindex="-1"></a><span class="co"># SVM</span></span>
<span id="cb194-5011"><a href="#cb194-5011" aria-hidden="true" tabindex="-1"></a>hyperparameters_svm <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Best_Cost"</span>, <span class="st">"Best_Kernel"</span>)</span>
<span id="cb194-5012"><a href="#cb194-5012" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5013"><a href="#cb194-5013" aria-hidden="true" tabindex="-1"></a>SVM_TodasVariables_Metrics <span class="ot">&lt;-</span> <span class="fu">process_experiment_data</span>(performance_SVM_todasvariables, hyperparameters_svm)</span>
<span id="cb194-5014"><a href="#cb194-5014" aria-hidden="true" tabindex="-1"></a>SVM_Asociacion_Metrics <span class="ot">&lt;-</span> <span class="fu">process_experiment_data</span>(performance_svm_asociacion,hyperparameters_svm)</span>
<span id="cb194-5015"><a href="#cb194-5015" aria-hidden="true" tabindex="-1"></a>SVM_StepAUC_Metrics <span class="ot">&lt;-</span> <span class="fu">process_experiment_data</span>(performance_SVM_stepauc, hyperparameters_svm)</span>
<span id="cb194-5016"><a href="#cb194-5016" aria-hidden="true" tabindex="-1"></a>SVM_Lasso_Metrics <span class="ot">&lt;-</span> <span class="fu">process_experiment_data</span>(performance_SVM_lasso, hyperparameters_svm)</span>
<span id="cb194-5017"><a href="#cb194-5017" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5018"><a href="#cb194-5018" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5019"><a href="#cb194-5019" aria-hidden="true" tabindex="-1"></a><span class="co"># KNN</span></span>
<span id="cb194-5020"><a href="#cb194-5020" aria-hidden="true" tabindex="-1"></a>hyperparameters_knn <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Best_k"</span>, <span class="st">"Best_l"</span>)</span>
<span id="cb194-5021"><a href="#cb194-5021" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5022"><a href="#cb194-5022" aria-hidden="true" tabindex="-1"></a>KNN_TodasVariables_Metrics <span class="ot">&lt;-</span> <span class="fu">process_experiment_data</span>(performance_knn_todasvariables, hyperparameters_knn)</span>
<span id="cb194-5023"><a href="#cb194-5023" aria-hidden="true" tabindex="-1"></a>KNN_Asociacion_Metrics <span class="ot">&lt;-</span> <span class="fu">process_experiment_data</span>(performance_knn_Asociacion, hyperparameters_knn)</span>
<span id="cb194-5024"><a href="#cb194-5024" aria-hidden="true" tabindex="-1"></a>KNN_StepAUC_Metrics <span class="ot">&lt;-</span> <span class="fu">process_experiment_data</span>(performance_knn_stepauc, hyperparameters_knn)</span>
<span id="cb194-5025"><a href="#cb194-5025" aria-hidden="true" tabindex="-1"></a>KNN_Lasso_Metrics <span class="ot">&lt;-</span> <span class="fu">process_experiment_data</span>(performance_knn_lasso, hyperparameters_knn)</span>
<span id="cb194-5026"><a href="#cb194-5026" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5027"><a href="#cb194-5027" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5028"><a href="#cb194-5028" aria-hidden="true" tabindex="-1"></a><span class="co"># RandomForest</span></span>
<span id="cb194-5029"><a href="#cb194-5029" aria-hidden="true" tabindex="-1"></a>hyperparameters_RandomForest <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Best_ntree"</span>, <span class="st">"Best_mtry"</span>)</span>
<span id="cb194-5030"><a href="#cb194-5030" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5031"><a href="#cb194-5031" aria-hidden="true" tabindex="-1"></a>RandomForest_TodasVariables_Metrics <span class="ot">&lt;-</span> <span class="fu">process_experiment_data</span>(performance_RandomForest_todasvariables, hyperparameters_RandomForest)</span>
<span id="cb194-5032"><a href="#cb194-5032" aria-hidden="true" tabindex="-1"></a>RandomForest_Asociacion_Metrics <span class="ot">&lt;-</span> <span class="fu">process_experiment_data</span>(performance_RandomForest_Asociacion, hyperparameters_RandomForest)</span>
<span id="cb194-5033"><a href="#cb194-5033" aria-hidden="true" tabindex="-1"></a>RandomForest_StepAUC_Metrics <span class="ot">&lt;-</span> <span class="fu">process_experiment_data</span>(performance_RandomForest_StepAUC, <span class="fu">c</span>(<span class="st">"Best_Ntree"</span>, <span class="st">"Best_Mtry"</span>))</span>
<span id="cb194-5034"><a href="#cb194-5034" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5035"><a href="#cb194-5035" aria-hidden="true" tabindex="-1"></a>RandomForest_StepAUC_Metrics<span class="sc">$</span>performance_metrics <span class="ot">&lt;-</span> RandomForest_StepAUC_Metrics<span class="sc">$</span>performance_metrics <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">Best_ntree =</span> Best_Ntree)</span>
<span id="cb194-5036"><a href="#cb194-5036" aria-hidden="true" tabindex="-1"></a>RandomForest_StepAUC_Metrics<span class="sc">$</span>performance_metrics <span class="ot">&lt;-</span> RandomForest_StepAUC_Metrics<span class="sc">$</span>performance_metrics <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">Best_mtry =</span> Best_Mtry)</span>
<span id="cb194-5037"><a href="#cb194-5037" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5038"><a href="#cb194-5038" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5039"><a href="#cb194-5039" aria-hidden="true" tabindex="-1"></a><span class="co"># NaiveBayes</span></span>
<span id="cb194-5040"><a href="#cb194-5040" aria-hidden="true" tabindex="-1"></a>hyperparameters_NaiveBayes <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb194-5041"><a href="#cb194-5041" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5042"><a href="#cb194-5042" aria-hidden="true" tabindex="-1"></a>NaiveBayes_TodasVariables_Metrics <span class="ot">&lt;-</span> <span class="fu">process_experiment_data</span>(performance_naiveBayes_todasVariables, hyperparameters_NaiveBayes)</span>
<span id="cb194-5043"><a href="#cb194-5043" aria-hidden="true" tabindex="-1"></a>NaiveBayes_Asociacion_Metrics <span class="ot">&lt;-</span> <span class="fu">process_experiment_data</span>(performance_naiveBayes_Asociacion, hyperparameters_NaiveBayes)</span>
<span id="cb194-5044"><a href="#cb194-5044" aria-hidden="true" tabindex="-1"></a>NaiveBayes_StepAUC_Metrics <span class="ot">&lt;-</span> <span class="fu">process_experiment_data</span>(performance_naiveBayes_stepAUC, hyperparameters_NaiveBayes)</span>
<span id="cb194-5045"><a href="#cb194-5045" aria-hidden="true" tabindex="-1"></a>NaiveBayes_Lasso_Metrics <span class="ot">&lt;-</span> <span class="fu">process_experiment_data</span>(performance_naiveBayes_lasso, hyperparameters_NaiveBayes)</span>
<span id="cb194-5046"><a href="#cb194-5046" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5047"><a href="#cb194-5047" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5048"><a href="#cb194-5048" aria-hidden="true" tabindex="-1"></a><span class="co"># AdaBoost</span></span>
<span id="cb194-5049"><a href="#cb194-5049" aria-hidden="true" tabindex="-1"></a>hyperparameters_AdaBoost <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Best_Iteration"</span>)</span>
<span id="cb194-5050"><a href="#cb194-5050" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5051"><a href="#cb194-5051" aria-hidden="true" tabindex="-1"></a>AdaBoost_TodasVariables_Metrics <span class="ot">&lt;-</span> <span class="fu">process_experiment_data</span>(performance_adaboost_todasvariables, hyperparameters_AdaBoost)</span>
<span id="cb194-5052"><a href="#cb194-5052" aria-hidden="true" tabindex="-1"></a>AdaBoost_Asociacion_Metrics <span class="ot">&lt;-</span> <span class="fu">process_experiment_data</span>(performance_adaboost_Asociacion, hyperparameters_AdaBoost)</span>
<span id="cb194-5053"><a href="#cb194-5053" aria-hidden="true" tabindex="-1"></a>AdaBoost_StepAUC_Metrics <span class="ot">&lt;-</span> <span class="fu">process_experiment_data</span>(performance_adaboost_stepAUC, <span class="fu">c</span>(<span class="st">"Best_Iterations"</span>))</span>
<span id="cb194-5054"><a href="#cb194-5054" aria-hidden="true" tabindex="-1"></a>AdaBoost_Lasso_Metrics <span class="ot">&lt;-</span> <span class="fu">process_experiment_data</span>(performance_adaboost_lasso, hyperparameters_AdaBoost)</span>
<span id="cb194-5055"><a href="#cb194-5055" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5056"><a href="#cb194-5056" aria-hidden="true" tabindex="-1"></a>AdaBoost_StepAUC_Metrics<span class="sc">$</span>performance_metrics <span class="ot">&lt;-</span> AdaBoost_StepAUC_Metrics<span class="sc">$</span>performance_metrics <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">Best_Iteration =</span> Best_Iterations)</span>
<span id="cb194-5057"><a href="#cb194-5057" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5058"><a href="#cb194-5058" aria-hidden="true" tabindex="-1"></a><span class="co"># RPart</span></span>
<span id="cb194-5059"><a href="#cb194-5059" aria-hidden="true" tabindex="-1"></a>hyperparameters_RPart <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Best_cp"</span>, <span class="st">"Best_minsplit"</span>)</span>
<span id="cb194-5060"><a href="#cb194-5060" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5061"><a href="#cb194-5061" aria-hidden="true" tabindex="-1"></a>RPart_TodasVariables_Metrics <span class="ot">&lt;-</span> <span class="fu">process_experiment_data</span>(performance_rpart_todasvariables, hyperparameters_RPart)</span>
<span id="cb194-5062"><a href="#cb194-5062" aria-hidden="true" tabindex="-1"></a>RPart_Asociacion_Metrics <span class="ot">&lt;-</span> <span class="fu">process_experiment_data</span>(performance_rpart_Asociacion, hyperparameters_RPart)</span>
<span id="cb194-5063"><a href="#cb194-5063" aria-hidden="true" tabindex="-1"></a>RPart_StepAUC_Metrics <span class="ot">&lt;-</span> <span class="fu">process_experiment_data</span>(performance_rpart_StepAUC, <span class="fu">c</span>(<span class="st">"Best_CP"</span>, <span class="st">"Best_Minsplit"</span>))</span>
<span id="cb194-5064"><a href="#cb194-5064" aria-hidden="true" tabindex="-1"></a>RPart_Lasso_Metrics <span class="ot">&lt;-</span> <span class="fu">process_experiment_data</span>(performance_rpart_lasso, hyperparameters_RPart)</span>
<span id="cb194-5065"><a href="#cb194-5065" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5066"><a href="#cb194-5066" aria-hidden="true" tabindex="-1"></a>RPart_StepAUC_Metrics<span class="sc">$</span>performance_metrics <span class="ot">&lt;-</span> RPart_StepAUC_Metrics<span class="sc">$</span>performance_metrics <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">Best_cp =</span> Best_CP)</span>
<span id="cb194-5067"><a href="#cb194-5067" aria-hidden="true" tabindex="-1"></a>RPart_StepAUC_Metrics<span class="sc">$</span>performance_metrics <span class="ot">&lt;-</span> RPart_StepAUC_Metrics<span class="sc">$</span>performance_metrics <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">Best_minsplit =</span> Best_Minsplit)</span>
<span id="cb194-5068"><a href="#cb194-5068" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5069"><a href="#cb194-5069" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-5070"><a href="#cb194-5070" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5071"><a href="#cb194-5071" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5072"><a href="#cb194-5072" aria-hidden="true" tabindex="-1"></a>El primer paso que se seguirá consiste en estandarizar los datos de los experimentos realizados en el apartado <span class="in">`Resultados`</span> de tal forma que tengamos un único objeto <span class="in">`data.frame`</span> por cada método de selección de variables. Este objeto <span class="in">`data.frame`</span> contentrá métricas de rendimiento del modelo (TP, TN, AUC, etc.), las variables seleccionadas por el método aplicado y los hiperparámetros que han dado lugar al mejor rendimiento del modelo, estos datos se repiten por cada outer fold, por cada semilla aplicada, de tal forma que, como hemos aplicado 5 semillas (<span class="in">`27, 3, 123, 50, 90`</span>), y hemos realizado una doble validación cruzada 5x2, tendremos un <span class="in">`data.frame`</span> de 25 filas por cada método de selección de variables aplicado. Por otra parte, también se han estandarizado de la misma forma las métricas de rendmiento de la evaluación del mejor modelo encontrado en los folds internos con los conjuntos de validación de los folds internos. Estos datos servirán para validar que no haya habido sobre entrenamientos.</span>
<span id="cb194-5073"><a href="#cb194-5073" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5074"><a href="#cb194-5074" aria-hidden="true" tabindex="-1"></a>A continuación se muestra una porción de cada uno de estos <span class="in">`data.frame`</span>:</span>
<span id="cb194-5075"><a href="#cb194-5075" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5076"><a href="#cb194-5076" aria-hidden="true" tabindex="-1"></a>::: {.panel-tabset}</span>
<span id="cb194-5077"><a href="#cb194-5077" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5078"><a href="#cb194-5078" aria-hidden="true" tabindex="-1"></a><span class="fu">## Conjunto `performance_metrics` de los Folds Externos</span></span>
<span id="cb194-5079"><a href="#cb194-5079" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5080"><a href="#cb194-5080" aria-hidden="true" tabindex="-1"></a>Se muestra el <span class="in">`data.frame`</span> generado con los datos de rendimiento para los folds externos por semillas y folds para el método wrapped *StepAUC* para las redes de neuronas artificiales.</span>
<span id="cb194-5081"><a href="#cb194-5081" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5084"><a href="#cb194-5084" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb194-5085"><a href="#cb194-5085" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="fu">head</span>(ANN_StepAUC_Metrics<span class="sc">$</span>performance_metrics, <span class="dv">10</span>))</span>
<span id="cb194-5086"><a href="#cb194-5086" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-5087"><a href="#cb194-5087" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5088"><a href="#cb194-5088" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5089"><a href="#cb194-5089" aria-hidden="true" tabindex="-1"></a><span class="fu">## Conjunto `inner_performance` de los Folds Internos</span></span>
<span id="cb194-5090"><a href="#cb194-5090" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5091"><a href="#cb194-5091" aria-hidden="true" tabindex="-1"></a>Se muestra el <span class="in">`data.frame`</span> generado con los datos de rendimiento para los folds iternos por semillas y folds para el método wrapped *StepAUC* para las redes de neuronas artificiales.</span>
<span id="cb194-5092"><a href="#cb194-5092" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5095"><a href="#cb194-5095" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb194-5096"><a href="#cb194-5096" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="fu">head</span>(ANN_StepAUC_Metrics<span class="sc">$</span>inner_fold_metrics, <span class="dv">15</span>))</span>
<span id="cb194-5097"><a href="#cb194-5097" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-5098"><a href="#cb194-5098" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5099"><a href="#cb194-5099" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5100"><a href="#cb194-5100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5101"><a href="#cb194-5101" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb194-5102"><a href="#cb194-5102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5103"><a href="#cb194-5103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5104"><a href="#cb194-5104" aria-hidden="true" tabindex="-1"></a><span class="fu">## Rendimiento Aparente</span></span>
<span id="cb194-5105"><a href="#cb194-5105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5108"><a href="#cb194-5108" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb194-5109"><a href="#cb194-5109" aria-hidden="true" tabindex="-1"></a>modelos <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"NaiveBayes"</span>, <span class="st">"Adaboost"</span>, <span class="st">"KNN"</span>, <span class="st">"DT"</span>, <span class="st">"RF"</span>, <span class="st">"SVM"</span>, <span class="st">"ANN"</span>)</span>
<span id="cb194-5110"><a href="#cb194-5110" aria-hidden="true" tabindex="-1"></a>auc_values <span class="ot">&lt;-</span> <span class="fu">c</span>(resultadosAparentesNaiveBayes<span class="sc">$</span>roc_curve<span class="sc">$</span>auc,</span>
<span id="cb194-5111"><a href="#cb194-5111" aria-hidden="true" tabindex="-1"></a>                resultadosAparentesAdaBoost<span class="sc">$</span>roc_curve<span class="sc">$</span>auc,</span>
<span id="cb194-5112"><a href="#cb194-5112" aria-hidden="true" tabindex="-1"></a>                resultadosAparentesKNN<span class="sc">$</span>roc_curve<span class="sc">$</span>auc,</span>
<span id="cb194-5113"><a href="#cb194-5113" aria-hidden="true" tabindex="-1"></a>                resultadosAparentesDT<span class="sc">$</span>roc_curve<span class="sc">$</span>auc,</span>
<span id="cb194-5114"><a href="#cb194-5114" aria-hidden="true" tabindex="-1"></a>                resultadosAparentesRF<span class="sc">$</span>roc_curve<span class="sc">$</span>auc,</span>
<span id="cb194-5115"><a href="#cb194-5115" aria-hidden="true" tabindex="-1"></a>                resultadosAparentesSVM<span class="sc">$</span>roc_curve<span class="sc">$</span>auc,</span>
<span id="cb194-5116"><a href="#cb194-5116" aria-hidden="true" tabindex="-1"></a>                resultadosAparentesNN<span class="sc">$</span>roc_curve<span class="sc">$</span>auc)</span>
<span id="cb194-5117"><a href="#cb194-5117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5118"><a href="#cb194-5118" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Modelo =</span> modelos, <span class="at">AUC =</span> auc_values)</span>
<span id="cb194-5119"><a href="#cb194-5119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5120"><a href="#cb194-5120" aria-hidden="true" tabindex="-1"></a>fig <span class="ot">&lt;-</span> <span class="fu">plot_ly</span>(data, <span class="at">x =</span> <span class="sc">~</span>Modelo, <span class="at">y =</span> <span class="sc">~</span>AUC, <span class="at">type =</span> <span class="st">'bar'</span>,</span>
<span id="cb194-5121"><a href="#cb194-5121" aria-hidden="true" tabindex="-1"></a>               <span class="at">marker =</span> <span class="fu">list</span>(<span class="at">color =</span> <span class="st">'rgb(158,202,225)'</span>,</span>
<span id="cb194-5122"><a href="#cb194-5122" aria-hidden="true" tabindex="-1"></a>                             <span class="at">line =</span> <span class="fu">list</span>(<span class="at">color =</span> <span class="st">'rgb(8,48,107)'</span>, <span class="at">width =</span> <span class="fl">1.5</span>)))</span>
<span id="cb194-5123"><a href="#cb194-5123" aria-hidden="true" tabindex="-1"></a>fig <span class="ot">&lt;-</span> fig <span class="sc">%&gt;%</span> <span class="fu">layout</span>(<span class="at">title =</span> <span class="st">"Diferencia de AUC entre Modelos"</span>,</span>
<span id="cb194-5124"><a href="#cb194-5124" aria-hidden="true" tabindex="-1"></a>                      <span class="at">xaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">"Modelo"</span>),</span>
<span id="cb194-5125"><a href="#cb194-5125" aria-hidden="true" tabindex="-1"></a>                      <span class="at">yaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">"AUC"</span>),</span>
<span id="cb194-5126"><a href="#cb194-5126" aria-hidden="true" tabindex="-1"></a>                      <span class="at">margin =</span> <span class="fu">list</span>(<span class="at">b =</span> <span class="dv">100</span>))</span>
<span id="cb194-5127"><a href="#cb194-5127" aria-hidden="true" tabindex="-1"></a>                      </span>
<span id="cb194-5128"><a href="#cb194-5128" aria-hidden="true" tabindex="-1"></a>fig</span>
<span id="cb194-5129"><a href="#cb194-5129" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-5130"><a href="#cb194-5130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5131"><a href="#cb194-5131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5132"><a href="#cb194-5132" aria-hidden="true" tabindex="-1"></a>Como se puede observar por el rendimiento aparente, los modelos más prometedores en este estudio parecen ser las Redes de Neuronas Artificiales, los Decision Tree, y los Random Forest. Se tomarán estas medidas como cuantificaciones optimistas del máximo rendimiento que se puede obtener para el modelo, sirviendo así como base para la comparación continua de esta sección del proyecto. </span>
<span id="cb194-5133"><a href="#cb194-5133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5134"><a href="#cb194-5134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5135"><a href="#cb194-5135" aria-hidden="true" tabindex="-1"></a><span class="fu">## Estabilidad de AUC entre Folds</span></span>
<span id="cb194-5136"><a href="#cb194-5136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5137"><a href="#cb194-5137" aria-hidden="true" tabindex="-1"></a>Esta sección se dedica al estudio de la estabilidad de las métricas de rendimiento para todos los modelos. Una de las principales características deseadas en un modelo de Aprendizaje Automático es la robustez en sus predicciones. Un modelo puede alcanzar un AUC máximo alto; sin embargo, si la varianza del AUC correspondiente a sus predicciones es muy alta, esto indica que el modelo es demasiado sensible a los datos de entrada, lo que podría resultar en predicciones inesperadas.</span>
<span id="cb194-5138"><a href="#cb194-5138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5139"><a href="#cb194-5139" aria-hidden="true" tabindex="-1"></a>Para abordar esta cuestión, se llevará a cabo un estudio comparativo para cada método de selección de variables utilizado por cada modelo, considerando las diferentes semillas y folds externos aplicados en la validación interna.</span>
<span id="cb194-5140"><a href="#cb194-5140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5141"><a href="#cb194-5141" aria-hidden="true" tabindex="-1"></a>Un modelo será considerado óptimo en esta sección si logra un alto AUC medio y si la variabilidad de sus AUC en función de la semilla y el fold es baja. Además, se evaluará si todos los métodos de selección de variables muestran un patrón consistente de AUC a lo largo de los diferentes folds, independientemente de la semilla. Esto indicaría que las fluctuaciones observadas se deben a la divisiones de los datos y no a la estructura del modelo, señalando una limitación impuesta por las muestras utilizadas.</span>
<span id="cb194-5142"><a href="#cb194-5142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5143"><a href="#cb194-5143" aria-hidden="true" tabindex="-1"></a>A continuación, se comentan las gráficas que serán generadas para el estudio comparativo </span>
<span id="cb194-5144"><a href="#cb194-5144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5145"><a href="#cb194-5145" aria-hidden="true" tabindex="-1"></a>::: {.panel-tabset}</span>
<span id="cb194-5146"><a href="#cb194-5146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5147"><a href="#cb194-5147" aria-hidden="true" tabindex="-1"></a><span class="fu">## AUC Medio entre Inner Folds y Outer Folds</span></span>
<span id="cb194-5148"><a href="#cb194-5148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5149"><a href="#cb194-5149" aria-hidden="true" tabindex="-1"></a>El objetivo del gráfico comparativo del AUC medio de los inner folds y los outer folds es visualizar y comparar el rendimiento del modelo durante el proceso de validación cruzada. Específicamente, el gráfico de barras muestra los valores promedio del AUC tanto para los inner folds como para los outer folds, agrupados por fold. Al hacerlo, permite evaluar si el rendimiento del modelo es consistente entre las dos fases de validación y detectar posibles discrepancias o sobreajustes. La visualización ayuda a entender cómo el modelo generaliza a datos no vistos y proporciona una medida de estabilidad y confianza en el rendimiento del modelo.</span>
<span id="cb194-5150"><a href="#cb194-5150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5153"><a href="#cb194-5153" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb194-5154"><a href="#cb194-5154" aria-hidden="true" tabindex="-1"></a><span class="co"># Gráfico de barras comparativo del AUC medio de los inner folds y el AUC medio de los outer folds</span></span>
<span id="cb194-5155"><a href="#cb194-5155" aria-hidden="true" tabindex="-1"></a>generate_inner_outer_auc_comparison <span class="ot">&lt;-</span> <span class="cf">function</span>(inner_fold_metrics, outer_fold_metrics) {</span>
<span id="cb194-5156"><a href="#cb194-5156" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calcular AUC medio por fold para inner folds</span></span>
<span id="cb194-5157"><a href="#cb194-5157" aria-hidden="true" tabindex="-1"></a>  mean_inner_auc <span class="ot">&lt;-</span> inner_fold_metrics <span class="sc">%&gt;%</span></span>
<span id="cb194-5158"><a href="#cb194-5158" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(Fold) <span class="sc">%&gt;%</span></span>
<span id="cb194-5159"><a href="#cb194-5159" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">mean_AUC_inner =</span> <span class="fu">mean</span>(AUC, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb194-5160"><a href="#cb194-5160" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb194-5161"><a href="#cb194-5161" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calcular AUC medio por fold para outer folds</span></span>
<span id="cb194-5162"><a href="#cb194-5162" aria-hidden="true" tabindex="-1"></a>  mean_outer_auc <span class="ot">&lt;-</span> outer_fold_metrics <span class="sc">%&gt;%</span></span>
<span id="cb194-5163"><a href="#cb194-5163" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(Fold) <span class="sc">%&gt;%</span></span>
<span id="cb194-5164"><a href="#cb194-5164" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">mean_AUC_outer =</span> <span class="fu">mean</span>(AUC, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb194-5165"><a href="#cb194-5165" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb194-5166"><a href="#cb194-5166" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Unir los dataframes por Fold</span></span>
<span id="cb194-5167"><a href="#cb194-5167" aria-hidden="true" tabindex="-1"></a>  comparison_data <span class="ot">&lt;-</span> <span class="fu">merge</span>(mean_inner_auc, mean_outer_auc, <span class="at">by =</span> <span class="st">"Fold"</span>)</span>
<span id="cb194-5168"><a href="#cb194-5168" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb194-5169"><a href="#cb194-5169" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Crear la gráfica de barras comparativa</span></span>
<span id="cb194-5170"><a href="#cb194-5170" aria-hidden="true" tabindex="-1"></a>  fig <span class="ot">&lt;-</span> <span class="fu">plot_ly</span>(<span class="at">data =</span> comparison_data, <span class="at">x =</span> <span class="sc">~</span>Fold) <span class="sc">%&gt;%</span></span>
<span id="cb194-5171"><a href="#cb194-5171" aria-hidden="true" tabindex="-1"></a>    <span class="fu">add_trace</span>(</span>
<span id="cb194-5172"><a href="#cb194-5172" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="sc">~</span>mean_AUC_inner, </span>
<span id="cb194-5173"><a href="#cb194-5173" aria-hidden="true" tabindex="-1"></a>      <span class="at">type =</span> <span class="st">'bar'</span>, </span>
<span id="cb194-5174"><a href="#cb194-5174" aria-hidden="true" tabindex="-1"></a>      <span class="at">name =</span> <span class="st">'AUC Medio Inner Folds'</span>,</span>
<span id="cb194-5175"><a href="#cb194-5175" aria-hidden="true" tabindex="-1"></a>      <span class="at">marker =</span> <span class="fu">list</span>(<span class="at">color =</span> <span class="st">'blue'</span>)</span>
<span id="cb194-5176"><a href="#cb194-5176" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb194-5177"><a href="#cb194-5177" aria-hidden="true" tabindex="-1"></a>    <span class="fu">add_trace</span>(</span>
<span id="cb194-5178"><a href="#cb194-5178" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="sc">~</span>mean_AUC_outer, </span>
<span id="cb194-5179"><a href="#cb194-5179" aria-hidden="true" tabindex="-1"></a>      <span class="at">type =</span> <span class="st">'bar'</span>, </span>
<span id="cb194-5180"><a href="#cb194-5180" aria-hidden="true" tabindex="-1"></a>      <span class="at">name =</span> <span class="st">'AUC Medio Outer Folds'</span>,</span>
<span id="cb194-5181"><a href="#cb194-5181" aria-hidden="true" tabindex="-1"></a>      <span class="at">marker =</span> <span class="fu">list</span>(<span class="at">color =</span> <span class="st">'red'</span>)</span>
<span id="cb194-5182"><a href="#cb194-5182" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb194-5183"><a href="#cb194-5183" aria-hidden="true" tabindex="-1"></a>    <span class="fu">layout</span>(</span>
<span id="cb194-5184"><a href="#cb194-5184" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="st">'Comparación de AUC Medio: Inner Folds vs Outer Folds'</span>,</span>
<span id="cb194-5185"><a href="#cb194-5185" aria-hidden="true" tabindex="-1"></a>      <span class="at">xaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">'Fold'</span>),</span>
<span id="cb194-5186"><a href="#cb194-5186" aria-hidden="true" tabindex="-1"></a>      <span class="at">yaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">'AUC Medio'</span>, <span class="at">range =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)),</span>
<span id="cb194-5187"><a href="#cb194-5187" aria-hidden="true" tabindex="-1"></a>      <span class="at">barmode =</span> <span class="st">'group'</span></span>
<span id="cb194-5188"><a href="#cb194-5188" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb194-5189"><a href="#cb194-5189" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb194-5190"><a href="#cb194-5190" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(fig)</span>
<span id="cb194-5191"><a href="#cb194-5191" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb194-5192"><a href="#cb194-5192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5193"><a href="#cb194-5193" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-5194"><a href="#cb194-5194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5195"><a href="#cb194-5195" aria-hidden="true" tabindex="-1"></a><span class="fu">## AUC Medio por Outer Fold</span></span>
<span id="cb194-5196"><a href="#cb194-5196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5197"><a href="#cb194-5197" aria-hidden="true" tabindex="-1"></a>El objetivo de la gráfica de violín del AUC medio por outer fold es proporcionar una visualización clara y detallada de la distribución del AUC para cada fold, distinguiendo los resultados por diferentes semillas de validación. Esta visualización es útil para detectar si hay algún fold específico que muestra una mayor variabilidad o si el rendimiento del modelo es consistentemente estable a través de todos los folds y semillas. Además, los elementos de la gráfica de violín, como la línea de la media y los puntos de datos individuales, facilitan la comprensión de la distribución del AUC y de los posibles outliers en los resultados.</span>
<span id="cb194-5198"><a href="#cb194-5198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5201"><a href="#cb194-5201" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb194-5202"><a href="#cb194-5202" aria-hidden="true" tabindex="-1"></a><span class="co">#  Gráfico de violín del AUC medio por outer fold con colores distintos para cada fold</span></span>
<span id="cb194-5203"><a href="#cb194-5203" aria-hidden="true" tabindex="-1"></a>generate_outer_auc_violin_plot <span class="ot">&lt;-</span> <span class="cf">function</span>(outer_fold_metrics) {</span>
<span id="cb194-5204"><a href="#cb194-5204" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Colores para cada fold</span></span>
<span id="cb194-5205"><a href="#cb194-5205" aria-hidden="true" tabindex="-1"></a>  colors <span class="ot">&lt;-</span> RColorBrewer<span class="sc">::</span><span class="fu">brewer.pal</span>(<span class="at">n =</span> <span class="fu">length</span>(<span class="fu">unique</span>(outer_fold_metrics<span class="sc">$</span>Fold)), <span class="at">name =</span> <span class="st">"Set1"</span>)</span>
<span id="cb194-5206"><a href="#cb194-5206" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb194-5207"><a href="#cb194-5207" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Crear la gráfica de violín</span></span>
<span id="cb194-5208"><a href="#cb194-5208" aria-hidden="true" tabindex="-1"></a>  fig <span class="ot">&lt;-</span> <span class="fu">plot_ly</span>(<span class="at">data =</span> outer_fold_metrics, <span class="at">y =</span> <span class="sc">~</span>AUC, <span class="at">x =</span> <span class="sc">~</span><span class="fu">factor</span>(Fold), <span class="at">type =</span> <span class="st">'violin'</span>, </span>
<span id="cb194-5209"><a href="#cb194-5209" aria-hidden="true" tabindex="-1"></a>                 <span class="at">box =</span> <span class="fu">list</span>(<span class="at">visible =</span> <span class="cn">TRUE</span>), <span class="at">meanline =</span> <span class="fu">list</span>(<span class="at">visible =</span> <span class="cn">TRUE</span>), <span class="at">points =</span> <span class="st">'all'</span>, <span class="at">spanmode =</span> <span class="st">'hard'</span>,</span>
<span id="cb194-5210"><a href="#cb194-5210" aria-hidden="true" tabindex="-1"></a>                 <span class="at">color =</span> <span class="sc">~</span><span class="fu">factor</span>(Fold), <span class="at">colors =</span> colors) <span class="sc">%&gt;%</span></span>
<span id="cb194-5211"><a href="#cb194-5211" aria-hidden="true" tabindex="-1"></a>    <span class="fu">layout</span>(</span>
<span id="cb194-5212"><a href="#cb194-5212" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="st">'Distribución del AUC por Outer Fold'</span>,</span>
<span id="cb194-5213"><a href="#cb194-5213" aria-hidden="true" tabindex="-1"></a>      <span class="at">xaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">'Fold'</span>),</span>
<span id="cb194-5214"><a href="#cb194-5214" aria-hidden="true" tabindex="-1"></a>      <span class="at">yaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">'AUC'</span>)</span>
<span id="cb194-5215"><a href="#cb194-5215" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb194-5216"><a href="#cb194-5216" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb194-5217"><a href="#cb194-5217" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(fig)</span>
<span id="cb194-5218"><a href="#cb194-5218" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb194-5219"><a href="#cb194-5219" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-5220"><a href="#cb194-5220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5221"><a href="#cb194-5221" aria-hidden="true" tabindex="-1"></a><span class="fu">## Comparativa entre los métodos de Selección de Variables </span></span>
<span id="cb194-5222"><a href="#cb194-5222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5223"><a href="#cb194-5223" aria-hidden="true" tabindex="-1"></a>El objetivo de esta gráfica 3D es comparar la eficacia de diferentes métodos de selección de características (Todas Variables, Asociación, StepAUC y Lasso) en términos de su rendimiento medido por el AUC (Area Under the Curve). La visualización representa los resultados de múltiples ejecuciones (diferentes semillas) y los pliegues (folds) de validación cruzada para cada método. Cada punto en la gráfica indica el AUC obtenido en un pliegue específico para una semilla dada, y estos puntos se conectan con líneas para mostrar la continuidad dentro del mismo método y semilla. Los diferentes métodos se distinguen por colores, y en la leyenda se muestra el AUC medio global para cada método, proporcionando una comparación clara y visual de cómo cada método performa en promedio y cómo varía su rendimiento a través de diferentes pliegues y ejecuciones. Esto facilita la identificación de métodos consistentes y estables, así como aquellos que pueden necesitar ajustes adicionales.</span>
<span id="cb194-5224"><a href="#cb194-5224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5227"><a href="#cb194-5227" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb194-5228"><a href="#cb194-5228" aria-hidden="true" tabindex="-1"></a>generate_combined_auc_3d_plot <span class="ot">&lt;-</span> <span class="cf">function</span>(dataframes, names) {</span>
<span id="cb194-5229"><a href="#cb194-5229" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Definir los colores para cada dataframe</span></span>
<span id="cb194-5230"><a href="#cb194-5230" aria-hidden="true" tabindex="-1"></a>  colors <span class="ot">&lt;-</span> <span class="fu">brewer.pal</span>(<span class="at">n =</span> <span class="fu">length</span>(dataframes), <span class="at">name =</span> <span class="st">"Set1"</span>)</span>
<span id="cb194-5231"><a href="#cb194-5231" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb194-5232"><a href="#cb194-5232" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calcular el AUC promedio global para cada dataframe</span></span>
<span id="cb194-5233"><a href="#cb194-5233" aria-hidden="true" tabindex="-1"></a>  mean_aucs <span class="ot">&lt;-</span> <span class="fu">sapply</span>(dataframes, <span class="cf">function</span>(df) <span class="fu">mean</span>(df<span class="sc">$</span>AUC, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb194-5234"><a href="#cb194-5234" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb194-5235"><a href="#cb194-5235" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Crear las trazas 3D para cada dataframe y semilla</span></span>
<span id="cb194-5236"><a href="#cb194-5236" aria-hidden="true" tabindex="-1"></a>  fig <span class="ot">&lt;-</span> <span class="fu">plot_ly</span>()</span>
<span id="cb194-5237"><a href="#cb194-5237" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb194-5238"><a href="#cb194-5238" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(dataframes)) {</span>
<span id="cb194-5239"><a href="#cb194-5239" aria-hidden="true" tabindex="-1"></a>    df <span class="ot">&lt;-</span> dataframes[[i]]</span>
<span id="cb194-5240"><a href="#cb194-5240" aria-hidden="true" tabindex="-1"></a>    unique_seeds <span class="ot">&lt;-</span> <span class="fu">unique</span>(df<span class="sc">$</span>Seed)</span>
<span id="cb194-5241"><a href="#cb194-5241" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (seed <span class="cf">in</span> unique_seeds) {</span>
<span id="cb194-5242"><a href="#cb194-5242" aria-hidden="true" tabindex="-1"></a>      seed_data <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Seed <span class="sc">==</span> seed)</span>
<span id="cb194-5243"><a href="#cb194-5243" aria-hidden="true" tabindex="-1"></a>      fig <span class="ot">&lt;-</span> fig <span class="sc">%&gt;%</span></span>
<span id="cb194-5244"><a href="#cb194-5244" aria-hidden="true" tabindex="-1"></a>        <span class="fu">add_trace</span>(<span class="at">data =</span> seed_data, <span class="at">x =</span> <span class="sc">~</span>Fold, <span class="at">y =</span> <span class="sc">~</span>Seed, <span class="at">z =</span> <span class="sc">~</span>AUC, <span class="at">type =</span> <span class="st">'scatter3d'</span>, <span class="at">mode =</span> <span class="st">'lines+markers'</span>,</span>
<span id="cb194-5245"><a href="#cb194-5245" aria-hidden="true" tabindex="-1"></a>                  <span class="at">line =</span> <span class="fu">list</span>(<span class="at">color =</span> colors[i]), <span class="at">marker =</span> <span class="fu">list</span>(<span class="at">size =</span> <span class="dv">5</span>, <span class="at">color =</span> colors[i]),</span>
<span id="cb194-5246"><a href="#cb194-5246" aria-hidden="true" tabindex="-1"></a>                  <span class="at">showlegend =</span> <span class="fu">ifelse</span>(seed <span class="sc">==</span> unique_seeds[<span class="dv">1</span>], <span class="cn">TRUE</span>, <span class="cn">FALSE</span>),</span>
<span id="cb194-5247"><a href="#cb194-5247" aria-hidden="true" tabindex="-1"></a>                  <span class="at">name =</span> <span class="fu">ifelse</span>(seed <span class="sc">==</span> unique_seeds[<span class="dv">1</span>], <span class="fu">paste</span>(names[i], <span class="st">"- AUC medio global:"</span>, <span class="fu">round</span>(mean_aucs[i], <span class="dv">3</span>)), <span class="st">""</span>))</span>
<span id="cb194-5248"><a href="#cb194-5248" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb194-5249"><a href="#cb194-5249" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb194-5250"><a href="#cb194-5250" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb194-5251"><a href="#cb194-5251" aria-hidden="true" tabindex="-1"></a>  fig <span class="ot">&lt;-</span> fig <span class="sc">%&gt;%</span></span>
<span id="cb194-5252"><a href="#cb194-5252" aria-hidden="true" tabindex="-1"></a>    <span class="fu">layout</span>(</span>
<span id="cb194-5253"><a href="#cb194-5253" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="st">'Comparación de AUC por Semilla y Fold para Diferentes Métodos'</span>,</span>
<span id="cb194-5254"><a href="#cb194-5254" aria-hidden="true" tabindex="-1"></a>      <span class="at">scene =</span> <span class="fu">list</span>(</span>
<span id="cb194-5255"><a href="#cb194-5255" aria-hidden="true" tabindex="-1"></a>        <span class="at">xaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">'Fold'</span>),</span>
<span id="cb194-5256"><a href="#cb194-5256" aria-hidden="true" tabindex="-1"></a>        <span class="at">yaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">'Semilla'</span>),</span>
<span id="cb194-5257"><a href="#cb194-5257" aria-hidden="true" tabindex="-1"></a>        <span class="at">zaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">'AUC'</span>)</span>
<span id="cb194-5258"><a href="#cb194-5258" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb194-5259"><a href="#cb194-5259" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb194-5260"><a href="#cb194-5260" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb194-5261"><a href="#cb194-5261" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(fig)</span>
<span id="cb194-5262"><a href="#cb194-5262" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb194-5263"><a href="#cb194-5263" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-5264"><a href="#cb194-5264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5265"><a href="#cb194-5265" aria-hidden="true" tabindex="-1"></a>Adicionalmente, se mostrará la **distribución de AUC a través de Folds y Semillas**. El objetivo de esta gráfica es proporcionar una visualización tridimensional detallada de la distribución del AUC a través de diferentes folds y semillas para un modelo específico. La gráfica permite observar cómo varía el rendimiento del modelo (medido por el AUC) en cada fold y cómo esta variación se distribuye a lo largo de varias ejecuciones independientes (diferentes semillas). Cada color representa una semilla distinta, lo que facilita la identificación de patrones de estabilidad y variabilidad en el rendimiento del modelo. Es gráfica se dejará de manera complementaria a la comparativa general, para que el lector pueda observar las diferencias específicas para cada modelo, sin embargo, *no se comentará*. </span>
<span id="cb194-5266"><a href="#cb194-5266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5269"><a href="#cb194-5269" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb194-5270"><a href="#cb194-5270" aria-hidden="true" tabindex="-1"></a><span class="co"># Función para generar la distribución de AUC a través de folds para todas las semillas usadas de un modelo</span></span>
<span id="cb194-5271"><a href="#cb194-5271" aria-hidden="true" tabindex="-1"></a>generate_auc_per_seed_and_fold <span class="ot">&lt;-</span> <span class="cf">function</span>(performance_metrics) {</span>
<span id="cb194-5272"><a href="#cb194-5272" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calcular el AUC medio por semilla</span></span>
<span id="cb194-5273"><a href="#cb194-5273" aria-hidden="true" tabindex="-1"></a>  mean_auc_by_seed <span class="ot">&lt;-</span> performance_metrics <span class="sc">%&gt;%</span></span>
<span id="cb194-5274"><a href="#cb194-5274" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(Seed) <span class="sc">%&gt;%</span></span>
<span id="cb194-5275"><a href="#cb194-5275" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">mean_AUC =</span> <span class="fu">mean</span>(AUC, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb194-5276"><a href="#cb194-5276" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb194-5277"><a href="#cb194-5277" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Crear la visualización en 3D con plotly</span></span>
<span id="cb194-5278"><a href="#cb194-5278" aria-hidden="true" tabindex="-1"></a>  fig <span class="ot">&lt;-</span> <span class="fu">plot_ly</span>()</span>
<span id="cb194-5279"><a href="#cb194-5279" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb194-5280"><a href="#cb194-5280" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Colores para cada semilla</span></span>
<span id="cb194-5281"><a href="#cb194-5281" aria-hidden="true" tabindex="-1"></a>  colors <span class="ot">&lt;-</span> RColorBrewer<span class="sc">::</span><span class="fu">brewer.pal</span>(<span class="at">n =</span> <span class="fu">length</span>(<span class="fu">unique</span>(performance_metrics<span class="sc">$</span>Seed)), <span class="at">name =</span> <span class="st">"Set1"</span>)</span>
<span id="cb194-5282"><a href="#cb194-5282" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb194-5283"><a href="#cb194-5283" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Añadir los datos de cada semilla como histogramas</span></span>
<span id="cb194-5284"><a href="#cb194-5284" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(<span class="fu">unique</span>(performance_metrics<span class="sc">$</span>Seed))) {</span>
<span id="cb194-5285"><a href="#cb194-5285" aria-hidden="true" tabindex="-1"></a>    seed <span class="ot">&lt;-</span> <span class="fu">unique</span>(performance_metrics<span class="sc">$</span>Seed)[i]</span>
<span id="cb194-5286"><a href="#cb194-5286" aria-hidden="true" tabindex="-1"></a>    subset_data <span class="ot">&lt;-</span> performance_metrics <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Seed <span class="sc">==</span> seed)</span>
<span id="cb194-5287"><a href="#cb194-5287" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb194-5288"><a href="#cb194-5288" aria-hidden="true" tabindex="-1"></a>    fig <span class="ot">&lt;-</span> fig <span class="sc">%&gt;%</span></span>
<span id="cb194-5289"><a href="#cb194-5289" aria-hidden="true" tabindex="-1"></a>      <span class="fu">add_trace</span>(</span>
<span id="cb194-5290"><a href="#cb194-5290" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> subset_data<span class="sc">$</span>Fold, </span>
<span id="cb194-5291"><a href="#cb194-5291" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> <span class="fu">rep</span>(i, <span class="fu">nrow</span>(subset_data)), </span>
<span id="cb194-5292"><a href="#cb194-5292" aria-hidden="true" tabindex="-1"></a>        <span class="at">z =</span> subset_data<span class="sc">$</span>AUC, </span>
<span id="cb194-5293"><a href="#cb194-5293" aria-hidden="true" tabindex="-1"></a>        <span class="at">type =</span> <span class="st">'scatter3d'</span>,</span>
<span id="cb194-5294"><a href="#cb194-5294" aria-hidden="true" tabindex="-1"></a>        <span class="at">mode =</span> <span class="st">'lines+markers'</span>,</span>
<span id="cb194-5295"><a href="#cb194-5295" aria-hidden="true" tabindex="-1"></a>        <span class="at">line =</span> <span class="fu">list</span>(<span class="at">width =</span> <span class="dv">2</span>, <span class="at">color =</span> colors[i]),</span>
<span id="cb194-5296"><a href="#cb194-5296" aria-hidden="true" tabindex="-1"></a>        <span class="at">marker =</span> <span class="fu">list</span>(<span class="at">size =</span> <span class="dv">5</span>, <span class="at">color =</span> colors[i]),</span>
<span id="cb194-5297"><a href="#cb194-5297" aria-hidden="true" tabindex="-1"></a>        <span class="at">name =</span> <span class="fu">paste</span>(<span class="st">'Semilla'</span>, <span class="fu">gsub</span>(<span class="st">"seed_"</span>, <span class="st">""</span>, seed), <span class="st">'AUC medio:'</span>, <span class="fu">round</span>(mean_auc_by_seed<span class="sc">$</span>mean_AUC[i], <span class="dv">3</span>))</span>
<span id="cb194-5298"><a href="#cb194-5298" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb194-5299"><a href="#cb194-5299" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb194-5300"><a href="#cb194-5300" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb194-5301"><a href="#cb194-5301" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Añadir detalles al gráfico</span></span>
<span id="cb194-5302"><a href="#cb194-5302" aria-hidden="true" tabindex="-1"></a>  fig <span class="ot">&lt;-</span> fig <span class="sc">%&gt;%</span> <span class="fu">layout</span>(<span class="at">scene =</span> <span class="fu">list</span>(</span>
<span id="cb194-5303"><a href="#cb194-5303" aria-hidden="true" tabindex="-1"></a>    <span class="at">xaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">'Fold'</span>),</span>
<span id="cb194-5304"><a href="#cb194-5304" aria-hidden="true" tabindex="-1"></a>    <span class="at">yaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">'Semilla'</span>),</span>
<span id="cb194-5305"><a href="#cb194-5305" aria-hidden="true" tabindex="-1"></a>    <span class="at">zaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">'AUC'</span>),</span>
<span id="cb194-5306"><a href="#cb194-5306" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Visualización 3D de Folds, Semillas y AUC"</span></span>
<span id="cb194-5307"><a href="#cb194-5307" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb194-5308"><a href="#cb194-5308" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb194-5309"><a href="#cb194-5309" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Mostrar el gráfico</span></span>
<span id="cb194-5310"><a href="#cb194-5310" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(fig)</span>
<span id="cb194-5311"><a href="#cb194-5311" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb194-5312"><a href="#cb194-5312" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5313"><a href="#cb194-5313" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-5314"><a href="#cb194-5314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5315"><a href="#cb194-5315" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb194-5316"><a href="#cb194-5316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5317"><a href="#cb194-5317" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5318"><a href="#cb194-5318" aria-hidden="true" tabindex="-1"></a><span class="fu">### Naive Bayes</span></span>
<span id="cb194-5319"><a href="#cb194-5319" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5320"><a href="#cb194-5320" aria-hidden="true" tabindex="-1"></a><span class="fu">#### AUC Fold Interno vs Externo</span></span>
<span id="cb194-5321"><a href="#cb194-5321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5322"><a href="#cb194-5322" aria-hidden="true" tabindex="-1"></a>::: {.panel-tabset}</span>
<span id="cb194-5323"><a href="#cb194-5323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5324"><a href="#cb194-5324" aria-hidden="true" tabindex="-1"></a><span class="fu">## TodasVariables</span></span>
<span id="cb194-5325"><a href="#cb194-5325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5328"><a href="#cb194-5328" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb194-5329"><a href="#cb194-5329" aria-hidden="true" tabindex="-1"></a><span class="fu">generate_inner_outer_auc_comparison</span>(NaiveBayes_TodasVariables_Metrics<span class="sc">$</span>inner_fold_metrics, NaiveBayes_TodasVariables_Metrics<span class="sc">$</span>performance_metrics)</span>
<span id="cb194-5330"><a href="#cb194-5330" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-5331"><a href="#cb194-5331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5332"><a href="#cb194-5332" aria-hidden="true" tabindex="-1"></a><span class="fu">## Asociacion</span></span>
<span id="cb194-5333"><a href="#cb194-5333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5336"><a href="#cb194-5336" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb194-5337"><a href="#cb194-5337" aria-hidden="true" tabindex="-1"></a><span class="fu">generate_inner_outer_auc_comparison</span>(NaiveBayes_Asociacion_Metrics<span class="sc">$</span>inner_fold_metrics, NaiveBayes_Asociacion_Metrics<span class="sc">$</span>performance_metrics)</span>
<span id="cb194-5338"><a href="#cb194-5338" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-5339"><a href="#cb194-5339" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5340"><a href="#cb194-5340" aria-hidden="true" tabindex="-1"></a><span class="fu">## StepAUC</span></span>
<span id="cb194-5341"><a href="#cb194-5341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5344"><a href="#cb194-5344" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb194-5345"><a href="#cb194-5345" aria-hidden="true" tabindex="-1"></a><span class="fu">generate_inner_outer_auc_comparison</span>(NaiveBayes_StepAUC_Metrics<span class="sc">$</span>inner_fold_metrics, NaiveBayes_StepAUC_Metrics<span class="sc">$</span>performance_metrics)</span>
<span id="cb194-5346"><a href="#cb194-5346" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-5347"><a href="#cb194-5347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5348"><a href="#cb194-5348" aria-hidden="true" tabindex="-1"></a><span class="fu">## Lasso</span></span>
<span id="cb194-5349"><a href="#cb194-5349" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5352"><a href="#cb194-5352" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb194-5353"><a href="#cb194-5353" aria-hidden="true" tabindex="-1"></a><span class="fu">generate_inner_outer_auc_comparison</span>(NaiveBayes_Lasso_Metrics<span class="sc">$</span>inner_fold_metrics, NaiveBayes_Lasso_Metrics<span class="sc">$</span>performance_metrics)</span>
<span id="cb194-5354"><a href="#cb194-5354" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-5355"><a href="#cb194-5355" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5356"><a href="#cb194-5356" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb194-5357"><a href="#cb194-5357" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5358"><a href="#cb194-5358" aria-hidden="true" tabindex="-1"></a>El valor de AUC medio para todas las semillas por cada Fold es excepcional con el método del algoritmo de Naive Bayes. Como se puede observar, independientemente del método de selección de características aplicado, el rendimiento en los folds internos y externos es prácticamente el mismo, sin que el del externo supere al interno, que podría ser un signo de que el conjunto de datos ha sido mal construído, o de overfitting. En concreto se deben destacar los métodos de TodasVariables y StepAUC, por mantener el AUC promedio más alto, y el método de Asociación, por mantener el mismo rendimiento en los folds internos y externos, exhibiendo una gran capacidad de generalización y predicción. </span>
<span id="cb194-5359"><a href="#cb194-5359" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5360"><a href="#cb194-5360" aria-hidden="true" tabindex="-1"></a><span class="fu">#### AUC Medio Folds Externos</span></span>
<span id="cb194-5361"><a href="#cb194-5361" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5362"><a href="#cb194-5362" aria-hidden="true" tabindex="-1"></a>::: {.panel-tabset}</span>
<span id="cb194-5363"><a href="#cb194-5363" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5364"><a href="#cb194-5364" aria-hidden="true" tabindex="-1"></a><span class="fu">## TodasVariables</span></span>
<span id="cb194-5365"><a href="#cb194-5365" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5366"><a href="#cb194-5366" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message=FALSE, warning=FALSE}</span></span>
<span id="cb194-5367"><a href="#cb194-5367" aria-hidden="true" tabindex="-1"></a><span class="in">generate_outer_auc_violin_plot(NaiveBayes_TodasVariables_Metrics$performance_metrics)</span></span>
<span id="cb194-5368"><a href="#cb194-5368" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-5369"><a href="#cb194-5369" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5370"><a href="#cb194-5370" aria-hidden="true" tabindex="-1"></a><span class="fu">## Asociacion</span></span>
<span id="cb194-5371"><a href="#cb194-5371" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5372"><a href="#cb194-5372" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message=FALSE, warning=FALSE}</span></span>
<span id="cb194-5373"><a href="#cb194-5373" aria-hidden="true" tabindex="-1"></a><span class="in">generate_outer_auc_violin_plot(NaiveBayes_Asociacion_Metrics$performance_metrics)</span></span>
<span id="cb194-5374"><a href="#cb194-5374" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-5375"><a href="#cb194-5375" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5376"><a href="#cb194-5376" aria-hidden="true" tabindex="-1"></a><span class="fu">## StepAUC</span></span>
<span id="cb194-5377"><a href="#cb194-5377" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5378"><a href="#cb194-5378" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message=FALSE, warning=FALSE}</span></span>
<span id="cb194-5379"><a href="#cb194-5379" aria-hidden="true" tabindex="-1"></a><span class="in">generate_outer_auc_violin_plot(NaiveBayes_StepAUC_Metrics$performance_metrics)</span></span>
<span id="cb194-5380"><a href="#cb194-5380" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-5381"><a href="#cb194-5381" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5382"><a href="#cb194-5382" aria-hidden="true" tabindex="-1"></a><span class="fu">## Lasso</span></span>
<span id="cb194-5383"><a href="#cb194-5383" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5384"><a href="#cb194-5384" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message=FALSE, warning=FALSE}</span></span>
<span id="cb194-5385"><a href="#cb194-5385" aria-hidden="true" tabindex="-1"></a><span class="in">generate_outer_auc_violin_plot(NaiveBayes_Lasso_Metrics$performance_metrics)</span></span>
<span id="cb194-5386"><a href="#cb194-5386" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-5387"><a href="#cb194-5387" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5388"><a href="#cb194-5388" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb194-5389"><a href="#cb194-5389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5390"><a href="#cb194-5390" aria-hidden="true" tabindex="-1"></a>El método más destacable de este apartado podría ser el método de selección de características Lasso, ya que la dispersión del AUC se mantiene muy baja en los folds 1 y 5, y bastante estable en los folds 2 y 3, con la excepción del cuarto fold, el cual parece mostrar un valor de AUC bajo. La dispersión del resto de métodos es, en general, alta, sin embargo, hay que destacar que los métodos TodasVariables y StepAuc tienen la mediana en el valor de AUC alto, indicando que el, o los datos que causan la dispersión, pueden ser excepciones. </span>
<span id="cb194-5391"><a href="#cb194-5391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5392"><a href="#cb194-5392" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Comparativa Naive Bayes</span></span>
<span id="cb194-5393"><a href="#cb194-5393" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5396"><a href="#cb194-5396" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb194-5397"><a href="#cb194-5397" aria-hidden="true" tabindex="-1"></a>fig <span class="ot">&lt;-</span> <span class="fu">generate_combined_auc_3d_plot</span>(</span>
<span id="cb194-5398"><a href="#cb194-5398" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(</span>
<span id="cb194-5399"><a href="#cb194-5399" aria-hidden="true" tabindex="-1"></a>    NaiveBayes_TodasVariables_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb194-5400"><a href="#cb194-5400" aria-hidden="true" tabindex="-1"></a>    NaiveBayes_Asociacion_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb194-5401"><a href="#cb194-5401" aria-hidden="true" tabindex="-1"></a>    NaiveBayes_StepAUC_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb194-5402"><a href="#cb194-5402" aria-hidden="true" tabindex="-1"></a>    NaiveBayes_Lasso_Metrics<span class="sc">$</span>performance_metrics</span>
<span id="cb194-5403"><a href="#cb194-5403" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb194-5404"><a href="#cb194-5404" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">"Todas Variables"</span>, <span class="st">"Asociacion"</span>, <span class="st">"StepAUC"</span>, <span class="st">"Lasso"</span>)</span>
<span id="cb194-5405"><a href="#cb194-5405" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb194-5406"><a href="#cb194-5406" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5407"><a href="#cb194-5407" aria-hidden="true" tabindex="-1"></a>fig</span>
<span id="cb194-5408"><a href="#cb194-5408" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-5409"><a href="#cb194-5409" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5410"><a href="#cb194-5410" aria-hidden="true" tabindex="-1"></a>Los valores de AUC, para todos los métodos de selección de características aplicados, muestran una notable estabilidad, pareciendo que, independientemente de la semilla, las fluctuaciones entre folds se mantienen, indicando que el modelo aprende bien de los datos, siendo robusto a la incorporación de nuevos datos, y realizando buenas predicciones a futuro. La técnica que mejores métricas muestra es la de TodasVariables, seguida muy cerca por StepAUC, la cual muestra la ventaja de usar menos cantidad de características.  </span>
<span id="cb194-5411"><a href="#cb194-5411" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5412"><a href="#cb194-5412" aria-hidden="true" tabindex="-1"></a>::: {.panel-tabset}</span>
<span id="cb194-5413"><a href="#cb194-5413" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5414"><a href="#cb194-5414" aria-hidden="true" tabindex="-1"></a><span class="fu">## TodasVariables</span></span>
<span id="cb194-5415"><a href="#cb194-5415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5418"><a href="#cb194-5418" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb194-5419"><a href="#cb194-5419" aria-hidden="true" tabindex="-1"></a><span class="fu">generate_auc_per_seed_and_fold</span>(NaiveBayes_TodasVariables_Metrics<span class="sc">$</span>performance_metrics)</span>
<span id="cb194-5420"><a href="#cb194-5420" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-5421"><a href="#cb194-5421" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5422"><a href="#cb194-5422" aria-hidden="true" tabindex="-1"></a><span class="fu">## Asociacion</span></span>
<span id="cb194-5423"><a href="#cb194-5423" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5426"><a href="#cb194-5426" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb194-5427"><a href="#cb194-5427" aria-hidden="true" tabindex="-1"></a><span class="fu">generate_auc_per_seed_and_fold</span>(NaiveBayes_Asociacion_Metrics<span class="sc">$</span>performance_metrics)</span>
<span id="cb194-5428"><a href="#cb194-5428" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-5429"><a href="#cb194-5429" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5430"><a href="#cb194-5430" aria-hidden="true" tabindex="-1"></a><span class="fu">## StepAUC</span></span>
<span id="cb194-5431"><a href="#cb194-5431" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5434"><a href="#cb194-5434" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb194-5435"><a href="#cb194-5435" aria-hidden="true" tabindex="-1"></a><span class="fu">generate_auc_per_seed_and_fold</span>(NaiveBayes_StepAUC_Metrics<span class="sc">$</span>performance_metrics)</span>
<span id="cb194-5436"><a href="#cb194-5436" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-5437"><a href="#cb194-5437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5438"><a href="#cb194-5438" aria-hidden="true" tabindex="-1"></a><span class="fu">## Lasso</span></span>
<span id="cb194-5439"><a href="#cb194-5439" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5442"><a href="#cb194-5442" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb194-5443"><a href="#cb194-5443" aria-hidden="true" tabindex="-1"></a><span class="fu">generate_auc_per_seed_and_fold</span>(NaiveBayes_Lasso_Metrics<span class="sc">$</span>performance_metrics)</span>
<span id="cb194-5444"><a href="#cb194-5444" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-5445"><a href="#cb194-5445" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5446"><a href="#cb194-5446" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb194-5447"><a href="#cb194-5447" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5448"><a href="#cb194-5448" aria-hidden="true" tabindex="-1"></a><span class="fu">### AdaBoost</span></span>
<span id="cb194-5449"><a href="#cb194-5449" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5450"><a href="#cb194-5450" aria-hidden="true" tabindex="-1"></a><span class="fu">#### AUC Fold Interno vs Externo</span></span>
<span id="cb194-5451"><a href="#cb194-5451" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5452"><a href="#cb194-5452" aria-hidden="true" tabindex="-1"></a>::: {.panel-tabset}</span>
<span id="cb194-5453"><a href="#cb194-5453" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5454"><a href="#cb194-5454" aria-hidden="true" tabindex="-1"></a><span class="fu">## TodasVariables</span></span>
<span id="cb194-5455"><a href="#cb194-5455" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5458"><a href="#cb194-5458" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb194-5459"><a href="#cb194-5459" aria-hidden="true" tabindex="-1"></a><span class="fu">generate_inner_outer_auc_comparison</span>(AdaBoost_TodasVariables_Metrics<span class="sc">$</span>inner_fold_metrics, AdaBoost_TodasVariables_Metrics<span class="sc">$</span>performance_metrics)</span>
<span id="cb194-5460"><a href="#cb194-5460" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-5461"><a href="#cb194-5461" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5462"><a href="#cb194-5462" aria-hidden="true" tabindex="-1"></a><span class="fu">## Asociacion</span></span>
<span id="cb194-5463"><a href="#cb194-5463" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5466"><a href="#cb194-5466" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb194-5467"><a href="#cb194-5467" aria-hidden="true" tabindex="-1"></a><span class="fu">generate_inner_outer_auc_comparison</span>(AdaBoost_Asociacion_Metrics<span class="sc">$</span>inner_fold_metrics, AdaBoost_Asociacion_Metrics<span class="sc">$</span>performance_metrics)</span>
<span id="cb194-5468"><a href="#cb194-5468" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-5469"><a href="#cb194-5469" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5470"><a href="#cb194-5470" aria-hidden="true" tabindex="-1"></a><span class="fu">## StepAUC</span></span>
<span id="cb194-5471"><a href="#cb194-5471" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5474"><a href="#cb194-5474" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb194-5475"><a href="#cb194-5475" aria-hidden="true" tabindex="-1"></a><span class="fu">generate_inner_outer_auc_comparison</span>(AdaBoost_StepAUC_Metrics<span class="sc">$</span>inner_fold_metrics, AdaBoost_StepAUC_Metrics<span class="sc">$</span>performance_metrics)</span>
<span id="cb194-5476"><a href="#cb194-5476" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-5477"><a href="#cb194-5477" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5478"><a href="#cb194-5478" aria-hidden="true" tabindex="-1"></a><span class="fu">## Lasso</span></span>
<span id="cb194-5479"><a href="#cb194-5479" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5482"><a href="#cb194-5482" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb194-5483"><a href="#cb194-5483" aria-hidden="true" tabindex="-1"></a><span class="fu">generate_inner_outer_auc_comparison</span>(AdaBoost_Lasso_Metrics<span class="sc">$</span>inner_fold_metrics, AdaBoost_Lasso_Metrics<span class="sc">$</span>performance_metrics)</span>
<span id="cb194-5484"><a href="#cb194-5484" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-5485"><a href="#cb194-5485" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5486"><a href="#cb194-5486" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb194-5487"><a href="#cb194-5487" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5488"><a href="#cb194-5488" aria-hidden="true" tabindex="-1"></a>Se puede observar que todos los métodos de selección de características mantienen un rendimiento mayor en los folds internos que externos, asegurando así que el conjunto de datos está bien construído. Sin embargo, **el método donde más pareados parecen estar estos dos valores, y por ello donde el modelo final podría tener una mayor capacidad de generalización, es en el método de selección de variables Lasso**.</span>
<span id="cb194-5489"><a href="#cb194-5489" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5490"><a href="#cb194-5490" aria-hidden="true" tabindex="-1"></a><span class="fu">#### AUC Medio Folds Externos</span></span>
<span id="cb194-5491"><a href="#cb194-5491" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5492"><a href="#cb194-5492" aria-hidden="true" tabindex="-1"></a>::: {.panel-tabset}</span>
<span id="cb194-5493"><a href="#cb194-5493" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5494"><a href="#cb194-5494" aria-hidden="true" tabindex="-1"></a><span class="fu">## TodasVariables</span></span>
<span id="cb194-5495"><a href="#cb194-5495" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5496"><a href="#cb194-5496" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message=FALSE, warning=FALSE}</span></span>
<span id="cb194-5497"><a href="#cb194-5497" aria-hidden="true" tabindex="-1"></a><span class="in">generate_outer_auc_violin_plot(AdaBoost_TodasVariables_Metrics$performance_metrics)</span></span>
<span id="cb194-5498"><a href="#cb194-5498" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-5499"><a href="#cb194-5499" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5500"><a href="#cb194-5500" aria-hidden="true" tabindex="-1"></a><span class="fu">## Asociacion</span></span>
<span id="cb194-5501"><a href="#cb194-5501" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5502"><a href="#cb194-5502" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message=FALSE, warning=FALSE}</span></span>
<span id="cb194-5503"><a href="#cb194-5503" aria-hidden="true" tabindex="-1"></a><span class="in">generate_outer_auc_violin_plot(AdaBoost_Asociacion_Metrics$performance_metrics)</span></span>
<span id="cb194-5504"><a href="#cb194-5504" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-5505"><a href="#cb194-5505" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5506"><a href="#cb194-5506" aria-hidden="true" tabindex="-1"></a><span class="fu">## StepAUC</span></span>
<span id="cb194-5507"><a href="#cb194-5507" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5508"><a href="#cb194-5508" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message=FALSE, warning=FALSE}</span></span>
<span id="cb194-5509"><a href="#cb194-5509" aria-hidden="true" tabindex="-1"></a><span class="in">generate_outer_auc_violin_plot(AdaBoost_StepAUC_Metrics$performance_metrics)</span></span>
<span id="cb194-5510"><a href="#cb194-5510" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-5511"><a href="#cb194-5511" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5512"><a href="#cb194-5512" aria-hidden="true" tabindex="-1"></a><span class="fu">## Lasso</span></span>
<span id="cb194-5513"><a href="#cb194-5513" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5514"><a href="#cb194-5514" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message=FALSE, warning=FALSE}</span></span>
<span id="cb194-5515"><a href="#cb194-5515" aria-hidden="true" tabindex="-1"></a><span class="in">generate_outer_auc_violin_plot(AdaBoost_Lasso_Metrics$performance_metrics)</span></span>
<span id="cb194-5516"><a href="#cb194-5516" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-5517"><a href="#cb194-5517" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5518"><a href="#cb194-5518" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb194-5519"><a href="#cb194-5519" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5520"><a href="#cb194-5520" aria-hidden="true" tabindex="-1"></a>En el método TodasVariables se puede observar una alta dispersión en todos los folds, con el cuarto siendo el que menos muestra, pero para el cual la mediana es de menor valor. Para el método Asociación, se puede observar que el segundo fold muestra una muy baja dispersión y un valor de AUC medio alto, sin embargo, los folds 1 y 5 muestran características totalmente opuestas. El método stepAUC podría ser una mezcla entre los dos anteriores, mostrando una dispersión hacia valores altos de AUC, pero, debido a que la mayoría de muestras caen en valores algo más mediocres de AUC, la media está más centrada en la escala. Por último, El método Lasso muestra una estabilidad en la dispersión de los AUC, ya que todos los folds están igual de dispersos, manteniendo las medianas en los mismos valores aproximadamente, sin embargo, también parecer ser el método con más outliers. Podemos concluir que parece que **los métodos Lasso y Asociación son algo más apropiados en cuanto a la robustez de los datos de entrada** al modelo.  </span>
<span id="cb194-5521"><a href="#cb194-5521" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5522"><a href="#cb194-5522" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Comparativa AdaBoost</span></span>
<span id="cb194-5525"><a href="#cb194-5525" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb194-5526"><a href="#cb194-5526" aria-hidden="true" tabindex="-1"></a>fig <span class="ot">&lt;-</span> <span class="fu">generate_combined_auc_3d_plot</span>(</span>
<span id="cb194-5527"><a href="#cb194-5527" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(</span>
<span id="cb194-5528"><a href="#cb194-5528" aria-hidden="true" tabindex="-1"></a>    AdaBoost_TodasVariables_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb194-5529"><a href="#cb194-5529" aria-hidden="true" tabindex="-1"></a>    AdaBoost_Asociacion_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb194-5530"><a href="#cb194-5530" aria-hidden="true" tabindex="-1"></a>    AdaBoost_StepAUC_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb194-5531"><a href="#cb194-5531" aria-hidden="true" tabindex="-1"></a>    AdaBoost_Lasso_Metrics<span class="sc">$</span>performance_metrics</span>
<span id="cb194-5532"><a href="#cb194-5532" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb194-5533"><a href="#cb194-5533" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">"Todas Variables"</span>, <span class="st">"Asociacion"</span>, <span class="st">"StepAUC"</span>, <span class="st">"Lasso"</span>)</span>
<span id="cb194-5534"><a href="#cb194-5534" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb194-5535"><a href="#cb194-5535" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5536"><a href="#cb194-5536" aria-hidden="true" tabindex="-1"></a>fig</span>
<span id="cb194-5537"><a href="#cb194-5537" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5538"><a href="#cb194-5538" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-5539"><a href="#cb194-5539" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5540"><a href="#cb194-5540" aria-hidden="true" tabindex="-1"></a>Se puede observar que la dispersión de las medidas de AUC a través de los Folds no es demasiado alta, manteniendo estos valores entre .65 y .8, adicionalmente, parece que todos los puntos siguen un patrón a lo largo de las semillas para los folds generados, transmitiendo que el modelo es robusto a la aleatoriedad de la división de los datos, y concluyendo que es robusto ante nuevos datos, con una buena capacidad de predicción. Estos patrones que se repiten pueden incluir una tendencia a la disminución del AUC en el fold 1, una inestabilidad en el fold 2, una estabilidad en el 3, y una tendencia a la mejora en el 4 y 5. Por otra aprte, el modelo que parece haber obtenido mejores métricas es el que ha empleado la selección de características Lasso, concordando con lo concluído en las anteriores secciones. </span>
<span id="cb194-5541"><a href="#cb194-5541" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5542"><a href="#cb194-5542" aria-hidden="true" tabindex="-1"></a>::: {.panel-tabset}</span>
<span id="cb194-5543"><a href="#cb194-5543" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5544"><a href="#cb194-5544" aria-hidden="true" tabindex="-1"></a><span class="fu">## TodasVariables</span></span>
<span id="cb194-5545"><a href="#cb194-5545" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5548"><a href="#cb194-5548" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb194-5549"><a href="#cb194-5549" aria-hidden="true" tabindex="-1"></a><span class="fu">generate_auc_per_seed_and_fold</span>(AdaBoost_TodasVariables_Metrics<span class="sc">$</span>performance_metrics)</span>
<span id="cb194-5550"><a href="#cb194-5550" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-5551"><a href="#cb194-5551" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5552"><a href="#cb194-5552" aria-hidden="true" tabindex="-1"></a><span class="fu">## Asociacion</span></span>
<span id="cb194-5553"><a href="#cb194-5553" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5556"><a href="#cb194-5556" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb194-5557"><a href="#cb194-5557" aria-hidden="true" tabindex="-1"></a><span class="fu">generate_auc_per_seed_and_fold</span>(AdaBoost_Asociacion_Metrics<span class="sc">$</span>performance_metrics)</span>
<span id="cb194-5558"><a href="#cb194-5558" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-5559"><a href="#cb194-5559" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5560"><a href="#cb194-5560" aria-hidden="true" tabindex="-1"></a><span class="fu">## StepAUC</span></span>
<span id="cb194-5561"><a href="#cb194-5561" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5564"><a href="#cb194-5564" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb194-5565"><a href="#cb194-5565" aria-hidden="true" tabindex="-1"></a><span class="fu">generate_auc_per_seed_and_fold</span>(AdaBoost_StepAUC_Metrics<span class="sc">$</span>performance_metrics)</span>
<span id="cb194-5566"><a href="#cb194-5566" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-5567"><a href="#cb194-5567" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5568"><a href="#cb194-5568" aria-hidden="true" tabindex="-1"></a><span class="fu">## Lasso</span></span>
<span id="cb194-5569"><a href="#cb194-5569" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5572"><a href="#cb194-5572" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb194-5573"><a href="#cb194-5573" aria-hidden="true" tabindex="-1"></a><span class="fu">generate_auc_per_seed_and_fold</span>(AdaBoost_Lasso_Metrics<span class="sc">$</span>performance_metrics)</span>
<span id="cb194-5574"><a href="#cb194-5574" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-5575"><a href="#cb194-5575" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5576"><a href="#cb194-5576" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb194-5577"><a href="#cb194-5577" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5578"><a href="#cb194-5578" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5579"><a href="#cb194-5579" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5580"><a href="#cb194-5580" aria-hidden="true" tabindex="-1"></a><span class="fu">### KNN </span></span>
<span id="cb194-5581"><a href="#cb194-5581" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5582"><a href="#cb194-5582" aria-hidden="true" tabindex="-1"></a><span class="fu">#### AUC Fold Interno vs Externo</span></span>
<span id="cb194-5583"><a href="#cb194-5583" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5584"><a href="#cb194-5584" aria-hidden="true" tabindex="-1"></a>::: {.panel-tabset}</span>
<span id="cb194-5585"><a href="#cb194-5585" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5586"><a href="#cb194-5586" aria-hidden="true" tabindex="-1"></a><span class="fu">## TodasVariables</span></span>
<span id="cb194-5587"><a href="#cb194-5587" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5590"><a href="#cb194-5590" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb194-5591"><a href="#cb194-5591" aria-hidden="true" tabindex="-1"></a><span class="fu">generate_inner_outer_auc_comparison</span>(KNN_TodasVariables_Metrics<span class="sc">$</span>inner_fold_metrics,</span>
<span id="cb194-5592"><a href="#cb194-5592" aria-hidden="true" tabindex="-1"></a>                                    KNN_TodasVariables_Metrics<span class="sc">$</span>performance_metrics)</span>
<span id="cb194-5593"><a href="#cb194-5593" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-5594"><a href="#cb194-5594" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5595"><a href="#cb194-5595" aria-hidden="true" tabindex="-1"></a><span class="fu">## Asociacion</span></span>
<span id="cb194-5596"><a href="#cb194-5596" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5599"><a href="#cb194-5599" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb194-5600"><a href="#cb194-5600" aria-hidden="true" tabindex="-1"></a><span class="fu">generate_inner_outer_auc_comparison</span>(KNN_Asociacion_Metrics<span class="sc">$</span>inner_fold_metrics,</span>
<span id="cb194-5601"><a href="#cb194-5601" aria-hidden="true" tabindex="-1"></a>                                    KNN_Asociacion_Metrics<span class="sc">$</span>performance_metrics)</span>
<span id="cb194-5602"><a href="#cb194-5602" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-5603"><a href="#cb194-5603" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5604"><a href="#cb194-5604" aria-hidden="true" tabindex="-1"></a><span class="fu">## StepAUC</span></span>
<span id="cb194-5605"><a href="#cb194-5605" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5608"><a href="#cb194-5608" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb194-5609"><a href="#cb194-5609" aria-hidden="true" tabindex="-1"></a><span class="fu">generate_inner_outer_auc_comparison</span>(KNN_StepAUC_Metrics<span class="sc">$</span>inner_fold_metrics, </span>
<span id="cb194-5610"><a href="#cb194-5610" aria-hidden="true" tabindex="-1"></a>                                    KNN_StepAUC_Metrics<span class="sc">$</span>performance_metrics)</span>
<span id="cb194-5611"><a href="#cb194-5611" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-5612"><a href="#cb194-5612" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5613"><a href="#cb194-5613" aria-hidden="true" tabindex="-1"></a><span class="fu">## Lasso</span></span>
<span id="cb194-5614"><a href="#cb194-5614" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5617"><a href="#cb194-5617" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb194-5618"><a href="#cb194-5618" aria-hidden="true" tabindex="-1"></a><span class="fu">generate_inner_outer_auc_comparison</span>(KNN_Lasso_Metrics<span class="sc">$</span>inner_fold_metrics, </span>
<span id="cb194-5619"><a href="#cb194-5619" aria-hidden="true" tabindex="-1"></a>                                    KNN_Lasso_Metrics<span class="sc">$</span>performance_metrics)</span>
<span id="cb194-5620"><a href="#cb194-5620" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-5621"><a href="#cb194-5621" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5622"><a href="#cb194-5622" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb194-5623"><a href="#cb194-5623" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5624"><a href="#cb194-5624" aria-hidden="true" tabindex="-1"></a>Habiendo observados las gráficas de comparación del AUC de los folds internos contra los externos, se puede percibir que todos los métodos de selección de características proveen al KNN de una estabilidad robusta frente a predicciones, demostrado a través de la igualdad entre el AUC medio interno y externo. En los métodos TodasVariables, Asociación, y Lasso, se pueden observar que el AUC externo de los primeros folds incluso llega a superar al interno, si este comportamiento se repitiera de una manera más exagerada se podría sospechar de un sobreajuste o fuga de muestras de test en train, sin embargo, en este caso, parece que es un hecho más que resalta la capacidad de generalización del modelo KNN para nuestro problema. La contraparte es, que el AUC máximo no es tan alto como otros modelos que hemos observado anteriormente, sin embargo, de este análisis se puede concluir que el KNN es robusto al entrenamiento con datos aleatorios.   </span>
<span id="cb194-5625"><a href="#cb194-5625" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5626"><a href="#cb194-5626" aria-hidden="true" tabindex="-1"></a><span class="fu">#### AUC Medio Folds Externos</span></span>
<span id="cb194-5627"><a href="#cb194-5627" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5628"><a href="#cb194-5628" aria-hidden="true" tabindex="-1"></a>::: {.panel-tabset}</span>
<span id="cb194-5629"><a href="#cb194-5629" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5630"><a href="#cb194-5630" aria-hidden="true" tabindex="-1"></a><span class="fu">## TodasVariables</span></span>
<span id="cb194-5631"><a href="#cb194-5631" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5632"><a href="#cb194-5632" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message=FALSE, warning=FALSE}</span></span>
<span id="cb194-5633"><a href="#cb194-5633" aria-hidden="true" tabindex="-1"></a><span class="in">generate_outer_auc_violin_plot(KNN_TodasVariables_Metrics$performance_metrics)</span></span>
<span id="cb194-5634"><a href="#cb194-5634" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-5635"><a href="#cb194-5635" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5636"><a href="#cb194-5636" aria-hidden="true" tabindex="-1"></a><span class="fu">## Asociacion</span></span>
<span id="cb194-5637"><a href="#cb194-5637" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5638"><a href="#cb194-5638" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message=FALSE, warning=FALSE}</span></span>
<span id="cb194-5639"><a href="#cb194-5639" aria-hidden="true" tabindex="-1"></a><span class="in">generate_outer_auc_violin_plot(KNN_Asociacion_Metrics$performance_metrics)</span></span>
<span id="cb194-5640"><a href="#cb194-5640" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-5641"><a href="#cb194-5641" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5642"><a href="#cb194-5642" aria-hidden="true" tabindex="-1"></a><span class="fu">## StepAUC</span></span>
<span id="cb194-5643"><a href="#cb194-5643" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5644"><a href="#cb194-5644" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message=FALSE, warning=FALSE}</span></span>
<span id="cb194-5645"><a href="#cb194-5645" aria-hidden="true" tabindex="-1"></a><span class="in">generate_outer_auc_violin_plot(KNN_StepAUC_Metrics$performance_metrics)</span></span>
<span id="cb194-5646"><a href="#cb194-5646" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-5647"><a href="#cb194-5647" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5648"><a href="#cb194-5648" aria-hidden="true" tabindex="-1"></a><span class="fu">## Lasso</span></span>
<span id="cb194-5649"><a href="#cb194-5649" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5650"><a href="#cb194-5650" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message=FALSE, warning=FALSE}</span></span>
<span id="cb194-5651"><a href="#cb194-5651" aria-hidden="true" tabindex="-1"></a><span class="in">generate_outer_auc_violin_plot(KNN_Lasso_Metrics$performance_metrics)</span></span>
<span id="cb194-5652"><a href="#cb194-5652" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-5653"><a href="#cb194-5653" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5654"><a href="#cb194-5654" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb194-5655"><a href="#cb194-5655" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5656"><a href="#cb194-5656" aria-hidden="true" tabindex="-1"></a>A partir de los gráficos de violín del AUC por cada Fold, se deben destar dos métodos, el primero de ellos siendo el método StepAUC, que muestra una dispersión relativamente alta, pero centrada alrededor de valores altos de AUC, indicando que el modelo tiene una buena capacidad predictiva, pero no es muy robusto. En el otro extremo, se encuentra el método de Asociación, el cual tiene valores máximos de AUC algo más bajos, pero su dispersión es mucho menor, haciendo que la media global del AUC pueda acabar siendo más alta para este método, ya que se vería menos afectado por valores atípicos pequeños.   </span>
<span id="cb194-5657"><a href="#cb194-5657" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5658"><a href="#cb194-5658" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Comparativa KNN </span></span>
<span id="cb194-5661"><a href="#cb194-5661" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb194-5662"><a href="#cb194-5662" aria-hidden="true" tabindex="-1"></a>fig <span class="ot">&lt;-</span> <span class="fu">generate_combined_auc_3d_plot</span>(</span>
<span id="cb194-5663"><a href="#cb194-5663" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(</span>
<span id="cb194-5664"><a href="#cb194-5664" aria-hidden="true" tabindex="-1"></a>    KNN_TodasVariables_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb194-5665"><a href="#cb194-5665" aria-hidden="true" tabindex="-1"></a>    KNN_Asociacion_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb194-5666"><a href="#cb194-5666" aria-hidden="true" tabindex="-1"></a>    KNN_StepAUC_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb194-5667"><a href="#cb194-5667" aria-hidden="true" tabindex="-1"></a>    KNN_Lasso_Metrics<span class="sc">$</span>performance_metrics</span>
<span id="cb194-5668"><a href="#cb194-5668" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb194-5669"><a href="#cb194-5669" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">"Todas Variables"</span>, <span class="st">"Asociacion"</span>, <span class="st">"StepAUC"</span>, <span class="st">"Lasso"</span>)</span>
<span id="cb194-5670"><a href="#cb194-5670" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb194-5671"><a href="#cb194-5671" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5672"><a href="#cb194-5672" aria-hidden="true" tabindex="-1"></a>fig</span>
<span id="cb194-5673"><a href="#cb194-5673" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5674"><a href="#cb194-5674" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-5675"><a href="#cb194-5675" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5676"><a href="#cb194-5676" aria-hidden="true" tabindex="-1"></a>Respaldando los dos anteriores contrastes, y observando la gráfica del valor de AUC por fold y semilla, para cada método de selección de características, para el modelo KNN, se puede concluir que los dos métodos más destacados son el método Asociación y StepAUC, con 0.749 y 0.717 de AUC, respectivamente. Como se comentó anteriormente, el AUC elevado del método de asociación proviene de una baja dispersión de los datos, con una mediana alta, en la mayoría de sus pliegues, a lo largo de todas las semillas. Por otra parte, el método StepAUC, aunque con un AUC menor, muestra una capacidad predictiva notable y robusta. </span>
<span id="cb194-5677"><a href="#cb194-5677" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5678"><a href="#cb194-5678" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5679"><a href="#cb194-5679" aria-hidden="true" tabindex="-1"></a>::: {.panel-tabset}</span>
<span id="cb194-5680"><a href="#cb194-5680" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5681"><a href="#cb194-5681" aria-hidden="true" tabindex="-1"></a><span class="fu">## TodasVariables</span></span>
<span id="cb194-5682"><a href="#cb194-5682" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5683"><a href="#cb194-5683" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message=FALSE, warning=FALSE}</span></span>
<span id="cb194-5684"><a href="#cb194-5684" aria-hidden="true" tabindex="-1"></a><span class="in">generate_auc_per_seed_and_fold(RPart_TodasVariables_Metrics$performance_metrics)</span></span>
<span id="cb194-5685"><a href="#cb194-5685" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-5686"><a href="#cb194-5686" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5687"><a href="#cb194-5687" aria-hidden="true" tabindex="-1"></a><span class="fu">## Asociacion</span></span>
<span id="cb194-5688"><a href="#cb194-5688" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5689"><a href="#cb194-5689" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message=FALSE, warning=FALSE}</span></span>
<span id="cb194-5690"><a href="#cb194-5690" aria-hidden="true" tabindex="-1"></a><span class="in">generate_auc_per_seed_and_fold(RPart_Asociacion_Metrics$performance_metrics)</span></span>
<span id="cb194-5691"><a href="#cb194-5691" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-5692"><a href="#cb194-5692" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5693"><a href="#cb194-5693" aria-hidden="true" tabindex="-1"></a><span class="fu">## StepAUC</span></span>
<span id="cb194-5694"><a href="#cb194-5694" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5695"><a href="#cb194-5695" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message=FALSE, warning=FALSE}</span></span>
<span id="cb194-5696"><a href="#cb194-5696" aria-hidden="true" tabindex="-1"></a><span class="in">generate_auc_per_seed_and_fold(RPart_StepAUC_Metrics$performance_metrics)</span></span>
<span id="cb194-5697"><a href="#cb194-5697" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-5698"><a href="#cb194-5698" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5699"><a href="#cb194-5699" aria-hidden="true" tabindex="-1"></a><span class="fu">## Lasso</span></span>
<span id="cb194-5700"><a href="#cb194-5700" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5701"><a href="#cb194-5701" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message=FALSE, warning=FALSE}</span></span>
<span id="cb194-5702"><a href="#cb194-5702" aria-hidden="true" tabindex="-1"></a><span class="in">generate_auc_per_seed_and_fold(RPart_Lasso_Metrics$performance_metrics)</span></span>
<span id="cb194-5703"><a href="#cb194-5703" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-5704"><a href="#cb194-5704" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5705"><a href="#cb194-5705" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb194-5706"><a href="#cb194-5706" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5707"><a href="#cb194-5707" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5708"><a href="#cb194-5708" aria-hidden="true" tabindex="-1"></a><span class="fu">### Decision Tree </span></span>
<span id="cb194-5709"><a href="#cb194-5709" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5710"><a href="#cb194-5710" aria-hidden="true" tabindex="-1"></a><span class="fu">#### AUC Fold Interno vs Externo</span></span>
<span id="cb194-5711"><a href="#cb194-5711" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5712"><a href="#cb194-5712" aria-hidden="true" tabindex="-1"></a>::: {.panel-tabset}</span>
<span id="cb194-5713"><a href="#cb194-5713" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5714"><a href="#cb194-5714" aria-hidden="true" tabindex="-1"></a><span class="fu">## TodasVariables</span></span>
<span id="cb194-5715"><a href="#cb194-5715" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5718"><a href="#cb194-5718" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb194-5719"><a href="#cb194-5719" aria-hidden="true" tabindex="-1"></a><span class="fu">generate_inner_outer_auc_comparison</span>(RPart_TodasVariables_Metrics<span class="sc">$</span>inner_fold_metrics,</span>
<span id="cb194-5720"><a href="#cb194-5720" aria-hidden="true" tabindex="-1"></a>                                    RPart_TodasVariables_Metrics<span class="sc">$</span>performance_metrics)</span>
<span id="cb194-5721"><a href="#cb194-5721" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-5722"><a href="#cb194-5722" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5723"><a href="#cb194-5723" aria-hidden="true" tabindex="-1"></a><span class="fu">## Asociacion</span></span>
<span id="cb194-5724"><a href="#cb194-5724" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5727"><a href="#cb194-5727" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb194-5728"><a href="#cb194-5728" aria-hidden="true" tabindex="-1"></a><span class="fu">generate_inner_outer_auc_comparison</span>(RPart_Asociacion_Metrics<span class="sc">$</span>inner_fold_metrics,</span>
<span id="cb194-5729"><a href="#cb194-5729" aria-hidden="true" tabindex="-1"></a>                                    RPart_Asociacion_Metrics<span class="sc">$</span>performance_metrics)</span>
<span id="cb194-5730"><a href="#cb194-5730" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-5731"><a href="#cb194-5731" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5732"><a href="#cb194-5732" aria-hidden="true" tabindex="-1"></a><span class="fu">## StepAUC</span></span>
<span id="cb194-5733"><a href="#cb194-5733" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5736"><a href="#cb194-5736" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb194-5737"><a href="#cb194-5737" aria-hidden="true" tabindex="-1"></a><span class="fu">generate_inner_outer_auc_comparison</span>(RPart_StepAUC_Metrics<span class="sc">$</span>inner_fold_metrics, </span>
<span id="cb194-5738"><a href="#cb194-5738" aria-hidden="true" tabindex="-1"></a>                                    RPart_StepAUC_Metrics<span class="sc">$</span>performance_metrics)</span>
<span id="cb194-5739"><a href="#cb194-5739" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-5740"><a href="#cb194-5740" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5741"><a href="#cb194-5741" aria-hidden="true" tabindex="-1"></a><span class="fu">## Lasso</span></span>
<span id="cb194-5742"><a href="#cb194-5742" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5745"><a href="#cb194-5745" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb194-5746"><a href="#cb194-5746" aria-hidden="true" tabindex="-1"></a><span class="fu">generate_inner_outer_auc_comparison</span>(RPart_Lasso_Metrics<span class="sc">$</span>inner_fold_metrics, </span>
<span id="cb194-5747"><a href="#cb194-5747" aria-hidden="true" tabindex="-1"></a>                                    RPart_Lasso_Metrics<span class="sc">$</span>performance_metrics)</span>
<span id="cb194-5748"><a href="#cb194-5748" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-5749"><a href="#cb194-5749" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5750"><a href="#cb194-5750" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb194-5751"><a href="#cb194-5751" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5752"><a href="#cb194-5752" aria-hidden="true" tabindex="-1"></a>De la comparativa del AUC interno y externo para el método de los árboles de decisión se puede concluir que el rendimiento del modelo es subóptimo en varios sentidos. Por una parte, el AUC máximo de cada método parece no ser muy elevado, no llegando al $80%$ en ninguna de las ocasiones, adicionalmente, parece que rara vez el AUC de la predicción sobre el fold externo está parejo con el AUC de la validación del fold interno, mostrando así que la capacidad de generalización de este modelo es algo pobre.  </span>
<span id="cb194-5753"><a href="#cb194-5753" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5754"><a href="#cb194-5754" aria-hidden="true" tabindex="-1"></a><span class="fu">#### AUC Medio Folds Externos</span></span>
<span id="cb194-5755"><a href="#cb194-5755" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5756"><a href="#cb194-5756" aria-hidden="true" tabindex="-1"></a>::: {.panel-tabset}</span>
<span id="cb194-5757"><a href="#cb194-5757" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5758"><a href="#cb194-5758" aria-hidden="true" tabindex="-1"></a><span class="fu">## TodasVariables</span></span>
<span id="cb194-5759"><a href="#cb194-5759" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5760"><a href="#cb194-5760" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message=FALSE, warning=FALSE}</span></span>
<span id="cb194-5761"><a href="#cb194-5761" aria-hidden="true" tabindex="-1"></a><span class="in">generate_outer_auc_violin_plot(RPart_TodasVariables_Metrics$performance_metrics)</span></span>
<span id="cb194-5762"><a href="#cb194-5762" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-5763"><a href="#cb194-5763" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5764"><a href="#cb194-5764" aria-hidden="true" tabindex="-1"></a><span class="fu">## Asociacion</span></span>
<span id="cb194-5765"><a href="#cb194-5765" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5766"><a href="#cb194-5766" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message=FALSE, warning=FALSE}</span></span>
<span id="cb194-5767"><a href="#cb194-5767" aria-hidden="true" tabindex="-1"></a><span class="in">generate_outer_auc_violin_plot(RPart_Asociacion_Metrics$performance_metrics)</span></span>
<span id="cb194-5768"><a href="#cb194-5768" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-5769"><a href="#cb194-5769" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5770"><a href="#cb194-5770" aria-hidden="true" tabindex="-1"></a><span class="fu">## StepAUC</span></span>
<span id="cb194-5771"><a href="#cb194-5771" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5772"><a href="#cb194-5772" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message=FALSE, warning=FALSE}</span></span>
<span id="cb194-5773"><a href="#cb194-5773" aria-hidden="true" tabindex="-1"></a><span class="in">generate_outer_auc_violin_plot(RPart_StepAUC_Metrics$performance_metrics)</span></span>
<span id="cb194-5774"><a href="#cb194-5774" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-5775"><a href="#cb194-5775" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5776"><a href="#cb194-5776" aria-hidden="true" tabindex="-1"></a><span class="fu">## Lasso</span></span>
<span id="cb194-5777"><a href="#cb194-5777" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5778"><a href="#cb194-5778" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message=FALSE, warning=FALSE}</span></span>
<span id="cb194-5779"><a href="#cb194-5779" aria-hidden="true" tabindex="-1"></a><span class="in">generate_outer_auc_violin_plot(RPart_Lasso_Metrics$performance_metrics)</span></span>
<span id="cb194-5780"><a href="#cb194-5780" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-5781"><a href="#cb194-5781" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5782"><a href="#cb194-5782" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb194-5783"><a href="#cb194-5783" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5784"><a href="#cb194-5784" aria-hidden="true" tabindex="-1"></a>Confirmando las afirmaciones anteriores, parece que la dispersión del AUC por cada Fold es la causante de una baja media. Se puede observar un patrón constante a través de los folds de los diferentes métodos de selección de características, y es que la dispersión de los valores de AUC es muy alta, mostrando una inestabilidad en el modelo a la hora de poder realizar predicciones robustas sobre datos no vistos anteriormente. Se pueden observar algunas excepciones a la regla, como el fold 2 del método Asociación, que tiene una dispersión baja y una mediana que posiciona el correspondiente AUC como un valor competitivo, sin embargo, el resto de folds de este mismo método están en clara desventaja, pudiendo atribuir el éxito del segundo fold a una **distribución afortunada de los datos**. </span>
<span id="cb194-5785"><a href="#cb194-5785" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5786"><a href="#cb194-5786" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Comparativa Decision Tree </span></span>
<span id="cb194-5789"><a href="#cb194-5789" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb194-5790"><a href="#cb194-5790" aria-hidden="true" tabindex="-1"></a>fig <span class="ot">&lt;-</span> <span class="fu">generate_combined_auc_3d_plot</span>(</span>
<span id="cb194-5791"><a href="#cb194-5791" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(</span>
<span id="cb194-5792"><a href="#cb194-5792" aria-hidden="true" tabindex="-1"></a>    RPart_TodasVariables_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb194-5793"><a href="#cb194-5793" aria-hidden="true" tabindex="-1"></a>    RPart_Asociacion_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb194-5794"><a href="#cb194-5794" aria-hidden="true" tabindex="-1"></a>    RPart_StepAUC_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb194-5795"><a href="#cb194-5795" aria-hidden="true" tabindex="-1"></a>    RPart_Lasso_Metrics<span class="sc">$</span>performance_metrics</span>
<span id="cb194-5796"><a href="#cb194-5796" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb194-5797"><a href="#cb194-5797" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">"Todas Variables"</span>, <span class="st">"Asociacion"</span>, <span class="st">"StepAUC"</span>, <span class="st">"Lasso"</span>)</span>
<span id="cb194-5798"><a href="#cb194-5798" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb194-5799"><a href="#cb194-5799" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5800"><a href="#cb194-5800" aria-hidden="true" tabindex="-1"></a>fig</span>
<span id="cb194-5801"><a href="#cb194-5801" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5802"><a href="#cb194-5802" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-5803"><a href="#cb194-5803" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5804"><a href="#cb194-5804" aria-hidden="true" tabindex="-1"></a>Como se podría esperar por las observaciones anteriores, el AUC ofrecido por el ajuste de este modelo, tanto de sus hiperparámetros como de sus características, es relativamente bajo comparado con los modelos que se han comentado hasta ahora. Con un AUC global de 0.689, el método que no incluye una selección de variables (TodasVariables), podría ser considerado el más óptimo, sin embargo, se pueden observar claras fluctuaciones en el valor de su AUC para las diferentes semillas, demostrando que no es un método muy robusto a la hora de enfrentarse a datos aleatorios, siendo los folds 3 y 4 los más desfavorecidos para este método, llegando a obtener un AUC de 0.5 en el tercer fold de la semilla <span class="in">`123`</span>. </span>
<span id="cb194-5805"><a href="#cb194-5805" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5806"><a href="#cb194-5806" aria-hidden="true" tabindex="-1"></a>::: {.panel-tabset}</span>
<span id="cb194-5807"><a href="#cb194-5807" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5808"><a href="#cb194-5808" aria-hidden="true" tabindex="-1"></a><span class="fu">## TodasVariables</span></span>
<span id="cb194-5809"><a href="#cb194-5809" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5810"><a href="#cb194-5810" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message=FALSE, warning=FALSE}</span></span>
<span id="cb194-5811"><a href="#cb194-5811" aria-hidden="true" tabindex="-1"></a><span class="in">generate_auc_per_seed_and_fold(RPart_TodasVariables_Metrics$performance_metrics)</span></span>
<span id="cb194-5812"><a href="#cb194-5812" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-5813"><a href="#cb194-5813" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5814"><a href="#cb194-5814" aria-hidden="true" tabindex="-1"></a><span class="fu">## Asociacion</span></span>
<span id="cb194-5815"><a href="#cb194-5815" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5816"><a href="#cb194-5816" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message=FALSE, warning=FALSE}</span></span>
<span id="cb194-5817"><a href="#cb194-5817" aria-hidden="true" tabindex="-1"></a><span class="in">generate_auc_per_seed_and_fold(RPart_Asociacion_Metrics$performance_metrics)</span></span>
<span id="cb194-5818"><a href="#cb194-5818" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-5819"><a href="#cb194-5819" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5820"><a href="#cb194-5820" aria-hidden="true" tabindex="-1"></a><span class="fu">## StepAUC</span></span>
<span id="cb194-5821"><a href="#cb194-5821" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5822"><a href="#cb194-5822" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message=FALSE, warning=FALSE}</span></span>
<span id="cb194-5823"><a href="#cb194-5823" aria-hidden="true" tabindex="-1"></a><span class="in">generate_auc_per_seed_and_fold(RPart_StepAUC_Metrics$performance_metrics)</span></span>
<span id="cb194-5824"><a href="#cb194-5824" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-5825"><a href="#cb194-5825" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5826"><a href="#cb194-5826" aria-hidden="true" tabindex="-1"></a><span class="fu">## Lasso</span></span>
<span id="cb194-5827"><a href="#cb194-5827" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5828"><a href="#cb194-5828" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message=FALSE, warning=FALSE}</span></span>
<span id="cb194-5829"><a href="#cb194-5829" aria-hidden="true" tabindex="-1"></a><span class="in">generate_auc_per_seed_and_fold(RPart_Lasso_Metrics$performance_metrics)</span></span>
<span id="cb194-5830"><a href="#cb194-5830" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-5831"><a href="#cb194-5831" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5832"><a href="#cb194-5832" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb194-5833"><a href="#cb194-5833" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5834"><a href="#cb194-5834" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5835"><a href="#cb194-5835" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5836"><a href="#cb194-5836" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5837"><a href="#cb194-5837" aria-hidden="true" tabindex="-1"></a><span class="fu">### RandomForest</span></span>
<span id="cb194-5838"><a href="#cb194-5838" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5839"><a href="#cb194-5839" aria-hidden="true" tabindex="-1"></a><span class="fu">#### AUC Fold Interno vs Externo</span></span>
<span id="cb194-5840"><a href="#cb194-5840" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5841"><a href="#cb194-5841" aria-hidden="true" tabindex="-1"></a>::: {.panel-tabset}</span>
<span id="cb194-5842"><a href="#cb194-5842" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5843"><a href="#cb194-5843" aria-hidden="true" tabindex="-1"></a><span class="fu">## TodasVariables</span></span>
<span id="cb194-5844"><a href="#cb194-5844" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5847"><a href="#cb194-5847" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb194-5848"><a href="#cb194-5848" aria-hidden="true" tabindex="-1"></a><span class="fu">generate_inner_outer_auc_comparison</span>(RandomForest_TodasVariables_Metrics<span class="sc">$</span>inner_fold_metrics, RandomForest_TodasVariables_Metrics<span class="sc">$</span>performance_metrics)</span>
<span id="cb194-5849"><a href="#cb194-5849" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-5850"><a href="#cb194-5850" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5851"><a href="#cb194-5851" aria-hidden="true" tabindex="-1"></a><span class="fu">## Asociacion</span></span>
<span id="cb194-5852"><a href="#cb194-5852" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5855"><a href="#cb194-5855" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb194-5856"><a href="#cb194-5856" aria-hidden="true" tabindex="-1"></a><span class="fu">generate_inner_outer_auc_comparison</span>(RandomForest_Asociacion_Metrics<span class="sc">$</span>inner_fold_metrics, RandomForest_Asociacion_Metrics<span class="sc">$</span>performance_metrics)</span>
<span id="cb194-5857"><a href="#cb194-5857" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-5858"><a href="#cb194-5858" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5859"><a href="#cb194-5859" aria-hidden="true" tabindex="-1"></a><span class="fu">## StepAUC</span></span>
<span id="cb194-5860"><a href="#cb194-5860" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5863"><a href="#cb194-5863" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb194-5864"><a href="#cb194-5864" aria-hidden="true" tabindex="-1"></a><span class="fu">generate_inner_outer_auc_comparison</span>(RandomForest_StepAUC_Metrics<span class="sc">$</span>inner_fold_metrics, RandomForest_StepAUC_Metrics<span class="sc">$</span>performance_metrics)</span>
<span id="cb194-5865"><a href="#cb194-5865" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-5866"><a href="#cb194-5866" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5867"><a href="#cb194-5867" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5868"><a href="#cb194-5868" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb194-5869"><a href="#cb194-5869" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5870"><a href="#cb194-5870" aria-hidden="true" tabindex="-1"></a>Se puede observar que el rendimiento en para los Folds externos es notablemente más bajo que el rendimiento para los internos a lo largo de todos los métodos de selección de características. Este hecho denota que el modelo es estable y no se han cometido errores a la hora de evaluarlo, sin embargo, también resalta la pobre capacidad de generalización, incluso habiendo ajustado los hiperparámetros a sus mejores valores. </span>
<span id="cb194-5871"><a href="#cb194-5871" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5872"><a href="#cb194-5872" aria-hidden="true" tabindex="-1"></a><span class="fu">#### AUC Medio Folds Externos</span></span>
<span id="cb194-5873"><a href="#cb194-5873" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5874"><a href="#cb194-5874" aria-hidden="true" tabindex="-1"></a>::: {.panel-tabset}</span>
<span id="cb194-5875"><a href="#cb194-5875" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5876"><a href="#cb194-5876" aria-hidden="true" tabindex="-1"></a><span class="fu">## TodasVariables</span></span>
<span id="cb194-5877"><a href="#cb194-5877" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5878"><a href="#cb194-5878" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message=FALSE, warning=FALSE}</span></span>
<span id="cb194-5879"><a href="#cb194-5879" aria-hidden="true" tabindex="-1"></a><span class="in">generate_outer_auc_violin_plot(RandomForest_TodasVariables_Metrics$performance_metrics)</span></span>
<span id="cb194-5880"><a href="#cb194-5880" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-5881"><a href="#cb194-5881" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5882"><a href="#cb194-5882" aria-hidden="true" tabindex="-1"></a><span class="fu">## Asociacion</span></span>
<span id="cb194-5883"><a href="#cb194-5883" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5884"><a href="#cb194-5884" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message=FALSE, warning=FALSE}</span></span>
<span id="cb194-5885"><a href="#cb194-5885" aria-hidden="true" tabindex="-1"></a><span class="in">generate_outer_auc_violin_plot(RandomForest_Asociacion_Metrics$performance_metrics)</span></span>
<span id="cb194-5886"><a href="#cb194-5886" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-5887"><a href="#cb194-5887" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5888"><a href="#cb194-5888" aria-hidden="true" tabindex="-1"></a><span class="fu">## StepAUC</span></span>
<span id="cb194-5889"><a href="#cb194-5889" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5890"><a href="#cb194-5890" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message=FALSE, warning=FALSE}</span></span>
<span id="cb194-5891"><a href="#cb194-5891" aria-hidden="true" tabindex="-1"></a><span class="in">generate_outer_auc_violin_plot(RandomForest_StepAUC_Metrics$performance_metrics)</span></span>
<span id="cb194-5892"><a href="#cb194-5892" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-5893"><a href="#cb194-5893" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5894"><a href="#cb194-5894" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5895"><a href="#cb194-5895" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb194-5896"><a href="#cb194-5896" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5897"><a href="#cb194-5897" aria-hidden="true" tabindex="-1"></a>En el método TodasVariables se puede observar que la dispersión del Fold 1 es muy baja y centrada en un valor alto del AUC, sin embargo, el resto de folds tienen una varianza alta, demostrando una baja capacidad de generalización y predicción. Por otra parte, el método Asociación muestra una baja dispersión en los Folds 1, 2 y 5, con alguna excepción en los Folds 3 y 4, adicionalmente, todos los Folds están centrados alrededor de un valor de AUC común, que se sitúa entre el 0.62 y el 0.68, mostrando una estabilidad. Finalmente, el método StepAUC muestra una alta dispersión en el primer y último Fold, pero un alto valor de AUC promedio, al igual que el primer método. Se puede concluir que, para este modelo, el método de selección de características más adecuado podría ser el de TodasVariables. </span>
<span id="cb194-5898"><a href="#cb194-5898" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5899"><a href="#cb194-5899" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Comparativa RandomForest</span></span>
<span id="cb194-5902"><a href="#cb194-5902" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb194-5903"><a href="#cb194-5903" aria-hidden="true" tabindex="-1"></a>fig <span class="ot">&lt;-</span> <span class="fu">generate_combined_auc_3d_plot</span>(</span>
<span id="cb194-5904"><a href="#cb194-5904" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(</span>
<span id="cb194-5905"><a href="#cb194-5905" aria-hidden="true" tabindex="-1"></a>    RandomForest_TodasVariables_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb194-5906"><a href="#cb194-5906" aria-hidden="true" tabindex="-1"></a>    RandomForest_Asociacion_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb194-5907"><a href="#cb194-5907" aria-hidden="true" tabindex="-1"></a>    RandomForest_StepAUC_Metrics<span class="sc">$</span>performance_metrics</span>
<span id="cb194-5908"><a href="#cb194-5908" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb194-5909"><a href="#cb194-5909" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">"Todas Variables"</span>, <span class="st">"Asociacion"</span>, <span class="st">"StepAUC"</span>)</span>
<span id="cb194-5910"><a href="#cb194-5910" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb194-5911"><a href="#cb194-5911" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5912"><a href="#cb194-5912" aria-hidden="true" tabindex="-1"></a>fig</span>
<span id="cb194-5913"><a href="#cb194-5913" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5914"><a href="#cb194-5914" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-5915"><a href="#cb194-5915" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5916"><a href="#cb194-5916" aria-hidden="true" tabindex="-1"></a>Los métodos de selección más competitivos son StepAUC y TodasVariables, con AUC's de 0.677 y 0.682, respectivamente. Parece que, aunque el StepAUC muestre un mayor AUC global, la estabilidad del método hace que la dispersión del AUC sea más alta, teniendo un mínimo de 0.5 en la semila 27 para el Fold 1. Se podría concluir que el método más adecuado para el rendimiento con respecto al AUC del RandomForest es el de TodasVariables. </span>
<span id="cb194-5917"><a href="#cb194-5917" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5918"><a href="#cb194-5918" aria-hidden="true" tabindex="-1"></a>::: {.panel-tabset}</span>
<span id="cb194-5919"><a href="#cb194-5919" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5920"><a href="#cb194-5920" aria-hidden="true" tabindex="-1"></a><span class="fu">## TodasVariables</span></span>
<span id="cb194-5921"><a href="#cb194-5921" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5924"><a href="#cb194-5924" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb194-5925"><a href="#cb194-5925" aria-hidden="true" tabindex="-1"></a><span class="fu">generate_auc_per_seed_and_fold</span>(RandomForest_TodasVariables_Metrics<span class="sc">$</span>performance_metrics)</span>
<span id="cb194-5926"><a href="#cb194-5926" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-5927"><a href="#cb194-5927" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5928"><a href="#cb194-5928" aria-hidden="true" tabindex="-1"></a><span class="fu">## Asociacion</span></span>
<span id="cb194-5929"><a href="#cb194-5929" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5932"><a href="#cb194-5932" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb194-5933"><a href="#cb194-5933" aria-hidden="true" tabindex="-1"></a><span class="fu">generate_auc_per_seed_and_fold</span>(RandomForest_Asociacion_Metrics<span class="sc">$</span>performance_metrics)</span>
<span id="cb194-5934"><a href="#cb194-5934" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-5935"><a href="#cb194-5935" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5936"><a href="#cb194-5936" aria-hidden="true" tabindex="-1"></a><span class="fu">## StepAUC</span></span>
<span id="cb194-5937"><a href="#cb194-5937" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5940"><a href="#cb194-5940" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb194-5941"><a href="#cb194-5941" aria-hidden="true" tabindex="-1"></a><span class="fu">generate_auc_per_seed_and_fold</span>(RandomForest_StepAUC_Metrics<span class="sc">$</span>performance_metrics)</span>
<span id="cb194-5942"><a href="#cb194-5942" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-5943"><a href="#cb194-5943" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5944"><a href="#cb194-5944" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5945"><a href="#cb194-5945" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb194-5946"><a href="#cb194-5946" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5947"><a href="#cb194-5947" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5948"><a href="#cb194-5948" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5949"><a href="#cb194-5949" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5950"><a href="#cb194-5950" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5951"><a href="#cb194-5951" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5952"><a href="#cb194-5952" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5953"><a href="#cb194-5953" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5954"><a href="#cb194-5954" aria-hidden="true" tabindex="-1"></a><span class="fu">### SVM</span></span>
<span id="cb194-5955"><a href="#cb194-5955" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5956"><a href="#cb194-5956" aria-hidden="true" tabindex="-1"></a><span class="fu">#### AUC Fold Interno vs Externo</span></span>
<span id="cb194-5957"><a href="#cb194-5957" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5958"><a href="#cb194-5958" aria-hidden="true" tabindex="-1"></a>::: {.panel-tabset}</span>
<span id="cb194-5959"><a href="#cb194-5959" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5960"><a href="#cb194-5960" aria-hidden="true" tabindex="-1"></a><span class="fu">## TodasVariables</span></span>
<span id="cb194-5961"><a href="#cb194-5961" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5964"><a href="#cb194-5964" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb194-5965"><a href="#cb194-5965" aria-hidden="true" tabindex="-1"></a><span class="fu">generate_inner_outer_auc_comparison</span>(SVM_TodasVariables_Metrics<span class="sc">$</span>inner_fold_metrics, SVM_TodasVariables_Metrics<span class="sc">$</span>performance_metrics)</span>
<span id="cb194-5966"><a href="#cb194-5966" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-5967"><a href="#cb194-5967" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5968"><a href="#cb194-5968" aria-hidden="true" tabindex="-1"></a><span class="fu">## Asociacion</span></span>
<span id="cb194-5969"><a href="#cb194-5969" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5972"><a href="#cb194-5972" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb194-5973"><a href="#cb194-5973" aria-hidden="true" tabindex="-1"></a><span class="fu">generate_inner_outer_auc_comparison</span>(SVM_Asociacion_Metrics<span class="sc">$</span>inner_fold_metrics, SVM_Asociacion_Metrics<span class="sc">$</span>performance_metrics)</span>
<span id="cb194-5974"><a href="#cb194-5974" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-5975"><a href="#cb194-5975" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5976"><a href="#cb194-5976" aria-hidden="true" tabindex="-1"></a><span class="fu">## StepAUC</span></span>
<span id="cb194-5977"><a href="#cb194-5977" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5980"><a href="#cb194-5980" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb194-5981"><a href="#cb194-5981" aria-hidden="true" tabindex="-1"></a><span class="fu">generate_inner_outer_auc_comparison</span>(SVM_StepAUC_Metrics<span class="sc">$</span>inner_fold_metrics, SVM_StepAUC_Metrics<span class="sc">$</span>performance_metrics)</span>
<span id="cb194-5982"><a href="#cb194-5982" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-5983"><a href="#cb194-5983" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5984"><a href="#cb194-5984" aria-hidden="true" tabindex="-1"></a><span class="fu">## Lasso</span></span>
<span id="cb194-5985"><a href="#cb194-5985" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5988"><a href="#cb194-5988" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb194-5989"><a href="#cb194-5989" aria-hidden="true" tabindex="-1"></a><span class="fu">generate_inner_outer_auc_comparison</span>(SVM_Lasso_Metrics<span class="sc">$</span>inner_fold_metrics, SVM_Lasso_Metrics<span class="sc">$</span>performance_metrics)</span>
<span id="cb194-5990"><a href="#cb194-5990" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-5991"><a href="#cb194-5991" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5992"><a href="#cb194-5992" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb194-5993"><a href="#cb194-5993" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5994"><a href="#cb194-5994" aria-hidden="true" tabindex="-1"></a>En el método de todas las variables, el AUC medio en los inner folds es consistentemente mayor que en los outer folds. El método de todas las variables muestra valores notablemente bajos de AUC en el fold externo que en el interno, indicando estabilidad interna pero una pobre generalización. En el método de asociación, las diferencias entre los AUC medios de inner y outer folds son menores, sugiriendo una mejor generalización y consistencia en el rendimiento del modelo, llegando, de manera puntual y seguramente por outliers, a sobrepasar el rendimiento con test al rendimiento con la validación. El método stepAUC muestra una variabilidad similar a la de todas las variables, con inner folds generalmente superiores, pero con menos diferencia en comparación. Finalmente, el método Lasso presenta una paridad notable entre los AUC de inner y outer folds, reflejando una mayor estabilidad y generalización, con los valores más cercanos entre sí. En resumen, **los métodos de asociación y Lasso parecen ofrecer una mejor generalización y estabilidad en el rendimiento del modelo** en comparación con las técnicas que utilizan todas las variables y stepAUC.</span>
<span id="cb194-5995"><a href="#cb194-5995" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5996"><a href="#cb194-5996" aria-hidden="true" tabindex="-1"></a><span class="fu">#### AUC Medio Folds Externos</span></span>
<span id="cb194-5997"><a href="#cb194-5997" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5998"><a href="#cb194-5998" aria-hidden="true" tabindex="-1"></a>::: {.panel-tabset}</span>
<span id="cb194-5999"><a href="#cb194-5999" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6000"><a href="#cb194-6000" aria-hidden="true" tabindex="-1"></a><span class="fu">## TodasVariables</span></span>
<span id="cb194-6001"><a href="#cb194-6001" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6002"><a href="#cb194-6002" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message=FALSE, warning=FALSE}</span></span>
<span id="cb194-6003"><a href="#cb194-6003" aria-hidden="true" tabindex="-1"></a><span class="in">generate_outer_auc_violin_plot(SVM_TodasVariables_Metrics$performance_metrics)</span></span>
<span id="cb194-6004"><a href="#cb194-6004" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-6005"><a href="#cb194-6005" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6006"><a href="#cb194-6006" aria-hidden="true" tabindex="-1"></a><span class="fu">## Asociacion</span></span>
<span id="cb194-6007"><a href="#cb194-6007" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6008"><a href="#cb194-6008" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message=FALSE, warning=FALSE}</span></span>
<span id="cb194-6009"><a href="#cb194-6009" aria-hidden="true" tabindex="-1"></a><span class="in">generate_outer_auc_violin_plot(SVM_Asociacion_Metrics$performance_metrics)</span></span>
<span id="cb194-6010"><a href="#cb194-6010" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-6011"><a href="#cb194-6011" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6012"><a href="#cb194-6012" aria-hidden="true" tabindex="-1"></a><span class="fu">## StepAUC</span></span>
<span id="cb194-6013"><a href="#cb194-6013" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6014"><a href="#cb194-6014" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message=FALSE, warning=FALSE}</span></span>
<span id="cb194-6015"><a href="#cb194-6015" aria-hidden="true" tabindex="-1"></a><span class="in">generate_outer_auc_violin_plot(SVM_StepAUC_Metrics$performance_metrics)</span></span>
<span id="cb194-6016"><a href="#cb194-6016" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-6017"><a href="#cb194-6017" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6018"><a href="#cb194-6018" aria-hidden="true" tabindex="-1"></a><span class="fu">## Lasso</span></span>
<span id="cb194-6019"><a href="#cb194-6019" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6020"><a href="#cb194-6020" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message=FALSE, warning=FALSE}</span></span>
<span id="cb194-6021"><a href="#cb194-6021" aria-hidden="true" tabindex="-1"></a><span class="in">generate_outer_auc_violin_plot(SVM_Lasso_Metrics$performance_metrics)</span></span>
<span id="cb194-6022"><a href="#cb194-6022" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-6023"><a href="#cb194-6023" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6024"><a href="#cb194-6024" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb194-6025"><a href="#cb194-6025" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6026"><a href="#cb194-6026" aria-hidden="true" tabindex="-1"></a>En el método de todas las variables, se observa una mayor variabilidad en los valores de AUC, especialmente en el Fold 1, indicando inestabilidad en el rendimiento del modelo. El método de asociación presenta una distribución más compacta en general, con menos variabilidad, especialmente en los folds 1, 3 y 5, lo que sugiere una mayor consistencia en el rendimiento. El método stepAUC muestra una mayor variabilidad en el Fold 2, con un rango amplio de AUC, y menor consistencia en los folds 4 y 5. Finalmente, el método Lasso exhibe una distribución más equilibrada a través de todos los folds, con un AUC medio más alto, pero con una dispersión muy grande a pesar de todo. En conjunto, podríamos concluir que, **los métodos de asociación y, de manera secundaria, Lasso demuestran un rendimiento más confiable y menos variable en comparación con todas las variables y stepAUC**.</span>
<span id="cb194-6027"><a href="#cb194-6027" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6028"><a href="#cb194-6028" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Comparativa SVM</span></span>
<span id="cb194-6029"><a href="#cb194-6029" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6032"><a href="#cb194-6032" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb194-6033"><a href="#cb194-6033" aria-hidden="true" tabindex="-1"></a>fig <span class="ot">&lt;-</span> <span class="fu">generate_combined_auc_3d_plot</span>(</span>
<span id="cb194-6034"><a href="#cb194-6034" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(</span>
<span id="cb194-6035"><a href="#cb194-6035" aria-hidden="true" tabindex="-1"></a>    SVM_TodasVariables_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb194-6036"><a href="#cb194-6036" aria-hidden="true" tabindex="-1"></a>    SVM_Asociacion_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb194-6037"><a href="#cb194-6037" aria-hidden="true" tabindex="-1"></a>    SVM_StepAUC_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb194-6038"><a href="#cb194-6038" aria-hidden="true" tabindex="-1"></a>    SVM_Lasso_Metrics<span class="sc">$</span>performance_metrics</span>
<span id="cb194-6039"><a href="#cb194-6039" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb194-6040"><a href="#cb194-6040" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">"Todas Variables"</span>, <span class="st">"Asociacion"</span>, <span class="st">"StepAUC"</span>, <span class="st">"Lasso"</span>)</span>
<span id="cb194-6041"><a href="#cb194-6041" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb194-6042"><a href="#cb194-6042" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6043"><a href="#cb194-6043" aria-hidden="true" tabindex="-1"></a>fig</span>
<span id="cb194-6044"><a href="#cb194-6044" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6045"><a href="#cb194-6045" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-6046"><a href="#cb194-6046" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6047"><a href="#cb194-6047" aria-hidden="true" tabindex="-1"></a>Las gráficas comparativas del AUC para todos los métodos muestran una **notable inestabilidad en el rendimiento del SVM independientemente del método de selección de características utilizado**. Aunque el método Lasso presenta el AUC medio global más alto (0.64), seguido por la asociación (0.623), stepAUC (0.618) y todas las variables (0.617), en general, se observa una considerable variabilidad a través de diferentes semillas y folds. En todas las gráficas, los valores de AUC fluctúan significativamente, especialmente en los métodos de todas las variables y stepAUC, donde los puntos individuales muestran amplios rangos de dispersión. Incluso los métodos de selección de características que generalmente mejoran la estabilidad, como Lasso y asociación, no eliminan completamente la variabilidad, sugiriendo que el SVM es inherentemente inestable en este contexto. Esta inestabilidad destaca la dificultad del SVM para mantener un rendimiento consistente, lo que puede estar influenciado por la naturaleza de los datos y la sensibilidad del modelo a las particiones específicas de entrenamiento y prueba. </span>
<span id="cb194-6048"><a href="#cb194-6048" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6049"><a href="#cb194-6049" aria-hidden="true" tabindex="-1"></a>::: {.panel-tabset}</span>
<span id="cb194-6050"><a href="#cb194-6050" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6051"><a href="#cb194-6051" aria-hidden="true" tabindex="-1"></a><span class="fu">## TodasVariables</span></span>
<span id="cb194-6052"><a href="#cb194-6052" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6055"><a href="#cb194-6055" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb194-6056"><a href="#cb194-6056" aria-hidden="true" tabindex="-1"></a><span class="fu">generate_auc_per_seed_and_fold</span>(SVM_TodasVariables_Metrics<span class="sc">$</span>performance_metrics)</span>
<span id="cb194-6057"><a href="#cb194-6057" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-6058"><a href="#cb194-6058" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6059"><a href="#cb194-6059" aria-hidden="true" tabindex="-1"></a><span class="fu">## Asociacion</span></span>
<span id="cb194-6060"><a href="#cb194-6060" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6063"><a href="#cb194-6063" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb194-6064"><a href="#cb194-6064" aria-hidden="true" tabindex="-1"></a><span class="fu">generate_auc_per_seed_and_fold</span>(SVM_Asociacion_Metrics<span class="sc">$</span>performance_metrics)</span>
<span id="cb194-6065"><a href="#cb194-6065" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-6066"><a href="#cb194-6066" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6067"><a href="#cb194-6067" aria-hidden="true" tabindex="-1"></a><span class="fu">## StepAUC</span></span>
<span id="cb194-6068"><a href="#cb194-6068" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6071"><a href="#cb194-6071" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb194-6072"><a href="#cb194-6072" aria-hidden="true" tabindex="-1"></a><span class="fu">generate_auc_per_seed_and_fold</span>(SVM_StepAUC_Metrics<span class="sc">$</span>performance_metrics)</span>
<span id="cb194-6073"><a href="#cb194-6073" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-6074"><a href="#cb194-6074" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6075"><a href="#cb194-6075" aria-hidden="true" tabindex="-1"></a><span class="fu">## Lasso</span></span>
<span id="cb194-6076"><a href="#cb194-6076" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6079"><a href="#cb194-6079" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb194-6080"><a href="#cb194-6080" aria-hidden="true" tabindex="-1"></a><span class="fu">generate_auc_per_seed_and_fold</span>(SVM_Lasso_Metrics<span class="sc">$</span>performance_metrics)</span>
<span id="cb194-6081"><a href="#cb194-6081" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-6082"><a href="#cb194-6082" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6083"><a href="#cb194-6083" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb194-6084"><a href="#cb194-6084" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6085"><a href="#cb194-6085" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6086"><a href="#cb194-6086" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6087"><a href="#cb194-6087" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6088"><a href="#cb194-6088" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6089"><a href="#cb194-6089" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6090"><a href="#cb194-6090" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6091"><a href="#cb194-6091" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6092"><a href="#cb194-6092" aria-hidden="true" tabindex="-1"></a><span class="fu">### ANN</span></span>
<span id="cb194-6093"><a href="#cb194-6093" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6094"><a href="#cb194-6094" aria-hidden="true" tabindex="-1"></a><span class="fu">#### AUC Fold Interno vs Externo</span></span>
<span id="cb194-6095"><a href="#cb194-6095" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6096"><a href="#cb194-6096" aria-hidden="true" tabindex="-1"></a>::: {.panel-tabset}</span>
<span id="cb194-6097"><a href="#cb194-6097" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6098"><a href="#cb194-6098" aria-hidden="true" tabindex="-1"></a><span class="fu">## TodasVariables</span></span>
<span id="cb194-6099"><a href="#cb194-6099" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6102"><a href="#cb194-6102" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb194-6103"><a href="#cb194-6103" aria-hidden="true" tabindex="-1"></a><span class="fu">generate_inner_outer_auc_comparison</span>(ANN_TodasVariables_Metrics<span class="sc">$</span>inner_fold_metrics, ANN_TodasVariables_Metrics<span class="sc">$</span>performance_metrics)</span>
<span id="cb194-6104"><a href="#cb194-6104" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-6105"><a href="#cb194-6105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6106"><a href="#cb194-6106" aria-hidden="true" tabindex="-1"></a><span class="fu">## Asociacion</span></span>
<span id="cb194-6107"><a href="#cb194-6107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6110"><a href="#cb194-6110" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb194-6111"><a href="#cb194-6111" aria-hidden="true" tabindex="-1"></a><span class="fu">generate_inner_outer_auc_comparison</span>(ANN_Asociacion_Metrics<span class="sc">$</span>inner_fold_metrics, ANN_Asociacion_Metrics<span class="sc">$</span>performance_metrics)</span>
<span id="cb194-6112"><a href="#cb194-6112" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-6113"><a href="#cb194-6113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6114"><a href="#cb194-6114" aria-hidden="true" tabindex="-1"></a><span class="fu">## StepAUC</span></span>
<span id="cb194-6115"><a href="#cb194-6115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6118"><a href="#cb194-6118" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb194-6119"><a href="#cb194-6119" aria-hidden="true" tabindex="-1"></a><span class="fu">generate_inner_outer_auc_comparison</span>(ANN_StepAUC_Metrics<span class="sc">$</span>inner_fold_metrics, ANN_StepAUC_Metrics<span class="sc">$</span>performance_metrics)</span>
<span id="cb194-6120"><a href="#cb194-6120" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-6121"><a href="#cb194-6121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6122"><a href="#cb194-6122" aria-hidden="true" tabindex="-1"></a><span class="fu">## Lasso</span></span>
<span id="cb194-6123"><a href="#cb194-6123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6126"><a href="#cb194-6126" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb194-6127"><a href="#cb194-6127" aria-hidden="true" tabindex="-1"></a><span class="fu">generate_inner_outer_auc_comparison</span>(ANN_Lasso_Metrics<span class="sc">$</span>inner_fold_metrics, ANN_Lasso_Metrics<span class="sc">$</span>performance_metrics)</span>
<span id="cb194-6128"><a href="#cb194-6128" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-6129"><a href="#cb194-6129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6130"><a href="#cb194-6130" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb194-6131"><a href="#cb194-6131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6132"><a href="#cb194-6132" aria-hidden="true" tabindex="-1"></a>Todas las gráficas muestran que **en ningún momento el AUC del outer fold supera al del inner fold, lo que indica que no ha habido errores en la división de datos, confirmando la correcta implementación de la validación cruzada**. En general, el AUC medio de los inner folds es consistentemente mayor o igual al de los outer folds a través de todos los folds, sugiriendo que el modelo generaliza adecuadamente sin sobreajustarse a los datos de entrenamiento. La similitud en los AUC medios entre los inner y outer folds en la mayoría de los casos refleja una buena estabilidad y consistencia en el rendimiento de las redes neuronales, con algunas diferencias observadas que son esperadas y muestran la variabilidad en el rendimiento del modelo dependiendo de la partición de los datos. </span>
<span id="cb194-6133"><a href="#cb194-6133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6134"><a href="#cb194-6134" aria-hidden="true" tabindex="-1"></a><span class="fu">#### AUC Medio Folds Externos</span></span>
<span id="cb194-6135"><a href="#cb194-6135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6136"><a href="#cb194-6136" aria-hidden="true" tabindex="-1"></a>::: {.panel-tabset}</span>
<span id="cb194-6137"><a href="#cb194-6137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6138"><a href="#cb194-6138" aria-hidden="true" tabindex="-1"></a><span class="fu">## TodasVariables</span></span>
<span id="cb194-6139"><a href="#cb194-6139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6140"><a href="#cb194-6140" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message=FALSE, warning=FALSE}</span></span>
<span id="cb194-6141"><a href="#cb194-6141" aria-hidden="true" tabindex="-1"></a><span class="in">generate_outer_auc_violin_plot(ANN_TodasVariables_Metrics$performance_metrics)</span></span>
<span id="cb194-6142"><a href="#cb194-6142" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-6143"><a href="#cb194-6143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6144"><a href="#cb194-6144" aria-hidden="true" tabindex="-1"></a><span class="fu">## Asociacion</span></span>
<span id="cb194-6145"><a href="#cb194-6145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6146"><a href="#cb194-6146" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message=FALSE, warning=FALSE}</span></span>
<span id="cb194-6147"><a href="#cb194-6147" aria-hidden="true" tabindex="-1"></a><span class="in">generate_outer_auc_violin_plot(ANN_Asociacion_Metrics$performance_metrics)</span></span>
<span id="cb194-6148"><a href="#cb194-6148" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-6149"><a href="#cb194-6149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6150"><a href="#cb194-6150" aria-hidden="true" tabindex="-1"></a><span class="fu">## StepAUC</span></span>
<span id="cb194-6151"><a href="#cb194-6151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6152"><a href="#cb194-6152" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message=FALSE, warning=FALSE}</span></span>
<span id="cb194-6153"><a href="#cb194-6153" aria-hidden="true" tabindex="-1"></a><span class="in">generate_outer_auc_violin_plot(ANN_StepAUC_Metrics$performance_metrics)</span></span>
<span id="cb194-6154"><a href="#cb194-6154" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-6155"><a href="#cb194-6155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6156"><a href="#cb194-6156" aria-hidden="true" tabindex="-1"></a><span class="fu">## Lasso</span></span>
<span id="cb194-6157"><a href="#cb194-6157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6158"><a href="#cb194-6158" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message=FALSE, warning=FALSE}</span></span>
<span id="cb194-6159"><a href="#cb194-6159" aria-hidden="true" tabindex="-1"></a><span class="in">generate_outer_auc_violin_plot(ANN_Lasso_Metrics$performance_metrics)</span></span>
<span id="cb194-6160"><a href="#cb194-6160" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-6161"><a href="#cb194-6161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6162"><a href="#cb194-6162" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb194-6163"><a href="#cb194-6163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6164"><a href="#cb194-6164" aria-hidden="true" tabindex="-1"></a>Los gráficos de violín comparan la distribución del AUC por fold para los métodos de todas las variables, filtrado por análisis de asociación, stepAUC y embedded Lasso. En general, los métodos que usan todas las variables y el filtrado por análisis de asociación muestran distribuciones de AUC relativamente estrechas y consistentes en la mayoría de los folds, con valores centrados alrededor de 0.75 a 0.8, lo que indica un rendimiento estable. El método stepAUC muestra una variabilidad más amplia, especialmente en los folds 4 y 5, con AUC que varían desde aproximadamente 0.55 hasta 0.75, indicando una inestabilidad significativa en estos folds. Similarmente, el método embedded Lasso presenta una mayor dispersión en los folds 4 y 5, con rangos de AUC que van desde 0.6 a 0.75, sugiriendo una mayor inestabilidad y sensibilidad a las particiones de datos. En resumen, **mientras que los métodos de todas las variables y el filtrado por análisis de asociación mantienen una consistencia aceptable, los métodos stepAUC y Lasso muestran mayor variabilidad y menor estabilidad en ciertos folds**.</span>
<span id="cb194-6165"><a href="#cb194-6165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6166"><a href="#cb194-6166" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Comparativa ANN</span></span>
<span id="cb194-6167"><a href="#cb194-6167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6170"><a href="#cb194-6170" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb194-6171"><a href="#cb194-6171" aria-hidden="true" tabindex="-1"></a>fig <span class="ot">&lt;-</span> <span class="fu">generate_combined_auc_3d_plot</span>(</span>
<span id="cb194-6172"><a href="#cb194-6172" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(</span>
<span id="cb194-6173"><a href="#cb194-6173" aria-hidden="true" tabindex="-1"></a>    ANN_TodasVariables_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb194-6174"><a href="#cb194-6174" aria-hidden="true" tabindex="-1"></a>    ANN_Asociacion_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb194-6175"><a href="#cb194-6175" aria-hidden="true" tabindex="-1"></a>    ANN_StepAUC_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb194-6176"><a href="#cb194-6176" aria-hidden="true" tabindex="-1"></a>    ANN_Lasso_Metrics<span class="sc">$</span>performance_metrics</span>
<span id="cb194-6177"><a href="#cb194-6177" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb194-6178"><a href="#cb194-6178" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">"Todas Variables"</span>, <span class="st">"Asociacion"</span>, <span class="st">"StepAUC"</span>, <span class="st">"Lasso"</span>)</span>
<span id="cb194-6179"><a href="#cb194-6179" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb194-6180"><a href="#cb194-6180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6181"><a href="#cb194-6181" aria-hidden="true" tabindex="-1"></a>fig</span>
<span id="cb194-6182"><a href="#cb194-6182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6183"><a href="#cb194-6183" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-6184"><a href="#cb194-6184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6185"><a href="#cb194-6185" aria-hidden="true" tabindex="-1"></a>Los gráficos 3D muestran un análisis comparativo del AUC a través de los métodos de todas las variables, filtrado por asociación, stepAUC y Lasso, destacando sus desempeños a lo largo de diferentes semillas y folds. En general, el método Lasso presenta el AUC medio global más alto (0.746), seguido por el filtrado por asociación (0.74), todas las variables (0.733) y stepAUC (0.731). El método Lasso muestra una mayor consistencia en los valores de AUC, particularmente en las semillas 27 y 90, con menos variabilidad en comparación con los otros métodos. El filtrado por asociación también demuestra una consistencia razonable, aunque con ligeras fluctuaciones. Por otro lado, los métodos de todas las variables y stepAUC muestran una mayor variabilidad, especialmente en ciertos folds y semillas, indicando inestabilidades en su rendimiento. La visualización revela que, aunque todos los métodos tienen rendimientos comparables, **Lasso y filtrado por asociación parecen ofrecer una mayor estabilidad y un rendimiento ligeramente superior**.</span>
<span id="cb194-6186"><a href="#cb194-6186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6187"><a href="#cb194-6187" aria-hidden="true" tabindex="-1"></a>::: {.panel-tabset}</span>
<span id="cb194-6188"><a href="#cb194-6188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6189"><a href="#cb194-6189" aria-hidden="true" tabindex="-1"></a><span class="fu">## TodasVariables</span></span>
<span id="cb194-6190"><a href="#cb194-6190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6193"><a href="#cb194-6193" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb194-6194"><a href="#cb194-6194" aria-hidden="true" tabindex="-1"></a><span class="fu">generate_auc_per_seed_and_fold</span>(ANN_TodasVariables_Metrics<span class="sc">$</span>performance_metrics)</span>
<span id="cb194-6195"><a href="#cb194-6195" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-6196"><a href="#cb194-6196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6197"><a href="#cb194-6197" aria-hidden="true" tabindex="-1"></a><span class="fu">## Asociacion</span></span>
<span id="cb194-6198"><a href="#cb194-6198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6201"><a href="#cb194-6201" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb194-6202"><a href="#cb194-6202" aria-hidden="true" tabindex="-1"></a><span class="fu">generate_auc_per_seed_and_fold</span>(ANN_Asociacion_Metrics<span class="sc">$</span>performance_metrics)</span>
<span id="cb194-6203"><a href="#cb194-6203" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-6204"><a href="#cb194-6204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6205"><a href="#cb194-6205" aria-hidden="true" tabindex="-1"></a><span class="fu">## StepAUC</span></span>
<span id="cb194-6206"><a href="#cb194-6206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6209"><a href="#cb194-6209" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb194-6210"><a href="#cb194-6210" aria-hidden="true" tabindex="-1"></a><span class="fu">generate_auc_per_seed_and_fold</span>(ANN_StepAUC_Metrics<span class="sc">$</span>performance_metrics)</span>
<span id="cb194-6211"><a href="#cb194-6211" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-6212"><a href="#cb194-6212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6213"><a href="#cb194-6213" aria-hidden="true" tabindex="-1"></a><span class="fu">## Lasso</span></span>
<span id="cb194-6214"><a href="#cb194-6214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6217"><a href="#cb194-6217" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb194-6218"><a href="#cb194-6218" aria-hidden="true" tabindex="-1"></a><span class="fu">generate_auc_per_seed_and_fold</span>(ANN_Lasso_Metrics<span class="sc">$</span>performance_metrics)</span>
<span id="cb194-6219"><a href="#cb194-6219" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-6220"><a href="#cb194-6220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6221"><a href="#cb194-6221" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb194-6222"><a href="#cb194-6222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6223"><a href="#cb194-6223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6224"><a href="#cb194-6224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6225"><a href="#cb194-6225" aria-hidden="true" tabindex="-1"></a><span class="fu">### AUC - Conclusión</span></span>
<span id="cb194-6226"><a href="#cb194-6226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6227"><a href="#cb194-6227" aria-hidden="true" tabindex="-1"></a>Una vez realizada la exploración de las métricas específicas para cada modelo, prestando atención sobre todo a la dispersión del AUC dependiente del método de selección de variables usado, se va a proceder con una exploración global del AUC, dependiendo de cada método y modelo aplicado. Este análisis nos permitirá descartar los modelos menos estables, o con un AUC medio más bajo. Los modelos que pasen este filtro de selección, pasarán a la siguiente etapa de discusión, en la que se analizará la estabilidad de sus hiperparámetros, arrojando conclusiones importantes sobre la estabilidad del modelo frente a la aleatoriedad de los datos con los que ha sido entrado.</span>
<span id="cb194-6228"><a href="#cb194-6228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6229"><a href="#cb194-6229" aria-hidden="true" tabindex="-1"></a>Se ha decidido que la primera etapa esté relacionada con la métrica del AUC ya que el rendimiento del modelo es la *carta de presentación del modelo frente a los profesionales de la salud interesados en usarlo*, por lo que es una métrica que debe mantenerse, tanto alta, como estable. Se realizaron entonces los siguientes análisis: </span>
<span id="cb194-6230"><a href="#cb194-6230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6231"><a href="#cb194-6231" aria-hidden="true" tabindex="-1"></a>::: {.panel-tabset}</span>
<span id="cb194-6232"><a href="#cb194-6232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6233"><a href="#cb194-6233" aria-hidden="true" tabindex="-1"></a><span class="fu">## AUC Global por Modelo </span></span>
<span id="cb194-6234"><a href="#cb194-6234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6237"><a href="#cb194-6237" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb194-6238"><a href="#cb194-6238" aria-hidden="true" tabindex="-1"></a>generate_auc_comparison_violin_plot <span class="ot">&lt;-</span> <span class="cf">function</span>(model_data_list) {</span>
<span id="cb194-6239"><a href="#cb194-6239" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Inicializar una lista para almacenar los datos combinados</span></span>
<span id="cb194-6240"><a href="#cb194-6240" aria-hidden="true" tabindex="-1"></a>  combined_data <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb194-6241"><a href="#cb194-6241" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb194-6242"><a href="#cb194-6242" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Recorrer cada modelo en el vector de listas</span></span>
<span id="cb194-6243"><a href="#cb194-6243" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (model_name <span class="cf">in</span> <span class="fu">names</span>(model_data_list)) {</span>
<span id="cb194-6244"><a href="#cb194-6244" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Obtener los 4 dataframes para el modelo actual</span></span>
<span id="cb194-6245"><a href="#cb194-6245" aria-hidden="true" tabindex="-1"></a>    model_data_frames <span class="ot">&lt;-</span> model_data_list[[model_name]]</span>
<span id="cb194-6246"><a href="#cb194-6246" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb194-6247"><a href="#cb194-6247" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Combinar los 4 dataframes en uno solo y agregar una columna para el nombre del modelo</span></span>
<span id="cb194-6248"><a href="#cb194-6248" aria-hidden="true" tabindex="-1"></a>    model_combined_data <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(model_data_frames) <span class="sc">%&gt;%</span></span>
<span id="cb194-6249"><a href="#cb194-6249" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">Model =</span> model_name)</span>
<span id="cb194-6250"><a href="#cb194-6250" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb194-6251"><a href="#cb194-6251" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Agregar los datos combinados a la lista general</span></span>
<span id="cb194-6252"><a href="#cb194-6252" aria-hidden="true" tabindex="-1"></a>    combined_data[[model_name]] <span class="ot">&lt;-</span> model_combined_data</span>
<span id="cb194-6253"><a href="#cb194-6253" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb194-6254"><a href="#cb194-6254" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb194-6255"><a href="#cb194-6255" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Combinar todos los datos en un solo dataframe</span></span>
<span id="cb194-6256"><a href="#cb194-6256" aria-hidden="true" tabindex="-1"></a>  final_data <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(combined_data)</span>
<span id="cb194-6257"><a href="#cb194-6257" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb194-6258"><a href="#cb194-6258" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Crear el gráfico de violín</span></span>
<span id="cb194-6259"><a href="#cb194-6259" aria-hidden="true" tabindex="-1"></a>  violin_plot <span class="ot">&lt;-</span> <span class="fu">plot_ly</span>(final_data, <span class="at">y =</span> <span class="sc">~</span>AUC, <span class="at">type =</span> <span class="st">'violin'</span>, </span>
<span id="cb194-6260"><a href="#cb194-6260" aria-hidden="true" tabindex="-1"></a>                         <span class="at">box =</span> <span class="fu">list</span>(<span class="at">visible =</span> <span class="cn">TRUE</span>), </span>
<span id="cb194-6261"><a href="#cb194-6261" aria-hidden="true" tabindex="-1"></a>                         <span class="at">meanline =</span> <span class="fu">list</span>(<span class="at">visible =</span> <span class="cn">TRUE</span>), </span>
<span id="cb194-6262"><a href="#cb194-6262" aria-hidden="true" tabindex="-1"></a>                         <span class="at">split =</span> <span class="sc">~</span>Model) <span class="sc">%&gt;%</span></span>
<span id="cb194-6263"><a href="#cb194-6263" aria-hidden="true" tabindex="-1"></a>    <span class="fu">layout</span>(</span>
<span id="cb194-6264"><a href="#cb194-6264" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="st">'Comparativa Global del AUC de Diferentes Modelos'</span>,</span>
<span id="cb194-6265"><a href="#cb194-6265" aria-hidden="true" tabindex="-1"></a>      <span class="at">yaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">'AUC'</span>),</span>
<span id="cb194-6266"><a href="#cb194-6266" aria-hidden="true" tabindex="-1"></a>      <span class="at">xaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">'Modelos'</span>)</span>
<span id="cb194-6267"><a href="#cb194-6267" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb194-6268"><a href="#cb194-6268" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb194-6269"><a href="#cb194-6269" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(violin_plot)</span>
<span id="cb194-6270"><a href="#cb194-6270" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb194-6271"><a href="#cb194-6271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6272"><a href="#cb194-6272" aria-hidden="true" tabindex="-1"></a>model_data_list <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb194-6273"><a href="#cb194-6273" aria-hidden="true" tabindex="-1"></a>  <span class="at">ANN =</span> <span class="fu">list</span>(</span>
<span id="cb194-6274"><a href="#cb194-6274" aria-hidden="true" tabindex="-1"></a>    ANN_TodasVariables_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb194-6275"><a href="#cb194-6275" aria-hidden="true" tabindex="-1"></a>    ANN_Asociacion_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb194-6276"><a href="#cb194-6276" aria-hidden="true" tabindex="-1"></a>    ANN_StepAUC_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb194-6277"><a href="#cb194-6277" aria-hidden="true" tabindex="-1"></a>    ANN_Lasso_Metrics<span class="sc">$</span>performance_metrics</span>
<span id="cb194-6278"><a href="#cb194-6278" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb194-6279"><a href="#cb194-6279" aria-hidden="true" tabindex="-1"></a>  <span class="at">SVM =</span> <span class="fu">list</span>(</span>
<span id="cb194-6280"><a href="#cb194-6280" aria-hidden="true" tabindex="-1"></a>    SVM_TodasVariables_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb194-6281"><a href="#cb194-6281" aria-hidden="true" tabindex="-1"></a>    SVM_Asociacion_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb194-6282"><a href="#cb194-6282" aria-hidden="true" tabindex="-1"></a>    SVM_StepAUC_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb194-6283"><a href="#cb194-6283" aria-hidden="true" tabindex="-1"></a>    SVM_Lasso_Metrics<span class="sc">$</span>performance_metrics</span>
<span id="cb194-6284"><a href="#cb194-6284" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb194-6285"><a href="#cb194-6285" aria-hidden="true" tabindex="-1"></a>  <span class="at">KNN =</span> <span class="fu">list</span>(</span>
<span id="cb194-6286"><a href="#cb194-6286" aria-hidden="true" tabindex="-1"></a>    KNN_TodasVariables_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb194-6287"><a href="#cb194-6287" aria-hidden="true" tabindex="-1"></a>    KNN_Asociacion_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb194-6288"><a href="#cb194-6288" aria-hidden="true" tabindex="-1"></a>    KNN_StepAUC_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb194-6289"><a href="#cb194-6289" aria-hidden="true" tabindex="-1"></a>    KNN_Lasso_Metrics<span class="sc">$</span>performance_metrics</span>
<span id="cb194-6290"><a href="#cb194-6290" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb194-6291"><a href="#cb194-6291" aria-hidden="true" tabindex="-1"></a>  <span class="at">RandomForest =</span> <span class="fu">list</span>(</span>
<span id="cb194-6292"><a href="#cb194-6292" aria-hidden="true" tabindex="-1"></a>    RandomForest_TodasVariables_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb194-6293"><a href="#cb194-6293" aria-hidden="true" tabindex="-1"></a>    RandomForest_Asociacion_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb194-6294"><a href="#cb194-6294" aria-hidden="true" tabindex="-1"></a>    RandomForest_StepAUC_Metrics<span class="sc">$</span>performance_metrics</span>
<span id="cb194-6295"><a href="#cb194-6295" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb194-6296"><a href="#cb194-6296" aria-hidden="true" tabindex="-1"></a>  <span class="at">NaiveBayes =</span> <span class="fu">list</span>(</span>
<span id="cb194-6297"><a href="#cb194-6297" aria-hidden="true" tabindex="-1"></a>    NaiveBayes_TodasVariables_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb194-6298"><a href="#cb194-6298" aria-hidden="true" tabindex="-1"></a>    NaiveBayes_Asociacion_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb194-6299"><a href="#cb194-6299" aria-hidden="true" tabindex="-1"></a>    NaiveBayes_StepAUC_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb194-6300"><a href="#cb194-6300" aria-hidden="true" tabindex="-1"></a>    NaiveBayes_Lasso_Metrics<span class="sc">$</span>performance_metrics</span>
<span id="cb194-6301"><a href="#cb194-6301" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb194-6302"><a href="#cb194-6302" aria-hidden="true" tabindex="-1"></a>  <span class="at">AdaBoost =</span> <span class="fu">list</span>(</span>
<span id="cb194-6303"><a href="#cb194-6303" aria-hidden="true" tabindex="-1"></a>    AdaBoost_TodasVariables_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb194-6304"><a href="#cb194-6304" aria-hidden="true" tabindex="-1"></a>    AdaBoost_Asociacion_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb194-6305"><a href="#cb194-6305" aria-hidden="true" tabindex="-1"></a>    AdaBoost_StepAUC_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb194-6306"><a href="#cb194-6306" aria-hidden="true" tabindex="-1"></a>    AdaBoost_Lasso_Metrics<span class="sc">$</span>performance_metrics</span>
<span id="cb194-6307"><a href="#cb194-6307" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb194-6308"><a href="#cb194-6308" aria-hidden="true" tabindex="-1"></a>  <span class="at">DecisionTree =</span> <span class="fu">list</span>(</span>
<span id="cb194-6309"><a href="#cb194-6309" aria-hidden="true" tabindex="-1"></a>    RPart_TodasVariables_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb194-6310"><a href="#cb194-6310" aria-hidden="true" tabindex="-1"></a>    RPart_Asociacion_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb194-6311"><a href="#cb194-6311" aria-hidden="true" tabindex="-1"></a>    RPart_StepAUC_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb194-6312"><a href="#cb194-6312" aria-hidden="true" tabindex="-1"></a>    RPart_Lasso_Metrics<span class="sc">$</span>performance_metrics</span>
<span id="cb194-6313"><a href="#cb194-6313" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb194-6314"><a href="#cb194-6314" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb194-6315"><a href="#cb194-6315" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6316"><a href="#cb194-6316" aria-hidden="true" tabindex="-1"></a>violin_plot <span class="ot">&lt;-</span> <span class="fu">generate_auc_comparison_violin_plot</span>(model_data_list)</span>
<span id="cb194-6317"><a href="#cb194-6317" aria-hidden="true" tabindex="-1"></a>violin_plot</span>
<span id="cb194-6318"><a href="#cb194-6318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6319"><a href="#cb194-6319" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-6320"><a href="#cb194-6320" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6321"><a href="#cb194-6321" aria-hidden="true" tabindex="-1"></a>Como se puede observar en el gráfico comparativo de violín superior, hay variaciones significativas en cuanto a la dispersión, media, y mediana del AUC dependiendo del modelo. Los modelos que exhiben un peor rendimiento son el SVM, DecisionTree, y RandomForest, estos muestran una varianza del AUC muy alta, desviándose hacia valores bajos, haciendo que la media disminuya notablemente, en algunos casos, llegando a hacer que el rendimiento esté por debajo de un clasificador aleatorio (<span class="in">`AUC&lt;.5`</span>).</span>
<span id="cb194-6322"><a href="#cb194-6322" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6323"><a href="#cb194-6323" aria-hidden="true" tabindex="-1"></a>Por otra parte, los modelos restastes exhiben un AUC promedio elevado. El KNN un AUC medio de 0.7176, y una media de 0.7213, sin embargo, también exhibe una dispersión moderada comparada con el resto de modelos, cuantificada por el rango del modelo, $Rango = Max-Min=0.15$. Las ANN son el siguiente mejor modelo; este modelo exhibe un AUC medio global de 0.737, con una mediana en 0.742, su debilidad es la misma que el KNN, el rango de sus datos, que refleja la dispersión, es algo elevado, siendo este de 0.3, el doble que el KNN. </span>
<span id="cb194-6324"><a href="#cb194-6324" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6325"><a href="#cb194-6325" aria-hidden="true" tabindex="-1"></a>Los dos últimos modelos son muy similares en cuanto a sus estadísticos. El Adaboost muestra un AUC medio de 0.733, coincidiendo con su mediana, dato que recalta que la distribución de los valores de AUC con este modelo está muy equilibrada y poco dispersa; el rango del modelo es de 0.17. Por otra parte, el algoritmo NaiveBayes, si bien muestra un AUC medio mayor que al Adaboost, de 0.74, con una mediana de 0.737, su rango es algo mayor (0.23), denotando que el modelo puede no ser tan robusto como Adaboost. </span>
<span id="cb194-6326"><a href="#cb194-6326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6327"><a href="#cb194-6327" aria-hidden="true" tabindex="-1"></a>Se puede concluir entonces que, **teniendo solo en cuenta el AUC medio global, y su dispersión**, el modelo Adaboost, seguido por NaiveBayes y las ANN, son los que tienen un rendimiento más óptimo. Por lo que son los principales candidatos para pasar a la siguiente fase de evaluación. </span>
<span id="cb194-6328"><a href="#cb194-6328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6329"><a href="#cb194-6329" aria-hidden="true" tabindex="-1"></a><span class="fu">## AUC Global por Método</span></span>
<span id="cb194-6330"><a href="#cb194-6330" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6333"><a href="#cb194-6333" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb194-6334"><a href="#cb194-6334" aria-hidden="true" tabindex="-1"></a>generate_auc_feature_selection_violin_plot <span class="ot">&lt;-</span> <span class="cf">function</span>(selection_methods_data_list) {</span>
<span id="cb194-6335"><a href="#cb194-6335" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Inicializar una lista para almacenar los datos combinados</span></span>
<span id="cb194-6336"><a href="#cb194-6336" aria-hidden="true" tabindex="-1"></a>  combined_data <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb194-6337"><a href="#cb194-6337" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb194-6338"><a href="#cb194-6338" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Recorrer cada método de selección en el vector de listas</span></span>
<span id="cb194-6339"><a href="#cb194-6339" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (method_name <span class="cf">in</span> <span class="fu">names</span>(selection_methods_data_list)) {</span>
<span id="cb194-6340"><a href="#cb194-6340" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Obtener los dataframes para el método de selección actual</span></span>
<span id="cb194-6341"><a href="#cb194-6341" aria-hidden="true" tabindex="-1"></a>    method_data_frames <span class="ot">&lt;-</span> selection_methods_data_list[[method_name]]</span>
<span id="cb194-6342"><a href="#cb194-6342" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb194-6343"><a href="#cb194-6343" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Combinar los dataframes en uno solo y agregar una columna para el nombre del método</span></span>
<span id="cb194-6344"><a href="#cb194-6344" aria-hidden="true" tabindex="-1"></a>    method_combined_data <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(method_data_frames) <span class="sc">%&gt;%</span></span>
<span id="cb194-6345"><a href="#cb194-6345" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">Method =</span> method_name)</span>
<span id="cb194-6346"><a href="#cb194-6346" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb194-6347"><a href="#cb194-6347" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Agregar los datos combinados a la lista general</span></span>
<span id="cb194-6348"><a href="#cb194-6348" aria-hidden="true" tabindex="-1"></a>    combined_data[[method_name]] <span class="ot">&lt;-</span> method_combined_data</span>
<span id="cb194-6349"><a href="#cb194-6349" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb194-6350"><a href="#cb194-6350" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb194-6351"><a href="#cb194-6351" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Combinar todos los datos en un solo dataframe</span></span>
<span id="cb194-6352"><a href="#cb194-6352" aria-hidden="true" tabindex="-1"></a>  final_data <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(combined_data)</span>
<span id="cb194-6353"><a href="#cb194-6353" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb194-6354"><a href="#cb194-6354" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Crear el gráfico de violín</span></span>
<span id="cb194-6355"><a href="#cb194-6355" aria-hidden="true" tabindex="-1"></a>  violin_plot <span class="ot">&lt;-</span> <span class="fu">plot_ly</span>(final_data, <span class="at">y =</span> <span class="sc">~</span>AUC, <span class="at">type =</span> <span class="st">'violin'</span>, <span class="at">box =</span> <span class="fu">list</span>(<span class="at">visible =</span> <span class="cn">TRUE</span>), <span class="at">meanline =</span> <span class="fu">list</span>(<span class="at">visible =</span> <span class="cn">TRUE</span>), <span class="at">split =</span> <span class="sc">~</span>Method) <span class="sc">%&gt;%</span></span>
<span id="cb194-6356"><a href="#cb194-6356" aria-hidden="true" tabindex="-1"></a>    <span class="fu">layout</span>(</span>
<span id="cb194-6357"><a href="#cb194-6357" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="st">'Comparativa Global del AUC por Método de Selección de Características'</span>,</span>
<span id="cb194-6358"><a href="#cb194-6358" aria-hidden="true" tabindex="-1"></a>      <span class="at">yaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">'AUC'</span>),</span>
<span id="cb194-6359"><a href="#cb194-6359" aria-hidden="true" tabindex="-1"></a>      <span class="at">xaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">'Métodos de Selección de Características'</span>)</span>
<span id="cb194-6360"><a href="#cb194-6360" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb194-6361"><a href="#cb194-6361" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb194-6362"><a href="#cb194-6362" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(violin_plot)</span>
<span id="cb194-6363"><a href="#cb194-6363" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb194-6364"><a href="#cb194-6364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6365"><a href="#cb194-6365" aria-hidden="true" tabindex="-1"></a>selection_methods_data_list <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb194-6366"><a href="#cb194-6366" aria-hidden="true" tabindex="-1"></a>  <span class="at">TodasVariables =</span> <span class="fu">list</span>(</span>
<span id="cb194-6367"><a href="#cb194-6367" aria-hidden="true" tabindex="-1"></a>    ANN_TodasVariables_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb194-6368"><a href="#cb194-6368" aria-hidden="true" tabindex="-1"></a>    SVM_TodasVariables_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb194-6369"><a href="#cb194-6369" aria-hidden="true" tabindex="-1"></a>    KNN_TodasVariables_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb194-6370"><a href="#cb194-6370" aria-hidden="true" tabindex="-1"></a>    RandomForest_TodasVariables_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb194-6371"><a href="#cb194-6371" aria-hidden="true" tabindex="-1"></a>    NaiveBayes_TodasVariables_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb194-6372"><a href="#cb194-6372" aria-hidden="true" tabindex="-1"></a>    AdaBoost_TodasVariables_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb194-6373"><a href="#cb194-6373" aria-hidden="true" tabindex="-1"></a>    RPart_TodasVariables_Metrics<span class="sc">$</span>performance_metrics</span>
<span id="cb194-6374"><a href="#cb194-6374" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb194-6375"><a href="#cb194-6375" aria-hidden="true" tabindex="-1"></a>  <span class="at">Asociacion =</span> <span class="fu">list</span>(</span>
<span id="cb194-6376"><a href="#cb194-6376" aria-hidden="true" tabindex="-1"></a>    ANN_Asociacion_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb194-6377"><a href="#cb194-6377" aria-hidden="true" tabindex="-1"></a>    SVM_Asociacion_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb194-6378"><a href="#cb194-6378" aria-hidden="true" tabindex="-1"></a>    KNN_Asociacion_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb194-6379"><a href="#cb194-6379" aria-hidden="true" tabindex="-1"></a>    RandomForest_Asociacion_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb194-6380"><a href="#cb194-6380" aria-hidden="true" tabindex="-1"></a>    NaiveBayes_Asociacion_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb194-6381"><a href="#cb194-6381" aria-hidden="true" tabindex="-1"></a>    AdaBoost_Asociacion_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb194-6382"><a href="#cb194-6382" aria-hidden="true" tabindex="-1"></a>    RPart_Asociacion_Metrics<span class="sc">$</span>performance_metrics</span>
<span id="cb194-6383"><a href="#cb194-6383" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb194-6384"><a href="#cb194-6384" aria-hidden="true" tabindex="-1"></a>  <span class="at">StepAUC =</span> <span class="fu">list</span>(</span>
<span id="cb194-6385"><a href="#cb194-6385" aria-hidden="true" tabindex="-1"></a>    ANN_StepAUC_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb194-6386"><a href="#cb194-6386" aria-hidden="true" tabindex="-1"></a>    SVM_StepAUC_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb194-6387"><a href="#cb194-6387" aria-hidden="true" tabindex="-1"></a>    KNN_StepAUC_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb194-6388"><a href="#cb194-6388" aria-hidden="true" tabindex="-1"></a>    RandomForest_StepAUC_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb194-6389"><a href="#cb194-6389" aria-hidden="true" tabindex="-1"></a>    NaiveBayes_StepAUC_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb194-6390"><a href="#cb194-6390" aria-hidden="true" tabindex="-1"></a>    AdaBoost_StepAUC_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb194-6391"><a href="#cb194-6391" aria-hidden="true" tabindex="-1"></a>    RPart_StepAUC_Metrics<span class="sc">$</span>performance_metrics</span>
<span id="cb194-6392"><a href="#cb194-6392" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb194-6393"><a href="#cb194-6393" aria-hidden="true" tabindex="-1"></a>  <span class="at">Lasso =</span> <span class="fu">list</span>(</span>
<span id="cb194-6394"><a href="#cb194-6394" aria-hidden="true" tabindex="-1"></a>    ANN_Lasso_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb194-6395"><a href="#cb194-6395" aria-hidden="true" tabindex="-1"></a>    SVM_Lasso_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb194-6396"><a href="#cb194-6396" aria-hidden="true" tabindex="-1"></a>    KNN_Lasso_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb194-6397"><a href="#cb194-6397" aria-hidden="true" tabindex="-1"></a>    NaiveBayes_Lasso_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb194-6398"><a href="#cb194-6398" aria-hidden="true" tabindex="-1"></a>    AdaBoost_Lasso_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb194-6399"><a href="#cb194-6399" aria-hidden="true" tabindex="-1"></a>    RPart_Lasso_Metrics<span class="sc">$</span>performance_metrics</span>
<span id="cb194-6400"><a href="#cb194-6400" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb194-6401"><a href="#cb194-6401" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb194-6402"><a href="#cb194-6402" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6403"><a href="#cb194-6403" aria-hidden="true" tabindex="-1"></a>violin_plot <span class="ot">&lt;-</span> <span class="fu">generate_auc_feature_selection_violin_plot</span>(selection_methods_data_list)</span>
<span id="cb194-6404"><a href="#cb194-6404" aria-hidden="true" tabindex="-1"></a>violin_plot</span>
<span id="cb194-6405"><a href="#cb194-6405" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6406"><a href="#cb194-6406" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-6407"><a href="#cb194-6407" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6408"><a href="#cb194-6408" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6409"><a href="#cb194-6409" aria-hidden="true" tabindex="-1"></a>Como se puede observar, todos los métodos de selección de variables exhiben un comportamiento similar, esto se puede concluir al observar la dispersión, media, y mediana del AUC a través de todo ellos. Sin embargo, se debe destacar el método de selección de variables Lasso, ya que todos los modelos que lo han empleado han obtenido de media un AUC de 0.703, y muestra una dispersión de los datos menor que el resto de métodos de selección, con un rango de 0.34, justificando que este método de selección de variables aporta una mayor estabilidad al método que lo acompaña. </span>
<span id="cb194-6410"><a href="#cb194-6410" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6411"><a href="#cb194-6411" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6412"><a href="#cb194-6412" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6413"><a href="#cb194-6413" aria-hidden="true" tabindex="-1"></a><span class="fu">## AUC Global por Variable y Método</span></span>
<span id="cb194-6414"><a href="#cb194-6414" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6415"><a href="#cb194-6415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6416"><a href="#cb194-6416" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message=FALSE, warning=FALSE}</span></span>
<span id="cb194-6417"><a href="#cb194-6417" aria-hidden="true" tabindex="-1"></a><span class="in">generate_auc_heatmap &lt;- function(model_data_list, selection_methods) {</span></span>
<span id="cb194-6418"><a href="#cb194-6418" aria-hidden="true" tabindex="-1"></a><span class="in">  # Inicializar una lista para almacenar los datos combinados</span></span>
<span id="cb194-6419"><a href="#cb194-6419" aria-hidden="true" tabindex="-1"></a><span class="in">  combined_data &lt;- list()</span></span>
<span id="cb194-6420"><a href="#cb194-6420" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb194-6421"><a href="#cb194-6421" aria-hidden="true" tabindex="-1"></a><span class="in">  # Recorrer cada modelo en el vector de listas</span></span>
<span id="cb194-6422"><a href="#cb194-6422" aria-hidden="true" tabindex="-1"></a><span class="in">  for (model_name in names(model_data_list)) {</span></span>
<span id="cb194-6423"><a href="#cb194-6423" aria-hidden="true" tabindex="-1"></a><span class="in">    # Obtener los dataframes para cada método de selección de características</span></span>
<span id="cb194-6424"><a href="#cb194-6424" aria-hidden="true" tabindex="-1"></a><span class="in">    model_methods &lt;- model_data_list[[model_name]]</span></span>
<span id="cb194-6425"><a href="#cb194-6425" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-6426"><a href="#cb194-6426" aria-hidden="true" tabindex="-1"></a><span class="in">    for (method_name in names(model_methods)) {</span></span>
<span id="cb194-6427"><a href="#cb194-6427" aria-hidden="true" tabindex="-1"></a><span class="in">      # Obtener el dataframe del método actual</span></span>
<span id="cb194-6428"><a href="#cb194-6428" aria-hidden="true" tabindex="-1"></a><span class="in">      method_data &lt;- model_methods[[method_name]]</span></span>
<span id="cb194-6429"><a href="#cb194-6429" aria-hidden="true" tabindex="-1"></a><span class="in">      </span></span>
<span id="cb194-6430"><a href="#cb194-6430" aria-hidden="true" tabindex="-1"></a><span class="in">      # Combinar los dataframes y agregar columnas para el nombre del modelo y el método</span></span>
<span id="cb194-6431"><a href="#cb194-6431" aria-hidden="true" tabindex="-1"></a><span class="in">      combined_data[[paste(model_name, method_name, sep = "_")]] &lt;- method_data %&gt;%</span></span>
<span id="cb194-6432"><a href="#cb194-6432" aria-hidden="true" tabindex="-1"></a><span class="in">        mutate(Model = model_name, Method = method_name)</span></span>
<span id="cb194-6433"><a href="#cb194-6433" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb194-6434"><a href="#cb194-6434" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb194-6435"><a href="#cb194-6435" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb194-6436"><a href="#cb194-6436" aria-hidden="true" tabindex="-1"></a><span class="in">  # Combinar todos los datos en un solo dataframe</span></span>
<span id="cb194-6437"><a href="#cb194-6437" aria-hidden="true" tabindex="-1"></a><span class="in">  final_data &lt;- bind_rows(combined_data)</span></span>
<span id="cb194-6438"><a href="#cb194-6438" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb194-6439"><a href="#cb194-6439" aria-hidden="true" tabindex="-1"></a><span class="in">  # Calcular el AUC promedio para cada combinación de modelo y método</span></span>
<span id="cb194-6440"><a href="#cb194-6440" aria-hidden="true" tabindex="-1"></a><span class="in">  auc_summary &lt;- final_data %&gt;%</span></span>
<span id="cb194-6441"><a href="#cb194-6441" aria-hidden="true" tabindex="-1"></a><span class="in">    group_by(Model, Method) %&gt;%</span></span>
<span id="cb194-6442"><a href="#cb194-6442" aria-hidden="true" tabindex="-1"></a><span class="in">    summarise(AUC_Mean = mean(AUC, na.rm = TRUE)) %&gt;%</span></span>
<span id="cb194-6443"><a href="#cb194-6443" aria-hidden="true" tabindex="-1"></a><span class="in">    ungroup()</span></span>
<span id="cb194-6444"><a href="#cb194-6444" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb194-6445"><a href="#cb194-6445" aria-hidden="true" tabindex="-1"></a><span class="in">  # Crear el mapa de calor</span></span>
<span id="cb194-6446"><a href="#cb194-6446" aria-hidden="true" tabindex="-1"></a><span class="in">  heatmap_plot &lt;- plot_ly(</span></span>
<span id="cb194-6447"><a href="#cb194-6447" aria-hidden="true" tabindex="-1"></a><span class="in">    data = auc_summary,</span></span>
<span id="cb194-6448"><a href="#cb194-6448" aria-hidden="true" tabindex="-1"></a><span class="in">    x = ~Model,</span></span>
<span id="cb194-6449"><a href="#cb194-6449" aria-hidden="true" tabindex="-1"></a><span class="in">    y = ~Method,</span></span>
<span id="cb194-6450"><a href="#cb194-6450" aria-hidden="true" tabindex="-1"></a><span class="in">    z = ~AUC_Mean,</span></span>
<span id="cb194-6451"><a href="#cb194-6451" aria-hidden="true" tabindex="-1"></a><span class="in">    type = 'heatmap',</span></span>
<span id="cb194-6452"><a href="#cb194-6452" aria-hidden="true" tabindex="-1"></a><span class="in">    colorscale = 'Viridis',</span></span>
<span id="cb194-6453"><a href="#cb194-6453" aria-hidden="true" tabindex="-1"></a><span class="in">    colorbar = list(title = 'AUC Promedio')</span></span>
<span id="cb194-6454"><a href="#cb194-6454" aria-hidden="true" tabindex="-1"></a><span class="in">  ) %&gt;%</span></span>
<span id="cb194-6455"><a href="#cb194-6455" aria-hidden="true" tabindex="-1"></a><span class="in">    layout(</span></span>
<span id="cb194-6456"><a href="#cb194-6456" aria-hidden="true" tabindex="-1"></a><span class="in">      title = 'Mapa de Calor de AUC Promedio por Modelo y Método de Selección de Características',</span></span>
<span id="cb194-6457"><a href="#cb194-6457" aria-hidden="true" tabindex="-1"></a><span class="in">      xaxis = list(title = 'Modelos'),</span></span>
<span id="cb194-6458"><a href="#cb194-6458" aria-hidden="true" tabindex="-1"></a><span class="in">      yaxis = list(title = 'Métodos de Selección de Características')</span></span>
<span id="cb194-6459"><a href="#cb194-6459" aria-hidden="true" tabindex="-1"></a><span class="in">    )</span></span>
<span id="cb194-6460"><a href="#cb194-6460" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb194-6461"><a href="#cb194-6461" aria-hidden="true" tabindex="-1"></a><span class="in">  return(heatmap_plot)</span></span>
<span id="cb194-6462"><a href="#cb194-6462" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb194-6463"><a href="#cb194-6463" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6464"><a href="#cb194-6464" aria-hidden="true" tabindex="-1"></a><span class="in"># Ejemplo de uso</span></span>
<span id="cb194-6465"><a href="#cb194-6465" aria-hidden="true" tabindex="-1"></a><span class="in"># Preparación de los datos con los mismos dataframes que antes</span></span>
<span id="cb194-6466"><a href="#cb194-6466" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6467"><a href="#cb194-6467" aria-hidden="true" tabindex="-1"></a><span class="in">model_data_list &lt;- list(</span></span>
<span id="cb194-6468"><a href="#cb194-6468" aria-hidden="true" tabindex="-1"></a><span class="in">  ANN = list(</span></span>
<span id="cb194-6469"><a href="#cb194-6469" aria-hidden="true" tabindex="-1"></a><span class="in">    TodasVariables = ANN_TodasVariables_Metrics$performance_metrics,</span></span>
<span id="cb194-6470"><a href="#cb194-6470" aria-hidden="true" tabindex="-1"></a><span class="in">    Asociacion = ANN_Asociacion_Metrics$performance_metrics,</span></span>
<span id="cb194-6471"><a href="#cb194-6471" aria-hidden="true" tabindex="-1"></a><span class="in">    StepAUC = ANN_StepAUC_Metrics$performance_metrics,</span></span>
<span id="cb194-6472"><a href="#cb194-6472" aria-hidden="true" tabindex="-1"></a><span class="in">    Lasso = ANN_Lasso_Metrics$performance_metrics</span></span>
<span id="cb194-6473"><a href="#cb194-6473" aria-hidden="true" tabindex="-1"></a><span class="in">  ),</span></span>
<span id="cb194-6474"><a href="#cb194-6474" aria-hidden="true" tabindex="-1"></a><span class="in">  SVM = list(</span></span>
<span id="cb194-6475"><a href="#cb194-6475" aria-hidden="true" tabindex="-1"></a><span class="in">    TodasVariables = SVM_TodasVariables_Metrics$performance_metrics,</span></span>
<span id="cb194-6476"><a href="#cb194-6476" aria-hidden="true" tabindex="-1"></a><span class="in">    Asociacion = SVM_Asociacion_Metrics$performance_metrics,</span></span>
<span id="cb194-6477"><a href="#cb194-6477" aria-hidden="true" tabindex="-1"></a><span class="in">    StepAUC = SVM_StepAUC_Metrics$performance_metrics,</span></span>
<span id="cb194-6478"><a href="#cb194-6478" aria-hidden="true" tabindex="-1"></a><span class="in">    Lasso = SVM_Lasso_Metrics$performance_metrics</span></span>
<span id="cb194-6479"><a href="#cb194-6479" aria-hidden="true" tabindex="-1"></a><span class="in">  ),</span></span>
<span id="cb194-6480"><a href="#cb194-6480" aria-hidden="true" tabindex="-1"></a><span class="in">  KNN = list(</span></span>
<span id="cb194-6481"><a href="#cb194-6481" aria-hidden="true" tabindex="-1"></a><span class="in">    TodasVariables = KNN_TodasVariables_Metrics$performance_metrics,</span></span>
<span id="cb194-6482"><a href="#cb194-6482" aria-hidden="true" tabindex="-1"></a><span class="in">    Asociacion = KNN_Asociacion_Metrics$performance_metrics,</span></span>
<span id="cb194-6483"><a href="#cb194-6483" aria-hidden="true" tabindex="-1"></a><span class="in">    StepAUC = KNN_StepAUC_Metrics$performance_metrics,</span></span>
<span id="cb194-6484"><a href="#cb194-6484" aria-hidden="true" tabindex="-1"></a><span class="in">    Lasso = KNN_Lasso_Metrics$performance_metrics</span></span>
<span id="cb194-6485"><a href="#cb194-6485" aria-hidden="true" tabindex="-1"></a><span class="in">  ),</span></span>
<span id="cb194-6486"><a href="#cb194-6486" aria-hidden="true" tabindex="-1"></a><span class="in">  RandomForest = list(</span></span>
<span id="cb194-6487"><a href="#cb194-6487" aria-hidden="true" tabindex="-1"></a><span class="in">    TodasVariables = RandomForest_TodasVariables_Metrics$performance_metrics,</span></span>
<span id="cb194-6488"><a href="#cb194-6488" aria-hidden="true" tabindex="-1"></a><span class="in">    Asociacion = RandomForest_Asociacion_Metrics$performance_metrics,</span></span>
<span id="cb194-6489"><a href="#cb194-6489" aria-hidden="true" tabindex="-1"></a><span class="in">    StepAUC = RandomForest_StepAUC_Metrics$performance_metrics</span></span>
<span id="cb194-6490"><a href="#cb194-6490" aria-hidden="true" tabindex="-1"></a><span class="in">    # Lasso = No hay datos para este caso</span></span>
<span id="cb194-6491"><a href="#cb194-6491" aria-hidden="true" tabindex="-1"></a><span class="in">  ),</span></span>
<span id="cb194-6492"><a href="#cb194-6492" aria-hidden="true" tabindex="-1"></a><span class="in">  NaiveBayes = list(</span></span>
<span id="cb194-6493"><a href="#cb194-6493" aria-hidden="true" tabindex="-1"></a><span class="in">    TodasVariables = NaiveBayes_TodasVariables_Metrics$performance_metrics,</span></span>
<span id="cb194-6494"><a href="#cb194-6494" aria-hidden="true" tabindex="-1"></a><span class="in">    Asociacion = NaiveBayes_Asociacion_Metrics$performance_metrics,</span></span>
<span id="cb194-6495"><a href="#cb194-6495" aria-hidden="true" tabindex="-1"></a><span class="in">    StepAUC = NaiveBayes_StepAUC_Metrics$performance_metrics,</span></span>
<span id="cb194-6496"><a href="#cb194-6496" aria-hidden="true" tabindex="-1"></a><span class="in">    Lasso = NaiveBayes_Lasso_Metrics$performance_metrics</span></span>
<span id="cb194-6497"><a href="#cb194-6497" aria-hidden="true" tabindex="-1"></a><span class="in">  ),</span></span>
<span id="cb194-6498"><a href="#cb194-6498" aria-hidden="true" tabindex="-1"></a><span class="in">  AdaBoost = list(</span></span>
<span id="cb194-6499"><a href="#cb194-6499" aria-hidden="true" tabindex="-1"></a><span class="in">    TodasVariables = AdaBoost_TodasVariables_Metrics$performance_metrics,</span></span>
<span id="cb194-6500"><a href="#cb194-6500" aria-hidden="true" tabindex="-1"></a><span class="in">    Asociacion = AdaBoost_Asociacion_Metrics$performance_metrics,</span></span>
<span id="cb194-6501"><a href="#cb194-6501" aria-hidden="true" tabindex="-1"></a><span class="in">    StepAUC = AdaBoost_StepAUC_Metrics$performance_metrics,</span></span>
<span id="cb194-6502"><a href="#cb194-6502" aria-hidden="true" tabindex="-1"></a><span class="in">    Lasso = AdaBoost_Lasso_Metrics$performance_metrics</span></span>
<span id="cb194-6503"><a href="#cb194-6503" aria-hidden="true" tabindex="-1"></a><span class="in">  ),</span></span>
<span id="cb194-6504"><a href="#cb194-6504" aria-hidden="true" tabindex="-1"></a><span class="in">  RPart = list(</span></span>
<span id="cb194-6505"><a href="#cb194-6505" aria-hidden="true" tabindex="-1"></a><span class="in">    TodasVariables = RPart_TodasVariables_Metrics$performance_metrics,</span></span>
<span id="cb194-6506"><a href="#cb194-6506" aria-hidden="true" tabindex="-1"></a><span class="in">    Asociacion = RPart_Asociacion_Metrics$performance_metrics,</span></span>
<span id="cb194-6507"><a href="#cb194-6507" aria-hidden="true" tabindex="-1"></a><span class="in">    StepAUC = RPart_StepAUC_Metrics$performance_metrics,</span></span>
<span id="cb194-6508"><a href="#cb194-6508" aria-hidden="true" tabindex="-1"></a><span class="in">    Lasso = RPart_Lasso_Metrics$performance_metrics</span></span>
<span id="cb194-6509"><a href="#cb194-6509" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb194-6510"><a href="#cb194-6510" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb194-6511"><a href="#cb194-6511" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6512"><a href="#cb194-6512" aria-hidden="true" tabindex="-1"></a><span class="in"># Generar y mostrar el mapa de calor</span></span>
<span id="cb194-6513"><a href="#cb194-6513" aria-hidden="true" tabindex="-1"></a><span class="in">heatmap_plot &lt;- generate_auc_heatmap(model_data_list, c("TodasVariables", "Asociacion", "StepAUC", "Lasso"))</span></span>
<span id="cb194-6514"><a href="#cb194-6514" aria-hidden="true" tabindex="-1"></a><span class="in">heatmap_plot</span></span>
<span id="cb194-6515"><a href="#cb194-6515" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6516"><a href="#cb194-6516" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-6517"><a href="#cb194-6517" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6518"><a href="#cb194-6518" aria-hidden="true" tabindex="-1"></a>Como se puede obserbar en el mapa de calor superior, las conclusiones finales de los dos estudios anteriores parecen justificarse con esta visualización. Los métodos NaiveBayes, con todas las variables del problema, Adaboost, con el método de selección Lasso, ANN, con Lasso también, y KNN, con asociación, muestran los AUC promedio globales más altos de todos. </span>
<span id="cb194-6519"><a href="#cb194-6519" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb194-6520"><a href="#cb194-6520" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6521"><a href="#cb194-6521" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6522"><a href="#cb194-6522" aria-hidden="true" tabindex="-1"></a>Se concluye que los modelos que pasarán a la siguiente etapa de inspección serán:</span>
<span id="cb194-6523"><a href="#cb194-6523" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6524"><a href="#cb194-6524" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>**Naive Bayes con TodasVariables**, con un AUC promedio de 0.7439, y un comportamiento estable.</span>
<span id="cb194-6525"><a href="#cb194-6525" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>**AdaBoost con Lasso**, con un AUC promedio de 0.74, y un comportamiento estable.</span>
<span id="cb194-6526"><a href="#cb194-6526" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>**ANN con Lasso**, con un AUC promedio de 0.747, y un comportamiento estable.</span>
<span id="cb194-6527"><a href="#cb194-6527" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>**KNN con Asociacion**, con un AUC promedio de 0.745, y un comportamiento algo inestable. </span>
<span id="cb194-6528"><a href="#cb194-6528" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6529"><a href="#cb194-6529" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6530"><a href="#cb194-6530" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6531"><a href="#cb194-6531" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6532"><a href="#cb194-6532" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6533"><a href="#cb194-6533" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6534"><a href="#cb194-6534" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6535"><a href="#cb194-6535" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6536"><a href="#cb194-6536" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6537"><a href="#cb194-6537" aria-hidden="true" tabindex="-1"></a><span class="fu">## Estabilidad para Hiperparámetros</span></span>
<span id="cb194-6538"><a href="#cb194-6538" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6539"><a href="#cb194-6539" aria-hidden="true" tabindex="-1"></a>La estabilidad de los hiperparámetros merece ser explorada durante esta evaluación de modelos de ML. Una inspección detallada de estos parámetros permite entender mejor cómo influyen en el rendimiento del modelo y garantiza que las configuraciones seleccionadas no sean producto del azar. En este apartado, se analizarán los hiperparámetros de los modelos seleccionados anteriormente, utilizando dos funciones de visualización diferentes: una para modelos con dos hiperparámetros y otra para Adaboost, que tiene un único hiperparámetro.</span>
<span id="cb194-6540"><a href="#cb194-6540" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6541"><a href="#cb194-6541" aria-hidden="true" tabindex="-1"></a>::: {.panel-tabset}</span>
<span id="cb194-6542"><a href="#cb194-6542" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6543"><a href="#cb194-6543" aria-hidden="true" tabindex="-1"></a><span class="fu">## Mapa de Calor para Modelos con 2 hiperparámetros</span></span>
<span id="cb194-6544"><a href="#cb194-6544" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6547"><a href="#cb194-6547" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb194-6548"><a href="#cb194-6548" aria-hidden="true" tabindex="-1"></a>generate_combined_hyperparameter_stability_analysis <span class="ot">&lt;-</span> <span class="cf">function</span>(df1, df2, df3, df4, hyperparameters) {</span>
<span id="cb194-6549"><a href="#cb194-6549" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Combinamos los data.frames en uno solo</span></span>
<span id="cb194-6550"><a href="#cb194-6550" aria-hidden="true" tabindex="-1"></a>  combined_df <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(df1, df2, df3, df4)</span>
<span id="cb194-6551"><a href="#cb194-6551" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb194-6552"><a href="#cb194-6552" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Reemplazamos los NaN por 0 en las columnas de hiperparámetros</span></span>
<span id="cb194-6553"><a href="#cb194-6553" aria-hidden="true" tabindex="-1"></a>  param1 <span class="ot">&lt;-</span> <span class="fu">names</span>(hyperparameters)[<span class="dv">1</span>]</span>
<span id="cb194-6554"><a href="#cb194-6554" aria-hidden="true" tabindex="-1"></a>  param2 <span class="ot">&lt;-</span> <span class="fu">names</span>(hyperparameters)[<span class="dv">2</span>]</span>
<span id="cb194-6555"><a href="#cb194-6555" aria-hidden="true" tabindex="-1"></a>  combined_df[<span class="fu">is.na</span>(combined_df[[param1]]), param1] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb194-6556"><a href="#cb194-6556" aria-hidden="true" tabindex="-1"></a>  combined_df[<span class="fu">is.na</span>(combined_df[[param2]]), param2] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb194-6557"><a href="#cb194-6557" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb194-6558"><a href="#cb194-6558" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Contamos las frecuencias de cada combinación de hiperparámetros</span></span>
<span id="cb194-6559"><a href="#cb194-6559" aria-hidden="true" tabindex="-1"></a>  freq_table <span class="ot">&lt;-</span> combined_df <span class="sc">%&gt;%</span></span>
<span id="cb194-6560"><a href="#cb194-6560" aria-hidden="true" tabindex="-1"></a>    <span class="fu">count</span>(<span class="sc">!!</span><span class="fu">sym</span>(param1), <span class="sc">!!</span><span class="fu">sym</span>(param2)) <span class="sc">%&gt;%</span></span>
<span id="cb194-6561"><a href="#cb194-6561" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">Frequency =</span> n)</span>
<span id="cb194-6562"><a href="#cb194-6562" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb194-6563"><a href="#cb194-6563" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Aseguramos que todas las combinaciones posibles están presentes</span></span>
<span id="cb194-6564"><a href="#cb194-6564" aria-hidden="true" tabindex="-1"></a>  all_combinations <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(hyperparameters[[param1]], hyperparameters[[param2]])</span>
<span id="cb194-6565"><a href="#cb194-6565" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(all_combinations) <span class="ot">&lt;-</span> <span class="fu">c</span>(param1, param2)</span>
<span id="cb194-6566"><a href="#cb194-6566" aria-hidden="true" tabindex="-1"></a>  freq_table <span class="ot">&lt;-</span> <span class="fu">right_join</span>(all_combinations, freq_table, <span class="at">by =</span> <span class="fu">c</span>(param1, param2))</span>
<span id="cb194-6567"><a href="#cb194-6567" aria-hidden="true" tabindex="-1"></a>  freq_table[<span class="fu">is.na</span>(freq_table)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb194-6568"><a href="#cb194-6568" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb194-6569"><a href="#cb194-6569" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Creación del mapa de calor</span></span>
<span id="cb194-6570"><a href="#cb194-6570" aria-hidden="true" tabindex="-1"></a>  heatmap_plot <span class="ot">&lt;-</span> <span class="fu">plot_ly</span>(</span>
<span id="cb194-6571"><a href="#cb194-6571" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> freq_table,</span>
<span id="cb194-6572"><a href="#cb194-6572" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="sc">~</span><span class="fu">get</span>(param1),</span>
<span id="cb194-6573"><a href="#cb194-6573" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="sc">~</span><span class="fu">get</span>(param2),</span>
<span id="cb194-6574"><a href="#cb194-6574" aria-hidden="true" tabindex="-1"></a>    <span class="at">z =</span> <span class="sc">~</span>Frequency,</span>
<span id="cb194-6575"><a href="#cb194-6575" aria-hidden="true" tabindex="-1"></a>    <span class="at">type =</span> <span class="st">"heatmap"</span>,</span>
<span id="cb194-6576"><a href="#cb194-6576" aria-hidden="true" tabindex="-1"></a>    <span class="at">colorscale =</span> <span class="st">"Viridis"</span></span>
<span id="cb194-6577"><a href="#cb194-6577" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb194-6578"><a href="#cb194-6578" aria-hidden="true" tabindex="-1"></a>    <span class="fu">layout</span>(</span>
<span id="cb194-6579"><a href="#cb194-6579" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="fu">paste</span>(<span class="st">"Heatmap of"</span>, param1, <span class="st">"and"</span>, param2, <span class="st">"Frequency"</span>),</span>
<span id="cb194-6580"><a href="#cb194-6580" aria-hidden="true" tabindex="-1"></a>      <span class="at">xaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> param1),</span>
<span id="cb194-6581"><a href="#cb194-6581" aria-hidden="true" tabindex="-1"></a>      <span class="at">yaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> param2)</span>
<span id="cb194-6582"><a href="#cb194-6582" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb194-6583"><a href="#cb194-6583" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb194-6584"><a href="#cb194-6584" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Devolvemos el mapa de calor</span></span>
<span id="cb194-6585"><a href="#cb194-6585" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(heatmap_plot)</span>
<span id="cb194-6586"><a href="#cb194-6586" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb194-6587"><a href="#cb194-6587" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-6588"><a href="#cb194-6588" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6589"><a href="#cb194-6589" aria-hidden="true" tabindex="-1"></a>Esta función combina los resultados de múltiples data.frames y crea un mapa de calor que muestra la frecuencia de las combinaciones de dos hiperparámetros. Se reemplazan los valores faltantes por ceros, se asegura de que todas las combinaciones posibles de hiperparámetros estén presentes y, finalmente, se utiliza <span class="in">`plot_ly`</span> para generar el mapa de calor.</span>
<span id="cb194-6590"><a href="#cb194-6590" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6591"><a href="#cb194-6591" aria-hidden="true" tabindex="-1"></a><span class="fu">## Gráfico de Barras para modelos con 1 hiperparámetro</span></span>
<span id="cb194-6592"><a href="#cb194-6592" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6595"><a href="#cb194-6595" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb194-6596"><a href="#cb194-6596" aria-hidden="true" tabindex="-1"></a>generate_adaboost_hyperparameter_analysis <span class="ot">&lt;-</span> <span class="cf">function</span>(df1, df2, df3, df4, hyperparameters) {</span>
<span id="cb194-6597"><a href="#cb194-6597" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Combinamos los data.frames en uno solo</span></span>
<span id="cb194-6598"><a href="#cb194-6598" aria-hidden="true" tabindex="-1"></a>  combined_df <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(df1, df2, df3, df4)</span>
<span id="cb194-6599"><a href="#cb194-6599" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb194-6600"><a href="#cb194-6600" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Obtenemos el nombre del hiperparámetro</span></span>
<span id="cb194-6601"><a href="#cb194-6601" aria-hidden="true" tabindex="-1"></a>  param <span class="ot">&lt;-</span> <span class="fu">names</span>(hyperparameters)[<span class="dv">1</span>]</span>
<span id="cb194-6602"><a href="#cb194-6602" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb194-6603"><a href="#cb194-6603" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Reemplazamos los NaN por 0 en la columna del hiperparámetro</span></span>
<span id="cb194-6604"><a href="#cb194-6604" aria-hidden="true" tabindex="-1"></a>  combined_df[<span class="fu">is.na</span>(combined_df[[param]]), param] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb194-6605"><a href="#cb194-6605" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb194-6606"><a href="#cb194-6606" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Contamos las frecuencias de cada valor del hiperparámetro</span></span>
<span id="cb194-6607"><a href="#cb194-6607" aria-hidden="true" tabindex="-1"></a>  freq_table <span class="ot">&lt;-</span> combined_df <span class="sc">%&gt;%</span></span>
<span id="cb194-6608"><a href="#cb194-6608" aria-hidden="true" tabindex="-1"></a>    <span class="fu">count</span>(<span class="sc">!!</span><span class="fu">sym</span>(param)) <span class="sc">%&gt;%</span></span>
<span id="cb194-6609"><a href="#cb194-6609" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">Frequency =</span> n)</span>
<span id="cb194-6610"><a href="#cb194-6610" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb194-6611"><a href="#cb194-6611" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Creación del gráfico de barras</span></span>
<span id="cb194-6612"><a href="#cb194-6612" aria-hidden="true" tabindex="-1"></a>  bar_plot <span class="ot">&lt;-</span> <span class="fu">plot_ly</span>(</span>
<span id="cb194-6613"><a href="#cb194-6613" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> freq_table,</span>
<span id="cb194-6614"><a href="#cb194-6614" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="sc">~</span><span class="fu">get</span>(param),</span>
<span id="cb194-6615"><a href="#cb194-6615" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="sc">~</span>Frequency,</span>
<span id="cb194-6616"><a href="#cb194-6616" aria-hidden="true" tabindex="-1"></a>    <span class="at">type =</span> <span class="st">'bar'</span></span>
<span id="cb194-6617"><a href="#cb194-6617" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb194-6618"><a href="#cb194-6618" aria-hidden="true" tabindex="-1"></a>    <span class="fu">layout</span>(</span>
<span id="cb194-6619"><a href="#cb194-6619" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="fu">paste</span>(<span class="st">"Bar Plot of"</span>, param, <span class="st">"Frequency"</span>),</span>
<span id="cb194-6620"><a href="#cb194-6620" aria-hidden="true" tabindex="-1"></a>      <span class="at">xaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> param),</span>
<span id="cb194-6621"><a href="#cb194-6621" aria-hidden="true" tabindex="-1"></a>      <span class="at">yaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">"Frequency"</span>)</span>
<span id="cb194-6622"><a href="#cb194-6622" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb194-6623"><a href="#cb194-6623" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb194-6624"><a href="#cb194-6624" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Devolvemos el gráfico de barras</span></span>
<span id="cb194-6625"><a href="#cb194-6625" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(bar_plot)</span>
<span id="cb194-6626"><a href="#cb194-6626" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb194-6627"><a href="#cb194-6627" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6628"><a href="#cb194-6628" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-6629"><a href="#cb194-6629" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6630"><a href="#cb194-6630" aria-hidden="true" tabindex="-1"></a>Esta función se enfoca en modelos con un único hiperparámetro, como Adaboost. Esta función combina varios data.frames y crea un gráfico de barras que muestra la frecuencia de los valores de este hiperparámetro. Similarmente, los valores faltantes se reemplazan por ceros y se cuenta la frecuencia de cada valor del hiperparámetro. </span>
<span id="cb194-6631"><a href="#cb194-6631" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb194-6632"><a href="#cb194-6632" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6633"><a href="#cb194-6633" aria-hidden="true" tabindex="-1"></a>Se incluye la discusión:</span>
<span id="cb194-6634"><a href="#cb194-6634" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6635"><a href="#cb194-6635" aria-hidden="true" tabindex="-1"></a>::: {.panel-tabset}</span>
<span id="cb194-6636"><a href="#cb194-6636" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6637"><a href="#cb194-6637" aria-hidden="true" tabindex="-1"></a><span class="fu">## KNN</span></span>
<span id="cb194-6638"><a href="#cb194-6638" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6641"><a href="#cb194-6641" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb194-6642"><a href="#cb194-6642" aria-hidden="true" tabindex="-1"></a>hyperparameters <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb194-6643"><a href="#cb194-6643" aria-hidden="true" tabindex="-1"></a>  <span class="at">Best_k =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">16</span>, <span class="dv">20</span>, <span class="dv">25</span>, <span class="dv">30</span>, <span class="dv">32</span>),</span>
<span id="cb194-6644"><a href="#cb194-6644" aria-hidden="true" tabindex="-1"></a>  <span class="at">Best_l =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>)</span>
<span id="cb194-6645"><a href="#cb194-6645" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb194-6646"><a href="#cb194-6646" aria-hidden="true" tabindex="-1"></a>result_knn <span class="ot">&lt;-</span> <span class="fu">generate_combined_hyperparameter_stability_analysis</span>(KNN_TodasVariables_Metrics<span class="sc">$</span>performance_metrics, </span>
<span id="cb194-6647"><a href="#cb194-6647" aria-hidden="true" tabindex="-1"></a>                                                              KNN_Asociacion_Metrics<span class="sc">$</span>performance_metrics, </span>
<span id="cb194-6648"><a href="#cb194-6648" aria-hidden="true" tabindex="-1"></a>                                                              KNN_StepAUC_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb194-6649"><a href="#cb194-6649" aria-hidden="true" tabindex="-1"></a>                                                              KNN_Lasso_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb194-6650"><a href="#cb194-6650" aria-hidden="true" tabindex="-1"></a>                                                              hyperparameters)</span>
<span id="cb194-6651"><a href="#cb194-6651" aria-hidden="true" tabindex="-1"></a>result_knn</span>
<span id="cb194-6652"><a href="#cb194-6652" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-6653"><a href="#cb194-6653" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6654"><a href="#cb194-6654" aria-hidden="true" tabindex="-1"></a>Como se puede observar, en el mapa de calor de los hiperparámetros del KNN, hay una clara tendencia hacia la selección de la distancia de Minkowski (<span class="in">`l=1`</span>), dejando a la distancia Euclidea (<span class="in">`l=2`</span>) como una opción secundaria. Por otra parte, una vez fijamos nuestra atención en la distancia de Minkowski, se puede observar que la elección del número de vecinos que influencian la predicción sobre la muestra de test es bastante inestable. Si bien es verdad que <span class="in">`k=10`</span> es el valor más elegido, con 18 apariciones, las elecciones <span class="in">`k={5,15,25,32}`</span> han sido encontradas 12, 10, 14, y 12 veces, respectivamente. Esto es un claro indicativo de que, aunque el algoritmo KNN muestre un AUC alto, sería un riesgo poner un modelo en producción con esta inestabilidad, ya que no se tiene una idea clara sobre qué hiperparámetros son los que mejor encajan con este conjunto de datos. Es por esto que el modelo KNN queda descartado en análisis consecuentes. </span>
<span id="cb194-6655"><a href="#cb194-6655" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6656"><a href="#cb194-6656" aria-hidden="true" tabindex="-1"></a><span class="fu">## ANN</span></span>
<span id="cb194-6657"><a href="#cb194-6657" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6660"><a href="#cb194-6660" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb194-6661"><a href="#cb194-6661" aria-hidden="true" tabindex="-1"></a>hyperparameters <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb194-6662"><a href="#cb194-6662" aria-hidden="true" tabindex="-1"></a>  <span class="at">Best_Size =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">15</span>, <span class="dv">20</span>, <span class="dv">25</span>, <span class="dv">30</span>),</span>
<span id="cb194-6663"><a href="#cb194-6663" aria-hidden="true" tabindex="-1"></a>  <span class="at">Best_Decay =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.2</span>, <span class="fl">0.3</span>, <span class="fl">0.4</span>)</span>
<span id="cb194-6664"><a href="#cb194-6664" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb194-6665"><a href="#cb194-6665" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6666"><a href="#cb194-6666" aria-hidden="true" tabindex="-1"></a>result_ann <span class="ot">&lt;-</span> <span class="fu">generate_combined_hyperparameter_stability_analysis</span>(ANN_StepAUC_Metrics<span class="sc">$</span>performance_metrics, </span>
<span id="cb194-6667"><a href="#cb194-6667" aria-hidden="true" tabindex="-1"></a>                                                              ANN_Lasso_Metrics<span class="sc">$</span>performance_metrics, </span>
<span id="cb194-6668"><a href="#cb194-6668" aria-hidden="true" tabindex="-1"></a>                                                              ANN_Asociacion_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb194-6669"><a href="#cb194-6669" aria-hidden="true" tabindex="-1"></a>                                                              ANN_TodasVariables_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb194-6670"><a href="#cb194-6670" aria-hidden="true" tabindex="-1"></a>                                                              hyperparameters)</span>
<span id="cb194-6671"><a href="#cb194-6671" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6672"><a href="#cb194-6672" aria-hidden="true" tabindex="-1"></a>result_ann</span>
<span id="cb194-6673"><a href="#cb194-6673" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-6674"><a href="#cb194-6674" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6675"><a href="#cb194-6675" aria-hidden="true" tabindex="-1"></a>Como se puede observar en el mapa de calor de las redes neuronales, parece haber un claro consenso sobre los hiperparámetros óptimos del modelo, siendo la combinación <span class="in">`Size=5; Decay=0.4`</span> la encontrada 21 veces, con bastante diferencia. Este tamaño de red neuronal reducido podría sugerir que el problema es fácilmente modelable con una baja cantidad de neuronas, esto tendría sentido, ya que el conjunto de datos con el que se está trabajando no tiene demasiadas variables, por lo que las relaciones intrínsecas entre las muestras y la variable objetivo podrían no ser demasiado complejas. Por otra parte, también se puede explicar un valor de decay tan alto, ya que, al estar el conjunto de datos tan desbalanceado, se prima castigar el overfitting del modelo hacia la clase PCR-Negativa. El modelo ANN es muy consistente con sus hiperparámetros, indicando que una red de size 5-10 con un decay de 0.4 podría ser óptimo para modelar el problema con el objetivo de obtener el máximo AUC posible.  </span>
<span id="cb194-6676"><a href="#cb194-6676" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6677"><a href="#cb194-6677" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6678"><a href="#cb194-6678" aria-hidden="true" tabindex="-1"></a><span class="fu">## AdaBoost</span></span>
<span id="cb194-6679"><a href="#cb194-6679" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6682"><a href="#cb194-6682" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb194-6683"><a href="#cb194-6683" aria-hidden="true" tabindex="-1"></a>hyperparameters <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb194-6684"><a href="#cb194-6684" aria-hidden="true" tabindex="-1"></a>  <span class="at">Best_Iteration =</span> <span class="fu">c</span>(<span class="dv">50</span>, <span class="dv">100</span>, <span class="dv">150</span>, <span class="dv">200</span>)</span>
<span id="cb194-6685"><a href="#cb194-6685" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb194-6686"><a href="#cb194-6686" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6687"><a href="#cb194-6687" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6688"><a href="#cb194-6688" aria-hidden="true" tabindex="-1"></a>result_ada <span class="ot">&lt;-</span> <span class="fu">generate_adaboost_hyperparameter_analysis</span>(AdaBoost_TodasVariables_Metrics<span class="sc">$</span>performance_metrics, </span>
<span id="cb194-6689"><a href="#cb194-6689" aria-hidden="true" tabindex="-1"></a>                                                              AdaBoost_Asociacion_Metrics<span class="sc">$</span>performance_metrics, </span>
<span id="cb194-6690"><a href="#cb194-6690" aria-hidden="true" tabindex="-1"></a>                                                              AdaBoost_StepAUC_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb194-6691"><a href="#cb194-6691" aria-hidden="true" tabindex="-1"></a>                                                              AdaBoost_Lasso_Metrics<span class="sc">$</span>performance_metrics,</span>
<span id="cb194-6692"><a href="#cb194-6692" aria-hidden="true" tabindex="-1"></a>                                                              hyperparameters)</span>
<span id="cb194-6693"><a href="#cb194-6693" aria-hidden="true" tabindex="-1"></a>result_ada</span>
<span id="cb194-6694"><a href="#cb194-6694" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-6695"><a href="#cb194-6695" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6696"><a href="#cb194-6696" aria-hidden="true" tabindex="-1"></a>Como se puede observar en el gráfico de barras, el modelo Adaboost también ha convergido la búsqueda de hiperparámetros en la malla definida durante su entrenamiento en un valor específico de Best_Iteration, siendo este 50, con una cantidad de veces encontrado igual a 56. Debido a que el modelo ha concluído que esta cantidad de iteraciones son las óptimas más del 50% de las veces, se tomará este valor como referencia, concluyendo que Adaboost es consistente con respecto a su selección de hiperparámetros.</span>
<span id="cb194-6697"><a href="#cb194-6697" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6698"><a href="#cb194-6698" aria-hidden="true" tabindex="-1"></a><span class="fu">## Naive Bayes</span></span>
<span id="cb194-6699"><a href="#cb194-6699" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6700"><a href="#cb194-6700" aria-hidden="true" tabindex="-1"></a>El modelo Naive Bayes no ha sido entranando con el ajuste de ningún hiperparámetro, esto supone una evidente sorpresa, ya que, al suponer la independencia de las probabilidades condicionales, debería de dar unos resultados pésimos. Sin embargo, viendo que no se ha necesitado un tamaño de red neuronal muy grande para modelar el problema, se puede concluir que el conjunto de datos no parece tener suficientes variables como para capturar la complejidad de la tarea de la predicción del estado PCR-Positivo de un paciente, permitiendo que algoritmos más sencillos como el Naive Bayes alcancen el AUC óptimo de este estudio sin ajustar ningún hiperparámetro.</span>
<span id="cb194-6701"><a href="#cb194-6701" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6702"><a href="#cb194-6702" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb194-6703"><a href="#cb194-6703" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6704"><a href="#cb194-6704" aria-hidden="true" tabindex="-1"></a><span class="fu">## Estabilidad de Variables</span></span>
<span id="cb194-6705"><a href="#cb194-6705" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6706"><a href="#cb194-6706" aria-hidden="true" tabindex="-1"></a>Se procederá con el análisis de la estabilidad de las variables seleccionadas. Este análisis permite evaluar la consistencia de las variables elegidas a través de diferentes métodos y modelos, proporcionando información valiosa sobre su importancia y relevancia. En este apartado, se emplearán funciones específicas para contar la frecuencia de selección de variables agrupadas y visualizar estos resultados mediante gráficos de barras. Esta inspección detallada facilita la identificación de variables clave que tienen un impacto significativo en el rendimiento del modelo y asegura que las elecciones realizadas no sean producto del azar o de la variabilidad inherente a los datos.</span>
<span id="cb194-6707"><a href="#cb194-6707" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6708"><a href="#cb194-6708" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, warning=FALSE}</span></span>
<span id="cb194-6709"><a href="#cb194-6709" aria-hidden="true" tabindex="-1"></a><span class="in"># Función para contar la frecuencia de selección de variables agrupadas</span></span>
<span id="cb194-6710"><a href="#cb194-6710" aria-hidden="true" tabindex="-1"></a><span class="in">contar_seleccion_variables_agrupadas &lt;- function(df, variables_principales) {</span></span>
<span id="cb194-6711"><a href="#cb194-6711" aria-hidden="true" tabindex="-1"></a><span class="in">  variable_counts &lt;- setNames(rep(0, length(variables_principales)), variables_principales)</span></span>
<span id="cb194-6712"><a href="#cb194-6712" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb194-6713"><a href="#cb194-6713" aria-hidden="true" tabindex="-1"></a><span class="in">  for (variables in df$Best_Variables) {</span></span>
<span id="cb194-6714"><a href="#cb194-6714" aria-hidden="true" tabindex="-1"></a><span class="in">    var_list &lt;- unlist(strsplit(variables, ","))</span></span>
<span id="cb194-6715"><a href="#cb194-6715" aria-hidden="true" tabindex="-1"></a><span class="in">    for (principal in variables_principales) {</span></span>
<span id="cb194-6716"><a href="#cb194-6716" aria-hidden="true" tabindex="-1"></a><span class="in">      if (any(grepl(principal, var_list))) {</span></span>
<span id="cb194-6717"><a href="#cb194-6717" aria-hidden="true" tabindex="-1"></a><span class="in">        variable_counts[principal] &lt;- variable_counts[principal] + 1</span></span>
<span id="cb194-6718"><a href="#cb194-6718" aria-hidden="true" tabindex="-1"></a><span class="in">      }</span></span>
<span id="cb194-6719"><a href="#cb194-6719" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb194-6720"><a href="#cb194-6720" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb194-6721"><a href="#cb194-6721" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb194-6722"><a href="#cb194-6722" aria-hidden="true" tabindex="-1"></a><span class="in">  result &lt;- as.data.frame(variable_counts)</span></span>
<span id="cb194-6723"><a href="#cb194-6723" aria-hidden="true" tabindex="-1"></a><span class="in">  result$Variable &lt;- rownames(result)</span></span>
<span id="cb194-6724"><a href="#cb194-6724" aria-hidden="true" tabindex="-1"></a><span class="in">  rownames(result) &lt;- NULL</span></span>
<span id="cb194-6725"><a href="#cb194-6725" aria-hidden="true" tabindex="-1"></a><span class="in">  colnames(result) &lt;- c("Frecuencia", "Variable")</span></span>
<span id="cb194-6726"><a href="#cb194-6726" aria-hidden="true" tabindex="-1"></a><span class="in">  result &lt;- result[order(-result$Frecuencia), ]</span></span>
<span id="cb194-6727"><a href="#cb194-6727" aria-hidden="true" tabindex="-1"></a><span class="in">  return(result)</span></span>
<span id="cb194-6728"><a href="#cb194-6728" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb194-6729"><a href="#cb194-6729" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6730"><a href="#cb194-6730" aria-hidden="true" tabindex="-1"></a><span class="in"># Función combinada</span></span>
<span id="cb194-6731"><a href="#cb194-6731" aria-hidden="true" tabindex="-1"></a><span class="in">contar_seleccion_combined &lt;- function(df1, df2, variables_principales) {</span></span>
<span id="cb194-6732"><a href="#cb194-6732" aria-hidden="true" tabindex="-1"></a><span class="in">  # Contar frecuencias en el primer dataframe</span></span>
<span id="cb194-6733"><a href="#cb194-6733" aria-hidden="true" tabindex="-1"></a><span class="in">  result_step_auc &lt;- contar_seleccion_variables_agrupadas(df1, variables_principales)</span></span>
<span id="cb194-6734"><a href="#cb194-6734" aria-hidden="true" tabindex="-1"></a><span class="in">  result_step_auc$Metodo &lt;- "StepAUC"</span></span>
<span id="cb194-6735"><a href="#cb194-6735" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb194-6736"><a href="#cb194-6736" aria-hidden="true" tabindex="-1"></a><span class="in">  # Contar frecuencias en el segundo dataframe con variables agrupadas</span></span>
<span id="cb194-6737"><a href="#cb194-6737" aria-hidden="true" tabindex="-1"></a><span class="in">  result_lasso &lt;- contar_seleccion_variables_agrupadas(df2, variables_principales)</span></span>
<span id="cb194-6738"><a href="#cb194-6738" aria-hidden="true" tabindex="-1"></a><span class="in">  result_lasso$Metodo &lt;- "Lasso"</span></span>
<span id="cb194-6739"><a href="#cb194-6739" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb194-6740"><a href="#cb194-6740" aria-hidden="true" tabindex="-1"></a><span class="in">  # Combinar ambos resultados</span></span>
<span id="cb194-6741"><a href="#cb194-6741" aria-hidden="true" tabindex="-1"></a><span class="in">  combined_result &lt;- rbind(result_step_auc, result_lasso)</span></span>
<span id="cb194-6742"><a href="#cb194-6742" aria-hidden="true" tabindex="-1"></a><span class="in">  return(combined_result)</span></span>
<span id="cb194-6743"><a href="#cb194-6743" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb194-6744"><a href="#cb194-6744" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6745"><a href="#cb194-6745" aria-hidden="true" tabindex="-1"></a><span class="in"># Función para combinar todos los dataframes y añadir la columna de Modelo</span></span>
<span id="cb194-6746"><a href="#cb194-6746" aria-hidden="true" tabindex="-1"></a><span class="in">combinar_dataframes &lt;- function(dataframes, modelos) {</span></span>
<span id="cb194-6747"><a href="#cb194-6747" aria-hidden="true" tabindex="-1"></a><span class="in">  combined_df &lt;- do.call(rbind, dataframes)</span></span>
<span id="cb194-6748"><a href="#cb194-6748" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb194-6749"><a href="#cb194-6749" aria-hidden="true" tabindex="-1"></a><span class="in">  # Asegurar que la longitud de los modelos coincida con la de los dataframes combinados</span></span>
<span id="cb194-6750"><a href="#cb194-6750" aria-hidden="true" tabindex="-1"></a><span class="in">  combined_df$Modelo &lt;- rep(modelos, each = nrow(dataframes[[1]]) / length(modelos))</span></span>
<span id="cb194-6751"><a href="#cb194-6751" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb194-6752"><a href="#cb194-6752" aria-hidden="true" tabindex="-1"></a><span class="in">  return(combined_df)</span></span>
<span id="cb194-6753"><a href="#cb194-6753" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb194-6754"><a href="#cb194-6754" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6755"><a href="#cb194-6755" aria-hidden="true" tabindex="-1"></a><span class="in">crear_visualizaciones &lt;- function(combined_df) {</span></span>
<span id="cb194-6756"><a href="#cb194-6756" aria-hidden="true" tabindex="-1"></a><span class="in">  # Métricas por Método de selección</span></span>
<span id="cb194-6757"><a href="#cb194-6757" aria-hidden="true" tabindex="-1"></a><span class="in">  plot_metodo &lt;- plot_ly(</span></span>
<span id="cb194-6758"><a href="#cb194-6758" aria-hidden="true" tabindex="-1"></a><span class="in">    combined_df, </span></span>
<span id="cb194-6759"><a href="#cb194-6759" aria-hidden="true" tabindex="-1"></a><span class="in">    x = ~Variable, </span></span>
<span id="cb194-6760"><a href="#cb194-6760" aria-hidden="true" tabindex="-1"></a><span class="in">    y = ~Frecuencia, </span></span>
<span id="cb194-6761"><a href="#cb194-6761" aria-hidden="true" tabindex="-1"></a><span class="in">    color = ~Metodo, </span></span>
<span id="cb194-6762"><a href="#cb194-6762" aria-hidden="true" tabindex="-1"></a><span class="in">    type = 'bar'</span></span>
<span id="cb194-6763"><a href="#cb194-6763" aria-hidden="true" tabindex="-1"></a><span class="in">  ) %&gt;% layout(</span></span>
<span id="cb194-6764"><a href="#cb194-6764" aria-hidden="true" tabindex="-1"></a><span class="in">    title = 'Métricas por Método de Selección',</span></span>
<span id="cb194-6765"><a href="#cb194-6765" aria-hidden="true" tabindex="-1"></a><span class="in">    xaxis = list(title = 'Variable'),</span></span>
<span id="cb194-6766"><a href="#cb194-6766" aria-hidden="true" tabindex="-1"></a><span class="in">    yaxis = list(title = 'Frecuencia')</span></span>
<span id="cb194-6767"><a href="#cb194-6767" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb194-6768"><a href="#cb194-6768" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb194-6769"><a href="#cb194-6769" aria-hidden="true" tabindex="-1"></a><span class="in">  # Métricas por Modelo</span></span>
<span id="cb194-6770"><a href="#cb194-6770" aria-hidden="true" tabindex="-1"></a><span class="in">  plot_modelo &lt;- plot_ly(</span></span>
<span id="cb194-6771"><a href="#cb194-6771" aria-hidden="true" tabindex="-1"></a><span class="in">    combined_df, </span></span>
<span id="cb194-6772"><a href="#cb194-6772" aria-hidden="true" tabindex="-1"></a><span class="in">    x = ~Variable, </span></span>
<span id="cb194-6773"><a href="#cb194-6773" aria-hidden="true" tabindex="-1"></a><span class="in">    y = ~Frecuencia, </span></span>
<span id="cb194-6774"><a href="#cb194-6774" aria-hidden="true" tabindex="-1"></a><span class="in">    color = ~Modelo, </span></span>
<span id="cb194-6775"><a href="#cb194-6775" aria-hidden="true" tabindex="-1"></a><span class="in">    type = 'bar'</span></span>
<span id="cb194-6776"><a href="#cb194-6776" aria-hidden="true" tabindex="-1"></a><span class="in">  ) %&gt;% layout(</span></span>
<span id="cb194-6777"><a href="#cb194-6777" aria-hidden="true" tabindex="-1"></a><span class="in">    title = 'Métricas por Modelo de Machine Learning',</span></span>
<span id="cb194-6778"><a href="#cb194-6778" aria-hidden="true" tabindex="-1"></a><span class="in">    xaxis = list(title = 'Variable'),</span></span>
<span id="cb194-6779"><a href="#cb194-6779" aria-hidden="true" tabindex="-1"></a><span class="in">    yaxis = list(title = 'Frecuencia')</span></span>
<span id="cb194-6780"><a href="#cb194-6780" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb194-6781"><a href="#cb194-6781" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb194-6782"><a href="#cb194-6782" aria-hidden="true" tabindex="-1"></a><span class="in">  return(list(plot_metodo = plot_metodo, plot_modelo = plot_modelo))</span></span>
<span id="cb194-6783"><a href="#cb194-6783" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb194-6784"><a href="#cb194-6784" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6785"><a href="#cb194-6785" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6786"><a href="#cb194-6786" aria-hidden="true" tabindex="-1"></a><span class="in"># Ejecución de la función</span></span>
<span id="cb194-6787"><a href="#cb194-6787" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6788"><a href="#cb194-6788" aria-hidden="true" tabindex="-1"></a><span class="in">variablesFactor &lt;- c("Edad", "REst", "RPro", "Estadio", "Grado", "Fenotipo", "NodAfec")</span></span>
<span id="cb194-6789"><a href="#cb194-6789" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6790"><a href="#cb194-6790" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6791"><a href="#cb194-6791" aria-hidden="true" tabindex="-1"></a><span class="in"># ANN</span></span>
<span id="cb194-6792"><a href="#cb194-6792" aria-hidden="true" tabindex="-1"></a><span class="in">ANN_Variables &lt;- contar_seleccion_combined(ANN_StepAUC_Metrics$performance_metrics, </span></span>
<span id="cb194-6793"><a href="#cb194-6793" aria-hidden="true" tabindex="-1"></a><span class="in">                          ANN_Lasso_Metrics$performance_metrics, </span></span>
<span id="cb194-6794"><a href="#cb194-6794" aria-hidden="true" tabindex="-1"></a><span class="in">                          variablesFactor)</span></span>
<span id="cb194-6795"><a href="#cb194-6795" aria-hidden="true" tabindex="-1"></a><span class="in">ANN_Variables$Modelo &lt;- "ANN"</span></span>
<span id="cb194-6796"><a href="#cb194-6796" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6797"><a href="#cb194-6797" aria-hidden="true" tabindex="-1"></a><span class="in"># SVM</span></span>
<span id="cb194-6798"><a href="#cb194-6798" aria-hidden="true" tabindex="-1"></a><span class="in">SVM_Variables &lt;- contar_seleccion_combined(SVM_StepAUC_Metrics$performance_metrics, </span></span>
<span id="cb194-6799"><a href="#cb194-6799" aria-hidden="true" tabindex="-1"></a><span class="in">                          SVM_Lasso_Metrics$performance_metrics, </span></span>
<span id="cb194-6800"><a href="#cb194-6800" aria-hidden="true" tabindex="-1"></a><span class="in">                          variablesFactor)</span></span>
<span id="cb194-6801"><a href="#cb194-6801" aria-hidden="true" tabindex="-1"></a><span class="in">SVM_Variables$Modelo &lt;- "SVM"</span></span>
<span id="cb194-6802"><a href="#cb194-6802" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6803"><a href="#cb194-6803" aria-hidden="true" tabindex="-1"></a><span class="in"># DT</span></span>
<span id="cb194-6804"><a href="#cb194-6804" aria-hidden="true" tabindex="-1"></a><span class="in">DT_Variables &lt;- contar_seleccion_combined(RPart_StepAUC_Metrics$performance_metrics, </span></span>
<span id="cb194-6805"><a href="#cb194-6805" aria-hidden="true" tabindex="-1"></a><span class="in">                          RPart_Lasso_Metrics$performance_metrics, </span></span>
<span id="cb194-6806"><a href="#cb194-6806" aria-hidden="true" tabindex="-1"></a><span class="in">                          variablesFactor)</span></span>
<span id="cb194-6807"><a href="#cb194-6807" aria-hidden="true" tabindex="-1"></a><span class="in">DT_Variables$Modelo &lt;- "DT"</span></span>
<span id="cb194-6808"><a href="#cb194-6808" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6809"><a href="#cb194-6809" aria-hidden="true" tabindex="-1"></a><span class="in"># ADA</span></span>
<span id="cb194-6810"><a href="#cb194-6810" aria-hidden="true" tabindex="-1"></a><span class="in">ADA_Variables &lt;- contar_seleccion_combined(AdaBoost_StepAUC_Metrics$performance_metrics, </span></span>
<span id="cb194-6811"><a href="#cb194-6811" aria-hidden="true" tabindex="-1"></a><span class="in">                          AdaBoost_Lasso_Metrics$performance_metrics, </span></span>
<span id="cb194-6812"><a href="#cb194-6812" aria-hidden="true" tabindex="-1"></a><span class="in">                          variablesFactor)</span></span>
<span id="cb194-6813"><a href="#cb194-6813" aria-hidden="true" tabindex="-1"></a><span class="in">ADA_Variables$Modelo &lt;- "ADA"</span></span>
<span id="cb194-6814"><a href="#cb194-6814" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6815"><a href="#cb194-6815" aria-hidden="true" tabindex="-1"></a><span class="in"># NaiveBayes</span></span>
<span id="cb194-6816"><a href="#cb194-6816" aria-hidden="true" tabindex="-1"></a><span class="in">Naive_Variables &lt;- contar_seleccion_combined(NaiveBayes_StepAUC_Metrics$performance_metrics, </span></span>
<span id="cb194-6817"><a href="#cb194-6817" aria-hidden="true" tabindex="-1"></a><span class="in">                          NaiveBayes_Lasso_Metrics$performance_metrics, </span></span>
<span id="cb194-6818"><a href="#cb194-6818" aria-hidden="true" tabindex="-1"></a><span class="in">                          variablesFactor)</span></span>
<span id="cb194-6819"><a href="#cb194-6819" aria-hidden="true" tabindex="-1"></a><span class="in">Naive_Variables$Modelo &lt;- "Naive"</span></span>
<span id="cb194-6820"><a href="#cb194-6820" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6821"><a href="#cb194-6821" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6822"><a href="#cb194-6822" aria-hidden="true" tabindex="-1"></a><span class="in">dataframes &lt;- list(Naive_Variables, ADA_Variables, DT_Variables, ANN_Variables, SVM_Variables)</span></span>
<span id="cb194-6823"><a href="#cb194-6823" aria-hidden="true" tabindex="-1"></a><span class="in">modelos &lt;- c("NAIVE", "ADA", "DT", "ANN", "SVM")</span></span>
<span id="cb194-6824"><a href="#cb194-6824" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6825"><a href="#cb194-6825" aria-hidden="true" tabindex="-1"></a><span class="in">combined_df &lt;- combinar_dataframes(dataframes, modelos)</span></span>
<span id="cb194-6826"><a href="#cb194-6826" aria-hidden="true" tabindex="-1"></a><span class="in">plots &lt;- crear_visualizaciones(combined_df)</span></span>
<span id="cb194-6827"><a href="#cb194-6827" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-6828"><a href="#cb194-6828" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6829"><a href="#cb194-6829" aria-hidden="true" tabindex="-1"></a>::: {.panel-tabset}</span>
<span id="cb194-6830"><a href="#cb194-6830" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6831"><a href="#cb194-6831" aria-hidden="true" tabindex="-1"></a><span class="fu">## Variables según Método</span></span>
<span id="cb194-6832"><a href="#cb194-6832" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6833"><a href="#cb194-6833" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, warning=FALSE}</span></span>
<span id="cb194-6834"><a href="#cb194-6834" aria-hidden="true" tabindex="-1"></a><span class="in">plots$plot_metodo</span></span>
<span id="cb194-6835"><a href="#cb194-6835" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-6836"><a href="#cb194-6836" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6837"><a href="#cb194-6837" aria-hidden="true" tabindex="-1"></a>En el gráfico de barras superior se pueden observar las frecuencias de selección de cada variable por los dos principales métodos de selección de características empleados en este estudio. Un aspecto positivo que se puede remarcar es que, ambos métodos parecen coincidir en la importancia de una serie de variables, mostrando que <span class="in">`Estadio, Fenotipo, Grado,`</span> y <span class="in">`REst`</span> son variables importantes en el análisis, <span class="in">`NodAfec`</span> es prescindible, y hay una ligera discrepancai en <span class="in">`Edad`</span> y <span class="in">`RPro`</span>, pero de manera general, se puede concluir que <span class="in">`Edad`</span> sí tiene significancia sobre la variable objetivo, mientras que <span class="in">`RPro`</span>, no. </span>
<span id="cb194-6838"><a href="#cb194-6838" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6839"><a href="#cb194-6839" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6840"><a href="#cb194-6840" aria-hidden="true" tabindex="-1"></a><span class="fu">## Variables según Modelo </span></span>
<span id="cb194-6841"><a href="#cb194-6841" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6844"><a href="#cb194-6844" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb194-6845"><a href="#cb194-6845" aria-hidden="true" tabindex="-1"></a>plots<span class="sc">$</span>plot_modelo</span>
<span id="cb194-6846"><a href="#cb194-6846" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-6847"><a href="#cb194-6847" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6848"><a href="#cb194-6848" aria-hidden="true" tabindex="-1"></a>Como se puede observar en el gráfico de barras superior (si se hace *click* en los modelos DT y SVM, se podrán observar solo los modelos de interés), las variables que mejor encajan con cada uno de nuestros modelos finalistas parecen coincidir con las variables seleccionadas por los métodos en gran medida. </span>
<span id="cb194-6849"><a href="#cb194-6849" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6850"><a href="#cb194-6850" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb194-6851"><a href="#cb194-6851" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6852"><a href="#cb194-6852" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6853"><a href="#cb194-6853" aria-hidden="true" tabindex="-1"></a><span class="fu">## Modelo más Adecuado</span></span>
<span id="cb194-6854"><a href="#cb194-6854" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6855"><a href="#cb194-6855" aria-hidden="true" tabindex="-1"></a>Con toda la información discutida anteriormente, se pretende tomar una decisión informada sobre la selección de un algoritmo de ML, con una serie de hiperparámetros fijos, y con unas variables elegidas del conjunto de datos. Esto se hará con la intención de poner el modelo en producción, permitiendo al usuario realizar predicciones reales sobre pacientes. Los datos recogidos hasta ahora son:</span>
<span id="cb194-6856"><a href="#cb194-6856" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6857"><a href="#cb194-6857" aria-hidden="true" tabindex="-1"></a>| Modelo       | AUC promedio | Hiperparámetros estables | Metodo         | Variables                               |</span>
<span id="cb194-6858"><a href="#cb194-6858" aria-hidden="true" tabindex="-1"></a>|--------------|--------------|--------------------------|----------------|-----------------------------------------|</span>
<span id="cb194-6859"><a href="#cb194-6859" aria-hidden="true" tabindex="-1"></a>| ANN          | 0.747        | (5, 0.4)                 | Lasso          | Edad, Estadio, Fenotipo, Grado, REst    |</span>
<span id="cb194-6860"><a href="#cb194-6860" aria-hidden="true" tabindex="-1"></a>| NaiveBayes   | 0.7439       | -                        | TodasVariables | Todas                                   |</span>
<span id="cb194-6861"><a href="#cb194-6861" aria-hidden="true" tabindex="-1"></a>| ADA          | 0.74         | 50                       | Lasso          | Edad, Estadio, Fenotipo, Grado, REst    |</span>
<span id="cb194-6862"><a href="#cb194-6862" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6863"><a href="#cb194-6863" aria-hidden="true" tabindex="-1"></a>Tomando como referencia toda la discusión realizada anteriormente, se ha decidido que se va a usar un modelo de **Redes Neuronales Artificiales con un tamaño de la capa oculta de 5 neuronas, y un valor de decay de 0.4, las variables utilizadas para este modelo serán las variables seleccionadas por el método Lasso sobre el conjunto de datos completo**. La decisión de dejar fuera el modelo de Naive Bayes se basa en la incapacidad que podría tener el modelo para realizar una integración continua de datos, en la cual la variabilidad de muestras podría aumentar, rompiendo el estado actual del conjunto de datos con el que fue entrenado, y poniendo en evidencia la, *teóricamente*, pobre capacidad de predicción del modelo. Por otro lado, la decisión de dejar fuera el modelo Adaboost ha sido plenamente basada en que su rendimiento honesto es algo más bajo que el de las ANN, ya que, por el resto de características, es un modelo fiable, que se puede adaptar a nuevas muestras, y que ha empelado el mismo método de selección de variables que ANN. </span>
<span id="cb194-6864"><a href="#cb194-6864" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6865"><a href="#cb194-6865" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6866"><a href="#cb194-6866" aria-hidden="true" tabindex="-1"></a><span class="fu"># Conclusión</span></span>
<span id="cb194-6867"><a href="#cb194-6867" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6868"><a href="#cb194-6868" aria-hidden="true" tabindex="-1"></a>A lo largo de este proyecto se ha realizado un estudio en profundidad sobre la capacidad de predicción del estado PCR de una serie de pacientes mediante el uso de algoritmos de aprendizaje computacional avanzados, los cuales han sido entrenados con un subconjunto de las variables de los datos originales definido por diferentes algoritmos de selección de características. Para cada algoritmo de aprendizaje computacional, se ha aplicado una estimación honesta de parámetros mediante la implementación de una doble validación cruzada 5x2, en la que los pliegues internos han sido utilizados para buscar la mejor combinación de hiperparámetros de una lista acotada dada, definida mediante diferentes pruebas realizadas sobre la estimación del rendimiento aparente del modelo. La selección de características también fue llevaba a cabo en el pliegue interno de la validación.  </span>
<span id="cb194-6869"><a href="#cb194-6869" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6870"><a href="#cb194-6870" aria-hidden="true" tabindex="-1"></a>Una vez se han ejecutado todas las pruebas, se ha realizado una discusión de los resultados a modo de estudio comparativo con la finalidad de elegir el algoritmo que mejor se ajusta a la tarea de este proyecto. Para considerar un modelo como válido, se ha considerado la robustez y valor de su AUC global para diferentes semillas que generan particiones de datos aleatorias, la estabilidad de selección de hiperparámetros, y la estabilidad de selección de variables. Así, un modelo que sea considerado como adecuado para el estudio, será el que obtenga una calificación cualitativa correcta en estos tres criterios. </span>
<span id="cb194-6871"><a href="#cb194-6871" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6872"><a href="#cb194-6872" aria-hidden="true" tabindex="-1"></a>Finalmente, una vez llevabo a cabo el estudio, se ha concluído que, para este problema, las Redes de Neuronas Artificales, con un tamaño de 5 neuronas en la capa oculta, y con un valor de decay de 0.4, son la mejor opción para predecir el estado PCR (Metástasis) de un paciente, dada su Edad, Estadío, Fenotipo, Grado, y REst. Otros modelos han llegado a la etapa final de la evaluación, pero han sido descartados debido a su poca adaptabilidad a nuevos datos, o su rendimiento algo más pobre de AUC.</span>
<span id="cb194-6873"><a href="#cb194-6873" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6874"><a href="#cb194-6874" aria-hidden="true" tabindex="-1"></a>Las limitaciones de este proyecto tienen su origen sobre todo en el conjunto de datos. En ningún momento del proyecto se ha conseguido sobrepasar un rendimiento global de 0.8 para el AUC, se teoriza que esto puede ocurrir por varias razones. La primera, es la cantidad de muestras disponibles en este conjunto de datos, la segunda, es la poca cantidad de variables, y la tercera, que puede ser que las variables que existan en este conjunto de datos no sean lo suficientemente significativas con respecto a la característica diana, significando que no es posible modelar el problema con ningún algoritmo, ya que no se capturan bien las características subyacentes de la variable objetivo PCR con ninguna variable. </span>
<span id="cb194-6875"><a href="#cb194-6875" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6876"><a href="#cb194-6876" aria-hidden="true" tabindex="-1"></a>A pesar de todo, se considera que se han cumplido los objetivos de este proyecto, ya que, gracias al exitoso análisis en profundidad realizado, se ha tomado una decisión informada por el modelo final. </span>
<span id="cb194-6877"><a href="#cb194-6877" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6878"><a href="#cb194-6878" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6879"><a href="#cb194-6879" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6880"><a href="#cb194-6880" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6881"><a href="#cb194-6881" aria-hidden="true" tabindex="-1"></a><span class="fu"># Anexo A: Aplicación RShiny y Despliegue del Modelo</span></span>
<span id="cb194-6882"><a href="#cb194-6882" aria-hidden="true" tabindex="-1"></a>::: {.panel-tabset}</span>
<span id="cb194-6883"><a href="#cb194-6883" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6884"><a href="#cb194-6884" aria-hidden="true" tabindex="-1"></a><span class="fu">## Código Interfaz de Usuario (UI)</span></span>
<span id="cb194-6885"><a href="#cb194-6885" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6886"><a href="#cb194-6886" aria-hidden="true" tabindex="-1"></a>Se utiliza fluidPage para estructurar la interfaz de la aplicación, aplicando un tema visual flatly de shinytheme para darle un estilo atractivo. En el encabezado, se incluyen estilos CSS personalizados que definen la apariencia de elementos específicos como las predicciones y la tabla. Dentro de wellPanel, se muestra el título "Modelo de Red Neuronal Cáncer de Mama".</span>
<span id="cb194-6887"><a href="#cb194-6887" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6888"><a href="#cb194-6888" aria-hidden="true" tabindex="-1"></a>Se estructura la interfaz principal en dos secciones: un sidebarLayout con un sidebarPanel y un mainPanel. El sidebarPanel contiene entradas de usuario para la edad, estadio, fenotipo, grado, REst, y un deslizador para seleccionar el umbral de predicción. También se incluyen elementos de texto para mostrar feedback en tiempo real sobre la entrada de edad y el umbral seleccionado. El mainPanel utiliza tabsetPanel para organizar el contenido en dos pestañas: "Predicción" e "Información". La pestaña "Predicción" muestra un gráfico interactivo y una tabla resumen de las entradas y predicciones, mientras que la pestaña "Información" proporciona detalles sobre el proyecto, el alumno y un enlace al código fuente en GitHub.</span>
<span id="cb194-6889"><a href="#cb194-6889" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6890"><a href="#cb194-6890" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=FALSE}</span></span>
<span id="cb194-6891"><a href="#cb194-6891" aria-hidden="true" tabindex="-1"></a><span class="in">ui &lt;- fluidPage(</span></span>
<span id="cb194-6892"><a href="#cb194-6892" aria-hidden="true" tabindex="-1"></a><span class="in">  theme = shinytheme("flatly"),</span></span>
<span id="cb194-6893"><a href="#cb194-6893" aria-hidden="true" tabindex="-1"></a><span class="in">  tags$head(</span></span>
<span id="cb194-6894"><a href="#cb194-6894" aria-hidden="true" tabindex="-1"></a><span class="in">    tags$style(HTML("</span></span>
<span id="cb194-6895"><a href="#cb194-6895" aria-hidden="true" tabindex="-1"></a><span class="in">      .prediccion-positivo {</span></span>
<span id="cb194-6896"><a href="#cb194-6896" aria-hidden="true" tabindex="-1"></a><span class="in">        font-size: 24px;</span></span>
<span id="cb194-6897"><a href="#cb194-6897" aria-hidden="true" tabindex="-1"></a><span class="in">        color: rgba(54, 162, 235, 0.6);</span></span>
<span id="cb194-6898"><a href="#cb194-6898" aria-hidden="true" tabindex="-1"></a><span class="in">        font-weight: bold;</span></span>
<span id="cb194-6899"><a href="#cb194-6899" aria-hidden="true" tabindex="-1"></a><span class="in">      }</span></span>
<span id="cb194-6900"><a href="#cb194-6900" aria-hidden="true" tabindex="-1"></a><span class="in">      .prediccion-negativo {</span></span>
<span id="cb194-6901"><a href="#cb194-6901" aria-hidden="true" tabindex="-1"></a><span class="in">        font-size: 24px;</span></span>
<span id="cb194-6902"><a href="#cb194-6902" aria-hidden="true" tabindex="-1"></a><span class="in">        color: rgba(255, 99, 132, 0.6);</span></span>
<span id="cb194-6903"><a href="#cb194-6903" aria-hidden="true" tabindex="-1"></a><span class="in">        font-weight: bold;</span></span>
<span id="cb194-6904"><a href="#cb194-6904" aria-hidden="true" tabindex="-1"></a><span class="in">      }</span></span>
<span id="cb194-6905"><a href="#cb194-6905" aria-hidden="true" tabindex="-1"></a><span class="in">      table th {</span></span>
<span id="cb194-6906"><a href="#cb194-6906" aria-hidden="true" tabindex="-1"></a><span class="in">        font-weight: bold;</span></span>
<span id="cb194-6907"><a href="#cb194-6907" aria-hidden="true" tabindex="-1"></a><span class="in">      }</span></span>
<span id="cb194-6908"><a href="#cb194-6908" aria-hidden="true" tabindex="-1"></a><span class="in">      .title-panel {</span></span>
<span id="cb194-6909"><a href="#cb194-6909" aria-hidden="true" tabindex="-1"></a><span class="in">        background-color: #f5f5f5;</span></span>
<span id="cb194-6910"><a href="#cb194-6910" aria-hidden="true" tabindex="-1"></a><span class="in">        padding: 20px;</span></span>
<span id="cb194-6911"><a href="#cb194-6911" aria-hidden="true" tabindex="-1"></a><span class="in">        border-radius: 10px;</span></span>
<span id="cb194-6912"><a href="#cb194-6912" aria-hidden="true" tabindex="-1"></a><span class="in">        text-align: center;</span></span>
<span id="cb194-6913"><a href="#cb194-6913" aria-hidden="true" tabindex="-1"></a><span class="in">      }</span></span>
<span id="cb194-6914"><a href="#cb194-6914" aria-hidden="true" tabindex="-1"></a><span class="in">      .subtitle {</span></span>
<span id="cb194-6915"><a href="#cb194-6915" aria-hidden="true" tabindex="-1"></a><span class="in">        font-size: 16px;</span></span>
<span id="cb194-6916"><a href="#cb194-6916" aria-hidden="true" tabindex="-1"></a><span class="in">        color: #333;</span></span>
<span id="cb194-6917"><a href="#cb194-6917" aria-hidden="true" tabindex="-1"></a><span class="in">      }</span></span>
<span id="cb194-6918"><a href="#cb194-6918" aria-hidden="true" tabindex="-1"></a><span class="in">    "))</span></span>
<span id="cb194-6919"><a href="#cb194-6919" aria-hidden="true" tabindex="-1"></a><span class="in">  ),</span></span>
<span id="cb194-6920"><a href="#cb194-6920" aria-hidden="true" tabindex="-1"></a><span class="in">  wellPanel(</span></span>
<span id="cb194-6921"><a href="#cb194-6921" aria-hidden="true" tabindex="-1"></a><span class="in">    class = "title-panel",</span></span>
<span id="cb194-6922"><a href="#cb194-6922" aria-hidden="true" tabindex="-1"></a><span class="in">    h1("Modelo de Red Neuronal Cáncer de Mama"),</span></span>
<span id="cb194-6923"><a href="#cb194-6923" aria-hidden="true" tabindex="-1"></a><span class="in">    div(class = "subtitle", "Mario Pascual González; Bioinformática 23-24")</span></span>
<span id="cb194-6924"><a href="#cb194-6924" aria-hidden="true" tabindex="-1"></a><span class="in">  ),</span></span>
<span id="cb194-6925"><a href="#cb194-6925" aria-hidden="true" tabindex="-1"></a><span class="in">  sidebarLayout(</span></span>
<span id="cb194-6926"><a href="#cb194-6926" aria-hidden="true" tabindex="-1"></a><span class="in">    sidebarPanel(</span></span>
<span id="cb194-6927"><a href="#cb194-6927" aria-hidden="true" tabindex="-1"></a><span class="in">      numericInput("edad", "Edad:", value = 30, min = 0, max = 100),</span></span>
<span id="cb194-6928"><a href="#cb194-6928" aria-hidden="true" tabindex="-1"></a><span class="in">      textOutput("edadFeedback"),</span></span>
<span id="cb194-6929"><a href="#cb194-6929" aria-hidden="true" tabindex="-1"></a><span class="in">      selectInput("estadio", "Estadio:", choices = c("T0-T1", "T2", "T3", "T4")),</span></span>
<span id="cb194-6930"><a href="#cb194-6930" aria-hidden="true" tabindex="-1"></a><span class="in">      selectInput("fenotipo", "Fenotipo:", choices = c("Basal", "Her2", "LumA", "LumB", "Normal")),</span></span>
<span id="cb194-6931"><a href="#cb194-6931" aria-hidden="true" tabindex="-1"></a><span class="in">      selectInput("grado", "Grado:", choices = c("I", "II", "III")),</span></span>
<span id="cb194-6932"><a href="#cb194-6932" aria-hidden="true" tabindex="-1"></a><span class="in">      selectInput("rest", "REst:", choices = c("N", "P")),</span></span>
<span id="cb194-6933"><a href="#cb194-6933" aria-hidden="true" tabindex="-1"></a><span class="in">      sliderInput("threshold", "Threshold:", min = 0.01, max = 0.99, value = 0.5, step = 0.01),</span></span>
<span id="cb194-6934"><a href="#cb194-6934" aria-hidden="true" tabindex="-1"></a><span class="in">      textOutput("selectedThreshold"),</span></span>
<span id="cb194-6935"><a href="#cb194-6935" aria-hidden="true" tabindex="-1"></a><span class="in">      actionButton("predict", "Predecir")</span></span>
<span id="cb194-6936"><a href="#cb194-6936" aria-hidden="true" tabindex="-1"></a><span class="in">    ),</span></span>
<span id="cb194-6937"><a href="#cb194-6937" aria-hidden="true" tabindex="-1"></a><span class="in">    mainPanel(</span></span>
<span id="cb194-6938"><a href="#cb194-6938" aria-hidden="true" tabindex="-1"></a><span class="in">      tabsetPanel(</span></span>
<span id="cb194-6939"><a href="#cb194-6939" aria-hidden="true" tabindex="-1"></a><span class="in">        tabPanel("Predicción",</span></span>
<span id="cb194-6940"><a href="#cb194-6940" aria-hidden="true" tabindex="-1"></a><span class="in">                 fluidRow(</span></span>
<span id="cb194-6941"><a href="#cb194-6941" aria-hidden="true" tabindex="-1"></a><span class="in">                   column(8, plotlyOutput("predictionPlot")),</span></span>
<span id="cb194-6942"><a href="#cb194-6942" aria-hidden="true" tabindex="-1"></a><span class="in">                   column(4,</span></span>
<span id="cb194-6943"><a href="#cb194-6943" aria-hidden="true" tabindex="-1"></a><span class="in">                          h3("Resumen de la consulta y predicción"),</span></span>
<span id="cb194-6944"><a href="#cb194-6944" aria-hidden="true" tabindex="-1"></a><span class="in">                          tableOutput("inputValuesTable"))</span></span>
<span id="cb194-6945"><a href="#cb194-6945" aria-hidden="true" tabindex="-1"></a><span class="in">                 )</span></span>
<span id="cb194-6946"><a href="#cb194-6946" aria-hidden="true" tabindex="-1"></a><span class="in">        ),</span></span>
<span id="cb194-6947"><a href="#cb194-6947" aria-hidden="true" tabindex="-1"></a><span class="in">        tabPanel("Información",</span></span>
<span id="cb194-6948"><a href="#cb194-6948" aria-hidden="true" tabindex="-1"></a><span class="in">                 h3("Información del Proyecto"),</span></span>
<span id="cb194-6949"><a href="#cb194-6949" aria-hidden="true" tabindex="-1"></a><span class="in">                 p("..."),</span></span>
<span id="cb194-6950"><a href="#cb194-6950" aria-hidden="true" tabindex="-1"></a><span class="in">                 a("...")</span></span>
<span id="cb194-6951"><a href="#cb194-6951" aria-hidden="true" tabindex="-1"></a><span class="in">        )</span></span>
<span id="cb194-6952"><a href="#cb194-6952" aria-hidden="true" tabindex="-1"></a><span class="in">      )</span></span>
<span id="cb194-6953"><a href="#cb194-6953" aria-hidden="true" tabindex="-1"></a><span class="in">    )</span></span>
<span id="cb194-6954"><a href="#cb194-6954" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb194-6955"><a href="#cb194-6955" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb194-6956"><a href="#cb194-6956" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-6957"><a href="#cb194-6957" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6958"><a href="#cb194-6958" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6959"><a href="#cb194-6959" aria-hidden="true" tabindex="-1"></a><span class="fu">## Código del Servidor (Server)</span></span>
<span id="cb194-6960"><a href="#cb194-6960" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6961"><a href="#cb194-6961" aria-hidden="true" tabindex="-1"></a>Se configura el código del servidor para manejar la lógica detrás de la aplicación, utilizando el paquete nnet para entrenar y predecir con un modelo de red neuronal. Se cargan los datos y se convierten las columnas a factores según sea necesario. La función observeEvent se utiliza para proporcionar feedback en tiempo real sobre la entrada de la edad, asegurando que se introduce un valor válido antes de permitir la predicción.</span>
<span id="cb194-6962"><a href="#cb194-6962" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6963"><a href="#cb194-6963" aria-hidden="true" tabindex="-1"></a>Cuando el usuario solicita una predicción, se procesan las entradas del formulario, se recodifican y se convierten en una matriz de datos adecuada para el modelo. Se entrena el modelo con los datos proporcionados y se realiza una predicción en bruto. Esta predicción se compara con el umbral seleccionado por el usuario para determinar si la predicción final es "PCR-Positivo" o "PCR-Negativo". La predicción y las entradas se muestran en una tabla resumen, y se genera un gráfico interactivo que visualiza las probabilidades de predicción para cada clase. Este flujo asegura que el usuario reciba feedback inmediato y visual sobre las predicciones realizadas por el modelo.</span>
<span id="cb194-6964"><a href="#cb194-6964" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6965"><a href="#cb194-6965" aria-hidden="true" tabindex="-1"></a>Se admite que esta forma de trabajar en la que el modelo se entrena cada vez que se quiere realizar una predicción puede no ser muy eficiente. Sin embargo, el tiempo de entrenamiento con este conjunto de datos reducido es mínimo, y se ha decidido no desarrollar una plataforma de validación de predicciones para la integración de datos y entrenamiento continuo del modelo, por lo que el tamaño del conjunto no variará con el tiempo. Si se quisiera mejorar esta implementación, uno de los siguientes pasos sería separar el entrenamiento del modelo y la predicción, pero para el ámbito de este estudio, esta implementación es adecuada. </span>
<span id="cb194-6966"><a href="#cb194-6966" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6967"><a href="#cb194-6967" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=FALSE}</span></span>
<span id="cb194-6968"><a href="#cb194-6968" aria-hidden="true" tabindex="-1"></a><span class="in">categorizar_edad &lt;- function(edad) {</span></span>
<span id="cb194-6969"><a href="#cb194-6969" aria-hidden="true" tabindex="-1"></a><span class="in">  if (edad &gt;= 24 &amp;&amp; edad &lt; 29.1) {</span></span>
<span id="cb194-6970"><a href="#cb194-6970" aria-hidden="true" tabindex="-1"></a><span class="in">    return("Grupo1")</span></span>
<span id="cb194-6971"><a href="#cb194-6971" aria-hidden="true" tabindex="-1"></a><span class="in">  } else if (edad &gt;= 29.1 &amp;&amp; edad &lt; 34.2) {</span></span>
<span id="cb194-6972"><a href="#cb194-6972" aria-hidden="true" tabindex="-1"></a><span class="in">    return("Grupo2")</span></span>
<span id="cb194-6973"><a href="#cb194-6973" aria-hidden="true" tabindex="-1"></a><span class="in">  } else if (edad &gt;= 34.2 &amp;&amp; edad &lt; 39.3) {</span></span>
<span id="cb194-6974"><a href="#cb194-6974" aria-hidden="true" tabindex="-1"></a><span class="in">    return("Grupo3")</span></span>
<span id="cb194-6975"><a href="#cb194-6975" aria-hidden="true" tabindex="-1"></a><span class="in">  } else if (edad &gt;= 39.3 &amp;&amp; edad &lt; 44.4) {</span></span>
<span id="cb194-6976"><a href="#cb194-6976" aria-hidden="true" tabindex="-1"></a><span class="in">    return("Grupo4")</span></span>
<span id="cb194-6977"><a href="#cb194-6977" aria-hidden="true" tabindex="-1"></a><span class="in">  } else if (edad &gt;= 44.4 &amp;&amp; edad &lt; 49.5) {</span></span>
<span id="cb194-6978"><a href="#cb194-6978" aria-hidden="true" tabindex="-1"></a><span class="in">    return("Grupo5")</span></span>
<span id="cb194-6979"><a href="#cb194-6979" aria-hidden="true" tabindex="-1"></a><span class="in">  } else if (edad &gt;= 49.5 &amp;&amp; edad &lt; 54.6) {</span></span>
<span id="cb194-6980"><a href="#cb194-6980" aria-hidden="true" tabindex="-1"></a><span class="in">    return("Grupo6")</span></span>
<span id="cb194-6981"><a href="#cb194-6981" aria-hidden="true" tabindex="-1"></a><span class="in">  } else if (edad &gt;= 54.6 &amp;&amp; edad &lt; 59.7) {</span></span>
<span id="cb194-6982"><a href="#cb194-6982" aria-hidden="true" tabindex="-1"></a><span class="in">    return("Grupo7")</span></span>
<span id="cb194-6983"><a href="#cb194-6983" aria-hidden="true" tabindex="-1"></a><span class="in">  } else if (edad &gt;= 59.7 &amp;&amp; edad &lt; 64.8) {</span></span>
<span id="cb194-6984"><a href="#cb194-6984" aria-hidden="true" tabindex="-1"></a><span class="in">    return("Grupo8")</span></span>
<span id="cb194-6985"><a href="#cb194-6985" aria-hidden="true" tabindex="-1"></a><span class="in">  } else if (edad &gt;= 64.8 &amp;&amp; edad &lt; 69.9) {</span></span>
<span id="cb194-6986"><a href="#cb194-6986" aria-hidden="true" tabindex="-1"></a><span class="in">    return("Grupo9")</span></span>
<span id="cb194-6987"><a href="#cb194-6987" aria-hidden="true" tabindex="-1"></a><span class="in">  } else if (edad &gt;= 69.9 &amp;&amp; edad &lt; 75) {</span></span>
<span id="cb194-6988"><a href="#cb194-6988" aria-hidden="true" tabindex="-1"></a><span class="in">    return("Grupo10")</span></span>
<span id="cb194-6989"><a href="#cb194-6989" aria-hidden="true" tabindex="-1"></a><span class="in">  } else {</span></span>
<span id="cb194-6990"><a href="#cb194-6990" aria-hidden="true" tabindex="-1"></a><span class="in">    return("Fuera de rango")</span></span>
<span id="cb194-6991"><a href="#cb194-6991" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb194-6992"><a href="#cb194-6992" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb194-6993"><a href="#cb194-6993" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6994"><a href="#cb194-6994" aria-hidden="true" tabindex="-1"></a><span class="in"># Cargar los datos</span></span>
<span id="cb194-6995"><a href="#cb194-6995" aria-hidden="true" tabindex="-1"></a><span class="in">data &lt;- read.csv("data_factor.csv")</span></span>
<span id="cb194-6996"><a href="#cb194-6996" aria-hidden="true" tabindex="-1"></a><span class="in"># Recodificar la variable PCR para que los valores sean 0 y 1</span></span>
<span id="cb194-6997"><a href="#cb194-6997" aria-hidden="true" tabindex="-1"></a><span class="in">data$PCR &lt;- data$PCR - 1</span></span>
<span id="cb194-6998"><a href="#cb194-6998" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6999"><a href="#cb194-6999" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-7000"><a href="#cb194-7000" aria-hidden="true" tabindex="-1"></a><span class="in"># Define server logic required to draw a histogram</span></span>
<span id="cb194-7001"><a href="#cb194-7001" aria-hidden="true" tabindex="-1"></a><span class="in">server &lt;- function(input, output, session) {</span></span>
<span id="cb194-7002"><a href="#cb194-7002" aria-hidden="true" tabindex="-1"></a><span class="in">  # Convertir las columnas de data a factores</span></span>
<span id="cb194-7003"><a href="#cb194-7003" aria-hidden="true" tabindex="-1"></a><span class="in">  data &lt;- read.csv("./data_factor.csv")</span></span>
<span id="cb194-7004"><a href="#cb194-7004" aria-hidden="true" tabindex="-1"></a><span class="in">  data$PCR &lt;- data$PCR - 1</span></span>
<span id="cb194-7005"><a href="#cb194-7005" aria-hidden="true" tabindex="-1"></a><span class="in">  data$Edad &lt;- factor(data$Edad)</span></span>
<span id="cb194-7006"><a href="#cb194-7006" aria-hidden="true" tabindex="-1"></a><span class="in">  data$Estadio &lt;- factor(data$Estadio)</span></span>
<span id="cb194-7007"><a href="#cb194-7007" aria-hidden="true" tabindex="-1"></a><span class="in">  data$Fenotipo &lt;- factor(data$Fenotipo)</span></span>
<span id="cb194-7008"><a href="#cb194-7008" aria-hidden="true" tabindex="-1"></a><span class="in">  data$Grado &lt;- factor(data$Grado)</span></span>
<span id="cb194-7009"><a href="#cb194-7009" aria-hidden="true" tabindex="-1"></a><span class="in">  data$REst &lt;- factor(data$REst)</span></span>
<span id="cb194-7010"><a href="#cb194-7010" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb194-7011"><a href="#cb194-7011" aria-hidden="true" tabindex="-1"></a><span class="in">  # Feedback para la edad</span></span>
<span id="cb194-7012"><a href="#cb194-7012" aria-hidden="true" tabindex="-1"></a><span class="in">  observeEvent(input$edad, {</span></span>
<span id="cb194-7013"><a href="#cb194-7013" aria-hidden="true" tabindex="-1"></a><span class="in">    if (input$edad &lt; 29.09 || input$edad &gt; 76) {</span></span>
<span id="cb194-7014"><a href="#cb194-7014" aria-hidden="true" tabindex="-1"></a><span class="in">      output$edadFeedback &lt;- renderText({</span></span>
<span id="cb194-7015"><a href="#cb194-7015" aria-hidden="true" tabindex="-1"></a><span class="in">        "Por favor, introduce una edad entre 29 y 75 años."</span></span>
<span id="cb194-7016"><a href="#cb194-7016" aria-hidden="true" tabindex="-1"></a><span class="in">      })</span></span>
<span id="cb194-7017"><a href="#cb194-7017" aria-hidden="true" tabindex="-1"></a><span class="in">    } else {</span></span>
<span id="cb194-7018"><a href="#cb194-7018" aria-hidden="true" tabindex="-1"></a><span class="in">      output$edadFeedback &lt;- renderText({</span></span>
<span id="cb194-7019"><a href="#cb194-7019" aria-hidden="true" tabindex="-1"></a><span class="in">        ""</span></span>
<span id="cb194-7020"><a href="#cb194-7020" aria-hidden="true" tabindex="-1"></a><span class="in">      })</span></span>
<span id="cb194-7021"><a href="#cb194-7021" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb194-7022"><a href="#cb194-7022" aria-hidden="true" tabindex="-1"></a><span class="in">  })</span></span>
<span id="cb194-7023"><a href="#cb194-7023" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb194-7024"><a href="#cb194-7024" aria-hidden="true" tabindex="-1"></a><span class="in">  output$selectedThreshold &lt;- renderText({</span></span>
<span id="cb194-7025"><a href="#cb194-7025" aria-hidden="true" tabindex="-1"></a><span class="in">    paste("Threshold seleccionado:", input$threshold)</span></span>
<span id="cb194-7026"><a href="#cb194-7026" aria-hidden="true" tabindex="-1"></a><span class="in">  })</span></span>
<span id="cb194-7027"><a href="#cb194-7027" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb194-7028"><a href="#cb194-7028" aria-hidden="true" tabindex="-1"></a><span class="in">  observeEvent(input$predict, {</span></span>
<span id="cb194-7029"><a href="#cb194-7029" aria-hidden="true" tabindex="-1"></a><span class="in">    if (input$edad &lt; 29.09 || input$edad &gt; 76) {</span></span>
<span id="cb194-7030"><a href="#cb194-7030" aria-hidden="true" tabindex="-1"></a><span class="in">      output$edadFeedback &lt;- renderText({</span></span>
<span id="cb194-7031"><a href="#cb194-7031" aria-hidden="true" tabindex="-1"></a><span class="in">        "Por favor, introduce una edad entre 29 y 75 años."</span></span>
<span id="cb194-7032"><a href="#cb194-7032" aria-hidden="true" tabindex="-1"></a><span class="in">      })</span></span>
<span id="cb194-7033"><a href="#cb194-7033" aria-hidden="true" tabindex="-1"></a><span class="in">      return(NULL)</span></span>
<span id="cb194-7034"><a href="#cb194-7034" aria-hidden="true" tabindex="-1"></a><span class="in">    } else {</span></span>
<span id="cb194-7035"><a href="#cb194-7035" aria-hidden="true" tabindex="-1"></a><span class="in">      output$edadFeedback &lt;- renderText({</span></span>
<span id="cb194-7036"><a href="#cb194-7036" aria-hidden="true" tabindex="-1"></a><span class="in">        ""</span></span>
<span id="cb194-7037"><a href="#cb194-7037" aria-hidden="true" tabindex="-1"></a><span class="in">      })</span></span>
<span id="cb194-7038"><a href="#cb194-7038" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb194-7039"><a href="#cb194-7039" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-7040"><a href="#cb194-7040" aria-hidden="true" tabindex="-1"></a><span class="in">    grupo_edad &lt;- categorizar_edad(input$edad)</span></span>
<span id="cb194-7041"><a href="#cb194-7041" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-7042"><a href="#cb194-7042" aria-hidden="true" tabindex="-1"></a><span class="in">    # Guardar las entradas del usuario en un vector asegurando que cada factor tenga al menos dos niveles</span></span>
<span id="cb194-7043"><a href="#cb194-7043" aria-hidden="true" tabindex="-1"></a><span class="in">    new_data &lt;- data.frame(</span></span>
<span id="cb194-7044"><a href="#cb194-7044" aria-hidden="true" tabindex="-1"></a><span class="in">      Edad = factor(grupo_edad, levels = levels(data$Edad)),</span></span>
<span id="cb194-7045"><a href="#cb194-7045" aria-hidden="true" tabindex="-1"></a><span class="in">      Estadio = factor(input$estadio, levels = levels(data$Estadio)),</span></span>
<span id="cb194-7046"><a href="#cb194-7046" aria-hidden="true" tabindex="-1"></a><span class="in">      Fenotipo = factor(input$fenotipo, levels = levels(data$Fenotipo)),</span></span>
<span id="cb194-7047"><a href="#cb194-7047" aria-hidden="true" tabindex="-1"></a><span class="in">      Grado = factor(input$grado, levels = levels(data$Grado)),</span></span>
<span id="cb194-7048"><a href="#cb194-7048" aria-hidden="true" tabindex="-1"></a><span class="in">      REst = factor(input$rest, levels = levels(data$REst)),</span></span>
<span id="cb194-7049"><a href="#cb194-7049" aria-hidden="true" tabindex="-1"></a><span class="in">      stringsAsFactors = TRUE</span></span>
<span id="cb194-7050"><a href="#cb194-7050" aria-hidden="true" tabindex="-1"></a><span class="in">    )</span></span>
<span id="cb194-7051"><a href="#cb194-7051" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-7052"><a href="#cb194-7052" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-7053"><a href="#cb194-7053" aria-hidden="true" tabindex="-1"></a><span class="in">    # Convertir los datos a one-hot encoding, incluyendo PCR en data_matrix</span></span>
<span id="cb194-7054"><a href="#cb194-7054" aria-hidden="true" tabindex="-1"></a><span class="in">    data_matrix &lt;- model.matrix(PCR ~ Edad + Estadio + Fenotipo + Grado + REst, data = data)</span></span>
<span id="cb194-7055"><a href="#cb194-7055" aria-hidden="true" tabindex="-1"></a><span class="in">    data_matrix &lt;- as.data.frame(data_matrix)</span></span>
<span id="cb194-7056"><a href="#cb194-7056" aria-hidden="true" tabindex="-1"></a><span class="in">    data_matrix$PCR &lt;- data$PCR</span></span>
<span id="cb194-7057"><a href="#cb194-7057" aria-hidden="true" tabindex="-1"></a><span class="in">    data_matrix$`(Intercept)` &lt;- NULL</span></span>
<span id="cb194-7058"><a href="#cb194-7058" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-7059"><a href="#cb194-7059" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-7060"><a href="#cb194-7060" aria-hidden="true" tabindex="-1"></a><span class="in">    # Crear las mismas columnas en new_data_matrix que en data_matrix</span></span>
<span id="cb194-7061"><a href="#cb194-7061" aria-hidden="true" tabindex="-1"></a><span class="in">    new_data_matrix &lt;- model.matrix(~ Edad + Estadio + Fenotipo + Grado + REst, data = new_data)</span></span>
<span id="cb194-7062"><a href="#cb194-7062" aria-hidden="true" tabindex="-1"></a><span class="in">    new_data_matrix &lt;- as.data.frame(new_data_matrix)</span></span>
<span id="cb194-7063"><a href="#cb194-7063" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-7064"><a href="#cb194-7064" aria-hidden="true" tabindex="-1"></a><span class="in">    # Asegurarse de que new_data_matrix tenga las mismas columnas que data_matrix</span></span>
<span id="cb194-7065"><a href="#cb194-7065" aria-hidden="true" tabindex="-1"></a><span class="in">    missing_cols &lt;- setdiff(names(data_matrix), names(new_data_matrix))</span></span>
<span id="cb194-7066"><a href="#cb194-7066" aria-hidden="true" tabindex="-1"></a><span class="in">    for (col in missing_cols) {</span></span>
<span id="cb194-7067"><a href="#cb194-7067" aria-hidden="true" tabindex="-1"></a><span class="in">      new_data_matrix[[col]] &lt;- 0</span></span>
<span id="cb194-7068"><a href="#cb194-7068" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb194-7069"><a href="#cb194-7069" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-7070"><a href="#cb194-7070" aria-hidden="true" tabindex="-1"></a><span class="in">    # Reordenar las columnas para que coincidan</span></span>
<span id="cb194-7071"><a href="#cb194-7071" aria-hidden="true" tabindex="-1"></a><span class="in">    new_data_matrix &lt;- new_data_matrix[names(data_matrix)]</span></span>
<span id="cb194-7072"><a href="#cb194-7072" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-7073"><a href="#cb194-7073" aria-hidden="true" tabindex="-1"></a><span class="in">    # Entrenar el modelo con todos los datos</span></span>
<span id="cb194-7074"><a href="#cb194-7074" aria-hidden="true" tabindex="-1"></a><span class="in">    model &lt;- nnet(PCR ~ ., data = data_matrix, size = 5, decay = 0.4)</span></span>
<span id="cb194-7075"><a href="#cb194-7075" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-7076"><a href="#cb194-7076" aria-hidden="true" tabindex="-1"></a><span class="in">    # Hacer la predicción raw</span></span>
<span id="cb194-7077"><a href="#cb194-7077" aria-hidden="true" tabindex="-1"></a><span class="in">    prediccion_raw &lt;- predict(model, newdata = new_data_matrix, type = "raw")</span></span>
<span id="cb194-7078"><a href="#cb194-7078" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-7079"><a href="#cb194-7079" aria-hidden="true" tabindex="-1"></a><span class="in">    # Aplicar el threshold para determinar la predicción final</span></span>
<span id="cb194-7080"><a href="#cb194-7080" aria-hidden="true" tabindex="-1"></a><span class="in">    prediccion_final &lt;- ifelse(prediccion_raw &gt; input$threshold, "PCR-Positivo", "PCR-Negativo")</span></span>
<span id="cb194-7081"><a href="#cb194-7081" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-7082"><a href="#cb194-7082" aria-hidden="true" tabindex="-1"></a><span class="in">    # Crear el gráfico de barras</span></span>
<span id="cb194-7083"><a href="#cb194-7083" aria-hidden="true" tabindex="-1"></a><span class="in">    output$predictionPlot &lt;- renderPlotly({</span></span>
<span id="cb194-7084"><a href="#cb194-7084" aria-hidden="true" tabindex="-1"></a><span class="in">      plot_ly(</span></span>
<span id="cb194-7085"><a href="#cb194-7085" aria-hidden="true" tabindex="-1"></a><span class="in">        x = c("PCR0", "PCR1"),</span></span>
<span id="cb194-7086"><a href="#cb194-7086" aria-hidden="true" tabindex="-1"></a><span class="in">        y = c((1 - prediccion_raw) * 100, prediccion_raw * 100),</span></span>
<span id="cb194-7087"><a href="#cb194-7087" aria-hidden="true" tabindex="-1"></a><span class="in">        type = 'bar',</span></span>
<span id="cb194-7088"><a href="#cb194-7088" aria-hidden="true" tabindex="-1"></a><span class="in">        name = 'Predicción',</span></span>
<span id="cb194-7089"><a href="#cb194-7089" aria-hidden="true" tabindex="-1"></a><span class="in">        marker = list(color = c('rgba(255, 99, 132, 0.6)', 'rgba(54, 162, 235, 0.6)'))</span></span>
<span id="cb194-7090"><a href="#cb194-7090" aria-hidden="true" tabindex="-1"></a><span class="in">      ) %&gt;% layout(</span></span>
<span id="cb194-7091"><a href="#cb194-7091" aria-hidden="true" tabindex="-1"></a><span class="in">        title = "Porcentaje de Predicción",</span></span>
<span id="cb194-7092"><a href="#cb194-7092" aria-hidden="true" tabindex="-1"></a><span class="in">        xaxis = list(title = ""),</span></span>
<span id="cb194-7093"><a href="#cb194-7093" aria-hidden="true" tabindex="-1"></a><span class="in">        yaxis = list(title = "Porcentaje (%)")</span></span>
<span id="cb194-7094"><a href="#cb194-7094" aria-hidden="true" tabindex="-1"></a><span class="in">      )</span></span>
<span id="cb194-7095"><a href="#cb194-7095" aria-hidden="true" tabindex="-1"></a><span class="in">    })</span></span>
<span id="cb194-7096"><a href="#cb194-7096" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb194-7097"><a href="#cb194-7097" aria-hidden="true" tabindex="-1"></a><span class="in">    # Crear la tabla de resumen incluyendo la predicción</span></span>
<span id="cb194-7098"><a href="#cb194-7098" aria-hidden="true" tabindex="-1"></a><span class="in">    output$inputValuesTable &lt;- renderTable({</span></span>
<span id="cb194-7099"><a href="#cb194-7099" aria-hidden="true" tabindex="-1"></a><span class="in">      data.frame(</span></span>
<span id="cb194-7100"><a href="#cb194-7100" aria-hidden="true" tabindex="-1"></a><span class="in">        Variable = c("Edad", "Categoría de Edad", "Estadio", "Fenotipo", "Grado", "REst", "Predicción"),</span></span>
<span id="cb194-7101"><a href="#cb194-7101" aria-hidden="true" tabindex="-1"></a><span class="in">        Valor = c(input$edad, grupo_edad, input$estadio, input$fenotipo, input$grado, input$rest, prediccion_final)</span></span>
<span id="cb194-7102"><a href="#cb194-7102" aria-hidden="true" tabindex="-1"></a><span class="in">      )</span></span>
<span id="cb194-7103"><a href="#cb194-7103" aria-hidden="true" tabindex="-1"></a><span class="in">    })</span></span>
<span id="cb194-7104"><a href="#cb194-7104" aria-hidden="true" tabindex="-1"></a><span class="in">  })</span></span>
<span id="cb194-7105"><a href="#cb194-7105" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb194-7106"><a href="#cb194-7106" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-7107"><a href="#cb194-7107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-7108"><a href="#cb194-7108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-7109"><a href="#cb194-7109" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb194-7110"><a href="#cb194-7110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-7111"><a href="#cb194-7111" aria-hidden="true" tabindex="-1"></a><span class="in">```{=html}</span></span>
<span id="cb194-7112"><a href="#cb194-7112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-7113"><a href="#cb194-7113" aria-hidden="true" tabindex="-1"></a><span class="in">&lt;iframe src="https://mario-pascual-rshiny-uma.shinyapps.io/ModeloCancerMamaProduccion/" width="100%" height="600px" style="border:none;"&gt;&lt;/iframe&gt;</span></span>
<span id="cb194-7114"><a href="#cb194-7114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-7115"><a href="#cb194-7115" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
</code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->




</body></html>